diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/batch/ExplainTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/batch/ExplainTest.xml
index 3c1ac8c29d9..b3fd69c2ac1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/batch/ExplainTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/batch/ExplainTest.xml
@@ -94,7 +94,7 @@ MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithAgg[extended=true]">
+  <TestCase name="testExplainWithAgg[extended=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(EXPR$0=[$1])
@@ -103,12 +103,12 @@ LogicalProject(EXPR$0=[$1])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 
 == Optimized Physical Plan ==
-Calc(select=[EXPR$0]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count1$0) AS EXPR$0]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-   +- Exchange(distribution=[hash[a]]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(*) AS count1$0]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-         +- Calc(select=[a]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+Calc(select=[EXPR$0])
++- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count1$0) AS EXPR$0])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(*) AS count1$0])
+         +- Calc(select=[a])
+            +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
 Calc(select=[EXPR$0])
@@ -120,7 +120,7 @@ Calc(select=[EXPR$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithAgg[extended=false]">
+  <TestCase name="testExplainWithAgg[extended=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(EXPR$0=[$1])
@@ -129,12 +129,12 @@ LogicalProject(EXPR$0=[$1])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 
 == Optimized Physical Plan ==
-Calc(select=[EXPR$0])
-+- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count1$0) AS EXPR$0])
-   +- Exchange(distribution=[hash[a]])
-      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(*) AS count1$0])
-         +- Calc(select=[a])
-            +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+Calc(select=[EXPR$0]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count1$0) AS EXPR$0]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+   +- Exchange(distribution=[hash[a]]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(*) AS count1$0]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+         +- Calc(select=[a]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+            +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
 == Optimized Execution Plan ==
 Calc(select=[EXPR$0])
@@ -446,35 +446,35 @@ SortLimit(orderBy=[a ASC], offset=[0], fetch=[5], global=[true])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithTableSourceScan[extended=true]">
+  <TestCase name="testExplainWithTableSourceScan[extended=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
-TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
 TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithTableSourceScan[extended=false]">
+  <TestCase name="testExplainWithTableSourceScan[extended=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
-TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
 == Optimized Execution Plan ==
 TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithUnion[extended=true]">
+  <TestCase name="testExplainWithUnion[extended=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalUnion(all=[true])
@@ -484,9 +484,9 @@ LogicalUnion(all=[true])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 
 == Optimized Physical Plan ==
-Union(all=[true], union=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-:- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- BoundedStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+Union(all=[true], union=[a, b, c])
+:- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
++- BoundedStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
 
 == Optimized Execution Plan ==
 Union(all=[true], union=[a, b, c])
@@ -495,7 +495,7 @@ Union(all=[true], union=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithUnion[extended=false]">
+  <TestCase name="testExplainWithUnion[extended=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalUnion(all=[true])
@@ -505,9 +505,9 @@ LogicalUnion(all=[true])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 
 == Optimized Physical Plan ==
-Union(all=[true], union=[a, b, c])
-:- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-+- BoundedStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
+Union(all=[true], union=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+:- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- BoundedStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
 == Optimized Execution Plan ==
 Union(all=[true], union=[a, b, c])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml
index 3c7833b3675..0ce9749c9fa 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml
@@ -27,30 +27,6 @@ DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a,
 
 == Optimized Execution Plan ==
 DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testExplainWithAgg[extended=true]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalProject(EXPR$0=[$1])
-+- LogicalAggregate(group=[{0}], EXPR$0=[COUNT()])
-   +- LogicalProject(a=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-
-== Optimized Physical Plan ==
-Calc(select=[EXPR$0], changelogMode=[I,UA]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS EXPR$0], changelogMode=[I,UA]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-   +- Exchange(distribution=[hash[a]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-      +- Calc(select=[a], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-
-== Optimized Execution Plan ==
-Calc(select=[EXPR$0])
-+- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS EXPR$0])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -111,6 +87,30 @@ Calc(select=[EXPR$0])
       +- Calc(select=[a])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 
+== Optimized Execution Plan ==
+Calc(select=[EXPR$0])
++- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS EXPR$0])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testExplainWithAgg[extended=true]">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalProject(EXPR$0=[$1])
++- LogicalAggregate(group=[{0}], EXPR$0=[COUNT()])
+   +- LogicalProject(a=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+
+== Optimized Physical Plan ==
+Calc(select=[EXPR$0], changelogMode=[I,UA]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS EXPR$0], changelogMode=[I,UA]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+   +- Exchange(distribution=[hash[a]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+      +- Calc(select=[a], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+
 == Optimized Execution Plan ==
 Calc(select=[EXPR$0])
 +- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS EXPR$0])
@@ -178,27 +178,6 @@ Calc(select=[a, b, c, e, f])
    :  +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
    +- Exchange(distribution=[hash[d]])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testExplainWithUnion[extended=true]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], b=[$1], c=[$2])
-:  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-+- LogicalProject(d=[$0], e=[$1], f=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-
-== Optimized Physical Plan ==
-Union(all=[true], union=[a, b, c], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-
-== Optimized Execution Plan ==
-Union(all=[true], union=[a, b, c])
-:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-+- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
@@ -403,7 +382,49 @@ SortLimit(orderBy=[a ASC], offset=[0], fetch=[5], strategy=[AppendFastStrategy])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMiniBatchIntervalInfer[extended=true]">
+  <TestCase name="testExplainWithUnion[extended=false]">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalUnion(all=[true])
+:- LogicalProject(a=[$0], b=[$1], c=[$2])
+:  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalProject(d=[$0], e=[$1], f=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+
+== Optimized Physical Plan ==
+Union(all=[true], union=[a, b, c])
+:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
++- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
+
+== Optimized Execution Plan ==
+Union(all=[true], union=[a, b, c])
+:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
++- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testExplainWithUnion[extended=true]">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalUnion(all=[true])
+:- LogicalProject(a=[$0], b=[$1], c=[$2])
+:  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalProject(d=[$0], e=[$1], f=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+
+== Optimized Physical Plan ==
+Union(all=[true], union=[a, b, c], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+
+== Optimized Execution Plan ==
+Union(all=[true], union=[a, b, c])
+:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
++- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testMiniBatchIntervalInfer[extended=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.appendSink1], fields=[id1, EXPR$1])
@@ -431,33 +452,33 @@ LogicalSink(table=[default_catalog.default_database.appendSink2], fields=[id1, E
                      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.appendSink1], fields=[id1, EXPR$1], changelogMode=[NONE]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-   +- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-      +- Calc(select=[id1, ts, text, _UTF-16LE'#' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-         +- Calc(select=[id1, rowtime AS ts, text], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                  +- Calc(select=[id2, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+Sink(table=[default_catalog.default_database.appendSink1], fields=[id1, EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
+   +- Exchange(distribution=[hash[id1]])
+      +- Calc(select=[id1, ts, text, _UTF-16LE'#' AS $f3])
+         +- Calc(select=[id1, rowtime AS ts, text])
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
+               :- Exchange(distribution=[hash[id1]])
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
+               +- Exchange(distribution=[hash[id2]])
+                  +- Calc(select=[id2, rowtime])
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
 
-Sink(table=[default_catalog.default_database.appendSink2], fields=[id1, EXPR$1], changelogMode=[NONE]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-   +- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-      +- Calc(select=[id1, ts, text, _UTF-16LE'*' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-         +- Calc(select=[id1, rowtime AS ts, text], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                  +- Calc(select=[id2, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+Sink(table=[default_catalog.default_database.appendSink2], fields=[id1, EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
+   +- Exchange(distribution=[hash[id1]])
+      +- Calc(select=[id1, ts, text, _UTF-16LE'*' AS $f3])
+         +- Calc(select=[id1, rowtime AS ts, text])
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
+               :- Exchange(distribution=[hash[id1]])
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
+               +- Exchange(distribution=[hash[id2]])
+                  +- Calc(select=[id2, rowtime])
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
 
 == Optimized Execution Plan ==
 Calc(select=[id1, rowtime AS ts, text])(reuse_id=[1])
@@ -484,28 +505,7 @@ Sink(table=[default_catalog.default_database.appendSink2], fields=[id1, EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExplainWithUnion[extended=false]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], b=[$1], c=[$2])
-:  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-+- LogicalProject(d=[$0], e=[$1], f=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-
-== Optimized Physical Plan ==
-Union(all=[true], union=[a, b, c])
-:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-+- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
-
-== Optimized Execution Plan ==
-Union(all=[true], union=[a, b, c])
-:- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-+- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMiniBatchIntervalInfer[extended=false]">
+  <TestCase name="testMiniBatchIntervalInfer[extended=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.appendSink1], fields=[id1, EXPR$1])
@@ -533,33 +533,33 @@ LogicalSink(table=[default_catalog.default_database.appendSink2], fields=[id1, E
                      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.appendSink1], fields=[id1, EXPR$1])
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
-   +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, ts, text, _UTF-16LE'#' AS $f3])
-         +- Calc(select=[id1, rowtime AS ts, text])
-            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
-               :- Exchange(distribution=[hash[id1]])
-               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
-               +- Exchange(distribution=[hash[id2]])
-                  +- Calc(select=[id2, rowtime])
-                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
+Sink(table=[default_catalog.default_database.appendSink1], fields=[id1, EXPR$1], changelogMode=[NONE]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+   +- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+      +- Calc(select=[id1, ts, text, _UTF-16LE'#' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+         +- Calc(select=[id1, rowtime AS ts, text], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                  +- Calc(select=[id2, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
-Sink(table=[default_catalog.default_database.appendSink2], fields=[id1, EXPR$1])
-+- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
-   +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, ts, text, _UTF-16LE'*' AS $f3])
-         +- Calc(select=[id1, rowtime AS ts, text])
-            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
-               :- Exchange(distribution=[hash[id1]])
-               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
-               +- Exchange(distribution=[hash[id2]])
-                  +- Calc(select=[id2, rowtime])
-                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
+Sink(table=[default_catalog.default_database.appendSink2], fields=[id1, EXPR$1], changelogMode=[NONE]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+   +- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+      +- Calc(select=[id1, ts, text, _UTF-16LE'*' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+         +- Calc(select=[id1, rowtime AS ts, text], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                  +- Calc(select=[id2, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
 == Optimized Execution Plan ==
 Calc(select=[id1, rowtime AS ts, text])(reuse_id=[1])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/GroupAggregationAnalyzerTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/GroupAggregationAnalyzerTest.xml
index 8acd1af1787..1f6609695ca 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/GroupAggregationAnalyzerTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/GroupAggregationAnalyzerTest.xml
@@ -477,15 +477,16 @@ advice[1]: [ADVICE] You might want to enable local-global two-phase optimization
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUserDefinedAggCalls[isMiniBatchEnabled=true, strategy=ONE_PHASE, miniBatchLatency=10, miniBatchSize=5]">
+  <TestCase name="testUserDefinedAggCalls[isMiniBatchEnabled=true, strategy=AUTO, miniBatchLatency=10, miniBatchSize=5]">
     <Resource name="optimized rel plan with advice">
       <![CDATA[
 Sink(table=[default_catalog.default_database.MySink1], fields=[avg_a_1])
 +- Calc(select=[CAST(avg_a_1 AS DOUBLE) AS avg_a_1])
-   +- GroupAggregate(advice=[1], select=[weightedAvg(a, d) AS avg_a_1])
+   +- GlobalGroupAggregate(select=[weightedAvg(weightedavg$0) AS avg_a_1])
       +- Exchange(distribution=[single])
-         +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, d], metadata=[]]], fields=[a, d])
+         +- LocalGroupAggregate(select=[weightedAvg(a, d) AS weightedavg$0])
+            +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, d], metadata=[]]], fields=[a, d])
 
 Sink(table=[default_catalog.default_database.MySink2], fields=[avg_a_1, avg_a_2])
 +- Calc(select=[CAST(avg_a_1 AS DOUBLE) AS avg_a_1, CAST(avg_a_2 AS DOUBLE) AS avg_a_2])
@@ -494,21 +495,20 @@ Sink(table=[default_catalog.default_database.MySink2], fields=[avg_a_1, avg_a_2]
          +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, d], metadata=[]]], fields=[a, d])
 
-advice[1]: [ADVICE] You might want to enable local-global two-phase optimization by configuring ('table.optimizer.agg-phase-strategy' to 'AUTO').
+No available advice...
 
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUserDefinedAggCalls[isMiniBatchEnabled=true, strategy=AUTO, miniBatchLatency=10, miniBatchSize=5]">
+  <TestCase name="testUserDefinedAggCalls[isMiniBatchEnabled=true, strategy=ONE_PHASE, miniBatchLatency=10, miniBatchSize=5]">
     <Resource name="optimized rel plan with advice">
       <![CDATA[
 Sink(table=[default_catalog.default_database.MySink1], fields=[avg_a_1])
 +- Calc(select=[CAST(avg_a_1 AS DOUBLE) AS avg_a_1])
-   +- GlobalGroupAggregate(select=[weightedAvg(weightedavg$0) AS avg_a_1])
+   +- GroupAggregate(advice=[1], select=[weightedAvg(a, d) AS avg_a_1])
       +- Exchange(distribution=[single])
-         +- LocalGroupAggregate(select=[weightedAvg(a, d) AS weightedavg$0])
-            +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, d], metadata=[]]], fields=[a, d])
+         +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, d], metadata=[]]], fields=[a, d])
 
 Sink(table=[default_catalog.default_database.MySink2], fields=[avg_a_1, avg_a_2])
 +- Calc(select=[CAST(avg_a_1 AS DOUBLE) AS avg_a_1, CAST(avg_a_2 AS DOUBLE) AS avg_a_2])
@@ -517,7 +517,7 @@ Sink(table=[default_catalog.default_database.MySink2], fields=[avg_a_1, avg_a_2]
          +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, d], metadata=[]]], fields=[a, d])
 
-No available advice...
+advice[1]: [ADVICE] You might want to enable local-global two-phase optimization by configuring ('table.optimizer.agg-phase-strategy' to 'AUTO').
 
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/NonDeterministicUpdateAnalyzerTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/NonDeterministicUpdateAnalyzerTest.xml
index dc45a0b5c9d..e5af8e1f753 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/NonDeterministicUpdateAnalyzerTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/analyze/NonDeterministicUpdateAnalyzerTest.xml
@@ -38,24 +38,6 @@ LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[Inner
 +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c], changelogMode=[I,UB,UA,D], upsertKeys=[[a]])
 
 
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCdcWithMetaSinkWithPk">
-    <Resource name="sql">
-      <![CDATA[insert into sink_with_pk
-select a, metadata_3, c
-from cdc_with_meta]]>
-    </Resource>
-    <Resource name="optimized rel plan with advice">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
-+- Calc(select=[a, metadata_3, c])
-   +- DropUpdateBefore
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
-
-No available advice...
-
 ]]>
     </Resource>
   </TestCase>
@@ -115,6 +97,24 @@ source node:
 TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta_rename, project=[a, b, c], metadata=[metadata_3]]], fields=[a, b, c, metadata_3], changelogMode=[I,UB,UA,D], upsertKeys=[[a]])
 
 
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCdcWithMetaSinkWithPk">
+    <Resource name="sql">
+      <![CDATA[insert into sink_with_pk
+select a, metadata_3, c
+from cdc_with_meta]]>
+    </Resource>
+    <Resource name="optimized rel plan with advice">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
++- Calc(select=[a, metadata_3, c])
+   +- DropUpdateBefore
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
+
+No available advice...
+
 ]]>
     </Resource>
   </TestCase>
@@ -145,29 +145,6 @@ Calc(select=[DATE_FORMAT(CURRENT_TIMESTAMP(), _UTF-16LE'yyMMdd') AS day, a], cha
 +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a], metadata=[]]], fields=[a], changelogMode=[I,UB,UA,D], upsertKeys=[[a]])
 
 
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSourceWithComputedColumnSinkWithPk">
-    <Resource name="sql">
-      <![CDATA[insert into sink_with_pk
-select a, b, `day`
-from cdc_with_computed_col
-where b > 100]]>
-    </Resource>
-    <Resource name="optimized rel plan with advice">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, day], upsertMaterialize=[true])
-+- Calc(select=[a, b, DATE_FORMAT(CURRENT_TIMESTAMP(), 'yyMMdd') AS day], where=[>(b, 100)])
-   +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_computed_col, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
-
-advice[1]: [WARNING] The column(s): day(generated by non-deterministic function: CURRENT_TIMESTAMP ) can not satisfy the determinism requirement for correctly processing update message('UB'/'UA'/'D' in changelogMode, not 'I' only), this usually happens when input node has no upsertKey(upsertKeys=[{}]) or current node outputs non-deterministic update messages. Please consider removing these non-deterministic columns or making them deterministic by using deterministic functions.
-
-related rel plan:
-Calc(select=[a, b, DATE_FORMAT(CURRENT_TIMESTAMP(), _UTF-16LE'yyMMdd') AS day], where=[>(b, 100)], changelogMode=[I,UB,UA,D])
-+- TableSourceScan(table=[[default_catalog, default_database, cdc_with_computed_col, filter=[], project=[a, b], metadata=[]]], fields=[a, b], changelogMode=[I,UB,UA,D])
-
-
 ]]>
     </Resource>
   </TestCase>
@@ -203,6 +180,29 @@ Calc(select=[a, DATE_FORMAT(CURRENT_TIMESTAMP(), _UTF-16LE'yyMMdd') AS day], cha
 +- TableSourceScan(table=[[default_catalog, default_database, src1, project=[a], metadata=[]]], fields=[a], changelogMode=[I,UB,UA,D])
 
 
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSourceWithComputedColumnSinkWithPk">
+    <Resource name="sql">
+      <![CDATA[insert into sink_with_pk
+select a, b, `day`
+from cdc_with_computed_col
+where b > 100]]>
+    </Resource>
+    <Resource name="optimized rel plan with advice">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, day], upsertMaterialize=[true])
++- Calc(select=[a, b, DATE_FORMAT(CURRENT_TIMESTAMP(), 'yyMMdd') AS day], where=[>(b, 100)])
+   +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_computed_col, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
+
+advice[1]: [WARNING] The column(s): day(generated by non-deterministic function: CURRENT_TIMESTAMP ) can not satisfy the determinism requirement for correctly processing update message('UB'/'UA'/'D' in changelogMode, not 'I' only), this usually happens when input node has no upsertKey(upsertKeys=[{}]) or current node outputs non-deterministic update messages. Please consider removing these non-deterministic columns or making them deterministic by using deterministic functions.
+
+related rel plan:
+Calc(select=[a, b, DATE_FORMAT(CURRENT_TIMESTAMP(), _UTF-16LE'yyMMdd') AS day], where=[>(b, 100)], changelogMode=[I,UB,UA,D])
++- TableSourceScan(table=[[default_catalog, default_database, cdc_with_computed_col, filter=[], project=[a, b], metadata=[]]], fields=[a, b], changelogMode=[I,UB,UA,D])
+
+
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml
index b6373f1ef02..3cb0ff64a9a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml
@@ -106,6 +106,24 @@ GroupWindowAggregate(window=[TumblingGroupWindow('w$, rowtime, 600000)], select=
 +- Exchange(distribution=[single])
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 5000:INTERVAL SECOND)])
       +- TableSourceScan(table=[[testCatalog, default, testTable, project=[rowtime], metadata=[]]], fields=[rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testResolvingSchemaOfCustomCatalogTableTableApi[streamingMode = false]">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$0])
++- LogicalWindowAggregate(group=[{}], EXPR$0=[COUNT()], window=[TumblingGroupWindow('w, rowtime, 600000)], properties=[])
+   +- LogicalProject(count=[$0], rowtime=[$1], proctime=[PROCTIME()], $f3=[1])
+      +- LogicalTableScan(table=[[testCatalog, default, testTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 600000)], select=[Final_COUNT(count1$0) AS EXPR$0])
++- Exchange(distribution=[single])
+   +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 600000)], select=[Partial_COUNT(*) AS count1$0])
+      +- TableSourceScan(table=[[testCatalog, default, testTable]], fields=[count, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -130,21 +148,29 @@ GroupWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 600000)], select=[
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testResolvingSchemaOfCustomCatalogTableTableApi[streamingMode = false]">
+  <TestCase name="testTimeAttributeOfViewSelect[streamingMode = true]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM `cat`.`default`.v]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[$0])
-+- LogicalWindowAggregate(group=[{}], EXPR$0=[COUNT()], window=[TumblingGroupWindow('w, rowtime, 600000)], properties=[])
-   +- LogicalProject(count=[$0], rowtime=[$1], proctime=[PROCTIME()], $f3=[1])
-      +- LogicalTableScan(table=[[testCatalog, default, testTable]])
+LogicalProject(order_id=[$0], customer_id=[$1], product_id=[$2], ts=[$3])
++- LogicalProject(order_id=[$0], customer_id=[$1], product_id=[$5], ts=[$4])
+   +- LogicalCorrelate(correlation=[$cor2], joinType=[inner], requiredColumns=[{3}])
+      :- LogicalWatermarkAssigner(rowtime=[ts], watermark=[$4])
+      :  +- LogicalTableScan(table=[[cat, default, t]])
+      +- LogicalProject(product_id=[$0])
+         +- Uncollect
+            +- LogicalProject(product_ids=[$cor2.product_ids])
+               +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 600000)], select=[Final_COUNT(count1$0) AS EXPR$0])
-+- Exchange(distribution=[single])
-   +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 600000)], select=[Partial_COUNT(*) AS count1$0])
-      +- TableSourceScan(table=[[testCatalog, default, testTable]], fields=[count, rowtime])
+Calc(select=[order_id, customer_id, f0 AS product_id, ts])
++- Correlate(invocation=[$UNNEST_ROWS$1($cor2.product_ids)], correlate=[table($UNNEST_ROWS$1($cor2.product_ids))], select=[order_id,customer_id,product_id,product_ids,ts,f0], rowType=[RecordType(INTEGER order_id, INTEGER customer_id, INTEGER product_id, INTEGER ARRAY product_ids, TIMESTAMP_LTZ(3) *ROWTIME* ts, INTEGER f0)], joinType=[INNER])
+   +- WatermarkAssigner(rowtime=[ts], watermark=[ts])
+      +- TableSourceScan(table=[[cat, default, t]], fields=[order_id, customer_id, product_id, product_ids, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -176,32 +202,6 @@ Calc(select=[EXPR$0, window_start])
       +- LocalWindowAggregate(window=[TUMBLE(time_col=[ts], size=[10 min])], select=[SUM(i) AS sum$0, slice_end('w$) AS $slice_end])
          +- WatermarkAssigner(rowtime=[ts], watermark=[ts])
             +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, ts])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTimeAttributeOfViewSelect[streamingMode = true]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM `cat`.`default`.v]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(order_id=[$0], customer_id=[$1], product_id=[$2], ts=[$3])
-+- LogicalProject(order_id=[$0], customer_id=[$1], product_id=[$5], ts=[$4])
-   +- LogicalCorrelate(correlation=[$cor2], joinType=[inner], requiredColumns=[{3}])
-      :- LogicalWatermarkAssigner(rowtime=[ts], watermark=[$4])
-      :  +- LogicalTableScan(table=[[cat, default, t]])
-      +- LogicalProject(product_id=[$0])
-         +- Uncollect
-            +- LogicalProject(product_ids=[$cor2.product_ids])
-               +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[order_id, customer_id, f0 AS product_id, ts])
-+- Correlate(invocation=[$UNNEST_ROWS$1($cor2.product_ids)], correlate=[table($UNNEST_ROWS$1($cor2.product_ids))], select=[order_id,customer_id,product_id,product_ids,ts,f0], rowType=[RecordType(INTEGER order_id, INTEGER customer_id, INTEGER product_id, INTEGER ARRAY product_ids, TIMESTAMP_LTZ(3) *ROWTIME* ts, INTEGER f0)], joinType=[INNER])
-   +- WatermarkAssigner(rowtime=[ts], watermark=[ts])
-      +- TableSourceScan(table=[[cat, default, t]], fields=[order_id, customer_id, product_id, product_ids, ts])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearLookupJoinHintsWithInvalidPropagationShuttleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearLookupJoinHintsWithInvalidPropagationShuttleTest.xml
index 5a2a11c24cb..3e444624804 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearLookupJoinHintsWithInvalidPropagationShuttleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearLookupJoinHintsWithInvalidPropagationShuttleTest.xml
@@ -16,41 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testNoNeedToClearLookupHint">
-    <Resource name="beforePropagatingHints">
-      <![CDATA[
-LogicalProject(a=[$0], hints=[[[ALIAS options:[t1]]]]), rowType=[RecordType(BIGINT a)]
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1}]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts, BIGINT a0)]
-   :- LogicalProject(a=[$0], ds=[$1], pts=[PROCTIME()]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts)]
-   :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
-   +- LogicalFilter(condition=[=($cor0.a, $0)]), rowType=[RecordType(BIGINT a)]
-      +- LogicalSnapshot(period=[PROCTIME()]), rowType=[RecordType(BIGINT a)]
-         +- LogicalTableScan(table=[[builtin, default, lookup]]), rowType=[RecordType(BIGINT a)]
-]]>
-    </Resource>
-    <Resource name="afterPropagatingHints">
-      <![CDATA[
-LogicalProject(a=[$0], hints=[[[ALIAS options:[t1]]]]), rowType=[RecordType(BIGINT a)]
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]], hints=[[[ALIAS inheritPath:[0] options:[t1]]]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts, BIGINT a0)]
-   :- LogicalProject(a=[$0], ds=[$1], pts=[PROCTIME()]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts)]
-   :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
-   +- LogicalFilter(condition=[=($cor0.a, $0)]), rowType=[RecordType(BIGINT a)]
-      +- LogicalSnapshot(period=[PROCTIME()]), rowType=[RecordType(BIGINT a)]
-         +- LogicalTableScan(table=[[builtin, default, lookup]]), rowType=[RecordType(BIGINT a)]
-]]>
-    </Resource>
-    <Resource name="afterClearingJoinHints">
-      <![CDATA[
-LogicalProject(a=[$0], hints=[[[ALIAS options:[t1]]]]), rowType=[RecordType(BIGINT a)]
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]], hints=[[[ALIAS inheritPath:[0] options:[t1]]]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts, BIGINT a0)]
-   :- LogicalProject(a=[$0], ds=[$1], pts=[PROCTIME()]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts)]
-   :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
-   +- LogicalFilter(condition=[=($cor0.a, $0)]), rowType=[RecordType(BIGINT a)]
-      +- LogicalSnapshot(period=[PROCTIME()]), rowType=[RecordType(BIGINT a)]
-         +- LogicalTableScan(table=[[builtin, default, lookup]]), rowType=[RecordType(BIGINT a)]
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testClearLookupHintWithInvalidPropagationToSubQuery">
     <Resource name="beforePropagatingHints">
       <![CDATA[
@@ -98,38 +63,38 @@ LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoNeedToClearLookupHintWhileJoinWithUnnest">
+  <TestCase name="testNoNeedToClearLookupHint">
     <Resource name="beforePropagatingHints">
       <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
+LogicalProject(a=[$0], hints=[[[ALIAS options:[t1]]]]), rowType=[RecordType(BIGINT a)]
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1}]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts, BIGINT a0)]
+   :- LogicalProject(a=[$0], ds=[$1], pts=[PROCTIME()]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts)]
    :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
-   +- Uncollect, rowType=[RecordType(BIGINT a)]
-      +- LogicalProject($f0=[$cor0.ds]), rowType=[RecordType(BIGINT ARRAY $f0)]
-         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+   +- LogicalFilter(condition=[=($cor0.a, $0)]), rowType=[RecordType(BIGINT a)]
+      +- LogicalSnapshot(period=[PROCTIME()]), rowType=[RecordType(BIGINT a)]
+         +- LogicalTableScan(table=[[builtin, default, lookup]]), rowType=[RecordType(BIGINT a)]
 ]]>
     </Resource>
     <Resource name="afterPropagatingHints">
       <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
+LogicalProject(a=[$0], hints=[[[ALIAS options:[t1]]]]), rowType=[RecordType(BIGINT a)]
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]], hints=[[[ALIAS inheritPath:[0] options:[t1]]]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts, BIGINT a0)]
+   :- LogicalProject(a=[$0], ds=[$1], pts=[PROCTIME()]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts)]
    :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
-   +- Uncollect, rowType=[RecordType(BIGINT a)]
-      +- LogicalProject($f0=[$cor0.ds]), rowType=[RecordType(BIGINT ARRAY $f0)]
-         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+   +- LogicalFilter(condition=[=($cor0.a, $0)]), rowType=[RecordType(BIGINT a)]
+      +- LogicalSnapshot(period=[PROCTIME()]), rowType=[RecordType(BIGINT a)]
+         +- LogicalTableScan(table=[[builtin, default, lookup]]), rowType=[RecordType(BIGINT a)]
 ]]>
     </Resource>
     <Resource name="afterClearingJoinHints">
       <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
+LogicalProject(a=[$0], hints=[[[ALIAS options:[t1]]]]), rowType=[RecordType(BIGINT a)]
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]], hints=[[[ALIAS inheritPath:[0] options:[t1]]]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts, BIGINT a0)]
+   :- LogicalProject(a=[$0], ds=[$1], pts=[PROCTIME()]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds, TIMESTAMP_LTZ(3) *PROCTIME* pts)]
    :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
-   +- Uncollect, rowType=[RecordType(BIGINT a)]
-      +- LogicalProject($f0=[$cor0.ds]), rowType=[RecordType(BIGINT ARRAY $f0)]
-         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+   +- LogicalFilter(condition=[=($cor0.a, $0)]), rowType=[RecordType(BIGINT a)]
+      +- LogicalSnapshot(period=[PROCTIME()]), rowType=[RecordType(BIGINT a)]
+         +- LogicalTableScan(table=[[builtin, default, lookup]]), rowType=[RecordType(BIGINT a)]
 ]]>
     </Resource>
   </TestCase>
@@ -159,6 +124,41 @@ LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
    :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
    :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
    +- LogicalTableFunctionScan(invocation=[TABLE($cor0.b)], rowType=[RecordType(BIGINT b)]), rowType=[RecordType(BIGINT b)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNoNeedToClearLookupHintWhileJoinWithUnnest">
+    <Resource name="beforePropagatingHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
+   +- Uncollect, rowType=[RecordType(BIGINT a)]
+      +- LogicalProject($f0=[$cor0.ds]), rowType=[RecordType(BIGINT ARRAY $f0)]
+         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+]]>
+    </Resource>
+    <Resource name="afterPropagatingHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
+   +- Uncollect, rowType=[RecordType(BIGINT a)]
+      +- LogicalProject($f0=[$cor0.ds]), rowType=[RecordType(BIGINT ARRAY $f0)]
+         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+]]>
+    </Resource>
+    <Resource name="afterClearingJoinHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=d, timeout=300 s, capacity=1000}]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalTableScan(table=[[builtin, default, src]]), rowType=[RecordType(BIGINT a, BIGINT ARRAY ds)]
+   +- Uncollect, rowType=[RecordType(BIGINT a)]
+      +- LogicalProject($f0=[$cor0.ds]), rowType=[RecordType(BIGINT ARRAY $f0)]
+         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearStateTtlHintsWithInvalidPropagationShuttleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearStateTtlHintsWithInvalidPropagationShuttleTest.xml
index e33b11a557b..8501fb5ed8c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearStateTtlHintsWithInvalidPropagationShuttleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/hint/ClearStateTtlHintsWithInvalidPropagationShuttleTest.xml
@@ -47,52 +47,6 @@ LogicalAggregate(group=[{0}], max=[MAX($1)], stateTtlHints=[[[STATE_TTL options:
 +- LogicalProject(a=[$0], cnt=[$2]), rowType=[RecordType(BIGINT a, BIGINT cnt)]
    +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)], stateTtlHints=[[[STATE_TTL options:{t4=1d}]]], hints=[[[ALIAS options:[tmp]]]]), rowType=[RecordType(BIGINT a, BIGINT b, BIGINT cnt)]
       +- LogicalTableScan(table=[[builtin, default, t4]]), rowType=[RecordType(BIGINT a, BIGINT b, BIGINT c)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testNoNeedToClearStateTtlHintOnJoin">
-    <Resource name="beforePropagatingHints">
-      <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
-   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
-   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
-   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
-]]>
-    </Resource>
-    <Resource name="afterPropagatingHints">
-      <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
-   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner], stateTtlHints=[[[StaTe_TtL inheritPath:[0] options:{t1=1d, t2=7d}]]], hints=[[[ALIAS inheritPath:[0] options:[t4]]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
-   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
-   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
-]]>
-    </Resource>
-    <Resource name="afterCapitalizeJoinHints">
-      <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
-   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner], stateTtlHints=[[[STATE_TTL inheritPath:[0] options:{t1=1d, t2=7d}]]], hints=[[[ALIAS inheritPath:[0] options:[t4]]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
-   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
-   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
-]]>
-    </Resource>
-    <Resource name="afterClearingJoinHints">
-      <![CDATA[
-LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
-+- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
-   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner], stateTtlHints=[[[STATE_TTL inheritPath:[0] options:{t1=1d, t2=7d}]]], hints=[[[ALIAS inheritPath:[0] options:[t4]]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
-   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
-   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
-   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
 ]]>
     </Resource>
   </TestCase>
@@ -173,6 +127,52 @@ LogicalAggregate(group=[{0}], max=[MAX($1)]), rowType=[RecordType(BIGINT a, BIGI
 +- LogicalProject(a=[$0], cnt=[$2]), rowType=[RecordType(BIGINT a, BIGINT cnt)]
    +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)], stateTtlHints=[[[STATE_TTL options:{t4=1d}]]], hints=[[[ALIAS options:[tmp]]]]), rowType=[RecordType(BIGINT a, BIGINT b, BIGINT cnt)]
       +- LogicalTableScan(table=[[builtin, default, t4]]), rowType=[RecordType(BIGINT a, BIGINT b, BIGINT c)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNoNeedToClearStateTtlHintOnJoin">
+    <Resource name="beforePropagatingHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
+   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
+   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
+]]>
+    </Resource>
+    <Resource name="afterPropagatingHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner], stateTtlHints=[[[StaTe_TtL inheritPath:[0] options:{t1=1d, t2=7d}]]], hints=[[[ALIAS inheritPath:[0] options:[t4]]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
+   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
+   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
+]]>
+    </Resource>
+    <Resource name="afterCapitalizeJoinHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner], stateTtlHints=[[[STATE_TTL inheritPath:[0] options:{t1=1d, t2=7d}]]], hints=[[[ALIAS inheritPath:[0] options:[t4]]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
+   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
+   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
+]]>
+    </Resource>
+    <Resource name="afterClearingJoinHints">
+      <![CDATA[
+LogicalProject(a=[$0]), rowType=[RecordType(BIGINT a)]
++- LogicalJoin(condition=[=($0, $1)], joinType=[inner]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :- LogicalProject(a=[$0], hints=[[[ALIAS options:[t4]]]]), rowType=[RecordType(BIGINT a)]
+   :  +- LogicalJoin(condition=[=($0, $1)], joinType=[inner], stateTtlHints=[[[STATE_TTL inheritPath:[0] options:{t1=1d, t2=7d}]]], hints=[[[ALIAS inheritPath:[0] options:[t4]]]]), rowType=[RecordType(BIGINT a, BIGINT a0)]
+   :     :- LogicalTableScan(table=[[builtin, default, t1]]), rowType=[RecordType(BIGINT a)]
+   :     +- LogicalTableScan(table=[[builtin, default, t2]]), rowType=[RecordType(BIGINT a)]
+   +- LogicalTableScan(table=[[builtin, default, t3]]), rowType=[RecordType(BIGINT a)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/BatchSinkReuseTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/BatchSinkReuseTest.xml
index f3c33920f69..a1f60012f63 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/BatchSinkReuseTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/BatchSinkReuseTest.xml
@@ -16,9 +16,9 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testSinkReuse">
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testSinkReuse">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -35,9 +35,9 @@ LogicalSink(table=[default_catalog.default_database.sink2], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source4]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
@@ -48,11 +48,11 @@ Sink(table=[default_catalog.default_database.sink2], fields=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source3]], fields=[x, y])
    +- TableSourceScan(table=[[default_catalog, default_database, source4]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseFromSameSource">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseFromSameSource">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -61,19 +61,19 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])(reuse_id=[1])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithDifferentFieldNames">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithDifferentFieldNames">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -82,75 +82,75 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x1, y1])
 +- LogicalProject(x1=[$0], y1=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, filed_name_change_source]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
    +- TableSourceScan(table=[[default_catalog, default_database, filed_name_change_source]], fields=[x1, y1])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithOverwrite">
-		<Resource name="ast">
-			<![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithHint">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
 
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore2}]]])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source2]])
 
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
    +- TableSourceScan(table=[[default_catalog, default_database, source3]], fields=[x, y])
 
-Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
+Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore2}]]])
 +- TableSourceScan(table=[[default_catalog, default_database, source2]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithHint">
-		<Resource name="ast">
-			<![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithOverwrite">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
 
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore2}]]])
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source2]])
 
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
    +- TableSourceScan(table=[[default_catalog, default_database, source3]], fields=[x, y])
 
-Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore2}]]])
+Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- TableSourceScan(table=[[default_catalog, default_database, source2]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithPartialColumns">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithPartialColumns">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], targetColumns=[[0]], fields=[x, EXPR$1])
 +- LogicalProject(x=[$0], EXPR$1=[null:BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -163,9 +163,9 @@ LogicalSink(table=[default_catalog.default_database.sink1], targetColumns=[[0]],
 +- LogicalProject(x=[$0], EXPR$1=[null:BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, source3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 TableSourceScan(table=[[default_catalog, default_database, source1, project=[x, y], metadata=[]]], fields=[x, y])(reuse_id=[1])
 
 Sink(table=[default_catalog.default_database.sink1], targetColumns=[[0]], fields=[x, EXPR$1])
@@ -179,33 +179,11 @@ Sink(table=[default_catalog.default_database.sink1], targetColumns=[[1]], fields
 +- Calc(select=[null:BIGINT AS EXPR$0, y])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithTypeCoercionSource">
-		<Resource name="ast">
-			<![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
-+- LogicalProject(x=[$0], y=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
-
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
-+- LogicalProject(x=[CAST($0):BIGINT], y=[CAST($1):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, type_coercion_source]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
-+- Union(all=[true], union=[x, y])
-   :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
-   +- Calc(select=[CAST(x AS BIGINT) AS x, CAST(y AS BIGINT) AS y])
-      +- TableSourceScan(table=[[default_catalog, default_database, type_coercion_source]], fields=[x, y])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithPartition">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithPartition">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.partitionedSink], fields=[EXPR$0, y])
 +- LogicalProject(EXPR$0=[1:BIGINT], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -222,9 +200,9 @@ LogicalSink(table=[default_catalog.default_database.partitionedSink], fields=[x,
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source4]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.partitionedSink], fields=[EXPR$0, y])
 +- Union(all=[true], union=[EXPR$0, y])
    :- Calc(select=[1 AS EXPR$0, y])
@@ -240,6 +218,28 @@ Sink(table=[default_catalog.default_database.partitionedSink], fields=[x, y])
 +- Sort(orderBy=[x ASC])
    +- TableSourceScan(table=[[default_catalog, default_database, source4]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithTypeCoercionSource">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
++- LogicalProject(x=[$0], y=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
+
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
++- LogicalProject(x=[CAST($0):BIGINT], y=[CAST($1):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, type_coercion_source]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
++- Union(all=[true], union=[x, y])
+   :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
+   +- Calc(select=[CAST(x AS BIGINT) AS x, CAST(y AS BIGINT) AS y])
+      +- TableSourceScan(table=[[default_catalog, default_database, type_coercion_source]], fields=[x, y])
+]]>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcMergeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcMergeTest.xml
index 06f29420cee..b6bc21cd326 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcMergeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcMergeTest.xml
@@ -16,26 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCalcMergeWithTopMultiNonDeterministicExpr">
-    <Resource name="sql">
-      <![CDATA[SELECT random_udf(a1) as a2, random_udf(a1) as a3 FROM (SELECT random_udf(a) as a1, b FROM MyTable) t WHERE b > 10]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a2=[random_udf($0)], a3=[random_udf($0)])
-+- LogicalFilter(condition=[>($1, 10)])
-   +- LogicalProject(a1=[random_udf($0)], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[random_udf(a1) AS a2, random_udf(a1) AS a3])
-+- Calc(select=[random_udf(a) AS a1, b], where=[(b > 10)])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testCalcMergeTopFilterHasNonDeterministicExpr">
     <Resource name="sql">
       <![CDATA[SELECT a, c FROM (SELECT a, random_udf(b) as b1, c FROM MyTable) t WHERE b1 > 10]]>
@@ -169,6 +149,26 @@ LogicalProject(a=[$0], b=[$1])
       <![CDATA[
 Calc(select=[a, b], where=[(a = b)])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalcMergeWithTopMultiNonDeterministicExpr">
+    <Resource name="sql">
+      <![CDATA[SELECT random_udf(a1) as a2, random_udf(a1) as a3 FROM (SELECT random_udf(a) as a1, b FROM MyTable) t WHERE b > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a2=[random_udf($0)], a3=[random_udf($0)])
++- LogicalFilter(condition=[>($1, 10)])
+   +- LogicalProject(a1=[random_udf($0)], b=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[random_udf(a1) AS a2, random_udf(a1) AS a3])
++- Calc(select=[random_udf(a) AS a1, b], where=[(b > 10)])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml
index b7ab117c336..ec4dfbdbdaf 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml
@@ -30,6 +30,37 @@ LogicalProject(EXPR$0=[ARRAY(_UTF-16LE'Hi':VARCHAR(2147483647) CHARACTER SET "UT
       <![CDATA[
 Calc(select=[ARRAY('Hi', 'Hello', c) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalcMergeWithCorrelate">
+    <Resource name="sql">
+      <![CDATA[
+SELECT a, r FROM (
+ SELECT a, random_udf(b) r FROM (
+  select a, b, c1 FROM MyTable, LATERAL TABLE(str_split(c)) AS T(c1)
+ ) t
+)
+WHERE r > 10
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], r=[$1])
++- LogicalFilter(condition=[>($1, 10)])
+   +- LogicalProject(a=[$0], r=[random_udf($1)])
+      +- LogicalProject(a=[$0], b=[$1], c1=[$3])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+            :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+            +- LogicalTableFunctionScan(invocation=[str_split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, r], where=[>(r, 10)])
++- Calc(select=[a, random_udf(b) AS r])
+   +- Correlate(invocation=[str_split($cor0.c)], correlate=[table(str_split($cor0.c))], select=[a,b,c,EXPR$0], rowType=[RecordType(BIGINT a, INTEGER b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -69,37 +100,6 @@ LogicalProject(a=[$0])
       <![CDATA[
 Calc(select=[a], where=[>(random_udf(b), 10)])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCalcMergeWithCorrelate">
-    <Resource name="sql">
-      <![CDATA[
-SELECT a, r FROM (
- SELECT a, random_udf(b) r FROM (
-  select a, b, c1 FROM MyTable, LATERAL TABLE(str_split(c)) AS T(c1)
- ) t
-)
-WHERE r > 10
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], r=[$1])
-+- LogicalFilter(condition=[>($1, 10)])
-   +- LogicalProject(a=[$0], r=[random_udf($1)])
-      +- LogicalProject(a=[$0], b=[$1], c1=[$3])
-         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-            :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-            +- LogicalTableFunctionScan(invocation=[str_split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, r], where=[>(r, 10)])
-+- Calc(select=[a, random_udf(b) AS r])
-   +- Correlate(invocation=[str_split($cor0.c)], correlate=[table(str_split($cor0.c))], select=[a,b,c,EXPR$0], rowType=[RecordType(BIGINT a, INTEGER b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -282,23 +282,6 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
       <![CDATA[
 Calc(select=[a, b, c], where=[((b > 0) AND (a < 50))])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultipleFlattening">
-    <Resource name="sql">
-      <![CDATA[SELECT MyTable2.a.*, c, MyTable2.b.* FROM MyTable2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(_1=[$0._1], _2=[$0._2], c=[$2], _10=[$1._1], _20=[$1._2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a._1 AS _1, a._2 AS _2, c, b._1 AS _10, b._2 AS _20])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -320,37 +303,36 @@ Calc(select=[c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonPrimitiveMapType">
+  <TestCase name="testMultipleFlattening">
     <Resource name="sql">
-      <![CDATA[SELECT MAP[a, c] FROM MyTable]]>
+      <![CDATA[SELECT MyTable2.a.*, c, MyTable2.b.* FROM MyTable2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[MAP($0, $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(_1=[$0._1], _2=[$0._2], c=[$2], _10=[$1._1], _20=[$1._2])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[MAP(a, c) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Calc(select=[a._1 AS _1, a._2 AS _2, c, b._1 AS _10, b._2 AS _20])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOrWithIsNullPredicate">
+  <TestCase name="testNonPrimitiveMapType">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 10 OR a IS NULL]]>
+      <![CDATA[SELECT MAP[a, c] FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 10), IS NULL($0))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[MAP($0, $2)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c], where=[SEARCH(a, Sarg[1, 10; NULL AS TRUE])])
+Calc(select=[MAP(a, c) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -408,37 +390,37 @@ Calc(select=[a, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectAndFilter">
+  <TestCase name="testOrWithIsNullInIf">
     <Resource name="sql">
-      <![CDATA[SELECT a, b + 1 FROM MyTable WHERE b > 2]]>
+      <![CDATA[SELECT IF(c = '' OR c IS NULL, 'a', 'b') FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[+($1, 1)])
-+- LogicalFilter(condition=[>($1, 2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[IF(SEARCH($2, Sarg[_UTF-16LE'':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"; NULL AS TRUE]:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), _UTF-16LE'a', _UTF-16LE'b')])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, (b + 1) AS EXPR$1], where=[(b > 2)])
+Calc(select=[IF(SEARCH(c, Sarg[_UTF-16LE''; NULL AS TRUE]), 'a', 'b') AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOrWithIsNullInIf">
+  <TestCase name="testOrWithIsNullPredicate">
     <Resource name="sql">
-      <![CDATA[SELECT IF(c = '' OR c IS NULL, 'a', 'b') FROM MyTable]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 10 OR a IS NULL]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[IF(SEARCH($2, Sarg[_UTF-16LE'':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"; NULL AS TRUE]:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), _UTF-16LE'a', _UTF-16LE'b')])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 10), IS NULL($0))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[IF(SEARCH(c, Sarg[_UTF-16LE''; NULL AS TRUE]), 'a', 'b') AS EXPR$0])
+Calc(select=[a, b, c], where=[SEARCH(a, Sarg[1, 10; NULL AS TRUE])])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -473,6 +455,24 @@ LogicalProject(EXPR$0=[MAP($1, 30:BIGINT, 10, $0)])
       <![CDATA[
 Calc(select=[MAP(b, 30, 10, a) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProjectAndFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b + 1 FROM MyTable WHERE b > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], EXPR$1=[+($1, 1)])
++- LogicalFilter(condition=[>($1, 2)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, (b + 1) AS EXPR$1], where=[(b > 2)])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml
index ebdf3c2d037..5655ebb813e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml
@@ -575,40 +575,6 @@ Sink(table=[default_catalog.default_database.sink2], fields=[total_min])
    +- Exchange(distribution=[single])
       +- LocalHashAggregate(select=[Partial_MIN(a) AS min$0])
          +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultiSinksWithWindow">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[a, sum_c, time, window_start, window_end])
-+- LogicalProject(a=[$1], sum_c=[$2], time=[TUMBLE_END($0)], window_start=[TUMBLE_START($0)], window_end=[TUMBLE_END($0)])
-   +- LogicalAggregate(group=[{0, 1}], sum_c=[SUM($2)])
-      +- LogicalProject($f0=[$TUMBLE($3, 15000:INTERVAL SECOND)], a=[$0], $f2=[CAST($2):DOUBLE])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-
-LogicalSink(table=[default_catalog.default_database.sink2], fields=[a, sum_c, time])
-+- LogicalProject(a=[$1], sum_c=[$2], time=[TUMBLE_END($0)])
-   +- LogicalAggregate(group=[{0, 1}], sum_c=[SUM($2)])
-      +- LogicalProject($f0=[$TUMBLE($3, 15000:INTERVAL SECOND)], a=[$0], $f2=[CAST($2):DOUBLE])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashWindowAggregate(groupBy=[a], window=[TumblingGroupWindow('w$, ts, 15000)], properties=[w$start, w$end, w$rowtime], select=[a, Final_SUM(sum$0) AS sum_c])(reuse_id=[1])
-+- Exchange(distribution=[hash[a]])
-   +- LocalHashWindowAggregate(groupBy=[a], window=[TumblingGroupWindow('w$, ts, 15000)], properties=[w$start, w$end, w$rowtime], select=[a, Partial_SUM(c) AS sum$0])
-      +- Calc(select=[ts, a, CAST(c AS DOUBLE) AS c])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, ts])
-
-Sink(table=[default_catalog.default_database.sink1], fields=[a, sum_c, time, window_start, window_end])
-+- Calc(select=[a, sum_c, w$end AS time, w$start AS window_start, w$end AS window_end])
-   +- Reused(reference_id=[1])
-
-Sink(table=[default_catalog.default_database.sink2], fields=[a, sum_c, time])
-+- Calc(select=[a, sum_c, w$end AS time])
-   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -684,6 +650,40 @@ Sink(table=[default_catalog.default_database.sink2], fields=[a, total_c])
    :  +- Reused(reference_id=[2])
    +- Calc(select=[a, CAST(total_c AS BIGINT) AS total_c], where=[(a < 50)])
       +- Reused(reference_id=[3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultiSinksWithWindow">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[a, sum_c, time, window_start, window_end])
++- LogicalProject(a=[$1], sum_c=[$2], time=[TUMBLE_END($0)], window_start=[TUMBLE_START($0)], window_end=[TUMBLE_END($0)])
+   +- LogicalAggregate(group=[{0, 1}], sum_c=[SUM($2)])
+      +- LogicalProject($f0=[$TUMBLE($3, 15000:INTERVAL SECOND)], a=[$0], $f2=[CAST($2):DOUBLE])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+
+LogicalSink(table=[default_catalog.default_database.sink2], fields=[a, sum_c, time])
++- LogicalProject(a=[$1], sum_c=[$2], time=[TUMBLE_END($0)])
+   +- LogicalAggregate(group=[{0, 1}], sum_c=[SUM($2)])
+      +- LogicalProject($f0=[$TUMBLE($3, 15000:INTERVAL SECOND)], a=[$0], $f2=[CAST($2):DOUBLE])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashWindowAggregate(groupBy=[a], window=[TumblingGroupWindow('w$, ts, 15000)], properties=[w$start, w$end, w$rowtime], select=[a, Final_SUM(sum$0) AS sum_c])(reuse_id=[1])
++- Exchange(distribution=[hash[a]])
+   +- LocalHashWindowAggregate(groupBy=[a], window=[TumblingGroupWindow('w$, ts, 15000)], properties=[w$start, w$end, w$rowtime], select=[a, Partial_SUM(c) AS sum$0])
+      +- Calc(select=[ts, a, CAST(c AS DOUBLE) AS c])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, ts])
+
+Sink(table=[default_catalog.default_database.sink1], fields=[a, sum_c, time, window_start, window_end])
++- Calc(select=[a, sum_c, w$end AS time, w$start AS window_start, w$end AS window_end])
+   +- Reused(reference_id=[1])
+
+Sink(table=[default_catalog.default_database.sink2], fields=[a, sum_c, time])
++- Calc(select=[a, sum_c, w$end AS time])
+   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -832,6 +832,33 @@ Sink(table=[default_catalog.default_database.sink], fields=[a1, b1, c1])
       +- Exchange(distribution=[hash[a2]])
          +- Calc(select=[a AS a2], where=[((a >= 0) AND (b >= 5))])
             +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleSinkSplitOnUnion">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink], fields=[total_sum])
++- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
+   +- LogicalProject(a=[$0])
+      +- LogicalUnion(all=[true])
+         :- LogicalProject(a=[$0], c=[$2])
+         :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalProject(d=[$0], f=[$2])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink], fields=[total_sum])
++- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS total_sum])
+   +- Exchange(distribution=[single])
+      +- LocalHashAggregate(select=[Partial_SUM(a) AS sum$0])
+         +- Union(all=[true], union=[a])
+            :- Calc(select=[a])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+            +- Calc(select=[d AS a])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
@@ -864,33 +891,6 @@ Sink(table=[default_catalog.default_database.sink], fields=[a, b, c, d, e, f, i,
       :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[d, e, f])
       +- Exchange(distribution=[hash[i]])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[i, j, k, l, m])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleSinkSplitOnUnion">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink], fields=[total_sum])
-+- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(a=[$0])
-      +- LogicalUnion(all=[true])
-         :- LogicalProject(a=[$0], c=[$2])
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         +- LogicalProject(d=[$0], f=[$2])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.sink], fields=[total_sum])
-+- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS total_sum])
-   +- Exchange(distribution=[single])
-      +- LocalHashAggregate(select=[Partial_SUM(a) AS sum$0])
-         +- Union(all=[true], union=[a])
-            :- Calc(select=[a])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-            +- Calc(select=[d AS a])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml
index d347bb578cb..6a8be634552 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml
@@ -329,67 +329,6 @@ MultipleInput(readOrder=[0,2,1], members=[\nUnion(all=[true], union=[cnt1, cnt2]
    +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(*) AS count1$0])
       +- Calc(select=[d])
          +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSubplanReuse_SetExchangeAsBatch_SortMergeJoin">
-    <Resource name="sql">
-      <![CDATA[
-
-WITH v1 AS (SELECT a, SUM(b) AS b, MAX(c) AS c FROM x GROUP BY a),
-     v2 AS (SELECT * FROM v1 r1, v1 r2 WHERE r1.a = r2.a AND r1.b > 10),
-     v3 AS (SELECT * FROM v1 r1, v1 r2 WHERE r1.a = r2.a AND r1.b < 5)
-
-select * from v2, v3 where v2.c = v3.c
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], a0=[$3], b0=[$4], c0=[$5], a1=[$6], b1=[$7], c1=[$8], a00=[$9], b00=[$10], c00=[$11])
-+- LogicalFilter(condition=[=($2, $8)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[$3], b0=[$4], c0=[$5])
-      :  +- LogicalFilter(condition=[AND(=($0, $3), >($1, 10))])
-      :     +- LogicalJoin(condition=[true], joinType=[inner])
-      :        :- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
-      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      :        +- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
-      :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[$3], b0=[$4], c0=[$5])
-         +- LogicalFilter(condition=[AND(=($0, $3), <($1, 5))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
-               :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-               +- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(c = c1)], select=[a, b, c, a0, b0, c0, a1, b1, c1, a00, b00, c00], build=[left])
-:- Exchange(distribution=[hash[c]])
-:  +- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, c, a0, b0, c0], build=[left])
-:     :- Exchange(distribution=[keep_input_as_is[hash[a]]])
-:     :  +- Calc(select=[a, b, c], where=[(b > 10)])
-:     :     +- Exchange(distribution=[keep_input_as_is[hash[a]]])
-:     :        +- SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS b, Final_MAX(max$1) AS c])(reuse_id=[1])
-:     :           +- Exchange(distribution=[forward])
-:     :              +- Sort(orderBy=[a ASC])
-:     :                 +- Exchange(distribution=[hash[a]])
-:     :                    +- LocalSortAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_MAX(c) AS max$1])
-:     :                       +- Exchange(distribution=[forward])
-:     :                          +- Sort(orderBy=[a ASC])
-:     :                             +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-:     +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
-:        +- Reused(reference_id=[1])
-+- Exchange(distribution=[hash[c]])
-   +- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, c, a0, b0, c0], build=[left])
-      :- Exchange(distribution=[keep_input_as_is[hash[a]]])
-      :  +- Calc(select=[a, b, c], where=[(b < 5)])
-      :     +- Exchange(distribution=[keep_input_as_is[hash[a]]])
-      :        +- Reused(reference_id=[1])
-      +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
-         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -419,6 +358,47 @@ HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, a0], build=[left])
 :     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
 +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
    +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSubplanReuse_DeadlockCausedByReusingExchangeInAncestor">
+    <Resource name="sql">
+      <![CDATA[
+WITH T1 AS (
+  SELECT x1.*, x2.a AS k, (x1.b + x2.b) AS v
+  FROM x x1 LEFT JOIN x x2 ON x1.a = x2.a WHERE x2.a > 0)
+SELECT x.a, x.b, T1.* FROM x LEFT JOIN T1 ON x.a = T1.k WHERE x.a > 0 AND T1.v = 0
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], a0=[$3], b0=[$4], c=[$5], k=[$6], v=[$7])
++- LogicalFilter(condition=[AND(>($0, 0), =($7, 0))])
+   +- LogicalJoin(condition=[=($0, $6)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], k=[$3], v=[+($1, $4)])
+         +- LogicalFilter(condition=[>($3, 0)])
+            +- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, a0, b0, c, k, CAST(0 AS BIGINT) AS v])
++- HashJoin(joinType=[InnerJoin], where=[(a = k)], select=[a, b, a0, b0, c, k], build=[right])
+   :- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
+   :  +- Calc(select=[a, b], where=[(a > 0)])(reuse_id=[2])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])(reuse_id=[1])
+   +- Exchange(distribution=[keep_input_as_is[hash[k]]])
+      +- Calc(select=[a, b, c, a0 AS k])
+         +- Exchange(distribution=[keep_input_as_is[hash[a0]]])
+            +- HashJoin(joinType=[InnerJoin], where=[((a = a0) AND ((b + b0) = 0))], select=[a, b, c, a0, b0], build=[right])
+               :- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
+               :  +- Calc(select=[a, b, c], where=[(a > 0)])
+               :     +- Reused(reference_id=[1])
+               +- Exchange(distribution=[hash[a]])
+                  +- Reused(reference_id=[2])
 ]]>
     </Resource>
   </TestCase>
@@ -465,47 +445,6 @@ HashJoin(joinType=[InnerJoin], where=[(b = e0)], select=[a, b, d, e, a0, b0, d0,
       +- Exchange(distribution=[hash[d]])
          +- Calc(select=[d, e], where=[(d > 5)])
             +- Reused(reference_id=[2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSubplanReuse_DeadlockCausedByReusingExchangeInAncestor">
-    <Resource name="sql">
-      <![CDATA[
-WITH T1 AS (
-  SELECT x1.*, x2.a AS k, (x1.b + x2.b) AS v
-  FROM x x1 LEFT JOIN x x2 ON x1.a = x2.a WHERE x2.a > 0)
-SELECT x.a, x.b, T1.* FROM x LEFT JOIN T1 ON x.a = T1.k WHERE x.a > 0 AND T1.v = 0
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], a0=[$3], b0=[$4], c=[$5], k=[$6], v=[$7])
-+- LogicalFilter(condition=[AND(>($0, 0), =($7, 0))])
-   +- LogicalJoin(condition=[=($0, $6)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], k=[$3], v=[+($1, $4)])
-         +- LogicalFilter(condition=[>($3, 0)])
-            +- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-               :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, b, a0, b0, c, k, CAST(0 AS BIGINT) AS v])
-+- HashJoin(joinType=[InnerJoin], where=[(a = k)], select=[a, b, a0, b0, c, k], build=[right])
-   :- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
-   :  +- Calc(select=[a, b], where=[(a > 0)])(reuse_id=[2])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])(reuse_id=[1])
-   +- Exchange(distribution=[keep_input_as_is[hash[k]]])
-      +- Calc(select=[a, b, c, a0 AS k])
-         +- Exchange(distribution=[keep_input_as_is[hash[a0]]])
-            +- HashJoin(joinType=[InnerJoin], where=[((a = a0) AND ((b + b0) = 0))], select=[a, b, c, a0, b0], build=[right])
-               :- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
-               :  +- Calc(select=[a, b, c], where=[(a > 0)])
-               :     +- Reused(reference_id=[1])
-               +- Exchange(distribution=[hash[a]])
-                  +- Reused(reference_id=[2])
 ]]>
     </Resource>
   </TestCase>
@@ -553,6 +492,67 @@ HashJoin(joinType=[InnerJoin], where=[(c = c0)], select=[a, b, c, a0, b0, c0], b
       +- OverAggregate(partitionBy=[b], orderBy=[b ASC], window#0=[MIN(a) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING], select=[a, b, c, w0$o0])
          +- Exchange(distribution=[forward])
             +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSubplanReuse_SetExchangeAsBatch_SortMergeJoin">
+    <Resource name="sql">
+      <![CDATA[
+
+WITH v1 AS (SELECT a, SUM(b) AS b, MAX(c) AS c FROM x GROUP BY a),
+     v2 AS (SELECT * FROM v1 r1, v1 r2 WHERE r1.a = r2.a AND r1.b > 10),
+     v3 AS (SELECT * FROM v1 r1, v1 r2 WHERE r1.a = r2.a AND r1.b < 5)
+
+select * from v2, v3 where v2.c = v3.c
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], a0=[$3], b0=[$4], c0=[$5], a1=[$6], b1=[$7], c1=[$8], a00=[$9], b00=[$10], c00=[$11])
++- LogicalFilter(condition=[=($2, $8)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[$3], b0=[$4], c0=[$5])
+      :  +- LogicalFilter(condition=[AND(=($0, $3), >($1, 10))])
+      :     +- LogicalJoin(condition=[true], joinType=[inner])
+      :        :- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
+      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      :        +- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[$3], b0=[$4], c0=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), <($1, 5))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
+               :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+               +- LogicalAggregate(group=[{0}], b=[SUM($1)], c=[MAX($2)])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(c = c1)], select=[a, b, c, a0, b0, c0, a1, b1, c1, a00, b00, c00], build=[left])
+:- Exchange(distribution=[hash[c]])
+:  +- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, c, a0, b0, c0], build=[left])
+:     :- Exchange(distribution=[keep_input_as_is[hash[a]]])
+:     :  +- Calc(select=[a, b, c], where=[(b > 10)])
+:     :     +- Exchange(distribution=[keep_input_as_is[hash[a]]])
+:     :        +- SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS b, Final_MAX(max$1) AS c])(reuse_id=[1])
+:     :           +- Exchange(distribution=[forward])
+:     :              +- Sort(orderBy=[a ASC])
+:     :                 +- Exchange(distribution=[hash[a]])
+:     :                    +- LocalSortAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_MAX(c) AS max$1])
+:     :                       +- Exchange(distribution=[forward])
+:     :                          +- Sort(orderBy=[a ASC])
+:     :                             +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
+:     +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
+:        +- Reused(reference_id=[1])
++- Exchange(distribution=[hash[c]])
+   +- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, c, a0, b0, c0], build=[left])
+      :- Exchange(distribution=[keep_input_as_is[hash[a]]])
+      :  +- Calc(select=[a, b, c], where=[(b < 5)])
+      :     +- Exchange(distribution=[keep_input_as_is[hash[a]]])
+      :        +- Reused(reference_id=[1])
+      +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
+         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml
index 59a3625d547..0d1c213eb9b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml
@@ -16,108 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testDynamicFilteringWithStaticPartitionPruning[mode = ALL_EXCHANGES_BLOCKING]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
-+- LogicalFilter(condition=[AND(=($3, $7), >($4, 10), >(CAST($3):BIGINT, 1))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
-
-== Optimized Physical Plan ==
-HashJoin(joinType=[InnerJoin], where=[=(p1, p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
-:- Exchange(distribution=[hash[p1]])
-:  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])
-:     +- DynamicFilteringDataCollector(fields=[p])
-:        +- Calc(select=[x, y, z, p], where=[AND(>(x, 10), >(CAST(p AS BIGINT), 1))])
-:           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-+- Exchange(distribution=[hash[p]])
-   +- Calc(select=[x, y, z, p], where=[AND(>(x, 10), >(CAST(p AS BIGINT), 1))])
-      +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-
-== Optimized Execution Plan ==
-HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
-:- Exchange(distribution=[hash[p1]])
-:  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])\n])
-:     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
-:     :  +- DynamicFilteringDataCollector(fields=[p])
-:     :     +- Calc(select=[x, y, z, p], where=[((x > 10) AND (CAST(p AS BIGINT) > 1))])(reuse_id=[1])
-:     :        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-:     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])
-+- Exchange(distribution=[hash[p]])
-   +- Reused(reference_id=[1])
-
-== Physical Execution Plan ==
-{
-  "nodes" : [ {
-    "id" : ,
-    "type" : "Source: fact1[]",
-    "pact" : "Data Source",
-    "contents" : "[]:DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])",
-    "parallelism" : 10
-  }, {
-    "id" : ,
-    "type" : "Source: dim[]",
-    "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[x, y, z, p], where=[((x > 10) AND (CAST(p AS BIGINT) > 1))])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "DynamicFilteringDataCollector[]",
-    "pact" : "Operator",
-    "contents" : "[]:DynamicFilteringDataCollector(fields=[p])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "MultipleInput[]",
-    "pact" : "Operator",
-    "contents" : "[]:MultipleInput(members=[\\nOrderEnforcer\\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])\\n])",
-    "parallelism" : 10,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "BROADCAST",
-      "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "HashJoin[]",
-    "pact" : "Operator",
-    "contents" : "[]:HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])",
-    "parallelism" : 10,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "HASH[p]",
-      "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "HASH[p1]",
-      "side" : "second"
-    } ]
-  } ]
-}]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testDuplicateFactTables[mode = ALL_EXCHANGES_BLOCKING]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
@@ -677,6 +575,108 @@ MultipleInput(readOrder=[2,1,0], members=[\nHashJoin(joinType=[InnerJoin], where
       "side" : "second"
     } ]
   } ]
+}]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringWithStaticPartitionPruning[mode = ALL_EXCHANGES_BLOCKING]">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
++- LogicalFilter(condition=[AND(=($3, $7), >($4, 10), >(CAST($3):BIGINT, 1))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
+
+== Optimized Physical Plan ==
+HashJoin(joinType=[InnerJoin], where=[=(p1, p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
+:- Exchange(distribution=[hash[p1]])
+:  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])
+:     +- DynamicFilteringDataCollector(fields=[p])
+:        +- Calc(select=[x, y, z, p], where=[AND(>(x, 10), >(CAST(p AS BIGINT), 1))])
+:           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
++- Exchange(distribution=[hash[p]])
+   +- Calc(select=[x, y, z, p], where=[AND(>(x, 10), >(CAST(p AS BIGINT), 1))])
+      +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
+
+== Optimized Execution Plan ==
+HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
+:- Exchange(distribution=[hash[p1]])
+:  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])\n])
+:     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
+:     :  +- DynamicFilteringDataCollector(fields=[p])
+:     :     +- Calc(select=[x, y, z, p], where=[((x > 10) AND (CAST(p AS BIGINT) > 1))])(reuse_id=[1])
+:     :        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
+:     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])
++- Exchange(distribution=[hash[p]])
+   +- Reused(reference_id=[1])
+
+== Physical Execution Plan ==
+{
+  "nodes" : [ {
+    "id" : ,
+    "type" : "Source: fact1[]",
+    "pact" : "Data Source",
+    "contents" : "[]:DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])",
+    "parallelism" : 10
+  }, {
+    "id" : ,
+    "type" : "Source: dim[]",
+    "pact" : "Data Source",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])",
+    "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[x, y, z, p], where=[((x > 10) AND (CAST(p AS BIGINT) > 1))])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "DynamicFilteringDataCollector[]",
+    "pact" : "Operator",
+    "contents" : "[]:DynamicFilteringDataCollector(fields=[p])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "MultipleInput[]",
+    "pact" : "Operator",
+    "contents" : "[]:MultipleInput(members=[\\nOrderEnforcer\\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1, partitions=[{p1=2}, {p1=3}]]], fields=[a1, b1, c1, p1])\\n])",
+    "parallelism" : 10,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "BROADCAST",
+      "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "HashJoin[]",
+    "pact" : "Operator",
+    "contents" : "[]:HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])",
+    "parallelism" : 10,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "HASH[p]",
+      "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "HASH[p1]",
+      "side" : "second"
+    } ]
+  } ]
 }]]>
     </Resource>
   </TestCase>
@@ -920,37 +920,59 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, d1, p1, x,
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleDynamicFiltering[mode = ALL_EXCHANGES_BLOCKING]">
+  <TestCase name="testReuseDimSide[mode = ALL_EXCHANGES_BLOCKING]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
-+- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
+LogicalUnion(all=[true])
+:- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
+:  +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
+:     +- LogicalJoin(condition=[true], joinType=[inner])
+:        :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
+:        +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
++- LogicalProject(a2=[$0], b2=[$1], c2=[$2], p2=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
+   +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
+      +- LogicalJoin(condition=[true], joinType=[inner])
+         :- LogicalTableScan(table=[[default_catalog, default_database, fact2]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
 
 == Optimized Physical Plan ==
-HashJoin(joinType=[InnerJoin], where=[=(p1, p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
-:- Exchange(distribution=[hash[p1]])
-:  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
-:     +- DynamicFilteringDataCollector(fields=[p])
-:        +- Calc(select=[x, y, z, p], where=[>(x, 10)])
-:           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-+- Exchange(distribution=[hash[p]])
-   +- Calc(select=[x, y, z, p], where=[>(x, 10)])
-      +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
+Union(all=[true], union=[a1, b1, c1, p1, x, y, z, p])
+:- HashJoin(joinType=[InnerJoin], where=[=(p1, p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
+:  :- Exchange(distribution=[hash[p1]])
+:  :  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
+:  :     +- DynamicFilteringDataCollector(fields=[p])
+:  :        +- Calc(select=[x, y, z, p], where=[>(x, 10)])
+:  :           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
+:  +- Exchange(distribution=[hash[p]])
+:     +- Calc(select=[x, y, z, p], where=[>(x, 10)])
+:        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
++- HashJoin(joinType=[InnerJoin], where=[=(p2, p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])
+   :- Exchange(distribution=[hash[p2]])
+   :  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])
+   :     +- DynamicFilteringDataCollector(fields=[p])
+   :        +- Calc(select=[x, y, z, p], where=[>(x, 10)])
+   :           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
+   +- Exchange(distribution=[hash[p]])
+      +- Calc(select=[x, y, z, p], where=[>(x, 10)])
+         +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 
 == Optimized Execution Plan ==
-HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
+MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\n:  :- [#1] Exchange(distribution=[hash[p1]])\n:  +- [#2] Exchange(distribution=[hash[p]])\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\n   :- [#3] Exchange(distribution=[hash[p2]])\n   +- [#2] Exchange(distribution=[hash[p]])\n])
 :- Exchange(distribution=[hash[p1]])
 :  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])\n])
 :     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
-:     :  +- DynamicFilteringDataCollector(fields=[p])
+:     :  +- DynamicFilteringDataCollector(fields=[p])(reuse_id=[2])
 :     :     +- Calc(select=[x, y, z, p], where=[(x > 10)])(reuse_id=[1])
 :     :        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 :     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
-+- Exchange(distribution=[hash[p]])
-   +- Reused(reference_id=[1])
+:- Exchange(distribution=[hash[p]])(reuse_id=[3])
+:  +- Reused(reference_id=[1])
+:- Exchange(distribution=[hash[p2]])
+:  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])\n])
+:     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
+:     :  +- Reused(reference_id=[2])
+:     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])
++- Reused(reference_id=[3])
 
 == Physical Execution Plan ==
 {
@@ -960,6 +982,12 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z
     "pact" : "Data Source",
     "contents" : "[]:DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])",
     "parallelism" : 10
+  }, {
+    "id" : ,
+    "type" : "Source: fact2[]",
+    "pact" : "Data Source",
+    "contents" : "[]:DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])",
+    "parallelism" : 10
   }, {
     "id" : ,
     "type" : "Source: dim[]",
@@ -1005,9 +1033,24 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z
     } ]
   }, {
     "id" : ,
-    "type" : "HashJoin[]",
+    "type" : "MultipleInput[]",
     "pact" : "Operator",
-    "contents" : "[]:HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])",
+    "contents" : "[]:MultipleInput(members=[\\nOrderEnforcer\\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])\\n])",
+    "parallelism" : 10,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "BROADCAST",
+      "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "MultipleInput[]",
+    "pact" : "Operator",
+    "contents" : "[]:MultipleInput(readOrder=[1,0,1,0], members=[\\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\\n:  :- [#1] Exchange(distribution=[hash[p1]])\\n:  +- [#2] Exchange(distribution=[hash[p]])\\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\\n   :- [#3] Exchange(distribution=[hash[p2]])\\n   +- [#2] Exchange(distribution=[hash[p]])\\n])",
     "parallelism" : 10,
     "predecessors" : [ {
       "id" : ,
@@ -1017,12 +1060,20 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z
       "id" : ,
       "ship_strategy" : "HASH[p1]",
       "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "HASH[p]",
+      "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "HASH[p2]",
+      "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testReuseDimSide[mode = ALL_EXCHANGES_BLOCKING]">
+  <TestCase name="testReuseDimSide[mode = ALL_EXCHANGES_PIPELINED]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalUnion(all=[true])
@@ -1059,7 +1110,7 @@ Union(all=[true], union=[a1, b1, c1, p1, x, y, z, p])
          +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 
 == Optimized Execution Plan ==
-MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\n:  :- [#1] Exchange(distribution=[hash[p1]])\n:  +- [#2] Exchange(distribution=[hash[p]])\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\n   :- [#3] Exchange(distribution=[hash[p2]])\n   +- [#2] Exchange(distribution=[hash[p]])\n])
+MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\n:  :- [#1] Exchange(distribution=[hash[p1]])\n:  +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\n   :- [#3] Exchange(distribution=[hash[p2]])\n   +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\n])
 :- Exchange(distribution=[hash[p1]])
 :  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])\n])
 :     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
@@ -1067,7 +1118,7 @@ MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c
 :     :     +- Calc(select=[x, y, z, p], where=[(x > 10)])(reuse_id=[1])
 :     :        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 :     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
-:- Exchange(distribution=[hash[p]])(reuse_id=[3])
+:- Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])(reuse_id=[3])
 :  +- Reused(reference_id=[1])
 :- Exchange(distribution=[hash[p2]])
 :  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])\n])
@@ -1152,7 +1203,7 @@ MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c
     "id" : ,
     "type" : "MultipleInput[]",
     "pact" : "Operator",
-    "contents" : "[]:MultipleInput(readOrder=[1,0,1,0], members=[\\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\\n:  :- [#1] Exchange(distribution=[hash[p1]])\\n:  +- [#2] Exchange(distribution=[hash[p]])\\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\\n   :- [#3] Exchange(distribution=[hash[p2]])\\n   +- [#2] Exchange(distribution=[hash[p]])\\n])",
+    "contents" : "[]:MultipleInput(readOrder=[1,0,1,0], members=[\\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\\n:  :- [#1] Exchange(distribution=[hash[p1]])\\n:  +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\\n   :- [#3] Exchange(distribution=[hash[p2]])\\n   +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\\n])",
     "parallelism" : 10,
     "predecessors" : [ {
       "id" : ,
@@ -1175,7 +1226,7 @@ MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleDynamicFiltering[mode = ALL_EXCHANGES_PIPELINED]">
+  <TestCase name="testSimpleDynamicFiltering[mode = ALL_EXCHANGES_BLOCKING]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
@@ -1204,7 +1255,7 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z
 :     :     +- Calc(select=[x, y, z, p], where=[(x > 10)])(reuse_id=[1])
 :     :        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 :     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
-+- Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])
++- Exchange(distribution=[hash[p]])
    +- Reused(reference_id=[1])
 
 == Physical Execution Plan ==
@@ -1277,59 +1328,37 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testReuseDimSide[mode = ALL_EXCHANGES_PIPELINED]">
+  <TestCase name="testSimpleDynamicFiltering[mode = ALL_EXCHANGES_PIPELINED]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalUnion(all=[true])
-:- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
-:  +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
-:     +- LogicalJoin(condition=[true], joinType=[inner])
-:        :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
-+- LogicalProject(a2=[$0], b2=[$1], c2=[$2], p2=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
-   +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, fact2]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
++- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
 
 == Optimized Physical Plan ==
-Union(all=[true], union=[a1, b1, c1, p1, x, y, z, p])
-:- HashJoin(joinType=[InnerJoin], where=[=(p1, p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
-:  :- Exchange(distribution=[hash[p1]])
-:  :  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
-:  :     +- DynamicFilteringDataCollector(fields=[p])
-:  :        +- Calc(select=[x, y, z, p], where=[>(x, 10)])
-:  :           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-:  +- Exchange(distribution=[hash[p]])
-:     +- Calc(select=[x, y, z, p], where=[>(x, 10)])
-:        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-+- HashJoin(joinType=[InnerJoin], where=[=(p2, p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])
-   :- Exchange(distribution=[hash[p2]])
-   :  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])
-   :     +- DynamicFilteringDataCollector(fields=[p])
-   :        +- Calc(select=[x, y, z, p], where=[>(x, 10)])
-   :           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
-   +- Exchange(distribution=[hash[p]])
-      +- Calc(select=[x, y, z, p], where=[>(x, 10)])
-         +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
+HashJoin(joinType=[InnerJoin], where=[=(p1, p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
+:- Exchange(distribution=[hash[p1]])
+:  +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
+:     +- DynamicFilteringDataCollector(fields=[p])
+:        +- Calc(select=[x, y, z, p], where=[>(x, 10)])
+:           +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
++- Exchange(distribution=[hash[p]])
+   +- Calc(select=[x, y, z, p], where=[>(x, 10)])
+      +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 
 == Optimized Execution Plan ==
-MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\n:  :- [#1] Exchange(distribution=[hash[p1]])\n:  +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\n   :- [#3] Exchange(distribution=[hash[p2]])\n   +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\n])
+HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])
 :- Exchange(distribution=[hash[p1]])
 :  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])\n])
 :     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
-:     :  +- DynamicFilteringDataCollector(fields=[p])(reuse_id=[2])
+:     :  +- DynamicFilteringDataCollector(fields=[p])
 :     :     +- Calc(select=[x, y, z, p], where=[(x > 10)])(reuse_id=[1])
 :     :        +- TableSourceScan(table=[[default_catalog, default_database, dim, filter=[]]], fields=[x, y, z, p])
 :     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])
-:- Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])(reuse_id=[3])
-:  +- Reused(reference_id=[1])
-:- Exchange(distribution=[hash[p2]])
-:  +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])\n])
-:     :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
-:     :  +- Reused(reference_id=[2])
-:     +- DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])
-+- Reused(reference_id=[3])
++- Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])
+   +- Reused(reference_id=[1])
 
 == Physical Execution Plan ==
 {
@@ -1339,12 +1368,6 @@ MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c
     "pact" : "Data Source",
     "contents" : "[]:DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact1]], fields=[a1, b1, c1, p1])",
     "parallelism" : 10
-  }, {
-    "id" : ,
-    "type" : "Source: fact2[]",
-    "pact" : "Data Source",
-    "contents" : "[]:DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])",
-    "parallelism" : 10
   }, {
     "id" : ,
     "type" : "Source: dim[]",
@@ -1390,24 +1413,9 @@ MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c
     } ]
   }, {
     "id" : ,
-    "type" : "MultipleInput[]",
-    "pact" : "Operator",
-    "contents" : "[]:MultipleInput(members=[\\nOrderEnforcer\\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\\n+- [#2] DynamicFilteringTableSourceScan(table=[[default_catalog, default_database, fact2]], fields=[a2, b2, c2, p2])\\n])",
-    "parallelism" : 10,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "BROADCAST",
-      "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "MultipleInput[]",
+    "type" : "HashJoin[]",
     "pact" : "Operator",
-    "contents" : "[]:MultipleInput(readOrder=[1,0,1,0], members=[\\nUnion(all=[true], union=[a1, b1, c1, p1, x, y, z, p])\\n:- HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])\\n:  :- [#1] Exchange(distribution=[hash[p1]])\\n:  +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\\n+- HashJoin(joinType=[InnerJoin], where=[(p2 = p)], select=[a2, b2, c2, p2, x, y, z, p], build=[right])\\n   :- [#3] Exchange(distribution=[hash[p2]])\\n   +- [#2] Exchange(distribution=[hash[p]], shuffle_mode=[BATCH])\\n])",
+    "contents" : "[]:HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z, p], build=[right])",
     "parallelism" : 10,
     "predecessors" : [ {
       "id" : ,
@@ -1417,14 +1425,6 @@ MultipleInput(readOrder=[1,0,1,0], members=[\nUnion(all=[true], union=[a1, b1, c
       "id" : ,
       "ship_strategy" : "HASH[p1]",
       "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "HASH[p]",
-      "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "HASH[p2]",
-      "side" : "second"
     } ]
   } ]
 }]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFunctionPlanTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFunctionPlanTest.xml
index 1405e31e772..c4442ef5dde 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFunctionPlanTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFunctionPlanTest.xml
@@ -38,29 +38,6 @@ HashAggregate(isMerge=[false], groupBy=[cat], auxGrouping=[gmt_date], select=[ca
 +- Exchange(distribution=[hash[cat]])
    +- Calc(select=[cat, gmt_date, cnt], where=[(gmt_date = CURRENT_DATE())])
       +- TableSourceScan(table=[[default_catalog, default_database, src, filter=[], project=[cat, gmt_date, cnt], metadata=[]]], fields=[cat, gmt_date, cnt])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCalcMerge">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM ( 
-   SELECT *, SUBSTR(CAST(LOCALTIME AS VARCHAR), 1, 2) hh
-   FROM src
- ) t1 WHERE hh > 12 AND cat LIKE 'fruit%'
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[$6])
-+- LogicalFilter(condition=[AND(>(CAST($6):BIGINT, 12), LIKE($2, _UTF-16LE'fruit%'))])
-   +- LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[SUBSTR(CAST(LOCALTIME):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL, 1, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, b, cat, gmt_date, cnt, ts, SUBSTR(CAST(LOCALTIME() AS VARCHAR(2147483647)), 1, 2) AS hh], where=[((CAST(SUBSTR(CAST(LOCALTIME() AS VARCHAR(2147483647)), 1, 2) AS BIGINT) > 12) AND LIKE(cat, 'fruit%'))])
-+- TableSourceScan(table=[[default_catalog, default_database, src, filter=[]]], fields=[a, b, cat, gmt_date, cnt, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -116,6 +93,29 @@ Calc(select=[gmt_date, CAST(CURRENT_TIME() AS TIME(0)) AS ts, 'fruit' AS cat, SU
       +- LocalHashAggregate(groupBy=[gmt_date], select=[gmt_date, Partial_SUM(cnt) AS sum$0])
          +- Calc(select=[gmt_date, cnt], where=[((gmt_date = CURRENT_DATE()) AND (cat = 'fruit') AND (ts = CURRENT_TIME()))])
             +- TableSourceScan(table=[[default_catalog, default_database, src, filter=[], project=[cat, gmt_date, cnt, ts], metadata=[]]], fields=[cat, gmt_date, cnt, ts])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalcMerge">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM ( 
+   SELECT *, SUBSTR(CAST(LOCALTIME AS VARCHAR), 1, 2) hh
+   FROM src
+ ) t1 WHERE hh > 12 AND cat LIKE 'fruit%'
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[$6])
++- LogicalFilter(condition=[AND(>(CAST($6):BIGINT, 12), LIKE($2, _UTF-16LE'fruit%'))])
+   +- LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[SUBSTR(CAST(LOCALTIME):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL, 1, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, cat, gmt_date, cnt, ts, SUBSTR(CAST(LOCALTIME() AS VARCHAR(2147483647)), 1, 2) AS hh], where=[((CAST(SUBSTR(CAST(LOCALTIME() AS VARCHAR(2147483647)), 1, 2) AS BIGINT) > 12) AND LIKE(cat, 'fruit%'))])
++- TableSourceScan(table=[[default_catalog, default_database, src, filter=[]]], fields=[a, b, cat, gmt_date, cnt, ts])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml
index c623d637ad9..2221630f38f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml
@@ -664,43 +664,6 @@ SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS b])
             +- Exchange(distribution=[forward])
                +- Sort(orderBy=[a ASC])
                   +- TableSourceScan(table=[[default_catalog, default_database, T, project=[a, b], metadata=[]]], fields=[a, b])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTwoPhaseSortAggOnSortMergeJoinWithHashShuffle">
-    <Resource name="sql">
-      <![CDATA[WITH r AS (SELECT * FROM T1, T2 WHERE a1 = a2 AND c1 LIKE 'He%')
-SELECT sum(b1) FROM r group by a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1])
-+- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
-   +- LogicalProject(a1=[$0], b1=[$1])
-      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
-         +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0])
-+- SortAggregate(isMerge=[true], groupBy=[a1], select=[a1, Final_SUM(sum$0) AS EXPR$0])
-   +- Exchange(distribution=[forward])
-      +- Sort(orderBy=[a1 ASC])
-         +- Exchange(distribution=[hash[a1]])
-            +- LocalSortAggregate(groupBy=[a1], select=[a1, Partial_SUM(b1) AS sum$0])
-               +- Exchange(distribution=[forward])
-                  +- Sort(orderBy=[a1 ASC])
-                     +- Calc(select=[a1, b1])
-                        +- SortMergeJoin(joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, a2])
-                           :- Exchange(distribution=[hash[a1]])
-                           :  +- Calc(select=[a1, b1], where=[LIKE(c1, 'He%')])
-                           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1, c1], metadata=[]]], fields=[a1, b1, c1])
-                           +- Exchange(distribution=[hash[a2]])
-                              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
@@ -744,6 +707,43 @@ SortMergeJoin(joinType=[InnerJoin], where=[(a = d2)], select=[a, d2])
             :- Reused(reference_id=[1])
             +- Exchange(distribution=[hash[d2]])
                +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[d2], metadata=[]]], fields=[d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoPhaseSortAggOnSortMergeJoinWithHashShuffle">
+    <Resource name="sql">
+      <![CDATA[WITH r AS (SELECT * FROM T1, T2 WHERE a1 = a2 AND c1 LIKE 'He%')
+SELECT sum(b1) FROM r group by a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1])
++- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
+   +- LogicalProject(a1=[$0], b1=[$1])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+         +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[EXPR$0])
++- SortAggregate(isMerge=[true], groupBy=[a1], select=[a1, Final_SUM(sum$0) AS EXPR$0])
+   +- Exchange(distribution=[forward])
+      +- Sort(orderBy=[a1 ASC])
+         +- Exchange(distribution=[hash[a1]])
+            +- LocalSortAggregate(groupBy=[a1], select=[a1, Partial_SUM(b1) AS sum$0])
+               +- Exchange(distribution=[forward])
+                  +- Sort(orderBy=[a1 ASC])
+                     +- Calc(select=[a1, b1])
+                        +- SortMergeJoin(joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, a2])
+                           :- Exchange(distribution=[hash[a1]])
+                           :  +- Calc(select=[a1, b1], where=[LIKE(c1, 'He%')])
+                           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1, c1], metadata=[]]], fields=[a1, b1, c1])
+                           +- Exchange(distribution=[hash[a2]])
+                              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LimitTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LimitTest.xml
index e24be96ba55..53f6fdbada5 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LimitTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LimitTest.xml
@@ -183,26 +183,6 @@ Limit(offset=[0], fetch=[10], global=[true])
 +- Exchange(distribution=[single])
    +- Limit(offset=[0], fetch=[10], global=[false])
       +- TableSourceScan(table=[[default_catalog, default_database, LimitTable, project=[a, c], metadata=[], limit=[10]]], fields=[a, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOrderByWithLimitSource">
-    <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable ORDER BY c LIMIT 10]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
-+- LogicalProject(a=[$0], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-SortLimit(orderBy=[c ASC], offset=[0], fetch=[10], global=[true])
-+- Exchange(distribution=[single])
-   +- SortLimit(orderBy=[c ASC], offset=[0], fetch=[10], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, LimitTable, project=[a, c], metadata=[]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
@@ -245,6 +225,26 @@ Calc(select=[a, c])
    +- Exchange(distribution=[single])
       +- Limit(offset=[0], fetch=[10], global=[false])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLimitWithOffsetAndLimitSource">
+    <Resource name="sql">
+      <![CDATA[SELECT a, c FROM LimitTable LIMIT 10 OFFSET 1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSort(offset=[1], fetch=[10])
++- LogicalProject(a=[$0], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Limit(offset=[1], fetch=[10], global=[true])
++- Exchange(distribution=[single])
+   +- Limit(offset=[0], fetch=[11], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, LimitTable, project=[a, c], metadata=[], limit=[11]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
@@ -288,23 +288,23 @@ Calc(select=[a, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithOffsetAndLimitSource">
+  <TestCase name="testOrderByWithLimitSource">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable LIMIT 10 OFFSET 1]]>
+      <![CDATA[SELECT a, c FROM LimitTable ORDER BY c LIMIT 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[1], fetch=[10])
+LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Limit(offset=[1], fetch=[10], global=[true])
+SortLimit(orderBy=[c ASC], offset=[0], fetch=[10], global=[true])
 +- Exchange(distribution=[single])
-   +- Limit(offset=[0], fetch=[11], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, LimitTable, project=[a, c], metadata=[], limit=[11]]], fields=[a, c])
+   +- SortLimit(orderBy=[c ASC], offset=[0], fetch=[10], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, LimitTable, project=[a, c], metadata=[]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml
index c71dcc65962..c555231bd38 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml
@@ -1654,138 +1654,6 @@ MultipleInput(members=[\nSortMergeJoin(joinType=[InnerJoin], where=[(a = a0)], s
 :  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])
 +- Exchange(distribution=[hash[d]])
    +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRelatedInputs[shuffleMode: ALL_EXCHANGES_BLOCKING, schedulerType: AdaptiveBatch]">
-    <Resource name="sql">
-      <![CDATA[
-WITH
-  T1 AS (SELECT x.a AS a, y.d AS b FROM y LEFT JOIN x ON y.d = x.a),
-  T2 AS (
-    SELECT a, b FROM
-      (SELECT a, b FROM T1)
-      UNION ALL
-      (SELECT x.a AS a, x.b AS b FROM x))
-SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$0], b=[$1])
-   :  :  +- LogicalProject(a=[$0], b=[$1])
-   :  :     +- LogicalProject(a=[$4], b=[$0])
-   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y]])
-   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-   :  +- LogicalProject(a=[$0], b=[$1])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(readOrder=[0,1,2,1], members=[\nNestedLoopJoin(joinType=[LeftOuterJoin], where=[(a = a0)], select=[a, b, a0, b0, c], build=[right])\n:- Union(all=[true], union=[a, b])\n:  :- Calc(select=[a, CAST(d AS BIGINT) AS b])\n:  :  +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[(d = a)], select=[d, a], build=[right])\n:  :     :- [#3] Calc(select=[d])\n:  :     +- [#4] Exchange(distribution=[broadcast])\n:  +- [#2] Calc(select=[a, b])\n+- [#1] Exchange(distribution=[broadcast])\n])
-:- Exchange(distribution=[broadcast])
-:  +- BoundedStreamScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
-:- Calc(select=[a, b])
-:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])(reuse_id=[1])
-:- Calc(select=[d])
-:  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[a])
-      +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRelatedInputs[shuffleMode: ALL_EXCHANGES_BLOCKING, schedulerType: Default]">
-    <Resource name="sql">
-      <![CDATA[
-WITH
-  T1 AS (SELECT x.a AS a, y.d AS b FROM y LEFT JOIN x ON y.d = x.a),
-  T2 AS (
-    SELECT a, b FROM
-      (SELECT a, b FROM T1)
-      UNION ALL
-      (SELECT x.a AS a, x.b AS b FROM x))
-SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$0], b=[$1])
-   :  :  +- LogicalProject(a=[$0], b=[$1])
-   :  :     +- LogicalProject(a=[$4], b=[$0])
-   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y]])
-   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-   :  +- LogicalProject(a=[$0], b=[$1])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(readOrder=[0,1,2,1], members=[\nNestedLoopJoin(joinType=[LeftOuterJoin], where=[(a = a0)], select=[a, b, a0, b0, c], build=[right])\n:- Union(all=[true], union=[a, b])\n:  :- Calc(select=[a, CAST(d AS BIGINT) AS b])\n:  :  +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[(d = a)], select=[d, a], build=[right])\n:  :     :- [#3] Calc(select=[d])\n:  :     +- [#4] Exchange(distribution=[broadcast])\n:  +- [#2] Calc(select=[a, b])\n+- [#1] Exchange(distribution=[broadcast])\n])
-:- Exchange(distribution=[broadcast])
-:  +- BoundedStreamScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
-:- Calc(select=[a, b])
-:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])(reuse_id=[1])
-:- Calc(select=[d])
-:  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[a])
-      +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRelatedInputs[shuffleMode: ALL_EXCHANGES_PIPELINED, schedulerType: Default]">
-    <Resource name="sql">
-      <![CDATA[
-WITH
-  T1 AS (SELECT x.a AS a, y.d AS b FROM y LEFT JOIN x ON y.d = x.a),
-  T2 AS (
-    SELECT a, b FROM
-      (SELECT a, b FROM T1)
-      UNION ALL
-      (SELECT x.a AS a, x.b AS b FROM x))
-SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$0], b=[$1])
-   :  :  +- LogicalProject(a=[$0], b=[$1])
-   :  :     +- LogicalProject(a=[$4], b=[$0])
-   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y]])
-   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-   :  +- LogicalProject(a=[$0], b=[$1])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(readOrder=[0,1,2,1], members=[\nNestedLoopJoin(joinType=[LeftOuterJoin], where=[(a = a0)], select=[a, b, a0, b0, c], build=[right])\n:- Union(all=[true], union=[a, b])\n:  :- Calc(select=[a, CAST(d AS BIGINT) AS b])\n:  :  +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[(d = a)], select=[d, a], build=[right])\n:  :     :- [#3] Calc(select=[d])\n:  :     +- [#4] Exchange(distribution=[broadcast])\n:  +- [#2] Calc(select=[a, b])\n+- [#1] Exchange(distribution=[broadcast])\n])
-:- Exchange(distribution=[broadcast])
-:  +- BoundedStreamScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
-:- Calc(select=[a, b])
-:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])(reuse_id=[1])
-:- Calc(select=[d])
-:  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[a])
-      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1942,6 +1810,138 @@ Calc(select=[a, b, a0, b0, c])
       +- LocalHashAggregate(groupBy=[b], select=[b, Partial_COUNT(a) AS count$0])
          +- Calc(select=[b, a])
             +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRelatedInputs[shuffleMode: ALL_EXCHANGES_BLOCKING, schedulerType: AdaptiveBatch]">
+    <Resource name="sql">
+      <![CDATA[
+WITH
+  T1 AS (SELECT x.a AS a, y.d AS b FROM y LEFT JOIN x ON y.d = x.a),
+  T2 AS (
+    SELECT a, b FROM
+      (SELECT a, b FROM T1)
+      UNION ALL
+      (SELECT x.a AS a, x.b AS b FROM x))
+SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+   :- LogicalUnion(all=[true])
+   :  :- LogicalProject(a=[$0], b=[$1])
+   :  :  +- LogicalProject(a=[$0], b=[$1])
+   :  :     +- LogicalProject(a=[$4], b=[$0])
+   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y]])
+   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+   :  +- LogicalProject(a=[$0], b=[$1])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,1,2,1], members=[\nNestedLoopJoin(joinType=[LeftOuterJoin], where=[(a = a0)], select=[a, b, a0, b0, c], build=[right])\n:- Union(all=[true], union=[a, b])\n:  :- Calc(select=[a, CAST(d AS BIGINT) AS b])\n:  :  +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[(d = a)], select=[d, a], build=[right])\n:  :     :- [#3] Calc(select=[d])\n:  :     +- [#4] Exchange(distribution=[broadcast])\n:  +- [#2] Calc(select=[a, b])\n+- [#1] Exchange(distribution=[broadcast])\n])
+:- Exchange(distribution=[broadcast])
+:  +- BoundedStreamScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+:- Calc(select=[a, b])
+:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])(reuse_id=[1])
+:- Calc(select=[d])
+:  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[a])
+      +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRelatedInputs[shuffleMode: ALL_EXCHANGES_BLOCKING, schedulerType: Default]">
+    <Resource name="sql">
+      <![CDATA[
+WITH
+  T1 AS (SELECT x.a AS a, y.d AS b FROM y LEFT JOIN x ON y.d = x.a),
+  T2 AS (
+    SELECT a, b FROM
+      (SELECT a, b FROM T1)
+      UNION ALL
+      (SELECT x.a AS a, x.b AS b FROM x))
+SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+   :- LogicalUnion(all=[true])
+   :  :- LogicalProject(a=[$0], b=[$1])
+   :  :  +- LogicalProject(a=[$0], b=[$1])
+   :  :     +- LogicalProject(a=[$4], b=[$0])
+   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y]])
+   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+   :  +- LogicalProject(a=[$0], b=[$1])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,1,2,1], members=[\nNestedLoopJoin(joinType=[LeftOuterJoin], where=[(a = a0)], select=[a, b, a0, b0, c], build=[right])\n:- Union(all=[true], union=[a, b])\n:  :- Calc(select=[a, CAST(d AS BIGINT) AS b])\n:  :  +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[(d = a)], select=[d, a], build=[right])\n:  :     :- [#3] Calc(select=[d])\n:  :     +- [#4] Exchange(distribution=[broadcast])\n:  +- [#2] Calc(select=[a, b])\n+- [#1] Exchange(distribution=[broadcast])\n])
+:- Exchange(distribution=[broadcast])
+:  +- BoundedStreamScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+:- Calc(select=[a, b])
+:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])(reuse_id=[1])
+:- Calc(select=[d])
+:  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[a])
+      +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRelatedInputs[shuffleMode: ALL_EXCHANGES_PIPELINED, schedulerType: Default]">
+    <Resource name="sql">
+      <![CDATA[
+WITH
+  T1 AS (SELECT x.a AS a, y.d AS b FROM y LEFT JOIN x ON y.d = x.a),
+  T2 AS (
+    SELECT a, b FROM
+      (SELECT a, b FROM T1)
+      UNION ALL
+      (SELECT x.a AS a, x.b AS b FROM x))
+SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+   :- LogicalUnion(all=[true])
+   :  :- LogicalProject(a=[$0], b=[$1])
+   :  :  +- LogicalProject(a=[$0], b=[$1])
+   :  :     +- LogicalProject(a=[$4], b=[$0])
+   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y]])
+   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+   :  +- LogicalProject(a=[$0], b=[$1])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,1,2,1], members=[\nNestedLoopJoin(joinType=[LeftOuterJoin], where=[(a = a0)], select=[a, b, a0, b0, c], build=[right])\n:- Union(all=[true], union=[a, b])\n:  :- Calc(select=[a, CAST(d AS BIGINT) AS b])\n:  :  +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[(d = a)], select=[d, a], build=[right])\n:  :     :- [#3] Calc(select=[d])\n:  :     +- [#4] Exchange(distribution=[broadcast])\n:  +- [#2] Calc(select=[a, b])\n+- [#1] Exchange(distribution=[broadcast])\n])
+:- Exchange(distribution=[broadcast])
+:  +- BoundedStreamScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+:- Calc(select=[a, b])
+:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c, nx])(reuse_id=[1])
+:- Calc(select=[d])
+:  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f, ny])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[a])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/OperatorFusionCodegenTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/OperatorFusionCodegenTest.xml
index 972f5db1160..f802abaa4ea 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/OperatorFusionCodegenTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/OperatorFusionCodegenTest.xml
@@ -49,33 +49,6 @@ Calc(select=[a1, b1, a2, b2, a3, b3, ($f4 * $f2) AS $f8])
    +- Exchange(distribution=[hash[b2]])
       +- Calc(select=[a2, b2])
          +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testHashAggAsMutltipleInputRoot[fusionCodegenEnabled=true]">
-    <Resource name="sql">
-      <![CDATA[SELECT a1, b1, a2, b2, COUNT(c1) FROM (SELECT * FROM T1, T2 WHERE a1 = b2) t GROUP BY a1, b1, a2, b2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
-+- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
-      +- LogicalFilter(condition=[=($0, $5)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nHashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1, a2, b2], select=[a1, b1, a2, b2, COUNT(c1) AS EXPR$4])\n+- HashJoin(joinType=[InnerJoin], where=[(a1 = b2)], select=[a1, b1, c1, a2, b2], build=[right])\n   :- [#1] Exchange(distribution=[hash[a1]])\n   +- [#2] Exchange(distribution=[hash[b2]])\n])
-:- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1, c1])
-:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
-+- Exchange(distribution=[hash[b2]])
-   +- Calc(select=[a2, b2])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
 ]]>
     </Resource>
   </TestCase>
@@ -114,35 +87,36 @@ MultipleInput(readOrder=[0,1,0], members=[\nCalc(select=[a1, b1, a2, b2, a3, b3,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLocalHashAggAsMutltipleInputRoot[fusionCodegenEnabled=true]">
+  <TestCase name="testHashAggAsMutltipleInputRoot[fusionCodegenEnabled=false]">
     <Resource name="sql">
-      <![CDATA[SELECT a2, b2, a3, b3, COUNT(c2), AVG(d3) FROM (SELECT * FROM T2, T3 WHERE b2 = a3) t GROUP BY a2, b2, a3, b3]]>
+      <![CDATA[SELECT a1, b1, a2, b2, COUNT(c1) FROM (SELECT * FROM T1, T2 WHERE a1 = b2) t GROUP BY a1, b1, a2, b2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)], EXPR$5=[AVG($5)])
-+- LogicalProject(a2=[$0], b2=[$1], a3=[$3], b3=[$4], c2=[$2], d3=[$6])
-   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a3=[$3], b3=[$4], c3=[$5], d3=[$6])
-      +- LogicalFilter(condition=[=($1, $3)])
+LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
++- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalFilter(condition=[=($0, $5)])
          +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a2, b2, a3, b3, EXPR$4, EXPR$5])
-+- HashAggregate(isMerge=[true], groupBy=[a3, b3], auxGrouping=[a2, b2], select=[a3, b3, a2, b2, Final_COUNT(count$0) AS EXPR$4, Final_AVG(sum$1, count$2) AS EXPR$5])
-   +- Exchange(distribution=[hash[a3, b3]])
-      +- MultipleInput(readOrder=[1,0], members=[\nLocalHashAggregate(groupBy=[a3, b3], auxGrouping=[a2, b2], select=[a3, b3, a2, b2, Partial_COUNT(c2) AS count$0, Partial_AVG(d3) AS (sum$1, count$2)])\n+- HashJoin(joinType=[InnerJoin], where=[(b2 = a3)], select=[a2, b2, c2, a3, b3, d3], isBroadcast=[true], build=[right])\n   :- [#1] LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])\n   +- [#2] Exchange(distribution=[broadcast])\n])
-         :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-         +- Exchange(distribution=[broadcast])
-            +- Calc(select=[a3, b3, d3])
-               +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
+HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1, a2, b2], select=[a1, b1, a2, b2, COUNT(c1) AS EXPR$4])
++- Exchange(distribution=[keep_input_as_is[hash[a1]]])
+   +- HashJoin(joinType=[InnerJoin], where=[(a1 = b2)], select=[a1, b1, c1, a2, b2], build=[right])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1, c1])
+      :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+      +- Exchange(distribution=[hash[b2]])
+         +- Calc(select=[a2, b2])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHashAggAsMutltipleInputRoot[fusionCodegenEnabled=false]">
+  <TestCase name="testHashAggAsMutltipleInputRoot[fusionCodegenEnabled=true]">
     <Resource name="sql">
       <![CDATA[SELECT a1, b1, a2, b2, COUNT(c1) FROM (SELECT * FROM T1, T2 WHERE a1 = b2) t GROUP BY a1, b1, a2, b2]]>
     </Resource>
@@ -159,15 +133,13 @@ LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1, a2, b2], select=[a1, b1, a2, b2, COUNT(c1) AS EXPR$4])
-+- Exchange(distribution=[keep_input_as_is[hash[a1]]])
-   +- HashJoin(joinType=[InnerJoin], where=[(a1 = b2)], select=[a1, b1, c1, a2, b2], build=[right])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1, c1])
-      :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
-      +- Exchange(distribution=[hash[b2]])
-         +- Calc(select=[a2, b2])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+MultipleInput(readOrder=[1,0], members=[\nHashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1, a2, b2], select=[a1, b1, a2, b2, COUNT(c1) AS EXPR$4])\n+- HashJoin(joinType=[InnerJoin], where=[(a1 = b2)], select=[a1, b1, c1, a2, b2], build=[right])\n   :- [#1] Exchange(distribution=[hash[a1]])\n   +- [#2] Exchange(distribution=[hash[b2]])\n])
+:- Exchange(distribution=[hash[a1]])
+:  +- Calc(select=[a1, b1, c1])
+:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
++- Exchange(distribution=[hash[b2]])
+   +- Calc(select=[a2, b2])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
 ]]>
     </Resource>
   </TestCase>
@@ -197,6 +169,34 @@ Calc(select=[a2, b2, a3, b3, EXPR$4, EXPR$5])
             +- Exchange(distribution=[broadcast])
                +- Calc(select=[a3, b3, d3])
                   +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLocalHashAggAsMutltipleInputRoot[fusionCodegenEnabled=true]">
+    <Resource name="sql">
+      <![CDATA[SELECT a2, b2, a3, b3, COUNT(c2), AVG(d3) FROM (SELECT * FROM T2, T3 WHERE b2 = a3) t GROUP BY a2, b2, a3, b3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)], EXPR$5=[AVG($5)])
++- LogicalProject(a2=[$0], b2=[$1], a3=[$3], b3=[$4], c2=[$2], d3=[$6])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a3=[$3], b3=[$4], c3=[$5], d3=[$6])
+      +- LogicalFilter(condition=[=($1, $3)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a2, b2, a3, b3, EXPR$4, EXPR$5])
++- HashAggregate(isMerge=[true], groupBy=[a3, b3], auxGrouping=[a2, b2], select=[a3, b3, a2, b2, Final_COUNT(count$0) AS EXPR$4, Final_AVG(sum$1, count$2) AS EXPR$5])
+   +- Exchange(distribution=[hash[a3, b3]])
+      +- MultipleInput(readOrder=[1,0], members=[\nLocalHashAggregate(groupBy=[a3, b3], auxGrouping=[a2, b2], select=[a3, b3, a2, b2, Partial_COUNT(c2) AS count$0, Partial_AVG(d3) AS (sum$1, count$2)])\n+- HashJoin(joinType=[InnerJoin], where=[(b2 = a3)], select=[a2, b2, c2, a3, b3, d3], isBroadcast=[true], build=[right])\n   :- [#1] LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])\n   +- [#2] Exchange(distribution=[broadcast])\n])
+         :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+         +- Exchange(distribution=[broadcast])
+            +- Calc(select=[a3, b3, d3])
+               +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSinkTest.xml
index 450ad10c8b8..ae01914ebe2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSinkTest.xml
@@ -113,14 +113,4 @@ Sink(table=[default_catalog.default_database.sink], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWrongFields">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO sink PARTITION (b=1) SELECT a, b, c FROM MyTable]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWrongStatic">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO sink PARTITION (a=1) SELECT b, c FROM MyTable]]>
-    </Resource>
-  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSourceTest.xml
index 59c8229ea9f..a1dfe843c6a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/PartitionableSourceTest.xml
@@ -109,50 +109,49 @@ Values(tuples=[[]], values=[id, name, part1, part2, virtualField])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPushDownNonExistentPartition[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[SELECT * FROM PartitionableTable WHERE part2 = 4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
++- LogicalFilter(condition=[=($3, 4)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
+Values(tuples=[[]], values=[id, name, part1, part2, virtualField])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownNonExistentPartition[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM PartitionableTable WHERE part2 = 4]]>
+      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($3, 4)])
+LogicalProject(name=[$1])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
+      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Values(tuples=[[]], values=[id, name, part1, part2, virtualField])
+TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
+LogicalProject(name=[$1])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
@@ -160,37 +159,35 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
+TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
+LogicalProject(name=[$1])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
+TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$1])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
@@ -198,17 +195,18 @@ LogicalProject(name=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
+Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$1])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
@@ -216,17 +214,18 @@ LogicalProject(name=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
+Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$1])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable]])
@@ -234,7 +233,8 @@ LogicalProject(name=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
+Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
 ]]>
     </Resource>
   </TestCase>
@@ -333,45 +333,45 @@ Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
+      <![CDATA[select * from PartitionableTable where trim(part1) = 'A' and part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
++- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id > 2)])
-+- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
+Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=2}]]], fields=[id, name, part1, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableTable where trim(part1) = 'A' and part2 > 1]]>
+      <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
+      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=2}]]], fields=[id, name, part1, part2])
+Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id > 2)])
++- TableSourceScan(table=[[test_catalog, test_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
@@ -390,7 +390,7 @@ Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id >
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
@@ -399,13 +399,13 @@ Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id >
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id > 2)])
-+- TableSourceScan(table=[[test_catalog, test_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
++- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml
index 4e5aad99d8b..384214cb8fd 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml
@@ -226,35 +226,6 @@ Calc(select=[a, b, w0$o0], where=[(a > 10)])
                   +- Sort(orderBy=[b ASC, a ASC])
                      +- Calc(select=[a, b])
                         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithoutPartitionBy">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
- SELECT a, b, RANK() OVER (ORDER BY a) rk FROM MyTable) t
-WHERE rk < 10
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], rk=[$2])
-+- LogicalFilter(condition=[<($2, 10)])
-   +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $0 NULLS FIRST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], global=[true], select=[a, b, w0$o0])
-+- Sort(orderBy=[a ASC])
-   +- Exchange(distribution=[single])
-      +- Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], global=[false], select=[a, b])
-         +- Exchange(distribution=[forward])
-            +- Sort(orderBy=[a ASC])
-               +- Calc(select=[a, b])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -374,6 +345,35 @@ Calc(select=[CONCAT('http://txmov2.a.yximgs.com', uri) AS url, reqcount AS downl
                                        +- Exchange(distribution=[forward])
                                           +- Sort(orderBy=[start_time ASC, bucket_id ASC, reqcount DESC])
                                              +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[uri, reqcount, start_time, bucket_id])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithoutPartitionBy">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+ SELECT a, b, RANK() OVER (ORDER BY a) rk FROM MyTable) t
+WHERE rk < 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], rk=[$2])
++- LogicalFilter(condition=[<($2, 10)])
+   +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $0 NULLS FIRST)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], global=[true], select=[a, b, w0$o0])
++- Sort(orderBy=[a ASC])
+   +- Exchange(distribution=[single])
+      +- Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], global=[false], select=[a, b])
+         +- Exchange(distribution=[forward])
+            +- Sort(orderBy=[a ASC])
+               +- Calc(select=[a, b])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml
index baac5667b37..5ed8902e1a8 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml
@@ -514,32 +514,6 @@ Calc(select=[sum_b, (CASE((w0$o0 > 0), w0$o1, null:BIGINT) / w0$o0) AS avg_b, w0
                         +- Sort(orderBy=[a ASC])
                            +- Calc(select=[a, b])
                               +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRemoveCollation_Sort">
-    <Resource name="sql">
-      <![CDATA[
-WITH r AS (SELECT a, b, COUNT(c) AS cnt FROM x GROUP BY a, b)
-SELECT * FROM r ORDER BY a
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSort(sort0=[$0], dir0=[ASC-nulls-first])
-+- LogicalProject(a=[$0], b=[$1], cnt=[$2])
-   +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sort(orderBy=[a ASC])
-+- Exchange(distribution=[single])
-   +- HashAggregate(isMerge=[true], groupBy=[a, b], select=[a, b, Final_COUNT(count$0) AS cnt])
-      +- Exchange(distribution=[hash[a, b]])
-         +- LocalHashAggregate(groupBy=[a, b], select=[a, b, Partial_COUNT(c) AS count$0])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -713,6 +687,32 @@ SortAggregate(isMerge=[false], select=[COUNT(a) AS EXPR$0, SUM(b) AS EXPR$1])
                +- Sort(orderBy=[b ASC])
                   +- Calc(select=[a, b])
                      +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRemoveCollation_Sort">
+    <Resource name="sql">
+      <![CDATA[
+WITH r AS (SELECT a, b, COUNT(c) AS cnt FROM x GROUP BY a, b)
+SELECT * FROM r ORDER BY a
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSort(sort0=[$0], dir0=[ASC-nulls-first])
++- LogicalProject(a=[$0], b=[$1], cnt=[$2])
+   +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sort(orderBy=[a ASC])
++- Exchange(distribution=[single])
+   +- HashAggregate(isMerge=[true], groupBy=[a, b], select=[a, b, Final_COUNT(count$0) AS cnt])
+      +- Exchange(distribution=[hash[a, b]])
+         +- LocalHashAggregate(groupBy=[a, b], select=[a, b, Partial_COUNT(c) AS count$0])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml
index 2fc7095c9c4..be2b0e58f29 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml
@@ -817,29 +817,6 @@ Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=10], partitionBy=[a, c], o
             +- Exchange(distribution=[hash[a]])
                +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
                   +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRemoveSingletonShuffle_HashAgg">
-    <Resource name="sql">
-      <![CDATA[SELECT MAX(b) FROM (SELECT SUM(b) AS b FROM x)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
-+- LogicalAggregate(group=[{}], b=[SUM($0)])
-   +- LogicalProject(b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashAggregate(isMerge=[false], select=[MAX(b) AS EXPR$0])
-+- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS b])
-   +- Exchange(distribution=[single])
-      +- LocalHashAggregate(select=[Partial_SUM(b) AS sum$0])
-         +- Calc(select=[b])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1194,43 +1171,6 @@ MultipleInput(members=[\nSortMergeJoin(joinType=[InnerJoin], where=[(a = d0)], s
 +- Exchange(distribution=[hash[d]])
    +- Calc(select=[d, CAST(2 AS BIGINT) AS e, f], where=[(e = 2)])
       +- LegacyTableSourceScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRemoveSingleExchange_Agg">
-    <Resource name="sql">
-      <![CDATA[SELECT avg(b) FROM x GROUP BY c  HAVING sum(b) > (SELECT sum(b) * 0.1 FROM x)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1])
-+- LogicalFilter(condition=[>($2, $SCALAR_QUERY({
-LogicalProject(EXPR$0=[*($0, 0.1:DECIMAL(2, 1))])
-  LogicalAggregate(group=[{}], agg#0=[SUM($0)])
-    LogicalProject(b=[$1])
-      LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-}))])
-   +- LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)], agg#1=[SUM($1)])
-      +- LogicalProject(c=[$2], b=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0])
-+- MultipleInput(readOrder=[0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[($f2 > $f0)], select=[EXPR$0, $f2, $f0], build=[right], singleRowJoin=[true])\n:- Calc(select=[EXPR$0, $f2])\n:  +- HashAggregate(isMerge=[true], groupBy=[c], select=[c, Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS $f2])\n:     +- [#2] Exchange(distribution=[hash[c]])\n+- [#1] Exchange(distribution=[broadcast])\n])
-   :- Exchange(distribution=[broadcast])
-   :  +- HashAggregate(isMerge=[false], select=[SINGLE_VALUE(EXPR$0) AS $f0])
-   :     +- Calc(select=[($f0 * 0.1) AS EXPR$0])
-   :        +- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS $f0])
-   :           +- Exchange(distribution=[single])
-   :              +- LocalHashAggregate(select=[Partial_SUM(b) AS sum$0])
-   :                 +- Calc(select=[b])
-   :                    +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[c]])
-      +- LocalHashAggregate(groupBy=[c], select=[c, Partial_AVG(b) AS (sum$0, count$1), Partial_SUM(b) AS sum$2])
-         +- Calc(select=[c, b])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1302,7 +1242,44 @@ Calc(select=[c, cnt, c0, cnt0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRemoveSingletonShuffle_SortAgg">
+  <TestCase name="testRemoveSingleExchange_Agg">
+    <Resource name="sql">
+      <![CDATA[SELECT avg(b) FROM x GROUP BY c  HAVING sum(b) > (SELECT sum(b) * 0.1 FROM x)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1])
++- LogicalFilter(condition=[>($2, $SCALAR_QUERY({
+LogicalProject(EXPR$0=[*($0, 0.1:DECIMAL(2, 1))])
+  LogicalAggregate(group=[{}], agg#0=[SUM($0)])
+    LogicalProject(b=[$1])
+      LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+}))])
+   +- LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)], agg#1=[SUM($1)])
+      +- LogicalProject(c=[$2], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[EXPR$0])
++- MultipleInput(readOrder=[0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[($f2 > $f0)], select=[EXPR$0, $f2, $f0], build=[right], singleRowJoin=[true])\n:- Calc(select=[EXPR$0, $f2])\n:  +- HashAggregate(isMerge=[true], groupBy=[c], select=[c, Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS $f2])\n:     +- [#2] Exchange(distribution=[hash[c]])\n+- [#1] Exchange(distribution=[broadcast])\n])
+   :- Exchange(distribution=[broadcast])
+   :  +- HashAggregate(isMerge=[false], select=[SINGLE_VALUE(EXPR$0) AS $f0])
+   :     +- Calc(select=[($f0 * 0.1) AS EXPR$0])
+   :        +- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS $f0])
+   :           +- Exchange(distribution=[single])
+   :              +- LocalHashAggregate(select=[Partial_SUM(b) AS sum$0])
+   :                 +- Calc(select=[b])
+   :                    +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[c]])
+      +- LocalHashAggregate(groupBy=[c], select=[c, Partial_AVG(b) AS (sum$0, count$1), Partial_SUM(b) AS sum$2])
+         +- Calc(select=[c, b])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRemoveSingletonShuffle_HashAgg">
     <Resource name="sql">
       <![CDATA[SELECT MAX(b) FROM (SELECT SUM(b) AS b FROM x)]]>
     </Resource>
@@ -1316,10 +1293,10 @@ LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[false], select=[MAX(b) AS EXPR$0])
-+- SortAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS b])
+HashAggregate(isMerge=[false], select=[MAX(b) AS EXPR$0])
++- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS b])
    +- Exchange(distribution=[single])
-      +- LocalSortAggregate(select=[Partial_SUM(b) AS sum$0])
+      +- LocalHashAggregate(select=[Partial_SUM(b) AS sum$0])
          +- Calc(select=[b])
             +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 ]]>
@@ -1346,6 +1323,29 @@ Calc(select=[sum_b, (CASE((w0$o0 > 0), w0$o1, null:BIGINT) / w0$o0) AS avg_b])
          +- LocalHashAggregate(select=[Partial_SUM(b) AS sum$0])
             +- Calc(select=[b])
                +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRemoveSingletonShuffle_SortAgg">
+    <Resource name="sql">
+      <![CDATA[SELECT MAX(b) FROM (SELECT SUM(b) AS b FROM x)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
++- LogicalAggregate(group=[{}], b=[SUM($0)])
+   +- LogicalProject(b=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+SortAggregate(isMerge=[false], select=[MAX(b) AS EXPR$0])
++- SortAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS b])
+   +- Exchange(distribution=[single])
+      +- LocalSortAggregate(select=[Partial_SUM(b) AS sum$0])
+         +- Calc(select=[b])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelDeleteTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelDeleteTest.xml
index 45291ffb57a..71310ff839c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelDeleteTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelDeleteTest.xml
@@ -16,20 +16,23 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testDeleteWithoutFilter[deleteMode = DELETED_ROWS]">
+  <TestCase name="testDeleteWithCustomColumns[deleteMode = DELETED_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+LogicalSink(table=[default_catalog.default_database.t], fields=[b, c])
++- LogicalProject(b=[$1], c=[$2])
+   +- LogicalFilter(condition=[=($1, _UTF-16LE'123')])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], fields=[b, c])
++- Calc(select=[CAST('123' AS VARCHAR(2147483647)) AS b, c], where=[=(b, '123')])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], fields=[b, c])
++- Calc(select=[CAST('123' AS VARCHAR(2147483647)) AS b, c], where=[(b = '123')])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
 
 == Physical Execution Plan ==
 {
@@ -37,8 +40,19 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     "id" : ,
     "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])",
     "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[CAST('123' AS VARCHAR(2147483647)) AS b, c], where=[(b = '123')])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
   }, {
     "id" : ,
     "type" : "RowKindSetter[]",
@@ -65,23 +79,23 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithFilter[deleteMode = DELETED_ROWS]">
-	<Resource name="explain">
+  <TestCase name="testDeleteWithCustomColumns[deleteMode = REMAINING_ROWS]">
+    <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[AND(=($0, 1), =($1, _UTF-16LE'123'))])
+LogicalSink(table=[default_catalog.default_database.t], fields=[b, c])
++- LogicalProject(b=[$1], c=[$2])
+   +- LogicalFilter(condition=[NOT(=($1, _UTF-16LE'123'))])
       +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Calc(select=[CAST(1 AS INTEGER) AS a, CAST('123' AS VARCHAR(2147483647)) AS b], where=[AND(=(a, 1), =(b, '123'))])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], fields=[b, c])
++- Calc(select=[b, c], where=[<>(b, '123')])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Calc(select=[CAST(1 AS INTEGER) AS a, CAST('123' AS VARCHAR(2147483647)) AS b], where=[((a = 1) AND (b = '123'))])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], fields=[b, c])
++- Calc(select=[b, c], where=[(b <> '123')])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
 
 == Physical Execution Plan ==
 {
@@ -89,24 +103,13 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     "id" : ,
     "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])",
     "parallelism" : 1
   }, {
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[CAST(1 AS INTEGER) AS a, CAST('123' AS VARCHAR(2147483647)) AS b], where=[((a = 1) AND (b = '123'))])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "RowKindSetter[]",
-    "pact" : "Operator",
-    "contents" : "[]:RowKindSetter(TargetRowKind=[DELETE])",
+    "contents" : "[]:Calc(select=[b, c], where=[(b <> '123')])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -126,43 +129,25 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithSubQuery[deleteMode = DELETED_ROWS]">
+  <TestCase name="testDeleteWithFilter[deleteMode = DELETED_ROWS]">
     <Resource name="explain">
-	  <![CDATA[== Abstract Syntax Tree ==
+      <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
 +- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[AND(=($1, _UTF-16LE'123'), =(CAST($0):BIGINT, $SCALAR_QUERY({
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})))])
+   +- LogicalFilter(condition=[AND(=($0, 1), =($1, _UTF-16LE'123'))])
       +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
 Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Calc(select=[a, CAST('123' AS VARCHAR(2147483647)) AS b])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a0, EXPR$0)], select=[a, a0, EXPR$0], build=[right], singleRowJoin=[true])
-      :- Calc(select=[a, CAST(a AS BIGINT) AS a0], where=[=(b, '123')])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
-      +- Exchange(distribution=[broadcast])
-         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
-            +- Exchange(distribution=[single])
-               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
-                  +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
++- Calc(select=[CAST(1 AS INTEGER) AS a, CAST('123' AS VARCHAR(2147483647)) AS b], where=[AND(=(a, 1), =(b, '123'))])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Optimized Execution Plan ==
 Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Calc(select=[a, CAST('123' AS VARCHAR(2147483647)) AS b])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[(a0 = EXPR$0)], select=[a, a0, EXPR$0], build=[right], singleRowJoin=[true])
-      :- Exchange(distribution=[any], shuffle_mode=[BATCH])
-      :  +- Calc(select=[a, CAST(a AS BIGINT) AS a0], where=[(b = '123')])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])(reuse_id=[1])
-      +- Exchange(distribution=[broadcast])
-         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
-            +- Exchange(distribution=[single])
-               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
-                  +- Reused(reference_id=[1])
++- Calc(select=[CAST(1 AS INTEGER) AS a, CAST('123' AS VARCHAR(2147483647)) AS b], where=[((a = 1) AND (b = '123'))])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Physical Execution Plan ==
 {
@@ -176,67 +161,19 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, CAST(a AS BIGINT) AS a0], where=[(b = '123')])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "HashAggregate[]",
-    "pact" : "Operator",
-    "contents" : "[]:LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])",
+    "contents" : "[]:Calc(select=[CAST(1 AS INTEGER) AS a, CAST('123' AS VARCHAR(2147483647)) AS b], where=[((a = 1) AND (b = '123'))])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
     } ]
-  }, {
-    "id" : ,
-    "type" : "HashAggregate[]",
-    "pact" : "Operator",
-    "contents" : "[]:HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "GLOBAL",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "NestedLoopJoin[]",
-    "pact" : "Operator",
-    "contents" : "[]:NestedLoopJoin(joinType=[InnerJoin], where=[(a0 = EXPR$0)], select=[a, a0, EXPR$0], build=[right], singleRowJoin=[true])",
-    "parallelism" : 12,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "REBALANCE",
-      "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "BROADCAST",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, CAST('123' AS VARCHAR(2147483647)) AS b])",
-    "parallelism" : 12,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
   }, {
     "id" : ,
     "type" : "RowKindSetter[]",
     "pact" : "Operator",
     "contents" : "[]:RowKindSetter(TargetRowKind=[DELETE])",
-    "parallelism" : 12,
+    "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "FORWARD",
@@ -250,30 +187,30 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "REBALANCE",
+      "ship_strategy" : "FORWARD",
       "side" : "second"
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithCustomColumns[deleteMode = DELETED_ROWS]">
+  <TestCase name="testDeleteWithFilter[deleteMode = REMAINING_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], fields=[b, c])
-+- LogicalProject(b=[$1], c=[$2])
-   +- LogicalFilter(condition=[=($1, _UTF-16LE'123')])
+LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalFilter(condition=[NOT(AND(=($0, 1), =($1, _UTF-16LE'123')))])
       +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[b, c])
-+- Calc(select=[CAST('123' AS VARCHAR(2147483647)) AS b, c], where=[=(b, '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.t], fields=[a, b])
++- Calc(select=[a, b], where=[OR(<>(a, 1), <>(b, '123'))])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[b, c])
-+- Calc(select=[CAST('123' AS VARCHAR(2147483647)) AS b, c], where=[(b = '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.t], fields=[a, b])
++- Calc(select=[a, b], where=[((a <> 1) OR (b <> '123'))])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Physical Execution Plan ==
 {
@@ -281,24 +218,13 @@ Sink(table=[default_catalog.default_database.t], fields=[b, c])
     "id" : ,
     "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])",
     "parallelism" : 1
   }, {
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[CAST('123' AS VARCHAR(2147483647)) AS b, c], where=[(b = '123')])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "RowKindSetter[]",
-    "pact" : "Operator",
-    "contents" : "[]:RowKindSetter(TargetRowKind=[DELETE])",
+    "contents" : "[]:Calc(select=[a, b], where=[((a <> 1) OR (b <> '123'))])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -318,7 +244,7 @@ Sink(table=[default_catalog.default_database.t], fields=[b, c])
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
   <TestCase name="testDeleteWithMetaColumns[deleteMode = DELETED_ROWS]">
     <Resource name="explain">
@@ -381,32 +307,45 @@ Sink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithoutFilter[deleteMode = REMAINING_ROWS]">
+  <TestCase name="testDeleteWithMetaColumns[deleteMode = REMAINING_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[false])
+LogicalSink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
++- LogicalProject(meta_f1=[$3], meta_f2=[$4], b=[$1])
+   +- LogicalFilter(condition=[NOT(=($1, _UTF-16LE'123'))])
       +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Values(tuples=[[]], values=[a, b])
+Sink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
++- Calc(select=[meta_f1, meta_f2, b], where=[<>(b, '123')])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Values(tuples=[[]], values=[a, b])
+Sink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
++- Calc(select=[meta_f1, meta_f2, b], where=[(b <> '123')])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
 
 == Physical Execution Plan ==
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: Values[]",
+    "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:Values(tuples=[[]], values=[a, b])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])",
     "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[meta_f1, meta_f2, b], where=[(b <> '123')])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
   }, {
     "id" : ,
     "type" : "Sink: Unnamed",
@@ -422,23 +361,41 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithFilter[deleteMode = REMAINING_ROWS]">
+  <TestCase name="testDeleteWithSubQuery[deleteMode = DELETED_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
 +- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[NOT(AND(=($0, 1), =($1, _UTF-16LE'123')))])
+   +- LogicalFilter(condition=[AND(=($1, _UTF-16LE'123'), =(CAST($0):BIGINT, $SCALAR_QUERY({
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})))])
       +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
 Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Calc(select=[a, b], where=[OR(<>(a, 1), <>(b, '123'))])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
++- Calc(select=[a, CAST('123' AS VARCHAR(2147483647)) AS b])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a0, EXPR$0)], select=[a, a0, EXPR$0], build=[right], singleRowJoin=[true])
+      :- Calc(select=[a, CAST(a AS BIGINT) AS a0], where=[=(b, '123')])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+      +- Exchange(distribution=[broadcast])
+         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
+            +- Exchange(distribution=[single])
+               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
+                  +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Optimized Execution Plan ==
 Sink(table=[default_catalog.default_database.t], fields=[a, b])
-+- Calc(select=[a, b], where=[((a <> 1) OR (b <> '123'))])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
++- Calc(select=[a, CAST('123' AS VARCHAR(2147483647)) AS b])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[(a0 = EXPR$0)], select=[a, a0, EXPR$0], build=[right], singleRowJoin=[true])
+      :- Exchange(distribution=[any], shuffle_mode=[BATCH])
+      :  +- Calc(select=[a, CAST(a AS BIGINT) AS a0], where=[(b = '123')])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])(reuse_id=[1])
+      +- Exchange(distribution=[broadcast])
+         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
+            +- Exchange(distribution=[single])
+               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
+                  +- Reused(reference_id=[1])
 
 == Physical Execution Plan ==
 {
@@ -452,13 +409,72 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b], where=[((a <> 1) OR (b <> '123'))])",
+    "contents" : "[]:Calc(select=[a, CAST(a AS BIGINT) AS a0], where=[(b = '123')])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "HashAggregate[]",
+    "pact" : "Operator",
+    "contents" : "[]:LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
     } ]
+  }, {
+    "id" : ,
+    "type" : "HashAggregate[]",
+    "pact" : "Operator",
+    "contents" : "[]:HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "GLOBAL",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "NestedLoopJoin[]",
+    "pact" : "Operator",
+    "contents" : "[]:NestedLoopJoin(joinType=[InnerJoin], where=[(a0 = EXPR$0)], select=[a, a0, EXPR$0], build=[right], singleRowJoin=[true])",
+    "parallelism" : 12,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "REBALANCE",
+      "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "BROADCAST",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[a, CAST('123' AS VARCHAR(2147483647)) AS b])",
+    "parallelism" : 12,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "RowKindSetter[]",
+    "pact" : "Operator",
+    "contents" : "[]:RowKindSetter(TargetRowKind=[DELETE])",
+    "parallelism" : 12,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
   }, {
     "id" : ,
     "type" : "Sink: Unnamed",
@@ -467,16 +483,16 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "FORWARD",
+      "ship_strategy" : "REBALANCE",
       "side" : "second"
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
   <TestCase name="testDeleteWithSubQuery[deleteMode = REMAINING_ROWS]">
     <Resource name="explain">
-		<![CDATA[== Abstract Syntax Tree ==
+      <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalFilter(condition=[NOT(AND(=($1, _UTF-16LE'123'), =(CAST($0):BIGINT, $SCALAR_QUERY({
@@ -577,25 +593,22 @@ Sink(table=[default_catalog.default_database.t], fields=[a, b])
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithCustomColumns[deleteMode = REMAINING_ROWS]">
+  <TestCase name="testDeleteWithoutFilter[deleteMode = DELETED_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], fields=[b, c])
-+- LogicalProject(b=[$1], c=[$2])
-   +- LogicalFilter(condition=[NOT(=($1, _UTF-16LE'123'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[b, c])
-+- Calc(select=[b, c], where=[<>(b, '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.t], fields=[a, b])
++- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[b, c])
-+- Calc(select=[b, c], where=[(b <> '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.t], fields=[a, b])
++- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Physical Execution Plan ==
 {
@@ -603,13 +616,13 @@ Sink(table=[default_catalog.default_database.t], fields=[b, c])
     "id" : ,
     "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "RowKindSetter[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[b, c], where=[(b <> '123')])",
+    "contents" : "[]:RowKindSetter(TargetRowKind=[DELETE])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -629,45 +642,32 @@ Sink(table=[default_catalog.default_database.t], fields=[b, c])
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testDeleteWithMetaColumns[deleteMode = REMAINING_ROWS]">
+  <TestCase name="testDeleteWithoutFilter[deleteMode = REMAINING_ROWS]">
     <Resource name="explain">
-	  <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
-+- LogicalProject(meta_f1=[$3], meta_f2=[$4], b=[$1])
-   +- LogicalFilter(condition=[NOT(=($1, _UTF-16LE'123'))])
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalSink(table=[default_catalog.default_database.t], fields=[a, b])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalFilter(condition=[false])
       +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
-+- Calc(select=[meta_f1, meta_f2, b], where=[<>(b, '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
+Sink(table=[default_catalog.default_database.t], fields=[a, b])
++- Values(tuples=[[]], values=[a, b])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
-+- Calc(select=[meta_f1, meta_f2, b], where=[(b <> '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
+Sink(table=[default_catalog.default_database.t], fields=[a, b])
++- Values(tuples=[[]], values=[a, b])
 
 == Physical Execution Plan ==
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: t[]",
+    "type" : "Source: Values[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])",
+    "contents" : "[]:Values(tuples=[[]], values=[a, b])",
     "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[meta_f1, meta_f2, b], where=[(b <> '123')])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
   }, {
     "id" : ,
     "type" : "Sink: Unnamed",
@@ -681,6 +681,6 @@ Sink(table=[default_catalog.default_database.t], fields=[meta_f1, meta_f2, b])
     } ]
   } ]
 }]]>
-	</Resource>
+    </Resource>
   </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelUpdateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelUpdateTest.xml
index 19557da72d8..85e79a8c0ec 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelUpdateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RowLevelUpdateTest.xml
@@ -409,21 +409,22 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a,
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpdateWithoutFilter[updateMode = UPDATED_ROWS]">
+  <TestCase name="testUpdateWithFilter[updateMode = UPDATED_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields=[a, b])
-+- LogicalProject(a=[*(CHAR_LENGTH($1), $0)], b=[_UTF-16LE'n1'])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
++- LogicalProject(a=[$0], b=[_UTF-16LE'v2'])
+   +- LogicalFilter(condition=[AND(=($0, 123), =($1, _UTF-16LE'v1'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields=[a, b])
-+- Calc(select=[*(CHAR_LENGTH(b), a) AS a, 'n1' AS b])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
++- Calc(select=[CAST(123 AS INTEGER) AS a, 'v2' AS b], where=[AND(=(a, 123), =(b, 'v1'))])
    +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields=[a, b])
-+- Calc(select=[(CHAR_LENGTH(b) * a) AS a, 'n1' AS b])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
++- Calc(select=[CAST(123 AS INTEGER) AS a, 'v2' AS b], where=[((a = 123) AND (b = 'v1'))])
    +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Physical Execution Plan ==
@@ -438,7 +439,7 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[(CHAR_LENGTH(b) * a) AS a, 'n1' AS b])",
+    "contents" : "[]:Calc(select=[CAST(123 AS INTEGER) AS a, 'v2' AS b], where=[((a = 123) AND (b = 'v1'))])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -471,23 +472,22 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpdateWithFilter[updateMode = UPDATED_ROWS]">
+  <TestCase name="testUpdateWithMetaColumns[updateMode = ALL_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
-+- LogicalProject(a=[$0], b=[_UTF-16LE'v2'])
-   +- LogicalFilter(condition=[AND(=($0, 123), =($1, _UTF-16LE'v1'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
++- LogicalProject(meta_f1=[$3], meta_f2=[$4], a=[$0], b=[IF(=($1, _UTF-16LE'123'), _UTF-16LE'v2', $1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
-+- Calc(select=[CAST(123 AS INTEGER) AS a, 'v2' AS b], where=[AND(=(a, 123), =(b, 'v1'))])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
++- Calc(select=[meta_f1, meta_f2, a, IF(=(b, '123'), 'v2', b) AS b])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
-+- Calc(select=[CAST(123 AS INTEGER) AS a, 'v2' AS b], where=[((a = 123) AND (b = 'v1'))])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
++- Calc(select=[meta_f1, meta_f2, a, IF((b = '123'), 'v2', b) AS b])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
 
 == Physical Execution Plan ==
 {
@@ -495,24 +495,13 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a,
     "id" : ,
     "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])",
     "parallelism" : 1
   }, {
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[CAST(123 AS INTEGER) AS a, 'v2' AS b], where=[((a = 123) AND (b = 'v1'))])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "RowKindSetter[]",
-    "pact" : "Operator",
-    "contents" : "[]:RowKindSetter(TargetRowKind=[UPDATE_AFTER])",
+    "contents" : "[]:Calc(select=[meta_f1, meta_f2, a, IF((b = '123'), 'v2', b) AS b])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -534,21 +523,22 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a,
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpdateWithMetaColumns[updateMode = ALL_ROWS]">
+  <TestCase name="testUpdateWithMetaColumns[updateMode = UPDATED_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
-+- LogicalProject(meta_f1=[$3], meta_f2=[$4], a=[$0], b=[IF(=($1, _UTF-16LE'123'), _UTF-16LE'v2', $1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
++- LogicalProject(meta_f1=[$3], meta_f2=[$4], a=[$0], b=[_UTF-16LE'v2'])
+   +- LogicalFilter(condition=[=($1, _UTF-16LE'123')])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
 Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
-+- Calc(select=[meta_f1, meta_f2, a, IF(=(b, '123'), 'v2', b) AS b])
++- Calc(select=[meta_f1, meta_f2, a, 'v2' AS b], where=[=(b, '123')])
    +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
 
 == Optimized Execution Plan ==
 Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
-+- Calc(select=[meta_f1, meta_f2, a, IF((b = '123'), 'v2', b) AS b])
++- Calc(select=[meta_f1, meta_f2, a, 'v2' AS b], where=[(b = '123')])
    +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
 
 == Physical Execution Plan ==
@@ -563,7 +553,18 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[me
     "id" : ,
     "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[meta_f1, meta_f2, a, IF((b = '123'), 'v2', b) AS b])",
+    "contents" : "[]:Calc(select=[meta_f1, meta_f2, a, 'v2' AS b], where=[(b = '123')])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "RowKindSetter[]",
+    "pact" : "Operator",
+    "contents" : "[]:RowKindSetter(TargetRowKind=[UPDATE_AFTER])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -585,23 +586,37 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[me
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpdateWithMetaColumns[updateMode = UPDATED_ROWS]">
+  <TestCase name="testUpdateWithSubQuery[updateMode = ALL_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
-+- LogicalProject(meta_f1=[$3], meta_f2=[$4], a=[$0], b=[_UTF-16LE'v2'])
-   +- LogicalFilter(condition=[=($1, _UTF-16LE'123')])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
++- LogicalProject(a=[$0], b=[IF(=(CAST($0):BIGINT, $SCALAR_QUERY({
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+  LogicalTableScan(table=[[default_catalog, default_database, t1]])
+})), _UTF-16LE'v2', $1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
-+- Calc(select=[meta_f1, meta_f2, a, 'v2' AS b], where=[=(b, '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
++- Calc(select=[a, IF(=(CAST(a AS BIGINT), EXPR$0), 'v2', b) AS b])
+   +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[true], select=[a, b, EXPR$0], build=[right], singleRowJoin=[true])
+      :- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+      +- Exchange(distribution=[broadcast])
+         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
+            +- Exchange(distribution=[single])
+               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
+                  +- TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[meta_f1, meta_f2, a, b])
-+- Calc(select=[meta_f1, meta_f2, a, 'v2' AS b], where=[(b = '123')])
-   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
++- Calc(select=[a, IF((CAST(a AS BIGINT) = EXPR$0), 'v2', b) AS b])
+   +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[true], select=[a, b, EXPR$0], build=[right], singleRowJoin=[true])
+      :- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
+      +- Exchange(distribution=[broadcast])
+         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
+            +- Exchange(distribution=[single])
+               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
+                  +- TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])
 
 == Physical Execution Plan ==
 {
@@ -609,13 +624,19 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[me
     "id" : ,
     "type" : "Source: t[]",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, meta_f1, meta_f2])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Source: t1[]",
+    "pact" : "Data Source",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])",
+    "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "HashAggregate[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[meta_f1, meta_f2, a, 'v2' AS b], where=[(b = '123')])",
+    "contents" : "[]:LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -624,9 +645,35 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[me
     } ]
   }, {
     "id" : ,
-    "type" : "RowKindSetter[]",
+    "type" : "HashAggregate[]",
     "pact" : "Operator",
-    "contents" : "[]:RowKindSetter(TargetRowKind=[UPDATE_AFTER])",
+    "contents" : "[]:HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "GLOBAL",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "NestedLoopJoin[]",
+    "pact" : "Operator",
+    "contents" : "[]:NestedLoopJoin(joinType=[LeftOuterJoin], where=[true], select=[a, b, EXPR$0], build=[right], singleRowJoin=[true])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "BROADCAST",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[a, IF((CAST(a AS BIGINT) = EXPR$0), 'v2', b) AS b])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -833,37 +880,22 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpdateWithSubQuery[updateMode = ALL_ROWS]">
+  <TestCase name="testUpdateWithoutFilter[updateMode = UPDATED_ROWS]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
-+- LogicalProject(a=[$0], b=[IF(=(CAST($0):BIGINT, $SCALAR_QUERY({
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
-  LogicalTableScan(table=[[default_catalog, default_database, t1]])
-})), _UTF-16LE'v2', $1)])
+LogicalSink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields=[a, b])
++- LogicalProject(a=[*(CHAR_LENGTH($1), $0)], b=[_UTF-16LE'n1'])
    +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 
 == Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
-+- Calc(select=[a, IF(=(CAST(a AS BIGINT), EXPR$0), 'v2', b) AS b])
-   +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[true], select=[a, b, EXPR$0], build=[right], singleRowJoin=[true])
-      :- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
-      +- Exchange(distribution=[broadcast])
-         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
-            +- Exchange(distribution=[single])
-               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
-                  +- TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields=[a, b])
++- Calc(select=[*(CHAR_LENGTH(b), a) AS a, 'n1' AS b])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a, b])
-+- Calc(select=[a, IF((CAST(a AS BIGINT) = EXPR$0), 'v2', b) AS b])
-   +- NestedLoopJoin(joinType=[LeftOuterJoin], where=[true], select=[a, b, EXPR$0], build=[right], singleRowJoin=[true])
-      :- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
-      +- Exchange(distribution=[broadcast])
-         +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
-            +- Exchange(distribution=[single])
-               +- LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])
-                  +- TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])
+Sink(table=[default_catalog.default_database.t], targetColumns=[[1],[0]], fields=[a, b])
++- Calc(select=[(CHAR_LENGTH(b) * a) AS a, 'n1' AS b])
+   +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b])
 
 == Physical Execution Plan ==
 {
@@ -875,52 +907,20 @@ Sink(table=[default_catalog.default_database.t], targetColumns=[[1]], fields=[a,
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Source: t1[]",
-    "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "HashAggregate[]",
-    "pact" : "Operator",
-    "contents" : "[]:LocalHashAggregate(select=[Partial_COUNT(*) AS count1$0])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "HashAggregate[]",
-    "pact" : "Operator",
-    "contents" : "[]:HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "GLOBAL",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "NestedLoopJoin[]",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "[]:NestedLoopJoin(joinType=[LeftOuterJoin], where=[true], select=[a, b, EXPR$0], build=[right], singleRowJoin=[true])",
+    "contents" : "[]:Calc(select=[(CHAR_LENGTH(b) * a) AS a, 'n1' AS b])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "BROADCAST",
-      "side" : "second"
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "RowKindSetter[]",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, IF((CAST(a AS BIGINT) = EXPR$0), 'v2', b) AS b])",
+    "contents" : "[]:RowKindSetter(TargetRowKind=[UPDATE_AFTER])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SetOperatorsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SetOperatorsTest.xml
index fa0b82c9cf4..4cd9988c458 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SetOperatorsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SetOperatorsTest.xml
@@ -266,16 +266,16 @@ HashAggregate(isMerge=[false], groupBy=[a, b, c], select=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnionNullableTypes">
+  <TestCase name="testUnionAnyType">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM A UNION ALL SELECT CASE WHEN c > 0 THEN b ELSE NULL END FROM A]]>
+      <![CDATA[SELECT a FROM A UNION ALL SELECT b FROM A]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
 :  +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-+- LogicalProject(EXPR$0=[CASE(>($2, 0), $1, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" _2))])
++- LogicalProject(b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
@@ -283,22 +283,22 @@ LogicalUnion(all=[true])
       <![CDATA[
 Union(all=[true], union=[a])
 :- Calc(select=[a])
-:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b, c])(reuse_id=[1])
-+- Calc(select=[CASE((c > 0), b, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)) AS EXPR$0])
+:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b])(reuse_id=[1])
++- Calc(select=[b])
    +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnionAnyType">
+  <TestCase name="testUnionNullableTypes">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM A UNION ALL SELECT b FROM A]]>
+      <![CDATA[SELECT a FROM A UNION ALL SELECT CASE WHEN c > 0 THEN b ELSE NULL END FROM A]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
 :  +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-+- LogicalProject(b=[$1])
++- LogicalProject(EXPR$0=[CASE(>($2, 0), $1, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" _2))])
    +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
@@ -306,8 +306,8 @@ LogicalUnion(all=[true])
       <![CDATA[
 Union(all=[true], union=[a])
 :- Calc(select=[a])
-:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b])(reuse_id=[1])
-+- Calc(select=[b])
+:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b, c])(reuse_id=[1])
++- Calc(select=[CASE((c > 0), b, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)) AS EXPR$0])
    +- Reused(reference_id=[1])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortLimitTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortLimitTest.xml
index 6fdbcc3a8e2..2a87980a453 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortLimitTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortLimitTest.xml
@@ -16,33 +16,32 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testNoneRangeSortWithOffsetLimit">
+  <TestCase name="testNonRangeSortOnlyWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC, b LIMIT 10 OFFSET 1]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC OFFSET 10 ROWS]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[1], fetch=[10])
+LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], offset=[10])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC, b ASC], offset=[1], fetch=[10], global=[true])
+SortLimit(orderBy=[a DESC], offset=[10], fetch=[unlimited], global=[true])
 +- Exchange(distribution=[single])
-   +- SortLimit(orderBy=[a DESC, b ASC], offset=[0], fetch=[11], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoneRangeSortWithOffsetLimit0">
+  <TestCase name="testNonRangeSortWithLimit0">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC, b LIMIT 0 OFFSET 1]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[1], fetch=[0])
+LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[0])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -53,115 +52,116 @@ Values(tuples=[[]], values=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonRangeSortOnlyWithOffset">
+  <TestCase name="testNonRangeSortWithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC OFFSET 10 ROWS]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], offset=[10])
+LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[5])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC], offset=[10], fetch=[unlimited], global=[true])
+SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[true])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonRangeSortWithLimit0">
+  <TestCase name="testNoneRangeSortWithOffsetLimit">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 0]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC, b LIMIT 10 OFFSET 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[0])
+LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[1], fetch=[10])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Values(tuples=[[]], values=[a, b, c])
+SortLimit(orderBy=[a DESC, b ASC], offset=[1], fetch=[10], global=[true])
++- Exchange(distribution=[single])
+   +- SortLimit(orderBy=[a DESC, b ASC], offset=[0], fetch=[11], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonRangeSortWithoutOffset">
+  <TestCase name="testNoneRangeSortWithOffsetLimit0">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 5]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC, b LIMIT 0 OFFSET 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[5])
+LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[1], fetch=[0])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[true])
-+- Exchange(distribution=[single])
-   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Values(tuples=[[]], values=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRangeSortOnlyWithOffset">
+  <TestCase name="testRangeSortOnWithLimit0">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC OFFSET 10 ROWS]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], offset=[10])
+LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[0])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC], offset=[10], fetch=[unlimited], global=[true])
-+- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Values(tuples=[[]], values=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRangeSortOnWithLimit0">
+  <TestCase name="testRangeSortOnWithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 0]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[0])
+LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[5])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Values(tuples=[[]], values=[a, b, c])
+SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[true])
++- Exchange(distribution=[single])
+   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRangeSortOnWithoutOffset">
+  <TestCase name="testRangeSortOnlyWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC LIMIT 5]]>
+      <![CDATA[SELECT * FROM MyTable ORDER BY a DESC OFFSET 10 ROWS]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[5])
+LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], offset=[10])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[true])
+SortLimit(orderBy=[a DESC], offset=[10], fetch=[unlimited], global=[true])
 +- Exchange(distribution=[single])
-   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[5], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortTest.xml
index 1a8d48861b9..1a6ee5d248c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SortTest.xml
@@ -35,7 +35,7 @@ Sort(orderBy=[a DESC, b ASC])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRangeSortWithForceLimit">
+  <TestCase name="testNonRangeSortOnSingleFieldWithoutForceLimit">
     <Resource name="sql">
       <![CDATA[SELECT * FROM MyTable ORDER BY a DESC]]>
     </Resource>
@@ -46,16 +46,15 @@ LogicalSort(sort0=[$0], dir0=[DESC-nulls-last])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
-    <Resource name="optimized rel plan">
+    <Resource name="optimized exec plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[true])
+Sort(orderBy=[a DESC])
 +- Exchange(distribution=[single])
-   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonRangeSortOnSingleFieldWithoutForceLimit">
+  <TestCase name="testNonRangeSortWithForceLimit">
     <Resource name="sql">
       <![CDATA[SELECT * FROM MyTable ORDER BY a DESC]]>
     </Resource>
@@ -68,13 +67,14 @@ LogicalSort(sort0=[$0], dir0=[DESC-nulls-last])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sort(orderBy=[a DESC])
+SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[true])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRangeSortWithoutForceLimit">
+  <TestCase name="testRangeSortWithForceLimit">
     <Resource name="sql">
       <![CDATA[SELECT * FROM MyTable ORDER BY a DESC]]>
     </Resource>
@@ -87,13 +87,14 @@ LogicalSort(sort0=[$0], dir0=[DESC-nulls-last])
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sort(orderBy=[a DESC])
+SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[true])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[false])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonRangeSortWithForceLimit">
+  <TestCase name="testRangeSortWithoutForceLimit">
     <Resource name="sql">
       <![CDATA[SELECT * FROM MyTable ORDER BY a DESC]]>
     </Resource>
@@ -104,12 +105,11 @@ LogicalSort(sort0=[$0], dir0=[DESC-nulls-last])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
-    <Resource name="optimized exec plan">
+    <Resource name="optimized rel plan">
       <![CDATA[
-SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[true])
+Sort(orderBy=[a DESC])
 +- Exchange(distribution=[single])
-   +- SortLimit(orderBy=[a DESC], offset=[0], fetch=[200], global=[false])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SubplanReuseTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SubplanReuseTest.xml
index 4fb095acffc..925122858d1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SubplanReuseTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/SubplanReuseTest.xml
@@ -699,42 +699,6 @@ MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[
 :     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
 +- Exchange(distribution=[hash[c]])
    +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSubplanReuseOnSourceWithLimit">
-    <Resource name="sql">
-      <![CDATA[
-WITH r AS (SELECT a, b FROM x LIMIT 10)
-SELECT r1.a, r1.b, r2.a FROM r r1, r r2 WHERE r1.a = r2.b
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], a0=[$2])
-+- LogicalFilter(condition=[=(CAST($0):BIGINT, $3)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalSort(fetch=[10])
-      :  +- LogicalProject(a=[$0], b=[$1])
-      :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      +- LogicalSort(fetch=[10])
-         +- LogicalProject(a=[$0], b=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, b, a1 AS a0])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[(a0 = b0)], select=[a, b, a0, a1, b0], build=[right])
-   :- Exchange(distribution=[any], shuffle_mode=[BATCH])
-   :  +- Calc(select=[a, b, CAST(a AS BIGINT) AS a0])
-   :     +- Limit(offset=[0], fetch=[10], global=[true])(reuse_id=[1])
-   :        +- Exchange(distribution=[single])
-   :           +- Limit(offset=[0], fetch=[10], global=[false])
-   :              +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-   +- Exchange(distribution=[broadcast])
-      +- Calc(select=[a, b])
-         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1041,6 +1005,39 @@ NestedLoopJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, e, f,
 :     +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
 +- Exchange(distribution=[any], shuffle_mode=[BATCH])
    +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSubplanReuseOnOverWindow">
+    <Resource name="sql">
+      <![CDATA[
+WITH r AS (SELECT a, b, RANK() OVER (ORDER BY c DESC) FROM x)
+SELECT * FROM r r1, r r2 WHERE r1.a = r2.a AND r1.b < 100 AND r2.b > 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], EXPR$2=[$2], a0=[$3], b0=[$4], EXPR$20=[$5])
++- LogicalFilter(condition=[AND(=($0, $3), <($1, 100), >($4, 10))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      +- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, w0$o0, a0, b0, w0$o00], build=[left])
+:- Exchange(distribution=[hash[a]])
+:  +- Calc(select=[a, b, w0$o0], where=[(b < 100)])
+:     +- OverAggregate(orderBy=[c DESC], window#0=[RANK(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, c, w0$o0])(reuse_id=[1])
+:        +- Sort(orderBy=[c DESC])
+:           +- Exchange(distribution=[single])
+:              +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
++- Exchange(distribution=[hash[a]])
+   +- Calc(select=[a, b, w0$o0], where=[(b > 10)])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1153,36 +1150,78 @@ Calc(select=[c, a, b, c0, a1, b0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSubplanReuseOnOverWindow">
+  <TestCase name="testSubplanReuseOnSortLimit">
     <Resource name="sql">
       <![CDATA[
-WITH r AS (SELECT a, b, RANK() OVER (ORDER BY c DESC) FROM x)
-SELECT * FROM r r1, r r2 WHERE r1.a = r2.a AND r1.b < 100 AND r2.b > 10
+WITH r AS (SELECT c, SUM(a) a, SUM(b) b FROM x GROUP BY c ORDER BY a, b DESC LIMIT 10)
+SELECT * FROM r r1, r r2 WHERE r1.a = r2.a AND r1.a > 1 AND r2.b < 10
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], EXPR$2=[$2], a0=[$3], b0=[$4], EXPR$20=[$5])
-+- LogicalFilter(condition=[AND(=($0, $3), <($1, 100), >($4, 10))])
+LogicalProject(c=[$0], a=[$1], b=[$2], c0=[$3], a0=[$4], b0=[$5])
++- LogicalFilter(condition=[AND(=($1, $4), >($1, 1), <($5, 10))])
    +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      +- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      :- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last], fetch=[10])
+      :  +- LogicalAggregate(group=[{0}], a=[SUM($1)], b=[SUM($2)])
+      :     +- LogicalProject(c=[$2], a=[$0], b=[$1])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      +- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last], fetch=[10])
+         +- LogicalAggregate(group=[{0}], a=[SUM($1)], b=[SUM($2)])
+            +- LogicalProject(c=[$2], a=[$0], b=[$1])
+               +- LogicalTableScan(table=[[default_catalog, default_database, x]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, w0$o0, a0, b0, w0$o00], build=[left])
-:- Exchange(distribution=[hash[a]])
-:  +- Calc(select=[a, b, w0$o0], where=[(b < 100)])
-:     +- OverAggregate(orderBy=[c DESC], window#0=[RANK(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, c, w0$o0])(reuse_id=[1])
-:        +- Sort(orderBy=[c DESC])
-:           +- Exchange(distribution=[single])
-:              +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-+- Exchange(distribution=[hash[a]])
-   +- Calc(select=[a, b, w0$o0], where=[(b > 10)])
+NestedLoopJoin(joinType=[InnerJoin], where=[(a = a0)], select=[c, a, b, c0, a0, b0], build=[right])
+:- Exchange(distribution=[any], shuffle_mode=[BATCH])
+:  +- Calc(select=[c, a, b], where=[(a > 1)])
+:     +- SortLimit(orderBy=[a ASC, b DESC], offset=[0], fetch=[10], global=[true])(reuse_id=[1])
+:        +- Exchange(distribution=[single])
+:           +- SortLimit(orderBy=[a ASC, b DESC], offset=[0], fetch=[10], global=[false])
+:              +- HashAggregate(isMerge=[true], groupBy=[c], select=[c, Final_SUM(sum$0) AS a, Final_SUM(sum$1) AS b])
+:                 +- Exchange(distribution=[hash[c]])
+:                    +- LocalHashAggregate(groupBy=[c], select=[c, Partial_SUM(a) AS sum$0, Partial_SUM(b) AS sum$1])
+:                       +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[c, a, b], where=[((b < 10) AND (a > 1))])
       +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSubplanReuseOnSortMergeJoin">
+    <Resource name="sql">
+      <![CDATA[
+WITH r AS (SELECT * FROM x, y WHERE a = d AND c LIKE 'He%')
+SELECT * FROM r r1, r r2 WHERE r1.a = r2.d
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], a0=[$6], b0=[$7], c0=[$8], d0=[$9], e0=[$10], f0=[$11])
++- LogicalFilter(condition=[=($0, $9)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+      :  +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+      :     +- LogicalJoin(condition=[true], joinType=[inner])
+      :        :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(members=[\nSortMergeJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, e, f, a0, b0, c0, d0, e0, f0])\n:- SortMergeJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f])(reuse_id=[1])\n:  :- [#1] Exchange(distribution=[hash[a]])\n:  +- [#2] Exchange(distribution=[hash[d]])\n+- Reused(reference_id=[1])\n])
+:- Exchange(distribution=[hash[a]])
+:  +- Calc(select=[a, b, c], where=[LIKE(c, 'He%')])
+:     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
++- Exchange(distribution=[hash[d]])
+   +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
@@ -1223,43 +1262,39 @@ Sink(table=[default_catalog.default_database.Sink2], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSubplanReuseOnSortLimit">
+  <TestCase name="testSubplanReuseOnSourceWithLimit">
     <Resource name="sql">
       <![CDATA[
-WITH r AS (SELECT c, SUM(a) a, SUM(b) b FROM x GROUP BY c ORDER BY a, b DESC LIMIT 10)
-SELECT * FROM r r1, r r2 WHERE r1.a = r2.a AND r1.a > 1 AND r2.b < 10
+WITH r AS (SELECT a, b FROM x LIMIT 10)
+SELECT r1.a, r1.b, r2.a FROM r r1, r r2 WHERE r1.a = r2.b
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$0], a=[$1], b=[$2], c0=[$3], a0=[$4], b0=[$5])
-+- LogicalFilter(condition=[AND(=($1, $4), >($1, 1), <($5, 10))])
+LogicalProject(a=[$0], b=[$1], a0=[$2])
++- LogicalFilter(condition=[=(CAST($0):BIGINT, $3)])
    +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last], fetch=[10])
-      :  +- LogicalAggregate(group=[{0}], a=[SUM($1)], b=[SUM($2)])
-      :     +- LogicalProject(c=[$2], a=[$0], b=[$1])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      +- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last], fetch=[10])
-         +- LogicalAggregate(group=[{0}], a=[SUM($1)], b=[SUM($2)])
-            +- LogicalProject(c=[$2], a=[$0], b=[$1])
-               +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      :- LogicalSort(fetch=[10])
+      :  +- LogicalProject(a=[$0], b=[$1])
+      :     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      +- LogicalSort(fetch=[10])
+         +- LogicalProject(a=[$0], b=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[(a = a0)], select=[c, a, b, c0, a0, b0], build=[right])
-:- Exchange(distribution=[any], shuffle_mode=[BATCH])
-:  +- Calc(select=[c, a, b], where=[(a > 1)])
-:     +- SortLimit(orderBy=[a ASC, b DESC], offset=[0], fetch=[10], global=[true])(reuse_id=[1])
-:        +- Exchange(distribution=[single])
-:           +- SortLimit(orderBy=[a ASC, b DESC], offset=[0], fetch=[10], global=[false])
-:              +- HashAggregate(isMerge=[true], groupBy=[c], select=[c, Final_SUM(sum$0) AS a, Final_SUM(sum$1) AS b])
-:                 +- Exchange(distribution=[hash[c]])
-:                    +- LocalHashAggregate(groupBy=[c], select=[c, Partial_SUM(a) AS sum$0, Partial_SUM(b) AS sum$1])
-:                       +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[c, a, b], where=[((b < 10) AND (a > 1))])
-      +- Reused(reference_id=[1])
+Calc(select=[a, b, a1 AS a0])
++- NestedLoopJoin(joinType=[InnerJoin], where=[(a0 = b0)], select=[a, b, a0, a1, b0], build=[right])
+   :- Exchange(distribution=[any], shuffle_mode=[BATCH])
+   :  +- Calc(select=[a, b, CAST(a AS BIGINT) AS a0])
+   :     +- Limit(offset=[0], fetch=[10], global=[true])(reuse_id=[1])
+   :        +- Exchange(distribution=[single])
+   :           +- Limit(offset=[0], fetch=[10], global=[false])
+   :              +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
+   +- Exchange(distribution=[broadcast])
+      +- Calc(select=[a, b])
+         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1303,41 +1338,6 @@ Calc(select=[a, c, c0])
    :        +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
    +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
       +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSubplanReuseOnSortMergeJoin">
-    <Resource name="sql">
-      <![CDATA[
-WITH r AS (SELECT * FROM x, y WHERE a = d AND c LIKE 'He%')
-SELECT * FROM r r1, r r2 WHERE r1.a = r2.d
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], a0=[$6], b0=[$7], c0=[$8], d0=[$9], e0=[$10], f0=[$11])
-+- LogicalFilter(condition=[=($0, $9)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-      :  +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-      :     +- LogicalJoin(condition=[true], joinType=[inner])
-      :        :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(members=[\nSortMergeJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, e, f, a0, b0, c0, d0, e0, f0])\n:- SortMergeJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f])(reuse_id=[1])\n:  :- [#1] Exchange(distribution=[hash[a]])\n:  +- [#2] Exchange(distribution=[hash[d]])\n+- Reused(reference_id=[1])\n])
-:- Exchange(distribution=[hash[a]])
-:  +- Calc(select=[a, b, c], where=[LIKE(c, 'He%')])
-:     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-+- Exchange(distribution=[hash[d]])
-   +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml
index c9c7cc051e9..3bcabcf3570 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml
@@ -114,29 +114,29 @@ TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableApiScanWithWatermark">
+  <TestCase name="testTableApiScanWithTemporaryTable">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, c_watermark_t]])
+LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, (a + 1) AS c, TO_TIMESTAMP(b) AS d, my_udf(a) AS e])
-+- TableSourceScan(table=[[default_catalog, default_database, c_watermark_t]], fields=[a, b])
+TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[word])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableApiScanWithTemporaryTable">
+  <TestCase name="testTableApiScanWithWatermark">
     <Resource name="ast">
       <![CDATA[
-LogicalTableScan(table=[[default_catalog, default_database, t1]])
+LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, c_watermark_t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[default_catalog, default_database, t1]], fields=[word])
+Calc(select=[a, b, (a + 1) AS c, TO_TIMESTAMP(b) AS d, my_udf(a) AS e])
++- TableSourceScan(table=[[default_catalog, default_database, c_watermark_t]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml
index 753adf351f7..9b802a08292 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml
@@ -76,28 +76,6 @@ Sink(table=[default_catalog.default_database.sink], fields=[a, b])
    +- Exchange(distribution=[single])
       +- Calc(select=[a, b])
          +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleSink">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink], fields=[cnt])
-+- LogicalProject(cnt=[$1])
-   +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-      +- LogicalProject(a=[$0])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.sink], fields=[cnt])
-+- Calc(select=[cnt])
-   +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count1$0) AS cnt])
-      +- Exchange(distribution=[hash[a]])
-         +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(*) AS count1$0])
-            +- Calc(select=[a])
-               +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -141,6 +119,28 @@ Sink(table=[default_catalog.default_database.sink2], fields=[total_min])
    +- Exchange(distribution=[single])
       +- LocalHashAggregate(select=[Partial_MIN(sum_a) AS min$0])
          +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleSink">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink], fields=[cnt])
++- LogicalProject(cnt=[$1])
+   +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+      +- LogicalProject(a=[$0])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink], fields=[cnt])
++- Calc(select=[cnt])
+   +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count1$0) AS cnt])
+      +- Exchange(distribution=[hash[a]])
+         +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(*) AS count1$0])
+            +- Calc(select=[a])
+               +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml
index 72791b2a01e..fdc0fea2d7f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml
@@ -34,43 +34,50 @@ Calc(select=[a], where=[(IFNULL(a, 1) = 1)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNestedProject">
+  <TestCase name="testNestProjectWithMetadata">
     <Resource name="sql">
       <![CDATA[
 SELECT id,
-    deepNested.nested1.name AS nestedName,
-    nested.`value` AS nestedValue,
-    deepNested.nested2.flag AS nestedFlag,
-    deepNested.nested2.num AS nestedNum
-FROM NestedTable
-      ]]>
+       deepNested.nested1 AS nested1,
+       deepNested.nested1.`value` + deepNested.nested2.num + metadata_1 as results
+FROM T
+]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], nestedName=[$1.nested1.name], nestedValue=[$2.value], nestedFlag=[$1.nested2.flag], nestedNum=[$1.nested2.num])
-+- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T, metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, deepNested_nested1_name AS nestedName, nested_value AS nestedValue, deepNested_nested2_flag AS nestedFlag, deepNested_nested2_num AS nestedNum])
-+- TableSourceScan(table=[[default_catalog, default_database, NestedTable, project=[id, deepNested_nested1_name, deepNested_nested2_flag, deepNested_nested2_num, nested_value], metadata=[]]], fields=[id, deepNested_nested1_name, deepNested_nested2_flag, deepNested_nested2_num, nested_value])
+Calc(select=[id, deepNested_nested1 AS nested1, ((deepNested_nested1.value + deepNested_nested2_num) + metadata_1) AS results])
++- TableSourceScan(table=[[default_catalog, default_database, T, project=[id, deepNested_nested1, deepNested_nested2_num], metadata=[metadata_1]]], fields=[id, deepNested_nested1, deepNested_nested2_num, metadata_1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleProject">
+  <TestCase name="testNestedProject">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM ProjectableTable]]>
+      <![CDATA[
+SELECT id,
+    deepNested.nested1.name AS nestedName,
+    nested.`value` AS nestedValue,
+    deepNested.nested2.flag AS nestedFlag,
+    deepNested.nested2.num AS nestedNum
+FROM NestedTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, ProjectableTable]])
+LogicalProject(id=[$0], nestedName=[$1.nested1.name], nestedValue=[$2.value], nestedFlag=[$1.nested2.flag], nestedNum=[$1.nested2.num])
++- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[default_catalog, default_database, ProjectableTable, project=[a, c], metadata=[]]], fields=[a, c])
+Calc(select=[id, deepNested_nested1_name AS nestedName, nested_value AS nestedValue, deepNested_nested2_flag AS nestedFlag, deepNested_nested2_num AS nestedNum])
++- TableSourceScan(table=[[default_catalog, default_database, NestedTable, project=[id, deepNested_nested1_name, deepNested_nested2_flag, deepNested_nested2_num, nested_value], metadata=[]]], fields=[id, deepNested_nested1_name, deepNested_nested2_flag, deepNested_nested2_num, nested_value])
 ]]>
     </Resource>
   </TestCase>
@@ -93,29 +100,6 @@ LogicalProject(EXPR$0=[ITEM($2.data_arr, $0).value], EXPR$1=[ITEM($2.data_map, _
       <![CDATA[
 Calc(select=[ITEM(result_data_arr, id).value AS EXPR$0, ITEM(result_data_map, 'item').value AS EXPR$1])
 +- TableSourceScan(table=[[default_catalog, default_database, NestedItemTable, project=[result_data_arr, result_data_map, id], metadata=[]]], fields=[result_data_arr, result_data_map, id])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testNestProjectWithMetadata">
-    <Resource name="sql">
-      <![CDATA[
-SELECT id,
-       deepNested.nested1 AS nested1,
-       deepNested.nested1.`value` + deepNested.nested2.num + metadata_1 as results
-FROM T
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T, metadata=[metadata_1, metadata_2]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[id, deepNested_nested1 AS nested1, ((deepNested_nested1.value + deepNested_nested2_num) + metadata_1) AS results])
-+- TableSourceScan(table=[[default_catalog, default_database, T, project=[id, deepNested_nested1, deepNested_nested2_num], metadata=[metadata_1]]], fields=[id, deepNested_nested1, deepNested_nested2_num, metadata_1])
 ]]>
     </Resource>
   </TestCase>
@@ -137,29 +121,19 @@ HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableHintWithDigestReuseForLogicalTableScan">
+  <TestCase name="testSimpleProject">
+    <Resource name="sql">
+      <![CDATA[SELECT a, c FROM ProjectableTable]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
-+- LogicalUnion(all=[true])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=0}]]])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=1}]]])
-
-LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=2}]]])
+LogicalProject(a=[$0], c=[$2])
++- LogicalTableScan(table=[[default_catalog, default_database, ProjectableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
-+- Union(all=[true], union=[a, b, c])
-   :- Union(all=[true], union=[a, b, c])
-   :  :- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=0}]]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=1}]]])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=2}]]])
+TableSourceScan(table=[[default_catalog, default_database, ProjectableTable, project=[a, c], metadata=[]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
@@ -180,7 +154,7 @@ Calc(select=[a, c, PROCTIME_MATERIALIZE(PROCTIME()) AS EXPR$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableHintWithSameOptions">
+  <TestCase name="testTableHintWithDifferentOptions">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
@@ -189,24 +163,27 @@ LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
 
 LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=1}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=2}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
 +- Union(all=[true], union=[a, b, c])
-   :- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=1}]]])(reuse_id=[1])
-   +- Reused(reference_id=[1])
+   :- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=1}]]])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableHintWithDifferentOptions">
+  <TestCase name="testTableHintWithDigestReuseForLogicalTableScan">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=1}]]])
++- LogicalUnion(all=[true])
+   :- LogicalProject(a=[$0], b=[$1], c=[$2])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=0}]]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=1}]]])
 
 LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
@@ -217,8 +194,31 @@ LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
       <![CDATA[
 Sink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
 +- Union(all=[true], union=[a, b, c])
-   :- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=1}]]])
+   :- Union(all=[true], union=[a, b, c])
+   :  :- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=0}]]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=1}]]])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=2}]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTableHintWithSameOptions">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=1}]]])
+
+LogicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{source.num-element-to-skip=1}]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
++- Union(all=[true], union=[a, b, c])
+   :- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], hints=[[[OPTIONS options:{source.num-element-to-skip=1}]]])(reuse_id=[1])
+   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TimeTravelTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TimeTravelTest.xml
index efc3464500f..464d05fa638 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TimeTravelTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TimeTravelTest.xml
@@ -64,37 +64,37 @@ Union(all=[true], union=[f1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTimeTravelWithDifferentTimezone">
+  <TestCase name="testTimeTravelWithAsExpression">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM t1 FOR SYSTEM_TIME AS OF TIMESTAMP '2023-01-01 10:00:00']]>
+      <![CDATA[SELECT * FROM t1 FOR SYSTEM_TIME AS OF TIMESTAMP '2023-01-01 02:00:00' AS t2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f1=[$0], f2=[$1])
-+- LogicalSnapshot(period=[2023-01-01 10:00:00])
++- LogicalSnapshot(period=[2023-01-01 02:00:00])
    +- LogicalTableScan(table=[[TimeTravelCatalog, default, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[TimeTravelCatalog, default, t1]], fields=[f1, f2], version=[1672538400000])
+TableSourceScan(table=[[TimeTravelCatalog, default, t1, project=[f1, f2], metadata=[]]], fields=[f1, f2], version=[1672542000000])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTimeTravelWithAsExpression">
+  <TestCase name="testTimeTravelWithDifferentTimezone">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM t1 FOR SYSTEM_TIME AS OF TIMESTAMP '2023-01-01 02:00:00' AS t2]]>
+      <![CDATA[SELECT * FROM t1 FOR SYSTEM_TIME AS OF TIMESTAMP '2023-01-01 10:00:00']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f1=[$0], f2=[$1])
-+- LogicalSnapshot(period=[2023-01-01 02:00:00])
++- LogicalSnapshot(period=[2023-01-01 10:00:00])
    +- LogicalTableScan(table=[[TimeTravelCatalog, default, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[TimeTravelCatalog, default, t1, project=[f1, f2], metadata=[]]], fields=[f1, f2], version=[1672542000000])
+TableSourceScan(table=[[TimeTravelCatalog, default, t1]], fields=[f1, f2], version=[1672538400000])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/UnnestTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/UnnestTest.xml
index 4645f60d6c8..2b8cfaaffc1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/UnnestTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/UnnestTest.xml
@@ -16,26 +16,7 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testUnnestWithValues">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM UNNEST(ARRAY[1,2,3])]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[$0])
-+- Uncollect
-   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
-      +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Correlate(invocation=[$UNNEST_ROWS$1(ARRAY(1, 2, 3))], correlate=[table($UNNEST_ROWS$1(ARRAY(1, 2, 3)))], select=[f0], rowType=[RecordType:peek_no_expand(INTEGER f0)], joinType=[INNER])
-+- Values(tuples=[[{  }]], values=[])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testCrossWithUnnest">
+  <TestCase name="testCrossWithUnnest">
     <Resource name="sql">
       <![CDATA[SELECT a, s FROM MyTable, UNNEST(MyTable.c) as A (s)]]>
     </Resource>
@@ -55,47 +36,6 @@ LogicalProject(a=[$0], s=[$3])
 Calc(select=[a, f0 AS s])
 +- Correlate(invocation=[$UNNEST_ROWS$1($cor0.c)], correlate=[table($UNNEST_ROWS$1($cor0.c))], select=[a,b,c,f0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) ARRAY c, VARCHAR(2147483647) f0)], joinType=[INNER])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumbleWindowAggregateWithCollectUnnest">
-    <Resource name="sql">
-      <![CDATA[
-WITH T AS (SELECT b, COLLECT(b) as `set`
-    FROM MyTable
-    GROUP BY b, TUMBLE(rowtime, INTERVAL '3' SECOND)
-)
-SELECT b, s FROM T, UNNEST(T.`set`) AS A(s) where b < 3
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$0], s=[$2])
-+- LogicalFilter(condition=[<($0, 3)])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-      :- LogicalProject(b=[$0], set=[$2])
-      :  +- LogicalAggregate(group=[{0, 1}], set=[COLLECT($0)])
-      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($3, 3000:INTERVAL SECOND)])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(s=[$0])
-         +- Uncollect
-            +- LogicalProject(set=[$cor0.set])
-               +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[b, f0 AS s])
-+- Correlate(invocation=[$UNNEST_ROWS$1($cor0.set)], correlate=[table($UNNEST_ROWS$1($cor0.set))], select=[b,set,f0], rowType=[RecordType(BIGINT b, BIGINT MULTISET set, BIGINT f0)], joinType=[INNER])
-   +- SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 3000)], select=[b, Final_COLLECT(set) AS set])
-      +- Exchange(distribution=[forward])
-         +- Sort(orderBy=[b ASC, assignedWindow$ ASC])
-            +- Exchange(distribution=[hash[b]])
-               +- LocalSortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 3000)], select=[b, Partial_COLLECT(b) AS set])
-                  +- Exchange(distribution=[forward])
-                     +- Sort(orderBy=[b ASC, rowtime ASC])
-                        +- Calc(select=[b, rowtime], where=[(b < 3)])
-                           +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -188,6 +128,47 @@ Calc(select=[a, f0 AS s])
                      +- Sort(orderBy=[a ASC])
                         +- Calc(select=[a, b], where=[(a < 5)])
                            +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumbleWindowAggregateWithCollectUnnest">
+    <Resource name="sql">
+      <![CDATA[
+WITH T AS (SELECT b, COLLECT(b) as `set`
+    FROM MyTable
+    GROUP BY b, TUMBLE(rowtime, INTERVAL '3' SECOND)
+)
+SELECT b, s FROM T, UNNEST(T.`set`) AS A(s) where b < 3
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$0], s=[$2])
++- LogicalFilter(condition=[<($0, 3)])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+      :- LogicalProject(b=[$0], set=[$2])
+      :  +- LogicalAggregate(group=[{0, 1}], set=[COLLECT($0)])
+      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($3, 3000:INTERVAL SECOND)])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(s=[$0])
+         +- Uncollect
+            +- LogicalProject(set=[$cor0.set])
+               +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[b, f0 AS s])
++- Correlate(invocation=[$UNNEST_ROWS$1($cor0.set)], correlate=[table($UNNEST_ROWS$1($cor0.set))], select=[b,set,f0], rowType=[RecordType(BIGINT b, BIGINT MULTISET set, BIGINT f0)], joinType=[INNER])
+   +- SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 3000)], select=[b, Final_COLLECT(set) AS set])
+      +- Exchange(distribution=[forward])
+         +- Sort(orderBy=[b ASC, assignedWindow$ ASC])
+            +- Exchange(distribution=[hash[b]])
+               +- LocalSortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 3000)], select=[b, Partial_COLLECT(b) AS set])
+                  +- Exchange(distribution=[forward])
+                     +- Sort(orderBy=[b ASC, rowtime ASC])
+                        +- Calc(select=[b, rowtime], where=[(b < 3)])
+                           +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -248,29 +229,6 @@ Calc(select=[b, _1 AS id, _2 AS point])
                      +- Sort(orderBy=[b ASC])
                         +- Calc(select=[b, c], where=[(b < 3)])
                            +- BoundedStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUnnestPrimitiveArrayFromTable">
-    <Resource name="sql">
-      <![CDATA[SELECT a, b, s FROM MyTable, UNNEST(MyTable.b) AS A (s)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], s=[$3])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalProject(s=[$0])
-      +- Uncollect
-         +- LogicalProject(b=[$cor0.b])
-            +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, b, f0 AS s])
-+- Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,c,f0], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER ARRAY ARRAY c, INTEGER f0)], joinType=[INNER])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -316,6 +274,29 @@ LogicalProject(a=[$0], b=[$1], _1=[$2], _2=[$3])
       <![CDATA[
 Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,_1,_2], rowType=[RecordType(INTEGER a, RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2) ARRAY b, INTEGER _1, VARCHAR(2147483647) _2)], joinType=[INNER], condition=[>($0, 1)])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnnestPrimitiveArrayFromTable">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b, s FROM MyTable, UNNEST(MyTable.b) AS A (s)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], s=[$3])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(s=[$0])
+      +- Uncollect
+         +- LogicalProject(b=[$cor0.b])
+            +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, f0 AS s])
++- Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,c,f0], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER ARRAY ARRAY c, INTEGER f0)], joinType=[INNER])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -474,6 +455,38 @@ LogicalProject(a=[$0], b=[$1], _1=[$2], _2=[$3], ORDINALITY=[$4])
       <![CDATA[
 Correlate(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], correlate=[table($UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b))], select=[a,b,_1,_2,ORDINALITY], rowType=[RecordType(INTEGER a, RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2) ARRAY b, INTEGER _1, VARCHAR(2147483647) _2, INTEGER ORDINALITY)], joinType=[INNER], condition=[>($0, 1)])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnnestWithOrdinalityInSubquery">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+  SELECT a, number, ordinality
+  FROM MyTable
+  CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
+) subquery
+WHERE ordinality = 1
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], number=[$1], ordinality=[$2])
++- LogicalFilter(condition=[=($2, 1)])
+   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
+      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalProject(number=[$0], ordinality=[$1])
+            +- Uncollect(withOrdinality=[true])
+               +- LogicalProject(b=[$cor0.b])
+                  +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, number, ordinality])
++- Correlate(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], correlate=[table($UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b))], select=[a,b,number,ordinality], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER number, INTEGER ordinality)], joinType=[INNER], condition=[=($1, 1)])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -540,8 +553,8 @@ Calc(select=[a, EXPR$0 AS word, ORDINALITY AS pos])
   <TestCase name="testUnnestWithOrdinalityWithFilter">
     <Resource name="sql">
       <![CDATA[
-SELECT a, number, ordinality 
-FROM MyTable 
+SELECT a, number, ordinality
+FROM MyTable
 CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
 WHERE number > 10 AND ordinality < 3
 ]]>
@@ -566,35 +579,22 @@ Calc(select=[a, EXPR$0 AS number, ORDINALITY AS ordinality])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnnestWithOrdinalityInSubquery">
+  <TestCase name="testUnnestWithValues">
     <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
-  SELECT a, number, ordinality 
-  FROM MyTable 
-  CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
-) subquery 
-WHERE ordinality = 1
-]]>
+      <![CDATA[SELECT * FROM UNNEST(ARRAY[1,2,3])]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], number=[$1], ordinality=[$2])
-+- LogicalFilter(condition=[=($2, 1)])
-   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         +- LogicalProject(number=[$0], ordinality=[$1])
-            +- Uncollect(withOrdinality=[true])
-               +- LogicalProject(b=[$cor0.b])
-                  +- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(EXPR$0=[$0])
++- Uncollect
+   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
+      +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, number, ordinality])
-+- Correlate(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], correlate=[table($UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b))], select=[a,b,number,ordinality], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER number, INTEGER ordinality)], joinType=[INNER], condition=[=($1, 1)])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+Correlate(invocation=[$UNNEST_ROWS$1(ARRAY(1, 2, 3))], correlate=[table($UNNEST_ROWS$1(ARRAY(1, 2, 3)))], select=[f0], rowType=[RecordType:peek_no_expand(INTEGER f0)], joinType=[INNER])
++- Values(tuples=[[{  }]], values=[])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml
index 943b60bc496..8a1d0b9f3e3 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml
@@ -56,22 +56,6 @@ LogicalSort(sort0=[$0], dir0=[ASC-nulls-first])
     <Resource name="optimized exec plan">
       <![CDATA[
 Values(tuples=[[]], values=[a])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleRow">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM (VALUES (1, 2, 3)) AS T(a, b, c)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalValues(tuples=[[{ 1, 2, 3 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Values(tuples=[[{ 1, 2, 3 }]], values=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -119,6 +103,22 @@ LogicalProject(EXPR$0=[$0])
       <![CDATA[
 Calc(select=[null:INTEGER AS EXPR$0])
 +- Values(tuples=[[{ 0 }]], values=[ZERO])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleRow">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (VALUES (1, 2, 3)) AS T(a, b, c)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalValues(tuples=[[{ 1, 2, 3 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Values(tuples=[[{ 1, 2, 3 }]], values=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/VectorSearchTableFunctionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/VectorSearchTableFunctionTest.xml
index f91bc779989..bcf3afdebd4 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/VectorSearchTableFunctionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/VectorSearchTableFunctionTest.xml
@@ -235,59 +235,59 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSearchTableWithProjection">
+  <TestCase name="testSearchTableWithMetadataTable">
     <Resource name="sql">
       <![CDATA[SELECT * FROM QueryTable, LATERAL TABLE(
-VECTOR_SEARCH(
-    (SELECT add_one(e) as e1, g, proctime FROM VectorTableWithProctime), DESCRIPTOR(`g`), QueryTable.d, 10))]]>
+  VECTOR_SEARCH(
+    TABLE VectorTableWithMetadata,
+    DESCRIPTOR(`g`),
+    QueryTable.d,
+    10  )
+)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e1=[$6], g=[$7], proctime0=[$8], score=[$9])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$6], f=[$7], g=[$8], h=[$9], score=[$10])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3}])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, QueryTable]])
-   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(BIGINT e1, FLOAT ARRAY g, TIMESTAMP_LTZ(3) *PROCTIME* proctime, DOUBLE score)])
-      +- LogicalProject(e1=[add_one(CAST($0):BIGINT)], g=[$2], proctime=[$3])
-         +- LogicalProject(e=[$0], f=[$1], g=[$2], proctime=[PROCTIME()])
-            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithProctime]])
+   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(INTEGER e, FLOAT ARRAY f, FLOAT ARRAY g, INTEGER h, DOUBLE score)])
+      +- LogicalProject(e=[$0], f=[$1], g=[$2], h=[$3])
+         +- LogicalProject(e=[$0], f=[$2], g=[$1], h=[+($0, 1)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithMetadata, metadata=[f]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e1, g, PROCTIME_MATERIALIZE(proctime0) AS proctime0, score])
-+- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithProctime], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, add_one(CAST(e AS BIGINT)) AS e1, g, PROCTIME() AS proctime0, score])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f, g, h, score])
++- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithMetadata], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, e, f, g, +(e, 1) AS h, score])
    +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
       +- TableSourceScan(table=[[default_catalog, default_database, QueryTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSearchTableWithMetadataTable">
+  <TestCase name="testSearchTableWithProjection">
     <Resource name="sql">
       <![CDATA[SELECT * FROM QueryTable, LATERAL TABLE(
-  VECTOR_SEARCH(
-    TABLE VectorTableWithMetadata,
-    DESCRIPTOR(`g`),
-    QueryTable.d,
-    10  )
-)]]>
+VECTOR_SEARCH(
+    (SELECT add_one(e) as e1, g, proctime FROM VectorTableWithProctime), DESCRIPTOR(`g`), QueryTable.d, 10))]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$6], f=[$7], g=[$8], h=[$9], score=[$10])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e1=[$6], g=[$7], proctime0=[$8], score=[$9])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3}])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, QueryTable]])
-   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(INTEGER e, FLOAT ARRAY f, FLOAT ARRAY g, INTEGER h, DOUBLE score)])
-      +- LogicalProject(e=[$0], f=[$1], g=[$2], h=[$3])
-         +- LogicalProject(e=[$0], f=[$2], g=[$1], h=[+($0, 1)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithMetadata, metadata=[f]]])
+   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(BIGINT e1, FLOAT ARRAY g, TIMESTAMP_LTZ(3) *PROCTIME* proctime, DOUBLE score)])
+      +- LogicalProject(e1=[add_one(CAST($0):BIGINT)], g=[$2], proctime=[$3])
+         +- LogicalProject(e=[$0], f=[$1], g=[$2], proctime=[PROCTIME()])
+            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithProctime]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f, g, h, score])
-+- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithMetadata], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, e, f, g, +(e, 1) AS h, score])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e1, g, PROCTIME_MATERIALIZE(proctime0) AS proctime0, score])
++- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithProctime], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, add_one(CAST(e AS BIGINT)) AS e1, g, PROCTIME() AS proctime0, score])
    +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
       +- TableSourceScan(table=[[default_catalog, default_database, QueryTable]], fields=[a, b, c, d, rowtime])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/WindowTableFunctionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/WindowTableFunctionTest.xml
index a26b2655a70..d94f196512f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/WindowTableFunctionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/WindowTableFunctionTest.xml
@@ -98,28 +98,6 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], ts=[$4], window_start=[$5], windo
       <![CDATA[
 WindowTableFunction(window=[HOP(time_col=[ts], size=[2 h], slide=[1 h])])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c, d, ts])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumbleTVF">
-    <Resource name="sql">
-      <![CDATA[
-SELECT *
-FROM TABLE(TUMBLE(TABLE MyTable1, DESCRIPTOR(ts), INTERVAL '15' MINUTE))
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], ts=[$4], window_start=[$5], window_end=[$6], window_time=[$7])
-+- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'ts'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER d, TIMESTAMP(3) ts, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) window_time)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], ts=[$4])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-WindowTableFunction(window=[TUMBLE(time_col=[ts], size=[15 min])])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -156,6 +134,28 @@ Calc(select=[EXPR$0])
                         +- WindowTableFunction(window=[TUMBLE(time_col=[ts], size=[3 s])])
                            +- Calc(select=[a, c, ts])
                               +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c, d, ts])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumbleTVF">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM TABLE(TUMBLE(TABLE MyTable1, DESCRIPTOR(ts), INTERVAL '15' MINUTE))
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], ts=[$4], window_start=[$5], window_end=[$6], window_time=[$7])
++- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'ts'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER d, TIMESTAMP(3) ts, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) window_time)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], ts=[$4])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+WindowTableFunction(window=[TUMBLE(time_col=[ts], size=[15 min])])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/adaptive/AdaptiveJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/adaptive/AdaptiveJoinTest.xml
index 105c8e7dafe..02da8043b48 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/adaptive/AdaptiveJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/adaptive/AdaptiveJoinTest.xml
@@ -16,16 +16,137 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testShuffleJoinWithForwardForConsecutiveHash">
-		<Resource name="sql">
-			<![CDATA[
+  <TestCase name="testAdaptiveJoinWithAdaptiveSkewedOptimizationEnabled">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
++- LogicalFilter(condition=[=($0, $4)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testAdaptiveJoinWithBatchJobRecovery">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
++- LogicalFilter(condition=[=($0, $4)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinWithMultipleInput">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM
+  (SELECT a FROM T1 JOIN T ON a = a1) t1
+  INNER JOIN
+  (SELECT d2 FROM T JOIN T2 ON d2 = a) t2
+ON t1.a = t2.d2
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], d2=[$1])
++- LogicalJoin(condition=[=($0, $1)], joinType=[inner])
+   :- LogicalProject(a=[$4])
+   :  +- LogicalJoin(condition=[=($4, $0)], joinType=[inner])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+   +- LogicalProject(d2=[$7])
+      +- LogicalJoin(condition=[=($7, $0)], joinType=[inner])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,1,1,2], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d2)], select=[a, d2], build=[left])\n:- Calc(select=[a])\n:  +- HashJoin(joinType=[InnerJoin], where=[(a = a1)], select=[a1, a], build=[left])\n:     :- [#1] Exchange(distribution=[hash[a1]])\n:     +- [#2] Exchange(distribution=[hash[a]])\n+- Calc(select=[d2])\n   +- HashJoin(joinType=[InnerJoin], where=[(d2 = a)], select=[a, d2], build=[left])\n      :- [#2] Exchange(distribution=[hash[a]])\n      +- [#4] Exchange(distribution=[hash[d2]])\n])
+:- Exchange(distribution=[hash[a1]])
+:  +- Calc(select=[a1])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
+:- Exchange(distribution=[hash[a]])(reuse_id=[1])
+:  +- Calc(select=[a])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
+:- Reused(reference_id=[1])
++- Exchange(distribution=[hash[d2]])
+   +- Calc(select=[d2])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinWithUnionInput">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM
+  (SELECT a FROM (SELECT a1 as a FROM T1) UNION ALL (SELECT a2 as a FROM T2)) Y
+  LEFT JOIN T ON T.a = Y.a
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], a0=[$1], b=[$2], c=[$3], d=[$4])
++- LogicalJoin(condition=[=($1, $0)], joinType=[left])
+   :- LogicalUnion(all=[true])
+   :  :- LogicalProject(a=[$0])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   :  +- LogicalProject(a=[$0])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[LeftOuterJoin], where=[(a0 = a)], select=[a, a0, b, c, d], build=[left])
+:- Exchange(distribution=[hash[a]])
+:  +- Union(all=[true], union=[a])
+:     :- Calc(select=[a1 AS a])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
+:     +- Calc(select=[a2 AS a])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
++- Exchange(distribution=[hash[a]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testShuffleJoinWithForwardForConsecutiveHash">
+    <Resource name="sql">
+      <![CDATA[
 WITH
   r AS (SELECT * FROM T1, T2, T3 WHERE a1 = a2 and a1 = a3)
 SELECT sum(b1) FROM r group by a1
 ]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a1=[$0], b1=[$1])
@@ -37,9 +158,9 @@ LogicalProject(EXPR$0=[$1])
                :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
                +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Calc(select=[EXPR$0])
 +- HashAggregate(isMerge=[false], groupBy=[a1], select=[a1, SUM(b1) AS EXPR$0])
    +- Exchange(distribution=[keep_input_as_is[hash[a1]]])
@@ -60,218 +181,97 @@ Calc(select=[EXPR$0])
                   +- Calc(select=[a3])
                      +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3, c3, d3])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWithShuffleMergeJoin">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithBroadcastJoinRuntimeOnly">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
 +- LogicalFilter(condition=[=($0, $4)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-AdaptiveJoin(originalJoin=[SortMergeJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
 +- Exchange(distribution=[hash[a2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWithBroadcastJoinRuntimeOnly">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithShuffleHashJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
 +- LogicalFilter(condition=[=($0, $4)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
 +- Exchange(distribution=[hash[a2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWithShuffleHashJoin">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithShuffleMergeJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
 +- LogicalFilter(condition=[=($0, $4)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+AdaptiveJoin(originalJoin=[SortMergeJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
 +- Exchange(distribution=[hash[a2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWithStaticBroadcastJoin">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithStaticBroadcastJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
 +- LogicalFilter(condition=[=($0, $4)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], isBroadcast=[true], build=[right])
 :- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
 +- Exchange(distribution=[broadcast])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testJoinWithUnionInput">
-		<Resource name="sql">
-			<![CDATA[
-SELECT * FROM
-  (SELECT a FROM (SELECT a1 as a FROM T1) UNION ALL (SELECT a2 as a FROM T2)) Y
-  LEFT JOIN T ON T.a = Y.a
-]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0], a0=[$1], b=[$2], c=[$3], d=[$4])
-+- LogicalJoin(condition=[=($1, $0)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalProject(a=[$0])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   :  +- LogicalProject(a=[$0])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[LeftOuterJoin], where=[(a0 = a)], select=[a, a0, b, c, d], build=[left])
-:- Exchange(distribution=[hash[a]])
-:  +- Union(all=[true], union=[a])
-:     :- Calc(select=[a1 AS a])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
-:     +- Calc(select=[a2 AS a])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
-+- Exchange(distribution=[hash[a]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testJoinWithMultipleInput">
-		<Resource name="sql">
-			<![CDATA[
-SELECT * FROM
-  (SELECT a FROM T1 JOIN T ON a = a1) t1
-  INNER JOIN
-  (SELECT d2 FROM T JOIN T2 ON d2 = a) t2
-ON t1.a = t2.d2
-]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0], d2=[$1])
-+- LogicalJoin(condition=[=($0, $1)], joinType=[inner])
-   :- LogicalProject(a=[$4])
-   :  +- LogicalJoin(condition=[=($4, $0)], joinType=[inner])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-   +- LogicalProject(d2=[$7])
-      +- LogicalJoin(condition=[=($7, $0)], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[0,1,1,2], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d2)], select=[a, d2], build=[left])\n:- Calc(select=[a])\n:  +- HashJoin(joinType=[InnerJoin], where=[(a = a1)], select=[a1, a], build=[left])\n:     :- [#1] Exchange(distribution=[hash[a1]])\n:     +- [#2] Exchange(distribution=[hash[a]])\n+- Calc(select=[d2])\n   +- HashJoin(joinType=[InnerJoin], where=[(d2 = a)], select=[a, d2], build=[left])\n      :- [#2] Exchange(distribution=[hash[a]])\n      +- [#4] Exchange(distribution=[hash[d2]])\n])
-:- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
-:- Exchange(distribution=[hash[a]])(reuse_id=[1])
-:  +- Calc(select=[a])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
-:- Reused(reference_id=[1])
-+- Exchange(distribution=[hash[d2]])
-   +- Calc(select=[d2])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testAdaptiveJoinWithBatchJobRecovery">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
-+- LogicalFilter(condition=[=($0, $4)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testAdaptiveJoinWithAdaptiveSkewedOptimizationEnabled">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1, T2 WHERE a1 = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
-+- LogicalFilter(condition=[=($0, $4)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-AdaptiveJoin(originalJoin=[ShuffleHashJoin], joinType=[InnerJoin], where=[(a1 = a2)], select=[a1, b1, c1, d1, a2, b2, c2, d2], build=[left])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1, c1, d1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2, c2, d2])
-]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml
index 8f583b68198..8cc7192a86d 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml
@@ -576,6 +576,27 @@ Calc(select=[a1, b1, c1, EXPR$3])
    +- Exchange(distribution=[hash[a1, c1, d1, $e]])
       +- Expand(projects=[{a1, b1, c1, null AS d1, 1 AS $e, d1 AS d1_0}, {a1, b1, null AS c1, d1, 2 AS $e, d1 AS d1_0}])
          +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testAggWithRollup">
+    <Resource name="sql">
+      <![CDATA[SELECT a1, b1, c1, COUNT(d1) FROM T1 GROUP BY ROLLUP (a1, b1, c1)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0}, {}]], EXPR$3=[COUNT($3)])
++- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a1, b1, c1, EXPR$3])
++- HashAggregate(isMerge=[true], groupBy=[a1, b1, c1, $e], select=[a1, b1, c1, $e, Final_COUNT(count$0) AS EXPR$3])
+   +- Exchange(distribution=[hash[a1, b1, c1, $e]])
+      +- LocalHashAggregate(groupBy=[a1, b1, c1, $e], select=[a1, b1, c1, $e, Partial_COUNT(d1) AS count$0])
+         +- Expand(projects=[{a1, b1, c1, d1, 0 AS $e}, {a1, b1, null AS c1, d1, 1 AS $e}, {a1, null AS b1, null AS c1, d1, 3 AS $e}, {null AS a1, null AS b1, null AS c1, d1, 7 AS $e}])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
@@ -614,27 +635,6 @@ HashAggregate(isMerge=[true], groupBy=[a3, b3], select=[a3, b3, Final_COUNT(coun
    +- LocalHashAggregate(groupBy=[a3, b3], select=[a3, b3, Partial_COUNT(c3) AS count$0])
       +- Calc(select=[a3, b3, c3])
          +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testAggWithRollup">
-    <Resource name="sql">
-      <![CDATA[SELECT a1, b1, c1, COUNT(d1) FROM T1 GROUP BY ROLLUP (a1, b1, c1)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0}, {}]], EXPR$3=[COUNT($3)])
-+- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a1, b1, c1, EXPR$3])
-+- HashAggregate(isMerge=[true], groupBy=[a1, b1, c1, $e], select=[a1, b1, c1, $e, Final_COUNT(count$0) AS EXPR$3])
-   +- Exchange(distribution=[hash[a1, b1, c1, $e]])
-      +- LocalHashAggregate(groupBy=[a1, b1, c1, $e], select=[a1, b1, c1, $e, Partial_COUNT(d1) AS count$0])
-         +- Expand(projects=[{a1, b1, c1, d1, 0 AS $e}, {a1, b1, null AS c1, d1, 1 AS $e}, {a1, null AS b1, null AS c1, d1, 3 AS $e}, {null AS a1, null AS b1, null AS c1, d1, 7 AS $e}])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
@@ -763,86 +763,86 @@ HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[d1], select=[a1, d1, C
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnlyConstantGroupKey">
+  <TestCase name="testSingleAggOnTableWithUniqueKey">
     <Resource name="sql">
-      <![CDATA[SELECT count(c1) FROM T1 GROUP BY 1, true]]>
+      <![CDATA[SELECT a1, b1, count(c1) FROM T1 GROUP BY a1, b1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[$2])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[COUNT($2)])
-   +- LogicalProject($f0=[1], $f1=[true], c1=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
++- LogicalProject(a1=[$0], b1=[$1], c1=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[EXPR$0])
-+- HashAggregate(isMerge=[true], groupBy=[$f0], select=[$f0, Final_COUNT(count$0) AS EXPR$0])
-   +- Exchange(distribution=[hash[$f0]])
-      +- LocalHashAggregate(groupBy=[$f0], select=[$f0, Partial_COUNT(c1) AS count$0])
-         +- Calc(select=[1 AS $f0, c1])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1], select=[a1, b1, COUNT(c1) AS EXPR$2])
++- Exchange(distribution=[hash[a1]])
+   +- Calc(select=[a1, b1, c1])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnTableWithoutUniqueKey">
+  <TestCase name="testSingleAggOnTableWithUniqueKeys">
     <Resource name="sql">
-      <![CDATA[SELECT a3, b3, count(c3) FROM T3 GROUP BY a3, b3]]>
+      <![CDATA[SELECT  b2, c2, avg(a2) FROM T2 GROUP BY b2, c2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-+- LogicalProject(a3=[$0], b3=[$1], c3=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+LogicalAggregate(group=[{0, 1}], EXPR$2=[AVG($2)])
++- LogicalProject(b2=[$1], c2=[$2], a2=[$0])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[a3, b3], select=[a3, b3, Final_COUNT(count$0) AS EXPR$2])
-+- Exchange(distribution=[hash[a3, b3]])
-   +- LocalHashAggregate(groupBy=[a3, b3], select=[a3, b3, Partial_COUNT(c3) AS count$0])
-      +- Calc(select=[a3, b3, c3])
-         +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
+HashAggregate(isMerge=[false], groupBy=[b2], auxGrouping=[c2], select=[b2, c2, AVG(a2) AS EXPR$2])
++- Exchange(distribution=[hash[b2]])
+   +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnTableWithUniqueKey">
+  <TestCase name="testSingleAggOnTableWithoutUniqueKey">
     <Resource name="sql">
-      <![CDATA[SELECT a1, b1, count(c1) FROM T1 GROUP BY a1, b1]]>
+      <![CDATA[SELECT a3, b3, count(c3) FROM T3 GROUP BY a3, b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-+- LogicalProject(a1=[$0], b1=[$1], c1=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
++- LogicalProject(a3=[$0], b3=[$1], c3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1], select=[a1, b1, COUNT(c1) AS EXPR$2])
-+- Exchange(distribution=[hash[a1]])
-   +- Calc(select=[a1, b1, c1])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+HashAggregate(isMerge=[true], groupBy=[a3, b3], select=[a3, b3, Final_COUNT(count$0) AS EXPR$2])
++- Exchange(distribution=[hash[a3, b3]])
+   +- LocalHashAggregate(groupBy=[a3, b3], select=[a3, b3, Partial_COUNT(c3) AS count$0])
+      +- Calc(select=[a3, b3, c3])
+         +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnTableWithUniqueKeys">
+  <TestCase name="testSingleAggOnlyConstantGroupKey">
     <Resource name="sql">
-      <![CDATA[SELECT  b2, c2, avg(a2) FROM T2 GROUP BY b2, c2]]>
+      <![CDATA[SELECT count(c1) FROM T1 GROUP BY 1, true]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[AVG($2)])
-+- LogicalProject(b2=[$1], c2=[$2], a2=[$0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+LogicalProject(EXPR$0=[$2])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[COUNT($2)])
+   +- LogicalProject($f0=[1], $f1=[true], c1=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[false], groupBy=[b2], auxGrouping=[c2], select=[b2, c2, AVG(a2) AS EXPR$2])
-+- Exchange(distribution=[hash[b2]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+Calc(select=[EXPR$0])
++- HashAggregate(isMerge=[true], groupBy=[$f0], select=[$f0, Final_COUNT(count$0) AS EXPR$0])
+   +- Exchange(distribution=[hash[$f0]])
+      +- LocalHashAggregate(groupBy=[$f0], select=[$f0, Partial_COUNT(c1) AS count$0])
+         +- Calc(select=[1 AS $f0, c1])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/DistinctAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/DistinctAggregateTest.xml
index 68bac9b28ec..436ac8e1ca0 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/DistinctAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/DistinctAggregateTest.xml
@@ -16,6 +16,64 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
+  <TestCase name="TestMultiDistinctOnDifferentColumnWithFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
+COUNT(DISTINCT b) FILTER (WHERE b > 1) FROM MyTable2 GROUP BY d]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[COUNT(DISTINCT $3) FILTER $4])
++- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], b=[$1], $f4=[IS TRUE(>($1, 1))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2, Final_COUNT(count$2) AS EXPR$3])
++- Exchange(distribution=[hash[d]])
+   +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(c) FILTER $g_7 AS count$0, Partial_COUNT(c) FILTER $g_3 AS count$1, Partial_COUNT(b) FILTER $g_12 AS count$2])
+      +- Calc(select=[d, c, b, ((CASE(($e = 3), 3, ($e = 7), 7, 12) = 3) AND $f2 IS TRUE) AS $g_3, (CASE(($e = 3), 3, ($e = 7), 7, 12) = 7) AS $g_7, ((CASE(($e = 3), 3, ($e = 7), 7, 12) = 12) AND $f4 IS TRUE) AS $g_12])
+         +- HashAggregate(isMerge=[true], groupBy=[d, c, $f2, b, $f4, $e], select=[d, c, $f2, b, $f4, $e])
+            +- Exchange(distribution=[hash[d, c, $f2, b, $f4, $e]])
+               +- LocalHashAggregate(groupBy=[d, c, $f2, b, $f4, $e], select=[d, c, $f2, b, $f4, $e])
+                  +- Expand(projects=[{d, c, $f2, null AS b, null AS $f4, 3 AS $e}, {d, c, null AS $f2, null AS b, null AS $f4, 7 AS $e}, {d, null AS c, null AS $f2, b, $f4, 12 AS $e}])
+                     +- Calc(select=[d, c, (a > 0) IS TRUE AS $f2, b, (b > 1) IS TRUE AS $f4])
+                        +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="TestMultiDistinctWithFilterAndNonDistinctAgg">
+    <Resource name="sql">
+      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
+MAX(e), MIN(e) FROM MyTable2 GROUP BY d]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[MAX($3)], EXPR$4=[MIN($3)])
++- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], e=[$4])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+SortAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2, Final_MIN(min$2) AS EXPR$3, Final_MIN(min$3) AS EXPR$4])
++- Exchange(distribution=[forward])
+   +- Sort(orderBy=[d ASC])
+      +- Exchange(distribution=[hash[d]])
+         +- LocalSortAggregate(groupBy=[d], select=[d, Partial_COUNT(c) FILTER $g_1 AS count$0, Partial_COUNT(c) FILTER $g_0 AS count$1, Partial_MIN(EXPR$3) FILTER $g_3 AS min$2, Partial_MIN(EXPR$4) FILTER $g_3 AS min$3])
+            +- Calc(select=[d, c, EXPR$3, EXPR$4, ((CASE(($e = 0), 0, ($e = 1), 1, 3) = 0) AND $f2 IS TRUE) AS $g_0, (CASE(($e = 0), 0, ($e = 1), 1, 3) = 1) AS $g_1, (CASE(($e = 0), 0, ($e = 1), 1, 3) = 3) AS $g_3])
+               +- Sort(orderBy=[d ASC])
+                  +- SortAggregate(isMerge=[false], groupBy=[d, c, $f2, $e], select=[d, c, $f2, $e, MAX(e) AS EXPR$3, MIN(e) AS EXPR$4])
+                     +- Exchange(distribution=[forward])
+                        +- Sort(orderBy=[d ASC, c ASC, $f2 ASC, $e ASC])
+                           +- Exchange(distribution=[hash[d, c, $f2, $e]])
+                              +- Expand(projects=[{d, c, $f2, e, 0 AS $e}, {d, c, null AS $f2, e, 1 AS $e}, {d, null AS c, null AS $f2, e, 3 AS $e}])
+                                 +- Calc(select=[d, c, (a > 0) IS TRUE AS $f2, e])
+                                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testDistinctAggWithDuplicateField">
     <Resource name="sql">
       <![CDATA[SELECT a, COUNT(a), SUM(b), SUM(DISTINCT b) FROM MyTable GROUP BY a]]>
@@ -346,33 +404,6 @@ SortAggregate(isMerge=[true], groupBy=[d], select=[d, Final_MIN(min$0) AS EXPR$1
                               +- Expand(projects=[{d, e, $f2, c, $f4, null AS b, null AS $f6, 3 AS $e}, {d, e, $f2, c, null AS $f4, null AS b, null AS $f6, 7 AS $e}, {d, e, $f2, null AS c, null AS $f4, b, $f6, 12 AS $e}, {d, e, $f2, null AS c, null AS $f4, null AS b, null AS $f6, 15 AS $e}])
                                  +- Calc(select=[d, e, (a < 10) IS TRUE AS $f2, c, (a > 5) IS TRUE AS $f4, b, (b > 3) IS TRUE AS $f6])
                                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="TestMultiDistinctOnDifferentColumnWithFilter">
-    <Resource name="sql">
-      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
-COUNT(DISTINCT b) FILTER (WHERE b > 1) FROM MyTable2 GROUP BY d]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[COUNT(DISTINCT $3) FILTER $4])
-+- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], b=[$1], $f4=[IS TRUE(>($1, 1))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2, Final_COUNT(count$2) AS EXPR$3])
-+- Exchange(distribution=[hash[d]])
-   +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(c) FILTER $g_7 AS count$0, Partial_COUNT(c) FILTER $g_3 AS count$1, Partial_COUNT(b) FILTER $g_12 AS count$2])
-      +- Calc(select=[d, c, b, ((CASE(($e = 3), 3, ($e = 7), 7, 12) = 3) AND $f2 IS TRUE) AS $g_3, (CASE(($e = 3), 3, ($e = 7), 7, 12) = 7) AS $g_7, ((CASE(($e = 3), 3, ($e = 7), 7, 12) = 12) AND $f4 IS TRUE) AS $g_12])
-         +- HashAggregate(isMerge=[true], groupBy=[d, c, $f2, b, $f4, $e], select=[d, c, $f2, b, $f4, $e])
-            +- Exchange(distribution=[hash[d, c, $f2, b, $f4, $e]])
-               +- LocalHashAggregate(groupBy=[d, c, $f2, b, $f4, $e], select=[d, c, $f2, b, $f4, $e])
-                  +- Expand(projects=[{d, c, $f2, null AS b, null AS $f4, 3 AS $e}, {d, c, null AS $f2, null AS b, null AS $f4, 7 AS $e}, {d, null AS c, null AS $f2, b, $f4, 12 AS $e}])
-                     +- Calc(select=[d, c, (a > 0) IS TRUE AS $f2, b, (b > 1) IS TRUE AS $f4])
-                        +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -400,37 +431,6 @@ HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS EX
                   +- Expand(projects=[{d, c, $f2, null AS $f3, 1 AS $e}, {d, c, null AS $f2, $f3, 2 AS $e}, {d, c, null AS $f2, null AS $f3, 3 AS $e}])
                      +- Calc(select=[d, c, (a > 10) IS TRUE AS $f2, (a < 10) IS TRUE AS $f3])
                         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="TestMultiDistinctWithFilterAndNonDistinctAgg">
-    <Resource name="sql">
-      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
-MAX(e), MIN(e) FROM MyTable2 GROUP BY d]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[MAX($3)], EXPR$4=[MIN($3)])
-+- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], e=[$4])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-SortAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2, Final_MIN(min$2) AS EXPR$3, Final_MIN(min$3) AS EXPR$4])
-+- Exchange(distribution=[forward])
-   +- Sort(orderBy=[d ASC])
-      +- Exchange(distribution=[hash[d]])
-         +- LocalSortAggregate(groupBy=[d], select=[d, Partial_COUNT(c) FILTER $g_1 AS count$0, Partial_COUNT(c) FILTER $g_0 AS count$1, Partial_MIN(EXPR$3) FILTER $g_3 AS min$2, Partial_MIN(EXPR$4) FILTER $g_3 AS min$3])
-            +- Calc(select=[d, c, EXPR$3, EXPR$4, ((CASE(($e = 0), 0, ($e = 1), 1, 3) = 0) AND $f2 IS TRUE) AS $g_0, (CASE(($e = 0), 0, ($e = 1), 1, 3) = 1) AS $g_1, (CASE(($e = 0), 0, ($e = 1), 1, 3) = 3) AS $g_3])
-               +- Sort(orderBy=[d ASC])
-                  +- SortAggregate(isMerge=[false], groupBy=[d, c, $f2, $e], select=[d, c, $f2, $e, MAX(e) AS EXPR$3, MIN(e) AS EXPR$4])
-                     +- Exchange(distribution=[forward])
-                        +- Sort(orderBy=[d ASC, c ASC, $f2 ASC, $e ASC])
-                           +- Exchange(distribution=[hash[d, c, $f2, $e]])
-                              +- Expand(projects=[{d, c, $f2, e, 0 AS $e}, {d, c, null AS $f2, e, 1 AS $e}, {d, null AS c, null AS $f2, e, 3 AS $e}])
-                                 +- Calc(select=[d, c, (a > 0) IS TRUE AS $f2, e])
-                                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -566,33 +566,6 @@ Calc(select=[CAST(EXPR$0 AS BIGINT) AS EXPR$0, EXPR$1])
                         +- Expand(projects=[{c, null AS d, a, b, 1 AS $e}, {null AS c, d, a, b, 2 AS $e}])
                            +- Calc(select=[c, d, a, b])
                               +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTwoDistinctAggWithGroupByAndCountStar">
-    <Resource name="sql">
-      <![CDATA[SELECT a, COUNT(*), SUM(DISTINCT b), COUNT(DISTINCT b) FROM MyTable GROUP BY a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT()], EXPR$2=[SUM(DISTINCT $1)], EXPR$3=[COUNT(DISTINCT $1)])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, CAST(EXPR$1 AS BIGINT) AS EXPR$1, EXPR$2, EXPR$3])
-+- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_MIN(min$0) AS EXPR$1, Final_SUM(sum$1) AS EXPR$2, Final_COUNT(count$2) AS EXPR$3])
-   +- Exchange(distribution=[hash[a]])
-      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_MIN(EXPR$1) FILTER $g_1 AS min$0, Partial_SUM(b) FILTER $g_0 AS sum$1, Partial_COUNT(b) FILTER $g_0 AS count$2])
-         +- Calc(select=[a, b, EXPR$1, (CASE(($e = 0), 0, 1) = 0) AS $g_0, (CASE(($e = 0), 0, 1) = 1) AS $g_1])
-            +- HashAggregate(isMerge=[true], groupBy=[a, b, $e], select=[a, b, $e, Final_COUNT(count1$0) AS EXPR$1])
-               +- Exchange(distribution=[hash[a, b, $e]])
-                  +- LocalHashAggregate(groupBy=[a, b, $e], select=[a, b, $e, Partial_COUNT(*) AS count1$0])
-                     +- Expand(projects=[{a, b, 0 AS $e}, {a, null AS b, 1 AS $e}])
-                        +- Calc(select=[a, b])
-                           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -696,6 +669,33 @@ Calc(select=[a, CAST(EXPR$1 AS BIGINT) AS EXPR$1, EXPR$2, EXPR$3])
                   +- LocalHashAggregate(groupBy=[a, b, c, $e], select=[a, b, c, $e, Partial_COUNT(*) AS count1$0])
                      +- Expand(projects=[{a, b, null AS c, 1 AS $e}, {a, null AS b, c, 2 AS $e}, {a, null AS b, null AS c, 3 AS $e}])
                         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoDistinctAggWithGroupByAndCountStar">
+    <Resource name="sql">
+      <![CDATA[SELECT a, COUNT(*), SUM(DISTINCT b), COUNT(DISTINCT b) FROM MyTable GROUP BY a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT()], EXPR$2=[SUM(DISTINCT $1)], EXPR$3=[COUNT(DISTINCT $1)])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, CAST(EXPR$1 AS BIGINT) AS EXPR$1, EXPR$2, EXPR$3])
++- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_MIN(min$0) AS EXPR$1, Final_SUM(sum$1) AS EXPR$2, Final_COUNT(count$2) AS EXPR$3])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_MIN(EXPR$1) FILTER $g_1 AS min$0, Partial_SUM(b) FILTER $g_0 AS sum$1, Partial_COUNT(b) FILTER $g_0 AS count$2])
+         +- Calc(select=[a, b, EXPR$1, (CASE(($e = 0), 0, 1) = 0) AS $g_0, (CASE(($e = 0), 0, 1) = 1) AS $g_1])
+            +- HashAggregate(isMerge=[true], groupBy=[a, b, $e], select=[a, b, $e, Final_COUNT(count1$0) AS EXPR$1])
+               +- Exchange(distribution=[hash[a, b, $e]])
+                  +- LocalHashAggregate(groupBy=[a, b, $e], select=[a, b, $e, Partial_COUNT(*) AS count1$0])
+                     +- Expand(projects=[{a, b, 0 AS $e}, {a, null AS b, 1 AS $e}])
+                        +- Calc(select=[a, b])
+                           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml
index 843dd9acd87..cc694a0e4de 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml
@@ -203,29 +203,6 @@ Calc(select=[EXPR$0, w$start AS EXPR$1], where=[(($f1 > 0) AND (EXTRACT(QUARTER,
       +- LocalHashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 60000, 900000)], properties=[w$start, w$end, w$rowtime], select=[Partial_COUNT(*) AS count1$0, Partial_SUM(a) AS sum$1])
          +- Calc(select=[ts, a])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSlidingWindowSortAggWithPaneOptimization[aggStrategy=AUTO]">
-    <Resource name="sql">
-      <![CDATA[SELECT COUNT(c) FROM MyTable1 GROUP BY a, HOP(ts, INTERVAL '3' SECOND, INTERVAL '1' HOUR)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[COUNT($2)])
-   +- LogicalProject(a=[$1], $f1=[$HOP($0, 3000:INTERVAL SECOND, 3600000:INTERVAL HOUR)], c=[$3])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0])
-+- HashWindowAggregate(groupBy=[a], window=[SlidingGroupWindow('w$, ts, 3600000, 3000)], select=[a, Final_COUNT(count$0) AS EXPR$0])
-   +- Exchange(distribution=[hash[a]])
-      +- LocalHashWindowAggregate(groupBy=[a], window=[SlidingGroupWindow('w$, ts, 3600000, 3000)], select=[a, Partial_COUNT(c) AS count$0])
-         +- Calc(select=[a, ts, c])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[ts, a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -377,6 +354,28 @@ HashWindowAggregate(window=[TumblingGroupWindow('w$, b, 3000)], select=[Final_AV
    +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w$, b, 3000)], select=[Partial_AVG(c) AS (sum$0, count$1), Partial_SUM(a) AS sum$2])
       +- Calc(select=[b, c, a])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNonPartitionedSlidingWindow[aggStrategy=AUTO]">
+    <Resource name="sql">
+      <![CDATA[SELECT SUM(a) AS sumA, COUNT(b) AS cntB FROM MyTable2 GROUP BY HOP(ts, INTERVAL '15' MINUTE, INTERVAL '90' MINUTE)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(sumA=[$1], cntB=[$2])
++- LogicalAggregate(group=[{0}], sumA=[SUM($1)], cntB=[COUNT($2)])
+   +- LogicalProject($f0=[$HOP($4, 900000:INTERVAL MINUTE, 5400000:INTERVAL MINUTE)], a=[$0], b=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 5400000, 900000)], select=[Final_SUM(sum$0) AS sumA, Final_COUNT(count$1) AS cntB])
++- Exchange(distribution=[single])
+   +- LocalHashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 5400000, 900000)], select=[Partial_SUM(a) AS sum$0, Partial_COUNT(b) AS count$1])
+      +- Calc(select=[ts, a, b])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -508,28 +507,6 @@ Calc(select=[c, w$end AS EXPR$1, w$start AS EXPR$2, w$rowtime AS EXPR$3, sumA, a
    +- Exchange(distribution=[hash[c, d]])
       +- LocalHashWindowAggregate(groupBy=[c, d], window=[SlidingGroupWindow('w$, ts, 10800000, 3600000)], properties=[w$start, w$end, w$rowtime], select=[c, d, Partial_SUM(a) AS sum$0, Partial_AVG(b) AS (sum$1, count$2)])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testNonPartitionedSlidingWindow[aggStrategy=AUTO]">
-    <Resource name="sql">
-      <![CDATA[SELECT SUM(a) AS sumA, COUNT(b) AS cntB FROM MyTable2 GROUP BY HOP(ts, INTERVAL '15' MINUTE, INTERVAL '90' MINUTE)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(sumA=[$1], cntB=[$2])
-+- LogicalAggregate(group=[{0}], sumA=[SUM($1)], cntB=[COUNT($2)])
-   +- LogicalProject($f0=[$HOP($4, 900000:INTERVAL MINUTE, 5400000:INTERVAL MINUTE)], a=[$0], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 5400000, 900000)], select=[Final_SUM(sum$0) AS sumA, Final_COUNT(count$1) AS cntB])
-+- Exchange(distribution=[single])
-   +- LocalHashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 5400000, 900000)], select=[Partial_SUM(a) AS sum$0, Partial_COUNT(b) AS count$1])
-      +- Calc(select=[ts, a, b])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -1072,6 +1049,29 @@ Calc(select=[EXPR$0])
                +- Exchange(distribution=[forward])
                   +- Sort(orderBy=[a ASC, d ASC, b ASC])
                      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSlidingWindowSortAggWithPaneOptimization[aggStrategy=AUTO]">
+    <Resource name="sql">
+      <![CDATA[SELECT COUNT(c) FROM MyTable1 GROUP BY a, HOP(ts, INTERVAL '3' SECOND, INTERVAL '1' HOUR)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[COUNT($2)])
+   +- LogicalProject(a=[$1], $f1=[$HOP($0, 3000:INTERVAL SECOND, 3600000:INTERVAL HOUR)], c=[$3])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[EXPR$0])
++- HashWindowAggregate(groupBy=[a], window=[SlidingGroupWindow('w$, ts, 3600000, 3000)], select=[a, Final_COUNT(count$0) AS EXPR$0])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalHashWindowAggregate(groupBy=[a], window=[SlidingGroupWindow('w$, ts, 3600000, 3000)], select=[a, Partial_COUNT(c) AS count$0])
+         +- Calc(select=[a, ts, c])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[ts, a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1526,29 +1526,6 @@ Union(all=[true], union=[EXPR$0])
       +- Exchange(distribution=[single])
          +- LocalHashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 7200000, 3600000)], select=[])
             +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWindowEndOnly[aggStrategy=AUTO]">
-    <Resource name="sql">
-      <![CDATA[SELECT TUMBLE_END(ts, INTERVAL '4' MINUTE) FROM MyTable2 GROUP BY TUMBLE(ts, INTERVAL '4' MINUTE), c]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[TUMBLE_END($0)])
-+- LogicalAggregate(group=[{0, 1}])
-   +- LogicalProject($f0=[$TUMBLE($4, 240000:INTERVAL MINUTE)], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[w$end AS EXPR$0])
-+- HashWindowAggregate(groupBy=[c], window=[TumblingGroupWindow('w$, ts, 240000)], properties=[w$start, w$end, w$rowtime], select=[c])
-   +- Exchange(distribution=[hash[c]])
-      +- LocalHashWindowAggregate(groupBy=[c], window=[TumblingGroupWindow('w$, ts, 240000)], properties=[w$start, w$end, w$rowtime], select=[c])
-         +- Calc(select=[ts, c])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -1599,28 +1576,6 @@ Union(all=[true], union=[EXPR$0])
    +- SortWindowAggregate(window=[SlidingGroupWindow('w$, ts, 7200000, 3600000)], select=[])
       +- Sort(orderBy=[ts ASC])
          +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWindowEndOnly[aggStrategy=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT TUMBLE_END(ts, INTERVAL '4' MINUTE) FROM MyTable2 GROUP BY TUMBLE(ts, INTERVAL '4' MINUTE), c]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[TUMBLE_END($0)])
-+- LogicalAggregate(group=[{0, 1}])
-   +- LogicalProject($f0=[$TUMBLE($4, 240000:INTERVAL MINUTE)], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[w$end AS EXPR$0])
-+- HashWindowAggregate(groupBy=[c], window=[TumblingGroupWindow('w$, ts, 240000)], properties=[w$start, w$end, w$rowtime], select=[c])
-   +- Exchange(distribution=[hash[c]])
-      +- Calc(select=[ts, c])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -1673,6 +1628,51 @@ Union(all=[true], union=[EXPR$0])
       +- Exchange(distribution=[single])
          +- LocalHashWindowAggregate(window=[SlidingGroupWindow('w$, ts, 7200000, 3600000)], select=[])
             +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWindowEndOnly[aggStrategy=AUTO]">
+    <Resource name="sql">
+      <![CDATA[SELECT TUMBLE_END(ts, INTERVAL '4' MINUTE) FROM MyTable2 GROUP BY TUMBLE(ts, INTERVAL '4' MINUTE), c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[TUMBLE_END($0)])
++- LogicalAggregate(group=[{0, 1}])
+   +- LogicalProject($f0=[$TUMBLE($4, 240000:INTERVAL MINUTE)], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[w$end AS EXPR$0])
++- HashWindowAggregate(groupBy=[c], window=[TumblingGroupWindow('w$, ts, 240000)], properties=[w$start, w$end, w$rowtime], select=[c])
+   +- Exchange(distribution=[hash[c]])
+      +- LocalHashWindowAggregate(groupBy=[c], window=[TumblingGroupWindow('w$, ts, 240000)], properties=[w$start, w$end, w$rowtime], select=[c])
+         +- Calc(select=[ts, c])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWindowEndOnly[aggStrategy=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT TUMBLE_END(ts, INTERVAL '4' MINUTE) FROM MyTable2 GROUP BY TUMBLE(ts, INTERVAL '4' MINUTE), c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[TUMBLE_END($0)])
++- LogicalAggregate(group=[{0, 1}])
+   +- LogicalProject($f0=[$TUMBLE($4, 240000:INTERVAL MINUTE)], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[w$end AS EXPR$0])
++- HashWindowAggregate(groupBy=[c], window=[TumblingGroupWindow('w$, ts, 240000)], properties=[w$start, w$end, w$rowtime], select=[c])
+   +- Exchange(distribution=[hash[c]])
+      +- Calc(select=[ts, c])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, ts])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml
index 2b90453d5d4..4ec32df7293 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml
@@ -371,30 +371,6 @@ Calc(select=[deptno, gender, CASE(($e = 0), 0, ($e = 1), 5, 7) AS EXPR$2, c])
          +- Expand(projects=[{gender, deptno, 0 AS $e}, {gender, null AS deptno, 1 AS $e}, {null AS gender, null AS deptno, 3 AS $e}])
             +- Calc(select=[gender, CAST(10 AS INTEGER) AS deptno], where=[(deptno = 10)])
                +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSimpleCube">
-    <Resource name="sql">
-      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY CUBE(deptno, gender)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], c=[$2])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], c=[COUNT()])
-   +- LogicalProject(deptno=[$1], gender=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[(deptno + 1) AS EXPR$0, c])
-+- HashAggregate(isMerge=[true], groupBy=[deptno, gender, $e], select=[deptno, gender, $e, Final_COUNT(count1$0) AS c])
-   +- Exchange(distribution=[hash[deptno, gender, $e]])
-      +- LocalHashAggregate(groupBy=[deptno, gender, $e], select=[deptno, gender, $e, Partial_COUNT(*) AS count1$0])
-         +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
-            +- Calc(select=[deptno, gender])
-               +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -537,6 +513,37 @@ Calc(select=[deptno, gender, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS gd, CASE(($e
          +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
             +- Calc(select=[deptno, gender])
                +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testGroupingInOrderByClause">
+    <Resource name="sql">
+      <![CDATA[
+SELECT COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno) ORDER BY GROUPING(deptno), c
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$0])
++- LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
+   +- LogicalProject(c=[$1], EXPR$1=[$2])
+      +- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()], agg#1=[GROUPING($0)])
+         +- LogicalProject(deptno=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[c])
++- Sort(orderBy=[EXPR$1 ASC, c ASC])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[c, CASE(($e = 0), 0, 1) AS EXPR$1])
+         +- HashAggregate(isMerge=[true], groupBy=[deptno, $e], select=[deptno, $e, Final_COUNT(count1$0) AS c])
+            +- Exchange(distribution=[hash[deptno, $e]])
+               +- LocalHashAggregate(groupBy=[deptno, $e], select=[deptno, $e, Partial_COUNT(*) AS count1$0])
+                  +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
+                     +- Calc(select=[deptno])
+                        +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -725,37 +732,6 @@ Calc(select=[EXPR$0, c])
          +- Expand(projects=[{EXPR$0, 0 AS $e}, {null AS EXPR$0, 1 AS $e}])
             +- Calc(select=[(deptno + 1) AS EXPR$0])
                +- TableSourceScan(table=[[default_catalog, default_database, emps]], fields=[empno, name, deptno, gender, city, empid, age, slacker, manager, joinedat])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testGroupingInOrderByClause">
-    <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno) ORDER BY GROUPING(deptno), c
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(c=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
-   +- LogicalProject(c=[$1], EXPR$1=[$2])
-      +- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()], agg#1=[GROUPING($0)])
-         +- LogicalProject(deptno=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[c])
-+- Sort(orderBy=[EXPR$1 ASC, c ASC])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[c, CASE(($e = 0), 0, 1) AS EXPR$1])
-         +- HashAggregate(isMerge=[true], groupBy=[deptno, $e], select=[deptno, $e, Final_COUNT(count1$0) AS c])
-            +- Exchange(distribution=[hash[deptno, $e]])
-               +- LocalHashAggregate(groupBy=[deptno, $e], select=[deptno, $e, Partial_COUNT(*) AS count1$0])
-                  +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
-                     +- Calc(select=[deptno])
-                        +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -935,6 +911,30 @@ Calc(select=[($f0 + 1) AS half1, c])
          +- Expand(projects=[{$f0, gender, $f2, 0 AS $e}, {$f0, gender, null AS $f2, 1 AS $e}, {$f0, null AS gender, $f2, 2 AS $e}, {$f0, null AS gender, null AS $f2, 3 AS $e}, {null AS $f0, null AS gender, $f2, 6 AS $e}, {null AS $f0, null AS gender, null AS $f2, 7 AS $e}])
             +- Calc(select=[(deptno / 2) AS $f0, gender, SUBSTRING(ename, 1, 1) AS $f2])
                +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRollupOn1Column">
+    <Resource name="sql">
+      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[+($0, 1)], c=[$1])
++- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()])
+   +- LogicalProject(deptno=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[(deptno + 1) AS EXPR$0, c])
++- HashAggregate(isMerge=[true], groupBy=[deptno, $e], select=[deptno, $e, Final_COUNT(count1$0) AS c])
+   +- Exchange(distribution=[hash[deptno, $e]])
+      +- LocalHashAggregate(groupBy=[deptno, $e], select=[deptno, $e, Partial_COUNT(*) AS count1$0])
+         +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
+            +- Calc(select=[deptno])
+               +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -1040,26 +1040,26 @@ Calc(select=[(deptno + 1) AS d1, c], where=[(c > 3)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRollupOn1Column">
+  <TestCase name="testSimpleCube">
     <Resource name="sql">
-      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno)]]>
+      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY CUBE(deptno, gender)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], c=[$1])
-+- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()])
-   +- LogicalProject(deptno=[$1])
+LogicalProject(EXPR$0=[+($0, 1)], c=[$2])
++- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], c=[COUNT()])
+   +- LogicalProject(deptno=[$1], gender=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[(deptno + 1) AS EXPR$0, c])
-+- HashAggregate(isMerge=[true], groupBy=[deptno, $e], select=[deptno, $e, Final_COUNT(count1$0) AS c])
-   +- Exchange(distribution=[hash[deptno, $e]])
-      +- LocalHashAggregate(groupBy=[deptno, $e], select=[deptno, $e, Partial_COUNT(*) AS count1$0])
-         +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
-            +- Calc(select=[deptno])
++- HashAggregate(isMerge=[true], groupBy=[deptno, gender, $e], select=[deptno, gender, $e, Final_COUNT(count1$0) AS c])
+   +- Exchange(distribution=[hash[deptno, gender, $e]])
+      +- LocalHashAggregate(groupBy=[deptno, gender, $e], select=[deptno, gender, $e, Partial_COUNT(*) AS count1$0])
+         +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
+            +- Calc(select=[deptno, gender])
                +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/HashAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/HashAggregateTest.xml
index 238a36d537c..bcccb462898 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/HashAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/HashAggregateTest.xml
@@ -76,130 +76,130 @@ HashAggregate(isMerge=[false], groupBy=[b], select=[b, var_sum(a) AS EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilter[aggStrategy=AUTO]">
+  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
+   +- LogicalFilter(condition=[=($0, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
+HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
 +- Exchange(distribution=[single])
-   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
-      +- Calc(select=[a, b, c], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
+      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilter[aggStrategy=ONE_PHASE]">
+  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
+   +- LogicalFilter(condition=[=($0, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2])
+HashAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2, SUM($f3) AS EXPR$3])
 +- Exchange(distribution=[single])
-   +- Calc(select=[a, b, c], where=[(a = 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilter[aggStrategy=TWO_PHASE]">
+  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
+   +- LogicalFilter(condition=[=($0, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
+HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
 +- Exchange(distribution=[single])
-   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
-      +- Calc(select=[a, b, c], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
+      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=AUTO]">
+  <TestCase name="testAggregateWithFilter[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
-   +- LogicalFilter(condition=[=($0, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
+HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
 +- Exchange(distribution=[single])
-   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
-      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
+   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
+      +- Calc(select=[a, b, c], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=ONE_PHASE]">
+  <TestCase name="testAggregateWithFilter[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
-   +- LogicalFilter(condition=[=($0, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2, SUM($f3) AS EXPR$3])
+HashAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2])
 +- Exchange(distribution=[single])
-   +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
+   +- Calc(select=[a, b, c], where=[(a = 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=TWO_PHASE]">
+  <TestCase name="testAggregateWithFilter[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
-   +- LogicalFilter(condition=[=($0, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
+HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
 +- Exchange(distribution=[single])
-   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
-      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
+   +- LocalHashAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
+      +- Calc(select=[a, b, c], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -413,107 +413,57 @@ HashAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCount[aggStrategy=AUTO]">
+  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(`byte`),
-       COUNT(`short`),
-       COUNT(`int`),
-       COUNT(`long`),
-       COUNT(`float`),
-       COUNT(`double`),
-       COUNT(`decimal3020`),
-       COUNT(`decimal105`),
-       COUNT(`boolean`),
-       COUNT(`date`),
-       COUNT(`time`),
-       COUNT(`timestamp`),
-       COUNT(`string`)
-FROM MyTable
-      ]]>
+      <![CDATA[SELECT COUNT(*) FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
++- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-   +- LocalHashAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
+   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCount[aggStrategy=ONE_PHASE]">
+  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(`byte`),
-       COUNT(`short`),
-       COUNT(`int`),
-       COUNT(`long`),
-       COUNT(`float`),
-       COUNT(`double`),
-       COUNT(`decimal3020`),
-       COUNT(`decimal105`),
-       COUNT(`boolean`),
-       COUNT(`date`),
-       COUNT(`time`),
-       COUNT(`timestamp`),
-       COUNT(`string`)
-FROM MyTable
-      ]]>
+      <![CDATA[SELECT COUNT(*) FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
++- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[false], select=[COUNT(byte) AS EXPR$0, COUNT(short) AS EXPR$1, COUNT(int) AS EXPR$2, COUNT(long) AS EXPR$3, COUNT(float) AS EXPR$4, COUNT(double) AS EXPR$5, COUNT(decimal3020) AS EXPR$6, COUNT(decimal105) AS EXPR$7, COUNT(boolean) AS EXPR$8, COUNT(date) AS EXPR$9, COUNT(time) AS EXPR$10, COUNT(timestamp) AS EXPR$11, COUNT(string) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+HashAggregate(isMerge=[false], select=[COUNT(*) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
++- Exchange(distribution=[single]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[id, cnt]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCount[aggStrategy=TWO_PHASE]">
+  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(`byte`),
-       COUNT(`short`),
-       COUNT(`int`),
-       COUNT(`long`),
-       COUNT(`float`),
-       COUNT(`double`),
-       COUNT(`decimal3020`),
-       COUNT(`decimal105`),
-       COUNT(`boolean`),
-       COUNT(`date`),
-       COUNT(`time`),
-       COUNT(`timestamp`),
-       COUNT(`string`)
-FROM MyTable
-      ]]>
+      <![CDATA[SELECT COUNT(*) FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
++- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-   +- LocalHashAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
+   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
 ]]>
     </Resource>
   </TestCase>
@@ -573,68 +523,119 @@ HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=AUTO]">
+  <TestCase name="testCount[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*) FROM src]]>
+      <![CDATA[
+SELECT COUNT(`byte`),
+       COUNT(`short`),
+       COUNT(`int`),
+       COUNT(`long`),
+       COUNT(`float`),
+       COUNT(`double`),
+       COUNT(`decimal3020`),
+       COUNT(`decimal105`),
+       COUNT(`boolean`),
+       COUNT(`date`),
+       COUNT(`time`),
+       COUNT(`timestamp`),
+       COUNT(`string`)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
-+- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
-   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
+HashAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+   +- LocalHashAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=ONE_PHASE]">
+  <TestCase name="testCount[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*) FROM src]]>
+      <![CDATA[
+SELECT COUNT(`byte`),
+       COUNT(`short`),
+       COUNT(`int`),
+       COUNT(`long`),
+       COUNT(`float`),
+       COUNT(`double`),
+       COUNT(`decimal3020`),
+       COUNT(`decimal105`),
+       COUNT(`boolean`),
+       COUNT(`date`),
+       COUNT(`time`),
+       COUNT(`timestamp`),
+       COUNT(`string`)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
-+- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[false], select=[COUNT(*) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
-+- Exchange(distribution=[single]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
-   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[id, cnt]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+HashAggregate(isMerge=[false], select=[COUNT(byte) AS EXPR$0, COUNT(short) AS EXPR$1, COUNT(int) AS EXPR$2, COUNT(long) AS EXPR$3, COUNT(float) AS EXPR$4, COUNT(double) AS EXPR$5, COUNT(decimal3020) AS EXPR$6, COUNT(decimal105) AS EXPR$7, COUNT(boolean) AS EXPR$8, COUNT(date) AS EXPR$9, COUNT(time) AS EXPR$10, COUNT(timestamp) AS EXPR$11, COUNT(string) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=TWO_PHASE]">
+  <TestCase name="testCount[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*) FROM src]]>
+      <![CDATA[
+SELECT COUNT(`byte`),
+       COUNT(`short`),
+       COUNT(`int`),
+       COUNT(`long`),
+       COUNT(`float`),
+       COUNT(`double`),
+       COUNT(`decimal3020`),
+       COUNT(`decimal105`),
+       COUNT(`boolean`),
+       COUNT(`date`),
+       COUNT(`time`),
+       COUNT(`timestamp`),
+       COUNT(`string`)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
-+- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
-   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
+HashAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+   +- LocalHashAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregate[aggStrategy=AUTO]">
+  <TestCase name="testGroupAggregateWithFilter[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -642,36 +643,40 @@ LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
 HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2])
 +- Exchange(distribution=[hash[a]])
    +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+      +- Calc(select=[a, b, c], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregate[aggStrategy=ONE_PHASE]">
+  <TestCase name="testGroupAggregateWithFilter[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 HashAggregate(isMerge=[false], groupBy=[a], select=[a, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2])
 +- Exchange(distribution=[hash[a]])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Calc(select=[a, b, c], where=[(a = 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregate[aggStrategy=TWO_PHASE]">
+  <TestCase name="testGroupAggregateWithFilter[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -679,19 +684,19 @@ LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
 HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2])
 +- Exchange(distribution=[hash[a]])
    +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+      +- Calc(select=[a, b, c], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter[aggStrategy=AUTO]">
+  <TestCase name="testGroupAggregate[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -699,40 +704,36 @@ LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
 HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2])
 +- Exchange(distribution=[hash[a]])
    +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
-      +- Calc(select=[a, b, c], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter[aggStrategy=ONE_PHASE]">
+  <TestCase name="testGroupAggregate[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 HashAggregate(isMerge=[false], groupBy=[a], select=[a, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2])
 +- Exchange(distribution=[hash[a]])
-   +- Calc(select=[a, b, c], where=[(a = 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter[aggStrategy=TWO_PHASE]">
+  <TestCase name="testGroupAggregate[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -740,8 +741,7 @@ LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
 HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1, Final_COUNT(count$1) AS EXPR$2])
 +- Exchange(distribution=[hash[a]])
    +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
-      +- Calc(select=[a, b, c], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/OverAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/OverAggregateTest.xml
index b9329e59478..39f7ddd17a4 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/OverAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/OverAggregateTest.xml
@@ -16,6 +16,28 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
+  <TestCase name="testDenseRankOnOrder">
+    <Resource name="sql">
+      <![CDATA[SELECT a, DENSE_RANK() OVER (PARTITION BY a ORDER BY proctime) FROM MyTableWithProctime]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], EXPR$1=[DENSE_RANK() OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTableWithProctime]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, w0$o0 AS $1])
++- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window#0=[DENSE_RANK(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, proctime, w0$o0])
+   +- Exchange(distribution=[forward])
+      +- Sort(orderBy=[a ASC, proctime ASC])
+         +- Exchange(distribution=[hash[a]])
+            +- Calc(select=[a, proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTableWithProctime]], fields=[a, b, c, proctime])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testDiffPartitionKeysWithDiffOrderKeys1">
     <Resource name="sql">
       <![CDATA[
@@ -152,6 +174,43 @@ Calc(select=[w0$o0 AS EXPR$0, CASE((w1$o0 > 0), w1$o1, null:INTEGER) AS EXPR$1,
                +- Exchange(distribution=[hash[c]])
                   +- Calc(select=[a, c])
                      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestedOverAgg">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM (
+ SELECT
+    *, count(*) OVER (PARTITION BY a ORDER BY ts) AS c2
+  FROM (
+    SELECT
+      *, count(*) OVER (PARTITION BY a,b ORDER BY ts) AS c1
+    FROM src
+  )
+)
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], ts=[$2], c1=[$3], c2=[$4])
++- LogicalProject(a=[$0], b=[$1], ts=[$2], c1=[$3], c2=[COUNT() OVER (PARTITION BY $0 ORDER BY $2 NULLS FIRST)])
+   +- LogicalProject(a=[$0], b=[$1], ts=[$2], c1=[COUNT() OVER (PARTITION BY $0, $1 ORDER BY $2 NULLS FIRST)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+OverAggregate(partitionBy=[a], orderBy=[ts ASC], window#0=[COUNT(*) AS w0$o0_0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, ts, w0$o0, w0$o0_0])
++- Exchange(distribution=[forward])
+   +- Sort(orderBy=[a ASC, ts ASC])
+      +- Exchange(distribution=[hash[a]])
+         +- OverAggregate(partitionBy=[a, b], orderBy=[ts ASC], window#0=[COUNT(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, ts, w0$o0])
+            +- Exchange(distribution=[forward])
+               +- Sort(orderBy=[a ASC, b ASC, ts ASC])
+                  +- Exchange(distribution=[hash[a, b]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[a, b, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -256,6 +315,36 @@ Calc(select=[w0$o0 AS $0])
          +- Exchange(distribution=[hash[c]])
             +- Calc(select=[a, c])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOverWindowWithConstants3">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+    COUNT(2) OVER (ORDER BY a),
+    COUNT(1) OVER (PARTITION BY c ORDER BY a)
+FROM MyTable
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[COUNT(2) OVER (ORDER BY $0 NULLS FIRST)], EXPR$1=[COUNT(1) OVER (PARTITION BY $2 ORDER BY $0 NULLS FIRST)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[w0$o0 AS $0, w1$o0 AS $1])
++- OverAggregate(partitionBy=[c], orderBy=[a ASC], window#0=[COUNT(1) AS w1$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, w0$o0, w1$o0])
+   +- Exchange(distribution=[forward])
+      +- Sort(orderBy=[c ASC, a ASC])
+         +- Exchange(distribution=[hash[c]])
+            +- OverAggregate(orderBy=[a ASC], window#0=[COUNT(2) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, w0$o0])
+               +- Sort(orderBy=[a ASC])
+                  +- Exchange(distribution=[single])
+                     +- Calc(select=[a, c])
+                        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -280,50 +369,6 @@ OverAggregate(partitionBy=[c], window#0=[COUNT(*) AS w0$o0 RANGE BETWEEN UNBOUND
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testDenseRankOnOrder">
-		<Resource name="sql">
-			<![CDATA[SELECT a, DENSE_RANK() OVER (PARTITION BY a ORDER BY proctime) FROM MyTableWithProctime]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0], EXPR$1=[DENSE_RANK() OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTableWithProctime]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[a, w0$o0 AS $1])
-+- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window#0=[DENSE_RANK(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, proctime, w0$o0])
-   +- Exchange(distribution=[forward])
-      +- Sort(orderBy=[a ASC, proctime ASC])
-         +- Exchange(distribution=[hash[a]])
-            +- Calc(select=[a, proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTableWithProctime]], fields=[a, b, c, proctime])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testRankOnOver">
-		<Resource name="sql">
-			<![CDATA[SELECT a, RANK() OVER (PARTITION BY a ORDER BY proctime) FROM MyTableWithProctime]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0], EXPR$1=[RANK() OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTableWithProctime]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[a, w0$o0 AS $1])
-+- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window#0=[RANK(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, proctime, w0$o0])
-   +- Exchange(distribution=[forward])
-      +- Sort(orderBy=[a ASC, proctime ASC])
-         +- Exchange(distribution=[hash[a]])
-            +- Calc(select=[a, proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTableWithProctime]], fields=[a, b, c, proctime])
-]]>
-		</Resource>
-	</TestCase>
   <TestCase name="testOverWindowWithoutPartitionBy">
     <Resource name="sql">
       <![CDATA[SELECT c, SUM(a) OVER (ORDER BY b) FROM MyTable]]>
@@ -412,6 +457,28 @@ Calc(select=[w0$o0 AS $0])
          +- Exchange(distribution=[hash[c]])
             +- Calc(select=[a, c])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRankOnOver">
+    <Resource name="sql">
+      <![CDATA[SELECT a, RANK() OVER (PARTITION BY a ORDER BY proctime) FROM MyTableWithProctime]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], EXPR$1=[RANK() OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTableWithProctime]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, w0$o0 AS $1])
++- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window#0=[RANK(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, proctime, w0$o0])
+   +- Exchange(distribution=[forward])
+      +- Sort(orderBy=[a ASC, proctime ASC])
+         +- Exchange(distribution=[hash[a]])
+            +- Calc(select=[a, proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTableWithProctime]], fields=[a, b, c, proctime])
 ]]>
     </Resource>
   </TestCase>
@@ -483,36 +550,6 @@ Calc(select=[CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS EXPR$0, w0$o2 AS EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOverWindowWithConstants3">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-    COUNT(2) OVER (ORDER BY a),
-    COUNT(1) OVER (PARTITION BY c ORDER BY a)
-FROM MyTable
-      ]]>
-	</Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[COUNT(2) OVER (ORDER BY $0 NULLS FIRST)], EXPR$1=[COUNT(1) OVER (PARTITION BY $2 ORDER BY $0 NULLS FIRST)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-	</Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[w0$o0 AS $0, w1$o0 AS $1])
-+- OverAggregate(partitionBy=[c], orderBy=[a ASC], window#0=[COUNT(1) AS w1$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, w0$o0, w1$o0])
-   +- Exchange(distribution=[forward])
-      +- Sort(orderBy=[c ASC, a ASC])
-         +- Exchange(distribution=[hash[c]])
-            +- OverAggregate(orderBy=[a ASC], window#0=[COUNT(2) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, w0$o0])
-               +- Sort(orderBy=[a ASC])
-                  +- Exchange(distribution=[single])
-                     +- Calc(select=[a, c])
-                        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-	</Resource>
-  </TestCase>
   <TestCase name="testSamePartitionKeysWithDiffOrderKeys1">
     <Resource name="sql">
       <![CDATA[
@@ -675,38 +712,6 @@ Calc(select=[w0$o0 AS $0, w1$o0 AS $1])
                   +- Sort(orderBy=[b ASC, a ASC])
                      +- Exchange(distribution=[hash[b]])
                         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSamePartitionKeysWithSameOrderKeysWithEmptyOrder">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-    SUM(a) OVER (PARTITION BY b ORDER BY a),
-    MIN(a) OVER (PARTITION BY b),
-    MAX(a) OVER (PARTITION BY b ORDER BY a)
-FROM MyTable
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[CASE(>(COUNT($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), 0), $SUM0($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), null:INTEGER)], EXPR$1=[MIN($0) OVER (PARTITION BY $1)], EXPR$2=[MAX($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS EXPR$0, w1$o0 AS EXPR$1, w0$o2 AS EXPR$2])
-+- OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[COUNT(a) AS w1$o0, $SUM0(a) AS w0$o0, MAX(a) AS w0$o1 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o2, w1$o0, w0$o0, w0$o1])
-   +- Exchange(distribution=[forward])
-      +- Sort(orderBy=[b ASC, a ASC])
-         +- Exchange(distribution=[keep_input_as_is[hash[b]]])
-            +- OverAggregate(partitionBy=[b], window#0=[MIN(a) AS w0$o2 RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING], select=[a, b, w0$o2])
-               +- Exchange(distribution=[forward])
-                  +- Sort(orderBy=[b ASC])
-                     +- Exchange(distribution=[hash[b]])
-                        +- Calc(select=[a, b])
-                           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -738,40 +743,35 @@ Calc(select=[a, w0$o0 AS $1, w1$o0 AS $2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNestedOverAgg">
+  <TestCase name="testSamePartitionKeysWithSameOrderKeysWithEmptyOrder">
     <Resource name="sql">
       <![CDATA[
-SELECT *
-FROM (
- SELECT
-    *, count(*) OVER (PARTITION BY a ORDER BY ts) AS c2
-  FROM (
-    SELECT
-      *, count(*) OVER (PARTITION BY a,b ORDER BY ts) AS c1
-    FROM src
-  )
-)
-]]>
+SELECT
+    SUM(a) OVER (PARTITION BY b ORDER BY a),
+    MIN(a) OVER (PARTITION BY b),
+    MAX(a) OVER (PARTITION BY b ORDER BY a)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], ts=[$2], c1=[$3], c2=[$4])
-+- LogicalProject(a=[$0], b=[$1], ts=[$2], c1=[$3], c2=[COUNT() OVER (PARTITION BY $0 ORDER BY $2 NULLS FIRST)])
-   +- LogicalProject(a=[$0], b=[$1], ts=[$2], c1=[COUNT() OVER (PARTITION BY $0, $1 ORDER BY $2 NULLS FIRST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(EXPR$0=[CASE(>(COUNT($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), 0), $SUM0($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), null:INTEGER)], EXPR$1=[MIN($0) OVER (PARTITION BY $1)], EXPR$2=[MAX($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-OverAggregate(partitionBy=[a], orderBy=[ts ASC], window#0=[COUNT(*) AS w0$o0_0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, ts, w0$o0, w0$o0_0])
-+- Exchange(distribution=[forward])
-   +- Sort(orderBy=[a ASC, ts ASC])
-      +- Exchange(distribution=[hash[a]])
-         +- OverAggregate(partitionBy=[a, b], orderBy=[ts ASC], window#0=[COUNT(*) AS w0$o0 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, ts, w0$o0])
-            +- Exchange(distribution=[forward])
-               +- Sort(orderBy=[a ASC, b ASC, ts ASC])
-                  +- Exchange(distribution=[hash[a, b]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[a, b, ts])
+Calc(select=[CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS EXPR$0, w1$o0 AS EXPR$1, w0$o2 AS EXPR$2])
++- OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[COUNT(a) AS w1$o0, $SUM0(a) AS w0$o0, MAX(a) AS w0$o1 RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o2, w1$o0, w0$o0, w0$o1])
+   +- Exchange(distribution=[forward])
+      +- Sort(orderBy=[b ASC, a ASC])
+         +- Exchange(distribution=[keep_input_as_is[hash[b]]])
+            +- OverAggregate(partitionBy=[b], window#0=[MIN(a) AS w0$o2 RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING], select=[a, b, w0$o2])
+               +- Exchange(distribution=[forward])
+                  +- Sort(orderBy=[b ASC])
+                     +- Exchange(distribution=[hash[b]])
+                        +- Calc(select=[a, b])
+                           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/SortAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/SortAggregateTest.xml
index 2aca5048d78..4d52406652c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/SortAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/SortAggregateTest.xml
@@ -82,130 +82,130 @@ SortAggregate(isMerge=[false], groupBy=[b], select=[b, var_sum(a) AS EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilter[aggStrategy=AUTO]">
+  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
+   +- LogicalFilter(condition=[=($0, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
+SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
 +- Exchange(distribution=[single])
-   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
-      +- Calc(select=[a, b, c], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
+      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilter[aggStrategy=ONE_PHASE]">
+  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
+   +- LogicalFilter(condition=[=($0, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2])
+SortAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2, SUM($f3) AS EXPR$3])
 +- Exchange(distribution=[single])
-   +- Calc(select=[a, b, c], where=[(a = 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilter[aggStrategy=TWO_PHASE]">
+  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
+   +- LogicalFilter(condition=[=($0, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
+SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
 +- Exchange(distribution=[single])
-   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
-      +- Calc(select=[a, b, c], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
+      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=AUTO]">
+  <TestCase name="testAggregateWithFilter[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
-   +- LogicalFilter(condition=[=($0, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
+SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
 +- Exchange(distribution=[single])
-   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
-      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
+   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
+      +- Calc(select=[a, b, c], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=ONE_PHASE]">
+  <TestCase name="testAggregateWithFilter[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
-   +- LogicalFilter(condition=[=($0, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2, SUM($f3) AS EXPR$3])
+SortAggregate(isMerge=[false], select=[AVG(a) AS EXPR$0, SUM(b) AS EXPR$1, COUNT(c) AS EXPR$2])
 +- Exchange(distribution=[single])
-   +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
+   +- Calc(select=[a, b, c], where=[(a = 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggregateWithFilterOnNestedFields[aggStrategy=TWO_PHASE]">
+  <TestCase name="testAggregateWithFilter[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c), SUM(c._1) FROM MyTable2 WHERE a = 1]]>
+      <![CDATA[SELECT AVG(a), SUM(b), COUNT(c) FROM MyTable1 WHERE a = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$2._1])
-   +- LogicalFilter(condition=[=($0, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2, Final_SUM(sum$4) AS EXPR$3])
+SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final_SUM(sum$2) AS EXPR$1, Final_COUNT(count$3) AS EXPR$2])
 +- Exchange(distribution=[single])
-   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3, Partial_SUM($f3) AS sum$4])
-      +- Calc(select=[CAST(1 AS INTEGER) AS a, b, c, c._1 AS $f3], where=[(a = 1)])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
+   +- LocalSortAggregate(select=[Partial_AVG(a) AS (sum$0, count$1), Partial_SUM(b) AS sum$2, Partial_COUNT(c) AS count$3])
+      +- Calc(select=[a, b, c], where=[(a = 1)])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -341,17 +341,17 @@ SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final
     <Resource name="sql">
       <![CDATA[
 SELECT 
- APPROX_COUNT_DISTINCT(`byte`), 
- APPROX_COUNT_DISTINCT(`short`), 
- APPROX_COUNT_DISTINCT(`int`), 
- APPROX_COUNT_DISTINCT(`long`), 
- APPROX_COUNT_DISTINCT(`float`), 
- APPROX_COUNT_DISTINCT(`double`), 
- APPROX_COUNT_DISTINCT(`string`), 
- APPROX_COUNT_DISTINCT(`date`), 
- APPROX_COUNT_DISTINCT(`time`), 
- APPROX_COUNT_DISTINCT(`timestamp`), 
- APPROX_COUNT_DISTINCT(`decimal3020`), 
+ APPROX_COUNT_DISTINCT(`byte`),
+ APPROX_COUNT_DISTINCT(`short`),
+ APPROX_COUNT_DISTINCT(`int`),
+ APPROX_COUNT_DISTINCT(`long`),
+ APPROX_COUNT_DISTINCT(`float`),
+ APPROX_COUNT_DISTINCT(`double`),
+ APPROX_COUNT_DISTINCT(`string`),
+ APPROX_COUNT_DISTINCT(`date`),
+ APPROX_COUNT_DISTINCT(`time`),
+ APPROX_COUNT_DISTINCT(`timestamp`),
+ APPROX_COUNT_DISTINCT(`decimal3020`),
  APPROX_COUNT_DISTINCT(`decimal105`)
  FROM MyTable
       ]]>
@@ -377,17 +377,17 @@ SortAggregate(isMerge=[true], select=[Final_COUNT(APPROXIMATE DISTINCT EXPR$0) A
     <Resource name="sql">
       <![CDATA[
 SELECT 
- APPROX_COUNT_DISTINCT(`byte`), 
- APPROX_COUNT_DISTINCT(`short`), 
- APPROX_COUNT_DISTINCT(`int`), 
- APPROX_COUNT_DISTINCT(`long`), 
- APPROX_COUNT_DISTINCT(`float`), 
- APPROX_COUNT_DISTINCT(`double`), 
- APPROX_COUNT_DISTINCT(`string`), 
- APPROX_COUNT_DISTINCT(`date`), 
- APPROX_COUNT_DISTINCT(`time`), 
- APPROX_COUNT_DISTINCT(`timestamp`), 
- APPROX_COUNT_DISTINCT(`decimal3020`), 
+ APPROX_COUNT_DISTINCT(`byte`),
+ APPROX_COUNT_DISTINCT(`short`),
+ APPROX_COUNT_DISTINCT(`int`),
+ APPROX_COUNT_DISTINCT(`long`),
+ APPROX_COUNT_DISTINCT(`float`),
+ APPROX_COUNT_DISTINCT(`double`),
+ APPROX_COUNT_DISTINCT(`string`),
+ APPROX_COUNT_DISTINCT(`date`),
+ APPROX_COUNT_DISTINCT(`time`),
+ APPROX_COUNT_DISTINCT(`timestamp`),
+ APPROX_COUNT_DISTINCT(`decimal3020`),
  APPROX_COUNT_DISTINCT(`decimal105`)
  FROM MyTable
       ]]>
@@ -412,17 +412,17 @@ SortAggregate(isMerge=[false], select=[COUNT(APPROXIMATE DISTINCT byte) AS EXPR$
     <Resource name="sql">
       <![CDATA[
 SELECT 
- APPROX_COUNT_DISTINCT(`byte`), 
- APPROX_COUNT_DISTINCT(`short`), 
- APPROX_COUNT_DISTINCT(`int`), 
- APPROX_COUNT_DISTINCT(`long`), 
- APPROX_COUNT_DISTINCT(`float`), 
- APPROX_COUNT_DISTINCT(`double`), 
- APPROX_COUNT_DISTINCT(`string`), 
- APPROX_COUNT_DISTINCT(`date`), 
- APPROX_COUNT_DISTINCT(`time`), 
- APPROX_COUNT_DISTINCT(`timestamp`), 
- APPROX_COUNT_DISTINCT(`decimal3020`), 
+ APPROX_COUNT_DISTINCT(`byte`),
+ APPROX_COUNT_DISTINCT(`short`),
+ APPROX_COUNT_DISTINCT(`int`),
+ APPROX_COUNT_DISTINCT(`long`),
+ APPROX_COUNT_DISTINCT(`float`),
+ APPROX_COUNT_DISTINCT(`double`),
+ APPROX_COUNT_DISTINCT(`string`),
+ APPROX_COUNT_DISTINCT(`date`),
+ APPROX_COUNT_DISTINCT(`time`),
+ APPROX_COUNT_DISTINCT(`timestamp`),
+ APPROX_COUNT_DISTINCT(`decimal3020`),
  APPROX_COUNT_DISTINCT(`decimal105`)
  FROM MyTable
       ]]>
@@ -536,107 +536,57 @@ SortAggregate(isMerge=[true], select=[Final_AVG(sum$0, count$1) AS EXPR$0, Final
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCount[aggStrategy=AUTO]">
+  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(`byte`),
-       COUNT(`short`),
-       COUNT(`int`),
-       COUNT(`long`),
-       COUNT(`float`),
-       COUNT(`double`),
-       COUNT(`decimal3020`),
-       COUNT(`decimal105`),
-       COUNT(`boolean`),
-       COUNT(`date`),
-       COUNT(`time`),
-       COUNT(`timestamp`),
-       COUNT(`string`)
-FROM MyTable
-      ]]>
+      <![CDATA[SELECT COUNT(*) FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
++- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-   +- LocalSortAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+SortAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
+   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCount[aggStrategy=ONE_PHASE]">
+  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(`byte`),
-       COUNT(`short`),
-       COUNT(`int`),
-       COUNT(`long`),
-       COUNT(`float`),
-       COUNT(`double`),
-       COUNT(`decimal3020`),
-       COUNT(`decimal105`),
-       COUNT(`boolean`),
-       COUNT(`date`),
-       COUNT(`time`),
-       COUNT(`timestamp`),
-       COUNT(`string`)
-FROM MyTable
-      ]]>
+      <![CDATA[SELECT COUNT(*) FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
++- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[false], select=[COUNT(byte) AS EXPR$0, COUNT(short) AS EXPR$1, COUNT(int) AS EXPR$2, COUNT(long) AS EXPR$3, COUNT(float) AS EXPR$4, COUNT(double) AS EXPR$5, COUNT(decimal3020) AS EXPR$6, COUNT(decimal105) AS EXPR$7, COUNT(boolean) AS EXPR$8, COUNT(date) AS EXPR$9, COUNT(time) AS EXPR$10, COUNT(timestamp) AS EXPR$11, COUNT(string) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+SortAggregate(isMerge=[false], select=[COUNT(*) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
++- Exchange(distribution=[single]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[id, cnt]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCount[aggStrategy=TWO_PHASE]">
+  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(`byte`),
-       COUNT(`short`),
-       COUNT(`int`),
-       COUNT(`long`),
-       COUNT(`float`),
-       COUNT(`double`),
-       COUNT(`decimal3020`),
-       COUNT(`decimal105`),
-       COUNT(`boolean`),
-       COUNT(`date`),
-       COUNT(`time`),
-       COUNT(`timestamp`),
-       COUNT(`string`)
-FROM MyTable
-      ]]>
+      <![CDATA[SELECT COUNT(*) FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
++- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-   +- LocalSortAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+SortAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
+   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
 ]]>
     </Resource>
   </TestCase>
@@ -696,68 +646,119 @@ SortAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=AUTO]">
+  <TestCase name="testCount[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*) FROM src]]>
+      <![CDATA[
+SELECT COUNT(`byte`),
+       COUNT(`short`),
+       COUNT(`int`),
+       COUNT(`long`),
+       COUNT(`float`),
+       COUNT(`double`),
+       COUNT(`decimal3020`),
+       COUNT(`decimal105`),
+       COUNT(`boolean`),
+       COUNT(`date`),
+       COUNT(`time`),
+       COUNT(`timestamp`),
+       COUNT(`string`)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
-+- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
-   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
+SortAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+   +- LocalSortAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=ONE_PHASE]">
+  <TestCase name="testCount[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*) FROM src]]>
+      <![CDATA[
+SELECT COUNT(`byte`),
+       COUNT(`short`),
+       COUNT(`int`),
+       COUNT(`long`),
+       COUNT(`float`),
+       COUNT(`double`),
+       COUNT(`decimal3020`),
+       COUNT(`decimal105`),
+       COUNT(`boolean`),
+       COUNT(`date`),
+       COUNT(`time`),
+       COUNT(`timestamp`),
+       COUNT(`string`)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
-+- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[false], select=[COUNT(*) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
-+- Exchange(distribution=[single]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
-   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[id, cnt]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+SortAggregate(isMerge=[false], select=[COUNT(byte) AS EXPR$0, COUNT(short) AS EXPR$1, COUNT(int) AS EXPR$2, COUNT(long) AS EXPR$3, COUNT(float) AS EXPR$4, COUNT(double) AS EXPR$5, COUNT(decimal3020) AS EXPR$6, COUNT(decimal105) AS EXPR$7, COUNT(boolean) AS EXPR$8, COUNT(date) AS EXPR$9, COUNT(time) AS EXPR$10, COUNT(timestamp) AS EXPR$11, COUNT(string) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCountStartWithProjectPushDown[aggStrategy=TWO_PHASE]">
+  <TestCase name="testCount[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*) FROM src]]>
+      <![CDATA[
+SELECT COUNT(`byte`),
+       COUNT(`short`),
+       COUNT(`int`),
+       COUNT(`long`),
+       COUNT(`float`),
+       COUNT(`double`),
+       COUNT(`decimal3020`),
+       COUNT(`decimal105`),
+       COUNT(`boolean`),
+       COUNT(`date`),
+       COUNT(`time`),
+       COUNT(`timestamp`),
+       COUNT(`string`)
+FROM MyTable
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()]), rowType=[RecordType(BIGINT EXPR$0)]
-+- LogicalTableScan(table=[[default_catalog, default_database, src]]), rowType=[RecordType(VARCHAR(2147483647) id, BIGINT cnt)]
+LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[COUNT($1)], EXPR$2=[COUNT($2)], EXPR$3=[COUNT($3)], EXPR$4=[COUNT($4)], EXPR$5=[COUNT($5)], EXPR$6=[COUNT($6)], EXPR$7=[COUNT($7)], EXPR$8=[COUNT($8)], EXPR$9=[COUNT($9)], EXPR$10=[COUNT($10)], EXPR$11=[COUNT($11)], EXPR$12=[COUNT($12)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12], boolean=[$6], date=[$8], time=[$9], timestamp=[$10], string=[$7]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105, BOOLEAN boolean, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, VARCHAR(2147483647) string)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0]), rowType=[RecordType(BIGINT EXPR$0)]
-+- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count1$0)]
-   +- TableSourceScan(table=[[default_catalog, default_database, src, aggregates=[grouping=[], aggFunctions=[Count1AggFunction()]]]], fields=[count1$0]), rowType=[RecordType(BIGINT count1$0)]
+SortAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS EXPR$0, Final_COUNT(count$1) AS EXPR$1, Final_COUNT(count$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3, Final_COUNT(count$4) AS EXPR$4, Final_COUNT(count$5) AS EXPR$5, Final_COUNT(count$6) AS EXPR$6, Final_COUNT(count$7) AS EXPR$7, Final_COUNT(count$8) AS EXPR$8, Final_COUNT(count$9) AS EXPR$9, Final_COUNT(count$10) AS EXPR$10, Final_COUNT(count$11) AS EXPR$11, Final_COUNT(count$12) AS EXPR$12]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1, BIGINT EXPR$2, BIGINT EXPR$3, BIGINT EXPR$4, BIGINT EXPR$5, BIGINT EXPR$6, BIGINT EXPR$7, BIGINT EXPR$8, BIGINT EXPR$9, BIGINT EXPR$10, BIGINT EXPR$11, BIGINT EXPR$12)]
++- Exchange(distribution=[single]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+   +- LocalSortAggregate(select=[Partial_COUNT(byte) AS count$0, Partial_COUNT(short) AS count$1, Partial_COUNT(int) AS count$2, Partial_COUNT(long) AS count$3, Partial_COUNT(float) AS count$4, Partial_COUNT(double) AS count$5, Partial_COUNT(decimal3020) AS count$6, Partial_COUNT(decimal105) AS count$7, Partial_COUNT(boolean) AS count$8, Partial_COUNT(date) AS count$9, Partial_COUNT(time) AS count$10, Partial_COUNT(timestamp) AS count$11, Partial_COUNT(string) AS count$12]), rowType=[RecordType(BIGINT count$0, BIGINT count$1, BIGINT count$2, BIGINT count$3, BIGINT count$4, BIGINT count$5, BIGINT count$6, BIGINT count$7, BIGINT count$8, BIGINT count$9, BIGINT count$10, BIGINT count$11, BIGINT count$12)]
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregate[aggStrategy=AUTO]">
+  <TestCase name="testGroupAggregateWithFilter[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -769,18 +770,20 @@ SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1
          +- LocalSortAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
             +- Exchange(distribution=[forward])
                +- Sort(orderBy=[a ASC])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+                  +- Calc(select=[a, b, c], where=[(a = 1)])
+                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregate[aggStrategy=ONE_PHASE]">
+  <TestCase name="testGroupAggregateWithFilter[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -789,18 +792,20 @@ SortAggregate(isMerge=[false], groupBy=[a], select=[a, SUM(b) AS EXPR$1, COUNT(c
 +- Exchange(distribution=[forward])
    +- Sort(orderBy=[a ASC])
       +- Exchange(distribution=[hash[a]])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+         +- Calc(select=[a, b, c], where=[(a = 1)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregate[aggStrategy=TWO_PHASE]">
+  <TestCase name="testGroupAggregateWithFilter[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalFilter(condition=[=($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -812,19 +817,19 @@ SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1
          +- LocalSortAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
             +- Exchange(distribution=[forward])
                +- Sort(orderBy=[a ASC])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+                  +- Calc(select=[a, b, c], where=[(a = 1)])
+                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter[aggStrategy=AUTO]">
+  <TestCase name="testGroupAggregate[aggStrategy=AUTO]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -836,20 +841,18 @@ SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1
          +- LocalSortAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
             +- Exchange(distribution=[forward])
                +- Sort(orderBy=[a ASC])
-                  +- Calc(select=[a, b, c], where=[(a = 1)])
-                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter[aggStrategy=ONE_PHASE]">
+  <TestCase name="testGroupAggregate[aggStrategy=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -858,20 +861,18 @@ SortAggregate(isMerge=[false], groupBy=[a], select=[a, SUM(b) AS EXPR$1, COUNT(c
 +- Exchange(distribution=[forward])
    +- Sort(orderBy=[a ASC])
       +- Exchange(distribution=[hash[a]])
-         +- Calc(select=[a, b, c], where=[(a = 1)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter[aggStrategy=TWO_PHASE]">
+  <TestCase name="testGroupAggregate[aggStrategy=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, SUM(b), count(c) FROM MyTable1 WHERE a = 1 GROUP BY a]]>
+      <![CDATA[SELECT a, SUM(b), COUNT(c) FROM MyTable1 GROUP BY a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT($2)])
-+- LogicalFilter(condition=[=($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -883,8 +884,7 @@ SortAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1
          +- LocalSortAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0, Partial_COUNT(c) AS count$1])
             +- Exchange(distribution=[forward])
                +- Sort(orderBy=[a ASC])
-                  +- Calc(select=[a, b, c], where=[(a = 1)])
-                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashJoinTest.xml
index 153b792d51b..897e52cf7f7 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashJoinTest.xml
@@ -37,27 +37,6 @@ Calc(select=[c, g])
    +- Exchange(distribution=[broadcast])
       +- Calc(select=[a, c], where=[(a < 2)])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftOuterJoinWithEquiAndNonEquiPred">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[((a = d) AND (d < 2) AND (b < h))], select=[d, e, f, g, h, a, b, c], isBroadcast=[true], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -195,6 +174,46 @@ Calc(select=[c, g])
    +- Exchange(distribution=[broadcast])
       +- Calc(select=[d, e, g])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithJoinConditionPushDown">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM
+   (select a, count(b) as b from MyTable1 group by a)
+   join
+   (select d, count(e) as e from MyTable2 group by d)
+   on a = d and b = e and d = 2 and b = 1
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], d=[$2], e=[$3])
++- LogicalJoin(condition=[AND(=($0, $2), =($1, $3), =($2, 2), =($1, 1))], joinType=[inner])
+   :- LogicalAggregate(group=[{0}], b=[COUNT($1)])
+   :  +- LogicalProject(a=[$0], b=[$1])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalAggregate(group=[{0}], e=[COUNT($1)])
+      +- LogicalProject(d=[$0], e=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, 1 AS b, CAST(2 AS INTEGER) AS d, 1 AS e])
++- MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, d], isBroadcast=[true], build=[right])\n:- Calc(select=[a], where=[(b = 1)])\n:  +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count$0) AS b])\n:     +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[broadcast])\n])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[d], where=[(e = 1)])
+   :     +- HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS e])
+   :        +- Exchange(distribution=[hash[d]])
+   :           +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
+   :              +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
+   :                 +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
+         +- Calc(select=[CAST(2 AS INTEGER) AS a, b], where=[(a = 2)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -343,6 +362,25 @@ MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[LeftOuterJoin], whe
    +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
       +- Calc(select=[a, b])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinOnFalse">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN MyTable1 ON false]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[false], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[d, e, f, g, h, null:INTEGER AS a, null:BIGINT AS b, null:VARCHAR(2147483647) AS c])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -370,67 +408,48 @@ Calc(select=[c, g])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiPred">
+  <TestCase name="testLeftOuterJoinWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
+      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, g])
-+- HashJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g], isBroadcast=[true], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[b, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Calc(select=[e, g])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+HashJoin(joinType=[LeftOuterJoin], where=[((a = d) AND (d < 2) AND (b < h))], select=[d, e, f, g, h, a, b, c], isBroadcast=[true], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerJoinWithJoinConditionPushDown">
+  <TestCase name="testLeftOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[
-SELECT * FROM
-   (select a, count(b) as b from MyTable1 group by a)
-   join
-   (select d, count(e) as e from MyTable2 group by d)
-   on a = d and b = e and d = 2 and b = 1
-]]>
+      <![CDATA[SELECT c, g FROM MyTable1 LEFT OUTER JOIN MyTable2 ON b = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], d=[$2], e=[$3])
-+- LogicalJoin(condition=[AND(=($0, $2), =($1, $3), =($2, 2), =($1, 1))], joinType=[inner])
-   :- LogicalAggregate(group=[{0}], b=[COUNT($1)])
-   :  +- LogicalProject(a=[$0], b=[$1])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalAggregate(group=[{0}], e=[COUNT($1)])
-      +- LogicalProject(d=[$0], e=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, 1 AS b, CAST(2 AS INTEGER) AS d, 1 AS e])
-+- MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, d], isBroadcast=[true], build=[right])\n:- Calc(select=[a], where=[(b = 1)])\n:  +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count$0) AS b])\n:     +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[broadcast])\n])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[d], where=[(e = 1)])
-   :     +- HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS e])
-   :        +- Exchange(distribution=[hash[d]])
-   :           +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
-   :              +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
-   :                 +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-   +- Exchange(distribution=[hash[a]])
-      +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
-         +- Calc(select=[CAST(2 AS INTEGER) AS a, b], where=[(a = 2)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+Calc(select=[c, g])
++- HashJoin(joinType=[LeftOuterJoin], where=[(b = e)], select=[b, c, e, g], isBroadcast=[true], build=[right])
+   :- Calc(select=[b, c])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[broadcast])
+      +- Calc(select=[e, g])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -582,27 +601,46 @@ MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[RightOuterJoin], wh
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftOuterJoinWithEquiPred">
+  <TestCase name="testRightOuterJoinOnFalse">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 LEFT OUTER JOIN MyTable2 ON b = e]]>
+      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON false]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[false], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[null:INTEGER AS d, null:BIGINT AS e, null:INTEGER AS f, null:VARCHAR(2147483647) AS g, null:BIGINT AS h, a, b, c])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightOuterJoinWithEquiAndLocalPred">
+    <Resource name="sql">
+      <![CDATA[SELECT c, g FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$7], g=[$3])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2))], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[c, g])
-+- HashJoin(joinType=[LeftOuterJoin], where=[(b = e)], select=[b, c, e, g], isBroadcast=[true], build=[right])
-   :- Calc(select=[b, c])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[broadcast])
-      +- Calc(select=[e, g])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
++- HashJoin(joinType=[RightOuterJoin], where=[(a = d)], select=[d, g, a, c], isBroadcast=[true], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[d, g], where=[(d < 2)])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+   +- Calc(select=[a, c])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -628,27 +666,27 @@ HashJoin(joinType=[RightOuterJoin], where=[((a = d) AND (b < h))], select=[d, e,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiAndLocalPred">
+  <TestCase name="testRightOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2]]>
+      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$7], g=[$3])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2))], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[c, g])
-+- HashJoin(joinType=[RightOuterJoin], where=[(a = d)], select=[d, g, a, c], isBroadcast=[true], build=[left])
++- HashJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g], isBroadcast=[true], build=[left])
    :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[d, g], where=[(d < 2)])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-   +- Calc(select=[a, c])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   :  +- Calc(select=[b, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Calc(select=[e, g])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -680,42 +718,4 @@ Calc(select=[CAST(0 AS BIGINT) AS k, v, null:BIGINT AS k0, null:VARCHAR(21474836
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinOnFalse">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON false]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[false], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[null:INTEGER AS d, null:BIGINT AS e, null:INTEGER AS f, null:VARCHAR(2147483647) AS g, null:BIGINT AS h, a, b, c])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testLeftOuterJoinOnFalse">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN MyTable1 ON false]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[false], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[d, e, f, g, h, null:INTEGER AS a, null:BIGINT AS b, null:VARCHAR(2147483647) AS c])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-]]>
-		</Resource>
-	</TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashSemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashSemiAntiJoinTest.xml
index f613399ae95..3f41c012c24 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashSemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/BroadcastHashSemiAntiJoinTest.xml
@@ -1367,41 +1367,6 @@ MultipleInput(readOrder=[0,0,0,1], members=[\nNestedLoopJoin(joinType=[LeftSemiJ
 :  +- Calc(select=[a, b, c], where=[(b >= 1)])
 :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
 +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultiNotExistsWithCorrelate">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM l, r WHERE l.a = r.d AND NOT EXISTS (SELECT * FROM t t1 WHERE l.b = t1.j AND t1.k > 50) AND c >= 1 AND NOT EXISTS (SELECT * FROM t t2 WHERE l.a = t2.i AND t2.j < 100)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalFilter(condition=[AND(=($0, $3), NOT(EXISTS({
-LogicalFilter(condition=[AND(=($cor0.b, $1), >(CAST($2):BIGINT, 50))])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})), >=(CAST($2):BIGINT, 1), NOT(EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), <($1, 100))])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})))], variablesSet=[[$cor0]])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, l]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, r]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(readOrder=[0,0,0,1], members=[\nHashJoin(joinType=[LeftAntiJoin], where=[(a = i)], select=[a, b, c, d, e, f], isBroadcast=[true], build=[right])\n:- HashJoin(joinType=[LeftAntiJoin], where=[(b = j)], select=[a, b, c, d, e, f], isBroadcast=[true], build=[right])\n:  :- HashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], isBroadcast=[true], build=[left])\n:  :  :- [#3] Exchange(distribution=[broadcast])\n:  :  +- [#4] TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])\n:  +- [#2] Exchange(distribution=[broadcast])\n+- [#1] Exchange(distribution=[broadcast])\n])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[i], where=[(j < 100)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])(reuse_id=[1])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[j], where=[(CAST(k AS BIGINT) > 50)])
-:     +- Reused(reference_id=[1])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[a, b, c], where=[(CAST(c AS BIGINT) >= 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
-+- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
@@ -1561,6 +1526,41 @@ HashJoin(joinType=[LeftSemiJoin], where=[(a = d)], select=[a, b, c], isBroadcast
          +- Exchange(distribution=[broadcast])
             +- Calc(select=[j])
                +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultiNotExistsWithCorrelate">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM l, r WHERE l.a = r.d AND NOT EXISTS (SELECT * FROM t t1 WHERE l.b = t1.j AND t1.k > 50) AND c >= 1 AND NOT EXISTS (SELECT * FROM t t2 WHERE l.a = t2.i AND t2.j < 100)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalFilter(condition=[AND(=($0, $3), NOT(EXISTS({
+LogicalFilter(condition=[AND(=($cor0.b, $1), >(CAST($2):BIGINT, 50))])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})), >=(CAST($2):BIGINT, 1), NOT(EXISTS({
+LogicalFilter(condition=[AND(=($cor0.a, $0), <($1, 100))])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})))], variablesSet=[[$cor0]])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, l]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, r]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,0,0,1], members=[\nHashJoin(joinType=[LeftAntiJoin], where=[(a = i)], select=[a, b, c, d, e, f], isBroadcast=[true], build=[right])\n:- HashJoin(joinType=[LeftAntiJoin], where=[(b = j)], select=[a, b, c, d, e, f], isBroadcast=[true], build=[right])\n:  :- HashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], isBroadcast=[true], build=[left])\n:  :  :- [#3] Exchange(distribution=[broadcast])\n:  :  +- [#4] TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])\n:  +- [#2] Exchange(distribution=[broadcast])\n+- [#1] Exchange(distribution=[broadcast])\n])
+:- Exchange(distribution=[broadcast])
+:  +- Calc(select=[i], where=[(j < 100)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])(reuse_id=[1])
+:- Exchange(distribution=[broadcast])
+:  +- Calc(select=[j], where=[(CAST(k AS BIGINT) > 50)])
+:     +- Reused(reference_id=[1])
+:- Exchange(distribution=[broadcast])
+:  +- Calc(select=[a, b, c], where=[(CAST(c AS BIGINT) >= 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
++- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/JoinReorderTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/JoinReorderTest.xml
index 3b6f3dd94f7..240c39c077f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/JoinReorderTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/JoinReorderTest.xml
@@ -383,6 +383,47 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
                            :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
                            +- Exchange(distribution=[hash[a1]])
                               +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testBushyJoinCondition1[isBushyJoinReorder=false]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM T1, T2, T3, T4, T5
+WHERE a1 = a2 AND a2 = a3 AND a1 = a4 AND a3 = a5
+         ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
++- LogicalFilter(condition=[AND(=($0, $3), =($3, $6), =($0, $9), =($6, $12))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :  :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :  :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]])
+      :  :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+      :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
++- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+   :  +- Exchange(distribution=[broadcast])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a4)], select=[a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :              :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :              +- Exchange(distribution=[broadcast])
+   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   +- Exchange(distribution=[broadcast])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
@@ -427,17 +468,17 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testBushyJoinCondition1[isBushyJoinReorder=false]">
+  <TestCase name="testBushyJoinCondition2[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1, T2, T3, T4, T5
-WHERE a1 = a2 AND a2 = a3 AND a1 = a4 AND a3 = a5
+WHERE b1 = b2 AND b2 = b3 AND b1 = b4 AND b3 = b5
          ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
-+- LogicalFilter(condition=[AND(=($0, $3), =($3, $6), =($0, $9), =($6, $12))])
++- LogicalFilter(condition=[AND(=($1, $4), =($4, $7), =($1, $10), =($7, $13))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalJoin(condition=[true], joinType=[inner])
       :  :- LogicalJoin(condition=[true], joinType=[inner])
@@ -452,17 +493,18 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-   :  +- Exchange(distribution=[broadcast])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a4)], select=[a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
++- HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[=(b1, b4)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4], build=[left])
+   :  :- Exchange(distribution=[hash[b1]])
+   :  :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :  +- Exchange(distribution=[hash[b4]])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(b5, b4)], select=[a5, b5, c5, a2, b2, c2, a4, b4, c4], isBroadcast=[true], build=[right])
+   :        :- HashJoin(joinType=[InnerJoin], where=[=(b5, b2)], select=[a5, b5, c5, a2, b2, c2], isBroadcast=[true], build=[right])
+   :        :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :        :  +- Exchange(distribution=[broadcast])
+   :        :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
    :        +- Exchange(distribution=[broadcast])
-   :           +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :              :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :              +- Exchange(distribution=[broadcast])
-   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
    +- Exchange(distribution=[broadcast])
       +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
@@ -507,48 +549,6 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
       :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
       +- Exchange(distribution=[hash[b5]])
          +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testBushyJoinCondition2[isBushyJoinReorder=false]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM T1, T2, T3, T4, T5
-WHERE b1 = b2 AND b2 = b3 AND b1 = b4 AND b3 = b5
-         ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
-+- LogicalFilter(condition=[AND(=($1, $4), =($4, $7), =($1, $10), =($7, $13))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :  :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :  :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]])
-      :  :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-      :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[=(b1, b4)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4], build=[left])
-   :  :- Exchange(distribution=[hash[b1]])
-   :  :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-   :  +- Exchange(distribution=[hash[b4]])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(b5, b4)], select=[a5, b5, c5, a2, b2, c2, a4, b4, c4], isBroadcast=[true], build=[right])
-   :        :- HashJoin(joinType=[InnerJoin], where=[=(b5, b2)], select=[a5, b5, c5, a2, b2, c2], isBroadcast=[true], build=[right])
-   :        :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :        :  +- Exchange(distribution=[broadcast])
-   :        :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-   +- Exchange(distribution=[broadcast])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
@@ -873,7 +873,7 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerAndRightOuterJoin[isBushyJoinReorder=true]">
+  <TestCase name="testInnerAndRightOuterJoin[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1
@@ -900,24 +900,24 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a4, b4, c4, a5, b5, c5, a2, b2, c2, a3, b3, c3, a1, b1, c1], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a4, b4, c4, a5, b5, c5, a2, b2, c2, a3, b3, c3], isBroadcast=[true], build=[right])
-   :  :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a4, b4, c4, a5, b5, c5, a2, b2, c2], isBroadcast=[true], build=[left])
-   :  :  :- Exchange(distribution=[broadcast])
-   :  :  :  +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a4, b4, c4, a5, b5, c5], isBroadcast=[true], build=[left])
-   :  :  :     :- Exchange(distribution=[broadcast])
-   :  :  :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-   :  :  :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
++- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :  :- HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, c1, a2, b2, c2], build=[right])
+   :  :  :- Exchange(distribution=[hash[a1]])
+   :  :  :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
    :  :  +- Exchange(distribution=[hash[a2]])
    :  :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
    :  +- Exchange(distribution=[broadcast])
-   :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
-   +- Exchange(distribution=[hash[a1]])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   +- Exchange(distribution=[broadcast])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerAndRightOuterJoin[isBushyJoinReorder=false]">
+  <TestCase name="testInnerAndRightOuterJoin[isBushyJoinReorder=true]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1
@@ -944,20 +944,20 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :  :- HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, c1, a2, b2, c2], build=[right])
-   :  :  :- Exchange(distribution=[hash[a1]])
-   :  :  :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
++- HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a4, b4, c4, a5, b5, c5, a2, b2, c2, a3, b3, c3, a1, b1, c1], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a4, b4, c4, a5, b5, c5, a2, b2, c2, a3, b3, c3], isBroadcast=[true], build=[right])
+   :  :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a4, b4, c4, a5, b5, c5, a2, b2, c2], isBroadcast=[true], build=[left])
+   :  :  :- Exchange(distribution=[broadcast])
+   :  :  :  +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a4, b4, c4, a5, b5, c5], isBroadcast=[true], build=[left])
+   :  :  :     :- Exchange(distribution=[broadcast])
+   :  :  :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   :  :  :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
    :  :  +- Exchange(distribution=[hash[a2]])
    :  :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
    :  +- Exchange(distribution=[broadcast])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-   +- Exchange(distribution=[broadcast])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
+   :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
+   +- Exchange(distribution=[hash[a1]])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
 ]]>
     </Resource>
   </TestCase>
@@ -1559,7 +1559,7 @@ HashJoin(joinType=[InnerJoin], where=[=(b2, b4)], select=[a1, b1, c1, a2, b2, c2
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithFilter[isBushyJoinReorder=true]">
+  <TestCase name="testJoinWithFilter[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 WITH V1 AS (SELECT * FROM T1 JOIN T2 ON a1 = a2 WHERE b1 * b2 > 10),
@@ -1593,24 +1593,24 @@ LogicalProject(a4=[$0], b4=[$1], c4=[$2], a1=[$3], b1=[$4], c1=[$5], a2=[$6], b2
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a4, b4, c4, a1, b1, c1, a2, b2, c2, a3, b3, c3, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[AND(>(+(b2, b4), 100), =(a2, a3), <(*(b1, b3), 2000))], select=[a4, b4, c4, a5, b5, c5, a3, b3, c3, a1, b1, c1, a2, b2, c2], isBroadcast=[true], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- HashJoin(joinType=[InnerJoin], where=[=(a3, a4)], select=[a4, b4, c4, a5, b5, c5, a3, b3, c3], isBroadcast=[true], build=[left])
-   :     :- Exchange(distribution=[broadcast])
-   :     :  +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a4, b4, c4, a5, b5, c5], isBroadcast=[true], build=[left])
-   :     :     :- Exchange(distribution=[broadcast])
-   :     :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-   :     :     +- Calc(select=[a5, b5, c5], where=[<(b5, 15)])
-   :     :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
-   +- HashJoin(joinType=[InnerJoin], where=[AND(=(a1, a2), >(*(b1, b2), 10))], select=[a1, b1, c1, a2, b2, c2], isBroadcast=[true], build=[right])
-      :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-      +- Exchange(distribution=[broadcast])
-         +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
++- HashJoin(joinType=[InnerJoin], where=[AND(<(*(b1, b3), 2000), =(a2, a3))], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[AND(>(+(b2, b4), 100), >(*(b1, b2), 10), =(a2, a4))], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+   :  +- Exchange(distribution=[broadcast])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a4)], select=[a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :              :- Calc(select=[a5, b5, c5], where=[<(b5, 15)])
+   :              :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :              +- Exchange(distribution=[broadcast])
+   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   +- Exchange(distribution=[broadcast])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithFilter[isBushyJoinReorder=false]">
+  <TestCase name="testJoinWithFilter[isBushyJoinReorder=true]">
     <Resource name="sql">
       <![CDATA[
 WITH V1 AS (SELECT * FROM T1 JOIN T2 ON a1 = a2 WHERE b1 * b2 > 10),
@@ -1644,24 +1644,24 @@ LogicalProject(a4=[$0], b4=[$1], c4=[$2], a1=[$3], b1=[$4], c1=[$5], a2=[$6], b2
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a4, b4, c4, a1, b1, c1, a2, b2, c2, a3, b3, c3, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[AND(<(*(b1, b3), 2000), =(a2, a3))], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[AND(>(+(b2, b4), 100), >(*(b1, b2), 10), =(a2, a4))], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-   :  +- Exchange(distribution=[broadcast])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a4)], select=[a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :              :- Calc(select=[a5, b5, c5], where=[<(b5, 15)])
-   :              :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :              +- Exchange(distribution=[broadcast])
-   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-   +- Exchange(distribution=[broadcast])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
++- HashJoin(joinType=[InnerJoin], where=[AND(>(+(b2, b4), 100), =(a2, a3), <(*(b1, b3), 2000))], select=[a4, b4, c4, a5, b5, c5, a3, b3, c3, a1, b1, c1, a2, b2, c2], isBroadcast=[true], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- HashJoin(joinType=[InnerJoin], where=[=(a3, a4)], select=[a4, b4, c4, a5, b5, c5, a3, b3, c3], isBroadcast=[true], build=[left])
+   :     :- Exchange(distribution=[broadcast])
+   :     :  +- HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a4, b4, c4, a5, b5, c5], isBroadcast=[true], build=[left])
+   :     :     :- Exchange(distribution=[broadcast])
+   :     :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   :     :     +- Calc(select=[a5, b5, c5], where=[<(b5, 15)])
+   :     :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
+   +- HashJoin(joinType=[InnerJoin], where=[AND(=(a1, a2), >(*(b1, b2), 10))], select=[a1, b1, c1, a2, b2, c2], isBroadcast=[true], build=[right])
+      :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+      +- Exchange(distribution=[broadcast])
+         +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithProject[isBushyJoinReorder=true]">
+  <TestCase name="testJoinWithProject[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 WITH V1 AS (SELECT b1, a1, a2, c2 FROM T1 JOIN T2 ON a1 = a2),
@@ -1714,7 +1714,7 @@ HashJoin(joinType=[InnerJoin], where=[=(a4, a5)], select=[a3, b1, a1, c2, c3, a4
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithProject[isBushyJoinReorder=false]">
+  <TestCase name="testJoinWithProject[isBushyJoinReorder=true]">
     <Resource name="sql">
       <![CDATA[
 WITH V1 AS (SELECT b1, a1, a2, c2 FROM T1 JOIN T2 ON a1 = a2),
@@ -1941,6 +1941,47 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
          :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
          +- Exchange(distribution=[broadcast])
             +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testStarJoinCondition1[isBushyJoinReorder=false]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM T1, T2, T3, T4, T5
+WHERE a1 = a2 AND a1 = a3 AND a1 = a4 AND a1 = a5
+         ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
++- LogicalFilter(condition=[AND(=($0, $3), =($0, $6), =($0, $9), =($0, $12))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :  :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :  :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]])
+      :  :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+      :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
++- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+   :  +- Exchange(distribution=[broadcast])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a4)], select=[a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- HashJoin(joinType=[InnerJoin], where=[=(a5, a4)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+   :              :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :              +- Exchange(distribution=[broadcast])
+   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   +- Exchange(distribution=[broadcast])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
@@ -1985,17 +2026,17 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testStarJoinCondition1[isBushyJoinReorder=false]">
+  <TestCase name="testStarJoinCondition2[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1, T2, T3, T4, T5
-WHERE a1 = a2 AND a1 = a3 AND a1 = a4 AND a1 = a5
+WHERE b1 = b2 AND b1 = b3 AND b1 = b4 AND b1 = b5
          ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
-+- LogicalFilter(condition=[AND(=($0, $3), =($0, $6), =($0, $9), =($0, $12))])
++- LogicalFilter(condition=[AND(=($1, $4), =($1, $7), =($1, $10), =($1, $13))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalJoin(condition=[true], joinType=[inner])
       :  :- LogicalJoin(condition=[true], joinType=[inner])
@@ -2010,17 +2051,18 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[=(a2, a4)], select=[a2, b2, c2, a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-   :  +- Exchange(distribution=[broadcast])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a4)], select=[a1, b1, c1, a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :        :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
++- HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- HashJoin(joinType=[InnerJoin], where=[=(b1, b4)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4], build=[left])
+   :  :- Exchange(distribution=[hash[b1]])
+   :  :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :  +- Exchange(distribution=[hash[b4]])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(b5, b4)], select=[a5, b5, c5, a2, b2, c2, a4, b4, c4], isBroadcast=[true], build=[right])
+   :        :- HashJoin(joinType=[InnerJoin], where=[=(b5, b2)], select=[a5, b5, c5, a2, b2, c2], isBroadcast=[true], build=[right])
+   :        :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+   :        :  +- Exchange(distribution=[broadcast])
+   :        :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
    :        +- Exchange(distribution=[broadcast])
-   :           +- HashJoin(joinType=[InnerJoin], where=[=(a5, a4)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-   :              :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :              +- Exchange(distribution=[broadcast])
-   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
    +- Exchange(distribution=[broadcast])
       +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
@@ -2068,17 +2110,17 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testStarJoinCondition2[isBushyJoinReorder=false]">
+  <TestCase name="testWithoutColumnStats[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1, T2, T3, T4, T5
-WHERE b1 = b2 AND b1 = b3 AND b1 = b4 AND b1 = b5
+WHERE c1 = c2 AND c1 = c3 AND c2 = c4 AND c1 = c5
          ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
-+- LogicalFilter(condition=[AND(=($1, $4), =($1, $7), =($1, $10), =($1, $13))])
++- LogicalFilter(condition=[AND(=($2, $5), =($2, $8), =($5, $11), =($2, $14))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalJoin(condition=[true], joinType=[inner])
       :  :- LogicalJoin(condition=[true], joinType=[inner])
@@ -2093,20 +2135,19 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- HashJoin(joinType=[InnerJoin], where=[=(b1, b4)], select=[a1, b1, c1, a5, b5, c5, a2, b2, c2, a4, b4, c4], build=[left])
-   :  :- Exchange(distribution=[hash[b1]])
-   :  :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-   :  +- Exchange(distribution=[hash[b4]])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(b5, b4)], select=[a5, b5, c5, a2, b2, c2, a4, b4, c4], isBroadcast=[true], build=[right])
-   :        :- HashJoin(joinType=[InnerJoin], where=[=(b5, b2)], select=[a5, b5, c5, a2, b2, c2], isBroadcast=[true], build=[right])
-   :        :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-   :        :  +- Exchange(distribution=[broadcast])
-   :        :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
++- HashJoin(joinType=[InnerJoin], where=[=(c1, c2)], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+   :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
    +- Exchange(distribution=[broadcast])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
+      +- HashJoin(joinType=[InnerJoin], where=[=(c2, c5)], select=[a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[left])
+         :- Exchange(distribution=[broadcast])
+         :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+         +- HashJoin(joinType=[InnerJoin], where=[=(c4, c3)], select=[a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
+            :- HashJoin(joinType=[InnerJoin], where=[=(c5, c4)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
+            :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+            :  +- Exchange(distribution=[broadcast])
+            :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+            +- Exchange(distribution=[broadcast])
+               +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
@@ -2148,47 +2189,6 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
    :           +- Exchange(distribution=[broadcast])
    :              +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
    +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithoutColumnStats[isBushyJoinReorder=false]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM T1, T2, T3, T4, T5
-WHERE c1 = c2 AND c1 = c3 AND c2 = c4 AND c1 = c5
-         ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3=[$7], c3=[$8], a4=[$9], b4=[$10], c4=[$11], a5=[$12], b5=[$13], c5=[$14])
-+- LogicalFilter(condition=[AND(=($2, $5), =($2, $8), =($5, $11), =($2, $14))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :  :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :  :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]])
-      :  :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-      :  :  +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- HashJoin(joinType=[InnerJoin], where=[=(c1, c2)], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-   :- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-   +- Exchange(distribution=[broadcast])
-      +- HashJoin(joinType=[InnerJoin], where=[=(c2, c5)], select=[a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[left])
-         :- Exchange(distribution=[broadcast])
-         :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-         +- HashJoin(joinType=[InnerJoin], where=[=(c4, c3)], select=[a5, b5, c5, a4, b4, c4, a3, b3, c3], isBroadcast=[true], build=[right])
-            :- HashJoin(joinType=[InnerJoin], where=[=(c5, c4)], select=[a5, b5, c5, a4, b4, c4], isBroadcast=[true], build=[right])
-            :  :- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-            :  +- Exchange(distribution=[broadcast])
-            :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-            +- Exchange(distribution=[broadcast])
-               +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml
index c6e078c060b..9195b47ebee 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml
@@ -16,85 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testJoinTemporalTableWithNotShuffleLookupHint">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{shuffle=false, table=D}]]])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
-   +- LogicalFilter(condition=[=($cor0.a, $0)])
-      +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle1]])
-
-== Optimized Physical Plan ==
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])
-   +- Calc(select=[a, b, c, PROCTIME() AS proctime])
-      +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
-
-== Optimized Execution Plan ==
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])
-   +- Calc(select=[a, b, c, PROCTIME() AS proctime])
-      +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
-
-== Physical Execution Plan ==
-{
-  "nodes" : [ {
-    "id" : ,
-    "type" : "Source: Collection Source",
-    "pact" : "Data Source",
-    "contents" : "Source: Collection Source",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "SourceConversion[]",
-    "pact" : "Operator",
-    "contents" : "[]:SourceConversion(table=[default_catalog.default_database.T0], fields=[a, b, c])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b, c, PROCTIME() AS proctime])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "LookupJoin[]",
-    "pact" : "Operator",
-    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  } ]
-}]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testAvoidAggregatePushDown">
     <Resource name="sql">
       <![CDATA[
@@ -139,6 +60,31 @@ HashAggregate(isMerge=[true], groupBy=[b], select=[b, Final_COUNT(count$0) AS EX
                   +- Exchange(distribution=[hash[a, b]])
                      +- LocalHashAggregate(groupBy=[a, b], select=[a, b, Partial_SUM(c) AS sum$0, Partial_SUM(d) AS sum$1])
                         +- BoundedStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinAsyncTableWithKeyOrderedDisabled">
+    <Resource name="sql">
+      <![CDATA[SELECT /*+ LOOKUP('table'='D', 'async'='true', 'output-mode'='allow_unordered') */ * FROM (SELECT * FROM MyTable) AS T JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.a = D.id]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=D}]]])
+   :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3])
+   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
+   +- LogicalFilter(condition=[=($cor0.a, $0)])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
++- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
+   +- Calc(select=[a, b, c, PROCTIME() AS proctime])
+      +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -226,19 +172,6 @@ Calc(select=[a, b, c, name, age, nominal_age])
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testJoinAsyncTableWithKeyOrderedDisabled">
-		<Resource name="sql">
-			<![CDATA[SELECT /*+ LOOKUP('table'='D', 'async'='true', 'output-mode'='allow_unordered') */ * FROM (SELECT * FROM MyTable) AS T JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.a = D.id]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
-   +- Calc(select=[a, b, c, PROCTIME() AS proctime])
-      +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
-]]>
-		</Resource>
-	</TestCase>
   <TestCase name="testJoinTemporalTableWithFilterPushDown">
     <Resource name="sql">
       <![CDATA[
@@ -295,50 +228,105 @@ Calc(select=[a, b, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftJoinTemporalTable">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable AS T LEFT JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.a = D.id]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
+  <TestCase name="testJoinTemporalTableWithNonDeterministicCustomShuffle">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 3}])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{shuffle=true, table=D}]]])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
    +- LogicalFilter(condition=[=($cor0.a, $0)])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle2]])
+
+== Optimized Physical Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[LeftOuterJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle2], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
-]]>
+
+== Optimized Execution Plan ==
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle2], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
+   +- Calc(select=[a, b, c, PROCTIME() AS proctime])
+      +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
+
+== Physical Execution Plan ==
+{
+  "nodes" : [ {
+    "id" : ,
+    "type" : "Source: Collection Source",
+    "pact" : "Data Source",
+    "contents" : "Source: Collection Source",
+    "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "SourceConversion[]",
+    "pact" : "Operator",
+    "contents" : "[]:SourceConversion(table=[default_catalog.default_database.T0], fields=[a, b, c])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[a, b, c, PROCTIME() AS proctime])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "LookupJoin[]",
+    "pact" : "Operator",
+    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle2], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "CUSTOM",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  } ]
+}]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinTemporalTableWithNonDeterministicCustomShuffle">
+  <TestCase name="testJoinTemporalTableWithNotShuffleLookupHint">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{shuffle=true, table=D}]]])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{shuffle=false, table=D}]]])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
    +- LogicalFilter(condition=[=($cor0.a, $0)])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle2]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle1]])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle2], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle2], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 
@@ -376,11 +364,11 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age]
     "id" : ,
     "type" : "LookupJoin[]",
     "pact" : "Operator",
-    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle2], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])",
+    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "CUSTOM",
+      "ship_strategy" : "FORWARD",
       "side" : "second"
     } ]
   }, {
@@ -427,7 +415,7 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinTemporalTableWithShuffleLookupHintEmptyPartitioner">
+  <TestCase name="testJoinTemporalTableWithShuffleLookupHint">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
@@ -436,17 +424,17 @@ LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
    +- LogicalFilter(condition=[=($cor0.a, $0)])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle3]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle1]])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle3], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle3], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 
@@ -484,11 +472,11 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age]
     "id" : ,
     "type" : "LookupJoin[]",
     "pact" : "Operator",
-    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle3], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])",
+    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "FORWARD",
+      "ship_strategy" : "CUSTOM",
       "side" : "second"
     } ]
   }, {
@@ -506,53 +494,7 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLogicalPlan">
-    <Resource name="sql">
-      <![CDATA[
-SELECT b, count(a), sum(c), sum(d)
-FROM (
-SELECT T.* FROM (
-SELECT b, a, sum(c) c, sum(d) d, PROCTIME() as proctime
-FROM T1
-GROUP BY a, b
-      ) AS T
-JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D
-ON T.a = D.id
-WHERE D.age > 10
-      ) AS T
-GROUP BY b
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
-+- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4])
-      +- LogicalFilter(condition=[>($7, 10)])
-         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-            +- LogicalFilter(condition=[=($cor0.a, $0)])
-               +- LogicalSnapshot(period=[$cor0.proctime])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
-+- FlinkLogicalCalc(select=[b, a, c, d])
-   +- FlinkLogicalJoin(condition=[=($1, $4)], joinType=[inner])
-      :- FlinkLogicalCalc(select=[b, a, c, d])
-      :  +- FlinkLogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-      :     +- FlinkLogicalDataStreamTableScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, d])
-      +- FlinkLogicalSnapshot(period=[$cor0.proctime])
-         +- FlinkLogicalCalc(select=[id], where=[>(age, 10)])
-            +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LookupTable, project=[id, age], metadata=[]]], fields=[id, age])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinTemporalTableWithShuffleLookupHint">
+  <TestCase name="testJoinTemporalTableWithShuffleLookupHintEmptyPartitioner">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
@@ -561,17 +503,17 @@ LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
    +- LogicalFilter(condition=[=($cor0.a, $0)])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTableWithCustomShuffle3]])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle3], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
++- LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle3], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])
    +- Calc(select=[a, b, c, PROCTIME() AS proctime])
       +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
 
@@ -609,11 +551,11 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age]
     "id" : ,
     "type" : "LookupJoin[]",
     "pact" : "Operator",
-    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle1], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])",
+    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.LookupTableWithCustomShuffle3], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age], shuffle=[true])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "CUSTOM",
+      "ship_strategy" : "FORWARD",
       "side" : "second"
     } ]
   }, {
@@ -631,6 +573,76 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age]
 }]]>
     </Resource>
   </TestCase>
+  <TestCase name="testLeftJoinTemporalTable">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable AS T LEFT JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.a = D.id]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], id=[$4], name=[$5], age=[$6])
++- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 3}])
+   :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, T0]])
+   +- LogicalFilter(condition=[=($cor0.a, $0)])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, id, name, age])
++- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[LeftOuterJoin], lookup=[id=a], select=[a, b, c, proctime, id, name, age])
+   +- Calc(select=[a, b, c, PROCTIME() AS proctime])
+      +- BoundedStreamScan(table=[[default_catalog, default_database, T0]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLogicalPlan">
+    <Resource name="sql">
+      <![CDATA[
+SELECT b, count(a), sum(c), sum(d)
+FROM (
+SELECT T.* FROM (
+SELECT b, a, sum(c) c, sum(d) d, PROCTIME() as proctime
+FROM T1
+GROUP BY a, b
+      ) AS T
+JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D
+ON T.a = D.id
+WHERE D.age > 10
+      ) AS T
+GROUP BY b
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
++- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proctime])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
++- FlinkLogicalCalc(select=[b, a, c, d])
+   +- FlinkLogicalJoin(condition=[=($1, $4)], joinType=[inner])
+      :- FlinkLogicalCalc(select=[b, a, c, d])
+      :  +- FlinkLogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+      :     +- FlinkLogicalDataStreamTableScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, d])
+      +- FlinkLogicalSnapshot(period=[$cor0.proctime])
+         +- FlinkLogicalCalc(select=[id], where=[>(age, 10)])
+            +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LookupTable, project=[id, age], metadata=[]]], fields=[id, age])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testReusing">
     <Resource name="sql">
       <![CDATA[
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopJoinTest.xml
index c796e2645af..c37f2d9eb04 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopJoinTest.xml
@@ -656,31 +656,6 @@ Calc(select=[c, g])
    +- Exchange(distribution=[broadcast])
       +- Calc(select=[a, c])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftOuterJoinWithFilter1">
-    <Resource name="sql">
-      <![CDATA[SELECT d, e, f FROM MyTable1 LEFT JOIN MyTable2 ON a = d where d = 10 AND a < 12]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(d=[$3], e=[$4], f=[$5])
-+- LogicalFilter(condition=[AND(=($3, 10), <($0, 12))])
-   +- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[CAST(10 AS INTEGER) AS d, e, f])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a, e, f], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[a], where=[(a = 10)])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Calc(select=[e, f], where=[(d = 10)])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -726,6 +701,31 @@ Calc(select=[c, g])
    +- Exchange(distribution=[broadcast])
       +- Calc(select=[e, g])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinWithFilter1">
+    <Resource name="sql">
+      <![CDATA[SELECT d, e, f FROM MyTable1 LEFT JOIN MyTable2 ON a = d where d = 10 AND a < 12]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(d=[$3], e=[$4], f=[$5])
++- LogicalFilter(condition=[AND(=($3, 10), <($0, 12))])
+   +- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[CAST(10 AS INTEGER) AS d, e, f])
++- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a, e, f], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[a], where=[(a = 10)])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Calc(select=[e, f], where=[(d = 10)])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -835,30 +835,6 @@ Calc(select=[a, CAST(b AS BIGINT) AS b, CAST(2 AS INTEGER) AS d, e])
       +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
          +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiPred">
-    <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[c, g])
-+- NestedLoopJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[b, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Calc(select=[e, g])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -965,45 +941,69 @@ Calc(select=[c, g])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithNonEquiPred">
+  <TestCase name="testRightOuterJoinWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON a <> d]]>
+      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[<>($5, $0)], joinType=[right])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[right])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-NestedLoopJoin(joinType=[RightOuterJoin], where=[(a <> d)], select=[d, e, f, g, h, a, b, c], build=[left])
+NestedLoopJoin(joinType=[RightOuterJoin], where=[((a = d) AND (b < h))], select=[d, e, f, g, h, a, b, c], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+:  +- Calc(select=[d, e, f, g, h], where=[(d < 2)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiAndNonEquiPred">
+  <TestCase name="testRightOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
+      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[c, g])
++- NestedLoopJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[b, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Calc(select=[e, g])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightOuterJoinWithNonEquiPred">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON a <> d]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[right])
++- LogicalJoin(condition=[<>($5, $0)], joinType=[right])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-NestedLoopJoin(joinType=[RightOuterJoin], where=[((a = d) AND (b < h))], select=[d, e, f, g, h, a, b, c], build=[left])
+NestedLoopJoin(joinType=[RightOuterJoin], where=[(a <> d)], select=[d, e, f, g, h, a, b, c], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- Calc(select=[d, e, f, g, h], where=[(d < 2)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+:  +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashJoinTest.xml
index 220f151f7e1..e3d85fe3193 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashJoinTest.xml
@@ -137,28 +137,6 @@ Calc(select=[c, g])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, c], where=[(a < 2)])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftOuterJoinWithEquiAndNonEquiPred">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[((a = d) AND (d < 2) AND (b < h))], select=[d, e, f, g, h, a, b, c], build=[right])
-:- Exchange(distribution=[hash[d]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-+- Exchange(distribution=[hash[a]])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -302,6 +280,43 @@ Calc(select=[c, g])
    +- Exchange(distribution=[hash[e, d]])
       +- Calc(select=[d, e, g])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithJoinConditionPushDown">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM
+   (select a, count(b) as b from MyTable1 group by a)
+   join
+   (select d, count(e) as e from MyTable2 group by d)
+   on a = d and b = e and d = 2 and b = 1
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], d=[$2], e=[$3])
++- LogicalJoin(condition=[AND(=($0, $2), =($1, $3), =($2, 2), =($1, 1))], joinType=[inner])
+   :- LogicalAggregate(group=[{0}], b=[COUNT($1)])
+   :  +- LogicalProject(a=[$0], b=[$1])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalAggregate(group=[{0}], e=[COUNT($1)])
+      +- LogicalProject(d=[$0], e=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, 1 AS b, CAST(2 AS INTEGER) AS d, 1 AS e])
++- MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, d], build=[left])\n:- Calc(select=[a], where=[(b = 1)])\n:  +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count$0) AS b])\n:     +- [#1] Exchange(distribution=[hash[a]])\n+- Calc(select=[d], where=[(e = 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS e])\n      +- [#2] Exchange(distribution=[hash[d]])\n])
+   :- Exchange(distribution=[hash[a]])
+   :  +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
+   :     +- Calc(select=[CAST(2 AS INTEGER) AS a, b], where=[(a = 2)])
+   :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[d]])
+      +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
+         +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -451,6 +466,25 @@ MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[LeftOuterJoin], whe
    +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
       +- Calc(select=[d, e])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinOnFalse">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN MyTable1 ON false]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[false], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[d, e, f, g, h, null:INTEGER AS a, null:BIGINT AS b, null:VARCHAR(2147483647) AS c])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -479,65 +513,50 @@ Calc(select=[c, g])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiPred">
+  <TestCase name="testLeftOuterJoinWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
+      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, g])
-+- HashJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g], build=[left])
-   :- Exchange(distribution=[hash[b]])
-   :  +- Calc(select=[b, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[e]])
-      +- Calc(select=[e, g])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+HashJoin(joinType=[LeftOuterJoin], where=[((a = d) AND (d < 2) AND (b < h))], select=[d, e, f, g, h, a, b, c], build=[right])
+:- Exchange(distribution=[hash[d]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
++- Exchange(distribution=[hash[a]])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerJoinWithJoinConditionPushDown">
+  <TestCase name="testLeftOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[
-SELECT * FROM
-   (select a, count(b) as b from MyTable1 group by a)
-   join
-   (select d, count(e) as e from MyTable2 group by d)
-   on a = d and b = e and d = 2 and b = 1
-]]>
+      <![CDATA[SELECT c, g FROM MyTable1 LEFT OUTER JOIN MyTable2 ON b = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], d=[$2], e=[$3])
-+- LogicalJoin(condition=[AND(=($0, $2), =($1, $3), =($2, 2), =($1, 1))], joinType=[inner])
-   :- LogicalAggregate(group=[{0}], b=[COUNT($1)])
-   :  +- LogicalProject(a=[$0], b=[$1])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalAggregate(group=[{0}], e=[COUNT($1)])
-      +- LogicalProject(d=[$0], e=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, 1 AS b, CAST(2 AS INTEGER) AS d, 1 AS e])
-+- MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, d], build=[left])\n:- Calc(select=[a], where=[(b = 1)])\n:  +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count$0) AS b])\n:     +- [#1] Exchange(distribution=[hash[a]])\n+- Calc(select=[d], where=[(e = 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS e])\n      +- [#2] Exchange(distribution=[hash[d]])\n])
-   :- Exchange(distribution=[hash[a]])
-   :  +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
-   :     +- Calc(select=[CAST(2 AS INTEGER) AS a, b], where=[(a = 2)])
-   :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[d]])
-      +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
-         +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+Calc(select=[c, g])
++- HashJoin(joinType=[LeftOuterJoin], where=[(b = e)], select=[b, c, e, g], build=[left])
+   :- Exchange(distribution=[hash[b]])
+   :  +- Calc(select=[b, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[e]])
+      +- Calc(select=[e, g])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -690,28 +709,47 @@ MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[RightOuterJoin], wh
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftOuterJoinWithEquiPred">
+  <TestCase name="testRightOuterJoinOnFalse">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 LEFT OUTER JOIN MyTable2 ON b = e]]>
+      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON false]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[false], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[null:INTEGER AS d, null:BIGINT AS e, null:INTEGER AS f, null:VARCHAR(2147483647) AS g, null:BIGINT AS h, a, b, c])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightOuterJoinWithEquiAndLocalPred">
+    <Resource name="sql">
+      <![CDATA[SELECT c, g FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$7], g=[$3])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2))], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[c, g])
-+- HashJoin(joinType=[LeftOuterJoin], where=[(b = e)], select=[b, c, e, g], build=[left])
-   :- Exchange(distribution=[hash[b]])
-   :  +- Calc(select=[b, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[e]])
-      +- Calc(select=[e, g])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
++- HashJoin(joinType=[RightOuterJoin], where=[(a = d)], select=[d, g, a, c], build=[left])
+   :- Exchange(distribution=[hash[d]])
+   :  +- Calc(select=[d, g], where=[(d < 2)])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, c])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -738,28 +776,28 @@ HashJoin(joinType=[RightOuterJoin], where=[((a = d) AND (b < h))], select=[d, e,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiAndLocalPred">
+  <TestCase name="testRightOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2]]>
+      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$7], g=[$3])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2))], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[c, g])
-+- HashJoin(joinType=[RightOuterJoin], where=[(a = d)], select=[d, g, a, c], build=[left])
-   :- Exchange(distribution=[hash[d]])
-   :  +- Calc(select=[d, g], where=[(d < 2)])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, c])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
++- HashJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g], build=[left])
+   :- Exchange(distribution=[hash[b]])
+   :  +- Calc(select=[b, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[e]])
+      +- Calc(select=[e, g])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -791,42 +829,4 @@ Calc(select=[CAST(0 AS BIGINT) AS k, v, null:BIGINT AS k0, null:VARCHAR(21474836
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testRightOuterJoinOnFalse">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON false]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[false], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[null:INTEGER AS d, null:BIGINT AS e, null:INTEGER AS f, null:VARCHAR(2147483647) AS g, null:BIGINT AS h, a, b, c])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testLeftOuterJoinOnFalse">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN MyTable1 ON false]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[false], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[d, e, f, g, h, null:INTEGER AS a, null:BIGINT AS b, null:VARCHAR(2147483647) AS c])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-]]>
-		</Resource>
-	</TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml
index 00927a6bb00..6d3352a493e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml
@@ -1495,46 +1495,6 @@ MultipleInput(readOrder=[0,0,0,1], members=[\nNestedLoopJoin(joinType=[LeftSemiJ
 :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
 +- Exchange(distribution=[hash[d]])
    +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultiNotExistsWithCorrelate">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM l, r WHERE l.a = r.d AND NOT EXISTS (SELECT * FROM t t1 WHERE l.b = t1.j AND t1.k > 50) AND c >= 1 AND NOT EXISTS (SELECT * FROM t t2 WHERE l.a = t2.i AND t2.j < 100)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalFilter(condition=[AND(=($0, $3), NOT(EXISTS({
-LogicalFilter(condition=[AND(=($cor0.b, $1), >(CAST($2):BIGINT, 50))])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})), >=(CAST($2):BIGINT, 1), NOT(EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), <($1, 100))])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})))], variablesSet=[[$cor0]])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, l]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, r]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashJoin(joinType=[LeftAntiJoin], where=[(a = i)], select=[a, b, c, d, e, f], build=[right])
-:- Exchange(distribution=[hash[a]])
-:  +- HashJoin(joinType=[LeftAntiJoin], where=[(b = j)], select=[a, b, c, d, e, f], build=[right])
-:     :- Exchange(distribution=[hash[b]])
-:     :  +- HashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[left])
-:     :     :- Exchange(distribution=[hash[a]])
-:     :     :  +- Calc(select=[a, b, c], where=[(CAST(c AS BIGINT) >= 1)])
-:     :     :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
-:     :     +- Exchange(distribution=[hash[d]])
-:     :        +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
-:     +- Exchange(distribution=[hash[j]])
-:        +- Calc(select=[j], where=[(CAST(k AS BIGINT) > 50)])
-:           +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])(reuse_id=[1])
-+- Exchange(distribution=[hash[i]])
-   +- Calc(select=[i], where=[(j < 100)])
-      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1707,6 +1667,46 @@ HashJoin(joinType=[LeftSemiJoin], where=[(a = d)], select=[a, b, c], build=[righ
          +- Exchange(distribution=[hash[j]])
             +- Calc(select=[j])
                +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultiNotExistsWithCorrelate">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM l, r WHERE l.a = r.d AND NOT EXISTS (SELECT * FROM t t1 WHERE l.b = t1.j AND t1.k > 50) AND c >= 1 AND NOT EXISTS (SELECT * FROM t t2 WHERE l.a = t2.i AND t2.j < 100)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalFilter(condition=[AND(=($0, $3), NOT(EXISTS({
+LogicalFilter(condition=[AND(=($cor0.b, $1), >(CAST($2):BIGINT, 50))])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})), >=(CAST($2):BIGINT, 1), NOT(EXISTS({
+LogicalFilter(condition=[AND(=($cor0.a, $0), <($1, 100))])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})))], variablesSet=[[$cor0]])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, l]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, r]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[LeftAntiJoin], where=[(a = i)], select=[a, b, c, d, e, f], build=[right])
+:- Exchange(distribution=[hash[a]])
+:  +- HashJoin(joinType=[LeftAntiJoin], where=[(b = j)], select=[a, b, c, d, e, f], build=[right])
+:     :- Exchange(distribution=[hash[b]])
+:     :  +- HashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[left])
+:     :     :- Exchange(distribution=[hash[a]])
+:     :     :  +- Calc(select=[a, b, c], where=[(CAST(c AS BIGINT) >= 1)])
+:     :     :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
+:     :     +- Exchange(distribution=[hash[d]])
+:     :        +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
+:     +- Exchange(distribution=[hash[j]])
+:        +- Calc(select=[j], where=[(CAST(k AS BIGINT) > 50)])
+:           +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])(reuse_id=[1])
++- Exchange(distribution=[hash[i]])
+   +- Calc(select=[i], where=[(j < 100)])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SingleRowJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SingleRowJoinTest.xml
index 44f0b08da4f..3328b7b3037 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SingleRowJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SingleRowJoinTest.xml
@@ -16,36 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testSingleRowNotEquiJoin">
-    <Resource name="sql">
-      <![CDATA[SELECT a1, a2 FROM A, (SELECT COUNT(a1) AS cnt FROM A) WHERE a1 < cnt]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], a2=[$1])
-+- LogicalFilter(condition=[<($0, $2)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, A]])
-      +- LogicalAggregate(group=[{}], cnt=[COUNT($0)])
-         +- LogicalProject(a1=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a1, a2])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[(a1 < cnt)], select=[a1, a2, cnt], build=[right], singleRowJoin=[true])
-   :- Exchange(distribution=[any], shuffle_mode=[BATCH])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])(reuse_id=[1])
-   +- Exchange(distribution=[broadcast])
-      +- HashAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS cnt])
-         +- Exchange(distribution=[single])
-            +- LocalHashAggregate(select=[Partial_COUNT(a1) AS count$0])
-               +- Calc(select=[a1])
-                  +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testLeftSingleRightJoinEqualPredicate">
     <Resource name="sql">
       <![CDATA[SELECT a1 FROM (SELECT COUNT(*) AS cnt FROM B) RIGHT JOIN A ON cnt = a2]]>
@@ -83,6 +53,26 @@ LogicalProject(a1=[$1])
       <![CDATA[
 Calc(select=[a1])
 +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightSingleLeftJoinEqualPredicate">
+    <Resource name="sql">
+      <![CDATA[SELECT a2 FROM A LEFT JOIN (SELECT COUNT(*) AS cnt FROM B) AS x  ON a1 = cnt]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a2=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, A]])
+   +- LogicalAggregate(group=[{}], cnt=[COUNT()])
+      +- LogicalTableScan(table=[[default_catalog, default_database, B]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a2])
++- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])
 ]]>
     </Resource>
   </TestCase>
@@ -135,23 +125,38 @@ NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, a_sum], build=[ri
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightSingleLeftJoinEqualPredicate">
+  <TestCase name="testSingleRowJoinInnerJoin">
     <Resource name="sql">
-      <![CDATA[SELECT a2 FROM A LEFT JOIN (SELECT COUNT(*) AS cnt FROM B) AS x  ON a1 = cnt]]>
+      <![CDATA[SELECT a2, SUM(a1) FROM A GROUP BY a2 HAVING SUM(a1) > (SELECT SUM(a1) * 0.1 FROM A)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a2=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, A]])
-   +- LogicalAggregate(group=[{}], cnt=[COUNT()])
-      +- LogicalTableScan(table=[[default_catalog, default_database, B]])
+LogicalFilter(condition=[>($1, $SCALAR_QUERY({
+LogicalProject(EXPR$0=[*($0, 0.1:DECIMAL(2, 1))])
+  LogicalAggregate(group=[{}], agg#0=[SUM($0)])
+    LogicalProject(a1=[$0])
+      LogicalTableScan(table=[[default_catalog, default_database, A]])
+}))])
++- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
+   +- LogicalProject(a2=[$1], a1=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a2])
-+- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])
+Calc(select=[a2, EXPR$1])
++- MultipleInput(readOrder=[0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[(EXPR$1 > $f0)], select=[a2, EXPR$1, $f0], build=[right], singleRowJoin=[true])\n:- HashAggregate(isMerge=[true], groupBy=[a2], select=[a2, Final_SUM(sum$0) AS EXPR$1])\n:  +- [#2] Exchange(distribution=[hash[a2]])\n+- [#1] Exchange(distribution=[broadcast])\n])
+   :- Exchange(distribution=[broadcast])
+   :  +- HashAggregate(isMerge=[false], select=[SINGLE_VALUE(EXPR$0) AS $f0])
+   :     +- Calc(select=[($f0 * 0.1) AS EXPR$0])
+   :        +- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS $f0])
+   :           +- Exchange(distribution=[single])
+   :              +- LocalHashAggregate(select=[Partial_SUM(a1) AS sum$0])
+   :                 +- Calc(select=[a1])
+   :                    +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])(reuse_id=[1])
+   +- Exchange(distribution=[hash[a2]])
+      +- LocalHashAggregate(groupBy=[a2], select=[a2, Partial_SUM(a1) AS sum$0])
+         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -185,38 +190,33 @@ NestedLoopJoin(joinType=[InnerJoin], where=[((a1 < b1) AND (a2 = b2))], select=[
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleRowJoinInnerJoin">
+  <TestCase name="testSingleRowNotEquiJoin">
     <Resource name="sql">
-      <![CDATA[SELECT a2, SUM(a1) FROM A GROUP BY a2 HAVING SUM(a1) > (SELECT SUM(a1) * 0.1 FROM A)]]>
+      <![CDATA[SELECT a1, a2 FROM A, (SELECT COUNT(a1) AS cnt FROM A) WHERE a1 < cnt]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalFilter(condition=[>($1, $SCALAR_QUERY({
-LogicalProject(EXPR$0=[*($0, 0.1:DECIMAL(2, 1))])
-  LogicalAggregate(group=[{}], agg#0=[SUM($0)])
-    LogicalProject(a1=[$0])
-      LogicalTableScan(table=[[default_catalog, default_database, A]])
-}))])
-+- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-   +- LogicalProject(a2=[$1], a1=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, A]])
+LogicalProject(a1=[$0], a2=[$1])
++- LogicalFilter(condition=[<($0, $2)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, A]])
+      +- LogicalAggregate(group=[{}], cnt=[COUNT($0)])
+         +- LogicalProject(a1=[$0])
+            +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a2, EXPR$1])
-+- MultipleInput(readOrder=[0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[(EXPR$1 > $f0)], select=[a2, EXPR$1, $f0], build=[right], singleRowJoin=[true])\n:- HashAggregate(isMerge=[true], groupBy=[a2], select=[a2, Final_SUM(sum$0) AS EXPR$1])\n:  +- [#2] Exchange(distribution=[hash[a2]])\n+- [#1] Exchange(distribution=[broadcast])\n])
-   :- Exchange(distribution=[broadcast])
-   :  +- HashAggregate(isMerge=[false], select=[SINGLE_VALUE(EXPR$0) AS $f0])
-   :     +- Calc(select=[($f0 * 0.1) AS EXPR$0])
-   :        +- HashAggregate(isMerge=[true], select=[Final_SUM(sum$0) AS $f0])
-   :           +- Exchange(distribution=[single])
-   :              +- LocalHashAggregate(select=[Partial_SUM(a1) AS sum$0])
-   :                 +- Calc(select=[a1])
-   :                    +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])(reuse_id=[1])
-   +- Exchange(distribution=[hash[a2]])
-      +- LocalHashAggregate(groupBy=[a2], select=[a2, Partial_SUM(a1) AS sum$0])
-         +- Reused(reference_id=[1])
+Calc(select=[a1, a2])
++- NestedLoopJoin(joinType=[InnerJoin], where=[(a1 < cnt)], select=[a1, a2, cnt], build=[right], singleRowJoin=[true])
+   :- Exchange(distribution=[any], shuffle_mode=[BATCH])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2])(reuse_id=[1])
+   +- Exchange(distribution=[broadcast])
+      +- HashAggregate(isMerge=[true], select=[Final_COUNT(count$0) AS cnt])
+         +- Exchange(distribution=[single])
+            +- LocalHashAggregate(select=[Partial_COUNT(a1) AS count$0])
+               +- Calc(select=[a1])
+                  +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeJoinTest.xml
index 5bc56c5b846..249f1777090 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeJoinTest.xml
@@ -137,28 +137,6 @@ Calc(select=[c, g])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, c], where=[(a < 2)])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftOuterJoinWithEquiAndNonEquiPred">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-SortMergeJoin(joinType=[LeftOuterJoin], where=[((a = d) AND (d < 2) AND (b < h))], select=[d, e, f, g, h, a, b, c])
-:- Exchange(distribution=[hash[d]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-+- Exchange(distribution=[hash[a]])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -302,6 +280,43 @@ Calc(select=[c, g])
    +- Exchange(distribution=[hash[e, d]])
       +- Calc(select=[d, e, g])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithJoinConditionPushDown">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM
+   (select a, count(b) as b from MyTable1 group by a)
+   join
+   (select d, count(e) as e from MyTable2 group by d)
+   on a = d and b = e and d = 2 and b = 1
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], d=[$2], e=[$3])
++- LogicalJoin(condition=[AND(=($0, $2), =($1, $3), =($2, 2), =($1, 1))], joinType=[inner])
+   :- LogicalAggregate(group=[{0}], b=[COUNT($1)])
+   :  +- LogicalProject(a=[$0], b=[$1])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalAggregate(group=[{0}], e=[COUNT($1)])
+      +- LogicalProject(d=[$0], e=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, 1 AS b, CAST(2 AS INTEGER) AS d, 1 AS e])
++- MultipleInput(members=[\nSortMergeJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, d])\n:- Calc(select=[a], where=[(b = 1)])\n:  +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count$0) AS b])\n:     +- [#1] Exchange(distribution=[hash[a]])\n+- Calc(select=[d], where=[(e = 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS e])\n      +- [#2] Exchange(distribution=[hash[d]])\n])
+   :- Exchange(distribution=[hash[a]])
+   :  +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
+   :     +- Calc(select=[CAST(2 AS INTEGER) AS a, b], where=[(a = 2)])
+   :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[d]])
+      +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
+         +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -451,6 +466,25 @@ MultipleInput(members=[\nSortMergeJoin(joinType=[LeftOuterJoin], where=[((a = d)
    +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
       +- Calc(select=[d, e])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinOnFalse">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN MyTable1 ON false]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[false], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[d, e, f, g, h, null:INTEGER AS a, null:BIGINT AS b, null:VARCHAR(2147483647) AS c])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -479,65 +513,50 @@ Calc(select=[c, g])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiPred">
+  <TestCase name="testLeftOuterJoinWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
+      <![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN  MyTable1 ON a = d AND d < 2 AND b < h]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2), <($6, $4))], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, g])
-+- SortMergeJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g])
-   :- Exchange(distribution=[hash[b]])
-   :  +- Calc(select=[b, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[e]])
-      +- Calc(select=[e, g])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+SortMergeJoin(joinType=[LeftOuterJoin], where=[((a = d) AND (d < 2) AND (b < h))], select=[d, e, f, g, h, a, b, c])
+:- Exchange(distribution=[hash[d]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
++- Exchange(distribution=[hash[a]])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerJoinWithJoinConditionPushDown">
+  <TestCase name="testLeftOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[
-SELECT * FROM
-   (select a, count(b) as b from MyTable1 group by a)
-   join
-   (select d, count(e) as e from MyTable2 group by d)
-   on a = d and b = e and d = 2 and b = 1
-]]>
+      <![CDATA[SELECT c, g FROM MyTable1 LEFT OUTER JOIN MyTable2 ON b = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], d=[$2], e=[$3])
-+- LogicalJoin(condition=[AND(=($0, $2), =($1, $3), =($2, 2), =($1, 1))], joinType=[inner])
-   :- LogicalAggregate(group=[{0}], b=[COUNT($1)])
-   :  +- LogicalProject(a=[$0], b=[$1])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalAggregate(group=[{0}], e=[COUNT($1)])
-      +- LogicalProject(d=[$0], e=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, 1 AS b, CAST(2 AS INTEGER) AS d, 1 AS e])
-+- MultipleInput(members=[\nSortMergeJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, d])\n:- Calc(select=[a], where=[(b = 1)])\n:  +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_COUNT(count$0) AS b])\n:     +- [#1] Exchange(distribution=[hash[a]])\n+- Calc(select=[d], where=[(e = 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_COUNT(count$0) AS e])\n      +- [#2] Exchange(distribution=[hash[d]])\n])
-   :- Exchange(distribution=[hash[a]])
-   :  +- LocalHashAggregate(groupBy=[a], select=[a, Partial_COUNT(b) AS count$0])
-   :     +- Calc(select=[CAST(2 AS INTEGER) AS a, b], where=[(a = 2)])
-   :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[d]])
-      +- LocalHashAggregate(groupBy=[d], select=[d, Partial_COUNT(e) AS count$0])
-         +- Calc(select=[CAST(2 AS INTEGER) AS d, e], where=[(d = 2)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+Calc(select=[c, g])
++- SortMergeJoin(joinType=[LeftOuterJoin], where=[(b = e)], select=[b, c, e, g])
+   :- Exchange(distribution=[hash[b]])
+   :  +- Calc(select=[b, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[e]])
+      +- Calc(select=[e, g])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -690,28 +709,47 @@ MultipleInput(members=[\nSortMergeJoin(joinType=[RightOuterJoin], where=[((a = d
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftOuterJoinWithEquiPred">
+  <TestCase name="testRightOuterJoinOnFalse">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable1 LEFT OUTER JOIN MyTable2 ON b = e]]>
+      <![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON false]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$6])
-+- LogicalJoin(condition=[=($1, $4)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
++- LogicalJoin(condition=[false], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[null:INTEGER AS d, null:BIGINT AS e, null:INTEGER AS f, null:VARCHAR(2147483647) AS g, null:BIGINT AS h, a, b, c])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightOuterJoinWithEquiAndLocalPred">
+    <Resource name="sql">
+      <![CDATA[SELECT c, g FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$7], g=[$3])
++- LogicalJoin(condition=[AND(=($5, $0), <($0, 2))], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[c, g])
-+- SortMergeJoin(joinType=[LeftOuterJoin], where=[(b = e)], select=[b, c, e, g])
-   :- Exchange(distribution=[hash[b]])
-   :  +- Calc(select=[b, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[e]])
-      +- Calc(select=[e, g])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
++- SortMergeJoin(joinType=[RightOuterJoin], where=[(a = d)], select=[d, g, a, c])
+   :- Exchange(distribution=[hash[d]])
+   :  +- Calc(select=[d, g], where=[(d < 2)])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, c])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -738,28 +776,28 @@ SortMergeJoin(joinType=[RightOuterJoin], where=[((a = d) AND (b < h))], select=[
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinWithEquiAndLocalPred">
+  <TestCase name="testRightOuterJoinWithEquiPred">
     <Resource name="sql">
-      <![CDATA[SELECT c, g FROM MyTable2 RIGHT OUTER JOIN  MyTable1 ON a = d AND d < 2]]>
+      <![CDATA[SELECT c, g FROM MyTable1 RIGHT OUTER JOIN MyTable2 ON b = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$7], g=[$3])
-+- LogicalJoin(condition=[AND(=($5, $0), <($0, 2))], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalProject(c=[$2], g=[$6])
++- LogicalJoin(condition=[=($1, $4)], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[c, g])
-+- SortMergeJoin(joinType=[RightOuterJoin], where=[(a = d)], select=[d, g, a, c])
-   :- Exchange(distribution=[hash[d]])
-   :  +- Calc(select=[d, g], where=[(d < 2)])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, c])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
++- SortMergeJoin(joinType=[RightOuterJoin], where=[(b = e)], select=[b, c, e, g])
+   :- Exchange(distribution=[hash[b]])
+   :  +- Calc(select=[b, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[e]])
+      +- Calc(select=[e, g])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
 ]]>
     </Resource>
   </TestCase>
@@ -791,42 +829,4 @@ Calc(select=[CAST(0 AS BIGINT) AS k, v, null:BIGINT AS k0, null:VARCHAR(21474836
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testRightOuterJoinOnFalse">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM MyTable2 RIGHT OUTER JOIN MyTable1 ON false]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[false], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[null:INTEGER AS d, null:BIGINT AS e, null:INTEGER AS f, null:VARCHAR(2147483647) AS g, null:BIGINT AS h, a, b, c])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testLeftOuterJoinOnFalse">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM MyTable2 LEFT OUTER JOIN MyTable1 ON false]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(d=[$0], e=[$1], f=[$2], g=[$3], h=[$4], a=[$5], b=[$6], c=[$7])
-+- LogicalJoin(condition=[false], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[d, e, f, g, h, null:INTEGER AS a, null:BIGINT AS b, null:VARCHAR(2147483647) AS c])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[d, e, f, g, h])
-]]>
-		</Resource>
-	</TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml
index 17b7e1066d9..044584de016 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml
@@ -1495,46 +1495,6 @@ MultipleInput(readOrder=[0,0,1,1], members=[\nNestedLoopJoin(joinType=[LeftSemiJ
 :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
 +- Exchange(distribution=[hash[d]])
    +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultiNotExistsWithCorrelate">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM l, r WHERE l.a = r.d AND NOT EXISTS (SELECT * FROM t t1 WHERE l.b = t1.j AND t1.k > 50) AND c >= 1 AND NOT EXISTS (SELECT * FROM t t2 WHERE l.a = t2.i AND t2.j < 100)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalFilter(condition=[AND(=($0, $3), NOT(EXISTS({
-LogicalFilter(condition=[AND(=($cor0.b, $1), >(CAST($2):BIGINT, 50))])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})), >=(CAST($2):BIGINT, 1), NOT(EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), <($1, 100))])
-  LogicalTableScan(table=[[default_catalog, default_database, t]])
-})))], variablesSet=[[$cor0]])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, l]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, r]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-SortMergeJoin(joinType=[LeftAntiJoin], where=[(a = i)], select=[a, b, c, d, e, f])
-:- Exchange(distribution=[hash[a]])
-:  +- SortMergeJoin(joinType=[LeftAntiJoin], where=[(b = j)], select=[a, b, c, d, e, f])
-:     :- Exchange(distribution=[hash[b]])
-:     :  +- SortMergeJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f])
-:     :     :- Exchange(distribution=[hash[a]])
-:     :     :  +- Calc(select=[a, b, c], where=[(CAST(c AS BIGINT) >= 1)])
-:     :     :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
-:     :     +- Exchange(distribution=[hash[d]])
-:     :        +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
-:     +- Exchange(distribution=[hash[j]])
-:        +- Calc(select=[j], where=[(CAST(k AS BIGINT) > 50)])
-:           +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])(reuse_id=[1])
-+- Exchange(distribution=[hash[i]])
-   +- Calc(select=[i], where=[(j < 100)])
-      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1707,6 +1667,46 @@ SortMergeJoin(joinType=[LeftSemiJoin], where=[(a = d)], select=[a, b, c])
          +- Exchange(distribution=[hash[j]])
             +- Calc(select=[j])
                +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultiNotExistsWithCorrelate">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM l, r WHERE l.a = r.d AND NOT EXISTS (SELECT * FROM t t1 WHERE l.b = t1.j AND t1.k > 50) AND c >= 1 AND NOT EXISTS (SELECT * FROM t t2 WHERE l.a = t2.i AND t2.j < 100)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalFilter(condition=[AND(=($0, $3), NOT(EXISTS({
+LogicalFilter(condition=[AND(=($cor0.b, $1), >(CAST($2):BIGINT, 50))])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})), >=(CAST($2):BIGINT, 1), NOT(EXISTS({
+LogicalFilter(condition=[AND(=($cor0.a, $0), <($1, 100))])
+  LogicalTableScan(table=[[default_catalog, default_database, t]])
+})))], variablesSet=[[$cor0]])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, l]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, r]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+SortMergeJoin(joinType=[LeftAntiJoin], where=[(a = i)], select=[a, b, c, d, e, f])
+:- Exchange(distribution=[hash[a]])
+:  +- SortMergeJoin(joinType=[LeftAntiJoin], where=[(b = j)], select=[a, b, c, d, e, f])
+:     :- Exchange(distribution=[hash[b]])
+:     :  +- SortMergeJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f])
+:     :     :- Exchange(distribution=[hash[a]])
+:     :     :  +- Calc(select=[a, b, c], where=[(CAST(c AS BIGINT) >= 1)])
+:     :     :     +- TableSourceScan(table=[[default_catalog, default_database, l]], fields=[a, b, c])
+:     :     +- Exchange(distribution=[hash[d]])
+:     :        +- TableSourceScan(table=[[default_catalog, default_database, r]], fields=[d, e, f])
+:     +- Exchange(distribution=[hash[j]])
+:        +- Calc(select=[j], where=[(CAST(k AS BIGINT) > 50)])
+:           +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[i, j, k])(reuse_id=[1])
++- Exchange(distribution=[hash[i]])
+   +- Calc(select=[i], where=[(j < 100)])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CalcTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CalcTest.xml
index 25e0154316c..c68409972ce 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CalcTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CalcTest.xml
@@ -16,20 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testScalarFunctionAccess">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(_c0=[*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my], _c1=[CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz):INTEGER], _c2=[*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my], _c3=[CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz):INTEGER])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my AS _c0, CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz AS INTEGER) AS _c1, *org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my AS _c2, CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz AS INTEGER) AS _c3])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testMultiFilter">
     <Resource name="ast">
       <![CDATA[
@@ -72,6 +58,20 @@ LogicalProject(a$_1=[$0._1], a$_2=[$0._2], b=[$1])
       <![CDATA[
 Calc(select=[a._1 AS a$_1, a._2 AS a$_2, b])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testScalarFunctionAccess">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(_c0=[*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my], _c1=[CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz):INTEGER], _c2=[*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my], _c3=[CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz):INTEGER])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my AS _c0, CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz AS INTEGER) AS _c1, *org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().my AS _c2, CAST(*org.apache.flink.table.planner.plan.batch.table.CalcTest$giveMeCaseClass$*().clazz AS INTEGER) AS _c3])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -204,30 +204,30 @@ Calc(select=[EXPR$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleSelect">
+  <TestCase name="testSelectFunction">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
+LogicalProject(_c0=[hashCode($2)], b=[$1])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b])
+Calc(select=[hashCode(c) AS _c0, b])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSelectFunction">
+  <TestCase name="testSimpleSelect">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(_c0=[hashCode($2)], b=[$1])
+LogicalProject(a=[$0], b=[$1])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[hashCode(c) AS _c0, b])
+Calc(select=[a, b])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CorrelateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CorrelateTest.xml
index 82f48b4ba88..162fb49fe12 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CorrelateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/CorrelateTest.xml
@@ -16,7 +16,22 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCorrelateWithMultiFilterAndWithoutCalcMergeRules">
+  <TestCase name="testCorrelatePythonTableFunction">
+    <Resource name="ast">
+      <![CDATA[
+LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}])
+:- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.MockPythonTableFunction*($0, $1)], rowType=[RecordType(INTEGER x, INTEGER y)])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+PythonCorrelate(invocation=[*org.apache.flink.table.planner.utils.MockPythonTableFunction*($0, $1)], correlate=[table(*org.apache.flink.table.planner.utils.MockPythonTableFunction*(a,b))], select=[a,b,c,x,y], rowType=[RecordType(INTEGER a, INTEGER b, VARCHAR(2147483647) c, INTEGER x, INTEGER y)], joinType=[INNER])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCorrelateWithMultiFilter">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(c=[$0], d=[$1])
@@ -37,22 +52,7 @@ Calc(select=[c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCorrelatePythonTableFunction">
-    <Resource name="ast">
-      <![CDATA[
-LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}])
-:- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-+- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.MockPythonTableFunction*($0, $1)], rowType=[RecordType(INTEGER x, INTEGER y)])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-PythonCorrelate(invocation=[*org.apache.flink.table.planner.utils.MockPythonTableFunction*($0, $1)], correlate=[table(*org.apache.flink.table.planner.utils.MockPythonTableFunction*(a,b))], select=[a,b,c,x,y], rowType=[RecordType(INTEGER a, INTEGER b, VARCHAR(2147483647) c, INTEGER x, INTEGER y)], joinType=[INNER])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCorrelateWithMultiFilter">
+  <TestCase name="testCorrelateWithMultiFilterAndWithoutCalcMergeRules">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(c=[$0], d=[$1])
@@ -107,36 +107,36 @@ Calc(select=[c, s])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftOuterJoinWithoutJoinPredicates">
+  <TestCase name="testLeftOuterJoinWithLiteralTrue">
     <Resource name="ast">
       <![CDATA[
-LogicalFilter(condition=[>($1, _UTF-16LE'')])
-+- LogicalProject(c=[$2], s=[$3])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{}])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*($2)], rowType=[RecordType(VARCHAR(2147483647) s)])
+LogicalProject(c=[$2], s=[$3])
++- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{}])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*($2)], rowType=[RecordType(VARCHAR(2147483647) s)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, s], where=[(s > '')])
+Calc(select=[c, s])
 +- Correlate(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*($2)], correlate=[table(*org.apache.flink.table.planner.utils.TableFunc1*(c))], select=[a,b,c,s], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) s)], joinType=[LEFT])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftOuterJoinWithLiteralTrue">
+  <TestCase name="testLeftOuterJoinWithoutJoinPredicates">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], s=[$3])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{}])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*($2)], rowType=[RecordType(VARCHAR(2147483647) s)])
+LogicalFilter(condition=[>($1, _UTF-16LE'')])
++- LogicalProject(c=[$2], s=[$3])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{}])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*($2)], rowType=[RecordType(VARCHAR(2147483647) s)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, s])
+Calc(select=[c, s], where=[(s > '')])
 +- Correlate(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*($2)], correlate=[table(*org.apache.flink.table.planner.utils.TableFunc1*(c))], select=[a,b,c,s], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) s)], joinType=[LEFT])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/GroupWindowTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/GroupWindowTest.xml
index f34a76741c4..f34b6fed559 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/GroupWindowTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/GroupWindowTest.xml
@@ -64,23 +64,6 @@ HashWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, long, 5)],
 +- Exchange(distribution=[hash[string]])
    +- LocalHashWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, long, 5)], select=[string, Partial_COUNT(int) AS count$0])
       +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[long, int, string])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLongEventTimeTumblingGroupWindowWithProperties">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(string=[$0], EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4])
-+- LogicalWindowAggregate(group=[{2}], EXPR$0=[COUNT($1)], window=[TumblingGroupWindow('w, ts, 7200000)], properties=[EXPR$1, EXPR$2, EXPR$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-HashWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, ts, 7200000)], properties=[EXPR$1, EXPR$2, EXPR$3], select=[string, Final_COUNT(count$0) AS EXPR$0])
-+- Exchange(distribution=[hash[string]])
-   +- LocalHashWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, ts, 7200000)], properties=[EXPR$1, EXPR$2, EXPR$3], select=[string, Partial_COUNT(int) AS count$0])
-      +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[ts, int, string])
 ]]>
     </Resource>
   </TestCase>
@@ -103,6 +86,23 @@ SortWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, long, 5)],
             +- Calc(select=[long, int, string, CAST(int AS BIGINT) AS int0])
                +- Sort(orderBy=[string ASC, long ASC])
                   +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[long, int, string])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLongEventTimeTumblingGroupWindowWithProperties">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(string=[$0], EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4])
++- LogicalWindowAggregate(group=[{2}], EXPR$0=[COUNT($1)], window=[TumblingGroupWindow('w, ts, 7200000)], properties=[EXPR$1, EXPR$2, EXPR$3])
+   +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, ts, 7200000)], properties=[EXPR$1, EXPR$2, EXPR$3], select=[string, Final_COUNT(count$0) AS EXPR$0])
++- Exchange(distribution=[hash[string]])
+   +- LocalHashWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, ts, 7200000)], properties=[EXPR$1, EXPR$2, EXPR$3], select=[string, Partial_COUNT(int) AS count$0])
+      +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[ts, int, string])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/PythonGroupWindowAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/PythonGroupWindowAggregateTest.xml
index e77431b099d..3a8caafb364 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/PythonGroupWindowAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/PythonGroupWindowAggregateTest.xml
@@ -16,18 +16,18 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testPandasEventTimeTumblingGroupWindowOverTime">
+  <TestCase name="testPandasEventTimeSlidingGroupWindowOverTime">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
-+- PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2])
++- PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2])
    +- Exchange(distribution=[keep_input_as_is[hash[b]]])
       +- Sort(orderBy=[b ASC, rowtime ASC])
          +- Exchange(distribution=[hash[b]])
@@ -35,18 +35,18 @@ Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPandasEventTimeSlidingGroupWindowOverTime">
+  <TestCase name="testPandasEventTimeTumblingGroupWindowOverTime">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
-+- PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2])
++- PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2])
    +- Exchange(distribution=[keep_input_as_is[hash[b]]])
       +- Sort(orderBy=[b ASC, rowtime ASC])
          +- Exchange(distribution=[hash[b]])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/SetOperatorsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/SetOperatorsTest.xml
index b58d6dc1606..4fb765038f1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/SetOperatorsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/table/SetOperatorsTest.xml
@@ -134,26 +134,6 @@ Calc(select=[b0 AS b, c0 AS c])
                   :  +- TableSourceScan(table=[[default_catalog, default_database, left]], fields=[a, b, c])
                   +- Calc(select=[b, c, -1 AS vcol_marker])
                      +- TableSourceScan(table=[[default_catalog, default_database, right]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUnionNullableTypes">
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[true])
-:- LogicalProject(a=[$0])
-:  +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-+- LogicalProject(_c0=[CASE(>($2, 0), $1, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" _2))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Union(all=[true], union=[a])
-:- Calc(select=[a])
-:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b, c])(reuse_id=[1])
-+- Calc(select=[CASE((c > 0), b, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)) AS _c0])
-   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -195,6 +175,26 @@ Union(all=[true], union=[a])
 :  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b])(reuse_id=[1])
 +- Calc(select=[b])
    +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnionNullableTypes">
+    <Resource name="ast">
+      <![CDATA[
+LogicalUnion(all=[true])
+:- LogicalProject(a=[$0])
+:  +- LogicalTableScan(table=[[default_catalog, default_database, A]])
++- LogicalProject(_c0=[CASE(>($2, 0), $1, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" _2))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, A]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Union(all=[true], union=[a])
+:- Calc(select=[a])
+:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b, c])(reuse_id=[1])
++- Calc(select=[CASE((c > 0), b, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)) AS _c0])
+   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/PartialInsertTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/PartialInsertTest.xml
index c622be1a629..9f23ebd1a81 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/PartialInsertTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/PartialInsertTest.xml
@@ -16,86 +16,45 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testPartialInsertWithGroupBy[isBatch: false]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
-+- LogicalProject(a=[$0], EXPR$1=[null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], d=[$3], e=[$4], EXPR$4=[null:BIGINT], EXPR$5=[null:INTEGER])
+  <TestCase name="testPartialInsertWithComplexReorderAndComputedColumn[isBatch: false]">
+    <Resource name="sql">
+      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
++- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], f=[CAST(123:BIGINT):BIGINT], g=[CAST(456):INTEGER])
    +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-
-== Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
-+- Calc(select=[a, null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE" AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
-   +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      +- Exchange(distribution=[hash[a, b, c, d, e]])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-
-== Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
-+- Calc(select=[a, null:VARCHAR(2147483647) AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
++- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
    +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
       +- Exchange(distribution=[hash[a, b, c, d, e]])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialInsertWithUnionAll[isBatch: true]">
+  <TestCase name="testPartialInsertWithComplexReorderAndComputedColumn[isBatch: true]">
     <Resource name="sql">
-      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
+      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- LogicalProject(a=[$0], c=[$1], d=[$2], e=[$3], f=[CAST($4):BIGINT], g=[CAST($5):INTEGER])
-   +- LogicalUnion(all=[true])
-      :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
-      :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
-         +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], f=[CAST(123:BIGINT):BIGINT], g=[CAST(456):INTEGER])
+   +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
 +- Sort(orderBy=[c ASC, d ASC])
-   +- Union(all=[true], union=[a, c, d, e, f, g])
-      :- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
-      :  +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      :     +- Exchange(distribution=[hash[a, b, c, d, e]])
-      :        +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-      +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(789 AS INTEGER) AS g])
-         +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-            +- Exchange(distribution=[hash[a, b, c, d, e]])
-               +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartialInsertWithGroupBy[isBatch: true]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
-+- LogicalProject(a=[$0], EXPR$1=[null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], d=[$3], e=[$4], EXPR$4=[null:BIGINT], EXPR$5=[null:INTEGER])
-   +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-
-== Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
-+- Sort(orderBy=[EXPR$1 ASC, d ASC])
-   +- Calc(select=[a, null:VARCHAR(2147483647) AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
-      +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-         +- Exchange(distribution=[hash[a, b, c, d, e]])
-            +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-
-== Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
-+- Sort(orderBy=[EXPR$1 ASC, d ASC])
-   +- Calc(select=[a, null:VARCHAR(2147483647) AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
+   +- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
       +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
          +- Exchange(distribution=[hash[a, b, c, d, e]])
             +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
@@ -145,52 +104,6 @@ Sink(table=[default_catalog.default_database.sink], targetColumns=[[1],[4],[0],[
       +- Exchange(distribution=[hash[a, b, c, d, e]])
          +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartialInsertWithComplexReorderAndComputedColumn[isBatch: false]">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], f=[CAST(123:BIGINT):BIGINT], g=[CAST(456):INTEGER])
-   +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
-   +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      +- Exchange(distribution=[hash[a, b, c, d, e]])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartialInsertWithComplexReorderAndComputedColumn[isBatch: true]">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], f=[CAST(123:BIGINT):BIGINT], g=[CAST(456):INTEGER])
-   +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- Sort(orderBy=[c ASC, d ASC])
-   +- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
-      +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-         +- Exchange(distribution=[hash[a, b, c, d, e]])
-            +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -269,6 +182,58 @@ Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[
                               +- Exchange(distribution=[hash[a, b, c, d, e]])
                                  +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
                                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartialInsertWithGroupBy[isBatch: false]">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
++- LogicalProject(a=[$0], EXPR$1=[null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], d=[$3], e=[$4], EXPR$4=[null:BIGINT], EXPR$5=[null:INTEGER])
+   +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+
+== Optimized Physical Plan ==
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
++- Calc(select=[a, null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE" AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
+   +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      +- Exchange(distribution=[hash[a, b, c, d, e]])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+
+== Optimized Execution Plan ==
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
++- Calc(select=[a, null:VARCHAR(2147483647) AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
+   +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      +- Exchange(distribution=[hash[a, b, c, d, e]])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartialInsertWithGroupBy[isBatch: true]">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
++- LogicalProject(a=[$0], EXPR$1=[null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], d=[$3], e=[$4], EXPR$4=[null:BIGINT], EXPR$5=[null:INTEGER])
+   +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+
+== Optimized Physical Plan ==
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
++- Sort(orderBy=[EXPR$1 ASC, d ASC])
+   +- Calc(select=[a, null:VARCHAR(2147483647) AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
+      +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+         +- Exchange(distribution=[hash[a, b, c, d, e]])
+            +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+
+== Optimized Execution Plan ==
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[3]], fields=[a, EXPR$1, d, e, EXPR$4, EXPR$5])
++- Sort(orderBy=[EXPR$1 ASC, d ASC])
+   +- Calc(select=[a, null:VARCHAR(2147483647) AS EXPR$1, d, e, null:BIGINT AS EXPR$4, null:INTEGER AS EXPR$5])
+      +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+         +- Exchange(distribution=[hash[a, b, c, d, e]])
+            +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -434,19 +399,23 @@ Sink(table=[default_catalog.default_database.metadata_sink], targetColumns=[[0],
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialInsertWithUnion[isBatch: false]">
+  <TestCase name="testPartialInsertWithUnionAllNested[isBatch: false]">
     <Resource name="sql">
-      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
+      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,123,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
 +- LogicalProject(a=[$0], c=[$1], d=[$2], e=[$3], f=[CAST($4):BIGINT], g=[CAST($5):INTEGER])
-   +- LogicalUnion(all=[false])
-      :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
-      :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
+   +- LogicalUnion(all=[true])
+      :- LogicalUnion(all=[true])
+      :  :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
+      :  :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      :  :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      :  +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
+      :     +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[123])
          +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
             +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -454,18 +423,65 @@ LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetCol
     <Resource name="optimized rel plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- Calc(select=[a, c, d, e, CAST(EXPR$4 AS BIGINT) AS f, CAST(EXPR$5 AS INTEGER) AS g])
-   +- GroupAggregate(groupBy=[a, c, d, e, EXPR$4, EXPR$5], select=[a, c, d, e, EXPR$4, EXPR$5])
-      +- Exchange(distribution=[hash[a, c, d, e, EXPR$4, EXPR$5]])
-         +- Union(all=[true], union=[a, c, d, e, EXPR$4, EXPR$5])
-            :- Calc(select=[a, c, d, e, 123 AS EXPR$4, 456 AS EXPR$5])
-            :  +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-            :     +- Exchange(distribution=[hash[a, b, c, d, e]])
-            :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-            +- Calc(select=[a, c, d, e, 456 AS EXPR$4, 789 AS EXPR$5])
-               +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-                  +- Exchange(distribution=[hash[a, b, c, d, e]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
++- Union(all=[true], union=[a, c, d, e, f, g])
+   :- Union(all=[true], union=[a, c, d, e, f, g])
+   :  :- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
+   :  :  +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+   :  :     +- Exchange(distribution=[hash[a, b, c, d, e]])
+   :  :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+   :  +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(789 AS INTEGER) AS g])
+   :     +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+   :        +- Exchange(distribution=[hash[a, b, c, d, e]])
+   :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+   +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(123 AS INTEGER) AS g])
+      +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+         +- Exchange(distribution=[hash[a, b, c, d, e]])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartialInsertWithUnionAllNested[isBatch: true]">
+    <Resource name="sql">
+      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,123,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
++- LogicalProject(a=[$0], c=[$1], d=[$2], e=[$3], f=[CAST($4):BIGINT], g=[CAST($5):INTEGER])
+   +- LogicalUnion(all=[true])
+      :- LogicalUnion(all=[true])
+      :  :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
+      :  :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      :  :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      :  +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
+      :     +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[123])
+         +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
++- Sort(orderBy=[c ASC, d ASC])
+   +- Union(all=[true], union=[a, c, d, e, f, g])
+      :- Union(all=[true], union=[a, c, d, e, f, g])
+      :  :- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
+      :  :  +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      :  :     +- Exchange(distribution=[hash[a, b, c, d, e]])
+      :  :        +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      :  :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+      :  +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(789 AS INTEGER) AS g])
+      :     +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      :        +- Exchange(distribution=[hash[a, b, c, d, e]])
+      :           +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      :              +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+      +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(123 AS INTEGER) AS g])
+         +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+            +- Exchange(distribution=[hash[a, b, c, d, e]])
+               +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -501,23 +517,19 @@ Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialInsertWithUnionAllNested[isBatch: true]">
+  <TestCase name="testPartialInsertWithUnionAll[isBatch: true]">
     <Resource name="sql">
-      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,123,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
+      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
 +- LogicalProject(a=[$0], c=[$1], d=[$2], e=[$3], f=[CAST($4):BIGINT], g=[CAST($5):INTEGER])
    +- LogicalUnion(all=[true])
-      :- LogicalUnion(all=[true])
-      :  :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
-      :  :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      :  :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      :  +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
-      :     +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[123])
+      :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
+      :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
          +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
             +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -527,22 +539,51 @@ LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetCol
 Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
 +- Sort(orderBy=[c ASC, d ASC])
    +- Union(all=[true], union=[a, c, d, e, f, g])
-      :- Union(all=[true], union=[a, c, d, e, f, g])
-      :  :- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
-      :  :  +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      :  :     +- Exchange(distribution=[hash[a, b, c, d, e]])
-      :  :        +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      :  :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-      :  +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(789 AS INTEGER) AS g])
-      :     +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      :        +- Exchange(distribution=[hash[a, b, c, d, e]])
-      :           +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-      :              +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-      +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(123 AS INTEGER) AS g])
+      :- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
+      :  +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      :     +- Exchange(distribution=[hash[a, b, c, d, e]])
+      :        +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+      :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+      +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(789 AS INTEGER) AS g])
          +- HashAggregate(isMerge=[true], groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
             +- Exchange(distribution=[hash[a, b, c, d, e]])
                +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
                   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartialInsertWithUnion[isBatch: false]">
+    <Resource name="sql">
+      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
++- LogicalProject(a=[$0], c=[$1], d=[$2], e=[$3], f=[CAST($4):BIGINT], g=[CAST($5):INTEGER])
+   +- LogicalUnion(all=[false])
+      :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
+      :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+      :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
+         +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
++- Calc(select=[a, c, d, e, CAST(EXPR$4 AS BIGINT) AS f, CAST(EXPR$5 AS INTEGER) AS g])
+   +- GroupAggregate(groupBy=[a, c, d, e, EXPR$4, EXPR$5], select=[a, c, d, e, EXPR$4, EXPR$5])
+      +- Exchange(distribution=[hash[a, c, d, e, EXPR$4, EXPR$5]])
+         +- Union(all=[true], union=[a, c, d, e, EXPR$4, EXPR$5])
+            :- Calc(select=[a, c, d, e, 123 AS EXPR$4, 456 AS EXPR$5])
+            :  +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+            :     +- Exchange(distribution=[hash[a, b, c, d, e]])
+            :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
+            +- Calc(select=[a, c, d, e, 456 AS EXPR$4, 789 AS EXPR$5])
+               +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
+                  +- Exchange(distribution=[hash[a, b, c, d, e]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -582,47 +623,6 @@ Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[
                         +- Exchange(distribution=[hash[a, b, c, d, e]])
                            +- LocalHashAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
                               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartialInsertWithUnionAllNested[isBatch: false]">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO partitioned_sink (e,a,g,f,c,d) SELECT e,a,456,123,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,789,456,c,d FROM MyTable GROUP BY a,b,c,d,e UNION ALL SELECT e,a,123,456,c,d FROM MyTable GROUP BY a,b,c,d,e ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- LogicalProject(a=[$0], c=[$1], d=[$2], e=[$3], f=[CAST($4):BIGINT], g=[CAST($5):INTEGER])
-   +- LogicalUnion(all=[true])
-      :- LogicalUnion(all=[true])
-      :  :- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[123], EXPR$5=[456])
-      :  :  +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      :  :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      :  +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[789])
-      :     +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(a=[$0], c=[$2], d=[$3], e=[$4], EXPR$4=[456], EXPR$5=[123])
-         +- LogicalAggregate(group=[{0, 1, 2, 3, 4}])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.partitioned_sink], targetColumns=[[4],[0],[6],[5],[2],[3]], fields=[a, c, d, e, f, g])
-+- Union(all=[true], union=[a, c, d, e, f, g])
-   :- Union(all=[true], union=[a, c, d, e, f, g])
-   :  :- Calc(select=[a, c, d, e, CAST(123 AS BIGINT) AS f, CAST(456 AS INTEGER) AS g])
-   :  :  +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-   :  :     +- Exchange(distribution=[hash[a, b, c, d, e]])
-   :  :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-   :  +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(789 AS INTEGER) AS g])
-   :     +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-   :        +- Exchange(distribution=[hash[a, b, c, d, e]])
-   :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
-   +- Calc(select=[a, c, d, e, CAST(456 AS BIGINT) AS f, CAST(123 AS INTEGER) AS g])
-      +- GroupAggregate(groupBy=[a, b, c, d, e], select=[a, b, c, d, e])
-         +- Exchange(distribution=[hash[a, b, c, d, e]])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml
index 93e88487fdf..52d73b639fe 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml
@@ -52,7 +52,7 @@ Calc(select=[a, b, (a + 1) AS c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithAppendedOptions[is-bounded=true]">
+  <TestCase name="testJoinWithAppendedOptions[is-bounded=false]">
     <Resource name="sql">
       <![CDATA[
 select * from
@@ -73,15 +73,16 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[left])\n:- Calc(select=[a, b, (a + 1) AS c])\n:  +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[hash[d]])\n])
-:- Exchange(distribution=[hash[d]])
-:  +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={d.e.f=fakeVal, k3=v3, k4=v4, k6=v6})], dynamic options: {d.e.f=fakeVal, k6=v6}]], fields=[d, e, f], hints=[[[OPTIONS options:{d.e.f=fakeVal, k6=v6}]]])
-+- Exchange(distribution=[hash[a]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], fields=[a, b], hints=[[[OPTIONS options:{a.b.c=fakeVal, k5=v5}]]])
+Join(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+:- Exchange(distribution=[hash[a]])
+:  +- Calc(select=[a, b, (a + 1) AS c])
+:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], fields=[a, b], hints=[[[OPTIONS options:{a.b.c=fakeVal, k5=v5}]]])
++- Exchange(distribution=[hash[d]])
+   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={d.e.f=fakeVal, k3=v3, k4=v4, k6=v6})], dynamic options: {d.e.f=fakeVal, k6=v6}]], fields=[d, e, f], hints=[[[OPTIONS options:{d.e.f=fakeVal, k6=v6}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithAppendedOptions[is-bounded=false]">
+  <TestCase name="testJoinWithAppendedOptions[is-bounded=true]">
     <Resource name="sql">
       <![CDATA[
 select * from
@@ -102,12 +103,11 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Join(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-:- Exchange(distribution=[hash[a]])
-:  +- Calc(select=[a, b, (a + 1) AS c])
-:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], fields=[a, b], hints=[[[OPTIONS options:{a.b.c=fakeVal, k5=v5}]]])
-+- Exchange(distribution=[hash[d]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={d.e.f=fakeVal, k3=v3, k4=v4, k6=v6})], dynamic options: {d.e.f=fakeVal, k6=v6}]], fields=[d, e, f], hints=[[[OPTIONS options:{d.e.f=fakeVal, k6=v6}]]])
+MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[left])\n:- Calc(select=[a, b, (a + 1) AS c])\n:  +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[hash[d]])\n])
+:- Exchange(distribution=[hash[d]])
+:  +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={d.e.f=fakeVal, k3=v3, k4=v4, k6=v6})], dynamic options: {d.e.f=fakeVal, k6=v6}]], fields=[d, e, f], hints=[[[OPTIONS options:{d.e.f=fakeVal, k6=v6}]]])
++- Exchange(distribution=[hash[a]])
+   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], fields=[a, b], hints=[[[OPTIONS options:{a.b.c=fakeVal, k5=v5}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -223,7 +223,7 @@ MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOverrideOptions[is-bounded=true]">
+  <TestCase name="testOverrideOptions[is-bounded=false]">
     <Resource name="sql">
       <![CDATA[select * from t1/*+ OPTIONS(k1='#v1', k2='#v2') */]]>
     </Resource>
@@ -241,7 +241,7 @@ Calc(select=[a, b, (a + 1) AS c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOverrideOptions[is-bounded=false]">
+  <TestCase name="testOverrideOptions[is-bounded=true]">
     <Resource name="sql">
       <![CDATA[select * from t1/*+ OPTIONS(k1='#v1', k2='#v2') */]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/BroadcastJoinHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/BroadcastJoinHintTest.xml
index 3e3c8bde99e..eadacfb9c55 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/BroadcastJoinHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/BroadcastJoinHintTest.xml
@@ -80,316 +80,6 @@ Calc(select=[a3, b3])
             :- Exchange(distribution=[broadcast])
             :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
             +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
-      :- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Exchange(distribution=[broadcast])
-         +- Calc(select=[a1])
-            +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-               :- Exchange(distribution=[broadcast])
-               :  +- Calc(select=[a1], where=[>(a1, 2)])
-               :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Calc(select=[a2], where=[>(a2, 5)])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
-      :- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[broadcast])
-         +- Calc(select=[a1])
-            +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-               :- Exchange(distribution=[broadcast])
-               :  +- Calc(select=[a1], where=[>(a1, 2)])
-               :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 5)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
-      :- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[broadcast])
-         +- Calc(select=[a1], where=[>(a1, 2)])
-            +- Calc(select=[a1, b1])
-               +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], isBroadcast=[true], build=[left])
-                  :- Exchange(distribution=[broadcast])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1], where=[>(a1, 5)])
-         +- Calc(select=[a1, b1])
-            +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], isBroadcast=[true], build=[left])
-               :- Exchange(distribution=[broadcast])
-               :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithCalc">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithDuplicatedArgs">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1, T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithFilter">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[>($0, 5)])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Calc(select=[a2, b2], where=[>(a2, 5)])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1, T2), BROADCAST(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1, T2]][BROADCAST inheritPath:[0] options:[T2, T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1), BROADCAST(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]][BROADCAST inheritPath:[0] options:[T2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithUnion">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ BROADCAST(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[false])
-:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-+- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T3]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-+- Exchange(distribution=[hash[a1, b1, a2, b2]])
-   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-      +- Union(all=[true], union=[a1, b1, a2, b2])
-         :- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
-         :  :- Exchange(distribution=[broadcast])
-         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-         :  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1], isBroadcast=[true], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
-            +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -722,30 +412,9 @@ Calc(select=[a1, b1])
                         +- Exchange(distribution=[broadcast])
                            +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
                               +- Exchange(distribution=[hash[a1]])
-                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
-                                    +- Calc(select=[a1])
-                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithoutJoinPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1, T2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
+                                    +- Calc(select=[a1])
+                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1033,55 +702,322 @@ HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides1">
+  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides1">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T2, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0, 0] options:[T2, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], isBroadcast=[true], build=[right])
+:- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[right])
+:  :- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:  +- Exchange(distribution=[broadcast])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides2">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T2, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0, 0] options:[T2, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], isBroadcast=[true], build=[right])
+:- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[right])
+:  :- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:  +- Exchange(distribution=[broadcast])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithNonEquiPred">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 where a1 in (select a2 from T2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T2) */* from T1 where a1 in (select a2 from T2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
++- LogicalProject(b1=[$1], a1=[$0])
+   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashAggregate(isMerge=[true], groupBy=[b1], select=[b1, Final_SUM(sum$0) AS EXPR$1])
++- Exchange(distribution=[hash[b1]])
+   +- LocalHashAggregate(groupBy=[b1], select=[b1, Partial_SUM(a1) AS sum$0])
+      +- Calc(select=[b1, a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], isBroadcast=[true], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName1">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V22]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[a1, b1])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
+   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- Calc(select=[a1])
+   :              +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+   :                 :- Exchange(distribution=[broadcast])
+   :                 :  +- Calc(select=[a1])
+   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Calc(select=[a1])
+      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName2">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V2]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[a1, b1])
+   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
+   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- Calc(select=[a1])
+   :              +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+   :                 :- Exchange(distribution=[broadcast])
+   :                 :  +- Calc(select=[a1])
+   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Calc(select=[a1])
+      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithTableAlias">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
+      <![CDATA[select /*+ BROADCAST(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T2, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0, 0] options:[T2, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], isBroadcast=[true], build=[right])
-:- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[right])
-:  :- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:  +- Exchange(distribution=[broadcast])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
+   :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Exchange(distribution=[broadcast])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides2">
+  <TestCase name="testJoinHintWithView">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ BROADCAST(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T2, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0, 0] options:[T2, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V4]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], isBroadcast=[true], build=[right])
-:- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[right])
-:  :- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:  +- Exchange(distribution=[broadcast])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3], isBroadcast=[true], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[broadcast])
    +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
@@ -1398,217 +1334,334 @@ HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBro
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithoutJoinPred">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1, T2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
+      :- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[broadcast])
+         +- Calc(select=[a1], where=[>(a1, 2)])
+            +- Calc(select=[a1, b1])
+               +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], isBroadcast=[true], build=[left])
+                  :- Exchange(distribution=[broadcast])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1], where=[>(a1, 5)])
+         +- Calc(select=[a1, b1])
+            +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], isBroadcast=[true], build=[left])
+               :- Exchange(distribution=[broadcast])
+               :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
+      :- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Exchange(distribution=[broadcast])
+         +- Calc(select=[a1])
+            +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+               :- Exchange(distribution=[broadcast])
+               :  +- Calc(select=[a1], where=[>(a1, 2)])
+               :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Calc(select=[a2], where=[>(a2, 5)])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
+      :- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[broadcast])
+         +- Calc(select=[a1])
+            +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+               :- Exchange(distribution=[broadcast])
+               :  +- Calc(select=[a1], where=[>(a1, 2)])
+               :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 5)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsWithCalc">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ BROADCAST(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithNonEquiPred">
+  <TestCase name="testJoinHintsWithDuplicatedArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
+      <![CDATA[select /*+ BROADCAST(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
 :- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintsWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[>($0, 5)])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Calc(select=[a2, b2], where=[>(a2, 5)])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ BROADCAST(T1, T2), BROADCAST(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1, T2]][BROADCAST inheritPath:[0] options:[T2, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[hash[a1]])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
+:- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ BROADCAST(T1), BROADCAST(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]][BROADCAST inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
+:- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+  <TestCase name="testJoinHintsWithUnion">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ BROADCAST(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-+- LogicalProject(b1=[$1], a1=[$0])
-   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalUnion(all=[false])
+:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
+:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]])
+:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T3]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[b1], select=[b1, Final_SUM(sum$0) AS EXPR$1])
-+- Exchange(distribution=[hash[b1]])
-   +- LocalHashAggregate(groupBy=[b1], select=[b1, Partial_SUM(a1) AS sum$0])
-      +- Calc(select=[b1, a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], isBroadcast=[true], build=[left])
+HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
++- Exchange(distribution=[hash[a1, b1, a2, b2]])
+   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
+      +- Union(all=[true], union=[a1, b1, a2, b2])
+         :- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBroadcast=[true], build=[left])
+         :  :- Exchange(distribution=[broadcast])
+         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+         :  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1], isBroadcast=[true], build=[left])
             :- Exchange(distribution=[broadcast])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName1">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V22]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[a1, b1])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
-   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- Calc(select=[a1])
-   :              +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-   :                 :- Exchange(distribution=[broadcast])
-   :                 :  +- Calc(select=[a1])
-   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Calc(select=[a1])
-      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName2">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V2]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[a1, b1])
-   :     +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
-   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- Calc(select=[a1])
-   :              +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-   :                 :- Exchange(distribution=[broadcast])
-   :                 :  +- Calc(select=[a1])
-   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Calc(select=[a1])
-      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+            +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1630,59 +1683,6 @@ HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], isBro
 :- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithTableAlias">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[right])
-   :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Exchange(distribution=[broadcast])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithView">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[V4]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3], isBroadcast=[true], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/NestLoopJoinHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/NestLoopJoinHintTest.xml
index 7cac6862d49..50a1a8bc7fe 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/NestLoopJoinHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/NestLoopJoinHintTest.xml
@@ -83,179 +83,81 @@ Calc(select=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
+  <TestCase name="testJoinHintWithAntiJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 where a1 not in (select a2 from T2)]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-      :- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Exchange(distribution=[broadcast])
-         +- Calc(select=[a1])
-            +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-               :- Exchange(distribution=[broadcast])
-               :  +- Calc(select=[a1], where=[>(a1, 2)])
-               :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Calc(select=[a2], where=[>(a2, 5)])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
+  <TestCase name="testJoinHintWithAntiJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T2) */* from T1 where a1 not in (select a2 from T2)]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-      :- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[broadcast])
-         +- Calc(select=[a1])
-            +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-               :- Exchange(distribution=[broadcast])
-               :  +- Calc(select=[a1], where=[>(a1, 2)])
-               :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- Calc(select=[a2], where=[>(a2, 5)])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+  <TestCase name="testJoinHintWithCastInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1)*/T1.b1, cast(T1.a1 as int) from T1 join T2 on T1.b1 = T2.b2]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(b1=[$1], EXPR$1=[CAST($0):INTEGER])
++- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-      :- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[broadcast])
-         +- Calc(select=[a1], where=[>(a1, 2)])
-            +- Calc(select=[a1, b1])
-               +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
-                  :- Exchange(distribution=[broadcast])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1], where=[>(a1, 5)])
-         +- Calc(select=[a1, b1])
-            +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
-               :- Exchange(distribution=[broadcast])
-               :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+Calc(select=[b1, CAST(a1 AS INTEGER) AS EXPR$1])
++- NestedLoopJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithCalc">
+  <TestCase name="testJoinHintWithDisabledOperator">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
@@ -263,22 +165,22 @@ LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithDuplicatedArgs">
+  <TestCase name="testJoinHintWithEquiAndLocalPred">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 inner join T2 on T1.a1 = T2.a2 and T1.a1 < 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1, T1]]]])
++- LogicalJoin(condition=[AND(=($0, $2), <($0, 1))], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
@@ -287,45 +189,46 @@ LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
       <![CDATA[
 NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Calc(select=[a2, b2], where=[<(a2, 1)])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithFilter">
+  <TestCase name="testJoinHintWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 inner join T2 on T1.b1 = T2.b2 and T1.a1 < 1 and T1.a1 < T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[>($0, 5)])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalJoin(condition=[AND(=($1, $3), <($0, 1), <($0, $2))], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+NestedLoopJoin(joinType=[InnerJoin], where=[AND(=(b1, b2), <(a1, a2))], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Calc(select=[a2, b2], where=[>(a2, 5)])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
+  <TestCase name="testJoinHintWithEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1, T2), NEST_LOOP(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1, T2 where T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1, T2]][NEST_LOOP inheritPath:[0] options:[T2, T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[=($0, $2)])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -337,243 +240,31 @@ NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2],
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
+  <TestCase name="testJoinHintWithEquiPredAndFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1), NEST_LOOP(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1, T2 where T1.a1 = T2.a2 and T1.a1 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]][NEST_LOOP inheritPath:[0] options:[T2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[AND(=($0, $2), >($0, 1))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+:  +- Calc(select=[a1, b1], where=[>(a1, 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Calc(select=[a2, b2], where=[>(a2, 1)])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithUnion">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ NEST_LOOP(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[false])
-:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-+- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T3]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-+- Exchange(distribution=[hash[a1, b1, a2, b2]])
-   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-      +- Union(all=[true], union=[a1, b1, a2, b2])
-         :- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-         :  :- Exchange(distribution=[broadcast])
-         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-         :  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-         +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
-            +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithAntiJoinAndLeftSideAsBuildSide">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 where a1 not in (select a2 from T2)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithAntiJoinAndRightSideAsBuildSide">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T2) */* from T1 where a1 not in (select a2 from T2)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithCastInSelectList">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1)*/T1.b1, cast(T1.a1 as int) from T1 join T2 on T1.b1 = T2.b2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b1=[$1], EXPR$1=[CAST($0):INTEGER])
-+- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[b1, CAST(a1 AS INTEGER) AS EXPR$1])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithDisabledOperator">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithEquiAndLocalPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 inner join T2 on T1.a1 = T2.a2 and T1.a1 < 1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[AND(=($0, $2), <($0, 1))], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Calc(select=[a2, b2], where=[<(a2, 1)])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithEquiAndNonEquiPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 inner join T2 on T1.b1 = T2.b2 and T1.a1 < 1 and T1.a1 < T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[AND(=($1, $3), <($0, 1), <($0, $2))], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[AND(=(b1, b2), <(a1, a2))], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithEquiPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1, T2 where T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[=($0, $2)])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithEquiPredAndFilter">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1, T2 where T1.a1 = T2.a2 and T1.a1 > 1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[AND(=($0, $2), >($0, 1))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[a1, b1], where=[>(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Calc(select=[a2, b2], where=[>(a2, 1)])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithFullJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithFullJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
       <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 full join T2 on T1.a1 = T2.a2]]>
     </Resource>
@@ -724,27 +415,6 @@ Calc(select=[a1, b1])
                               +- LocalHashAggregate(groupBy=[a1], select=[a1])
                                  +- Calc(select=[a1])
                                     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithoutJoinPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1, T2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
@@ -1084,30 +754,296 @@ NestedLoopJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileArgsCanBeFoundInOuterJoin">
+  <TestCase name="testJoinHintWithNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Calc(select=[a1])
-      +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-         :- Exchange(distribution=[hash[a1]])
+NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 where a1 in (select a2 from T2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T2) */* from T1 where a1 in (select a2 from T2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
++- LogicalProject(b1=[$1], a1=[$0])
+   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashAggregate(isMerge=[true], groupBy=[b1], select=[b1, Final_SUM(sum$0) AS EXPR$1])
++- Exchange(distribution=[hash[b1]])
+   +- LocalHashAggregate(groupBy=[b1], select=[b1, Partial_SUM(a1) AS sum$0])
+      +- Calc(select=[b1, a1])
+         +- NestedLoopJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName1">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V22]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[a1, b1])
+   :     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- Calc(select=[a1])
+   :              +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+   :                 :- Exchange(distribution=[broadcast])
+   :                 :  +- Calc(select=[a1])
+   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Calc(select=[a1])
+      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName2">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V2]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- Calc(select=[a1, b1])
+   :     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :        +- Exchange(distribution=[broadcast])
+   :           +- Calc(select=[a1])
+   :              +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+   :                 :- Exchange(distribution=[broadcast])
+   :                 :  +- Calc(select=[a1])
+   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Calc(select=[a1])
+      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithTableAlias">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+   :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Exchange(distribution=[broadcast])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithView">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V4]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileArgsCanBeFoundInOuterJoin">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Calc(select=[a1])
+      +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+         :- Exchange(distribution=[hash[a1]])
          :  +- Calc(select=[a1])
          :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
          +- Exchange(distribution=[hash[a2]])
@@ -1395,216 +1331,333 @@ NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2],
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithoutJoinPred">
+    <Resource name="sql">
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1, T2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+      :- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[broadcast])
+         +- Calc(select=[a1], where=[>(a1, 2)])
+            +- Calc(select=[a1, b1])
+               +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
+                  :- Exchange(distribution=[broadcast])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1], where=[>(a1, 5)])
+         +- Calc(select=[a1, b1])
+            +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
+               :- Exchange(distribution=[broadcast])
+               :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+      :- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Exchange(distribution=[broadcast])
+         +- Calc(select=[a1])
+            +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+               :- Exchange(distribution=[broadcast])
+               :  +- Calc(select=[a1], where=[>(a1, 2)])
+               :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Calc(select=[a2], where=[>(a2, 5)])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+      :- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[broadcast])
+         +- Calc(select=[a1])
+            +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+               :- Exchange(distribution=[broadcast])
+               :  +- Calc(select=[a1], where=[>(a1, 2)])
+               :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- Calc(select=[a2], where=[>(a2, 5)])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsWithCalc">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
++- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+   :- Exchange(distribution=[broadcast])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithNonEquiPred">
+  <TestCase name="testJoinHintsWithDuplicatedArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintsWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[>($0, 5)])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Calc(select=[a2, b2], where=[>(a2, 5)])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ NEST_LOOP(T1, T2), NEST_LOOP(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1, T2]][NEST_LOOP inheritPath:[0] options:[T2, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T2) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ NEST_LOOP(T1), NEST_LOOP(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]][NEST_LOOP inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
+NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+  <TestCase name="testJoinHintsWithUnion">
     <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+      <![CDATA[select /*+ NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ NEST_LOOP(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-+- LogicalProject(b1=[$1], a1=[$0])
-   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalUnion(all=[false])
+:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
+:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]])
+:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T3]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[b1], select=[b1, Final_SUM(sum$0) AS EXPR$1])
-+- Exchange(distribution=[hash[b1]])
-   +- LocalHashAggregate(groupBy=[b1], select=[b1, Partial_SUM(a1) AS sum$0])
-      +- Calc(select=[b1, a1])
-         +- NestedLoopJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
+HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
++- Exchange(distribution=[hash[a1, b1, a2, b2]])
+   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
+      +- Union(all=[true], union=[a1, b1, a2, b2])
+         :- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+         :  :- Exchange(distribution=[broadcast])
+         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+         :  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+         +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1], build=[left])
             :- Exchange(distribution=[broadcast])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName1">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V22]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[a1, b1])
-   :     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- Calc(select=[a1])
-   :              +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-   :                 :- Exchange(distribution=[broadcast])
-   :                 :  +- Calc(select=[a1])
-   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Calc(select=[a1])
-      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName2">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V2]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[broadcast])
-   :  +- Calc(select=[a1, b1])
-   :     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-   :        :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :        +- Exchange(distribution=[broadcast])
-   :           +- Calc(select=[a1])
-   :              +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-   :                 :- Exchange(distribution=[broadcast])
-   :                 :  +- Calc(select=[a1])
-   :                 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :                 +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Calc(select=[a1])
-      +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+            +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1626,59 +1679,6 @@ NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2],
 :- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithTableAlias">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-   :- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Exchange(distribution=[broadcast])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithView">
-    <Resource name="sql">
-      <![CDATA[select /*+ NEST_LOOP(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[NEST_LOOP inheritPath:[0] options:[V4]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleHashJoinHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleHashJoinHintTest.xml
index beedac11333..63a9af10ea7 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleHashJoinHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleHashJoinHintTest.xml
@@ -85,217 +85,90 @@ Calc(select=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 2)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 5)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-]]>
+  <TestCase name="testJoinHintWithAntiJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 where a1 not in (select a2 from T2)]]>
     </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 2)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- Calc(select=[a2], where=[>(a2, 5)])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+  <TestCase name="testJoinHintWithAntiJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 where a1 not in (select a2 from T2)]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[hash[a1]])
-         +- Calc(select=[a1], where=[>(a1, 2)])
-            +- Calc(select=[a1, b1])
-               +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
-                  :- Exchange(distribution=[hash[a1]])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-                  +- Exchange(distribution=[hash[a2]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[hash[a1]])
-         +- Calc(select=[a1], where=[>(a1, 5)])
-            +- Calc(select=[a1, b1])
-               +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
-                  :- Exchange(distribution=[hash[a1]])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-                  +- Exchange(distribution=[hash[a2]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithCalc">
+  <TestCase name="testJoinHintWithCastInSelectList">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1)*/T1.b1, cast(T1.a1 as int) from T1 join T2 on T1.b1 = T2.b2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+LogicalProject(b1=[$1], EXPR$1=[CAST($0):INTEGER])
++- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
-   +- Exchange(distribution=[hash[a2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+Calc(select=[b1, CAST(a1 AS INTEGER) AS EXPR$1])
++- HashJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
+   :- Exchange(distribution=[hash[b1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+   +- Exchange(distribution=[hash[b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithDuplicatedArgs">
+  <TestCase name="testJoinHintWithDisabledOperator">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1, T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -303,63 +176,64 @@ HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithFilter">
+  <TestCase name="testJoinHintWithEquiAndLocalPred">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 inner join T2 on T1.a1 = T2.a2 and T1.a1 < 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[>($0, 5)])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalJoin(condition=[AND(=($0, $2), <($0, 1))], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- Calc(select=[a2, b2], where=[>(a2, 5)])
+   +- Calc(select=[a2, b2], where=[<(a2, 1)])
       +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
+  <TestCase name="testJoinHintWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2), SHUFFLE_HASH(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 inner join T2 on T1.b1 = T2.b2 and T1.a1 < 1 and T1.a1 < T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1, T2]][SHUFFLE_HASH inheritPath:[0] options:[T2, T1]]]])
++- LogicalJoin(condition=[AND(=($1, $3), <($0, 1), <($0, $2))], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
+HashJoin(joinType=[InnerJoin], where=[AND(=(b1, b2), <(a1, a2))], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[hash[b1]])
+:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Exchange(distribution=[hash[b2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
+  <TestCase name="testJoinHintWithEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1), SHUFFLE_HASH(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1, T2 where T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]][SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[=($0, $2)])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -372,243 +246,338 @@ HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithUnion">
+  <TestCase name="testJoinHintWithEquiPredAndFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ SHUFFLE_HASH(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1, T2 where T1.a1 = T2.a2 and T1.a1 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalUnion(all=[false])
-:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-+- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T3]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalFilter(condition=[AND(=($0, $2), >($0, 1))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-+- Exchange(distribution=[hash[a1, b1, a2, b2]])
-   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-      +- Union(all=[true], union=[a1, b1, a2, b2])
-         :- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-         :  :- Exchange(distribution=[hash[a1]])
-         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-         :  +- Exchange(distribution=[hash[a2]])
-         :     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1], build=[left])
-            :- Exchange(distribution=[hash[a3]])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
-            +- Exchange(distribution=[hash[a1]])
-               +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[hash[a1]])
+:  +- Calc(select=[a1, b1], where=[>(a1, 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- Calc(select=[a2, b2], where=[>(a2, 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithAntiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithFullJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 where a1 not in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 full join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+HashJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithAntiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintWithFullJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 where a1 not in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 full join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+HashJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithCastInSelectList">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithAgg">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1)*/T1.b1, cast(T1.a1 as int) from T1 join T2 on T1.b1 = T2.b2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ count(T2.a2) from T2 join T1 on T2.a2 = T1.a1 group by T1.a1)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b1=[$1], EXPR$1=[CAST($0):INTEGER])
-+- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(EXPR$0=[$1])
+  LogicalAggregate(group=[{0}], EXPR$0=[COUNT($1)])
+    LogicalProject(a1=[$2], a2=[$0])
+      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[b1, CAST(a1 AS INTEGER) AS EXPR$1])
-+- HashJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
-   :- Exchange(distribution=[hash[b1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-   +- Exchange(distribution=[hash[b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, EXPR$0)], select=[a1, b1], build=[right], tryDistinctBuildRow=[true])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[EXPR$0]])
+   +- LocalHashAggregate(groupBy=[EXPR$0], select=[EXPR$0])
+      +- Calc(select=[EXPR$0])
+         +- HashAggregate(isMerge=[false], groupBy=[a1], select=[a1, COUNT(a2) AS EXPR$0])
+            +- HashJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1], build=[left])
+               :- Exchange(distribution=[hash[a2]])
+               :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+               +- Exchange(distribution=[hash[a1]])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithDisabledOperator">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3 where T1.a1 = T2.a2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalFilter(condition=[=($cor0.a1, $0)])
+    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+      LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Calc(select=[a2])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
+      :- Exchange(distribution=[hash[a2]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+      +- Exchange(distribution=[hash[a3]])
+         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiAndLocalPred">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithProject">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 inner join T2 on T1.a1 = T2.a2 and T1.a1 < 1]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 + T1.a1 from T2 join T3 on T2.a2 = T3.a3)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[AND(=($0, $2), <($0, 1))], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(EXPR$0=[+($0, $cor0.a1)])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- Calc(select=[a2, b2], where=[<(a2, 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+            +- Exchange(distribution=[hash[EXPR$0, a1]])
+               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
+                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
+                        :- Calc(select=[a2])
+                        :  +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
+                        :     :- Exchange(distribution=[hash[a2]])
+                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                        :     +- Exchange(distribution=[hash[a3]])
+                        :        +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
+                        +- Exchange(distribution=[broadcast])
+                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
+                              +- Exchange(distribution=[hash[a1]])
+                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
+                                    +- Calc(select=[a1])
+                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiAndNonEquiPred">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithSortLimit">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 inner join T2 on T1.b1 = T2.b2 and T1.a1 < 1 and T1.a1 < T2.a2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ T2.a2 from T2 join T1 on T2.a2 = T1.a1 order by T1.a1 limit 10)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[AND(=($1, $3), <($0, 1), <($0, $2))], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
+    LogicalProject(a2=[$0], a1=[$2])
+      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[AND(=(b1, b2), <(a1, a2))], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[hash[b1]])
-:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Exchange(distribution=[hash[b2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], isBroadcast=[true], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[a2])
+      +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[true])
+         +- Exchange(distribution=[single])
+            +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[false])
+               +- HashJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1], build=[left])
+                  :- Exchange(distribution=[hash[a2]])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                  +- Exchange(distribution=[hash[a1]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiPred">
+  <TestCase name="testJoinHintWithJoinHintInNestedCorrelatedSubQuery">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1, T2 where T1.a1 = T2.a2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 + T1.a1 from T2 join (select T3.* from T2 join T3 on T2.a2 = T3.a3) T3 on T2.a2 = T3.a3)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[=($0, $2)])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(EXPR$0=[+($0, $cor0.a1)])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+    LogicalProject(a3=[$2], b3=[$3])
+      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+        LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+            +- Exchange(distribution=[hash[EXPR$0, a1]])
+               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
+                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
+                        :- Calc(select=[a2])
+                        :  +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
+                        :     :- Exchange(distribution=[hash[a2]])
+                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                        :     +- Calc(select=[a3])
+                        :        +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
+                        :           :- Exchange(distribution=[hash[a2]])
+                        :           :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                        :           +- Exchange(distribution=[hash[a3]])
+                        :              +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
+                        +- Exchange(distribution=[broadcast])
+                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
+                              +- Exchange(distribution=[hash[a1]])
+                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
+                                    +- Calc(select=[a1])
+                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithJoinHintInSubQuery">
+    <Resource name="sql">
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Calc(select=[a2])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
+      :- Exchange(distribution=[hash[a2]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+      +- Exchange(distribution=[hash[a3]])
+         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiPredAndFilter">
+  <TestCase name="testJoinHintWithLeftJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1, T2 where T1.a1 = T2.a2 and T1.a1 > 1]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 left join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[AND(=($0, $2), >($0, 1))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1], where=[>(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- Calc(select=[a2, b2], where=[>(a2, 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithFullJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithLeftJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 full join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 left join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -616,21 +585,21 @@ HashJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithFullJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintWithMultiArgsAndLeftSideFirst">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 full join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1, T2]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -638,268 +607,209 @@ HashJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithAgg">
+  <TestCase name="testJoinHintWithMultiArgsAndRightSideFirst">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ count(T2.a2) from T2 join T1 on T2.a2 = T1.a1 group by T1.a1)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T2, T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(EXPR$0=[$1])
-  LogicalAggregate(group=[{0}], EXPR$0=[COUNT($1)])
-    LogicalProject(a1=[$2], a2=[$0])
-      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2, T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, EXPR$0)], select=[a1, b1], build=[right], tryDistinctBuildRow=[true])
+HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[EXPR$0]])
-   +- LocalHashAggregate(groupBy=[EXPR$0], select=[EXPR$0])
-      +- Calc(select=[EXPR$0])
-         +- HashAggregate(isMerge=[false], groupBy=[a1], select=[a1, COUNT(a2) AS EXPR$0])
-            +- HashJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1], build=[left])
-               :- Exchange(distribution=[hash[a2]])
-               :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-               +- Exchange(distribution=[hash[a1]])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithFilter">
+  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide1">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3 where T1.a1 = T2.a2)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalFilter(condition=[=($cor0.a1, $0)])
-    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-      LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1, T2]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T1, T2]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Calc(select=[a2])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
-      :- Exchange(distribution=[hash[a2]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-      +- Exchange(distribution=[hash[a3]])
-         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
+HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
+:- Exchange(distribution=[hash[b1]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithProject">
+  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide2">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 + T1.a1 from T2 join T3 on T2.a2 = T3.a3)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(EXPR$0=[+($0, $cor0.a1)])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1, T2]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T1, T2]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-            +- Exchange(distribution=[hash[EXPR$0, a1]])
-               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
-                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
-                        :- Calc(select=[a2])
-                        :  +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
-                        :     :- Exchange(distribution=[hash[a2]])
-                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                        :     +- Exchange(distribution=[hash[a3]])
-                        :        +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
-                        +- Exchange(distribution=[broadcast])
-                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
-                              +- Exchange(distribution=[hash[a1]])
-                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
-                                    +- Calc(select=[a1])
-                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
+:- Exchange(distribution=[hash[b2]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutJoinPred">
+  <TestCase name="testJoinHintWithMultiJoinAndFirstThirdSideAsBuildSides">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1, T2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T1, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[right])
+:- Exchange(distribution=[hash[b2]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithSortLimit">
+  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides1">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ T2.a2 from T2 join T1 on T2.a2 = T1.a1 order by T1.a1 limit 10)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
-    LogicalProject(a2=[$0], a1=[$2])
-      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T2, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T2, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], isBroadcast=[true], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[a2])
-      +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[true])
-         +- Exchange(distribution=[single])
-            +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[false])
-               +- HashJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1], build=[left])
-                  :- Exchange(distribution=[hash[a2]])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                  +- Exchange(distribution=[hash[a1]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
+HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], build=[right])
+:- Exchange(distribution=[hash[b1]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInNestedCorrelatedSubQuery">
-    <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 + T1.a1 from T2 join (select T3.* from T2 join T3 on T2.a2 = T3.a3) T3 on T2.a2 = T3.a3)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(EXPR$0=[+($0, $cor0.a1)])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-    LogicalProject(a3=[$2], b3=[$3])
-      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-        LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides2">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_HASH(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T2, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T2, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-            +- Exchange(distribution=[hash[EXPR$0, a1]])
-               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
-                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
-                        :- Calc(select=[a2])
-                        :  +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
-                        :     :- Exchange(distribution=[hash[a2]])
-                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                        :     +- Calc(select=[a3])
-                        :        +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
-                        :           :- Exchange(distribution=[hash[a2]])
-                        :           :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                        :           +- Exchange(distribution=[hash[a3]])
-                        :              +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
-                        +- Exchange(distribution=[broadcast])
-                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
-                              +- Exchange(distribution=[hash[a1]])
-                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
-                                    +- Calc(select=[a1])
-                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[right])
+:- Exchange(distribution=[hash[b2]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInSubQuery">
+  <TestCase name="testJoinHintWithNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_HaSh(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
+NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Calc(select=[a2])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
-      :- Exchange(distribution=[hash[a2]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-      +- Exchange(distribution=[hash[a3]])
-         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithLeftJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 left join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -907,21 +817,21 @@ HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithLeftJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 left join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -929,191 +839,207 @@ HashJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiArgsAndLeftSideFirst">
+  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1, T2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiArgsAndRightSideFirst">
+  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2, T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2, T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide1">
+  <TestCase name="testJoinHintWithSimpleSumInSelectList">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1, T2]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T1, T2]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
++- LogicalProject(b1=[$1], a1=[$0])
+   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
-:- Exchange(distribution=[hash[b1]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+HashAggregate(isMerge=[false], groupBy=[b1], select=[b1, SUM(a1) AS EXPR$1])
++- Calc(select=[b1, a1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
+      :- Exchange(distribution=[hash[b1]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[hash[b2]])
+         +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide2">
+  <TestCase name="testJoinHintWithSubStringViewName1">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1, T2]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T1, T2]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V22]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
-:- Exchange(distribution=[hash[b2]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Calc(select=[a1, b1])
+   :  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+   :     :- Exchange(distribution=[hash[a1]])
+   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :     +- Calc(select=[a1])
+   :        +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+   :           :- Exchange(distribution=[hash[a1]])
+   :           :  +- Calc(select=[a1])
+   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :           +- Exchange(distribution=[hash[a2]])
+   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndFirstThirdSideAsBuildSides">
+  <TestCase name="testJoinHintWithSubStringViewName2">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T1, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V2]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[right])
-:- Exchange(distribution=[hash[b2]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Calc(select=[a1, b1])
+   :  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+   :     :- Exchange(distribution=[hash[a1]])
+   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :     +- Calc(select=[a1])
+   :        +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+   :           :- Exchange(distribution=[hash[a1]])
+   :           :  +- Calc(select=[a1])
+   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :           +- Exchange(distribution=[hash[a2]])
+   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides1">
+  <TestCase name="testJoinHintWithTableAlias">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T2, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T2, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], build=[right])
-:- Exchange(distribution=[hash[b1]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Calc(select=[a1])
+      +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+         :- Exchange(distribution=[hash[a1]])
+         :  +- Calc(select=[a1])
+         :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+         +- Exchange(distribution=[hash[a2]])
+            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides2">
+  <TestCase name="testJoinHintWithView">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T2, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0, 0] options:[T2, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V4]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[right])
-:- Exchange(distribution=[hash[b2]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3], build=[right])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a3]])
    +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
@@ -1430,88 +1356,285 @@ HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithoutJoinPred">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1, T2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[hash[a1]])
+         +- Calc(select=[a1], where=[>(a1, 2)])
+            +- Calc(select=[a1, b1])
+               +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
+                  :- Exchange(distribution=[hash[a1]])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+                  +- Exchange(distribution=[hash[a2]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[hash[a1]])
+         +- Calc(select=[a1], where=[>(a1, 5)])
+            +- Calc(select=[a1, b1])
+               +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2], build=[left])
+                  :- Exchange(distribution=[hash[a1]])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+                  +- Exchange(distribution=[hash[a2]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 2)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 5)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 2)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- Calc(select=[a2], where=[>(a2, 5)])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsWithCalc">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
+   +- Exchange(distribution=[hash[a2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithNonEquiPred">
+  <TestCase name="testJoinHintsWithDuplicatedArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintsWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[>($0, 5)])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+   +- Calc(select=[a2, b2], where=[>(a2, 5)])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1, T2), SHUFFLE_HASH(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1, T2]][SHUFFLE_HASH inheritPath:[0] options:[T2, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[right])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -1519,130 +1642,61 @@ HashJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2],
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T2) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1), SHUFFLE_HASH(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]][SHUFFLE_HASH inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSimpleSumInSelectList">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-+- LogicalProject(b1=[$1], a1=[$0])
-   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashAggregate(isMerge=[false], groupBy=[b1], select=[b1, SUM(a1) AS EXPR$1])
-+- Calc(select=[b1, a1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2], build=[left])
-      :- Exchange(distribution=[hash[b1]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[hash[b2]])
-         +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName1">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V22]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Calc(select=[a1, b1])
-   :  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-   :     :- Exchange(distribution=[hash[a1]])
-   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :     +- Calc(select=[a1])
-   :        +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-   :           :- Exchange(distribution=[hash[a1]])
-   :           :  +- Calc(select=[a1])
-   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :           +- Exchange(distribution=[hash[a2]])
-   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName2">
+  <TestCase name="testJoinHintsWithUnion">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+      <![CDATA[select /*+ SHUFFLE_HASH(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ SHUFFLE_HASH(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V2]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalUnion(all=[false])
+:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
+:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T1]]]])
+:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[T3]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Calc(select=[a1, b1])
-   :  +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-   :     :- Exchange(distribution=[hash[a1]])
-   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :     +- Calc(select=[a1])
-   :        +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-   :           :- Exchange(distribution=[hash[a1]])
-   :           :  +- Calc(select=[a1])
-   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :           +- Exchange(distribution=[hash[a2]])
-   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
++- Exchange(distribution=[hash[a1, b1, a2, b2]])
+   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
+      +- Union(all=[true], union=[a1, b1, a2, b2])
+         :- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+         :  :- Exchange(distribution=[hash[a1]])
+         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+         :  +- Exchange(distribution=[hash[a2]])
+         :     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1], build=[left])
+            :- Exchange(distribution=[hash[a3]])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+            +- Exchange(distribution=[hash[a1]])
+               +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1665,60 +1719,6 @@ HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithTableAlias">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[right])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Calc(select=[a1])
-      +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-         :- Exchange(distribution=[hash[a1]])
-         :  +- Calc(select=[a1])
-         :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-         +- Exchange(distribution=[hash[a2]])
-            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithView">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_HASH(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH inheritPath:[0] options:[V4]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleMergeJoinHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleMergeJoinHintTest.xml
index 989bc3aacf4..d8d9f36f4e6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleMergeJoinHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/batch/ShuffleMergeJoinHintTest.xml
@@ -85,217 +85,90 @@ Calc(select=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 2)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 5)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
-]]>
+  <TestCase name="testJoinHintWithAntiJoinAndLeftSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 where a1 not in (select a2 from T2)]]>
     </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
-            :- Exchange(distribution=[hash[a1]])
-            :  +- Calc(select=[a1], where=[>(a1, 2)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- Exchange(distribution=[hash[a2]])
-               +- Calc(select=[a2], where=[>(a2, 2)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
-      :- Exchange(distribution=[broadcast])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Calc(select=[a1])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
-            :- Exchange(distribution=[broadcast])
-            :  +- Calc(select=[a1], where=[>(a1, 5)])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-            +- Calc(select=[a2], where=[>(a2, 5)])
-               +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+  <TestCase name="testJoinHintWithAntiJoinAndRightSideAsBuildSide">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 where a1 not in (select a2 from T2)]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 2)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- LogicalProject(a1=[$0], b1=[$1])
-   +- LogicalFilter(condition=[>($2, 5)])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[hash[a1]])
-         +- Calc(select=[a1], where=[>(a1, 2)])
-            +- Calc(select=[a1, b1])
-               +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2])
-                  :- Exchange(distribution=[hash[a1]])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-                  +- Exchange(distribution=[hash[a2]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-
-Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
-+- Calc(select=[a1, b1])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-      :- Exchange(distribution=[hash[a1]])
-      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[hash[a1]])
-         +- Calc(select=[a1], where=[>(a1, 5)])
-            +- Calc(select=[a1, b1])
-               +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2])
-                  :- Exchange(distribution=[hash[a1]])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-                  +- Exchange(distribution=[hash[a2]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithCalc">
+  <TestCase name="testJoinHintWithCastInSelectList">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1)*/T1.b1, cast(T1.a1 as int) from T1 join T2 on T1.b1 = T2.b2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+LogicalProject(b1=[$1], EXPR$1=[CAST($0):INTEGER])
++- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
-+- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
-   +- Exchange(distribution=[hash[a2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+Calc(select=[b1, CAST(a1 AS INTEGER) AS EXPR$1])
++- SortMergeJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2])
+   :- Exchange(distribution=[hash[b1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+   +- Exchange(distribution=[hash[b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithDuplicatedArgs">
+  <TestCase name="testJoinHintWithDisabledOperator">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1, T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -303,63 +176,64 @@ SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithFilter">
+  <TestCase name="testJoinHintWithEquiAndLocalPred">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 inner join T2 on T1.a1 = T2.a2 and T1.a1 < 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[>($0, 5)])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalJoin(condition=[AND(=($0, $2), <($0, 1))], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
 :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- Calc(select=[a2, b2], where=[>(a2, 5)])
+   +- Calc(select=[a2, b2], where=[<(a2, 1)])
       +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
+  <TestCase name="testJoinHintWithEquiAndNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2), SHUFFLE_MERGE(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 inner join T2 on T1.b1 = T2.b2 and T1.a1 < 1 and T1.a1 < T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1, T2]][SHUFFLE_MERGE inheritPath:[0] options:[T2, T1]]]])
++- LogicalJoin(condition=[AND(=($1, $3), <($0, 1), <($0, $2))], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
+SortMergeJoin(joinType=[InnerJoin], where=[AND(=(b1, b2), <(a1, a2))], select=[a1, b1, a2, b2])
+:- Exchange(distribution=[hash[b1]])
+:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Exchange(distribution=[hash[b2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
+  <TestCase name="testJoinHintWithEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1), SHUFFLE_MERGE(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1, T2 where T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]][SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[=($0, $2)])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -372,243 +246,338 @@ SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintsWithUnion">
+  <TestCase name="testJoinHintWithEquiPredAndFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ SHUFFLE_MERGE(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1, T2 where T1.a1 = T2.a2 and T1.a1 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalUnion(all=[false])
-:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-+- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T3]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalFilter(condition=[AND(=($0, $2), >($0, 1))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-+- Exchange(distribution=[hash[a1, b1, a2, b2]])
-   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
-      +- Union(all=[true], union=[a1, b1, a2, b2])
-         :- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-         :  :- Exchange(distribution=[hash[a1]])
-         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-         :  +- Exchange(distribution=[hash[a2]])
-         :     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1])
-            :- Exchange(distribution=[hash[a3]])
-            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
-            +- Exchange(distribution=[hash[a1]])
-               +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:- Exchange(distribution=[hash[a1]])
+:  +- Calc(select=[a1, b1], where=[>(a1, 1)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- Calc(select=[a2, b2], where=[>(a2, 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithAntiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithFullJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 where a1 not in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 full join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+SortMergeJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithAntiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintWithFullJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 where a1 not in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 full join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(a1), IS NULL(a2), =(a1, a2))], select=[a1, b1], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+SortMergeJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithCastInSelectList">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithAgg">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1)*/T1.b1, cast(T1.a1 as int) from T1 join T2 on T1.b1 = T2.b2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ count(T2.a2) from T2 join T1 on T2.a2 = T1.a1 group by T1.a1)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b1=[$1], EXPR$1=[CAST($0):INTEGER])
-+- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(EXPR$0=[$1])
+  LogicalAggregate(group=[{0}], EXPR$0=[COUNT($1)])
+    LogicalProject(a1=[$2], a2=[$0])
+      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[b1, CAST(a1 AS INTEGER) AS EXPR$1])
-+- SortMergeJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2])
-   :- Exchange(distribution=[hash[b1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-   +- Exchange(distribution=[hash[b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, EXPR$0)], select=[a1, b1], build=[right], tryDistinctBuildRow=[true])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[EXPR$0]])
+   +- LocalHashAggregate(groupBy=[EXPR$0], select=[EXPR$0])
+      +- Calc(select=[EXPR$0])
+         +- SortAggregate(isMerge=[false], groupBy=[a1], select=[a1, COUNT(a2) AS EXPR$0])
+            +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1])
+               :- Exchange(distribution=[hash[a2]])
+               :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+               +- Exchange(distribution=[hash[a1]])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithDisabledOperator">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3 where T1.a1 = T2.a2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalFilter(condition=[=($cor0.a1, $0)])
+    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+      LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Calc(select=[a2])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
+      :- Exchange(distribution=[hash[a2]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+      +- Exchange(distribution=[hash[a3]])
+         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiAndLocalPred">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithProject">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 inner join T2 on T1.a1 = T2.a2 and T1.a1 < 1]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 + T1.a1 from T2 join T3 on T2.a2 = T3.a3)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[AND(=($0, $2), <($0, 1))], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(EXPR$0=[+($0, $cor0.a1)])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- Calc(select=[a2, b2], where=[<(a2, 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+            +- Exchange(distribution=[hash[EXPR$0, a1]])
+               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
+                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
+                        :- Calc(select=[a2])
+                        :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
+                        :     :- Exchange(distribution=[hash[a2]])
+                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                        :     +- Exchange(distribution=[hash[a3]])
+                        :        +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
+                        +- Exchange(distribution=[broadcast])
+                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
+                              +- Exchange(distribution=[hash[a1]])
+                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
+                                    +- Calc(select=[a1])
+                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiAndNonEquiPred">
+  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithSortLimit">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 inner join T2 on T1.b1 = T2.b2 and T1.a1 < 1 and T1.a1 < T2.a2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ T2.a2 from T2 join T1 on T2.a2 = T1.a1 order by T1.a1 limit 10)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[AND(=($1, $3), <($0, 1), <($0, $2))], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
+    LogicalProject(a2=[$0], a1=[$2])
+      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[AND(=(b1, b2), <(a1, a2))], select=[a1, b1, a2, b2])
-:- Exchange(distribution=[hash[b1]])
-:  +- Calc(select=[a1, b1], where=[<(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
-+- Exchange(distribution=[hash[b2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], isBroadcast=[true], build=[right])
+:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[a2])
+      +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[true])
+         +- Exchange(distribution=[single])
+            +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[false])
+               +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1])
+                  :- Exchange(distribution=[hash[a2]])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                  +- Exchange(distribution=[hash[a1]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiPred">
+  <TestCase name="testJoinHintWithJoinHintInNestedCorrelatedSubQuery">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1, T2 where T1.a1 = T2.a2]]>
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 + T1.a1 from T2 join (select T3.* from T2 join T3 on T2.a2 = T3.a3) T3 on T2.a2 = T3.a3)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[=($0, $2)])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(EXPR$0=[+($0, $cor0.a1)])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+    LogicalProject(a3=[$2], b3=[$3])
+      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+        LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1])
++- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+            +- Exchange(distribution=[hash[EXPR$0, a1]])
+               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
+                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
+                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
+                        :- Calc(select=[a2])
+                        :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
+                        :     :- Exchange(distribution=[hash[a2]])
+                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                        :     +- Calc(select=[a3])
+                        :        +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
+                        :           :- Exchange(distribution=[hash[a2]])
+                        :           :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+                        :           +- Exchange(distribution=[hash[a3]])
+                        :              +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
+                        +- Exchange(distribution=[broadcast])
+                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
+                              +- Exchange(distribution=[hash[a1]])
+                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
+                                    +- Calc(select=[a1])
+                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithJoinHintInSubQuery">
+    <Resource name="sql">
+      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Calc(select=[a2])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
+      :- Exchange(distribution=[hash[a2]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+      +- Exchange(distribution=[hash[a3]])
+         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithEquiPredAndFilter">
+  <TestCase name="testJoinHintWithLeftJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1, T2 where T1.a1 = T2.a2 and T1.a1 > 1]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 left join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalFilter(condition=[AND(=($0, $2), >($0, 1))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
-:  +- Calc(select=[a1, b1], where=[>(a1, 1)])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- Calc(select=[a2, b2], where=[>(a2, 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithFullJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithLeftJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 full join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 left join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -616,21 +585,21 @@ SortMergeJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithFullJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintWithMultiArgsAndLeftSideFirst">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 full join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[full], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1, T2]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -638,268 +607,209 @@ SortMergeJoin(joinType=[FullOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithAgg">
+  <TestCase name="testJoinHintWithMultiArgsAndRightSideFirst">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ count(T2.a2) from T2 join T1 on T2.a2 = T1.a1 group by T1.a1)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2, T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(EXPR$0=[$1])
-  LogicalAggregate(group=[{0}], EXPR$0=[COUNT($1)])
-    LogicalProject(a1=[$2], a2=[$0])
-      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2, T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, EXPR$0)], select=[a1, b1], build=[right], tryDistinctBuildRow=[true])
+SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[EXPR$0]])
-   +- LocalHashAggregate(groupBy=[EXPR$0], select=[EXPR$0])
-      +- Calc(select=[EXPR$0])
-         +- SortAggregate(isMerge=[false], groupBy=[a1], select=[a1, COUNT(a2) AS EXPR$0])
-            +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1])
-               :- Exchange(distribution=[hash[a2]])
-               :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-               +- Exchange(distribution=[hash[a1]])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithFilter">
+  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide1">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3 where T1.a1 = T2.a2)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalFilter(condition=[=($cor0.a1, $0)])
-    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-      LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1, T2]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T1, T2]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Calc(select=[a2])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
-      :- Exchange(distribution=[hash[a2]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-      +- Exchange(distribution=[hash[a3]])
-         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
+HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
+:- Exchange(distribution=[hash[b1]])
+:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithProject">
+  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide2">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 + T1.a1 from T2 join T3 on T2.a2 = T3.a3)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(EXPR$0=[+($0, $cor0.a1)])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1, T2]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T1, T2]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-            +- Exchange(distribution=[hash[EXPR$0, a1]])
-               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
-                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
-                        :- Calc(select=[a2])
-                        :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
-                        :     :- Exchange(distribution=[hash[a2]])
-                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                        :     +- Exchange(distribution=[hash[a3]])
-                        :        +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
-                        +- Exchange(distribution=[broadcast])
-                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
-                              +- Exchange(distribution=[hash[a1]])
-                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
-                                    +- Calc(select=[a1])
-                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
+:- Exchange(distribution=[hash[b2]])
+:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutJoinPred">
+  <TestCase name="testJoinHintWithMultiJoinAndFirstThirdSideAsBuildSides">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1, T2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T1, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+SortMergeJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3])
+:- Exchange(distribution=[hash[b2]])
+:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInCorrelateAndWithSortLimit">
+  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides1">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ T2.a2 from T2 join T1 on T2.a2 = T1.a1 order by T1.a1 limit 10)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
-    LogicalProject(a2=[$0], a1=[$2])
-      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-        LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T2, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T2, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], isBroadcast=[true], build=[right])
-:- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[a2])
-      +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[true])
-         +- Exchange(distribution=[single])
-            +- SortLimit(orderBy=[a1 ASC], offset=[0], fetch=[10], global=[false])
-               +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a1)], select=[a2, a1])
-                  :- Exchange(distribution=[hash[a2]])
-                  :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                  +- Exchange(distribution=[hash[a1]])
-                     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1], hints=[[[ALIAS options:[T1]]]])
+SortMergeJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3])
+:- Exchange(distribution=[hash[b1]])
+:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInNestedCorrelatedSubQuery">
-    <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 + T1.a1 from T2 join (select T3.* from T2 join T3 on T2.a2 = T3.a3) T3 on T2.a2 = T3.a3)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(EXPR$0=[+($0, $cor0.a1)])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-    LogicalProject(a3=[$2], b3=[$3])
-      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-        LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-        LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides2">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
++- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
+   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T2, T3]]]])
+      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T2, T3]]]])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], build=[left])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- HashAggregate(isMerge=[true], groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-            +- Exchange(distribution=[hash[EXPR$0, a1]])
-               +- LocalHashAggregate(groupBy=[EXPR$0, a1], select=[EXPR$0, a1])
-                  +- Calc(select=[+(a2, a1) AS EXPR$0, a1])
-                     +- NestedLoopJoin(joinType=[InnerJoin], where=[=(a1, +(a2, a1))], select=[a2, a1], build=[right])
-                        :- Calc(select=[a2])
-                        :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
-                        :     :- Exchange(distribution=[hash[a2]])
-                        :     :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                        :     +- Calc(select=[a3])
-                        :        +- HashJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3], build=[left])
-                        :           :- Exchange(distribution=[hash[a2]])
-                        :           :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-                        :           +- Exchange(distribution=[hash[a3]])
-                        :              +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
-                        +- Exchange(distribution=[broadcast])
-                           +- HashAggregate(isMerge=[true], groupBy=[a1], select=[a1])
-                              +- Exchange(distribution=[hash[a1]])
-                                 +- LocalHashAggregate(groupBy=[a1], select=[a1])
-                                    +- Calc(select=[a1])
-                                       +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+SortMergeJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3])
+:- Exchange(distribution=[hash[b2]])
+:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:     :- Exchange(distribution=[hash[a1]])
+:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:     +- Exchange(distribution=[hash[a2]])
+:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[b3]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithJoinHintInSubQuery">
+  <TestCase name="testJoinHintWithNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select * from T1 WHERE a1 IN (select /*+ ShUfFlE_MeRgE(T2) */ a2 from T2 join T3 on T2.a2 = T3.a3)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
+NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Calc(select=[a2])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a2, a3)], select=[a2, a3])
-      :- Exchange(distribution=[hash[a2]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-      +- Exchange(distribution=[hash[a3]])
-         +- TableSourceScan(table=[[default_catalog, default_database, T3, project=[a3], metadata=[]]], fields=[a3], hints=[[[ALIAS options:[T3]]]])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithLeftJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 left join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -907,21 +817,21 @@ SortMergeJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithLeftJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 left join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -929,191 +839,207 @@ SortMergeJoin(joinType=[LeftOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiArgsAndLeftSideFirst">
+  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1, T2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiArgsAndRightSideFirst">
+  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2, T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2, T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide1">
+  <TestCase name="testJoinHintWithSimpleSumInSelectList">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1, T2]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T1, T2]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
++- LogicalProject(b1=[$1], a1=[$0])
+   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
-:- Exchange(distribution=[hash[b1]])
-:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+SortAggregate(isMerge=[false], groupBy=[b1], select=[b1, SUM(a1) AS EXPR$1])
++- Calc(select=[b1, a1])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2])
+      :- Exchange(distribution=[hash[b1]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[hash[b2]])
+         +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndFirstSideAsBuildSide2">
+  <TestCase name="testJoinHintWithSubStringViewName1">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1, T2]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T1, T2]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V22]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3], build=[left])
-:- Exchange(distribution=[hash[b2]])
-:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+   :- Calc(select=[a1, b1])
+   :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+   :     :- Exchange(distribution=[hash[a1]])
+   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :     +- Calc(select=[a1])
+   :        +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
+   :           :- Exchange(distribution=[hash[a1]])
+   :           :  +- Calc(select=[a1])
+   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :           +- Exchange(distribution=[hash[a2]])
+   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndFirstThirdSideAsBuildSides">
+  <TestCase name="testJoinHintWithSubStringViewName2">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T1, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V2]]]])
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3])
-:- Exchange(distribution=[hash[b2]])
-:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+   :- Calc(select=[a1, b1])
+   :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+   :     :- Exchange(distribution=[hash[a1]])
+   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :     +- Calc(select=[a1])
+   :        +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
+   :           :- Exchange(distribution=[hash[a1]])
+   :           :  +- Calc(select=[a1])
+   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   :           +- Exchange(distribution=[hash[a2]])
+   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+   +- Exchange(distribution=[hash[a1]])
+      +- Calc(select=[a1])
+         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides1">
+  <TestCase name="testJoinHintWithTableAlias">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T1.b1 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($1, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T2, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T2, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(b1, b3)], select=[a1, b1, a2, b2, a3, b3])
-:- Exchange(distribution=[hash[b1]])
-:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+Calc(select=[a1, b1])
++- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- Calc(select=[a1])
+      +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
+         :- Exchange(distribution=[hash[a1]])
+         :  +- Calc(select=[a1])
+         :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+         +- Exchange(distribution=[hash[a2]])
+            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithMultiJoinAndSecondThirdSideAsBuildSides2">
+  <TestCase name="testJoinHintWithView">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2, T3) */* from T1, T2, T3 where T1.a1 = T2.a2 and T2.b2 = T3.b3]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5])
-+- LogicalFilter(condition=[AND(=($0, $2), =($3, $5))])
-   +- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T2, T3]]]])
-      :- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0, 0] options:[T2, T3]]]])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V4]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(b2, b3)], select=[a1, b1, a2, b2, a3, b3])
-:- Exchange(distribution=[hash[b2]])
-:  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
-:     :- Exchange(distribution=[hash[a1]])
-:     :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-:     +- Exchange(distribution=[hash[a2]])
-:        +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-+- Exchange(distribution=[hash[b3]])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3])
+:- Exchange(distribution=[hash[a1]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- Exchange(distribution=[hash[a3]])
    +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
@@ -1430,88 +1356,285 @@ SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithoutJoinPred">
+    <Resource name="sql">
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1, T2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[a1, b1, a2, b2], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
++- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[hash[a1]])
+         +- Calc(select=[a1], where=[>(a1, 2)])
+            +- Calc(select=[a1, b1])
+               +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2])
+                  :- Exchange(distribution=[hash[a1]])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+                  +- Exchange(distribution=[hash[a2]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Exchange(distribution=[hash[a1]])
+         +- Calc(select=[a1], where=[>(a1, 5)])
+            +- Calc(select=[a1, b1])
+               +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2])
+                  :- Exchange(distribution=[hash[a1]])
+                  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+                  +- Exchange(distribution=[hash[a2]])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 2)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[], project=[a1, b1], metadata=[]]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 5)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[], project=[a2], metadata=[]]], fields=[a2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 2)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[V2]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- LogicalProject(a1=[$0], b1=[$1])
+   +- LogicalFilter(condition=[>($2, 5)])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0, 0] options:[T1]]]])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]])
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.S1], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
+      :- Exchange(distribution=[hash[a1]])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 2)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
+            :- Exchange(distribution=[hash[a1]])
+            :  +- Calc(select=[a1], where=[>(a1, 2)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- Exchange(distribution=[hash[a2]])
+               +- Calc(select=[a2], where=[>(a2, 2)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+
+Sink(table=[default_catalog.default_database.S2], fields=[a1, b1])
++- Calc(select=[a1, b1])
+   +- HashJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10], isBroadcast=[true], build=[left])
+      :- Exchange(distribution=[broadcast])
+      :  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+      +- Calc(select=[a1])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], isBroadcast=[true], build=[left])
+            :- Exchange(distribution=[broadcast])
+            :  +- Calc(select=[a1], where=[>(a1, 5)])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+            +- Calc(select=[a2], where=[>(a2, 5)])
+               +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintsWithCalc">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
+Calc(select=[+(a1, 1) AS EXPR$0, *(a1, 10) AS EXPR$1])
++- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1], metadata=[]]], fields=[a1])
+   +- Exchange(distribution=[hash[a2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithNonEquiPred">
+  <TestCase name="testJoinHintsWithDuplicatedArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[>(a1, a2)], select=[a1, b1, a2, b2], build=[left])
-:- Exchange(distribution=[broadcast])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+:- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
++- Exchange(distribution=[hash[a2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintsWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalFilter(condition=[>($0, 5)])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+:  +- Calc(select=[a1, b1], where=[>(a1, 5)])
+:     +- TableSourceScan(table=[[default_catalog, default_database, T1, filter=[]]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+   +- Calc(select=[a2, b2], where=[>(a2, 5)])
+      +- TableSourceScan(table=[[default_catalog, default_database, T2, filter=[]]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1, T2), SHUFFLE_MERGE(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1, T2]][SHUFFLE_MERGE inheritPath:[0] options:[T2, T1]]]])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
@@ -1519,130 +1642,61 @@ SortMergeJoin(joinType=[RightOuterJoin], where=[=(a1, a2)], select=[a1, b1, a2,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T2) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1), SHUFFLE_MERGE(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]][SHUFFLE_MERGE inheritPath:[0] options:[T2]]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(a1, a2)], select=[a1, b1], build=[right])
+SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :- Exchange(distribution=[hash[a1]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2], hints=[[[ALIAS options:[T2]]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSimpleSumInSelectList">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-+- LogicalProject(b1=[$1], a1=[$0])
-   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0, 0] options:[T1]]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-SortAggregate(isMerge=[false], groupBy=[b1], select=[b1, SUM(a1) AS EXPR$1])
-+- Calc(select=[b1, a1])
-   +- SortMergeJoin(joinType=[InnerJoin], where=[=(b1, b2)], select=[a1, b1, b2])
-      :- Exchange(distribution=[hash[b1]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-      +- Exchange(distribution=[hash[b2]])
-         +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[b2], metadata=[]]], fields=[b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName1">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V22]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V2]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-   :- Calc(select=[a1, b1])
-   :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-   :     :- Exchange(distribution=[hash[a1]])
-   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :     +- Calc(select=[a1])
-   :        +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
-   :           :- Exchange(distribution=[hash[a1]])
-   :           :  +- Calc(select=[a1])
-   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :           +- Exchange(distribution=[hash[a2]])
-   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName2">
+  <TestCase name="testJoinHintsWithUnion">
     <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+      <![CDATA[select /*+ SHUFFLE_MERGE(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ SHUFFLE_MERGE(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V2]]]])
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V22]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]])
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]])
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+LogicalUnion(all=[false])
+:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3])
+:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T1]]]])
+:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
++- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[T3]]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a1, b1])
-+- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-   :- Calc(select=[a1, b1])
-   :  +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-   :     :- Exchange(distribution=[hash[a1]])
-   :     :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :     +- Calc(select=[a1])
-   :        +- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2])
-   :           :- Exchange(distribution=[hash[a1]])
-   :           :  +- Calc(select=[a1])
-   :           :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   :           +- Exchange(distribution=[hash[a2]])
-   :              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-   +- Exchange(distribution=[hash[a1]])
-      +- Calc(select=[a1])
-         +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
+HashAggregate(isMerge=[true], groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
++- Exchange(distribution=[hash[a1, b1, a2, b2]])
+   +- LocalHashAggregate(groupBy=[a1, b1, a2, b2], select=[a1, b1, a2, b2])
+      +- Union(all=[true], union=[a1, b1, a2, b2])
+         :- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
+         :  :- Exchange(distribution=[hash[a1]])
+         :  :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
+         :  +- Exchange(distribution=[hash[a2]])
+         :     +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
+         +- SortMergeJoin(joinType=[InnerJoin], where=[=(a3, a1)], select=[a3, b3, a1, b1])
+            :- Exchange(distribution=[hash[a3]])
+            :  +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
+            +- Exchange(distribution=[hash[a1]])
+               +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1665,60 +1719,6 @@ SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, b1, a2, b2])
 :  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
 +- Exchange(distribution=[hash[a2]])
    +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a2, b2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithTableAlias">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V2]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1])
-+- SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a10)], select=[a1, b1, a10])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-   +- Calc(select=[a1])
-      +- HashJoin(joinType=[InnerJoin], where=[=(a1, a2)], select=[a1, a2], build=[left])
-         :- Exchange(distribution=[hash[a1]])
-         :  +- Calc(select=[a1])
-         :     +- TableSourceScan(table=[[default_catalog, default_database, T1, project=[a1, b1], metadata=[]]], fields=[a1, b1])
-         +- Exchange(distribution=[hash[a2]])
-            +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[a2], metadata=[]]], fields=[a2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithView">
-    <Resource name="sql">
-      <![CDATA[select /*+ SHUFFLE_MERGE(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_MERGE inheritPath:[0] options:[V4]]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-SortMergeJoin(joinType=[InnerJoin], where=[=(a1, a3)], select=[a1, b1, a3, b3])
-:- Exchange(distribution=[hash[a1]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[a1, b1])
-+- Exchange(distribution=[hash[a3]])
-   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[a3, b3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/stream/StateTtlHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/stream/StateTtlHintTest.xml
index 8b1a70096f7..91f28026eae 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/stream/StateTtlHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hints/stream/StateTtlHintTest.xml
@@ -494,15 +494,15 @@ GroupAggregate(groupBy=[b1], select=[b1, SUM(a1) AS EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testWatermarkAssigner">
-		<Resource name="sql">
-			<![CDATA[
+  <TestCase name="testWatermarkAssigner">
+    <Resource name="sql">
+      <![CDATA[
 SELECT /*+ STATE_TTL('tableWithWatermark1'='1d', 'tww2' = '3d') */ tableWithWatermark1.* FROM tableWithWatermark1
 LEFT JOIN(SELECT DISTINCT b FROM tableWithWatermark2) tww2
 ON tableWithWatermark1.b = tww2.b WHERE tww2.b IS NOT NULL]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[IS NOT NULL($3)])
    +- LogicalJoin(condition=[=($1, $3)], joinType=[left], stateTtlHints=[[[STATE_TTL inheritPath:[0, 0] options:{tww2=3d, tableWithWatermark1=1d}]]])
@@ -514,9 +514,9 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
                +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2.c1, 5000:INTERVAL SECOND)])
                   +- LogicalTableScan(table=[[default_catalog, default_database, tableWithWatermark2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c])
 +- Join(joinType=[InnerJoin], where=[=(b, b0)], select=[a, b, c, b0], leftInputSpec=[NoUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey], stateTtlHints=[[[STATE_TTL options:{LEFT=1d, RIGHT=3d}]]])
    :- Exchange(distribution=[hash[b]])
@@ -531,17 +531,17 @@ Calc(select=[a, b, c])
                   +- Calc(select=[b, +(c.c1, 5000:INTERVAL SECOND) AS d])
                      +- TableSourceScan(table=[[default_catalog, default_database, tableWithWatermark2, project=[b, c], metadata=[]]], fields=[b, c])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
   <TestCase name="testWatermarkAssignerWithAliases">
-		<Resource name="sql">
-			<![CDATA[
+    <Resource name="sql">
+      <![CDATA[
 SELECT /*+ STATE_TTL('tww1'='1d', 'tww2' = '3d') */ tww1.* FROM tableWithWatermark1 tww1
 LEFT JOIN(SELECT DISTINCT b FROM tableWithWatermark2) tww2
 ON tww1.b = tww2.b WHERE tww2.b IS NOT NULL]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[IS NOT NULL($3)])
    +- LogicalJoin(condition=[=($1, $3)], joinType=[left], stateTtlHints=[[[STATE_TTL inheritPath:[0, 0] options:{tww2=3d, tww1=1d}]]])
@@ -553,9 +553,9 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
                +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2.c1, 5000:INTERVAL SECOND)])
                   +- LogicalTableScan(table=[[default_catalog, default_database, tableWithWatermark2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c])
 +- Join(joinType=[InnerJoin], where=[=(b, b0)], select=[a, b, c, b0], leftInputSpec=[NoUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey], stateTtlHints=[[[STATE_TTL options:{LEFT=1d, RIGHT=3d}]]])
    :- Exchange(distribution=[hash[b]])
@@ -570,6 +570,6 @@ Calc(select=[a, b, c])
                   +- Calc(select=[b, +(c.c1, 5000:INTERVAL SECOND) AS d])
                      +- TableSourceScan(table=[[default_catalog, default_database, tableWithWatermark2, project=[b, c], metadata=[]]], fields=[b, c])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml
index 38dfcb0ed78..4d9a3dd5b90 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml
@@ -190,7 +190,7 @@ Calc(select=[EXPR$0 AS s])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=true]">
+  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
@@ -217,15 +217,15 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "HashWindowAggregate[]",
+    "type" : "LocalHashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Partial_COUNT(*) AS count1$0])",
     "pact" : "Operator",
-    "contents" : "[]:LocalHashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Partial_COUNT(*) AS count1$0])",
+    "contents" : "LocalHashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Partial_COUNT(*) AS count1$0])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -234,9 +234,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "HashWindowAggregate[]",
+    "type" : "HashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Final_COUNT(count1$0) AS EXPR$2])",
     "pact" : "Operator",
-    "contents" : "[]:HashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Final_COUNT(count1$0) AS EXPR$2])",
+    "contents" : "HashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Final_COUNT(count1$0) AS EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -245,9 +245,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "contents" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -258,7 +258,7 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=false]">
+  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
@@ -285,15 +285,15 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "LocalHashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Partial_COUNT(*) AS count1$0])",
+    "type" : "HashWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "LocalHashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Partial_COUNT(*) AS count1$0])",
+    "contents" : "[]:LocalHashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Partial_COUNT(*) AS count1$0])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -302,9 +302,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "HashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Final_COUNT(count1$0) AS EXPR$2])",
+    "type" : "HashWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "HashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Final_COUNT(count1$0) AS EXPR$2])",
+    "contents" : "[]:HashWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, Final_COUNT(count1$0) AS EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -313,9 +313,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "contents" : "[]:Calc(select=[b, w$end AS window_end, EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -597,126 +597,6 @@ HashJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, a0, b0, c0,
       "side" : "second"
     } ]
   } ]
-}]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLegacySourceSink[isNameSimplifyEnabled=false]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalLegacySink(name=[`default_catalog`.`default_database`.`MySink`], fields=[name, id, amount, price])
-+- LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MySource, source: [filterPushedDown=[false], filter=[]]]])
-
-== Optimized Physical Plan ==
-LegacySink(name=[`default_catalog`.`default_database`.`MySink`], fields=[name, id, amount, price])
-+- LegacyTableSourceScan(table=[[default_catalog, default_database, MySource, source: [filterPushedDown=[false], filter=[]]]], fields=[name, id, amount, price])
-
-== Optimized Execution Plan ==
-LegacySink(name=[`default_catalog`.`default_database`.`MySink`], fields=[name, id, amount, price])
-+- LegacyTableSourceScan(table=[[default_catalog, default_database, MySource, source: [filterPushedDown=[false], filter=[]]]], fields=[name, id, amount, price])
-
-== Physical Execution Plan ==
-{
-  "nodes" : [ {
-    "id" : ,
-    "type" : "Source: Collection Source",
-    "pact" : "Data Source",
-    "contents" : "Source: Collection Source",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "SourceConversion(table=[default_catalog.default_database.MySource, source: [filterPushedDown=[false], filter=[]]], fields=[name, id, amount, price])",
-    "pact" : "Operator",
-    "contents" : "SourceConversion(table=[default_catalog.default_database.MySource, source: [filterPushedDown=[false], filter=[]]], fields=[name, id, amount, price])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "SinkConversion To Row",
-    "pact" : "Operator",
-    "contents" : "SinkConversion To Row",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Sink: collect",
-    "pact" : "Data Sink",
-    "contents" : "Sink: collect",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  } ]
-}]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLegacySourceSink[isNameSimplifyEnabled=true]">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalLegacySink(name=[`default_catalog`.`default_database`.`MySink`], fields=[name, id, amount, price])
-+- LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MySource, source: [filterPushedDown=[false], filter=[]]]])
-
-== Optimized Physical Plan ==
-LegacySink(name=[`default_catalog`.`default_database`.`MySink`], fields=[name, id, amount, price])
-+- LegacyTableSourceScan(table=[[default_catalog, default_database, MySource, source: [filterPushedDown=[false], filter=[]]]], fields=[name, id, amount, price])
-
-== Optimized Execution Plan ==
-LegacySink(name=[`default_catalog`.`default_database`.`MySink`], fields=[name, id, amount, price])
-+- LegacyTableSourceScan(table=[[default_catalog, default_database, MySource, source: [filterPushedDown=[false], filter=[]]]], fields=[name, id, amount, price])
-
-== Physical Execution Plan ==
-{
-  "nodes" : [ {
-    "id" : ,
-    "type" : "Source: Collection Source",
-    "pact" : "Data Source",
-    "contents" : "Source: Collection Source",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "SourceConversion[]",
-    "pact" : "Operator",
-    "contents" : "[]:SourceConversion(table=[default_catalog.default_database.MySource, source: [filterPushedDown=[false], filter=[]]], fields=[name, id, amount, price])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "SinkConversion[]",
-    "pact" : "Operator",
-    "contents" : "[]:SinkConversion To Row",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Sink: collect",
-    "pact" : "Data Sink",
-    "contents" : "Sink: collect",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  } ]
 }]]>
     </Resource>
   </TestCase>
@@ -1458,7 +1338,7 @@ Calc(select=[b, w0$o0 AS $1])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRank[isNameSimplifyEnabled=true]">
+  <TestCase name="testRank[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], row_num=[$1])
@@ -1485,15 +1365,15 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[]]], fields=[a, b])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[]]], fields=[a, b])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[]]], fields=[a, b])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Sort[]",
+    "type" : "Sort(orderBy=[b ASC, a ASC])",
     "pact" : "Operator",
-    "contents" : "[]:Sort(orderBy=[b ASC, a ASC])",
+    "contents" : "Sort(orderBy=[b ASC, a ASC])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -1502,9 +1382,9 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
     } ]
   }, {
     "id" : ,
-    "type" : "OverAggregate[]",
+    "type" : "OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[ROW_NUMBER(*) AS w0$o0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o0])",
     "pact" : "Operator",
-    "contents" : "[]:OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[ROW_NUMBER(*) AS w0$o0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o0])",
+    "contents" : "OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[ROW_NUMBER(*) AS w0$o0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -1513,9 +1393,9 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])",
+    "contents" : "Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -1526,7 +1406,7 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRank[isNameSimplifyEnabled=false]">
+  <TestCase name="testRank[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], row_num=[$1])
@@ -1553,15 +1433,15 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[]]], fields=[a, b])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[]]], fields=[a, b])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[]]], fields=[a, b])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Sort(orderBy=[b ASC, a ASC])",
+    "type" : "Sort[]",
     "pact" : "Operator",
-    "contents" : "Sort(orderBy=[b ASC, a ASC])",
+    "contents" : "[]:Sort(orderBy=[b ASC, a ASC])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -1570,9 +1450,9 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
     } ]
   }, {
     "id" : ,
-    "type" : "OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[ROW_NUMBER(*) AS w0$o0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o0])",
+    "type" : "OverAggregate[]",
     "pact" : "Operator",
-    "contents" : "OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[ROW_NUMBER(*) AS w0$o0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o0])",
+    "contents" : "[]:OverAggregate(partitionBy=[b], orderBy=[a ASC], window#0=[ROW_NUMBER(*) AS w0$o0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, w0$o0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -1581,9 +1461,9 @@ Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])",
+    "contents" : "[]:Calc(select=[a, w0$o0], where=[(w0$o0 <= a)])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2086,7 +1966,7 @@ SortMergeJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, a0, b0
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortWindowAggregate[isNameSimplifyEnabled=true]">
+  <TestCase name="testSortWindowAggregate[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
@@ -2114,15 +1994,15 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime, a], metadata=[]]], fields=[b, rowtime, a])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime, a], metadata=[]]], fields=[b, rowtime, a])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime, a], metadata=[]]], fields=[b, rowtime, a])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Sort[]",
+    "type" : "Sort(orderBy=[b ASC, rowtime ASC])",
     "pact" : "Operator",
-    "contents" : "[]:Sort(orderBy=[b ASC, rowtime ASC])",
+    "contents" : "Sort(orderBy=[b ASC, rowtime ASC])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2131,9 +2011,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "SortWindowAggregate[]",
+    "type" : "SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, FIRST_VALUE(a) AS EXPR$2])",
     "pact" : "Operator",
-    "contents" : "[]:SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, FIRST_VALUE(a) AS EXPR$2])",
+    "contents" : "SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, FIRST_VALUE(a) AS EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2142,9 +2022,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "contents" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2155,7 +2035,7 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortWindowAggregate[isNameSimplifyEnabled=false]">
+  <TestCase name="testSortWindowAggregate[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
@@ -2183,15 +2063,15 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime, a], metadata=[]]], fields=[b, rowtime, a])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime, a], metadata=[]]], fields=[b, rowtime, a])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime, a], metadata=[]]], fields=[b, rowtime, a])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Sort(orderBy=[b ASC, rowtime ASC])",
+    "type" : "Sort[]",
     "pact" : "Operator",
-    "contents" : "Sort(orderBy=[b ASC, rowtime ASC])",
+    "contents" : "[]:Sort(orderBy=[b ASC, rowtime ASC])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2200,9 +2080,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, FIRST_VALUE(a) AS EXPR$2])",
+    "type" : "SortWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, FIRST_VALUE(a) AS EXPR$2])",
+    "contents" : "[]:SortWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime], select=[b, FIRST_VALUE(a) AS EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2211,9 +2091,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "contents" : "[]:Calc(select=[b, w$end AS window_end, EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml
index a73bb76ff9e..2882c804d80 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml
@@ -664,7 +664,7 @@ GroupAggregate(groupBy=[a], select=[a, MAX(b) AS b])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=true]">
+  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
@@ -692,15 +692,15 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner[]",
+    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "pact" : "Operator",
-    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -709,9 +709,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "GroupWindowAggregate[]",
+    "type" : "GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[b, COUNT(*) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])",
     "pact" : "Operator",
-    "contents" : "[]:GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[b, COUNT(*) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])",
+    "contents" : "GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[b, COUNT(*) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -720,9 +720,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "contents" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -733,7 +733,7 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=false]">
+  <TestCase name="testGroupWindowAggregate[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
@@ -761,15 +761,15 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, rowtime], metadata=[]]], fields=[b, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "type" : "WatermarkAssigner[]",
     "pact" : "Operator",
-    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -778,9 +778,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[b, COUNT(*) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])",
+    "type" : "GroupWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[b, COUNT(*) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])",
+    "contents" : "[]:GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[b, COUNT(*) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -789,9 +789,9 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[b, w$end AS window_end, EXPR$2])",
+    "contents" : "[]:Calc(select=[b, w$end AS window_end, EXPR$2])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -990,11 +990,11 @@ GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(cou
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIntervalJoin[isNameSimplifyEnabled=false]">
+  <TestCase name="testIntervalJoinNegativeWindow[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$7])
-+- LogicalJoin(condition=[AND(=($0, $6), >=($5, -($11, 3600000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[inner])
++- LogicalJoin(condition=[AND(=($0, $6), >=($5, +($11, 7200000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[left])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
    :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, A]])
@@ -1004,7 +1004,7 @@ LogicalProject(a=[$0], b=[$7])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, -(proctime0, 3600000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, +(proctime0, 7200000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
@@ -1018,7 +1018,7 @@ Calc(select=[a, b])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 + 7200000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])
@@ -1112,15 +1112,22 @@ Calc(select=[a, b])
     } ]
   }, {
     "id" : ,
-    "type" : "IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])",
+    "type" : "filter all right input transformation",
     "pact" : "Operator",
-    "contents" : "IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])",
+    "contents" : "filter all right input transformation",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
-    }, {
+    } ]
+  }, {
+    "id" : ,
+    "type" : "pad left input transformation",
+    "pact" : "Operator",
+    "contents" : "pad left input transformation",
+    "parallelism" : 2,
+    "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
@@ -1135,16 +1142,20 @@ Calc(select=[a, b])
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIntervalJoin[isNameSimplifyEnabled=true]">
+  <TestCase name="testIntervalJoinNegativeWindow[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$7])
-+- LogicalJoin(condition=[AND(=($0, $6), >=($5, -($11, 3600000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[inner])
++- LogicalJoin(condition=[AND(=($0, $6), >=($5, +($11, 7200000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[left])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
    :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, A]])
@@ -1154,7 +1165,7 @@ LogicalProject(a=[$0], b=[$7])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, -(proctime0, 3600000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, +(proctime0, 7200000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
@@ -1168,7 +1179,7 @@ Calc(select=[a, b])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 + 7200000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])
@@ -1262,15 +1273,22 @@ Calc(select=[a, b])
     } ]
   }, {
     "id" : ,
-    "type" : "IntervalJoin[]",
+    "type" : "FilterRight[]",
     "pact" : "Operator",
-    "contents" : "[]:IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])",
+    "contents" : "[]:filter all right input transformation",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
-    }, {
+    } ]
+  }, {
+    "id" : ,
+    "type" : "PadLeft[]",
+    "pact" : "Operator",
+    "contents" : "[]:pad left input transformation",
+    "parallelism" : 2,
+    "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
@@ -1285,16 +1303,20 @@ Calc(select=[a, b])
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
+    }, {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIntervalJoinNegativeWindow[isNameSimplifyEnabled=false]">
+  <TestCase name="testIntervalJoin[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$7])
-+- LogicalJoin(condition=[AND(=($0, $6), >=($5, +($11, 7200000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[left])
++- LogicalJoin(condition=[AND(=($0, $6), >=($5, -($11, 3600000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[inner])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
    :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, A]])
@@ -1304,7 +1326,7 @@ LogicalProject(a=[$0], b=[$7])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, +(proctime0, 7200000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, -(proctime0, 3600000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
@@ -1318,7 +1340,7 @@ Calc(select=[a, b])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 + 7200000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])
@@ -1412,22 +1434,15 @@ Calc(select=[a, b])
     } ]
   }, {
     "id" : ,
-    "type" : "filter all right input transformation",
+    "type" : "IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])",
     "pact" : "Operator",
-    "contents" : "filter all right input transformation",
+    "contents" : "IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "pad left input transformation",
-    "pact" : "Operator",
-    "contents" : "pad left input transformation",
-    "parallelism" : 2,
-    "predecessors" : [ {
+    }, {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
@@ -1442,20 +1457,16 @@ Calc(select=[a, b])
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIntervalJoinNegativeWindow[isNameSimplifyEnabled=true]">
+  <TestCase name="testIntervalJoin[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], b=[$7])
-+- LogicalJoin(condition=[AND(=($0, $6), >=($5, +($11, 7200000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[left])
++- LogicalJoin(condition=[AND(=($0, $6), >=($5, -($11, 3600000:INTERVAL HOUR)), <=($5, +($11, 3600000:INTERVAL HOUR)))], joinType=[inner])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
    :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, A]])
@@ -1465,7 +1476,7 @@ LogicalProject(a=[$0], b=[$7])
 
 == Optimized Physical Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, +(proctime0, 7200000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[AND(=(a, a0), >=(proctime, -(proctime0, 3600000:INTERVAL HOUR)), <=(proctime, +(proctime0, 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
@@ -1479,7 +1490,7 @@ Calc(select=[a, b])
 
 == Optimized Execution Plan ==
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=7200000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 + 7200000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])
@@ -1573,22 +1584,15 @@ Calc(select=[a, b])
     } ]
   }, {
     "id" : ,
-    "type" : "FilterRight[]",
+    "type" : "IntervalJoin[]",
     "pact" : "Operator",
-    "contents" : "[]:filter all right input transformation",
+    "contents" : "[]:IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "PadLeft[]",
-    "pact" : "Operator",
-    "contents" : "[]:pad left input transformation",
-    "parallelism" : 2,
-    "predecessors" : [ {
+    }, {
       "id" : ,
       "ship_strategy" : "HASH",
       "side" : "second"
@@ -1603,10 +1607,6 @@ Calc(select=[a, b])
       "id" : ,
       "ship_strategy" : "FORWARD",
       "side" : "second"
-    }, {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
     } ]
   } ]
 }]]>
@@ -2350,7 +2350,7 @@ Calc(select=[b, w0$o0 AS $1])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRank[isNameSimplifyEnabled=true]">
+  <TestCase name="testRank[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], row_num=[$1])
@@ -2376,15 +2376,15 @@ Calc(select=[a, w0$o0])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, b])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b])",
+    "contents" : "Calc(select=[a, b])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -2393,9 +2393,9 @@ Calc(select=[a, w0$o0])
     } ]
   }, {
     "id" : ,
-    "type" : "Rank[]",
+    "type" : "Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankEnd=a], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])",
     "pact" : "Operator",
-    "contents" : "[]:Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankEnd=a], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])",
+    "contents" : "Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankEnd=a], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2404,9 +2404,9 @@ Calc(select=[a, w0$o0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, w0$o0])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, w0$o0])",
+    "contents" : "Calc(select=[a, w0$o0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2417,7 +2417,7 @@ Calc(select=[a, w0$o0])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRank[isNameSimplifyEnabled=false]">
+  <TestCase name="testRank[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], row_num=[$1])
@@ -2443,15 +2443,15 @@ Calc(select=[a, w0$o0])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, b])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, b])",
+    "contents" : "[]:Calc(select=[a, b])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -2460,9 +2460,9 @@ Calc(select=[a, w0$o0])
     } ]
   }, {
     "id" : ,
-    "type" : "Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankEnd=a], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])",
+    "type" : "Rank[]",
     "pact" : "Operator",
-    "contents" : "Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankEnd=a], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])",
+    "contents" : "[]:Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankEnd=a], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -2471,9 +2471,9 @@ Calc(select=[a, w0$o0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, w0$o0])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, w0$o0])",
+    "contents" : "[]:Calc(select=[a, w0$o0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3250,7 +3250,7 @@ Calc(select=[b, window_start, window_end, EXPR$3, EXPR$4])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowDeduplicate[isNameSimplifyEnabled=true]">
+  <TestCase name="testWindowDeduplicate[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(window_start=[$6], window_end=[$7], a=[$0], b=[$1], c=[$2])
@@ -3286,15 +3286,15 @@ Calc(select=[window_start, window_end, a, b, c])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
+    "contents" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3303,9 +3303,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner[]",
+    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "pact" : "Operator",
-    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3314,9 +3314,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowTableFunction[]",
+    "type" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
     "pact" : "Operator",
-    "contents" : "[]:WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
+    "contents" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3325,9 +3325,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, b, c, rowtime, window_start, window_end])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b, c, rowtime, window_start, window_end])",
+    "contents" : "Calc(select=[a, b, c, rowtime, window_start, window_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3336,9 +3336,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowDeduplicate[]",
+    "type" : "WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])",
     "pact" : "Operator",
-    "contents" : "[]:WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])",
+    "contents" : "WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3347,9 +3347,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[window_start, window_end, a, b, c])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[window_start, window_end, a, b, c])",
+    "contents" : "Calc(select=[window_start, window_end, a, b, c])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3360,7 +3360,7 @@ Calc(select=[window_start, window_end, a, b, c])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowDeduplicate[isNameSimplifyEnabled=false]">
+  <TestCase name="testWindowDeduplicate[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(window_start=[$6], window_end=[$7], a=[$0], b=[$1], c=[$2])
@@ -3396,15 +3396,15 @@ Calc(select=[window_start, window_end, a, b, c])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
+    "contents" : "[]:Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3413,9 +3413,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "type" : "WatermarkAssigner[]",
     "pact" : "Operator",
-    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3424,9 +3424,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
+    "type" : "WindowTableFunction[]",
     "pact" : "Operator",
-    "contents" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
+    "contents" : "[]:WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3435,9 +3435,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, b, c, rowtime, window_start, window_end])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, b, c, rowtime, window_start, window_end])",
+    "contents" : "[]:Calc(select=[a, b, c, rowtime, window_start, window_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3446,9 +3446,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])",
+    "type" : "WindowDeduplicate[]",
     "pact" : "Operator",
-    "contents" : "WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])",
+    "contents" : "[]:WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3457,9 +3457,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[window_start, window_end, a, b, c])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[window_start, window_end, a, b, c])",
+    "contents" : "[]:Calc(select=[window_start, window_end, a, b, c])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3470,7 +3470,7 @@ Calc(select=[window_start, window_end, a, b, c])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowJoin[isNameSimplifyEnabled=true]">
+  <TestCase name="testWindowJoin[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], window_start=[$1], window_end=[$2], cnt=[$3], uv=[$4], a0=[$5], cnt0=[$8], uv0=[$9])
@@ -3532,15 +3532,15 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner[]",
+    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "pact" : "Operator",
-    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3549,9 +3549,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "LocalWindowAggregate[]",
+    "type" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
     "pact" : "Operator",
-    "contents" : "[]:LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
+    "contents" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3560,9 +3560,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "GlobalWindowAggregate[]",
+    "type" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
     "pact" : "Operator",
-    "contents" : "[]:GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
+    "contents" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3571,9 +3571,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, window_start, window_end, cnt, uv])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, window_start, window_end, cnt, uv])",
+    "contents" : "Calc(select=[a, window_start, window_end, cnt, uv])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3582,15 +3582,15 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Source: MyTable2[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner[]",
+    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "pact" : "Operator",
-    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3599,9 +3599,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "LocalWindowAggregate[]",
+    "type" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
     "pact" : "Operator",
-    "contents" : "[]:LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
+    "contents" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3610,9 +3610,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "GlobalWindowAggregate[]",
+    "type" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
     "pact" : "Operator",
-    "contents" : "[]:GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
+    "contents" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3621,9 +3621,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, window_start, window_end, cnt, uv])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, window_start, window_end, cnt, uv])",
+    "contents" : "Calc(select=[a, window_start, window_end, cnt, uv])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3632,9 +3632,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowJoin[]",
+    "type" : "WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[(a = a0)], select=[a, window_start, window_end, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])",
     "pact" : "Operator",
-    "contents" : "[]:WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[(a = a0)], select=[a, window_start, window_end, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])",
+    "contents" : "WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[(a = a0)], select=[a, window_start, window_end, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3647,9 +3647,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])",
+    "contents" : "Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3660,7 +3660,7 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowJoin[isNameSimplifyEnabled=false]">
+  <TestCase name="testWindowJoin[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a=[$0], window_start=[$1], window_end=[$2], cnt=[$3], uv=[$4], a0=[$5], cnt0=[$8], uv0=[$9])
@@ -3722,15 +3722,15 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "type" : "WatermarkAssigner[]",
     "pact" : "Operator",
-    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3739,9 +3739,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
+    "type" : "LocalWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
+    "contents" : "[]:LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3750,9 +3750,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
+    "type" : "GlobalWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
+    "contents" : "[]:GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3761,9 +3761,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, window_start, window_end, cnt, uv])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, window_start, window_end, cnt, uv])",
+    "contents" : "[]:Calc(select=[a, window_start, window_end, cnt, uv])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3772,15 +3772,15 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
+    "type" : "Source: MyTable2[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "type" : "WatermarkAssigner[]",
     "pact" : "Operator",
-    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3789,9 +3789,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
+    "type" : "LocalWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
+    "contents" : "[]:LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3800,9 +3800,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
+    "type" : "GlobalWindowAggregate[]",
     "pact" : "Operator",
-    "contents" : "GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
+    "contents" : "[]:GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3811,9 +3811,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, window_start, window_end, cnt, uv])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, window_start, window_end, cnt, uv])",
+    "contents" : "[]:Calc(select=[a, window_start, window_end, cnt, uv])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3822,9 +3822,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[(a = a0)], select=[a, window_start, window_end, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])",
+    "type" : "WindowJoin[]",
     "pact" : "Operator",
-    "contents" : "WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[(a = a0)], select=[a, window_start, window_end, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])",
+    "contents" : "[]:WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[(a = a0)], select=[a, window_start, window_end, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3837,9 +3837,9 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])",
+    "contents" : "[]:Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3850,7 +3850,7 @@ Calc(select=[a, window_start, window_end, cnt, uv, a0, cnt0, uv0])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowRank[isNameSimplifyEnabled=true]">
+  <TestCase name="testWindowRank[isNameSimplifyEnabled=false]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(window_start=[$6], window_end=[$7], a=[$0], b=[$1], c=[$2])
@@ -3886,15 +3886,15 @@ Calc(select=[window_start, window_end, a, b, c])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: MyTable[]",
+    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
     "pact" : "Data Source",
-    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
+    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
+    "contents" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3903,9 +3903,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner[]",
+    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "pact" : "Operator",
-    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3914,9 +3914,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowTableFunction[]",
+    "type" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
     "pact" : "Operator",
-    "contents" : "[]:WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
+    "contents" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3925,9 +3925,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[a, b, c, window_start, window_end])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, b, c, window_start, window_end])",
+    "contents" : "Calc(select=[a, b, c, window_start, window_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -3936,9 +3936,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowRank[]",
+    "type" : "WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, window_start, window_end])",
     "pact" : "Operator",
-    "contents" : "[]:WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, window_start, window_end])",
+    "contents" : "WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, window_start, window_end])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3947,9 +3947,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc[]",
+    "type" : "Calc(select=[window_start, window_end, a, b, c])",
     "pact" : "Operator",
-    "contents" : "[]:Calc(select=[window_start, window_end, a, b, c])",
+    "contents" : "Calc(select=[window_start, window_end, a, b, c])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -3960,7 +3960,7 @@ Calc(select=[window_start, window_end, a, b, c])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowRank[isNameSimplifyEnabled=false]">
+  <TestCase name="testWindowRank[isNameSimplifyEnabled=true]">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(window_start=[$6], window_end=[$7], a=[$0], b=[$1], c=[$2])
@@ -3996,15 +3996,15 @@ Calc(select=[window_start, window_end, a, b, c])
 {
   "nodes" : [ {
     "id" : ,
-    "type" : "Source: TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
+    "type" : "Source: MyTable[]",
     "pact" : "Data Source",
-    "contents" : "TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
+    "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])",
     "parallelism" : 1
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
+    "contents" : "[]:Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -4013,9 +4013,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "type" : "WatermarkAssigner[]",
     "pact" : "Operator",
-    "contents" : "WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
+    "contents" : "[]:WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -4024,9 +4024,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
+    "type" : "WindowTableFunction[]",
     "pact" : "Operator",
-    "contents" : "WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
+    "contents" : "[]:WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -4035,9 +4035,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[a, b, c, window_start, window_end])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[a, b, c, window_start, window_end])",
+    "contents" : "[]:Calc(select=[a, b, c, window_start, window_end])",
     "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
@@ -4046,9 +4046,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, window_start, window_end])",
+    "type" : "WindowRank[]",
     "pact" : "Operator",
-    "contents" : "WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, window_start, window_end])",
+    "contents" : "[]:WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, window_start, window_end])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
@@ -4057,9 +4057,9 @@ Calc(select=[window_start, window_end, a, b, c])
     } ]
   }, {
     "id" : ,
-    "type" : "Calc(select=[window_start, window_end, a, b, c])",
+    "type" : "Calc[]",
     "pact" : "Operator",
-    "contents" : "Calc(select=[window_start, window_end, a, b, c])",
+    "contents" : "[]:Calc(select=[window_start, window_end, a, b, c])",
     "parallelism" : 2,
     "predecessors" : [ {
       "id" : ,
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ClearQueryBlockAliasResolverTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ClearQueryBlockAliasResolverTest.xml
index 8ef3786d426..693f5948a69 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ClearQueryBlockAliasResolverTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ClearQueryBlockAliasResolverTest.xml
@@ -48,165 +48,6 @@ LogicalProject(a3=[$0], b3=[$1]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483
       +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
          :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
          +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithCalc">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithDuplicatedArgs">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithFilter">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalFilter(condition=[>($0, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1, T2), BROADCAST(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1), BROADCAST(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithUnion">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ BROADCAST(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[false]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
 ]]>
     </Resource>
   </TestCase>
@@ -397,19 +238,6 @@ LogicalProject(EXPR$0=[+($0, $cor0.a1)])
     LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 })], variablesSet=[[$cor0]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithoutJoinPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1, T2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
@@ -601,97 +429,248 @@ LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5]), rowType=[R
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileArgsCanBeFoundInOuterJoin">
+  <TestCase name="testJoinHintWithNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsSumInQueryBlock">
+  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join T3 on T1.a1 = T3.a3) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2 where T1.b1 = 'abc') T4]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[=($1, _UTF-16LE'abc')]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectFrom">
+  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1 from (select T1.* from T1 join ((select T1.a1 as a2 from T1) union (select a2 from T2)) T2 on T1.a1 = T2.a2) T4]]>
+      <![CDATA[select /*+ BROADCAST(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0]), rowType=[RecordType(BIGINT a1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalUnion(all=[false]), rowType=[RecordType(BIGINT a2)]
-         :- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectList">
+  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join ((select T1.a1 as a3 from T1) union (select a3 from T3)) T3 on T1.a1 = T3.a3 where T3.a3 = 1) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2) T4]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
-  LogicalFilter(condition=[=($2, 1)])
-    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-      LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      LogicalUnion(all=[false])
-        LogicalProject(a3=[$0])
-          LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-        LogicalProject(a3=[$0])
-          LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileOuterQueryIsNotJoin">
+  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/* from (select T1.* from T1 join T2 on T1.a1 = T2.a2)]]>
+      <![CDATA[select /*+ BROADCAST(T2) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT EXPR$1)]
++- LogicalProject(b1=[$1], a1=[$0]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT a1)]
+   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName1">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :     +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName2">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :     +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithTableAlias">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithView">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalProject(a4=[$0], b4=[$1]), rowType=[RecordType(BIGINT a4, VARCHAR(2147483647) b4)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileArgsCanBeFoundInOuterJoin">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsSumInQueryBlock">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join T3 on T1.a1 = T3.a3) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2 where T1.b1 = 'abc') T4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[=($1, _UTF-16LE'abc')]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectFrom">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1 from (select T1.* from T1 join ((select T1.a1 as a2 from T1) union (select a2 from T2)) T2 on T1.a1 = T2.a2) T4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0]), rowType=[RecordType(BIGINT a1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalUnion(all=[false]), rowType=[RecordType(BIGINT a2)]
+         :- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
+         :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join ((select T1.a1 as a3 from T1) union (select a3 from T3)) T3 on T1.a1 = T3.a3 where T3.a3 = 1) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2) T4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+  LogicalFilter(condition=[=($2, 1)])
+    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+      LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      LogicalUnion(all=[false])
+        LogicalProject(a3=[$0])
+          LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+        LogicalProject(a3=[$0])
+          LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileOuterQueryIsNotJoin">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/* from (select T1.* from T1 join T2 on T1.a1 = T2.a2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
   </TestCase>
   <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileRootOfSubQueryIsFilter">
     <Resource name="sql">
@@ -766,167 +745,188 @@ LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithoutJoinPred">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1, T2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithNonEquiPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
-    </Resource>
+  <TestCase name="testJoinHintsOnSameViewWithReusingView">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
-    </Resource>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
-    </Resource>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithCalc">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ BROADCAST(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+  <TestCase name="testJoinHintsWithDuplicatedArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+      <![CDATA[select /*+ BROADCAST(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT EXPR$1)]
-+- LogicalProject(b1=[$1], a1=[$0]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT a1)]
-   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName1">
+  <TestCase name="testJoinHintsWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :     +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalFilter(condition=[>($0, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName2">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1, T2), BROADCAST(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :     +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiJoinHints">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1), SHUFFLE_HASH(T1),SHUFFLE_MERGE(T1),NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ BROADCAST(T1), BROADCAST(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][SHUFFLE_HASH options:[LEFT]][SHUFFLE_MERGE options:[LEFT]][NEST_LOOP options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithTableAlias">
+  <TestCase name="testJoinHintsWithUnion">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ BROADCAST(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalUnion(all=[false]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T3]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithView">
+  <TestCase name="testMultiJoinHints">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
+      <![CDATA[select /*+ BROADCAST(T1), SHUFFLE_HASH(T1),SHUFFLE_MERGE(T1),NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][SHUFFLE_HASH options:[LEFT]][SHUFFLE_MERGE options:[LEFT]][NEST_LOOP options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalProject(a4=[$0], b4=[$1]), rowType=[RecordType(BIGINT a4, VARCHAR(2147483647) b4)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/QueryHintsResolverTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/QueryHintsResolverTest.xml
index f8a02196da8..a3a39373d8e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/QueryHintsResolverTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/QueryHintsResolverTest.xml
@@ -48,165 +48,6 @@ LogicalProject(a3=[$0], b3=[$1]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483
       +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
          :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
          +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsOnSameViewWithReusingView">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-
-LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithCalc">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithDuplicatedArgs">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithFilter">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalFilter(condition=[>($0, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1, T2), BROADCAST(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1), BROADCAST(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintsWithUnion">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ BROADCAST(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[false]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
 ]]>
     </Resource>
   </TestCase>
@@ -397,19 +238,6 @@ LogicalProject(EXPR$0=[+($0, $cor0.a1)])
     LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
 })], variablesSet=[[$cor0]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinHintWithoutJoinPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1, T2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
@@ -601,97 +429,248 @@ LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a3=[$4], b3=[$5]), rowType=[R
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileArgsCanBeFoundInOuterJoin">
+  <TestCase name="testJoinHintWithNonEquiPred">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsSumInQueryBlock">
+  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join T3 on T1.a1 = T3.a3) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2 where T1.b1 = 'abc') T4]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
-  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-    LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
-+- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalFilter(condition=[=($1, _UTF-16LE'abc')]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0, 0] options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectFrom">
+  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1 from (select T1.* from T1 join ((select T1.a1 as a2 from T1) union (select a2 from T2)) T2 on T1.a1 = T2.a2) T4]]>
+      <![CDATA[select /*+ BROADCAST(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0]), rowType=[RecordType(BIGINT a1)]
-+- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalUnion(all=[false], hints=[[[ALIAS options:[T2]]]]), rowType=[RecordType(BIGINT a2)]
-         :- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectList">
+  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join ((select T1.a1 as a3 from T1) union (select a3 from T3)) T3 on T1.a1 = T3.a3 where T3.a3 = 1) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2) T4]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
-  LogicalFilter(condition=[=($2, 1)])
-    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-      LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-      LogicalUnion(all=[false])
-        LogicalProject(a3=[$0])
-          LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
-        LogicalProject(a3=[$0])
-          LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
-})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
-+- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileOuterQueryIsNotJoin">
+  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/* from (select T1.* from T1 join T2 on T1.a1 = T2.a2)]]>
+      <![CDATA[select /*+ BROADCAST(T2) */* from T1 where a1 in (select a2 from T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[EXPR$0]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[EXPR$0]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-]]>
-    </Resource>
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT EXPR$1)]
++- LogicalProject(b1=[$1], a1=[$0]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT a1)]
+   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName1">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithSubStringViewName2">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithTableAlias">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithView">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]]), rowType=[RecordType(BIGINT a4, VARCHAR(2147483647) b4)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T3]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileArgsCanBeFoundInOuterJoin">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsSumInQueryBlock">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join T3 on T1.a1 = T3.a3) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2 where T1.b1 = 'abc') T4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+    LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+    LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
++- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[=($1, _UTF-16LE'abc')]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0, 0] options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectFrom">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1 from (select T1.* from T1 join ((select T1.a1 as a2 from T1) union (select a2 from T2)) T2 on T1.a1 = T2.a2) T4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0]), rowType=[RecordType(BIGINT a1)]
++- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalUnion(all=[false], hints=[[[ALIAS options:[T2]]]]), rowType=[RecordType(BIGINT a2)]
+         :- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
+         :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a2=[$0]), rowType=[RecordType(BIGINT a2)]
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileContainsUnionAndJoinInSelectList">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/T4.a1, (select count(*) from T1 join ((select T1.a1 as a3 from T1) union (select a3 from T3)) T3 on T1.a1 = T3.a3 where T3.a3 = 1) as cnt from (select T1.* from T1 join T2 on T1.a1 = T2.a2) T4]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], cnt=[$SCALAR_QUERY({
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+  LogicalFilter(condition=[=($2, 1)])
+    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+      LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+      LogicalUnion(all=[false])
+        LogicalProject(a3=[$0])
+          LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]])
+        LogicalProject(a3=[$0])
+          LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]])
+})]), rowType=[RecordType(BIGINT a1, BIGINT cnt)]
++- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[T4]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileOuterQueryIsNotJoin">
+    <Resource name="sql">
+      <![CDATA[select /*+ BROADCAST(T1)*/* from (select T1.* from T1 join T2 on T1.a1 = T2.a2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[EXPR$0]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[EXPR$0]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+]]>
+    </Resource>
   </TestCase>
   <TestCase name="testJoinHintWithoutAffectingJoinInSubQueryWhileRootOfSubQueryIsFilter">
     <Resource name="sql">
@@ -766,167 +745,188 @@ LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndLeftSideAsBuildSide">
+  <TestCase name="testJoinHintWithoutJoinPred">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1, T2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[true], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithNonEquiPred">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 inner join T2 on T1.a1 > T2.a2]]>
-    </Resource>
+  <TestCase name="testJoinHintsOnSameViewWithReusingView">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[>($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndLeftSideAsBuildSide">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1) */* from T1 right join T2 on T1.a1 = T2.a2]]>
-    </Resource>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingView">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithRightJoinAndRightSideAsBuildSide">
-    <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2) */* from T1 right join T2 on T1.a1 = T2.a2]]>
-    </Resource>
+  <TestCase name="testJoinHintsOnSameViewWithoutReusingViewBecauseDifferentJoinHints">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalSink(table=[default_catalog.default_database.S1], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 2)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+
+LogicalSink(table=[default_catalog.default_database.S2], fields=[a1, b1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
++- LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalFilter(condition=[>($2, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+         +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V3]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+            +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[SHUFFLE_HASH options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V3]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSemiJoinAndRightSideAsBuildSide">
+  <TestCase name="testJoinHintsWithCalc">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T2) */* from T1 where a1 in (select a2 from T2)]]>
+      <![CDATA[select /*+ BROADCAST(T1) */a1 + 1, a1 * 10 from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-})]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(EXPR$0=[+($0, 1)], EXPR$1=[*($0, 10)]), rowType=[RecordType(BIGINT EXPR$0, BIGINT EXPR$1)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSimpleSumInSelectList">
+  <TestCase name="testJoinHintsWithDuplicatedArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1)*/T1.b1, sum(T1.a1) from T1 join T2 on T1.b1 = T2.b2 group by T1.b1]]>
+      <![CDATA[select /*+ BROADCAST(T1, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT EXPR$1)]
-+- LogicalProject(b1=[$1], a1=[$0]), rowType=[RecordType(VARCHAR(2147483647) b1, BIGINT a1)]
-   +- LogicalJoin(condition=[=($1, $3)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName1">
+  <TestCase name="testJoinHintsWithFilter">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V22)*/V22.* from V22 join T1 on V22.a1 = T1.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 where T1.a1 > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]][ALIAS inheritPath:[0, 1, 0] options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalFilter(condition=[>($0, 5)]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithSubStringViewName2">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndMultiArgs">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V2)*/V2.* from V2 join T1 on V2.a1 = T1.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1, T2), BROADCAST(T2, T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :     +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V22]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :        +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]], hints=[[[ALIAS inheritPath:[0] options:[V22]][ALIAS inheritPath:[0, 1, 0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-   :           :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiJoinHints">
+  <TestCase name="testJoinHintsWithMultiSameJoinHintsAndSingleArg">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(T1), SHUFFLE_HASH(T1),SHUFFLE_MERGE(T1),NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
+      <![CDATA[select /*+ BROADCAST(T1), BROADCAST(T2) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][SHUFFLE_HASH options:[LEFT]][SHUFFLE_MERGE options:[LEFT]][NEST_LOOP options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithTableAlias">
+  <TestCase name="testJoinHintsWithUnion">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V2)*/T1.* from T1 join (select T1.* from T1 join T2 on T1.a1 = T2.a2) V2 on T1.a1 = V2.a1]]>
+      <![CDATA[select /*+ BROADCAST(T1) */* from T1 join T2 on T1.a1 = T2.a2 union select /*+ BROADCAST(T3) */* from T3 join T1 on T3.a3 = T1.a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a10, VARCHAR(2147483647) b10)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalProject(a1=[$0], b1=[$1], hints=[[[ALIAS options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], hints=[[[ALIAS inheritPath:[0] options:[V2]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
+LogicalUnion(all=[false]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+:- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+:  +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
+:     :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
+:     +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalProject(a3=[$0], b3=[$1], a1=[$2], b1=[$3]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]]]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3, BIGINT a1, VARCHAR(2147483647) b1)]
+      :- LogicalTableScan(table=[[default_catalog, default_database, T3]], hints=[[[ALIAS inheritPath:[] options:[T3]]]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHintWithView">
+  <TestCase name="testMultiJoinHints">
     <Resource name="sql">
-      <![CDATA[select /*+ BROADCAST(V4) */* from T1 join V4 on T1.a1 = V4.a4]]>
+      <![CDATA[select /*+ BROADCAST(T1), SHUFFLE_HASH(T1),SHUFFLE_MERGE(T1),NEST_LOOP(T1) */* from T1 join T2 on T1.a1 = T2.a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], a4=[$2], b4=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
-+- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[RIGHT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a4, VARCHAR(2147483647) b4)]
+LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner], joinHints=[[[BROADCAST options:[LEFT]][SHUFFLE_HASH options:[LEFT]][SHUFFLE_MERGE options:[LEFT]][NEST_LOOP options:[LEFT]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1, BIGINT a2, VARCHAR(2147483647) b2)]
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]], hints=[[[ALIAS inheritPath:[] options:[T1]]]]), rowType=[RecordType(BIGINT a1, VARCHAR(2147483647) b1)]
-   +- LogicalProject(a4=[$0], b4=[$1], hints=[[[ALIAS options:[V4]]]]), rowType=[RecordType(BIGINT a4, VARCHAR(2147483647) b4)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3]]), rowType=[RecordType(BIGINT a3, VARCHAR(2147483647) b3)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]]), rowType=[RecordType(BIGINT a2, VARCHAR(2147483647) b2)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ScanReuseTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ScanReuseTest.xml
index 16138fc4fcc..0e508ef7691 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ScanReuseTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ScanReuseTest.xml
@@ -128,60 +128,6 @@ Calc(select=[a, b, c])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, c])
          +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProject[isStreaming: false]">
-    <Resource name="sql">
-      <![CDATA[SELECT T1.a, T1.c, T2.c FROM MyTable T1, MyTable T2 WHERE T1.a = T2.a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], c=[$2], c0=[$9])
-+- LogicalFilter(condition=[=($0, $7)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, c, c0])
-+- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], build=[left])
-   :- Exchange(distribution=[hash[a]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]], fields=[a, c])(reuse_id=[1])
-   +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
-      +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProject[isStreaming: true]">
-    <Resource name="sql">
-      <![CDATA[SELECT T1.a, T1.c, T2.c FROM MyTable T1, MyTable T2 WHERE T1.a = T2.a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], c=[$2], c0=[$10])
-+- LogicalFilter(condition=[=($0, $8)])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
-      :  +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
-      :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, c, c0])
-+- Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a]])(reuse_id=[1])
-   :  +- Calc(select=[a, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, c, nested_s])
-   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -736,133 +682,133 @@ Calc(select=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithFilter[isStreaming: false]">
+  <TestCase name="testProjectWithFilterPushDown[isStreaming: false]">
     <Resource name="sql">
-      <![CDATA[SELECT T1.a, T1.b, T2.c FROM (SELECT * FROM MyTable WHERE b = 2) T1, (SELECT * FROM MyTable WHERE b = 3) T2 WHERE T1.a = T2.a]]>
+      <![CDATA[SELECT T1.a, T1.c, T2.c FROM (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 2) T1, (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 1) T2 WHERE T1.a = T2.a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$9])
+LogicalProject(a=[$0], c=[$2], c0=[$9])
 +- LogicalFilter(condition=[=($0, $7)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6])
       :  +- LogicalFilter(condition=[=($1, 2)])
       :     +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6])
-         +- LogicalFilter(condition=[=($1, 3)])
+         +- LogicalFilter(condition=[=($1, 1)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c])
-+- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, a0, c], build=[left])
+Calc(select=[a, c, c0])
++- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], build=[left])
    :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, CAST(2 AS BIGINT) AS b], where=[(b = 2)])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b, c], metadata=[]]], fields=[a, b, c])(reuse_id=[1])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[=(b, 2:BIGINT)], project=[a, c], metadata=[]]], fields=[a, c], hints=[[[OPTIONS options:{filterable-fields=b}]]])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, c], where=[(b = 3)])
-         +- Reused(reference_id=[1])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[=(b, 1:BIGINT)], project=[a, c], metadata=[]]], fields=[a, c], hints=[[[OPTIONS options:{filterable-fields=b}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithFilter[isStreaming: true]">
+  <TestCase name="testProjectWithFilterPushDown[isStreaming: true]">
     <Resource name="sql">
-      <![CDATA[SELECT T1.a, T1.b, T2.c FROM (SELECT * FROM MyTable WHERE b = 2) T1, (SELECT * FROM MyTable WHERE b = 3) T2 WHERE T1.a = T2.a]]>
+      <![CDATA[SELECT T1.a, T1.c, T2.c FROM (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 2) T1, (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 1) T2 WHERE T1.a = T2.a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$10])
+LogicalProject(a=[$0], c=[$2], c0=[$10])
 +- LogicalFilter(condition=[=($0, $8)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6], rtime=[$7])
       :  +- LogicalFilter(condition=[=($1, 2)])
       :     +- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
       :        +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
-      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6], rtime=[$7])
-         +- LogicalFilter(condition=[=($1, 3)])
+         +- LogicalFilter(condition=[=($1, 1)])
             +- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
                +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c])
-+- Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, a0, c], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+Calc(select=[a, c, c0])
++- Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, CAST(2 AS BIGINT) AS b], where=[(b = 2)])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], filter=[]]], fields=[a, b, c, nested_s])(reuse_id=[1])
+   :  +- Calc(select=[a, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], filter=[=(b, 2:BIGINT)]]], fields=[a, b, c, nested_s], hints=[[[OPTIONS options:{filterable-fields=b}]]])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, c], where=[(b = 3)])
-         +- Reused(reference_id=[1])
+      +- Calc(select=[a, c])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], filter=[=(b, 1:BIGINT)]]], fields=[a, b, c, nested_s], hints=[[[OPTIONS options:{filterable-fields=b}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithFilterPushDown[isStreaming: false]">
+  <TestCase name="testProjectWithFilter[isStreaming: false]">
     <Resource name="sql">
-      <![CDATA[SELECT T1.a, T1.c, T2.c FROM (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 2) T1, (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 1) T2 WHERE T1.a = T2.a]]>
+      <![CDATA[SELECT T1.a, T1.b, T2.c FROM (SELECT * FROM MyTable WHERE b = 2) T1, (SELECT * FROM MyTable WHERE b = 3) T2 WHERE T1.a = T2.a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], c0=[$9])
+LogicalProject(a=[$0], b=[$1], c=[$9])
 +- LogicalFilter(condition=[=($0, $7)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6])
       :  +- LogicalFilter(condition=[=($1, 2)])
       :     +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6])
-         +- LogicalFilter(condition=[=($1, 1)])
+         +- LogicalFilter(condition=[=($1, 3)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, c, c0])
-+- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], build=[left])
+Calc(select=[a, b, c])
++- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, a0, c], build=[left])
    :- Exchange(distribution=[hash[a]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[=(b, 2:BIGINT)], project=[a, c], metadata=[]]], fields=[a, c], hints=[[[OPTIONS options:{filterable-fields=b}]]])
+   :  +- Calc(select=[a, CAST(2 AS BIGINT) AS b], where=[(b = 2)])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b, c], metadata=[]]], fields=[a, b, c])(reuse_id=[1])
    +- Exchange(distribution=[hash[a]])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[=(b, 1:BIGINT)], project=[a, c], metadata=[]]], fields=[a, c], hints=[[[OPTIONS options:{filterable-fields=b}]]])
+      +- Calc(select=[a, c], where=[(b = 3)])
+         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithFilterPushDown[isStreaming: true]">
+  <TestCase name="testProjectWithFilter[isStreaming: true]">
     <Resource name="sql">
-      <![CDATA[SELECT T1.a, T1.c, T2.c FROM (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 2) T1, (SELECT * FROM MyTable /*+ OPTIONS('filterable-fields'='b') */ WHERE b = 1) T2 WHERE T1.a = T2.a]]>
+      <![CDATA[SELECT T1.a, T1.b, T2.c FROM (SELECT * FROM MyTable WHERE b = 2) T1, (SELECT * FROM MyTable WHERE b = 3) T2 WHERE T1.a = T2.a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], c0=[$10])
+LogicalProject(a=[$0], b=[$1], c=[$10])
 +- LogicalFilter(condition=[=($0, $8)])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6], rtime=[$7])
       :  +- LogicalFilter(condition=[=($1, 2)])
       :     +- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
       :        +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
-      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[$5], metadata_2=[$6], rtime=[$7])
-         +- LogicalFilter(condition=[=($1, 1)])
+         +- LogicalFilter(condition=[=($1, 3)])
             +- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
                +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{filterable-fields=b}]]])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, c, c0])
-+- Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+Calc(select=[a, b, c])
++- Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, a0, c], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, c])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], filter=[=(b, 2:BIGINT)]]], fields=[a, b, c, nested_s], hints=[[[OPTIONS options:{filterable-fields=b}]]])
+   :  +- Calc(select=[a, CAST(2 AS BIGINT) AS b], where=[(b = 2)])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], filter=[]]], fields=[a, b, c, nested_s])(reuse_id=[1])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, c])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], filter=[=(b, 1:BIGINT)]]], fields=[a, b, c, nested_s], hints=[[[OPTIONS options:{filterable-fields=b}]]])
+      +- Calc(select=[a, c], where=[(b = 3)])
+         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1256,6 +1202,60 @@ Calc(select=[a, c, c0])
    :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable, partitions=[{c=1}], project=[a], metadata=[]]], fields=[a], hints=[[[OPTIONS options:{partition-list=c:1;c:2}]]])
    +- Exchange(distribution=[hash[a]])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable, partitions=[{c=2}], project=[a], metadata=[]]], fields=[a], hints=[[[OPTIONS options:{partition-list=c:1;c:2}]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProject[isStreaming: false]">
+    <Resource name="sql">
+      <![CDATA[SELECT T1.a, T1.c, T2.c FROM MyTable T1, MyTable T2 WHERE T1.a = T2.a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], c=[$2], c0=[$9])
++- LogicalFilter(condition=[=($0, $7)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, c, c0])
++- HashJoin(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], build=[left])
+   :- Exchange(distribution=[hash[a]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]], fields=[a, c])(reuse_id=[1])
+   +- Exchange(distribution=[hash[a]], shuffle_mode=[BATCH])
+      +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProject[isStreaming: true]">
+    <Resource name="sql">
+      <![CDATA[SELECT T1.a, T1.c, T2.c FROM MyTable T1, MyTable T2 WHERE T1.a = T2.a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], c=[$2], c0=[$10])
++- LogicalFilter(condition=[=($0, $8)])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
+      :  +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
+      :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalWatermarkAssigner(rowtime=[rtime], watermark=[-($7, 5000:INTERVAL SECOND)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], nested=[$3], metadata_1=[$4], compute_metadata=[*($4, 2)], metadata_2=[$5], rtime=[TO_TIMESTAMP($2, $3.s)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, c, c0])
++- Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, c, a0, c0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a]])(reuse_id=[1])
+   :  +- Calc(select=[a, c])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, nested_s], metadata=[], watermark=[-(TO_TIMESTAMP(c, nested_s), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, c, nested_s])
+   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1379,9 +1379,9 @@ Sink(table=[default_catalog.default_database.snk2], fields=[id])
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testWatermarkPushDownWithTimestampChanged[isStreaming: true]">
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testWatermarkPushDownWithTimestampChanged[isStreaming: true]">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.MySinkTs], fields=[a, ts_ltz])
 +- LogicalProject(a=[$0], ts_ltz=[$2])
    +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($2, 600000:INTERVAL MINUTE)])
@@ -1392,9 +1392,9 @@ LogicalSink(table=[default_catalog.default_database.MySinkTs], fields=[a, ts])
    +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($2, 600000:INTERVAL MINUTE)])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTableWatermark]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 TableSourceScan(table=[[default_catalog, default_database, MyTableWatermark, project=[a, b, ts_ltz], metadata=[], watermark=[-(ts_ltz, 600000:INTERVAL MINUTE)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, ts_ltz])(reuse_id=[1])
 
 Sink(table=[default_catalog.default_database.MySinkTs], fields=[a, ts_ltz])
@@ -1405,6 +1405,6 @@ Sink(table=[default_catalog.default_database.MySinkTs], fields=[a, ts])
 +- Calc(select=[CAST(b AS BIGINT) AS a, CAST(ts_ltz AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS ts])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ShuffleModePlanOptimizeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ShuffleModePlanOptimizeTest.xml
index 589f11aca8d..9439c7bd25a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ShuffleModePlanOptimizeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/ShuffleModePlanOptimizeTest.xml
@@ -1,28 +1,27 @@
 <?xml version="1.0" ?>
 <!--
-  ~ Licensed to the Apache Software Foundation (ASF) under one
-  ~ or more contributor license agreements.  See the NOTICE file
-  ~ distributed with this work for additional information
-  ~ regarding copyright ownership.  The ASF licenses this file
-  ~ to you under the Apache License, Version 2.0 (the
-  ~ "License"); you may not use this file except in compliance
-  ~ with the License.  You may obtain a copy of the License at
-  ~
-  ~     http://www.apache.org/licenses/LICENSE-2.0
-  ~
-  ~ Unless required by applicable law or agreed to in writing, software
-  ~ distributed under the License is distributed on an "AS IS" BASIS,
-  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-  ~ See the License for the specific language governing permissions and
-  ~ limitations under the License.
-  -->
+Licensed to the Apache Software Foundation (ASF) under one or more
+contributor license agreements.  See the NOTICE file distributed with
+this work for additional information regarding copyright ownership.
+The ASF licenses this file to you under the Apache License, Version 2.0
+(the "License"); you may not use this file except in compliance with
+the License.  You may obtain a copy of the License at
+
+http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing, software
+distributed under the License is distributed on an "AS IS" BASIS,
+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+See the License for the specific language governing permissions and
+limitations under the License.
+-->
 <Root>
-	<TestCase name="testMultipleInputWithDPP[mode = ALL_EXCHANGES_BLOCKING]">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 400) s3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testMultipleInputWithDPP[mode = ALL_EXCHANGES_BLOCKING]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 400) s3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c1=[$0], c2=[$1], c3=[$2])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalJoin(condition=[true], joinType=[inner])
@@ -42,9 +41,9 @@ LogicalProject(c1=[$0], c2=[$1], c3=[$2])
             :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
             +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2, c3], build=[right], singleRowJoin=[true])\n:- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2], build=[left], singleRowJoin=[true])\n:  :- [#2] Exchange(distribution=[broadcast])\n:  +- [#3] HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c2])\n+- [#1] Exchange(distribution=[broadcast])\n])
 :- Exchange(distribution=[broadcast])
 :  +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c3])
@@ -84,14 +83,14 @@ MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin],
             +- Exchange(distribution=[hash[dim_date_sk]])
                +- Reused(reference_id=[3])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testMultipleInputWithDPP[mode = ALL_EXCHANGES_HYBRID_SELECTIVE]">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 400) s3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultipleInputWithDPP[mode = ALL_EXCHANGES_HYBRID_FULL]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 400) s3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c1=[$0], c2=[$1], c3=[$2])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalJoin(condition=[true], joinType=[inner])
@@ -111,9 +110,9 @@ LogicalProject(c1=[$0], c2=[$1], c3=[$2])
             :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
             +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2, c3], build=[right], singleRowJoin=[true])\n:- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2], build=[left], singleRowJoin=[true])\n:  :- [#2] Exchange(distribution=[broadcast])\n:  +- [#3] HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c2])\n+- [#1] Exchange(distribution=[broadcast])\n])
 :- Exchange(distribution=[broadcast])
 :  +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c3])
@@ -153,14 +152,14 @@ MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin],
             +- Exchange(distribution=[hash[dim_date_sk]], shuffle_mode=[BATCH])
                +- Reused(reference_id=[3])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testMultipleInputWithDPP[mode = ALL_EXCHANGES_HYBRID_FULL]">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 400) s3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultipleInputWithDPP[mode = ALL_EXCHANGES_HYBRID_SELECTIVE]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and dim.price < 400) s3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c1=[$0], c2=[$1], c3=[$2])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalJoin(condition=[true], joinType=[inner])
@@ -180,9 +179,9 @@ LogicalProject(c1=[$0], c2=[$1], c3=[$2])
             :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
             +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2, c3], build=[right], singleRowJoin=[true])\n:- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2], build=[left], singleRowJoin=[true])\n:  :- [#2] Exchange(distribution=[broadcast])\n:  +- [#3] HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c2])\n+- [#1] Exchange(distribution=[broadcast])\n])
 :- Exchange(distribution=[broadcast])
 :  +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c3])
@@ -222,14 +221,14 @@ MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin],
             +- Exchange(distribution=[hash[dim_date_sk]], shuffle_mode=[BATCH])
                +- Reused(reference_id=[3])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testMultipleInputWithoutDPP[mode = ALL_EXCHANGES_BLOCKING]">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 400) s3]]>
-		</Resource>
-		<Resource name="ast">
-		<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultipleInputWithoutDPP[mode = ALL_EXCHANGES_BLOCKING]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 400) s3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c1=[$0], c2=[$1], c3=[$2])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalJoin(condition=[true], joinType=[inner])
@@ -249,9 +248,9 @@ LogicalProject(c1=[$0], c2=[$1], c3=[$2])
             :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
             +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-		<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2, c3], build=[right], singleRowJoin=[true])\n:- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2], build=[left], singleRowJoin=[true])\n:  :- [#2] Exchange(distribution=[broadcast])\n:  +- [#3] HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c2])\n+- [#1] Exchange(distribution=[broadcast])\n])
 :- Exchange(distribution=[broadcast])
 :  +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c3])
@@ -281,14 +280,14 @@ MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin],
             :     +- Reused(reference_id=[1])
             +- Reused(reference_id=[2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testMultipleInputWithoutDPP[mode = ALL_EXCHANGES_HYBRID_SELECTIVE]">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 400) s3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultipleInputWithoutDPP[mode = ALL_EXCHANGES_HYBRID_FULL]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 400) s3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c1=[$0], c2=[$1], c3=[$2])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalJoin(condition=[true], joinType=[inner])
@@ -308,9 +307,9 @@ LogicalProject(c1=[$0], c2=[$1], c3=[$2])
             :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
             +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2, c3], build=[right], singleRowJoin=[true])\n:- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2], build=[left], singleRowJoin=[true])\n:  :- [#2] Exchange(distribution=[broadcast])\n:  +- [#3] HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c2])\n+- [#1] Exchange(distribution=[broadcast])\n])
 :- Exchange(distribution=[broadcast])
 :  +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c3])
@@ -340,14 +339,14 @@ MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin],
             :     +- Reused(reference_id=[1])
             +- Reused(reference_id=[2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testMultipleInputWithoutDPP[mode = ALL_EXCHANGES_HYBRID_FULL]">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 400) s3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultipleInputWithoutDPP[mode = ALL_EXCHANGES_HYBRID_SELECTIVE]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (Select count(*) c1 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 100) s1, (Select count(*) c2 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 200) s2, (Select count(*) c3 from fact_part, dim where fact_part.fact_date_sk = dim_date_sk and fact_part.price < 400) s3]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c1=[$0], c2=[$1], c3=[$2])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalJoin(condition=[true], joinType=[inner])
@@ -367,9 +366,9 @@ LogicalProject(c1=[$0], c2=[$1], c3=[$2])
             :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
             +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2, c3], build=[right], singleRowJoin=[true])\n:- NestedLoopJoin(joinType=[InnerJoin], where=[true], select=[c1, c2], build=[left], singleRowJoin=[true])\n:  :- [#2] Exchange(distribution=[broadcast])\n:  +- [#3] HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c2])\n+- [#1] Exchange(distribution=[broadcast])\n])
 :- Exchange(distribution=[broadcast])
 :  +- HashAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS c3])
@@ -399,6 +398,6 @@ MultipleInput(readOrder=[0,0,1], members=[\nNestedLoopJoin(joinType=[InnerJoin],
             :     +- Reused(reference_id=[1])
             +- Reused(reference_id=[2])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/DynamicPartitionPruningProgramTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/DynamicPartitionPruningProgramTest.xml
index b56909ce22f..6888a71d7e1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/DynamicPartitionPruningProgramTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/DynamicPartitionPruningProgramTest.xml
@@ -16,751 +16,33 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testLargeQueryPlanShouldNotOutOfMemoryWithTableApi">
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(att = l_key)], select=[att, filename, l_key], build=[right])\n:- [#1] Exchange(distribution=[hash[att]])\n+- Calc(select=[att AS l_key], where=[(EXPR$0 > 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[att], select=[att, Final_COUNT(count$0) AS EXPR$0])\n      +- [#2] Exchange(distribution=[hash[att]])\n])
-:- Exchange(distribution=[hash[att]])
-:  +- Union(all=[true], union=[att, filename])(reuse_id=[1])
-:     :- Union(all=[true], union=[att, filename])
-:     :  :- Union(all=[true], union=[att, filename])
-:     :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- TableSourceScan(table=[[testCatalog, test_database, table0]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table1]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table2]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table3]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table4]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table5]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table6]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table7]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table8]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table9]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table10]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table11]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table12]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table13]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table14]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table15]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table16]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table17]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table18]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table19]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table20]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table21]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table22]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table23]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table24]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table25]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table26]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table27]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table28]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table29]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table30]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table31]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table32]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table33]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table34]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table35]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table36]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table37]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table38]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table39]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table40]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table41]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table42]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table43]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table44]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table45]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table46]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table47]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table48]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table49]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table50]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table51]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table52]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table53]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table54]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table55]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table56]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table57]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table58]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table59]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table60]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table61]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table62]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table63]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table64]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table65]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table66]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table67]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table68]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table69]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table70]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table71]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table72]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table73]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table74]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table75]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table76]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table77]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table78]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table79]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table80]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table81]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table82]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table83]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table84]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table85]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table86]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table87]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table88]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table89]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table90]], fields=[att, filename])
-:     :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table91]], fields=[att, filename])
-:     :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table92]], fields=[att, filename])
-:     :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table93]], fields=[att, filename])
-:     :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table94]], fields=[att, filename])
-:     :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table95]], fields=[att, filename])
-:     :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table96]], fields=[att, filename])
-:     :  :  +- TableSourceScan(table=[[testCatalog, test_database, table97]], fields=[att, filename])
-:     :  +- TableSourceScan(table=[[testCatalog, test_database, table98]], fields=[att, filename])
-:     +- TableSourceScan(table=[[testCatalog, test_database, table99]], fields=[att, filename])
-+- Exchange(distribution=[hash[att]])
-   +- LocalHashAggregate(groupBy=[att], select=[att, Partial_COUNT(att) AS count$0])
-      +- Reused(reference_id=[1])
+  <TestCase name="testAntiJoin">
+    <Resource name="sql">
+      <![CDATA[Select * from fact_part where not exists (select dim_date_sk from dim where dim.price < 500)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4])
++- LogicalFilter(condition=[NOT(EXISTS({
+LogicalFilter(condition=[<($3, 500)])
+  LogicalTableScan(table=[[testCatalog, test_database, dim]])
+}))])
+   +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[$f0], select=[id, name, amount, price, fact_date_sk], build=[right], singleRowJoin=[true])
+:- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[IS NOT NULL(m) AS $f0])
+      +- HashAggregate(isMerge=[true], select=[Final_MIN(min$0) AS m])
+         +- Exchange(distribution=[single])
+            +- LocalHashAggregate(select=[Partial_MIN(i) AS min$0])
+               +- Calc(select=[true AS i], where=[<(price, 500)])
+                  +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price], metadata=[]]], fields=[price])
 ]]>
-		</Resource>
-  </TestCase>
-	<TestCase name="testLargeQueryPlanShouldNotOutOfMemoryWithSqlApi">
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(att = l_key)], select=[att, filename, l_key, CNM], build=[right])\n:- [#1] Exchange(distribution=[hash[att]])\n+- Calc(select=[att AS l_key, CNM], where=[(CNM > 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[att], select=[att, Final_COUNT(count$0) AS CNM])\n      +- [#2] Exchange(distribution=[hash[att]])\n])
-:- Exchange(distribution=[hash[att]])
-:  +- Union(all=[true], union=[att, filename])
-:     :- Union(all=[true], union=[att, filename])
-:     :  :- Union(all=[true], union=[att, filename])
-:     :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- TableSourceScan(table=[[testCatalog, test_database, table0, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[1])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table1, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[2])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table2, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[3])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table3, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[4])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table4, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[5])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table5, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[6])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table6, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[7])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table7, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[8])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table8, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[9])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table9, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[10])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table10, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[11])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table11, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[12])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table12, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[13])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table13, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[14])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table14, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[15])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table15, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[16])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table16, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[17])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table17, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[18])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table18, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[19])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table19, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[20])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table20, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[21])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table21, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[22])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table22, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[23])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table23, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[24])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table24, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[25])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table25, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[26])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table26, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[27])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table27, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[28])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table28, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[29])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table29, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[30])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table30, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[31])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table31, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[32])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table32, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[33])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table33, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[34])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table34, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[35])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table35, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[36])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table36, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[37])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table37, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[38])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table38, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[39])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table39, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[40])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table40, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[41])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table41, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[42])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table42, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[43])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table43, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[44])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table44, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[45])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table45, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[46])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table46, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[47])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table47, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[48])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table48, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[49])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table49, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[50])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table50, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[51])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table51, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[52])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table52, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[53])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table53, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[54])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table54, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[55])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table55, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[56])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table56, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[57])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table57, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[58])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table58, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[59])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table59, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[60])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table60, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[61])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table61, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[62])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table62, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[63])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table63, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[64])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table64, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[65])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table65, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[66])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table66, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[67])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table67, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[68])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table68, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[69])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table69, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[70])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table70, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[71])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table71, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[72])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table72, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[73])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table73, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[74])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table74, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[75])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table75, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[76])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table76, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[77])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table77, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[78])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table78, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[79])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table79, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[80])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table80, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[81])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table81, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[82])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table82, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[83])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table83, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[84])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table84, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[85])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table85, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[86])
-:     :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table86, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[87])
-:     :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table87, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[88])
-:     :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table88, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[89])
-:     :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table89, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[90])
-:     :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table90, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[91])
-:     :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table91, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[92])
-:     :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table92, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[93])
-:     :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table93, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[94])
-:     :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table94, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[95])
-:     :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table95, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[96])
-:     :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table96, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[97])
-:     :  :  +- TableSourceScan(table=[[testCatalog, test_database, table97, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[98])
-:     :  +- TableSourceScan(table=[[testCatalog, test_database, table98, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[99])
-:     +- TableSourceScan(table=[[testCatalog, test_database, table99, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[100])
-+- Exchange(distribution=[hash[att]])
-   +- LocalHashAggregate(groupBy=[att], select=[att, Partial_COUNT(att) AS count$0])
-      +- Union(all=[true], union=[att])
-         :- Union(all=[true], union=[att])
-         :  :- Union(all=[true], union=[att])
-         :  :  :- Union(all=[true], union=[att])
-         :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Reused(reference_id=[1])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[2])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[3])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[4])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[5])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[6])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[7])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[8])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[9])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[10])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[11])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[12])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[13])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[14])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[15])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[16])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[17])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[18])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[19])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[20])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[21])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[22])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[23])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[24])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[25])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[26])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[27])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[28])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[29])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[30])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[31])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[32])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[33])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[34])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[35])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[36])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[37])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[38])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[39])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[40])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[41])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[42])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[43])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[44])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[45])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[46])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[47])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[48])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[49])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[50])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[51])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[52])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[53])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[54])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[55])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[56])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[57])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[58])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[59])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[60])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[61])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[62])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[63])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[64])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[65])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[66])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[67])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[68])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[69])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[70])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[71])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[72])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[73])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[74])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[75])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[76])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[77])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[78])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[79])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[80])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[81])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[82])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[83])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[84])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[85])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[86])
-         :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[87])
-         :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[88])
-         :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[89])
-         :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[90])
-         :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[91])
-         :  :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :  :     +- Reused(reference_id=[92])
-         :  :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :  :     +- Reused(reference_id=[93])
-         :  :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :  :     +- Reused(reference_id=[94])
-         :  :  :  :  :  +- Calc(select=[att])
-         :  :  :  :  :     +- Reused(reference_id=[95])
-         :  :  :  :  +- Calc(select=[att])
-         :  :  :  :     +- Reused(reference_id=[96])
-         :  :  :  +- Calc(select=[att])
-         :  :  :     +- Reused(reference_id=[97])
-         :  :  +- Calc(select=[att])
-         :  :     +- Reused(reference_id=[98])
-         :  +- Calc(select=[att])
-         :     +- Reused(reference_id=[99])
-         +- Calc(select=[att])
-            +- Reused(reference_id=[100])
-]]>
-		</Resource>
-  </TestCase>
-  <TestCase name="testAntiJoin">
-    <Resource name="sql">
-      <![CDATA[Select * from fact_part where not exists (select dim_date_sk from dim where dim.price < 500)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4])
-+- LogicalFilter(condition=[NOT(EXISTS({
-LogicalFilter(condition=[<($3, 500)])
-  LogicalTableScan(table=[[testCatalog, test_database, dim]])
-}))])
-   +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[$f0], select=[id, name, amount, price, fact_date_sk], build=[right], singleRowJoin=[true])
-:- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[IS NOT NULL(m) AS $f0])
-      +- HashAggregate(isMerge=[true], select=[Final_MIN(min$0) AS m])
-         +- Exchange(distribution=[single])
-            +- LocalHashAggregate(select=[Partial_MIN(i) AS min$0])
-               +- Calc(select=[true AS i], where=[<(price, 500)])
-                  +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price], metadata=[]]], fields=[price])
-]]>
-    </Resource>
+    </Resource>
   </TestCase>
   <TestCase name="testComplexCalcInFactSide">
     <Resource name="sql">
@@ -790,74 +72,169 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk1, dim_date_sk)], select=[id
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testComplexDimSideWithAggInDimSide">
+  <TestCase name="testComplexDimSideWithAggInDimSide">
+    <Resource name="sql">
+      <![CDATA[Select * from fact_part join (select dim_date_sk, sum(dim.price) from dim where  dim.price < 500 group by dim_date_sk) dimSide on fact_part.fact_date_sk = dimSide.dim_date_sk]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], EXPR$1=[$6])
++- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+   +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
+      +- LogicalProject(dim_date_sk=[$4], price=[$3])
+         +- LogicalFilter(condition=[<($3, 500)])
+            +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+:     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+:        +- HashAggregate(isMerge=[true], groupBy=[dim_date_sk], select=[dim_date_sk, Final_SUM(sum$0) AS EXPR$1])
+:           +- Exchange(distribution=[hash[dim_date_sk]])
+:              +- LocalHashAggregate(groupBy=[dim_date_sk], select=[dim_date_sk, Partial_SUM(price) AS sum$0])
+:                 +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
+:                    +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
++- HashAggregate(isMerge=[true], groupBy=[dim_date_sk], select=[dim_date_sk, Final_SUM(sum$0) AS EXPR$1])
+   +- Exchange(distribution=[hash[dim_date_sk]])
+      +- LocalHashAggregate(groupBy=[dim_date_sk], select=[dim_date_sk, Partial_SUM(price) AS sum$0])
+         +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testComplexDimSideWithJoinInDimSide">
+    <Resource name="sql">
+      <![CDATA[Select * from fact_part join (select * from dim, sales, item where dim.id = sales.id and sales.id = item.id and dim.price < 500 and sales.price > 300) dimSide on fact_part.fact_date_sk = dimSide.dim_date_sk]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9], id00=[$10], amount00=[$11], price00=[$12], id1=[$13], amount1=[$14], price1=[$15])
++- LogicalJoin(condition=[=($4, $9)], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+   +- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], amount1=[$9], price1=[$10])
+      +- LogicalFilter(condition=[AND(=($0, $5), =($5, $8), <($3, 500), >($7, 300))])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalJoin(condition=[true], joinType=[inner])
+            :  :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+            :  +- LogicalTableScan(table=[[testCatalog, test_database, sales]])
+            +- LogicalTableScan(table=[[testCatalog, test_database, item]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk, id00, amount00, price00, id1, amount1, price1], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- HashJoin(joinType=[InnerJoin], where=[=(id0, id1)], select=[id, male, amount, price, dim_date_sk, id0, amount0, price0, id1, amount1, price1], build=[left])
+      :- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, male, amount, price, dim_date_sk, id0, amount0, price0], build=[right])
+      :  :- Exchange(distribution=[hash[id]])
+      :  :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      :  :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+      :  +- Exchange(distribution=[hash[id]])
+      :     +- Calc(select=[id, amount, price], where=[>(price, 300)])
+      :        +- TableSourceScan(table=[[testCatalog, test_database, sales, filter=[]]], fields=[id, amount, price])
+      +- Exchange(distribution=[hash[id]])
+         +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDPPWithDimSideJoinKeyChanged">
+    <Resource name="sql">
+      <![CDATA[Select * from fact_part join item on fact_part.id = item.id join (select dim_date_sk + 1 as dim_date_sk, price from dim) dim1 on fact_part.fact_date_sk = dim1.dim_date_sk where dim1.price < 500 and dim1.price > 300]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], dim_date_sk=[$8], price1=[$9])
++- LogicalFilter(condition=[AND(<($9, 500), >($9, 300))])
+   +- LogicalJoin(condition=[=($4, $8)], joinType=[inner])
+      :- LogicalJoin(condition=[=($0, $5)], joinType=[inner])
+      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
+      +- LogicalProject(dim_date_sk=[+($4, 1)], price=[$3])
+         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, dim_date_sk, price1], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
+:     :- Exchange(distribution=[hash[id]])
+:     :  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+:     :     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+:     :        +- Calc(select=[+(dim_date_sk, 1) AS dim_date_sk, price], where=[SEARCH(price, Sarg[(300..500)])])
+:     :           +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+:     +- Exchange(distribution=[hash[id]])
+:        +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Calc(select=[+(dim_date_sk, 1) AS dim_date_sk, price], where=[SEARCH(price, Sarg[(300..500)])])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDPPWithFactSideJoinKeyChanged">
     <Resource name="sql">
-      <![CDATA[Select * from fact_part join (select dim_date_sk, sum(dim.price) from dim where  dim.price < 500 group by dim_date_sk) dimSide on fact_part.fact_date_sk = dimSide.dim_date_sk]]>
+      <![CDATA[Select * from (select fact_date_sk + 1 as fact_date_sk, id from fact_part) fact_part1 join item on fact_part1.id = item.id join dim on fact_part1.fact_date_sk = dim.dim_date_sk where dim.price < 500 and dim.price > 300]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], EXPR$1=[$6])
-+- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-   +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-      +- LogicalProject(dim_date_sk=[$4], price=[$3])
-         +- LogicalFilter(condition=[<($3, 500)])
-            +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+LogicalProject(fact_date_sk=[$0], id=[$1], id0=[$2], amount=[$3], price=[$4], id1=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalFilter(condition=[AND(<($8, 500), >($8, 300))])
+   +- LogicalJoin(condition=[=($0, $9)], joinType=[inner])
+      :- LogicalJoin(condition=[=($1, $2)], joinType=[inner])
+      :  :- LogicalProject(fact_date_sk=[+($4, 1)], id=[$0])
+      :  :  +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1], build=[right])
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[fact_date_sk, id, id0, amount, price, id1, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[fact_date_sk]])
-:  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-:     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-:        +- HashAggregate(isMerge=[true], groupBy=[dim_date_sk], select=[dim_date_sk, Final_SUM(sum$0) AS EXPR$1])
-:           +- Exchange(distribution=[hash[dim_date_sk]])
-:              +- LocalHashAggregate(groupBy=[dim_date_sk], select=[dim_date_sk, Partial_SUM(price) AS sum$0])
-:                 +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
-:                    +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-+- HashAggregate(isMerge=[true], groupBy=[dim_date_sk], select=[dim_date_sk, Final_SUM(sum$0) AS EXPR$1])
-   +- Exchange(distribution=[hash[dim_date_sk]])
-      +- LocalHashAggregate(groupBy=[dim_date_sk], select=[dim_date_sk, Partial_SUM(price) AS sum$0])
-         +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[fact_date_sk, id, id0, amount, price], build=[left])
+:     :- Exchange(distribution=[hash[id]])
+:     :  +- Calc(select=[+(fact_date_sk, 1) AS fact_date_sk, id])
+:     :     +- TableSourceScan(table=[[testCatalog, test_database, fact_part, project=[fact_date_sk, id], metadata=[]]], fields=[fact_date_sk, id])
+:     +- Exchange(distribution=[hash[id]])
+:        +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testComplexDimSideWithJoinInDimSide">
+  <TestCase name="testDPPWithJoinKeysNotIncludePartitionKeys">
     <Resource name="sql">
-      <![CDATA[Select * from fact_part join (select * from dim, sales, item where dim.id = sales.id and sales.id = item.id and dim.price < 500 and sales.price > 300) dimSide on fact_part.fact_date_sk = dimSide.dim_date_sk]]>
+      <![CDATA[Select * from fact_part, item, dim where fact_part.id = dim.id and fact_part.id = item.id and dim.id = item.id  and dim.price < 500 and dim.price > 300]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9], id00=[$10], amount00=[$11], price00=[$12], id1=[$13], amount1=[$14], price1=[$15])
-+- LogicalJoin(condition=[=($4, $9)], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-   +- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], amount1=[$9], price1=[$10])
-      +- LogicalFilter(condition=[AND(=($0, $5), =($5, $8), <($3, 500), >($7, 300))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalJoin(condition=[true], joinType=[inner])
-            :  :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-            :  +- LogicalTableScan(table=[[testCatalog, test_database, sales]])
-            +- LogicalTableScan(table=[[testCatalog, test_database, item]])
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], male=[$9], amount1=[$10], price1=[$11], dim_date_sk=[$12])
++- LogicalFilter(condition=[AND(=($0, $8), =($0, $5), =($8, $5), <($11, 500), >($11, 300))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk, id00, amount00, price00, id1, amount1, price1], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- HashJoin(joinType=[InnerJoin], where=[=(id0, id1)], select=[id, male, amount, price, dim_date_sk, id0, amount0, price0, id1, amount1, price1], build=[left])
-      :- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, male, amount, price, dim_date_sk, id0, amount0, price0], build=[right])
-      :  :- Exchange(distribution=[hash[id]])
-      :  :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      :  :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-      :  +- Exchange(distribution=[hash[id]])
-      :     +- Calc(select=[id, amount, price], where=[>(price, 300)])
-      :        +- TableSourceScan(table=[[testCatalog, test_database, sales, filter=[]]], fields=[id, amount, price])
-      +- Exchange(distribution=[hash[id]])
-         +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
+HashJoin(joinType=[InnerJoin], where=[=(id, id1)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
+:- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
+:  :- Exchange(distribution=[hash[id]])
+:  :  +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+:  +- Exchange(distribution=[hash[id]])
+:     +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
++- Exchange(distribution=[hash[id]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[AND(SEARCH(price, Sarg[(300..500)]), IS NOT NULL(id))])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
@@ -957,51 +334,51 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDimTableWithoutFilter">
+  <TestCase name="testDimTableWithUnsuitableFilter">
     <Resource name="sql">
-      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.price > 100]]>
+      <![CDATA[Select * from dim join fact_part on fact_part.fact_date_sk = dim.dim_date_sk where dim.id is not null]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), >($8, 100))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
++- LogicalFilter(condition=[IS NOT NULL($0)])
+   +- LogicalJoin(condition=[=($9, $4)], joinType=[inner])
       :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
       +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[right])
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
 :- Exchange(distribution=[hash[dim_date_sk]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[IS NOT NULL(id)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 +- Exchange(distribution=[hash[fact_date_sk]])
-   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 100)])
-      +- TableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
+   +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDimTableWithUnsuitableFilter">
+  <TestCase name="testDimTableWithoutFilter">
     <Resource name="sql">
-      <![CDATA[Select * from dim join fact_part on fact_part.fact_date_sk = dim.dim_date_sk where dim.id is not null]]>
+      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.price > 100]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[IS NOT NULL($0)])
-   +- LogicalJoin(condition=[=($9, $4)], joinType=[inner])
++- LogicalFilter(condition=[AND(=($9, $4), >($8, 100))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
       +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[right])
 :- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[IS NOT NULL(id)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:  +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])
 +- Exchange(distribution=[hash[fact_date_sk]])
-   +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 100)])
+      +- TableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
     </Resource>
   </TestCase>
@@ -1166,143 +543,15 @@ LogicalProject(id=[$0], amount=[$1], fact_date_sk=[$2], EXPR$3=[$3], EXPR$4=[$4]
       :        +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
       +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, amount, fact_date_sk, EXPR$3, EXPR$4, id0, male, amount0, price, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- HashAggregate(isMerge=[true], groupBy=[id, amount, fact_date_sk], select=[id, amount, fact_date_sk, Final_COUNT(count$0) AS EXPR$3, Final_SUM(sum$1) AS EXPR$4])
-:     +- Exchange(distribution=[hash[id, amount, fact_date_sk]])
-:        +- TableSourceScan(table=[[testCatalog, test_database, fact_part, partitions=[{fact_date_sk=1990}, {fact_date_sk=1991}, {fact_date_sk=1992}], aggregates=[grouping=[id,amount,fact_date_sk], aggFunctions=[CountAggFunction(name),LongSumAggFunction(price)]]]], fields=[id, amount, fact_date_sk, count$0, sum$1])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testDPPWithDimSideJoinKeyChanged">
-    <Resource name="sql">
-      <![CDATA[Select * from fact_part join item on fact_part.id = item.id join (select dim_date_sk + 1 as dim_date_sk, price from dim) dim1 on fact_part.fact_date_sk = dim1.dim_date_sk where dim1.price < 500 and dim1.price > 300]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], dim_date_sk=[$8], price1=[$9])
-+- LogicalFilter(condition=[AND(<($9, 500), >($9, 300))])
-   +- LogicalJoin(condition=[=($4, $8)], joinType=[inner])
-      :- LogicalJoin(condition=[=($0, $5)], joinType=[inner])
-      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
-      +- LogicalProject(dim_date_sk=[+($4, 1)], price=[$3])
-         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, dim_date_sk, price1], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
-:     :- Exchange(distribution=[hash[id]])
-:     :  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-:     :     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-:     :        +- Calc(select=[+(dim_date_sk, 1) AS dim_date_sk, price], where=[SEARCH(price, Sarg[(300..500)])])
-:     :           +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-:     +- Exchange(distribution=[hash[id]])
-:        +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[+(dim_date_sk, 1) AS dim_date_sk, price], where=[SEARCH(price, Sarg[(300..500)])])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testDPPWithFactSideJoinKeyChanged">
-    <Resource name="sql">
-      <![CDATA[Select * from (select fact_date_sk + 1 as fact_date_sk, id from fact_part) fact_part1 join item on fact_part1.id = item.id join dim on fact_part1.fact_date_sk = dim.dim_date_sk where dim.price < 500 and dim.price > 300]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(fact_date_sk=[$0], id=[$1], id0=[$2], amount=[$3], price=[$4], id1=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(<($8, 500), >($8, 300))])
-   +- LogicalJoin(condition=[=($0, $9)], joinType=[inner])
-      :- LogicalJoin(condition=[=($1, $2)], joinType=[inner])
-      :  :- LogicalProject(fact_date_sk=[+($4, 1)], id=[$0])
-      :  :  +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[fact_date_sk, id, id0, amount, price, id1, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[fact_date_sk, id, id0, amount, price], build=[left])
-:     :- Exchange(distribution=[hash[id]])
-:     :  +- Calc(select=[+(fact_date_sk, 1) AS fact_date_sk, id])
-:     :     +- TableSourceScan(table=[[testCatalog, test_database, fact_part, project=[fact_date_sk, id], metadata=[]]], fields=[fact_date_sk, id])
-:     +- Exchange(distribution=[hash[id]])
-:        +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testDPPWithJoinKeysNotIncludePartitionKeys">
-    <Resource name="sql">
-      <![CDATA[Select * from fact_part, item, dim where fact_part.id = dim.id and fact_part.id = item.id and dim.id = item.id  and dim.price < 500 and dim.price > 300]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], male=[$9], amount1=[$10], price1=[$11], dim_date_sk=[$12])
-+- LogicalFilter(condition=[AND(=($0, $8), =($0, $5), =($8, $5), <($11, 500), >($11, 300))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(id, id1)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
-:- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
-:  :- Exchange(distribution=[hash[id]])
-:  :  +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-:  +- Exchange(distribution=[hash[id]])
-:     +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
-+- Exchange(distribution=[hash[id]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[AND(SEARCH(price, Sarg[(300..500)]), IS NOT NULL(id))])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testDppWithoutJoinReorder">
-    <Resource name="sql">
-      <![CDATA[Select * from fact_part, item, dim where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.id = item.id and dim.id = item.id  and dim.price < 500 and dim.price > 300]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], male=[$9], amount1=[$10], price1=[$11], dim_date_sk=[$12])
-+- LogicalFilter(condition=[AND(=($4, $12), =($0, $5), =($8, $5), <($11, 500), >($11, 300))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[AND(=(fact_date_sk, dim_date_sk), =(id1, id0))], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk, id0]])
-:  +- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
-:     :- Exchange(distribution=[hash[id]])
-:     :  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-:     :     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-:     :        +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
-:     :           +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:     +- Exchange(distribution=[hash[id]])
-:        +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
-+- Exchange(distribution=[hash[dim_date_sk, id]])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, amount, fact_date_sk, EXPR$3, EXPR$4, id0, male, amount0, price, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- HashAggregate(isMerge=[true], groupBy=[id, amount, fact_date_sk], select=[id, amount, fact_date_sk, Final_COUNT(count$0) AS EXPR$3, Final_SUM(sum$1) AS EXPR$4])
+:     +- Exchange(distribution=[hash[id, amount, fact_date_sk]])
+:        +- TableSourceScan(table=[[testCatalog, test_database, fact_part, partitions=[{fact_date_sk=1990}, {fact_date_sk=1991}, {fact_date_sk=1992}], aggregates=[grouping=[id,amount,fact_date_sk], aggFunctions=[CountAggFunction(name),LongSumAggFunction(price)]]]], fields=[id, amount, fact_date_sk, count$0, sum$1])
++- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
@@ -1416,6 +665,39 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id,
 +- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDppWithoutJoinReorder">
+    <Resource name="sql">
+      <![CDATA[Select * from fact_part, item, dim where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.id = item.id and dim.id = item.id  and dim.price < 500 and dim.price > 300]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], male=[$9], amount1=[$10], price1=[$11], dim_date_sk=[$12])
++- LogicalFilter(condition=[AND(=($4, $12), =($0, $5), =($8, $5), <($11, 500), >($11, 300))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, item]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[AND(=(fact_date_sk, dim_date_sk), =(id1, id0))], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk, id0]])
+:  +- HashJoin(joinType=[InnerJoin], where=[=(id, id0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
+:     :- Exchange(distribution=[hash[id]])
+:     :  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+:     :     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+:     :        +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
+:     :           +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     +- Exchange(distribution=[hash[id]])
+:        +- TableSourceScan(table=[[testCatalog, test_database, item]], fields=[id, amount, price])
++- Exchange(distribution=[hash[dim_date_sk, id]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[SEARCH(price, Sarg[(300..500)])])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
@@ -1487,54 +769,263 @@ LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], i
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 200)])
-:     +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
-:        +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-:           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 200)])
+:     +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
+:        +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+:           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringFactInLeftWithExchangeRule">
+    <Resource name="sql">
+      <![CDATA[Select * from fact_part, dim where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($4, $9), <($8, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+:     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+:        +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:           +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringFactInRightRule">
+    <Resource name="sql">
+      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+   +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+      +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringFactInRightWithCalcRule">
+    <Resource name="sql">
+      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.price > 200 and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), >($8, 200), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 200)])
+   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
+      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringFactInRightWithExchangeAndCalcRule">
+    <Resource name="sql">
+      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.price > 200 and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), >($8, 200), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 200)])
+      +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
+         +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+            +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+               +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringFactInRightWithExchangeRule">
+    <Resource name="sql">
+      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDynamicFilteringFieldIsComputeColumnsInFactSide">
+    <Resource name="sql">
+      <![CDATA[Select * from dim join (select fact_date_sk, amount + 1 as amount from fact_part) t1 on fact_date_sk = dim_date_sk and t1.amount = dim.amount where dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$5], amount0=[$6])
++- LogicalFilter(condition=[<($3, 500)])
+   +- LogicalJoin(condition=[AND(=($5, $4), =($6, $2))], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalProject(fact_date_sk=[$4], amount=[+($2, 1)])
+         +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[AND(=(fact_date_sk, dim_date_sk), =(amount0, amount))], select=[id, male, amount, price, dim_date_sk, fact_date_sk, amount0], build=[left])
+:- Exchange(distribution=[broadcast])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Calc(select=[fact_date_sk, +(amount, 1) AS amount])
+   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, project=[fact_date_sk, amount], metadata=[]]], fields=[fact_date_sk, amount])
+      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testFactTableIsLegacySource">
+    <Resource name="sql">
+      <![CDATA[Select * from dim, legacy_source where legacy_source.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, legacy_source]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- TableSourceScan(table=[[testCatalog, test_database, legacy_source]], fields=[id, name, amount, price, fact_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testFactTableIsNotPartitionTable">
+    <Resource name="sql">
+      <![CDATA[Select * from dim, none_part_fact where none_part_fact.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, none_part_fact]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- TableSourceScan(table=[[testCatalog, test_database, none_part_fact]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDynamicFilteringFactInLeftWithExchangeRule">
+  <TestCase name="testFullOuterJoin">
     <Resource name="sql">
-      <![CDATA[Select * from fact_part, dim where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+      <![CDATA[Select * from fact_part full outer join (select *  from dim where dim.price < 500) on fact_date_sk = dim_date_sk]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($4, $9), <($8, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
++- LogicalJoin(condition=[=($4, $9)], joinType=[full])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+   +- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4])
+      +- LogicalFilter(condition=[<($3, 500)])
+         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+HashJoin(joinType=[FullOuterJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[fact_date_sk]])
-:  +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-:     +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-:        +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:           +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDynamicFilteringFactInRightRule">
+  <TestCase name="testJoinKeyIsDynamicFilterFieldNotPartitionKey">
     <Resource name="sql">
-      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+      <![CDATA[Select * from dim, fact_part where fact_part.amount = dim.amount and dim.price < 500]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
++- LogicalFilter(condition=[AND(=($7, $2), <($3, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
       +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
@@ -1542,88 +1033,1966 @@ LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[broadcast])
+HashJoin(joinType=[InnerJoin], where=[=(amount0, amount)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[amount]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
 :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-   +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-      +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+      +- DynamicFilteringDataCollector(fields=[amount])
+         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDynamicFilteringFactInRightWithCalcRule">
-    <Resource name="sql">
-      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.price > 200 and dim.price < 500]]>
-    </Resource>
+  <TestCase name="testLargeQueryPlanShouldNotOutOfMemoryWithSqlApi">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), >($8, 200), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+LogicalProject(att=[$0], filename=[$1], l_key=[$2], CNM=[$3])
++- LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+   :- LogicalUnion(all=[true])
+   :  :- LogicalUnion(all=[true])
+   :  :  :- LogicalUnion(all=[true])
+   :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalTableScan(table=[[testCatalog, test_database, table0]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table1]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table2]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table3]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table4]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table5]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table6]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table7]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table8]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table9]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table10]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table11]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table12]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table13]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table14]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table15]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table16]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table17]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table18]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table19]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table20]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table21]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table22]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table23]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table24]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table25]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table26]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table27]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table28]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table29]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table30]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table31]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table32]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table33]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table34]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table35]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table36]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table37]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table38]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table39]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table40]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table41]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table42]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table43]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table44]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table45]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table46]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table47]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table48]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table49]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table50]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table51]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table52]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table53]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table54]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table55]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table56]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table57]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table58]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table59]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table60]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table61]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table62]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table63]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table64]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table65]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table66]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table67]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table68]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table69]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table70]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table71]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table72]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table73]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table74]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table75]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table76]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table77]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table78]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table79]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table80]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table81]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table82]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table83]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table84]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table85]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table86]])
+   :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table87]])
+   :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table88]])
+   :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table89]])
+   :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table90]])
+   :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table91]])
+   :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table92]])
+   :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table93]])
+   :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table94]])
+   :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table95]])
+   :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table96]])
+   :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table97]])
+   :  :  +- LogicalProject(att=[$0], filename=[$1])
+   :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table98]])
+   :  +- LogicalProject(att=[$0], filename=[$1])
+   :     +- LogicalTableScan(table=[[testCatalog, test_database, table99]])
+   +- LogicalFilter(condition=[>($1, 1)])
+      +- LogicalAggregate(group=[{0}], CNM=[COUNT($0)])
+         +- LogicalProject(l_key=[$0])
+            +- LogicalUnion(all=[true])
+               :- LogicalUnion(all=[true])
+               :  :- LogicalUnion(all=[true])
+               :  :  :- LogicalUnion(all=[true])
+               :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalTableScan(table=[[testCatalog, test_database, table0]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table1]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table2]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table3]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table4]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table5]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table6]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table7]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table8]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table9]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table10]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table11]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table12]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table13]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table14]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table15]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table16]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table17]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table18]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table19]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table20]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table21]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table22]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table23]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table24]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table25]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table26]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table27]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table28]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table29]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table30]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table31]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table32]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table33]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table34]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table35]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table36]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table37]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table38]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table39]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table40]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table41]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table42]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table43]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table44]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table45]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table46]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table47]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table48]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table49]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table50]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table51]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table52]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table53]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table54]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table55]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table56]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table57]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table58]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table59]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table60]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table61]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table62]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table63]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table64]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table65]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table66]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table67]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table68]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table69]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table70]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table71]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table72]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table73]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table74]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table75]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table76]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table77]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table78]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table79]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table80]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table81]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table82]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table83]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table84]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table85]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table86]])
+               :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table87]])
+               :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table88]])
+               :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table89]])
+               :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table90]])
+               :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table91]])
+               :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table92]])
+               :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table93]])
+               :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table94]])
+               :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table95]])
+               :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table96]])
+               :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table97]])
+               :  +- LogicalProject(att=[$0], filename=[$1])
+               :     +- LogicalTableScan(table=[[testCatalog, test_database, table98]])
+               +- LogicalProject(att=[$0], filename=[$1])
+                  +- LogicalTableScan(table=[[testCatalog, test_database, table99]])
 ]]>
     </Resource>
-    <Resource name="optimized rel plan">
+    <Resource name="optimized exec plan">
       <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 200)])
-   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
-      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(att = l_key)], select=[att, filename, l_key, CNM], build=[right])\n:- [#1] Exchange(distribution=[hash[att]])\n+- Calc(select=[att AS l_key, CNM], where=[(CNM > 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[att], select=[att, Final_COUNT(count$0) AS CNM])\n      +- [#2] Exchange(distribution=[hash[att]])\n])
+:- Exchange(distribution=[hash[att]])
+:  +- Union(all=[true], union=[att, filename])
+:     :- Union(all=[true], union=[att, filename])
+:     :  :- Union(all=[true], union=[att, filename])
+:     :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- TableSourceScan(table=[[testCatalog, test_database, table0, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[1])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table1, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[2])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table2, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[3])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table3, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[4])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table4, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[5])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table5, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[6])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table6, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[7])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table7, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[8])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table8, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[9])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table9, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[10])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table10, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[11])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table11, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[12])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table12, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[13])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table13, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[14])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table14, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[15])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table15, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[16])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table16, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[17])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table17, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[18])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table18, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[19])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table19, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[20])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table20, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[21])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table21, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[22])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table22, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[23])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table23, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[24])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table24, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[25])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table25, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[26])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table26, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[27])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table27, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[28])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table28, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[29])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table29, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[30])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table30, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[31])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table31, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[32])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table32, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[33])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table33, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[34])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table34, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[35])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table35, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[36])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table36, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[37])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table37, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[38])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table38, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[39])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table39, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[40])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table40, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[41])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table41, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[42])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table42, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[43])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table43, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[44])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table44, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[45])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table45, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[46])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table46, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[47])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table47, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[48])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table48, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[49])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table49, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[50])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table50, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[51])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table51, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[52])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table52, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[53])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table53, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[54])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table54, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[55])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table55, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[56])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table56, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[57])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table57, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[58])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table58, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[59])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table59, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[60])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table60, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[61])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table61, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[62])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table62, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[63])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table63, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[64])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table64, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[65])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table65, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[66])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table66, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[67])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table67, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[68])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table68, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[69])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table69, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[70])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table70, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[71])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table71, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[72])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table72, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[73])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table73, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[74])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table74, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[75])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table75, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[76])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table76, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[77])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table77, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[78])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table78, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[79])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table79, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[80])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table80, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[81])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table81, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[82])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table82, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[83])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table83, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[84])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table84, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[85])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table85, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[86])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table86, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[87])
+:     :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table87, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[88])
+:     :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table88, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[89])
+:     :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table89, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[90])
+:     :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table90, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[91])
+:     :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table91, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[92])
+:     :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table92, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[93])
+:     :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table93, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[94])
+:     :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table94, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[95])
+:     :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table95, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[96])
+:     :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table96, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[97])
+:     :  :  +- TableSourceScan(table=[[testCatalog, test_database, table97, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[98])
+:     :  +- TableSourceScan(table=[[testCatalog, test_database, table98, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[99])
+:     +- TableSourceScan(table=[[testCatalog, test_database, table99, project=[att, filename], metadata=[]]], fields=[att, filename])(reuse_id=[100])
++- Exchange(distribution=[hash[att]])
+   +- LocalHashAggregate(groupBy=[att], select=[att, Partial_COUNT(att) AS count$0])
+      +- Union(all=[true], union=[att])
+         :- Union(all=[true], union=[att])
+         :  :- Union(all=[true], union=[att])
+         :  :  :- Union(all=[true], union=[att])
+         :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Reused(reference_id=[1])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[2])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[3])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[4])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[5])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[6])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[7])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[8])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[9])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[10])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[11])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[12])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[13])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[14])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[15])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[16])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[17])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[18])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[19])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[20])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[21])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[22])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[23])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[24])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[25])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[26])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[27])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[28])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[29])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[30])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[31])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[32])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[33])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[34])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[35])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[36])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[37])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[38])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[39])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[40])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[41])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[42])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[43])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[44])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[45])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[46])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[47])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[48])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[49])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[50])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[51])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[52])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[53])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[54])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[55])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[56])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[57])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[58])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[59])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[60])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[61])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[62])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[63])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[64])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[65])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[66])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[67])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[68])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[69])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[70])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[71])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[72])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[73])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[74])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[75])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[76])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[77])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[78])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[79])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[80])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[81])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[82])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[83])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[84])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[85])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[86])
+         :  :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[87])
+         :  :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[88])
+         :  :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[89])
+         :  :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[90])
+         :  :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :  :     +- Reused(reference_id=[91])
+         :  :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :  :     +- Reused(reference_id=[92])
+         :  :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :  :     +- Reused(reference_id=[93])
+         :  :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :  :     +- Reused(reference_id=[94])
+         :  :  :  :  :  +- Calc(select=[att])
+         :  :  :  :  :     +- Reused(reference_id=[95])
+         :  :  :  :  +- Calc(select=[att])
+         :  :  :  :     +- Reused(reference_id=[96])
+         :  :  :  +- Calc(select=[att])
+         :  :  :     +- Reused(reference_id=[97])
+         :  :  +- Calc(select=[att])
+         :  :     +- Reused(reference_id=[98])
+         :  +- Calc(select=[att])
+         :     +- Reused(reference_id=[99])
+         +- Calc(select=[att])
+            +- Reused(reference_id=[100])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDynamicFilteringFactInRightWithExchangeAndCalcRule">
-    <Resource name="sql">
-      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and fact_part.price > 200 and dim.price < 500]]>
-    </Resource>
+  <TestCase name="testLargeQueryPlanShouldNotOutOfMemoryWithTableApi">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), >($8, 200), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+:- LogicalUnion(all=[true])
+:  :- LogicalUnion(all=[true])
+:  :  :- LogicalUnion(all=[true])
+:  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalTableScan(table=[[testCatalog, test_database, table0]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table1]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table2]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table3]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table4]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table5]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table6]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table7]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table8]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table9]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table10]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table11]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table12]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table13]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table14]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table15]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table16]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table17]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table18]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table19]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table20]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table21]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table22]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table23]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table24]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table25]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table26]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table27]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table28]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table29]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table30]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table31]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table32]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table33]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table34]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table35]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table36]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table37]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table38]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table39]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table40]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table41]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table42]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table43]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table44]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table45]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table46]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table47]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table48]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table49]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table50]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table51]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table52]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table53]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table54]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table55]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table56]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table57]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table58]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table59]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table60]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table61]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table62]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table63]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table64]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table65]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table66]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table67]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table68]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table69]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table70]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table71]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table72]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table73]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table74]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table75]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table76]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table77]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table78]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table79]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table80]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table81]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table82]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table83]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table84]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table85]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table86]])
+:  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table87]])
+:  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table88]])
+:  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table89]])
+:  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table90]])
+:  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table91]])
+:  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table92]])
+:  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table93]])
+:  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table94]])
+:  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table95]])
+:  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table96]])
+:  :  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table97]])
+:  :  +- LogicalProject(att=[$0], filename=[$1])
+:  :     +- LogicalTableScan(table=[[testCatalog, test_database, table98]])
+:  +- LogicalProject(att=[$0], filename=[$1])
+:     +- LogicalTableScan(table=[[testCatalog, test_database, table99]])
++- LogicalProject(l_key=[$0])
+   +- LogicalFilter(condition=[>($1, 1)])
+      +- LogicalProject(att=[$0], CNM=[$1])
+         +- LogicalAggregate(group=[{0}], EXPR$0=[COUNT($0)])
+            +- LogicalUnion(all=[true])
+               :- LogicalUnion(all=[true])
+               :  :- LogicalUnion(all=[true])
+               :  :  :- LogicalUnion(all=[true])
+               :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalUnion(all=[true])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalTableScan(table=[[testCatalog, test_database, table0]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table1]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table2]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table3]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table4]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table5]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table6]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table7]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table8]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table9]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table10]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table11]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table12]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table13]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table14]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table15]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table16]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table17]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table18]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table19]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table20]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table21]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table22]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table23]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table24]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table25]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table26]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table27]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table28]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table29]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table30]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table31]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table32]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table33]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table34]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table35]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table36]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table37]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table38]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table39]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table40]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table41]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table42]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table43]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table44]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table45]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table46]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table47]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table48]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table49]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table50]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table51]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table52]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table53]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table54]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table55]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table56]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table57]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table58]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table59]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table60]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table61]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table62]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table63]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table64]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table65]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table66]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table67]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table68]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table69]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table70]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table71]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table72]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table73]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table74]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table75]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table76]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table77]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table78]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table79]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table80]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table81]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table82]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table83]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table84]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table85]])
+               :  :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table86]])
+               :  :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table87]])
+               :  :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table88]])
+               :  :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table89]])
+               :  :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table90]])
+               :  :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table91]])
+               :  :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table92]])
+               :  :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table93]])
+               :  :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table94]])
+               :  :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table95]])
+               :  :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table96]])
+               :  :  +- LogicalProject(att=[$0], filename=[$1])
+               :  :     +- LogicalTableScan(table=[[testCatalog, test_database, table97]])
+               :  +- LogicalProject(att=[$0], filename=[$1])
+               :     +- LogicalTableScan(table=[[testCatalog, test_database, table98]])
+               +- LogicalProject(att=[$0], filename=[$1])
+                  +- LogicalTableScan(table=[[testCatalog, test_database, table99]])
 ]]>
     </Resource>
-    <Resource name="optimized rel plan">
+    <Resource name="optimized exec plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 200)])
-      +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
-         +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-            +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-               +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(att = l_key)], select=[att, filename, l_key], build=[right])\n:- [#1] Exchange(distribution=[hash[att]])\n+- Calc(select=[att AS l_key], where=[(EXPR$0 > 1)])\n   +- HashAggregate(isMerge=[true], groupBy=[att], select=[att, Final_COUNT(count$0) AS EXPR$0])\n      +- [#2] Exchange(distribution=[hash[att]])\n])
+:- Exchange(distribution=[hash[att]])
+:  +- Union(all=[true], union=[att, filename])(reuse_id=[1])
+:     :- Union(all=[true], union=[att, filename])
+:     :  :- Union(all=[true], union=[att, filename])
+:     :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- Union(all=[true], union=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :- TableSourceScan(table=[[testCatalog, test_database, table0]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table1]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table2]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table3]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table4]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table5]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table6]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table7]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table8]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table9]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table10]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table11]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table12]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table13]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table14]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table15]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table16]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table17]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table18]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table19]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table20]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table21]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table22]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table23]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table24]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table25]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table26]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table27]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table28]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table29]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table30]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table31]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table32]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table33]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table34]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table35]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table36]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table37]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table38]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table39]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table40]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table41]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table42]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table43]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table44]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table45]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table46]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table47]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table48]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table49]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table50]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table51]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table52]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table53]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table54]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table55]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table56]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table57]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table58]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table59]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table60]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table61]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table62]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table63]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table64]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table65]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table66]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table67]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table68]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table69]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table70]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table71]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table72]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table73]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table74]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table75]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table76]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table77]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table78]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table79]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table80]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table81]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table82]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table83]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table84]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table85]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table86]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table87]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table88]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table89]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table90]], fields=[att, filename])
+:     :  :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table91]], fields=[att, filename])
+:     :  :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table92]], fields=[att, filename])
+:     :  :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table93]], fields=[att, filename])
+:     :  :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table94]], fields=[att, filename])
+:     :  :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table95]], fields=[att, filename])
+:     :  :  :  +- TableSourceScan(table=[[testCatalog, test_database, table96]], fields=[att, filename])
+:     :  :  +- TableSourceScan(table=[[testCatalog, test_database, table97]], fields=[att, filename])
+:     :  +- TableSourceScan(table=[[testCatalog, test_database, table98]], fields=[att, filename])
+:     +- TableSourceScan(table=[[testCatalog, test_database, table99]], fields=[att, filename])
++- Exchange(distribution=[hash[att]])
+   +- LocalHashAggregate(groupBy=[att], select=[att, Partial_COUNT(att) AS count$0])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDynamicFilteringFactInRightWithExchangeRule">
+  <TestCase name="testLeftOutJoinWithFactInRight">
     <Resource name="sql">
-      <![CDATA[Select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+      <![CDATA[Select * from dim left outer join fact_part on fact_part.fact_date_sk = dim.dim_date_sk where dim.price < 500]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
++- LogicalFilter(condition=[<($3, 500)])
+   +- LogicalJoin(condition=[=($9, $4)], joinType=[left])
       :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
       +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+HashJoin(joinType=[LeftOuterJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
 :- Exchange(distribution=[hash[dim_date_sk]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
 :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
@@ -1632,134 +3001,6 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id,
       +- DynamicFilteringDataCollector(fields=[dim_date_sk])
          +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
             +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testDynamicFilteringFieldIsComputeColumnsInFactSide">
-    <Resource name="sql">
-      <![CDATA[Select * from dim join (select fact_date_sk, amount + 1 as amount from fact_part) t1 on fact_date_sk = dim_date_sk and t1.amount = dim.amount where dim.price < 500]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$5], amount0=[$6])
-+- LogicalFilter(condition=[<($3, 500)])
-   +- LogicalJoin(condition=[AND(=($5, $4), =($6, $2))], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalProject(fact_date_sk=[$4], amount=[+($2, 1)])
-         +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[AND(=(fact_date_sk, dim_date_sk), =(amount0, amount))], select=[id, male, amount, price, dim_date_sk, fact_date_sk, amount0], build=[left])
-:- Exchange(distribution=[broadcast])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Calc(select=[fact_date_sk, +(amount, 1) AS amount])
-   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, project=[fact_date_sk, amount], metadata=[]]], fields=[fact_date_sk, amount])
-      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testFactTableIsLegacySource">
-    <Resource name="sql">
-      <![CDATA[Select * from dim, legacy_source where legacy_source.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, legacy_source]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- TableSourceScan(table=[[testCatalog, test_database, legacy_source]], fields=[id, name, amount, price, fact_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testFactTableIsNotPartitionTable">
-    <Resource name="sql">
-      <![CDATA[Select * from dim, none_part_fact where none_part_fact.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, none_part_fact]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- TableSourceScan(table=[[testCatalog, test_database, none_part_fact]], fields=[id, name, amount, price, fact_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testFullOuterJoin">
-    <Resource name="sql">
-      <![CDATA[Select * from fact_part full outer join (select *  from dim where dim.price < 500) on fact_date_sk = dim_date_sk]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalJoin(condition=[=($4, $9)], joinType=[full])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-   +- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4])
-      +- LogicalFilter(condition=[<($3, 500)])
-         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[FullOuterJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinKeyIsDynamicFilterFieldNotPartitionKey">
-    <Resource name="sql">
-      <![CDATA[Select * from dim, fact_part where fact_part.amount = dim.amount and dim.price < 500]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($7, $2), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount0, amount)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[amount]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-      +- DynamicFilteringDataCollector(fields=[amount])
-         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
@@ -1787,33 +3028,6 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id,
 +- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftOutJoinWithFactInRight">
-    <Resource name="sql">
-      <![CDATA[Select * from dim left outer join fact_part on fact_part.fact_date_sk = dim.dim_date_sk where dim.price < 500]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[<($3, 500)])
-   +- LogicalJoin(condition=[=($9, $4)], joinType=[left])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
@@ -1900,6 +3114,34 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id,
          +- DynamicFilteringDataCollector(fields=[dim_date_sk])
             +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
                +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartitionKeysOrderIsChangedInFactSide">
+    <Resource name="sql">
+      <![CDATA[Select * from dim join (select fact_date_sk, id, name, amount, price from fact_part) t1 on t1.fact_date_sk = dim_date_sk and t1.price > 200 and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$5], id0=[$6], name=[$7], amount0=[$8], price0=[$9])
++- LogicalJoin(condition=[AND(=($5, $4), >($9, 200), <($3, 500))], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+   +- LogicalProject(fact_date_sk=[$4], id=[$0], name=[$1], amount=[$2], price=[$3])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, fact_date_sk, id0, name, amount0, price0], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- Calc(select=[fact_date_sk, id, name, amount, price], where=[>(price, 200)])
+      +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
+         +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+            +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+               +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
@@ -1929,34 +3171,6 @@ HashJoin(joinType=[LeftSemiJoin], where=[=(fact_date_sk, dim_date_sk)], select=[
 +- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartitionKeysOrderIsChangedInFactSide">
-    <Resource name="sql">
-      <![CDATA[Select * from dim join (select fact_date_sk, id, name, amount, price from fact_part) t1 on t1.fact_date_sk = dim_date_sk and t1.price > 200 and dim.price < 500]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$5], id0=[$6], name=[$7], amount0=[$8], price0=[$9])
-+- LogicalJoin(condition=[AND(=($5, $4), >($9, 200), <($3, 500))], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-   +- LogicalProject(fact_date_sk=[$4], id=[$0], name=[$1], amount=[$2], price=[$3])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, fact_date_sk, id0, name, amount0, price0], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- Calc(select=[fact_date_sk, id, name, amount, price], where=[>(price, 200)])
-      +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
-         +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-            +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-               +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/FlinkRuntimeFilterProgramTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/FlinkRuntimeFilterProgramTest.xml
index 8df49b0e10b..30e6abb2451 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/FlinkRuntimeFilterProgramTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/optimize/program/FlinkRuntimeFilterProgramTest.xml
@@ -16,277 +16,615 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testSimpleInnerJoin">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+  <TestCase name="testAntiJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact where fact.fact_date_sk not in (select dim_date_sk from dim where dim.price < 500)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4])
++- LogicalFilter(condition=[NOT(IN($4, {
+LogicalProject(dim_date_sk=[$4])
+  LogicalFilter(condition=[<($3, 500)])
+    LogicalTableScan(table=[[testCatalog, test_database, dim]])
+}))])
+   +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount]])
-:  +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(fact_date_sk), IS NULL(dim_date_sk), =(fact_date_sk, dim_date_sk))], select=[id, name, amount, price, fact_date_sk], build=[right])
+:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[1,0], members=[\nNestedLoopJoin(joinType=[LeftAntiJoin], where=[(fact_date_sk IS NULL OR dim_date_sk IS NULL OR (fact_date_sk = dim_date_sk))], select=[id, name, amount, price, fact_date_sk], build=[right])\n:- [#1] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n+- [#2] Exchange(distribution=[broadcast])\n])
+:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[dim_date_sk], where=[(price < 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testBuildSideIsAggWithoutExchange">
+    <Resource name="sql">
+      <![CDATA[select * from fact join (select dim_date_sk, sum(dim.price) from dim where  dim.price < 500 group by dim_date_sk) dimSide on fact.fact_date_sk = dimSide.dim_date_sk]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], EXPR$1=[$6])
++- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+   +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
+      +- LogicalProject(dim_date_sk=[$4], price=[$3])
+         +- LogicalFilter(condition=[<($3, 500)])
+            +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])
 :     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
 :     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
+:     :           +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 :     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])
+   +- Exchange(distribution=[hash[dim_date_sk]])
+      +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
+         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount]])
-:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1], build=[right])\n:- [#1] Exchange(distribution=[hash[fact_date_sk]])\n+- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])\n   +- [#2] Exchange(distribution=[hash[dim_date_sk]])\n])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
 :     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
 :     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
+:     :           +- Calc(select=[price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 :     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
++- Exchange(distribution=[hash[dim_date_sk]])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testSemiJoin">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4])
-+- LogicalFilter(condition=[IN($4, {
-LogicalProject(dim_date_sk=[$4])
-  LogicalFilter(condition=[<($3, 500)])
-    LogicalTableScan(table=[[testCatalog, test_database, dim]])
-})])
-   +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testBuildSideIsCalcWithoutExchange">
+    <Resource name="sql">
+      <![CDATA[select * from fact join (select dim_date_sk, sum(dim.price) + 1 as sum_price from dim where  dim.price < 500 group by dim_date_sk) dimSide on fact.fact_date_sk = dimSide.dim_date_sk]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], sum_price=[$6])
++- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+   +- LogicalProject(dim_date_sk=[$0], sum_price=[+($1, 1)])
+      +- LogicalAggregate(group=[{0}], agg#0=[SUM($1)])
+         +- LogicalProject(dim_date_sk=[$4], price=[$3])
+            +- LogicalFilter(condition=[<($3, 500)])
+               +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk], build=[right])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, sum_price], build=[right])
 :- Exchange(distribution=[hash[fact_date_sk]])
 :  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])
 :     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
 :     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
-:     :           +- Calc(select=[dim_date_sk], where=[<(price, 500)])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
+:     :           +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
 :     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 :     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
++- Calc(select=[dim_date_sk, +($f1, 1) AS sum_price])
+   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS $f1])
+      +- Exchange(distribution=[hash[dim_date_sk]])
+         +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[LeftSemiJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk], build=[right])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, sum_price], build=[right])\n:- [#1] Exchange(distribution=[hash[fact_date_sk]])\n+- Calc(select=[dim_date_sk, ($f1 + 1) AS sum_price])\n   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS $f1])\n      +- [#2] Exchange(distribution=[hash[dim_date_sk]])\n])
 :- Exchange(distribution=[hash[fact_date_sk]])
 :  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
 :     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
 :     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
-:     :           +- Calc(select=[dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
+:     :           +- Calc(select=[price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
 :     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 :     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[dim_date_sk]])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftOuterJoinWithLeftBuild">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalJoin(condition=[AND(=($7, $2), <($3, 500))], joinType=[left])
-   :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-   +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testBuildSideIsJoinWithTwoAggInputs">
+    <Resource name="sql">
+      <![CDATA[select * from fact join (select * from (select dim_date_sk, sum(dim.price) from dim group by dim_date_sk) agg1 join (select dim_date_sk, sum(dim.amount) from dim group by dim_date_sk) agg2 on agg1.dim_date_sk = agg2.dim_date_sk) as dimSide on fact.fact_date_sk = dimSide.dim_date_sk]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], EXPR$1=[$6], dim_date_sk0=[$7], EXPR$10=[$8])
++- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+   +- LogicalProject(dim_date_sk=[$0], EXPR$1=[$1], dim_date_sk0=[$2], EXPR$10=[$3])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner])
+         :- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
+         :  +- LogicalProject(dim_date_sk=[$4], price=[$3])
+         :     +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+         +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
+            +- LogicalProject(dim_date_sk=[$4], amount=[$2])
+               +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[AND(=(amount0, amount), <(price, 500))], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.9998779296875])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
+:     :           +- Calc(select=[dim_date_sk, amount])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- HashJoin(joinType=[InnerJoin], where=[=(dim_date_sk, dim_date_sk0)], select=[dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[left])
+   :- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])
+   :  +- Exchange(distribution=[hash[dim_date_sk]])
+   :     +- Calc(select=[dim_date_sk, price])
+   :        +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])
+   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(amount) AS EXPR$1])
+      +- Exchange(distribution=[hash[dim_date_sk]])
+         +- Calc(select=[dim_date_sk, amount])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[2,0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[right])\n:- [#1] Exchange(distribution=[hash[fact_date_sk]])\n+- HashJoin(joinType=[InnerJoin], where=[(dim_date_sk = dim_date_sk0)], select=[dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[left])\n   :- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])\n   :  +- [#2] Exchange(distribution=[hash[dim_date_sk]])\n   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(amount) AS EXPR$1])\n      +- [#3] Exchange(distribution=[hash[dim_date_sk]])\n])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.9998779296875])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
+:     :           +- Calc(select=[dim_date_sk, amount])(reuse_id=[2])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])(reuse_id=[1])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[dim_date_sk, price])
+:     +- Reused(reference_id=[1])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Reused(reference_id=[2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testBuildSideIsJoinWithoutExchange">
+    <Resource name="sql">
+      <![CDATA[select * from dim, fact, fact2 where fact.amount = fact2.amount and fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9], id1=[$10], amount1=[$11], price1=[$12])
++- LogicalFilter(condition=[AND(=($7, $11), =($7, $2), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount0, amount1)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk, id1, amount1, price1], build=[left])
+:- HashJoin(joinType=[InnerJoin], where=[=(amount0, amount)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:  :- Exchange(distribution=[hash[amount]])
+:  :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:  :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:  +- Exchange(distribution=[hash[amount]])
+:     +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
+:        :- Exchange(distribution=[broadcast])
+:        :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:        :     +- Exchange(distribution=[single])
+:        :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:        :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:        :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:        +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[amount]])
-   +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.9998779296875])
+   +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
       :- Exchange(distribution=[broadcast])
-      :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
+      :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
       :     +- Exchange(distribution=[single])
-      :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
-      :           +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])
-      +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+      :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+      :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+      +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[((amount0 = amount) AND (price < 500))], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[2,0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount0 = amount1)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk, id1, amount1, price1], build=[left])\n:- HashJoin(joinType=[InnerJoin], where=[(amount0 = amount)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])\n:  :- [#2] Exchange(distribution=[hash[amount]])\n:  +- [#3] Exchange(distribution=[hash[amount]])\n+- [#1] Exchange(distribution=[hash[amount]])\n])
 :- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])(reuse_id=[1])
+:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])\n])
+:     :- Exchange(distribution=[broadcast])(reuse_id=[2])
+:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])
+:- Exchange(distribution=[hash[amount]])
+:  +- Reused(reference_id=[1])
 +- Exchange(distribution=[hash[amount]])
-   +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.9998779296875])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
-      :- Exchange(distribution=[broadcast])
-      :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
-      :     +- Exchange(distribution=[single])
-      :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
-      :           +- Reused(reference_id=[1])
+   +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+      :- Reused(reference_id=[2])
       +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftOuterJoinWithRightBuild">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalJoin(condition=[AND(=($2, $7), <($8, 500))], joinType=[left])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-   +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testBuildSideIsLeftJoinWithoutExchange">
+    <Resource name="sql">
+      <![CDATA[select * from fact2 join (select * from fact left join dim on dim.amount = fact.amount and dim.price < 500) as dimSide on fact2.amount = dimSide.amount]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], amount=[$1], price=[$2], fact_date_sk=[$3], id0=[$4], name=[$5], amount0=[$6], price0=[$7], fact_date_sk0=[$8], id00=[$9], male=[$10], amount00=[$11], price00=[$12], dim_date_sk=[$13])
++- LogicalJoin(condition=[=($1, $6)], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
+   +- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
+      +- LogicalJoin(condition=[AND(=($7, $2), <($8, 500))], joinType=[left])
+         :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, amount, price, fact_date_sk, id0, name, amount0, price0, fact_date_sk0, id00, male, amount00, price00, dim_date_sk], build=[left])
+:- Exchange(distribution=[hash[amount]])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price, fact_date_sk])
++- HashJoin(joinType=[LeftOuterJoin], where=[=(amount0, amount)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+   :- Exchange(distribution=[hash[amount]])
+   :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+   +- Exchange(distribution=[hash[amount]])
+      +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, amount, price, fact_date_sk, id0, name, amount0, price0, fact_date_sk0, id00, male, amount00, price00, dim_date_sk], build=[left])\n:- [#1] Exchange(distribution=[hash[amount]])\n+- HashJoin(joinType=[LeftOuterJoin], where=[(amount0 = amount)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])\n   :- [#2] Exchange(distribution=[hash[amount]])\n   +- [#3] Exchange(distribution=[hash[amount]])\n])
+:- Exchange(distribution=[hash[amount]])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price, fact_date_sk])
 :- Exchange(distribution=[hash[amount]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[LeftOuterJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+    </Resource>
+  </TestCase>
+  <TestCase name="testBuildSideIsTooLarge">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim where fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testFullOuterJoin">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalJoin(condition=[=($4, $9)], joinType=[full])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-   +- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4])
-      +- LogicalFilter(condition=[<($3, 500)])
-         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[FullOuterJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[FullOuterJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[amount]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
++- Exchange(distribution=[hash[amount]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testAntiJoin">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4])
-+- LogicalFilter(condition=[NOT(IN($4, {
-LogicalProject(dim_date_sk=[$4])
-  LogicalFilter(condition=[<($3, 500)])
-    LogicalTableScan(table=[[testCatalog, test_database, dim]])
-}))])
-   +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotInjectMoreThanOneRuntimeFilterInSamePlace">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim, dim2 where fact.amount = dim.amount and fact.amount = dim2.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9], id1=[$10], amount1=[$11], price1=[$12])
++- LogicalFilter(condition=[AND(=($2, $7), =($2, $11), <($8, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalJoin(condition=[true], joinType=[inner])
+      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-NestedLoopJoin(joinType=[LeftAntiJoin], where=[OR(IS NULL(fact_date_sk), IS NULL(dim_date_sk), =(fact_date_sk, dim_date_sk))], select=[id, name, amount, price, fact_date_sk], build=[right])
-:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount, amount1)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk, id1, amount1, price1], build=[right])
+:- HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:  :- Exchange(distribution=[hash[amount]])
+:  :  +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
+:  :     :- Exchange(distribution=[broadcast])
+:  :     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:  :     :     +- Exchange(distribution=[single])
+:  :     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:  :     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:  :     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:  :     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+:  +- Exchange(distribution=[hash[amount]])
+:     +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:        +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- TableSourceScan(table=[[testCatalog, test_database, dim2]], fields=[id, amount, price])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nNestedLoopJoin(joinType=[LeftAntiJoin], where=[(fact_date_sk IS NULL OR dim_date_sk IS NULL OR (fact_date_sk = dim_date_sk))], select=[id, name, amount, price, fact_date_sk], build=[right])\n:- [#1] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n+- [#2] Exchange(distribution=[broadcast])\n])
-:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[dim_date_sk], where=[(price < 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[0,1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount1)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk, id1, amount1, price1], build=[right])\n:- HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])\n:  :- [#2] Exchange(distribution=[hash[amount]])\n:  +- [#3] Exchange(distribution=[hash[amount]])\n+- [#1] Exchange(distribution=[hash[amount]])\n])
+:- Exchange(distribution=[hash[amount]])
+:  +- TableSourceScan(table=[[testCatalog, test_database, dim2]], fields=[id, amount, price])
+:- Exchange(distribution=[hash[amount]])
+:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testNestedLoopJoin">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownProbeSideWithAgg">
+    <Resource name="sql">
+      <![CDATA[select * from dim join (select id, fact_date_sk, sum(fact.price) as sum_price from fact group by (id, fact_date_sk)) factSide on dim.price = factSide.sum_price and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], fact_date_sk=[$6], sum_price=[$7])
++- LogicalJoin(condition=[AND(=($3, $7), <($3, 500))], joinType=[inner])
+   :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+   +- LogicalAggregate(group=[{0, 1}], sum_price=[SUM($2)])
+      +- LogicalProject(id=[$0], fact_date_sk=[$4], price=[$3])
+         +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-NestedLoopJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[broadcast])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(price, sum_price)], select=[id, male, amount, price, dim_date_sk, id0, fact_date_sk, sum_price], build=[left])
+:- Exchange(distribution=[hash[price]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[sum_price]])
+   +- Calc(select=[id, fact_date_sk, sum_price], where=[<(sum_price, 500)])
+      +- RuntimeFilter(select=[sum_price], estimatedFilterRatio=[0.9999996711817046])
+         :- Exchange(distribution=[broadcast])
+         :  +- GlobalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :     +- Exchange(distribution=[single])
+         :        +- LocalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+         :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+         +- HashAggregate(isMerge=[false], groupBy=[id, fact_date_sk], select=[id, fact_date_sk, SUM(price) AS sum_price])
+            +- Exchange(distribution=[hash[id, fact_date_sk]])
+               +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[id, fact_date_sk, price], metadata=[]]], fields=[id, fact_date_sk, price])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(price = sum_price)], select=[id, male, amount, price, dim_date_sk, id0, fact_date_sk, sum_price], build=[left])
+:- Exchange(distribution=[hash[price]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[sum_price]])
+   +- Calc(select=[id, fact_date_sk, sum_price], where=[(sum_price < 500)])
+      +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[sum_price], estimatedFilterRatio=[0.9999996711817046])\n:- [#1] Exchange(distribution=[broadcast])\n+- HashAggregate(isMerge=[false], groupBy=[id, fact_date_sk], select=[id, fact_date_sk, SUM(price) AS sum_price])\n   +- [#2] Exchange(distribution=[hash[id, fact_date_sk]])\n])
+         :- Exchange(distribution=[broadcast])
+         :  +- GlobalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :     +- Exchange(distribution=[single])
+         :        +- LocalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :           +- Reused(reference_id=[1])
+         +- Exchange(distribution=[hash[id, fact_date_sk]])
+            +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[id, fact_date_sk, price], metadata=[]]], fields=[id, fact_date_sk, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownProbeSideWithCalc">
+    <Resource name="sql">
+      <![CDATA[select * from dim inner join (select fact_date_sk, RAND(10) as random from fact) as factSide on dim.amount = factSide.random and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$5], random=[$6])
++- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$6], random=[$7])
+   +- LogicalJoin(condition=[AND(=($5, $7), <($3, 500))], joinType=[inner])
+      :- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], amount0=[CAST($2):DOUBLE])
+      :  +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalProject(fact_date_sk=[$4], random=[RAND(10)])
+         +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[id, male, amount, price, dim_date_sk, fact_date_sk, random])
++- HashJoin(joinType=[InnerJoin], where=[=(amount0, random)], select=[id, male, amount, price, dim_date_sk, amount0, fact_date_sk, random], build=[left])
+   :- Exchange(distribution=[hash[amount0]])
+   :  +- Calc(select=[id, male, amount, price, dim_date_sk, CAST(amount AS DOUBLE) AS amount0], where=[<(price, 500)])
+   :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+   +- Exchange(distribution=[hash[random]])
+      +- RuntimeFilter(select=[random], estimatedFilterRatio=[0.99993896484375])
+         :- Exchange(distribution=[broadcast])
+         :  +- GlobalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
+         :     +- Exchange(distribution=[single])
+         :        +- LocalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
+         :           +- Calc(select=[id, male, amount, price, dim_date_sk, CAST(amount AS DOUBLE) AS amount0], where=[<(price, 500)])
+         :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+         +- Calc(select=[fact_date_sk, RAND(10) AS random])
+            +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[fact_date_sk], metadata=[]]], fields=[fact_date_sk])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[id, male, amount, price, dim_date_sk, fact_date_sk, random])
++- HashJoin(joinType=[InnerJoin], where=[(amount0 = random)], select=[id, male, amount, price, dim_date_sk, amount0, fact_date_sk, random], build=[left])
+   :- Exchange(distribution=[hash[amount0]])
+   :  +- Calc(select=[id, male, amount, price, dim_date_sk, CAST(amount AS DOUBLE) AS amount0], where=[(price < 500)])(reuse_id=[1])
+   :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+   +- Exchange(distribution=[hash[random]])
+      +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[random], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- Calc(select=[fact_date_sk, RAND(10) AS random])\n   +- [#2] TableSourceScan(table=[[testCatalog, test_database, fact, project=[fact_date_sk], metadata=[]]], fields=[fact_date_sk])\n])
+         :- Exchange(distribution=[broadcast])
+         :  +- GlobalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
+         :     +- Exchange(distribution=[single])
+         :        +- LocalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
+         :           +- Reused(reference_id=[1])
+         +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[fact_date_sk], metadata=[]]], fields=[fact_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownProbeSideWithJoin">
+    <Resource name="sql">
+      <![CDATA[select * from (select * from fact inner join fact2 on fact.id = fact2.id2) as factSide inner join dim on factSide.amount = dim.amount and factSide.price2 = dim.price and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id2=[$5], amount2=[$6], price2=[$7], id0=[$8], male=[$9], amount0=[$10], price0=[$11], dim_date_sk=[$12])
++- LogicalJoin(condition=[AND(=($2, $10), =($7, $11), <($11, 500))], joinType=[inner])
+   :- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id2=[$5], amount2=[$6], price2=[$7])
+   :  +- LogicalJoin(condition=[=($0, $5)], joinType=[inner])
+   :     :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+   :     +- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
+   +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[AND(=(amount, amount0), =(price2, price0))], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[amount, price2]])
+:  +- RuntimeFilter(select=[amount, price2], estimatedFilterRatio=[0.9997287326388888])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     +- HashJoin(joinType=[InnerJoin], where=[=(id, id2)], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2], build=[right])
+:        :- Exchange(distribution=[hash[id]])
+:        :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+:        +- Exchange(distribution=[hash[id2]])
+:           +- Calc(select=[id2, amount2, price2], where=[<(price2, 500)])
+:              +- TableSourceScan(table=[[testCatalog, test_database, fact2, filter=[]]], fields=[id2, amount2, price2])
++- Exchange(distribution=[hash[amount, price]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])\n:- [#1] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n+- [#2] Exchange(distribution=[broadcast])\n])
-:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[broadcast])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[((amount = amount0) AND (price2 = price0))], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[amount, price2]])
+:  +- MultipleInput(readOrder=[0,1,0], members=[\nRuntimeFilter(select=[amount, price2], estimatedFilterRatio=[0.9997287326388888])\n:- [#1] Exchange(distribution=[broadcast])\n+- HashJoin(joinType=[InnerJoin], where=[(id = id2)], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2], build=[right])\n   :- [#2] Exchange(distribution=[hash[id]])\n   +- [#3] Exchange(distribution=[hash[id2]])\n])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     :- Exchange(distribution=[hash[id]])
+:     :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+:     +- Exchange(distribution=[hash[id2]])
+:        +- Calc(select=[id2, amount2, price2], where=[(price2 < 500)])
+:           +- TableSourceScan(table=[[testCatalog, test_database, fact2, filter=[]]], fields=[id2, amount2, price2])
++- Exchange(distribution=[hash[amount, price]])
+   +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testProbeSideIsTooSmall">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testDoesNotApplyRuntimeFilterAndDPPOnSameKey">
+    <Resource name="sql">
+      <![CDATA[select * from dim, fact_part where fact_part.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[dim_date_sk]])
+:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
++- Exchange(distribution=[hash[fact_date_sk]])
+   +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])\n])
+      :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
+      :  +- DynamicFilteringDataCollector(fields=[dim_date_sk])
+      :     +- Reused(reference_id=[1])
+      +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testFilterRatioIsTooSmall">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim where fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
 +- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
       +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
@@ -294,9 +632,9 @@ HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amo
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
@@ -304,485 +642,225 @@ HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amo
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testBuildSideIsTooLarge">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testFullOuterJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact full outer join (select * from dim where dim.price < 500) on fact_date_sk = dim_date_sk]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
++- LogicalJoin(condition=[=($4, $9)], joinType=[full])
+   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+   +- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4])
+      +- LogicalFilter(condition=[<($3, 500)])
+         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount]])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[FullOuterJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
++- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount]])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[FullOuterJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
++- Exchange(distribution=[hash[dim_date_sk]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-
-	<TestCase name="testFilterRatioIsTooSmall">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinWithLeftBuild">
+    <Resource name="sql">
+      <![CDATA[select * from dim left outer join fact on fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalJoin(condition=[AND(=($7, $2), <($3, 500))], joinType=[left])
+   :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+   +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftOuterJoin], where=[AND(=(amount0, amount), <(price, 500))], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
 :- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testBuildSideIsJoinWithoutExchange">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9], id1=[$10], amount1=[$11], price1=[$12])
-+- LogicalFilter(condition=[AND(=($7, $11), =($7, $2), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount0, amount1)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk, id1, amount1, price1], build=[left])
-:- HashJoin(joinType=[InnerJoin], where=[=(amount0, amount)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:  :- Exchange(distribution=[hash[amount]])
-:  :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:  :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:  +- Exchange(distribution=[hash[amount]])
-:     +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
-:        :- Exchange(distribution=[broadcast])
-:        :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:        :     +- Exchange(distribution=[single])
-:        :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:        :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:        :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:        +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+:  +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])
 +- Exchange(distribution=[hash[amount]])
-   +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
+   +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.9998779296875])
       :- Exchange(distribution=[broadcast])
-      :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+      :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
       :     +- Exchange(distribution=[single])
-      :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-      :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-      +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])
+      :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
+      :           +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])
+      +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[2,0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount0 = amount1)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk, id1, amount1, price1], build=[left])\n:- HashJoin(joinType=[InnerJoin], where=[(amount0 = amount)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])\n:  :- [#2] Exchange(distribution=[hash[amount]])\n:  +- [#3] Exchange(distribution=[hash[amount]])\n+- [#1] Exchange(distribution=[hash[amount]])\n])
-:- Exchange(distribution=[hash[amount]])
-:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])\n])
-:     :- Exchange(distribution=[broadcast])(reuse_id=[2])
-:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[LeftOuterJoin], where=[((amount0 = amount) AND (price < 500))], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
 :- Exchange(distribution=[hash[amount]])
-:  +- Reused(reference_id=[1])
+:  +- TableSourceScan(table=[[testCatalog, test_database, dim]], fields=[id, male, amount, price, dim_date_sk])(reuse_id=[1])
 +- Exchange(distribution=[hash[amount]])
-   +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
-      :- Reused(reference_id=[2])
+   +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.9998779296875])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+      :- Exchange(distribution=[broadcast])
+      :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
+      :     +- Exchange(distribution=[single])
+      :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[131072], maxRowCount=[218454])
+      :           +- Reused(reference_id=[1])
       +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testBuildSideIsJoinWithTwoAggInputs">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], EXPR$1=[$6], dim_date_sk0=[$7], EXPR$10=[$8])
-+- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinWithRightBuild">
+    <Resource name="sql">
+      <![CDATA[select * from fact left outer join dim on fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalJoin(condition=[AND(=($2, $7), <($8, 500))], joinType=[left])
    :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-   +- LogicalProject(dim_date_sk=[$0], EXPR$1=[$1], dim_date_sk0=[$2], EXPR$10=[$3])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[inner])
-         :- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-         :  +- LogicalProject(dim_date_sk=[$4], price=[$3])
-         :     +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-         +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-            +- LogicalProject(dim_date_sk=[$4], amount=[$2])
-               +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.9998779296875])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
-:     :           +- Calc(select=[dim_date_sk, amount])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- HashJoin(joinType=[InnerJoin], where=[=(dim_date_sk, dim_date_sk0)], select=[dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[left])
-   :- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])
-   :  +- Exchange(distribution=[hash[dim_date_sk]])
-   :     +- Calc(select=[dim_date_sk, price])
-   :        +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])
-   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(amount) AS EXPR$1])
-      +- Exchange(distribution=[hash[dim_date_sk]])
-         +- Calc(select=[dim_date_sk, amount])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[2,0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[right])\n:- [#1] Exchange(distribution=[hash[fact_date_sk]])\n+- HashJoin(joinType=[InnerJoin], where=[(dim_date_sk = dim_date_sk0)], select=[dim_date_sk, EXPR$1, dim_date_sk0, EXPR$10], build=[left])\n   :- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])\n   :  +- [#2] Exchange(distribution=[hash[dim_date_sk]])\n   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(amount) AS EXPR$1])\n      +- [#3] Exchange(distribution=[hash[dim_date_sk]])\n])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.9998779296875])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[131072], maxRowCount=[436907])
-:     :           +- Calc(select=[dim_date_sk, amount])(reuse_id=[2])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, project=[amount, price, dim_date_sk], metadata=[]]], fields=[amount, price, dim_date_sk])(reuse_id=[1])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[dim_date_sk, price])
-:     +- Reused(reference_id=[1])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Reused(reference_id=[2])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testBuildSideIsLeftJoinWithoutExchange">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], amount=[$1], price=[$2], fact_date_sk=[$3], id0=[$4], name=[$5], amount0=[$6], price0=[$7], fact_date_sk0=[$8], id00=[$9], male=[$10], amount00=[$11], price00=[$12], dim_date_sk=[$13])
-+- LogicalJoin(condition=[=($1, $6)], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
-   +- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-      +- LogicalJoin(condition=[AND(=($7, $2), <($8, 500))], joinType=[left])
-         :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-         +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+   +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, amount, price, fact_date_sk, id0, name, amount0, price0, fact_date_sk0, id00, male, amount00, price00, dim_date_sk], build=[left])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftOuterJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price, fact_date_sk])
-+- HashJoin(joinType=[LeftOuterJoin], where=[=(amount0, amount)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-   :- Exchange(distribution=[hash[amount]])
-   :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-   +- Exchange(distribution=[hash[amount]])
-      +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[0,1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, amount, price, fact_date_sk, id0, name, amount0, price0, fact_date_sk0, id00, male, amount00, price00, dim_date_sk], build=[left])\n:- [#1] Exchange(distribution=[hash[amount]])\n+- HashJoin(joinType=[LeftOuterJoin], where=[(amount0 = amount)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])\n   :- [#2] Exchange(distribution=[hash[amount]])\n   +- [#3] Exchange(distribution=[hash[amount]])\n])
-:- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price, fact_date_sk])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[LeftOuterJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
 :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[amount]])
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testBuildSideIsAggWithoutExchange">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], EXPR$1=[$6])
-+- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-   +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-      +- LogicalProject(dim_date_sk=[$4], price=[$3])
-         +- LogicalFilter(condition=[<($3, 500)])
-            +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :           +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])
-   +- Exchange(distribution=[hash[dim_date_sk]])
-      +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
-         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, EXPR$1], build=[right])\n:- [#1] Exchange(distribution=[hash[fact_date_sk]])\n+- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS EXPR$1])\n   +- [#2] Exchange(distribution=[hash[dim_date_sk]])\n])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :           +- Calc(select=[price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Reused(reference_id=[1])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testBuildSideIsCalcWithoutExchange">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], dim_date_sk=[$5], sum_price=[$6])
-+- LogicalJoin(condition=[=($4, $5)], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-   +- LogicalProject(dim_date_sk=[$0], sum_price=[+($1, 1)])
-      +- LogicalAggregate(group=[{0}], agg#0=[SUM($1)])
-         +- LogicalProject(dim_date_sk=[$4], price=[$3])
-            +- LogicalFilter(condition=[<($3, 500)])
-               +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestedLoopJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim where fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, sum_price], build=[right])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :           +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Calc(select=[dim_date_sk, +($f1, 1) AS sum_price])
-   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS $f1])
-      +- Exchange(distribution=[hash[dim_date_sk]])
-         +- Calc(select=[price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+NestedLoopJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk, dim_date_sk, sum_price], build=[right])\n:- [#1] Exchange(distribution=[hash[fact_date_sk]])\n+- Calc(select=[dim_date_sk, ($f1 + 1) AS sum_price])\n   +- HashAggregate(isMerge=[false], groupBy=[dim_date_sk], select=[dim_date_sk, SUM(price) AS $f1])\n      +- [#2] Exchange(distribution=[hash[dim_date_sk]])\n])
-:- Exchange(distribution=[hash[fact_date_sk]])
-:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[436907])
-:     :           +- Calc(select=[price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[dim_date_sk]])
-   +- Reused(reference_id=[1])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+MultipleInput(readOrder=[1,0], members=[\nNestedLoopJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])\n:- [#1] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n+- [#2] Exchange(distribution=[broadcast])\n])
+:- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[broadcast])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCannotInjectMoreThanOneRuntimeFilterInSamePlace">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9], id1=[$10], amount1=[$11], price1=[$12])
-+- LogicalFilter(condition=[AND(=($2, $7), =($2, $11), <($8, 500))])
+    </Resource>
+  </TestCase>
+  <TestCase name="testProbeSideIsTableSourceWithoutExchange">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim where fact.amount = dim.amount and dim.price = 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($2, $7), =($8, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalJoin(condition=[true], joinType=[inner])
-      :  :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, dim2]])
+      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount, amount1)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk, id1, amount1, price1], build=[right])
-:- HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
-:  :- Exchange(distribution=[hash[amount]])
-:  :  +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
-:  :     :- Exchange(distribution=[broadcast])
-:  :     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:  :     :     +- Exchange(distribution=[single])
-:  :     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:  :     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:  :     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:  :     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-:  +- Exchange(distribution=[hash[amount]])
-:     +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:        +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- TableSourceScan(table=[[testCatalog, test_database, dim2]], fields=[id, amount, price])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[id, name, amount, price, fact_date_sk, id0, male, amount0, CAST(500 AS BIGINT) AS price0, dim_date_sk])
++- HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, dim_date_sk], isBroadcast=[true], build=[right])
+   :- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+   +- Exchange(distribution=[broadcast])
+      +- Calc(select=[id, male, amount, dim_date_sk], where=[=(price, 500)])
+         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-MultipleInput(readOrder=[0,1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount1)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk, id1, amount1, price1], build=[right])\n:- HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])\n:  :- [#2] Exchange(distribution=[hash[amount]])\n:  +- [#3] Exchange(distribution=[hash[amount]])\n+- [#1] Exchange(distribution=[hash[amount]])\n])
-:- Exchange(distribution=[hash[amount]])
-:  +- TableSourceScan(table=[[testCatalog, test_database, dim2]], fields=[id, amount, price])
-:- Exchange(distribution=[hash[amount]])
-:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- Reused(reference_id=[1])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[id, name, amount, price, fact_date_sk, id0, male, amount0, CAST(500 AS BIGINT) AS price0, dim_date_sk])
++- MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, dim_date_sk], isBroadcast=[true], build=[right])\n:- [#1] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n+- [#2] Exchange(distribution=[broadcast])\n])
+   :- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
+   +- Exchange(distribution=[broadcast])
+      +- Calc(select=[id, male, amount, dim_date_sk], where=[(price = 500)])
+         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testPushDownProbeSideWithCalc">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($2, $7), <($3, 500), >($8, 600))])
+    </Resource>
+  </TestCase>
+  <TestCase name="testProbeSideIsTooSmall">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim where fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[amount]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 600)])
-      +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
-         :- Exchange(distribution=[broadcast])
-         :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-         :     +- Exchange(distribution=[single])
-         :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-         :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-         :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-         +- TableSourceScan(table=[[testCatalog, test_database, fact, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
+      :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
 +- Exchange(distribution=[hash[amount]])
-   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[(price > 600)])
-      +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact, filter=[]]], fields=[id, name, amount, price, fact_date_sk])\n])
-         :- Exchange(distribution=[broadcast])
-         :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-         :     +- Exchange(distribution=[single])
-         :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
-         :           +- Reused(reference_id=[1])
-         +- TableSourceScan(table=[[testCatalog, test_database, fact, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCannotPushDownProbeSideWithCalc">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$5], random=[$6])
-+- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], fact_date_sk=[$6], random=[$7])
-   +- LogicalJoin(condition=[AND(=($5, $7), <($3, 500))], joinType=[inner])
-      :- LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], amount0=[CAST($2):DOUBLE])
-      :  +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalProject(fact_date_sk=[$4], random=[RAND(10)])
-         +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[id, male, amount, price, dim_date_sk, fact_date_sk, random])
-+- HashJoin(joinType=[InnerJoin], where=[=(amount0, random)], select=[id, male, amount, price, dim_date_sk, amount0, fact_date_sk, random], build=[left])
-   :- Exchange(distribution=[hash[amount0]])
-   :  +- Calc(select=[id, male, amount, price, dim_date_sk, CAST(amount AS DOUBLE) AS amount0], where=[<(price, 500)])
-   :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-   +- Exchange(distribution=[hash[random]])
-      +- RuntimeFilter(select=[random], estimatedFilterRatio=[0.99993896484375])
-         :- Exchange(distribution=[broadcast])
-         :  +- GlobalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
-         :     +- Exchange(distribution=[single])
-         :        +- LocalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
-         :           +- Calc(select=[id, male, amount, price, dim_date_sk, CAST(amount AS DOUBLE) AS amount0], where=[<(price, 500)])
-         :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-         +- Calc(select=[fact_date_sk, RAND(10) AS random])
-            +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[fact_date_sk], metadata=[]]], fields=[fact_date_sk])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[id, male, amount, price, dim_date_sk, fact_date_sk, random])
-+- HashJoin(joinType=[InnerJoin], where=[(amount0 = random)], select=[id, male, amount, price, dim_date_sk, amount0, fact_date_sk, random], build=[left])
-   :- Exchange(distribution=[hash[amount0]])
-   :  +- Calc(select=[id, male, amount, price, dim_date_sk, CAST(amount AS DOUBLE) AS amount0], where=[(price < 500)])(reuse_id=[1])
-   :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-   +- Exchange(distribution=[hash[random]])
-      +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[random], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- Calc(select=[fact_date_sk, RAND(10) AS random])\n   +- [#2] TableSourceScan(table=[[testCatalog, test_database, fact, project=[fact_date_sk], metadata=[]]], fields=[fact_date_sk])\n])
-         :- Exchange(distribution=[broadcast])
-         :  +- GlobalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
-         :     +- Exchange(distribution=[single])
-         :        +- LocalRuntimeFilterBuilder(select=[amount0], estimatedRowCount=[65536], maxRowCount=[187246])
-         :           +- Reused(reference_id=[1])
-         +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[fact_date_sk], metadata=[]]], fields=[fact_date_sk])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[amount]])
+:  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-
-	<TestCase name="testPushDownProbeSideToAllInputsOfJoin">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testPushDownProbeSideToAllInputsOfJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact, fact2, dim where fact.amount = fact2.amount and fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], male=[$9], amount1=[$10], price1=[$11], dim_date_sk=[$12])
 +- LogicalFilter(condition=[AND(=($2, $6), =($2, $10), <($11, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
@@ -791,9 +869,9 @@ LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], i
       :  +- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
       +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[=(amount, amount1)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
 :- HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
 :  :- Exchange(distribution=[hash[amount]])
@@ -818,9 +896,9 @@ HashJoin(joinType=[InnerJoin], where=[=(amount, amount1)], select=[id, name, amo
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 MultipleInput(readOrder=[0,1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount1)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])\n:- HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])\n:  :- [#2] Exchange(distribution=[hash[amount]])\n:  +- [#3] Exchange(distribution=[hash[amount]])\n+- [#1] Exchange(distribution=[hash[amount]])\n])
 :- Exchange(distribution=[hash[amount]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
@@ -838,12 +916,14 @@ MultipleInput(readOrder=[0,1,0], members=[\nHashJoin(joinType=[InnerJoin], where
       :- Reused(reference_id=[2])
       +- TableSourceScan(table=[[testCatalog, test_database, fact2]], fields=[id, amount, price])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testPushDownProbeSideToOneInputOfJoin">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testPushDownProbeSideToOneInputOfJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact, fact2, dim where fact.price = fact2.price and fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], amount0=[$6], price0=[$7], id1=[$8], male=[$9], amount1=[$10], price1=[$11], dim_date_sk=[$12])
 +- LogicalFilter(condition=[AND(=($3, $7), =($2, $10), <($11, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
@@ -852,9 +932,9 @@ LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], i
       :  +- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
       +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[=(amount, amount1)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
 :  +- HashJoin(joinType=[InnerJoin], where=[=(price, price0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
@@ -873,9 +953,9 @@ HashJoin(joinType=[InnerJoin], where=[=(amount, amount1)], select=[id, name, amo
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[(amount = amount1)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0, id1, male, amount1, price1, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[amount]])
 :  +- HashJoin(joinType=[InnerJoin], where=[(price = price0)], select=[id, name, amount, price, fact_date_sk, id0, amount0, price0], build=[right])
@@ -893,69 +973,14 @@ HashJoin(joinType=[InnerJoin], where=[(amount = amount1)], select=[id, name, amo
 +- Exchange(distribution=[hash[amount]])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCannotPushDownProbeSideWithJoin">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id2=[$5], amount2=[$6], price2=[$7], id0=[$8], male=[$9], amount0=[$10], price0=[$11], dim_date_sk=[$12])
-+- LogicalJoin(condition=[AND(=($2, $10), =($7, $11), <($11, 500))], joinType=[inner])
-   :- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id2=[$5], amount2=[$6], price2=[$7])
-   :  +- LogicalJoin(condition=[=($0, $5)], joinType=[inner])
-   :     :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
-   :     +- LogicalTableScan(table=[[testCatalog, test_database, fact2]])
-   +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[AND(=(amount, amount0), =(price2, price0))], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount, price2]])
-:  +- RuntimeFilter(select=[amount, price2], estimatedFilterRatio=[0.9997287326388888])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:     +- HashJoin(joinType=[InnerJoin], where=[=(id, id2)], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2], build=[right])
-:        :- Exchange(distribution=[hash[id]])
-:        :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-:        +- Exchange(distribution=[hash[id2]])
-:           +- Calc(select=[id2, amount2, price2], where=[<(price2, 500)])
-:              +- TableSourceScan(table=[[testCatalog, test_database, fact2, filter=[]]], fields=[id2, amount2, price2])
-+- Exchange(distribution=[hash[amount, price]])
-   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[((amount = amount0) AND (price2 = price0))], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2, id0, male, amount0, price0, dim_date_sk], build=[right])
-:- Exchange(distribution=[hash[amount, price2]])
-:  +- MultipleInput(readOrder=[0,1,0], members=[\nRuntimeFilter(select=[amount, price2], estimatedFilterRatio=[0.9997287326388888])\n:- [#1] Exchange(distribution=[broadcast])\n+- HashJoin(joinType=[InnerJoin], where=[(id = id2)], select=[id, name, amount, price, fact_date_sk, id2, amount2, price2], build=[right])\n   :- [#2] Exchange(distribution=[hash[id]])\n   +- [#3] Exchange(distribution=[hash[id2]])\n])
-:     :- Exchange(distribution=[broadcast])
-:     :  +- GlobalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :     +- Exchange(distribution=[single])
-:     :        +- LocalRuntimeFilterBuilder(select=[amount, price], estimatedRowCount=[65536], maxRowCount=[218454])
-:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-:     :- Exchange(distribution=[hash[id]])
-:     :  +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-:     +- Exchange(distribution=[hash[id2]])
-:        +- Calc(select=[id2, amount2, price2], where=[(price2 < 500)])
-:           +- TableSourceScan(table=[[testCatalog, test_database, fact2, filter=[]]], fields=[id2, amount2, price2])
-+- Exchange(distribution=[hash[amount, price]])
-   +- Reused(reference_id=[1])
-]]>
-		</Resource>
-	</TestCase>
-
-
-	<TestCase name="testPushDownProbeSideWithAgg">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testPushDownProbeSideWithAgg">
+    <Resource name="sql">
+      <![CDATA[select * from dim join (select id, fact_date_sk, sum(fact.price) from fact group by (id, fact_date_sk)) factSide on dim.dim_date_sk = factSide.fact_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], fact_date_sk=[$6], EXPR$2=[$7])
 +- LogicalJoin(condition=[AND(=($4, $6), <($3, 500))], joinType=[inner])
    :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
@@ -963,9 +988,9 @@ LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id
       +- LogicalProject(id=[$0], fact_date_sk=[$4], price=[$3])
          +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[=(dim_date_sk, fact_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, fact_date_sk, EXPR$2], build=[left])
 :- Exchange(distribution=[hash[dim_date_sk]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
@@ -982,9 +1007,9 @@ HashJoin(joinType=[InnerJoin], where=[=(dim_date_sk, fact_date_sk)], select=[id,
             :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
             +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[id, fact_date_sk, price], metadata=[]]], fields=[id, fact_date_sk, price])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[(dim_date_sk = fact_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, fact_date_sk, EXPR$2], build=[left])
 :- Exchange(distribution=[hash[dim_date_sk]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
@@ -1000,63 +1025,63 @@ HashJoin(joinType=[InnerJoin], where=[(dim_date_sk = fact_date_sk)], select=[id,
             :           +- Reused(reference_id=[1])
             +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[id, fact_date_sk, price], metadata=[]]], fields=[id, fact_date_sk, price])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCannotPushDownProbeSideWithAgg">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], fact_date_sk=[$6], sum_price=[$7])
-+- LogicalJoin(condition=[AND(=($3, $7), <($3, 500))], joinType=[inner])
-   :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-   +- LogicalAggregate(group=[{0, 1}], sum_price=[SUM($2)])
-      +- LogicalProject(id=[$0], fact_date_sk=[$4], price=[$3])
-         +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testPushDownProbeSideWithCalc">
+    <Resource name="sql">
+      <![CDATA[select * from dim, fact where dim.amount = fact.amount and dim.price < 500 and fact.price > 600]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
++- LogicalFilter(condition=[AND(=($2, $7), <($3, 500), >($8, 600))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
+      +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(price, sum_price)], select=[id, male, amount, price, dim_date_sk, id0, fact_date_sk, sum_price], build=[left])
-:- Exchange(distribution=[hash[price]])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[amount]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
 :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[sum_price]])
-   +- Calc(select=[id, fact_date_sk, sum_price], where=[<(sum_price, 500)])
-      +- RuntimeFilter(select=[sum_price], estimatedFilterRatio=[0.9999996711817046])
++- Exchange(distribution=[hash[amount]])
+   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[>(price, 600)])
+      +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
          :- Exchange(distribution=[broadcast])
-         :  +- GlobalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
          :     +- Exchange(distribution=[single])
-         :        +- LocalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
          :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
          :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-         +- HashAggregate(isMerge=[false], groupBy=[id, fact_date_sk], select=[id, fact_date_sk, SUM(price) AS sum_price])
-            +- Exchange(distribution=[hash[id, fact_date_sk]])
-               +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[id, fact_date_sk, price], metadata=[]]], fields=[id, fact_date_sk, price])
+         +- TableSourceScan(table=[[testCatalog, test_database, fact, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(price = sum_price)], select=[id, male, amount, price, dim_date_sk, id0, fact_date_sk, sum_price], build=[left])
-:- Exchange(distribution=[hash[price]])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
+:- Exchange(distribution=[hash[amount]])
 :  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
 :     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[sum_price]])
-   +- Calc(select=[id, fact_date_sk, sum_price], where=[(sum_price < 500)])
-      +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[sum_price], estimatedFilterRatio=[0.9999996711817046])\n:- [#1] Exchange(distribution=[broadcast])\n+- HashAggregate(isMerge=[false], groupBy=[id, fact_date_sk], select=[id, fact_date_sk, SUM(price) AS sum_price])\n   +- [#2] Exchange(distribution=[hash[id, fact_date_sk]])\n])
++- Exchange(distribution=[hash[amount]])
+   +- Calc(select=[id, name, amount, price, fact_date_sk], where=[(price > 600)])
+      +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact, filter=[]]], fields=[id, name, amount, price, fact_date_sk])\n])
          :- Exchange(distribution=[broadcast])
-         :  +- GlobalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
          :     +- Exchange(distribution=[single])
-         :        +- LocalRuntimeFilterBuilder(select=[price], estimatedRowCount=[65536], maxRowCount=[218454])
+         :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
          :           +- Reused(reference_id=[1])
-         +- Exchange(distribution=[hash[id, fact_date_sk]])
-            +- TableSourceScan(table=[[testCatalog, test_database, fact, project=[id, fact_date_sk, price], metadata=[]]], fields=[id, fact_date_sk, price])
+         +- TableSourceScan(table=[[testCatalog, test_database, fact, filter=[]]], fields=[id, name, amount, price, fact_date_sk])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testPushDownProbeSideWithUnion">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testPushDownProbeSideWithUnion">
+    <Resource name="sql">
+      <![CDATA[Select * from (select id, fact_date_sk, amount as amount1 from fact where price < 500 union all select id, fact_date_sk, amount from fact where price > 600) fact2, dim where fact2.fact_date_sk = dim.dim_date_sk and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], fact_date_sk=[$1], amount1=[$2], id0=[$3], male=[$4], amount=[$5], price=[$6], dim_date_sk=[$7])
 +- LogicalFilter(condition=[AND(=($1, $7), <($6, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
@@ -1069,9 +1094,9 @@ LogicalProject(id=[$0], fact_date_sk=[$1], amount1=[$2], id0=[$3], male=[$4], am
       :        +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
       +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, fact_date_sk, amount1, id0, male, amount, price, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[fact_date_sk]])
 :  +- Union(all=[true], union=[id, fact_date_sk, amount1])
@@ -1097,9 +1122,9 @@ HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id,
    +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
       +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 HashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, fact_date_sk, amount1, id0, male, amount, price, dim_date_sk], build=[right])
 :- Exchange(distribution=[hash[fact_date_sk]])
 :  +- MultipleInput(readOrder=[0,1], members=[\nUnion(all=[true], union=[id, fact_date_sk, amount1])\n:- Calc(select=[id, fact_date_sk, amount AS amount1], where=[(price < 500)])\n:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])(reuse_id=[1])\n:     :- [#1] Exchange(distribution=[broadcast])\n:     +- [#2] TableSourceScan(table=[[testCatalog, test_database, fact, filter=[], project=[id, amount, price, fact_date_sk], metadata=[]]], fields=[id, amount, price, fact_date_sk])\n+- Calc(select=[id, fact_date_sk, amount], where=[(price > 600)])\n   +- Reused(reference_id=[1])\n])
@@ -1113,77 +1138,102 @@ HashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id,
 +- Exchange(distribution=[hash[dim_date_sk]])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testDoesNotApplyRuntimeFilterAndDPPOnSameKey">
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], male=[$1], amount=[$2], price=[$3], dim_date_sk=[$4], id0=[$5], name=[$6], amount0=[$7], price0=[$8], fact_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($9, $4), <($3, 500))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[testCatalog, test_database, dim]])
-      +- LogicalTableScan(table=[[testCatalog, test_database, fact_part]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testSemiJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact where fact.fact_date_sk in (select dim_date_sk from dim where dim.price < 500)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4])
++- LogicalFilter(condition=[IN($4, {
+LogicalProject(dim_date_sk=[$4])
+  LogicalFilter(condition=[<($3, 500)])
+    LogicalTableScan(table=[[testCatalog, test_database, dim]])
+})])
+   +- LogicalTableScan(table=[[testCatalog, test_database, fact]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
-      +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-         +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
-            +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[LeftSemiJoin], where=[=(fact_date_sk, dim_date_sk)], select=[id, name, amount, price, fact_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- RuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
+:     :           +- Calc(select=[dim_date_sk], where=[<(price, 500)])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Calc(select=[dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-HashJoin(joinType=[InnerJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, male, amount, price, dim_date_sk, id0, name, amount0, price0, fact_date_sk], build=[left])
-:- Exchange(distribution=[hash[dim_date_sk]])
-:  +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
-:     +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
-+- Exchange(distribution=[hash[fact_date_sk]])
-   +- MultipleInput(members=[\nOrderEnforcer\n:- [#1] Exchange(distribution=[broadcast], shuffle_mode=[BATCH])\n+- [#2] DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])\n])
-      :- Exchange(distribution=[broadcast], shuffle_mode=[BATCH])
-      :  +- DynamicFilteringDataCollector(fields=[dim_date_sk])
-      :     +- Reused(reference_id=[1])
-      +- DynamicFilteringTableSourceScan(table=[[testCatalog, test_database, fact_part]], fields=[id, name, amount, price, fact_date_sk])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[LeftSemiJoin], where=[(fact_date_sk = dim_date_sk)], select=[id, name, amount, price, fact_date_sk], build=[right])
+:- Exchange(distribution=[hash[fact_date_sk]])
+:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[fact_date_sk], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[dim_date_sk], estimatedRowCount=[65536], maxRowCount=[655360])
+:     :           +- Calc(select=[dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[], project=[price, dim_date_sk], metadata=[]]], fields=[price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[dim_date_sk]])
+   +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testProbeSideIsTableSourceWithoutExchange">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSimpleInnerJoin">
+    <Resource name="sql">
+      <![CDATA[select * from fact, dim where fact.amount = dim.amount and dim.price < 500]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], fact_date_sk=[$4], id0=[$5], male=[$6], amount0=[$7], price0=[$8], dim_date_sk=[$9])
-+- LogicalFilter(condition=[AND(=($2, $7), =($8, 500))])
++- LogicalFilter(condition=[AND(=($2, $7), <($8, 500))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[testCatalog, test_database, fact]])
       +- LogicalTableScan(table=[[testCatalog, test_database, dim]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[id, name, amount, price, fact_date_sk, id0, male, amount0, CAST(500 AS BIGINT) AS price0, dim_date_sk])
-+- HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, dim_date_sk], isBroadcast=[true], build=[right])
-   :- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-   +- Exchange(distribution=[broadcast])
-      +- Calc(select=[id, male, amount, dim_date_sk], where=[=(price, 500)])
-         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[=(amount, amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[amount]])
+:  +- RuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- Calc(select=[id, male, amount, price, dim_date_sk], where=[<(price, 500)])
+      +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[id, name, amount, price, fact_date_sk, id0, male, amount0, CAST(500 AS BIGINT) AS price0, dim_date_sk])
-+- MultipleInput(readOrder=[1,0], members=[\nHashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, dim_date_sk], isBroadcast=[true], build=[right])\n:- [#1] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n+- [#2] Exchange(distribution=[broadcast])\n])
-   :- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
-   +- Exchange(distribution=[broadcast])
-      +- Calc(select=[id, male, amount, dim_date_sk], where=[(price = 500)])
-         +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+HashJoin(joinType=[InnerJoin], where=[(amount = amount0)], select=[id, name, amount, price, fact_date_sk, id0, male, amount0, price0, dim_date_sk], build=[right])
+:- Exchange(distribution=[hash[amount]])
+:  +- MultipleInput(readOrder=[0,1], members=[\nRuntimeFilter(select=[amount], estimatedFilterRatio=[0.99993896484375])\n:- [#1] Exchange(distribution=[broadcast])\n+- [#2] TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])\n])
+:     :- Exchange(distribution=[broadcast])
+:     :  +- GlobalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :     +- Exchange(distribution=[single])
+:     :        +- LocalRuntimeFilterBuilder(select=[amount], estimatedRowCount=[65536], maxRowCount=[218454])
+:     :           +- Calc(select=[id, male, amount, price, dim_date_sk], where=[(price < 500)])(reuse_id=[1])
+:     :              +- TableSourceScan(table=[[testCatalog, test_database, dim, filter=[]]], fields=[id, male, amount, price, dim_date_sk])
+:     +- TableSourceScan(table=[[testCatalog, test_database, fact]], fields=[id, name, amount, price, fact_date_sk])
++- Exchange(distribution=[hash[amount]])
+   +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml
index 7dc441741a1..e65c28bdba1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml
@@ -517,6 +517,25 @@ FlinkLogicalCalc(select=[a1, b1, c1, EXPR$3])
 +- FlinkLogicalAggregate(group=[{0, 2, 3, 4}], b1=[AUXILIARY_GROUP($1)], EXPR$3=[COUNT($5)])
    +- FlinkLogicalExpand(projects=[{a1, b1, c1, null AS d1, 1 AS $e, d1 AS d1_0}, {a1, b1, null AS c1, d1, 2 AS $e, d1 AS d1_0}])
       +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testAggWithRollup">
+    <Resource name="sql">
+      <![CDATA[SELECT a1, b1, c1, COUNT(d1) FROM T1 GROUP BY ROLLUP (a1, b1, c1)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0}, {}]], EXPR$3=[COUNT($3)])
++- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a1, b1, c1, EXPR$3])
++- FlinkLogicalAggregate(group=[{0, 1, 2, 4}], EXPR$3=[COUNT($3)])
+   +- FlinkLogicalExpand(projects=[{a1, b1, c1, d1, 0 AS $e}, {a1, b1, null AS c1, d1, 1 AS $e}, {a1, null AS b1, null AS c1, d1, 3 AS $e}, {null AS a1, null AS b1, null AS c1, d1, 7 AS $e}])
+      +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
@@ -553,25 +572,6 @@ LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
 FlinkLogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
 +- FlinkLogicalCalc(select=[a3, b3, c3])
    +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testAggWithRollup">
-    <Resource name="sql">
-      <![CDATA[SELECT a1, b1, c1, COUNT(d1) FROM T1 GROUP BY ROLLUP (a1, b1, c1)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0}, {}]], EXPR$3=[COUNT($3)])
-+- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a1, b1, c1, EXPR$3])
-+- FlinkLogicalAggregate(group=[{0, 1, 2, 4}], EXPR$3=[COUNT($3)])
-   +- FlinkLogicalExpand(projects=[{a1, b1, c1, d1, 0 AS $e}, {a1, b1, null AS c1, d1, 1 AS $e}, {a1, null AS b1, null AS c1, d1, 3 AS $e}, {null AS a1, null AS b1, null AS c1, d1, 7 AS $e}])
-      +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
@@ -696,80 +696,80 @@ FlinkLogicalAggregate(group=[{0}], d1=[AUXILIARY_GROUP($2)], EXPR$2=[COUNT($1) F
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnlyConstantGroupKey">
+  <TestCase name="testSingleAggOnTableWithUniqueKey">
     <Resource name="sql">
-      <![CDATA[SELECT count(c1) FROM T1 GROUP BY 1, true]]>
+      <![CDATA[SELECT a1, b1, count(c1) FROM T1 GROUP BY a1, b1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[$2])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[COUNT($2)])
-   +- LogicalProject($f0=[1], $f1=[true], c1=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
++- LogicalProject(a1=[$0], b1=[$1], c1=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[EXPR$0])
-+- FlinkLogicalAggregate(group=[{0}], EXPR$0=[COUNT($1)])
-   +- FlinkLogicalCalc(select=[1 AS $f0, c1])
-      +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+FlinkLogicalAggregate(group=[{0}], b1=[AUXILIARY_GROUP($1)], EXPR$2=[COUNT($2)])
++- FlinkLogicalCalc(select=[a1, b1, c1])
+   +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnTableWithoutUniqueKey">
+  <TestCase name="testSingleAggOnTableWithUniqueKeys">
     <Resource name="sql">
-      <![CDATA[SELECT a3, b3, count(c3) FROM T3 GROUP BY a3, b3]]>
+      <![CDATA[SELECT  b2, c2, avg(a2) FROM T2 GROUP BY b2, c2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-+- LogicalProject(a3=[$0], b3=[$1], c3=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+LogicalAggregate(group=[{0, 1}], EXPR$2=[AVG($2)])
++- LogicalProject(b2=[$1], c2=[$2], a2=[$0])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-+- FlinkLogicalCalc(select=[a3, b3, c3])
-   +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
+FlinkLogicalAggregate(group=[{1}], c2=[AUXILIARY_GROUP($2)], EXPR$2=[AVG($0)])
++- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnTableWithUniqueKey">
+  <TestCase name="testSingleAggOnTableWithoutUniqueKey">
     <Resource name="sql">
-      <![CDATA[SELECT a1, b1, count(c1) FROM T1 GROUP BY a1, b1]]>
+      <![CDATA[SELECT a3, b3, count(c3) FROM T3 GROUP BY a3, b3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-+- LogicalProject(a1=[$0], b1=[$1], c1=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
++- LogicalProject(a3=[$0], b3=[$1], c3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalAggregate(group=[{0}], b1=[AUXILIARY_GROUP($1)], EXPR$2=[COUNT($2)])
-+- FlinkLogicalCalc(select=[a1, b1, c1])
-   +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
+FlinkLogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
++- FlinkLogicalCalc(select=[a3, b3, c3])
+   +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]], fields=[a3, b3, c3, d3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleAggOnTableWithUniqueKeys">
+  <TestCase name="testSingleAggOnlyConstantGroupKey">
     <Resource name="sql">
-      <![CDATA[SELECT  b2, c2, avg(a2) FROM T2 GROUP BY b2, c2]]>
+      <![CDATA[SELECT count(c1) FROM T1 GROUP BY 1, true]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[AVG($2)])
-+- LogicalProject(b2=[$1], c2=[$2], a2=[$0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+LogicalProject(EXPR$0=[$2])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[COUNT($2)])
+   +- LogicalProject($f0=[1], $f1=[true], c1=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalAggregate(group=[{1}], c2=[AUXILIARY_GROUP($2)], EXPR$2=[AVG($0)])
-+- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+FlinkLogicalCalc(select=[EXPR$0])
++- FlinkLogicalAggregate(group=[{0}], EXPR$0=[COUNT($1)])
+   +- FlinkLogicalCalc(select=[1 AS $f0, c1])
+      +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]], fields=[a1, b1, c1, d1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCalcSplitRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCalcSplitRuleTest.xml
index 62fe5b751af..01fd5538c04 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCalcSplitRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCalcSplitRuleTest.xml
@@ -16,333 +16,108 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testSingleCall">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(a) FROM MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func1(a) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testLiteralPlusTableSelect">
-		<Resource name="sql">
-			<![CDATA[SELECT 'foo', func1(a) FROM MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[_UTF-16LE'foo'], EXPR$1=[func1($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=['foo' AS EXPR$0, f0 AS EXPR$1])
-+- AsyncCalc(select=[func1(a) AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testFieldPlusTableSelect">
-		<Resource name="sql">
-			<![CDATA[SELECT a, func1(a) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0], EXPR$1=[func1($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[a, func1(a) AS EXPR$1])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testTwoCalls">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(a), func1(a) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1($0)], EXPR$1=[func1($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[f0 AS EXPR$0, func1(a) AS EXPR$1])
-+- AsyncCalc(select=[a, func1(a) AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testFourCalls">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(a), func2(a), func1(a), func2(a) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1($0)], EXPR$1=[func2($0)], EXPR$2=[func1($0)], EXPR$3=[func2($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[f0 AS EXPR$0, f00 AS EXPR$1, f01 AS EXPR$2, func2(a) AS EXPR$3])
-+- AsyncCalc(select=[f0, f00, a, func1(a) AS f01])
-   +- AsyncCalc(select=[f0, a, func2(a) AS f00])
-      +- AsyncCalc(select=[a, func1(a) AS f0])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testNestedCalls">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(func1(func1(a))) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1(func1(func1($0)))])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func1(f0) AS EXPR$0])
-+- AsyncCalc(select=[func1(f0) AS f0])
-   +- AsyncCalc(select=[func1(a) AS f0])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testThreeNestedCalls">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(func1(a)), func1(func1(func1(a))), func1(a) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1(func1($0))], EXPR$1=[func1(func1(func1($0)))], EXPR$2=[func1($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[f0 AS EXPR$0, func1(f1) AS EXPR$1, f2 AS EXPR$2])
-+- AsyncCalc(select=[f2, f0, func1(f1) AS f1])
-   +- AsyncCalc(select=[f2, f1, func1(f0) AS f0])
-      +- AsyncCalc(select=[f0, f00 AS f1, func1(a) AS f2])
-         +- AsyncCalc(select=[f0, a, func1(a) AS f00])
-            +- AsyncCalc(select=[a, func1(a) AS f0])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testPassedToOtherUDF">
-		<Resource name="sql">
-			<![CDATA[SELECT Concat(func2(a), 'foo') from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[CONCAT(func2($0), _UTF-16LE'foo')])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[CONCAT(f0, 'foo') AS EXPR$0])
-+- AsyncCalc(select=[func2(a) AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testJustCall">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(1)]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1(1)])
-+- LogicalValues(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func1(1) AS EXPR$0])
-+- Values(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testNestedSystemCall">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(ABS(1))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1(ABS(1))])
-+- LogicalValues(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func1(f0) AS EXPR$0])
-+- Calc(select=[ABS(1) AS f0])
-   +- Values(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWhereCondition">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable where REGEXP(func2(a), 'string (2|3)')]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'string (2|3)')])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[REGEXP(f0, 'string (2|3)')])
-+- AsyncCalc(select=[a, func2(a) AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWhereConditionAndProjection">
-		<Resource name="sql">
-			<![CDATA[SELECT func2(a) from MyTable where REGEXP(func2(a), 'val (2|3)')]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func2($0)])
-+- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'val (2|3)')])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func2(a) AS EXPR$0])
-+- Calc(select=[a], where=[REGEXP(f0, 'val (2|3)')])
-   +- AsyncCalc(select=[a, func2(a) AS f0])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWhereConditionWithInts">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable where func1(a) >= 12]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>=(func1($0), 12)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[>=(f0, 12)])
-+- AsyncCalc(select=[a, func1(a) AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testAggregate">
-		<Resource name="sql">
-			<![CDATA[SELECT a, func3(count(*)) from MyTable group by a]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testAggregate">
+    <Resource name="sql">
+      <![CDATA[SELECT a, func3(count(*)) from MyTable group by a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], EXPR$1=[func3($1)])
 +- LogicalAggregate(group=[{0}], agg#0=[COUNT()])
    +- LogicalProject(a=[$0])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 AsyncCalc(select=[a, func3($f1) AS EXPR$1])
 +- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS $f1])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSelectCallWithIntArray">
-		<Resource name="sql">
-			<![CDATA[SELECT func4(d) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func4($3)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func4(d) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testFieldAccessAfter">
-		<Resource name="sql">
-			<![CDATA[SELECT func5(a).f0 from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testFieldAccessAfter">
+    <Resource name="sql">
+      <![CDATA[SELECT func5(a).f0 from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(EXPR$0=[func5($0).f0])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[f0.f0 AS EXPR$0])
 +- AsyncCalc(select=[func5(a) AS f0])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testFieldOperand">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(func5(a).f0) from MyTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testFieldOperand">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(func5(a).f0) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(EXPR$0=[func1(func5($0).f0)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 AsyncCalc(select=[func1(f0) AS EXPR$0])
 +- Calc(select=[f0.f0 AS f0])
    +- AsyncCalc(select=[func5(a) AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testInnerJoinWithFuncInOn">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON func2(a) = func2(a2) AND REGEXP(func2(a), 'string (2|4)')]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testFieldPlusTableSelect">
+    <Resource name="sql">
+      <![CDATA[SELECT a, func1(a) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], EXPR$1=[func1($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[a, func1(a) AS EXPR$1])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testFourCalls">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(a), func2(a), func1(a), func2(a) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1($0)], EXPR$1=[func2($0)], EXPR$2=[func1($0)], EXPR$3=[func2($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[f0 AS EXPR$0, f00 AS EXPR$1, f01 AS EXPR$2, func2(a) AS EXPR$3])
++- AsyncCalc(select=[f0, f00, a, func1(a) AS f01])
+   +- AsyncCalc(select=[f0, a, func2(a) AS f00])
+      +- AsyncCalc(select=[a, func1(a) AS f0])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithFuncInOn">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON func2(a) = func2(a2) AND REGEXP(func2(a), 'string (2|4)')]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
 +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], a2=[$5], b2=[$6], c2=[$7], d2=[$8])
    +- LogicalJoin(condition=[AND(=($4, $9), REGEXP(func2($0), _UTF-16LE'string (2|4)'))], joinType=[inner])
@@ -351,9 +126,9 @@ LogicalProject(a=[$0])
       +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], d2=[$3], $f4=[func2($0)])
          +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a])
 +- Join(joinType=[InnerJoin], where=[=($f4, $f40)], select=[a, $f4, $f40], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[$f4]])
@@ -365,48 +140,49 @@ Calc(select=[a])
       +- AsyncCalc(select=[func2(a2) AS $f4])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testInnerJoinWithFuncProjection">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(a) from MyTable INNER JOIN MyTable2 ON a = a2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1($0)])
-+- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithFuncInOnUsingBothTables">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON a = a2 AND func6(a, a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalJoin(condition=[AND(=($0, $4), >(func6($0, $4), 10))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func1(a) AS EXPR$0])
-+- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-   +- Exchange(distribution=[hash[a2]])
-      +- Calc(select=[a2])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[>(f0, 10)])
++- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
+   +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+      :- Exchange(distribution=[hash[a]])
+      :  +- Calc(select=[a])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+      +- Exchange(distribution=[hash[a2]])
+         +- Calc(select=[a2])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testInnerJoinWithFuncInWhere">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON a = a2 WHERE REGEXP(func2(a), 'val (2|3)')]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithFuncInWhere">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON a = a2 WHERE REGEXP(func2(a), 'val (2|3)')]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
 +- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'val (2|3)')])
    +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a])
 +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[a]])
@@ -418,14 +194,110 @@ Calc(select=[a])
          +- AsyncCalc(select=[a2, func2(a2) AS f0])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testLeftJoinWithFuncInOn">
-		<Resource name="sql">
-			<![CDATA[SELECT a, a2 from MyTable LEFT JOIN MyTable2 ON func1(a) = func1(a2)]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithFuncInWhereUsingBothTables">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON a = a2 WHERE func6(a, a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalFilter(condition=[>(func6($0, $4), 10)])
+   +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[>(f0, 10)])
++- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
+   +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+      :- Exchange(distribution=[hash[a]])
+      :  +- Calc(select=[a])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+      +- Exchange(distribution=[hash[a2]])
+         +- Calc(select=[a2])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInnerJoinWithFuncProjection">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(a) from MyTable INNER JOIN MyTable2 ON a = a2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1($0)])
++- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func1(a) AS EXPR$0])
++- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a]])
+   :  +- Calc(select=[a])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+   +- Exchange(distribution=[hash[a2]])
+      +- Calc(select=[a2])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJustCall">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(1)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1(1)])
++- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func1(1) AS EXPR$0])
++- Values(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinEffectivelyInnerJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE a = a2 AND func6(a, a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalFilter(condition=[AND(=($0, $4), >(func6($0, $4), 10))])
+   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[>(f0, 10)])
++- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
+   +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+      :- Exchange(distribution=[hash[a]])
+      :  +- Calc(select=[a])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+      +- Exchange(distribution=[hash[a2]])
+         +- Calc(select=[a2])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinWithFuncInOn">
+    <Resource name="sql">
+      <![CDATA[SELECT a, a2 from MyTable LEFT JOIN MyTable2 ON func1(a) = func1(a2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], a2=[$4])
 +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], a2=[$5], b2=[$6], c2=[$7], d2=[$8])
    +- LogicalJoin(condition=[=($4, $9)], joinType=[left])
@@ -434,9 +306,9 @@ LogicalProject(a=[$0], a2=[$4])
       +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], d2=[$3], $f4=[func1($0)])
          +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, a2])
 +- Join(joinType=[LeftOuterJoin], where=[=($f4, $f40)], select=[a, $f4, a2, $f40], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[$f4]])
@@ -446,23 +318,23 @@ Calc(select=[a, a2])
       +- AsyncCalc(select=[a2, func1(a2) AS $f4])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testLeftJoinWithFuncInWhere">
-		<Resource name="sql">
-			<![CDATA[SELECT a, a2 from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE REGEXP(func2(a), 'string (2|3)')]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinWithFuncInWhere">
+    <Resource name="sql">
+      <![CDATA[SELECT a, a2 from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE REGEXP(func2(a), 'string (2|3)')]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], a2=[$4])
 +- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'string (2|3)')])
    +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
 :- Exchange(distribution=[hash[a]])
 :  +- Calc(select=[a], where=[REGEXP(f0, 'string (2|3)')])
@@ -472,120 +344,197 @@ Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[
    +- Calc(select=[a2])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testRightJoinWithFuncInOn">
-		<Resource name="sql">
-			<![CDATA[SELECT a, a2 from MyTable RIGHT JOIN MyTable2 ON func1(a) = func1(a2)]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0], a2=[$4])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], a2=[$5], b2=[$6], c2=[$7], d2=[$8])
-   +- LogicalJoin(condition=[=($4, $9)], joinType=[right])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], $f4=[func1($0)])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], d2=[$3], $f4=[func1($0)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinWithFuncInWhereUsingBothTables">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE func6(a, a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalFilter(condition=[>(func6($0, $4), 10)])
+   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a, a2])
-+- Join(joinType=[RightOuterJoin], where=[=($f4, $f40)], select=[a, $f4, a2, $f40], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[$f4]])
-   :  +- AsyncCalc(select=[a, func1(a) AS $f4])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[>(f0, 10)])
++- AsyncCalc(select=[a, func6(a, a2) AS f0])
+   +- Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+      :- Exchange(distribution=[hash[a]])
+      :  +- Calc(select=[a])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+      +- Exchange(distribution=[hash[a2]])
+         +- Calc(select=[a2])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinWithRightOnlyCallInOn">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 AND func1(a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalJoin(condition=[AND(=($0, $4), >(func1($4), 10))], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a])
++- Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a]])
+   :  +- Calc(select=[a])
    :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-   +- Exchange(distribution=[hash[$f4]])
-      +- AsyncCalc(select=[a2, func1(a2) AS $f4])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+   +- Exchange(distribution=[hash[a2]])
+      +- Calc(select=[a2], where=[>(f0, 10)])
+         +- AsyncCalc(select=[a2, func1(a2) AS f0])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testProjectCallInSubquery">
-		<Resource name="sql">
-			<![CDATA[SELECT blah FROM (SELECT func2(a) as blah from MyTable) WHERE REGEXP(blah, 'string (2|3)')]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinWithRightOnlyCallInWhere">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE func1(a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalFilter(condition=[>(func1($4), 10)])
+   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[>(f0, 10)])
++- AsyncCalc(select=[a, func1(a2) AS f0])
+   +- Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+      :- Exchange(distribution=[hash[a]])
+      :  +- Calc(select=[a])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+      +- Exchange(distribution=[hash[a2]])
+         +- Calc(select=[a2])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLiteralPlusTableSelect">
+    <Resource name="sql">
+      <![CDATA[SELECT 'foo', func1(a) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[_UTF-16LE'foo'], EXPR$1=[func1($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=['foo' AS EXPR$0, f0 AS EXPR$1])
++- AsyncCalc(select=[func1(a) AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestedCalls">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(func1(func1(a))) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1(func1(func1($0)))])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func1(f0) AS EXPR$0])
++- AsyncCalc(select=[func1(f0) AS f0])
+   +- AsyncCalc(select=[func1(a) AS f0])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestedSystemCall">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(ABS(1))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1(ABS(1))])
++- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func1(f0) AS EXPR$0])
++- Calc(select=[ABS(1) AS f0])
+   +- Values(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPassedToOtherUDF">
+    <Resource name="sql">
+      <![CDATA[SELECT Concat(func2(a), 'foo') from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[CONCAT(func2($0), _UTF-16LE'foo')])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[CONCAT(f0, 'foo') AS EXPR$0])
++- AsyncCalc(select=[func2(a) AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProjectCallInSubquery">
+    <Resource name="sql">
+      <![CDATA[SELECT blah FROM (SELECT func2(a) as blah from MyTable) WHERE REGEXP(blah, 'string (2|3)')]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(blah=[$0])
 +- LogicalFilter(condition=[REGEXP($0, _UTF-16LE'string (2|3)')])
    +- LogicalProject(blah=[func2($0)])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 AsyncCalc(select=[func2(a) AS blah])
 +- Calc(select=[a], where=[REGEXP(f0, 'string (2|3)')])
    +- AsyncCalc(select=[a, func2(a) AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWhereConditionCallInSubquery">
-		<Resource name="sql">
-			<![CDATA[SELECT blah FROM (select a as blah from MyTable WHERE REGEXP(func2(a), 'string (2|3)'))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(blah=[$0])
-+- LogicalProject(blah=[$0])
-   +- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'string (2|3)')])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[REGEXP(f0, 'string (2|3)')])
-+- AsyncCalc(select=[a, func2(a) AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testWhereNotInSubquery">
-		<Resource name="sql">
-			<![CDATA[SELECT func1(a) FROM MyTable where a not in (select a2 from MyTable2)]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[func1($0)])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(a2=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-AsyncCalc(select=[func1(a) AS EXPR$0])
-+- Join(joinType=[LeftAntiJoin], where=[OR(IS NULL(a), IS NULL(a2), =(a, a2))], select=[a], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[single])
-   :  +- Calc(select=[a])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[a2])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testRightJoinEffectivelyInnerJoin">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 WHERE a = a2 AND func6(a, a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinEffectivelyInnerJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 WHERE a = a2 AND func6(a, a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
 +- LogicalFilter(condition=[AND(=($0, $4), >(func6($0, $4), 10))])
    +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a], where=[>(f0, 10)])
 +- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
    +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
@@ -596,26 +545,53 @@ Calc(select=[a], where=[>(f0, 10)])
          +- Calc(select=[a2])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightJoinWithLeftOnlyCallInWhere">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 WHERE func1(a) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithFuncInOn">
+    <Resource name="sql">
+      <![CDATA[SELECT a, a2 from MyTable RIGHT JOIN MyTable2 ON func1(a) = func1(a2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], a2=[$4])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], a2=[$5], b2=[$6], c2=[$7], d2=[$8])
+   +- LogicalJoin(condition=[=($4, $9)], joinType=[right])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], $f4=[func1($0)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], d2=[$3], $f4=[func1($0)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, a2])
++- Join(joinType=[RightOuterJoin], where=[=($f4, $f40)], select=[a, $f4, a2, $f40], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[$f4]])
+   :  +- AsyncCalc(select=[a, func1(a) AS $f4])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+   +- Exchange(distribution=[hash[$f4]])
+      +- AsyncCalc(select=[a2, func1(a2) AS $f4])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithFuncInWhereUsingBothTables">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 WHERE func6(a, a2) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>(func1($0), 10)])
++- LogicalFilter(condition=[>(func6($0, $4), 10)])
    +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, func1(a) AS f0])
++- AsyncCalc(select=[a, func6(a, a2) AS f0])
    +- Join(joinType=[RightOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
       :- Exchange(distribution=[hash[a]])
       :  +- Calc(select=[a])
@@ -624,23 +600,22 @@ Calc(select=[a], where=[>(f0, 10)])
          +- Calc(select=[a2])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightJoinWithLeftOnlyCallInOn">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 AND func1(a) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithLeftOnlyCallInOn">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 AND func1(a) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
 +- LogicalJoin(condition=[AND(=($0, $4), >(func1($0), 10))], joinType=[right])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a])
 +- Join(joinType=[RightOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[a]])
@@ -651,54 +626,25 @@ Calc(select=[a])
       +- Calc(select=[a2])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftJoinEffectivelyInnerJoin">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE a = a2 AND func6(a, a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithLeftOnlyCallInWhere">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 WHERE func1(a) > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalFilter(condition=[AND(=($0, $4), >(func6($0, $4), 10))])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
-   +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-      :- Exchange(distribution=[hash[a]])
-      :  +- Calc(select=[a])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-      +- Exchange(distribution=[hash[a2]])
-         +- Calc(select=[a2])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightJoinWithFuncInWhereUsingBothTables">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable RIGHT JOIN MyTable2 ON a = a2 WHERE func6(a, a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>(func6($0, $4), 10)])
++- LogicalFilter(condition=[>(func1($0), 10)])
    +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, func6(a, a2) AS f0])
++- AsyncCalc(select=[a, func1(a) AS f0])
    +- Join(joinType=[RightOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
       :- Exchange(distribution=[hash[a]])
       :  +- Calc(select=[a])
@@ -707,144 +653,185 @@ Calc(select=[a], where=[>(f0, 10)])
          +- Calc(select=[a2])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftJoinWithFuncInWhereUsingBothTables">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE func6(a, a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>(func6($0, $4), 10)])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testSelectCallWithIntArray">
+    <Resource name="sql">
+      <![CDATA[SELECT func4(d) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func4($3)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, func6(a, a2) AS f0])
-   +- Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-      :- Exchange(distribution=[hash[a]])
-      :  +- Calc(select=[a])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-      +- Exchange(distribution=[hash[a2]])
-         +- Calc(select=[a2])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func4(d) AS EXPR$0])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftJoinWithRightOnlyCallInWhere">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 WHERE func1(a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>(func1($4), 10)])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleCall">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(a) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, func1(a2) AS f0])
-   +- Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-      :- Exchange(distribution=[hash[a]])
-      :  +- Calc(select=[a])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-      +- Exchange(distribution=[hash[a2]])
-         +- Calc(select=[a2])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func1(a) AS EXPR$0])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftJoinWithRightOnlyCallInOn">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable LEFT JOIN MyTable2 ON a = a2 AND func1(a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(a=[$0])
-+- LogicalJoin(condition=[AND(=($0, $4), >(func1($4), 10))], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testThreeNestedCalls">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(func1(a)), func1(func1(func1(a))), func1(a) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1(func1($0))], EXPR$1=[func1(func1(func1($0)))], EXPR$2=[func1($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a])
-+- Join(joinType=[LeftOuterJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-   +- Exchange(distribution=[hash[a2]])
-      +- Calc(select=[a2], where=[>(f0, 10)])
-         +- AsyncCalc(select=[a2, func1(a2) AS f0])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[f0 AS EXPR$0, func1(f1) AS EXPR$1, f2 AS EXPR$2])
++- AsyncCalc(select=[f2, f0, func1(f1) AS f1])
+   +- AsyncCalc(select=[f2, f1, func1(f0) AS f0])
+      +- AsyncCalc(select=[f0, f00 AS f1, func1(a) AS f2])
+         +- AsyncCalc(select=[f0, a, func1(a) AS f00])
+            +- AsyncCalc(select=[a, func1(a) AS f0])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testInnerJoinWithFuncInOnUsingBothTables">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON a = a2 AND func6(a, a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoCalls">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(a), func1(a) from MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1($0)], EXPR$1=[func1($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[f0 AS EXPR$0, func1(a) AS EXPR$1])
++- AsyncCalc(select=[a, func1(a) AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWhereCondition">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable where REGEXP(func2(a), 'string (2|3)')]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalJoin(condition=[AND(=($0, $4), >(func6($0, $4), 10))], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'string (2|3)')])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
-   +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-      :- Exchange(distribution=[hash[a]])
-      :  +- Calc(select=[a])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-      +- Exchange(distribution=[hash[a2]])
-         +- Calc(select=[a2])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[REGEXP(f0, 'string (2|3)')])
++- AsyncCalc(select=[a, func2(a) AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testInnerJoinWithFuncInWhereUsingBothTables">
-		<Resource name="sql">
-			<![CDATA[SELECT a from MyTable INNER JOIN MyTable2 ON a = a2 WHERE func6(a, a2) > 10]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testWhereConditionAndProjection">
+    <Resource name="sql">
+      <![CDATA[SELECT func2(a) from MyTable where REGEXP(func2(a), 'val (2|3)')]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func2($0)])
++- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'val (2|3)')])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func2(a) AS EXPR$0])
++- Calc(select=[a], where=[REGEXP(f0, 'val (2|3)')])
+   +- AsyncCalc(select=[a, func2(a) AS f0])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWhereConditionCallInSubquery">
+    <Resource name="sql">
+      <![CDATA[SELECT blah FROM (select a as blah from MyTable WHERE REGEXP(func2(a), 'string (2|3)'))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(blah=[$0])
++- LogicalProject(blah=[$0])
+   +- LogicalFilter(condition=[REGEXP(func2($0), _UTF-16LE'string (2|3)')])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[REGEXP(f0, 'string (2|3)')])
++- AsyncCalc(select=[a, func2(a) AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWhereConditionWithInts">
+    <Resource name="sql">
+      <![CDATA[SELECT a from MyTable where func1(a) >= 12]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>(func6($0, $4), 10)])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalFilter(condition=[>=(func1($0), 12)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Calc(select=[a], where=[>(f0, 10)])
-+- AsyncCalc(select=[a, a2, func6(a, a2) AS f0])
-   +- Join(joinType=[InnerJoin], where=[=(a, a2)], select=[a, a2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-      :- Exchange(distribution=[hash[a]])
-      :  +- Calc(select=[a])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-      +- Exchange(distribution=[hash[a2]])
-         +- Calc(select=[a2])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a], where=[>=(f0, 12)])
++- AsyncCalc(select=[a, func1(a) AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWhereNotInSubquery">
+    <Resource name="sql">
+      <![CDATA[SELECT func1(a) FROM MyTable where a not in (select a2 from MyTable2)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[func1($0)])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(a2=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+}))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+AsyncCalc(select=[func1(a) AS EXPR$0])
++- Join(joinType=[LeftAntiJoin], where=[OR(IS NULL(a), IS NULL(a2), =(a, a2))], select=[a], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[single])
+   :  +- Calc(select=[a])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[a2])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a2, b2, c2, d2])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCorrelateSplitRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCorrelateSplitRuleTest.xml
index 16b7e985807..dcbe743d2c2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCorrelateSplitRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AsyncCorrelateSplitRuleTest.xml
@@ -16,136 +16,131 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testCorrelateImmediate">
-		<Resource name="sql">
-			<![CDATA[select * FROM MyTable, LATERAL TABLE(tableFunc(func1(a)))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testCorrelateImmediate">
+    <Resource name="sql">
+      <![CDATA[select * FROM MyTable, LATERAL TABLE(tableFunc(func1(a)))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], EXPR$0=[$4])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableFunctionScan(invocation=[tableFunc(func1($cor0.a))], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c, d, EXPR$0])
 +- Correlate(invocation=[tableFunc($4)], correlate=[table(tableFunc(f0))], select=[a,b,c,d,f0,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER ARRAY d, INTEGER f0, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
    +- AsyncCalc(select=[a, b, c, d, func1(a) AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCorrelateIndirect">
-		<Resource name="sql">
-			<![CDATA[select * FROM MyTable, LATERAL TABLE(tableFunc(ABS(func1(a))))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testCorrelateIndirect">
+    <Resource name="sql">
+      <![CDATA[select * FROM MyTable, LATERAL TABLE(tableFunc(ABS(func1(a))))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], EXPR$0=[$4])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableFunctionScan(invocation=[tableFunc(ABS(func1($cor0.a)))], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c, d, EXPR$0])
 +- Correlate(invocation=[tableFunc(ABS($4))], correlate=[table(tableFunc(ABS(f0)))], select=[a,b,c,d,f0,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER ARRAY d, INTEGER f0, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
    +- AsyncCalc(select=[a, b, c, d, func1(a) AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCorrelateIndirectOtherWay">
-		<Resource name="sql">
-			<![CDATA[select * FROM MyTable, LATERAL TABLE(tableFunc(func1(ABS(a))))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testCorrelateIndirectOtherWay">
+    <Resource name="sql">
+      <![CDATA[select * FROM MyTable, LATERAL TABLE(tableFunc(func1(ABS(a))))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], EXPR$0=[$4])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableFunctionScan(invocation=[tableFunc(func1(ABS($cor0.a)))], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c, d, EXPR$0])
 +- Correlate(invocation=[tableFunc($4)], correlate=[table(tableFunc(f0))], select=[a,b,c,d,f0,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER ARRAY d, INTEGER f0, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
    +- AsyncCalc(select=[a, b, c, d, func1(f0) AS f0])
       +- Calc(select=[a, b, c, d, ABS(a) AS f0])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCorrelateWithSystem">
-		<Resource name="sql">
-			<![CDATA[select * FROM MyTable, LATERAL TABLE(asyncTableFunc(ABS(a)))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testCorrelateWithCast">
+    <Resource name="sql">
+      <![CDATA[select * FROM MyTable, LATERAL TABLE(asyncTableFunc(cast(cast(a as int) as int)))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], EXPR$0=[$4])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableFunctionScan(invocation=[asyncTableFunc(ABS($cor0.a))], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
+   +- LogicalTableFunctionScan(invocation=[asyncTableFunc(CAST(CAST($cor0.a):INTEGER):INTEGER)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c, d, EXPR$0])
 +- AsyncCorrelate(invocation=[asyncTableFunc($4)], correlate=[table(asyncTableFunc(f0))], select=[a,b,c,d,f0,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER ARRAY d, INTEGER f0, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
-   +- Calc(select=[a, b, c, d, ABS(a) AS f0])
+   +- Calc(select=[a, b, c, d, a AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCorrelateWithScalar">
-		<Resource name="sql">
-			<![CDATA[select * FROM MyTable, LATERAL TABLE(asyncTableFunc(scalar(a)))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testCorrelateWithScalar">
+    <Resource name="sql">
+      <![CDATA[select * FROM MyTable, LATERAL TABLE(asyncTableFunc(scalar(a)))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], EXPR$0=[$4])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableFunctionScan(invocation=[asyncTableFunc(scalar($cor0.a))], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c, d, EXPR$0])
 +- AsyncCorrelate(invocation=[asyncTableFunc($4)], correlate=[table(asyncTableFunc(f0))], select=[a,b,c,d,f0,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER ARRAY d, INTEGER f0, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
    +- Calc(select=[a, b, c, d, scalar(a) AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testCorrelateWithCast">
-		<Resource name="sql">
-			<![CDATA[select * FROM MyTable, LATERAL TABLE(asyncTableFunc(cast(cast(a as int) as int)))]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testCorrelateWithSystem">
+    <Resource name="sql">
+      <![CDATA[select * FROM MyTable, LATERAL TABLE(asyncTableFunc(ABS(a)))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], EXPR$0=[$4])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableFunctionScan(invocation=[asyncTableFunc(CAST(CAST($cor0.a):INTEGER):INTEGER)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
+   +- LogicalTableFunctionScan(invocation=[asyncTableFunc(ABS($cor0.a))], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 Calc(select=[a, b, c, d, EXPR$0])
 +- AsyncCorrelate(invocation=[asyncTableFunc($4)], correlate=[table(asyncTableFunc(f0))], select=[a,b,c,d,f0,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER ARRAY d, INTEGER f0, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
-   +- Calc(select=[a, b, c, d, a AS f0])
+   +- Calc(select=[a, b, c, d, ABS(a) AS f0])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CalcRankTransposeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CalcRankTransposeRuleTest.xml
index 7593a0a7022..1f58f2f827e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CalcRankTransposeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CalcRankTransposeRuleTest.xml
@@ -126,33 +126,6 @@ FlinkLogicalCalc(select=[rowtime])
 +- FlinkLogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[rowtime DESC], select=[a, rowtime])
    +- FlinkLogicalCalc(select=[a, rowtime])
       +- FlinkLogicalDataStreamTableScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPushCalcWithConditionIntoRank">
-    <Resource name="sql">
-      <![CDATA[
-SELECT rowtime, c FROM (
-  SELECT *,
-      ROW_NUMBER() OVER (PARTITION BY a ORDER BY rowtime DESC) as rank_num
-  FROM MyTable)
-WHERE  rank_num <= 2 AND a > 10
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(rowtime=[$3], c=[$2])
-+- LogicalFilter(condition=[AND(<=($4, 2), >($0, 10))])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[rowtime, c], where=[>(a, 10)])
-+- FlinkLogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=2], partitionBy=[a], orderBy=[rowtime DESC], select=[a, c, rowtime])
-   +- FlinkLogicalCalc(select=[a, c, rowtime])
-      +- FlinkLogicalDataStreamTableScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -245,6 +218,33 @@ FlinkLogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], part
 +- FlinkLogicalCalc(select=[category, shopId, max_price])
    +- FlinkLogicalAggregate(group=[{0, 1}], max_price=[MAX($2)], min_price=[MIN($2)])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, T]], fields=[category, shopId, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPushCalcWithConditionIntoRank">
+    <Resource name="sql">
+      <![CDATA[
+SELECT rowtime, c FROM (
+  SELECT *,
+      ROW_NUMBER() OVER (PARTITION BY a ORDER BY rowtime DESC) as rank_num
+  FROM MyTable)
+WHERE  rank_num <= 2 AND a > 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(rowtime=[$3], c=[$2])
++- LogicalFilter(condition=[AND(<=($4, 2), >($0, 10))])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[rowtime, c], where=[>(a, 10)])
++- FlinkLogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=2], partitionBy=[a], orderBy=[rowtime DESC], select=[a, c, rowtime])
+   +- FlinkLogicalCalc(select=[a, c, rowtime])
+      +- FlinkLogicalDataStreamTableScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ConvertToNotInOrInRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ConvertToNotInOrInRuleTest.xml
index 39db39232df..8f8128fb4a6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ConvertToNotInOrInRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ConvertToNotInOrInRuleTest.xml
@@ -16,260 +16,230 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testConvertToIn_EqualsToThreshold_Int">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[SEARCH($0, Sarg[1, 2, 3, 4])])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testConvertToIn_GreaterThanThreshold_Double">
+  <TestCase name="testConvertToInAndNotIn1">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE d = 1 OR d = 2 OR d = 3 OR d = 4 OR d = 5 OR d = 6 OR d = 7 OR d = 8 OR d = 9 OR d = 10 OR d = 11 OR d = 12 OR d = 13 OR d = 14 OR d = 15 OR d = 16 OR d = 17 OR d = 18 OR d = 19 OR d = 20]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 OR b = 1 OR (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($3, 1), =($3, 2), =($3, 3), =($3, 4), =($3, 5), =($3, 6), =($3, 7), =($3, 8), =($3, 9), =($3, 10), =($3, 11), =($3, 12), =($3, 13), =($3, 14), =($3, 15), =($3, 16), =($3, 17), =($3, 18), =($3, 19), =($3, 20))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4), =($1, 1), AND(<>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4)))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[SEARCH($3, Sarg[1E0:DOUBLE, 2E0:DOUBLE, 3E0:DOUBLE, 4E0:DOUBLE, 5E0:DOUBLE, 6E0:DOUBLE, 7E0:DOUBLE, 8E0:DOUBLE, 9E0:DOUBLE, 1E1:DOUBLE, 1.1E1:DOUBLE, 1.2E1:DOUBLE, 1.3E1:DOUBLE, 1.4E1:DOUBLE, 1.5E1:DOUBLE, 1.6E1:DOUBLE, 1.7E1:DOUBLE, 1.8E1:DOUBLE, 1.9E1:DOUBLE, 2E1:DOUBLE]:DOUBLE)])
++- LogicalFilter(condition=[OR(NOT(SEARCH($0, Sarg[1, 2, 3, 4])), =($1, 1), SEARCH($0, Sarg[1, 2, 3, 4]))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_GreaterThanThreshold_Int">
+  <TestCase name="testConvertToInAndNotIn2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 OR a = 5]]>
+      <![CDATA[SELECT * FROM MyTable WHERE b = 1 OR a = 1 OR a = 2 OR a = 3 OR a = 4  AND (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4), =($0, 5))])
++- LogicalFilter(condition=[OR(=($1, 1), =($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), <>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4)))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[SEARCH($0, Sarg[1, 2, 3, 4, 5])])
++- LogicalFilter(condition=[OR(=($1, 1), =($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), NOT(SEARCH($0, Sarg[1, 2, 3, 4]))))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_LessThanThreshold_Double">
+  <TestCase name="testConvertToInAndNotIn3">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE d = 1 OR d = 2 OR d = 3 OR d = 4 OR d = 5 OR d = 6 OR d = 7 OR d = 8 OR d = 9 OR d = 10 OR d = 11 OR d = 12 OR d = 13 OR d = 14 OR d = 15 OR d = 16 OR d = 17 OR d = 18 OR d = 19]]>
+      <![CDATA[SELECT * FROM MyTable WHERE b = 1 OR b = 2 OR (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4 AND c = 1) OR b = 3 OR b = 4 OR c = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($3, 1), =($3, 2), =($3, 3), =($3, 4), =($3, 5), =($3, 6), =($3, 7), =($3, 8), =($3, 9), =($3, 10), =($3, 11), =($3, 12), =($3, 13), =($3, 14), =($3, 15), =($3, 16), =($3, 17), =($3, 18), =($3, 19))])
++- LogicalFilter(condition=[OR(=($1, 1), =($1, 2), AND(<>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4), =($2, 1)), =($1, 3), =($1, 4), =($2, 1))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($3, 1), =($3, 2), =($3, 3), =($3, 4), =($3, 5), =($3, 6), =($3, 7), =($3, 8), =($3, 9), =($3, 10), =($3, 11), =($3, 12), =($3, 13), =($3, 14), =($3, 15), =($3, 16), =($3, 17), =($3, 18), =($3, 19))])
++- LogicalFilter(condition=[OR(AND(=($2, 1), NOT(SEARCH($0, Sarg[1, 2, 3, 4]))), SEARCH($1, Sarg[1L:BIGINT, 2L:BIGINT, 3L:BIGINT, 4L:BIGINT]:BIGINT), =($2, 1))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_LessThanThreshold_Int">
+  <TestCase name="testConvertToIn_EqualsToThreshold_Int">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3))])
++- LogicalFilter(condition=[SEARCH($0, Sarg[1, 2, 3, 4])])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_WithAnd1">
+  <TestCase name="testConvertToIn_GreaterThanThreshold_Double">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE (a = 1 OR a = 2 OR a = 3 OR a = 4) AND b = 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE d = 1 OR d = 2 OR d = 3 OR d = 4 OR d = 5 OR d = 6 OR d = 7 OR d = 8 OR d = 9 OR d = 10 OR d = 11 OR d = 12 OR d = 13 OR d = 14 OR d = 15 OR d = 16 OR d = 17 OR d = 18 OR d = 19 OR d = 20]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[AND(OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4)), =($1, 1))])
++- LogicalFilter(condition=[OR(=($3, 1), =($3, 2), =($3, 3), =($3, 4), =($3, 5), =($3, 6), =($3, 7), =($3, 8), =($3, 9), =($3, 10), =($3, 11), =($3, 12), =($3, 13), =($3, 14), =($3, 15), =($3, 16), =($3, 17), =($3, 18), =($3, 19), =($3, 20))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[AND(SEARCH($0, Sarg[1, 2, 3, 4]), =($1, 1))])
++- LogicalFilter(condition=[SEARCH($3, Sarg[1E0:DOUBLE, 2E0:DOUBLE, 3E0:DOUBLE, 4E0:DOUBLE, 5E0:DOUBLE, 6E0:DOUBLE, 7E0:DOUBLE, 8E0:DOUBLE, 9E0:DOUBLE, 1E1:DOUBLE, 1.1E1:DOUBLE, 1.2E1:DOUBLE, 1.3E1:DOUBLE, 1.4E1:DOUBLE, 1.5E1:DOUBLE, 1.6E1:DOUBLE, 1.7E1:DOUBLE, 1.8E1:DOUBLE, 1.9E1:DOUBLE, 2E1:DOUBLE]:DOUBLE)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_WithAnd2">
+  <TestCase name="testConvertToIn_GreaterThanThreshold_Int">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 AND b = 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 OR a = 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), =($1, 1)))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4), =($0, 5))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), =($1, 1)))])
++- LogicalFilter(condition=[SEARCH($0, Sarg[1, 2, 3, 4, 5])])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_WithOr1">
+  <TestCase name="testConvertToIn_LessThanThreshold_Double">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 OR b = 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE d = 1 OR d = 2 OR d = 3 OR d = 4 OR d = 5 OR d = 6 OR d = 7 OR d = 8 OR d = 9 OR d = 10 OR d = 11 OR d = 12 OR d = 13 OR d = 14 OR d = 15 OR d = 16 OR d = 17 OR d = 18 OR d = 19]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4), =($1, 1))])
++- LogicalFilter(condition=[OR(=($3, 1), =($3, 2), =($3, 3), =($3, 4), =($3, 5), =($3, 6), =($3, 7), =($3, 8), =($3, 9), =($3, 10), =($3, 11), =($3, 12), =($3, 13), =($3, 14), =($3, 15), =($3, 16), =($3, 17), =($3, 18), =($3, 19))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($1, 1), SEARCH($0, Sarg[1, 2, 3, 4]))])
++- LogicalFilter(condition=[OR(=($3, 1), =($3, 2), =($3, 3), =($3, 4), =($3, 5), =($3, 6), =($3, 7), =($3, 8), =($3, 9), =($3, 10), =($3, 11), =($3, 12), =($3, 13), =($3, 14), =($3, 15), =($3, 16), =($3, 17), =($3, 18), =($3, 19))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToIn_WithOr2">
+  <TestCase name="testConvertToIn_LessThanThreshold_Int">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR b = 1 OR a = 3 OR a = 4]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($1, 1), =($0, 3), =($0, 4))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($1, 1), SEARCH($0, Sarg[1, 2, 3, 4]))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToSearchString">
+  <TestCase name="testConvertToIn_WithAnd1">
     <Resource name="sql">
-      <![CDATA[
-SELECT * from MyTable where e in (
-'CTNBSmokeSensor',
-'H388N',
-'H389N     ',
-'GHL-IRD',
-'JY-BF-20YN',
-'HC809',
-'DH-9908N-AEP',
-'DH-9908N'
-)
-]]>
+      <![CDATA[SELECT * FROM MyTable WHERE (a = 1 OR a = 2 OR a = 3 OR a = 4) AND b = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($4, _UTF-16LE'CTNBSmokeSensor'), =($4, _UTF-16LE'H388N'), =($4, _UTF-16LE'H389N     '), =($4, _UTF-16LE'GHL-IRD'), =($4, _UTF-16LE'JY-BF-20YN'), =($4, _UTF-16LE'HC809'), =($4, _UTF-16LE'DH-9908N-AEP'), =($4, _UTF-16LE'DH-9908N'))])
++- LogicalFilter(condition=[AND(OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4)), =($1, 1))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[SEARCH($4, Sarg[_UTF-16LE'CTNBSmokeSensor':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'DH-9908N':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'DH-9908N-AEP':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'GHL-IRD':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'H388N':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'H389N     ':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'HC809':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'JY-BF-20YN':VARCHAR(15) CHARACTER SET "UTF-16LE"]:VARCHAR(15) CHARACTER SET "UTF-16LE")])
++- LogicalFilter(condition=[AND(SEARCH($0, Sarg[1, 2, 3, 4]), =($1, 1))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToInAndNotIn1">
+  <TestCase name="testConvertToIn_WithAnd2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 OR b = 1 OR (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4)]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 AND b = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4), =($1, 1), AND(<>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4)))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), =($1, 1)))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(NOT(SEARCH($0, Sarg[1, 2, 3, 4])), =($1, 1), SEARCH($0, Sarg[1, 2, 3, 4]))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), =($1, 1)))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToInAndNotIn2">
+  <TestCase name="testConvertToIn_WithOr1">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE b = 1 OR a = 1 OR a = 2 OR a = 3 OR a = 4  AND (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4)]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR a = 3 OR a = 4 OR b = 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($1, 1), =($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), <>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4)))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($0, 3), =($0, 4), =($1, 1))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($1, 1), =($0, 1), =($0, 2), =($0, 3), AND(=($0, 4), NOT(SEARCH($0, Sarg[1, 2, 3, 4]))))])
++- LogicalFilter(condition=[OR(=($1, 1), SEARCH($0, Sarg[1, 2, 3, 4]))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToInAndNotIn3">
+  <TestCase name="testConvertToIn_WithOr2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE b = 1 OR b = 2 OR (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4 AND c = 1) OR b = 3 OR b = 4 OR c = 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 2 OR b = 1 OR a = 3 OR a = 4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($1, 1), =($1, 2), AND(<>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4), =($2, 1)), =($1, 3), =($1, 4), =($2, 1))])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 2), =($1, 1), =($0, 3), =($0, 4))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(AND(=($2, 1), NOT(SEARCH($0, Sarg[1, 2, 3, 4]))), SEARCH($1, Sarg[1L:BIGINT, 2L:BIGINT, 3L:BIGINT, 4L:BIGINT]:BIGINT), =($2, 1))])
++- LogicalFilter(condition=[OR(=($1, 1), SEARCH($0, Sarg[1, 2, 3, 4]))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
@@ -404,6 +374,25 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
 +- LogicalFilter(condition=[AND(=($1, 1), NOT(SEARCH($0, Sarg[1, 2, 3, 4])))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testConvertToNotIn_WithOr1">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable WHERE (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4) OR b = 1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
++- LogicalFilter(condition=[OR(AND(<>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4)), =($1, 1))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
++- LogicalFilter(condition=[OR(NOT(SEARCH($0, Sarg[1, 2, 3, 4])), =($1, 1))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -445,59 +434,70 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToSearchWithMixedType">
+  <TestCase name="testConvertToSearchString">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a is null or a = 1 OR a = 2 OR a = 3.0 OR a = 4.0 OR a = 5 OR a = 7 OR a = CAST(8 AS BIGINT)]]>
+      <![CDATA[
+SELECT * from MyTable where e in (
+'CTNBSmokeSensor',
+'H388N',
+'H389N     ',
+'GHL-IRD',
+'JY-BF-20YN',
+'HC809',
+'DH-9908N-AEP',
+'DH-9908N'
+)
+]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(IS NULL($0), =($0, 1), =($0, 2), =(CAST($0):DECIMAL(11, 1), 3.0), =(CAST($0):DECIMAL(11, 1), 4.0), =($0, 5), =($0, 7), =(CAST($0):BIGINT, 8))])
++- LogicalFilter(condition=[OR(=($4, _UTF-16LE'CTNBSmokeSensor'), =($4, _UTF-16LE'H388N'), =($4, _UTF-16LE'H389N     '), =($4, _UTF-16LE'GHL-IRD'), =($4, _UTF-16LE'JY-BF-20YN'), =($4, _UTF-16LE'HC809'), =($4, _UTF-16LE'DH-9908N-AEP'), =($4, _UTF-16LE'DH-9908N'))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(IS NULL($0), =(CAST($0):DECIMAL(11, 1), 3.0), =(CAST($0):DECIMAL(11, 1), 4.0), =(CAST($0):BIGINT, 8), SEARCH($0, Sarg[1, 2, 5, 7]))])
++- LogicalFilter(condition=[SEARCH($4, Sarg[_UTF-16LE'CTNBSmokeSensor':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'DH-9908N':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'DH-9908N-AEP':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'GHL-IRD':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'H388N':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'H389N     ':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'HC809':VARCHAR(15) CHARACTER SET "UTF-16LE", _UTF-16LE'JY-BF-20YN':VARCHAR(15) CHARACTER SET "UTF-16LE"]:VARCHAR(15) CHARACTER SET "UTF-16LE")])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToNotIn_WithOr1">
+  <TestCase name="testConvertToSearchStringWithNull">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE (a <> 1 AND a <> 2 AND a <> 3 AND a <> 4) OR b = 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE e = 'a' or e = 'b' or e = 'c' or e = 'd' or e = 'e' or e = 'f' or e = NULL or e = 'HELLO WORLD!']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(AND(<>($0, 1), <>($0, 2), <>($0, 3), <>($0, 4)), =($1, 1))])
++- LogicalFilter(condition=[OR(=($4, _UTF-16LE'a'), =($4, _UTF-16LE'b'), =($4, _UTF-16LE'c'), =($4, _UTF-16LE'd'), =($4, _UTF-16LE'e'), =($4, _UTF-16LE'f'), =($4, null), =($4, _UTF-16LE'HELLO WORLD!'))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(NOT(SEARCH($0, Sarg[1, 2, 3, 4])), =($1, 1))])
++- LogicalFilter(condition=[OR(=($4, _UTF-16LE'a'), =($4, _UTF-16LE'b'), =($4, _UTF-16LE'c'), =($4, _UTF-16LE'd'), =($4, _UTF-16LE'e'), =($4, _UTF-16LE'f'), =($4, null), =($4, _UTF-16LE'HELLO WORLD!'))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testConvertToSearchStringWithNull">
+  <TestCase name="testConvertToSearchWithMixedType">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE e = 'a' or e = 'b' or e = 'c' or e = 'd' or e = 'e' or e = 'f' or e = NULL or e = 'HELLO WORLD!']]>
+      <![CDATA[SELECT * FROM MyTable WHERE a is null or a = 1 OR a = 2 OR a = 3.0 OR a = 4.0 OR a = 5 OR a = 7 OR a = CAST(8 AS BIGINT)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($4, _UTF-16LE'a'), =($4, _UTF-16LE'b'), =($4, _UTF-16LE'c'), =($4, _UTF-16LE'd'), =($4, _UTF-16LE'e'), =($4, _UTF-16LE'f'), =($4, null), =($4, _UTF-16LE'HELLO WORLD!'))])
++- LogicalFilter(condition=[OR(IS NULL($0), =($0, 1), =($0, 2), =(CAST($0):DECIMAL(11, 1), 3.0), =(CAST($0):DECIMAL(11, 1), 4.0), =($0, 5), =($0, 7), =(CAST($0):BIGINT, 8))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalFilter(condition=[OR(=($4, _UTF-16LE'a'), =($4, _UTF-16LE'b'), =($4, _UTF-16LE'c'), =($4, _UTF-16LE'd'), =($4, _UTF-16LE'e'), =($4, _UTF-16LE'f'), =($4, null), =($4, _UTF-16LE'HELLO WORLD!'))])
++- LogicalFilter(condition=[OR(IS NULL($0), =(CAST($0):DECIMAL(11, 1), 3.0), =(CAST($0):DECIMAL(11, 1), 4.0), =(CAST($0):BIGINT, 8), SEARCH($0, Sarg[1, 2, 5, 7]))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml
index ee03899eaef..59004cecbbd 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml
@@ -135,49 +135,6 @@ LogicalProject(f0=[$0], f1=[$1])
 LogicalProject(f0=[$0], f1=[$1])
 +- LogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[$0], orderBy=[$2 DESC], select=[f0=$0, f1=$1, f2=$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testNonInnerJoinNotSupported">
-    <Resource name="sql">
-      <![CDATA[
-SELECT f0, f1
-FROM
-  (SELECT DISTINCT f0 FROM t1) t2
-  NATURAL LEFT JOIN
-  LATERAL (
-    SELECT f1, f2
-    FROM t1
-    WHERE f0 = t2.f0
-    ORDER BY f2
-    DESC LIMIT 3
-  )
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(f0=[$0], f1=[$1])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
-   :- LogicalAggregate(group=[{0}])
-   :  +- LogicalProject(f0=[$0])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
-      +- LogicalProject(f1=[$1], f2=[$2])
-         +- LogicalFilter(condition=[=($0, $cor0.f0)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(f0=[$0], f1=[$1])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
-   :- LogicalAggregate(group=[{0}])
-   :  +- LogicalProject(f0=[$0])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
-      +- LogicalProject(f1=[$1], f2=[$2])
-         +- LogicalFilter(condition=[=($0, $cor0.f0)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
   </TestCase>
@@ -343,7 +300,7 @@ LogicalProject(f0=[$0], f2=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortWithOffsetNotSupported">
+  <TestCase name="testNonEqualConditionNotSupported">
     <Resource name="sql">
       <![CDATA[
 SELECT f0, f1
@@ -352,10 +309,9 @@ FROM
   LATERAL (
     SELECT f1, f2
     FROM t1
-    WHERE f0 = t2.f0
-    ORDER BY f2 DESC
-    OFFSET 2 ROWS
-    FETCH NEXT 3 ROWS ONLY
+    WHERE f0 > t2.f0
+    ORDER BY f2
+    DESC LIMIT 3
   )
       ]]>
     </Resource>
@@ -366,9 +322,9 @@ LogicalProject(f0=[$0], f1=[$1])
    :- LogicalAggregate(group=[{0}])
    :  +- LogicalProject(f0=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[2], fetch=[3])
+   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
       +- LogicalProject(f1=[$1], f2=[$2])
-         +- LogicalFilter(condition=[=($0, $cor0.f0)])
+         +- LogicalFilter(condition=[>($0, $cor0.f0)])
             +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
@@ -379,23 +335,24 @@ LogicalProject(f0=[$0], f1=[$1])
    :- LogicalAggregate(group=[{0}])
    :  +- LogicalProject(f0=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[2], fetch=[3])
+   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
       +- LogicalProject(f1=[$1], f2=[$2])
-         +- LogicalFilter(condition=[=($0, $cor0.f0)])
+         +- LogicalFilter(condition=[>($0, $cor0.f0)])
             +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonEqualConditionNotSupported">
+  <TestCase name="testNonInnerJoinNotSupported">
     <Resource name="sql">
       <![CDATA[
 SELECT f0, f1
 FROM
-  (SELECT DISTINCT f0 FROM t1) t2,
+  (SELECT DISTINCT f0 FROM t1) t2
+  NATURAL LEFT JOIN
   LATERAL (
     SELECT f1, f2
     FROM t1
-    WHERE f0 > t2.f0
+    WHERE f0 = t2.f0
     ORDER BY f2
     DESC LIMIT 3
   )
@@ -404,26 +361,69 @@ FROM
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f0=[$0], f1=[$1])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
++- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    :- LogicalAggregate(group=[{0}])
    :  +- LogicalProject(f0=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
    +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
       +- LogicalProject(f1=[$1], f2=[$2])
-         +- LogicalFilter(condition=[>($0, $cor0.f0)])
+         +- LogicalFilter(condition=[=($0, $cor0.f0)])
             +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(f0=[$0], f1=[$1])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
++- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    :- LogicalAggregate(group=[{0}])
    :  +- LogicalProject(f0=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
    +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
       +- LogicalProject(f1=[$1], f2=[$2])
-         +- LogicalFilter(condition=[>($0, $cor0.f0)])
+         +- LogicalFilter(condition=[=($0, $cor0.f0)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSortWithOffsetNotSupported">
+    <Resource name="sql">
+      <![CDATA[
+SELECT f0, f1
+FROM
+  (SELECT DISTINCT f0 FROM t1) t2,
+  LATERAL (
+    SELECT f1, f2
+    FROM t1
+    WHERE f0 = t2.f0
+    ORDER BY f2 DESC
+    OFFSET 2 ROWS
+    FETCH NEXT 3 ROWS ONLY
+  )
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(f0=[$0], f1=[$1])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
+   :- LogicalAggregate(group=[{0}])
+   :  +- LogicalProject(f0=[$0])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[2], fetch=[3])
+      +- LogicalProject(f1=[$1], f2=[$2])
+         +- LogicalFilter(condition=[=($0, $cor0.f0)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(f0=[$0], f1=[$1])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
+   :- LogicalAggregate(group=[{0}])
+   :  +- LogicalProject(f0=[$0])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+   +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[2], fetch=[3])
+      +- LogicalProject(f1=[$1], f2=[$2])
+         +- LogicalFilter(condition=[=($0, $cor0.f0)])
             +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/DecomposeGroupingSetsRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/DecomposeGroupingSetsRuleTest.xml
index f12b0b46225..b7763815535 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/DecomposeGroupingSetsRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/DecomposeGroupingSetsRuleTest.xml
@@ -82,56 +82,51 @@ FlinkLogicalCalc(select=[b, c, a, 0 AS g, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupingSetsWithOneGrouping">
+  <TestCase name="testGroupingSets">
     <Resource name="sql">
       <![CDATA[
-SELECT b,
-    AVG(a) AS a,
-    GROUP_ID() as g,
-    GROUPING(b) as gb,
-    GROUPING_ID(b) as gib
-FROM MyTable
-    GROUP BY GROUPING SETS (b)
+SELECT b, c, avg(a) AS a, GROUP_ID() AS g FROM MyTable
+GROUP BY GROUPING SETS (b, c)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$0], a=[$1], g=[0:BIGINT], gb=[$2], gib=[$3])
-+- LogicalAggregate(group=[{0}], a=[AVG($1)], gb=[GROUPING($0)], gib=[GROUPING_ID($0)])
-   +- LogicalProject(b=[$1], a=[$0])
+LogicalProject(b=[$0], c=[$1], a=[$2], g=[0:BIGINT])
++- LogicalAggregate(group=[{0, 1}], groups=[[{0}, {1}]], a=[AVG($2)])
+   +- LogicalProject(b=[$1], c=[$2], a=[$0])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[b, a, 0 AS g, 0 AS gb, 0 AS gib])
-+- FlinkLogicalAggregate(group=[{0}], a=[AVG($1)])
-   +- FlinkLogicalCalc(select=[b, a])
+FlinkLogicalCalc(select=[b, c, a, 0 AS g])
++- FlinkLogicalAggregate(group=[{1, 2, 3}], a=[AVG($0)])
+   +- FlinkLogicalExpand(projects=[{a, b, null AS c, 1 AS $e}, {a, null AS b, c, 2 AS $e}])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupingSets">
+  <TestCase name="testGroupingSetsWithDuplicateFields1">
     <Resource name="sql">
       <![CDATA[
-SELECT b, c, avg(a) AS a, GROUP_ID() AS g FROM MyTable
-GROUP BY GROUPING SETS (b, c)
+SELECT count(b) as b, count(c) as c FROM MyTable GROUP BY GROUPING SETS (b, c)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$0], c=[$1], a=[$2], g=[0:BIGINT])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0}, {1}]], a=[AVG($2)])
-   +- LogicalProject(b=[$1], c=[$2], a=[$0])
+LogicalProject(b=[$2], c=[$3])
++- LogicalAggregate(group=[{0, 1}], groups=[[{0}, {1}]], b=[COUNT($0)], c=[COUNT($1)])
+   +- LogicalProject(b=[$1], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[b, c, a, 0 AS g])
-+- FlinkLogicalAggregate(group=[{1, 2, 3}], a=[AVG($0)])
-   +- FlinkLogicalExpand(projects=[{a, b, null AS c, 1 AS $e}, {a, null AS b, c, 2 AS $e}])
-      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+FlinkLogicalCalc(select=[b_0 AS b, c_0 AS c])
++- FlinkLogicalAggregate(group=[{0, 1, 2}], b=[COUNT($3)], c=[COUNT($4)])
+   +- FlinkLogicalExpand(projects=[{b, null AS c, 1 AS $e, b AS b_0, c AS c_0}, {null AS b, c, 2 AS $e, b AS b_0, c AS c_0}])
+      +- FlinkLogicalCalc(select=[b, c])
+         +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -155,6 +150,35 @@ FlinkLogicalCalc(select=[a_0 AS a, b_0 AS b, c_0 AS c])
 +- FlinkLogicalAggregate(group=[{0, 1, 2, 3}], a=[COUNT($0)], b=[COUNT($4)], c=[COUNT($5)])
    +- FlinkLogicalExpand(projects=[{a, b, null AS c, 1 AS $e, b AS b_0, c AS c_0}, {a, null AS b, c, 2 AS $e, b AS b_0, c AS c_0}])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testGroupingSetsWithOneGrouping">
+    <Resource name="sql">
+      <![CDATA[
+SELECT b,
+    AVG(a) AS a,
+    GROUP_ID() as g,
+    GROUPING(b) as gb,
+    GROUPING_ID(b) as gib
+FROM MyTable
+    GROUP BY GROUPING SETS (b)
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$0], a=[$1], g=[0:BIGINT], gb=[$2], gib=[$3])
++- LogicalAggregate(group=[{0}], a=[AVG($1)], gb=[GROUPING($0)], gib=[GROUPING_ID($0)])
+   +- LogicalProject(b=[$1], a=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[b, a, 0 AS g, 0 AS gb, 0 AS gib])
++- FlinkLogicalAggregate(group=[{0}], a=[AVG($1)])
+   +- FlinkLogicalCalc(select=[b, a])
+      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -187,30 +211,6 @@ FlinkLogicalCalc(select=[b, c, a, 0 AS g, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS
 +- FlinkLogicalAggregate(group=[{1, 2, 3}], a=[AVG($0)])
    +- FlinkLogicalExpand(projects=[{a, b, c, 0 AS $e}, {a, b, null AS c, 1 AS $e}, {a, null AS b, null AS c, 3 AS $e}])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testGroupingSetsWithDuplicateFields1">
-    <Resource name="sql">
-      <![CDATA[
-SELECT count(b) as b, count(c) as c FROM MyTable GROUP BY GROUPING SETS (b, c)
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$2], c=[$3])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0}, {1}]], b=[COUNT($0)], c=[COUNT($1)])
-   +- LogicalProject(b=[$1], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[b_0 AS b, c_0 AS c])
-+- FlinkLogicalAggregate(group=[{0, 1, 2}], b=[COUNT($3)], c=[COUNT($4)])
-   +- FlinkLogicalExpand(projects=[{b, null AS c, 1 AS $e, b AS b_0, c AS c_0}, {null AS b, c, 2 AS $e, b AS b_0, c AS c_0}])
-      +- FlinkLogicalCalc(select=[b, c])
-         +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ExpressionReductionRulesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ExpressionReductionRulesTest.xml
index b07d045d370..6bb55465846 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ExpressionReductionRulesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ExpressionReductionRulesTest.xml
@@ -16,54 +16,71 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testExpressionReductionWithPythonUDF">
+  <TestCase name="testExpressionReductionWithNonReducibleMultipleUDF">
     <Resource name="sql">
-      <![CDATA[SELECT PyUdf(), MyUdf(1) FROM MyTable]]>
+      <![CDATA[SELECT MyUdf2(MyUdf1(1)), MyUdf1(MyUdf2(1)) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[PyUdf()], EXPR$1=[MyUdf(1)])
+LogicalProject(EXPR$0=[MyUdf2(MyUdf1(1))], EXPR$1=[MyUdf1(MyUdf2(1))])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
-    <Resource name="optimized exec plan">
+    <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[f0 AS EXPR$0, CAST(2 AS INTEGER) AS EXPR$1])
-+- PythonCalc(select=[PyUdf() AS f0])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Calc(select=[MyUdf2(MyUdf1(1)) AS EXPR$0, MyUdf1(MyUdf2(1)) AS EXPR$1])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExpressionReductionWithRand">
+  <TestCase name="testExpressionReductionWithNonReducibleUDF">
     <Resource name="sql">
-      <![CDATA[SELECT RAND(), RAND(), RAND(1), RAND(1), RAND_INTEGER(3), RAND_INTEGER(3) FROM MyTable]]>
+      <![CDATA[SELECT MyUdf(1) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[RAND()], EXPR$1=[RAND()], EXPR$2=[RAND(1)], EXPR$3=[RAND(1)], EXPR$4=[RAND_INTEGER(3)], EXPR$5=[RAND_INTEGER(3)])
+LogicalProject(EXPR$0=[MyUdf(1)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
-    <Resource name="optimized exec plan">
+    <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[RAND() AS EXPR$0, RAND() AS EXPR$1, RAND(1) AS EXPR$2, RAND(1) AS EXPR$3, RAND_INTEGER(3) AS EXPR$4, RAND_INTEGER(3) AS EXPR$5])
+Calc(select=[MyUdf(1) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExpressionReductionWithUDF">
+  <TestCase name="testExpressionReductionWithPythonUDF">
     <Resource name="sql">
-      <![CDATA[SELECT MyUdf(1) FROM MyTable]]>
+      <![CDATA[SELECT PyUdf(), MyUdf(1) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[MyUdf(1)])
+LogicalProject(EXPR$0=[PyUdf()], EXPR$1=[MyUdf(1)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
-    <Resource name="optimized rel plan">
+    <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[CAST(2 AS INTEGER) AS EXPR$0])
+Calc(select=[f0 AS EXPR$0, CAST(2 AS INTEGER) AS EXPR$1])
++- PythonCalc(select=[PyUdf() AS f0])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testExpressionReductionWithRand">
+    <Resource name="sql">
+      <![CDATA[SELECT RAND(), RAND(), RAND(1), RAND(1), RAND_INTEGER(3), RAND_INTEGER(3) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[RAND()], EXPR$1=[RAND()], EXPR$2=[RAND(1)], EXPR$3=[RAND(1)], EXPR$4=[RAND_INTEGER(3)], EXPR$5=[RAND_INTEGER(3)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[RAND() AS EXPR$0, RAND() AS EXPR$1, RAND(1) AS EXPR$2, RAND(1) AS EXPR$3, RAND_INTEGER(3) AS EXPR$4, RAND_INTEGER(3) AS EXPR$5])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -102,38 +119,21 @@ Calc(select=[myUdf(+(1, 1)) AS EXPR$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testExpressionReductionWithNonReducibleUDF">
-	<Resource name="sql">
-		<![CDATA[SELECT MyUdf(1) FROM MyTable]]>
-	</Resource>
-	<Resource name="ast">
-		<![CDATA[
+  <TestCase name="testExpressionReductionWithUDF">
+    <Resource name="sql">
+      <![CDATA[SELECT MyUdf(1) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(EXPR$0=[MyUdf(1)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-	</Resource>
-	<Resource name="optimized rel plan">
-		<![CDATA[
-Calc(select=[MyUdf(1) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-	</Resource>
-  </TestCase>
-  <TestCase name="testExpressionReductionWithNonReducibleMultipleUDF">
-	<Resource name="sql">
-		<![CDATA[SELECT MyUdf2(MyUdf1(1)), MyUdf1(MyUdf2(1)) FROM MyTable]]>
-	</Resource>
-	<Resource name="ast">
-		<![CDATA[
-LogicalProject(EXPR$0=[MyUdf2(MyUdf1(1))], EXPR$1=[MyUdf1(MyUdf2(1))])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-	</Resource>
-	<Resource name="optimized rel plan">
-		<![CDATA[
-Calc(select=[MyUdf2(MyUdf1(1)) AS EXPR$0, MyUdf1(MyUdf2(1)) AS EXPR$1])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[CAST(2 AS INTEGER) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
-	</Resource>
+    </Resource>
   </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateExpandDistinctAggregatesRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateExpandDistinctAggregatesRuleTest.xml
index 7d4852a989f..a766fdcef9b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateExpandDistinctAggregatesRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateExpandDistinctAggregatesRuleTest.xml
@@ -16,6 +16,52 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
+  <TestCase name="TestMultiDistinctOnDifferentColumnWithFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
+COUNT(DISTINCT b) FILTER (WHERE b > 1) FROM MyTable2 GROUP BY d]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[COUNT(DISTINCT $3) FILTER $4])
++- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], b=[$1], $f4=[IS TRUE(>($1, 1))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1) FILTER $4], EXPR$2=[COUNT($1) FILTER $3], EXPR$3=[COUNT($2) FILTER $5])
++- FlinkLogicalCalc(select=[d, c, b, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, 12), 3), IS TRUE($f2)) AS $g_3, =(CASE(=($e, 3), 3, =($e, 7), 7, 12), 7) AS $g_7, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, 12), 12), IS TRUE($f4)) AS $g_12])
+   +- FlinkLogicalAggregate(group=[{0, 1, 2, 3, 4, 5}])
+      +- FlinkLogicalExpand(projects=[{d, c, $f2, null AS b, null AS $f4, 3 AS $e}, {d, c, null AS $f2, null AS b, null AS $f4, 7 AS $e}, {d, null AS c, null AS $f2, b, $f4, 12 AS $e}])
+         +- FlinkLogicalCalc(select=[d, c, IS TRUE(>(a, 0)) AS $f2, b, IS TRUE(>(b, 1)) AS $f4])
+            +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="TestMultiDistinctWithFilterAndNonDistinctAgg">
+    <Resource name="sql">
+      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
+MAX(e), MIN(e) FROM MyTable2 GROUP BY d]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[MAX($3)], EXPR$4=[MIN($3)])
++- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], e=[$4])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1) FILTER $5], EXPR$2=[COUNT($1) FILTER $4], EXPR$3=[MIN($2) FILTER $6], EXPR$4=[MIN($3) FILTER $6])
++- FlinkLogicalCalc(select=[d, c, EXPR$3, EXPR$4, AND(=(CASE(=($e, 0), 0, =($e, 1), 1, 3), 0), IS TRUE($f2)) AS $g_0, =(CASE(=($e, 0), 0, =($e, 1), 1, 3), 1) AS $g_1, =(CASE(=($e, 0), 0, =($e, 1), 1, 3), 3) AS $g_3])
+   +- FlinkLogicalAggregate(group=[{0, 1, 2, 4}], EXPR$3=[MAX($3)], EXPR$4=[MIN($3)])
+      +- FlinkLogicalExpand(projects=[{d, c, $f2, e, 0 AS $e}, {d, c, null AS $f2, e, 1 AS $e}, {d, null AS c, null AS $f2, e, 3 AS $e}])
+         +- FlinkLogicalCalc(select=[d, c, IS TRUE(>(a, 0)) AS $f2, e])
+            +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testDistinctAggWithDuplicateField">
     <Resource name="sql">
       <![CDATA[SELECT a, COUNT(a), SUM(b), SUM(DISTINCT b) FROM MyTable GROUP BY a]]>
@@ -294,29 +340,6 @@ FlinkLogicalAggregate(group=[{0}], EXPR$1=[MIN($3) FILTER $8], EXPR$2=[MIN($4) F
       +- FlinkLogicalExpand(projects=[{d, e, $f2, c, $f4, null AS b, null AS $f6, 3 AS $e}, {d, e, $f2, c, null AS $f4, null AS b, null AS $f6, 7 AS $e}, {d, e, $f2, null AS c, null AS $f4, b, $f6, 12 AS $e}, {d, e, $f2, null AS c, null AS $f4, null AS b, null AS $f6, 15 AS $e}])
          +- FlinkLogicalCalc(select=[d, e, IS TRUE(<(a, 10)) AS $f2, c, IS TRUE(>(a, 5)) AS $f4, b, IS TRUE(>(b, 3)) AS $f6])
             +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="TestMultiDistinctOnDifferentColumnWithFilter">
-    <Resource name="sql">
-      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
-COUNT(DISTINCT b) FILTER (WHERE b > 1) FROM MyTable2 GROUP BY d]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[COUNT(DISTINCT $3) FILTER $4])
-+- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], b=[$1], $f4=[IS TRUE(>($1, 1))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1) FILTER $4], EXPR$2=[COUNT($1) FILTER $3], EXPR$3=[COUNT($2) FILTER $5])
-+- FlinkLogicalCalc(select=[d, c, b, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, 12), 3), IS TRUE($f2)) AS $g_3, =(CASE(=($e, 3), 3, =($e, 7), 7, 12), 7) AS $g_7, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, 12), 12), IS TRUE($f4)) AS $g_12])
-   +- FlinkLogicalAggregate(group=[{0, 1, 2, 3, 4, 5}])
-      +- FlinkLogicalExpand(projects=[{d, c, $f2, null AS b, null AS $f4, 3 AS $e}, {d, c, null AS $f2, null AS b, null AS $f4, 7 AS $e}, {d, null AS c, null AS $f2, b, $f4, 12 AS $e}])
-         +- FlinkLogicalCalc(select=[d, c, IS TRUE(>(a, 0)) AS $f2, b, IS TRUE(>(b, 1)) AS $f4])
-            +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -340,29 +363,6 @@ FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1) FILTER $4], EXPR$2=[COUNT($
       +- FlinkLogicalExpand(projects=[{d, c, $f2, null AS $f3, 1 AS $e}, {d, c, null AS $f2, $f3, 2 AS $e}, {d, c, null AS $f2, null AS $f3, 3 AS $e}])
          +- FlinkLogicalCalc(select=[d, c, IS TRUE(>(a, 10)) AS $f2, IS TRUE(<(a, 10)) AS $f3])
             +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="TestMultiDistinctWithFilterAndNonDistinctAgg">
-    <Resource name="sql">
-      <![CDATA[SELECT d, COUNT(DISTINCT c), COUNT(DISTINCT c) FILTER (WHERE a > 0),
-MAX(e), MIN(e) FROM MyTable2 GROUP BY d]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $1) FILTER $2], EXPR$3=[MAX($3)], EXPR$4=[MIN($3)])
-+- LogicalProject(d=[$3], c=[$2], $f2=[IS TRUE(>($0, 0))], e=[$4])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalAggregate(group=[{0}], EXPR$1=[COUNT($1) FILTER $5], EXPR$2=[COUNT($1) FILTER $4], EXPR$3=[MIN($2) FILTER $6], EXPR$4=[MIN($3) FILTER $6])
-+- FlinkLogicalCalc(select=[d, c, EXPR$3, EXPR$4, AND(=(CASE(=($e, 0), 0, =($e, 1), 1, 3), 0), IS TRUE($f2)) AS $g_0, =(CASE(=($e, 0), 0, =($e, 1), 1, 3), 1) AS $g_1, =(CASE(=($e, 0), 0, =($e, 1), 1, 3), 3) AS $g_3])
-   +- FlinkLogicalAggregate(group=[{0, 1, 2, 4}], EXPR$3=[MAX($3)], EXPR$4=[MIN($3)])
-      +- FlinkLogicalExpand(projects=[{d, c, $f2, e, 0 AS $e}, {d, c, null AS $f2, e, 1 AS $e}, {d, null AS c, null AS $f2, e, 3 AS $e}])
-         +- FlinkLogicalCalc(select=[d, c, IS TRUE(>(a, 0)) AS $f2, e])
-            +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
@@ -521,29 +521,6 @@ FlinkLogicalCalc(select=[EXPR$0])
       +- FlinkLogicalExpand(projects=[{c, null AS d, a, b, 1 AS $e}, {null AS c, d, a, b, 2 AS $e}])
          +- FlinkLogicalCalc(select=[c, d, a, b])
             +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTwoDistinctAggWithGroupByAndCountStar">
-    <Resource name="sql">
-      <![CDATA[SELECT a, COUNT(*), SUM(DISTINCT b), COUNT(DISTINCT b) FROM MyTable GROUP BY a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT()], EXPR$2=[SUM(DISTINCT $1)], EXPR$3=[COUNT(DISTINCT $1)])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a, CAST(EXPR$1 AS BIGINT) AS EXPR$1, EXPR$2, EXPR$3])
-+- FlinkLogicalAggregate(group=[{0}], EXPR$1=[MIN($2) FILTER $4], EXPR$2=[SUM($1) FILTER $3], EXPR$3=[COUNT($1) FILTER $3])
-   +- FlinkLogicalCalc(select=[a, b, EXPR$1, =(CASE(=($e, 0), 0, 1), 0) AS $g_0, =(CASE(=($e, 0), 0, 1), 1) AS $g_1])
-      +- FlinkLogicalAggregate(group=[{0, 1, 2}], EXPR$1=[COUNT()])
-         +- FlinkLogicalExpand(projects=[{a, b, 0 AS $e}, {a, null AS b, 1 AS $e}])
-            +- FlinkLogicalCalc(select=[a, b])
-               +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -631,6 +608,29 @@ FlinkLogicalCalc(select=[a, CAST(EXPR$1 AS BIGINT) AS EXPR$1, EXPR$2, EXPR$3])
       +- FlinkLogicalAggregate(group=[{0, 1, 2, 3}], EXPR$1=[COUNT()])
          +- FlinkLogicalExpand(projects=[{a, b, null AS c, 1 AS $e}, {a, null AS b, c, 2 AS $e}, {a, null AS b, null AS c, 3 AS $e}])
             +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoDistinctAggWithGroupByAndCountStar">
+    <Resource name="sql">
+      <![CDATA[SELECT a, COUNT(*), SUM(DISTINCT b), COUNT(DISTINCT b) FROM MyTable GROUP BY a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT()], EXPR$2=[SUM(DISTINCT $1)], EXPR$3=[COUNT(DISTINCT $1)])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a, CAST(EXPR$1 AS BIGINT) AS EXPR$1, EXPR$2, EXPR$3])
++- FlinkLogicalAggregate(group=[{0}], EXPR$1=[MIN($2) FILTER $4], EXPR$2=[SUM($1) FILTER $3], EXPR$3=[COUNT($1) FILTER $3])
+   +- FlinkLogicalCalc(select=[a, b, EXPR$1, =(CASE(=($e, 0), 0, 1), 0) AS $g_0, =(CASE(=($e, 0), 0, 1), 1) AS $g_1])
+      +- FlinkLogicalAggregate(group=[{0, 1, 2}], EXPR$1=[COUNT()])
+         +- FlinkLogicalExpand(projects=[{a, b, 0 AS $e}, {a, null AS b, 1 AS $e}])
+            +- FlinkLogicalCalc(select=[a, b])
+               +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml
index 1e905b99ba6..71e44335e3b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml
@@ -171,37 +171,6 @@ LogicalProject(EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$4], EXPR$3=[$5], a=[$0], b=[$1
       :        +- LogicalTableScan(table=[[default_catalog, default_database, T]])
       +- LogicalAggregate(group=[{0, 1}], EXPR$6=[COUNT($2)])
          +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSomeAggCallColumnsAndJoinConditionColumnsIsSame">
-    <Resource name="sql">
-      <![CDATA[
-SELECT MIN(a2), MIN(b2), a, b, COUNT(c2) FROM
-    (SELECT * FROM T2, T WHERE b2 = a) t GROUP BY a, b
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2], EXPR$1=[$3], a=[$0], b=[$1], EXPR$4=[$4])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)], EXPR$1=[MIN($3)], EXPR$4=[COUNT($4)])
-   +- LogicalProject(a=[$3], b=[$4], a2=[$0], b2=[$1], c2=[$2])
-      +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
-         +- LogicalFilter(condition=[=($1, $3)])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2], EXPR$1=[$3], a=[$0], b=[$1], EXPR$4=[$4])
-+- LogicalProject(a=[$3], b=[$4], a2=[$1], b2=[$0], $f6=[*($2, $5)])
-   +- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
-      :- LogicalProject(b2=[$1], a2=[$0], $f2=[CASE(IS NOT NULL($2), 1:BIGINT, 0:BIGINT)])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-      +- LogicalAggregate(group=[{0, 1}], agg#0=[COUNT()])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
   </TestCase>
@@ -257,6 +226,37 @@ LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, T]])
       +- LogicalAggregate(group=[{0}], agg#0=[COUNT()])
          +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSomeAggCallColumnsAndJoinConditionColumnsIsSame">
+    <Resource name="sql">
+      <![CDATA[
+SELECT MIN(a2), MIN(b2), a, b, COUNT(c2) FROM
+    (SELECT * FROM T2, T WHERE b2 = a) t GROUP BY a, b
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2], EXPR$1=[$3], a=[$0], b=[$1], EXPR$4=[$4])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)], EXPR$1=[MIN($3)], EXPR$4=[COUNT($4)])
+   +- LogicalProject(a=[$3], b=[$4], a2=[$0], b2=[$1], c2=[$2])
+      +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
+         +- LogicalFilter(condition=[=($1, $3)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2], EXPR$1=[$3], a=[$0], b=[$1], EXPR$4=[$4])
++- LogicalProject(a=[$3], b=[$4], a2=[$1], b2=[$0], $f6=[*($2, $5)])
+   +- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
+      :- LogicalProject(b2=[$1], a2=[$0], $f2=[CASE(IS NOT NULL($2), 1:BIGINT, 0:BIGINT)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalAggregate(group=[{0, 1}], agg#0=[COUNT()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkCalcMergeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkCalcMergeRuleTest.xml
index 977a3218756..b408743f4cf 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkCalcMergeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkCalcMergeRuleTest.xml
@@ -16,26 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCalcMergeWithTopMultiNonDeterministicExpr">
-    <Resource name="sql">
-      <![CDATA[SELECT random_udf(a1) as a2, random_udf(a1) as a3 FROM (SELECT random_udf(a) as a1, b FROM MyTable) t WHERE b > 10]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a2=[random_udf($0)], a3=[random_udf($0)])
-+- LogicalFilter(condition=[>($1, 10)])
-   +- LogicalProject(a1=[random_udf($0)], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[random_udf(a1) AS a2, random_udf(a1) AS a3])
-+- FlinkLogicalCalc(select=[random_udf(a) AS a1, b], where=[>(b, 10)])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testCalcMergeTopFilterHasNonDeterministicExpr">
     <Resource name="sql">
       <![CDATA[SELECT a, c FROM (SELECT a, random_udf(b) as b1, c FROM MyTable) t WHERE b1 > 10]]>
@@ -112,40 +92,41 @@ FlinkLogicalCalc(select=[random_udf(random_udf(a)) AS a2], where=[>(b, 10)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCalcMergeWithNonDeterministicExpr2">
+  <TestCase name="testCalcMergeWithNonDeterministicExpr1">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM (SELECT a FROM MyTable) t WHERE random_udf(a) > 10]]>
+      <![CDATA[SELECT a, a1 FROM (SELECT a, random_udf(a) AS a1 FROM MyTable) t WHERE a1 > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[>(random_udf($0), 10)])
-   +- LogicalProject(a=[$0])
+LogicalProject(a=[$0], a1=[$1])
++- LogicalFilter(condition=[>($1, 10)])
+   +- LogicalProject(a=[$0], a1=[random_udf($0)])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a], where=[>(random_udf(a), 10)])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+FlinkLogicalCalc(select=[a, a1], where=[>(a1, 10)])
++- FlinkLogicalCalc(select=[a, random_udf(a) AS a1])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCalcMergeWithoutInnerNonDeterministicExpr">
+  <TestCase name="testCalcMergeWithNonDeterministicExpr2">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM (SELECT a, random_udf(a) as a1, c FROM MyTable) t WHERE c > 10]]>
+      <![CDATA[SELECT a FROM (SELECT a FROM MyTable) t WHERE random_udf(a) > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2])
-+- LogicalFilter(condition=[>(CAST($2):BIGINT, 10)])
-   +- LogicalProject(a=[$0], a1=[random_udf($0)], c=[$2])
+LogicalProject(a=[$0])
++- LogicalFilter(condition=[>(random_udf($0), 10)])
+   +- LogicalProject(a=[$0])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a, c], where=[>(CAST(c AS BIGINT), 10)])
+FlinkLogicalCalc(select=[a], where=[>(random_udf(a), 10)])
 +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -170,23 +151,42 @@ FlinkLogicalCalc(select=[a, b], where=[=(a, b)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCalcMergeWithNonDeterministicExpr1">
+  <TestCase name="testCalcMergeWithTopMultiNonDeterministicExpr">
     <Resource name="sql">
-      <![CDATA[SELECT a, a1 FROM (SELECT a, random_udf(a) AS a1 FROM MyTable) t WHERE a1 > 10]]>
+      <![CDATA[SELECT random_udf(a1) as a2, random_udf(a1) as a3 FROM (SELECT random_udf(a) as a1, b FROM MyTable) t WHERE b > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], a1=[$1])
+LogicalProject(a2=[random_udf($0)], a3=[random_udf($0)])
 +- LogicalFilter(condition=[>($1, 10)])
-   +- LogicalProject(a=[$0], a1=[random_udf($0)])
+   +- LogicalProject(a1=[random_udf($0)], b=[$1])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a, a1], where=[>(a1, 10)])
-+- FlinkLogicalCalc(select=[a, random_udf(a) AS a1])
+FlinkLogicalCalc(select=[random_udf(a1) AS a2, random_udf(a1) AS a3])
++- FlinkLogicalCalc(select=[random_udf(a) AS a1, b], where=[>(b, 10)])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalcMergeWithoutInnerNonDeterministicExpr">
+    <Resource name="sql">
+      <![CDATA[SELECT a, c FROM (SELECT a, random_udf(a) as a1, c FROM MyTable) t WHERE c > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], c=[$2])
++- LogicalFilter(condition=[>(CAST($2):BIGINT, 10)])
+   +- LogicalProject(a=[$0], a1=[random_udf($0)], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a, c], where=[>(CAST(c AS BIGINT), 10)])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkFilterJoinRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkFilterJoinRuleTest.xml
index d370a671dc1..9d2ed41f764 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkFilterJoinRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkFilterJoinRuleTest.xml
@@ -247,30 +247,6 @@ LogicalProject(a=[$0], b=[$1])
       +- LogicalProject(c=[$0])
          +- LogicalFilter(condition=[true])
             +- LogicalTableScan(table=[[default_catalog, default_database, rightT]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testFullJoinWithSomeFiltersFromRightSide">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 FULL JOIN MyTable2 ON a1 = a2 AND b1 = b2 WHERE a2 = 2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalFilter(condition=[=($5, 2)])
-   +- LogicalJoin(condition=[AND(=($0, $5), =($1, $3))], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalJoin(condition=[AND(=($0, $5), =($1, $3))], joinType=[right])
-   :- LogicalFilter(condition=[=($0, 2)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalFilter(condition=[=($2, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
@@ -364,6 +340,30 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalFilter(condition=[=($2, 2)])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testFullJoinWithSomeFiltersFromRightSide">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable1 FULL JOIN MyTable2 ON a1 = a2 AND b1 = b2 WHERE a2 = 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
++- LogicalFilter(condition=[=($5, 2)])
+   +- LogicalJoin(condition=[AND(=($0, $5), =($1, $3))], joinType=[full])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
++- LogicalJoin(condition=[AND(=($0, $5), =($1, $3))], joinType=[right])
+   :- LogicalFilter(condition=[=($0, 2)])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalFilter(condition=[=($2, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
@@ -924,28 +924,6 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalFilter(condition=[AND(=($2, 2), >($0, 10))])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRightJoinWithAllFilterInONClause">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 RIGHT JOIN MyTable2 ON a1 = a2 AND a1 = 2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalJoin(condition=[AND(=($0, $5), =($0, 2))], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-   :- LogicalFilter(condition=[=($0, 2)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
@@ -1187,28 +1165,25 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightJoinWithNullFilterInRightSide2">
+  <TestCase name="testRightJoinWithAllFilterInONClause">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 RIGHT JOIN MyTable2 ON a1 = a2 WHERE a1 IS NULL AND a2 < 10]]>
+      <![CDATA[SELECT * FROM MyTable1 RIGHT JOIN MyTable2 ON a1 = a2 AND a1 = 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalFilter(condition=[AND(IS NULL($0), <($5, 10))])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalJoin(condition=[AND(=($0, $5), =($0, 2))], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalFilter(condition=[IS NULL($0)])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-      :- LogicalFilter(condition=[<($0, 10)])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-      +- LogicalFilter(condition=[<($2, 10)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+   :- LogicalFilter(condition=[=($0, 2)])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
@@ -1259,14 +1234,14 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightJoinWithSomeFiltersFromRightSide">
+  <TestCase name="testRightJoinWithNullFilterInRightSide2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 RIGHT JOIN MyTable2 ON a1 = a2 WHERE a2 = 2]]>
+      <![CDATA[SELECT * FROM MyTable1 RIGHT JOIN MyTable2 ON a1 = a2 WHERE a1 IS NULL AND a2 < 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalFilter(condition=[=($5, 2)])
++- LogicalFilter(condition=[AND(IS NULL($0), <($5, 10))])
    +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
@@ -1275,11 +1250,12 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
-+- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-   :- LogicalFilter(condition=[=($0, 2)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalFilter(condition=[=($2, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalFilter(condition=[IS NULL($0)])
+   +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+      :- LogicalFilter(condition=[<($0, 10)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      +- LogicalFilter(condition=[<($2, 10)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
@@ -1304,6 +1280,30 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalFilter(condition=[AND(=($2, 2), >($0, 10), IS NOT NULL($1))])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithSomeFiltersFromRightSide">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable1 RIGHT JOIN MyTable2 ON a1 = a2 WHERE a2 = 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
++- LogicalFilter(condition=[=($5, 2)])
+   +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$1], c1=[$2], b2=[$3], c2=[$4], a2=[$5])
++- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+   :- LogicalFilter(condition=[=($0, 2)])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalFilter(condition=[=($2, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLimit0RemoveRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLimit0RemoveRuleTest.xml
index 54cf9531348..20b89a078e2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLimit0RemoveRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLimit0RemoveRuleTest.xml
@@ -35,30 +35,6 @@ LogicalSort(fetch=[0])
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalValues(tuples=[[]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLimitZeroWithNotIn">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a NOT IN (SELECT a FROM MyTable LIMIT 0)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalSort(fetch=[0])
-  LogicalProject(a=[$0])
-    LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-}))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[OR(IS NULL($0), IS NULL($3), =($0, $3))], joinType=[anti])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalValues(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
@@ -131,20 +107,27 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleLimitZero">
+  <TestCase name="testLimitZeroWithNotIn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable LIMIT 0]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a NOT IN (SELECT a FROM MyTable LIMIT 0)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalFilter(condition=[NOT(IN($0, {
 LogicalSort(fetch=[0])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
+  LogicalProject(a=[$0])
+    LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+}))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalValues(tuples=[[]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalJoin(condition=[OR(IS NULL($0), IS NULL($3), =($0, $3))], joinType=[anti])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalValues(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
@@ -162,6 +145,23 @@ LogicalSort(sort0=[$0], dir0=[ASC-nulls-first], offset=[10], fetch=[0])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalValues(tuples=[[]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLimitZeroWithOrderBy">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable ORDER BY a LIMIT 0]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSort(sort0=[$0], dir0=[ASC-nulls-first], fetch=[0])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalValues(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
@@ -184,13 +184,13 @@ LogicalProject(a=[$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitZeroWithOrderBy">
+  <TestCase name="testSimpleLimitZero">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable ORDER BY a LIMIT 0]]>
+      <![CDATA[SELECT * FROM MyTable LIMIT 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$0], dir0=[ASC-nulls-first], fetch=[0])
+LogicalSort(fetch=[0])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForConstantRangeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForConstantRangeTest.xml
index 29c9c82b6f8..da506419030 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForConstantRangeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForConstantRangeTest.xml
@@ -214,31 +214,6 @@ FlinkLogicalCalc(select=[a, b, w0$o0], where=[>(a, 10)])
 +- FlinkLogicalRank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=2], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])
    +- FlinkLogicalCalc(select=[a, b])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRowNumberFunc">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
- SELECT a, b, ROW_NUMBER() OVER (PARTITION BY b ORDER BY a) rn FROM MyTable) t
-WHERE rn <= 2
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], rn=[$2])
-+- LogicalFilter(condition=[<=($2, 2)])
-   +- LogicalProject(a=[$0], b=[$1], rn=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a, b, w0$o0], where=[<=(w0$o0, 2)])
-+- FlinkLogicalOverAggregate(window#0=[window(partition {1} order by [0 ASC-nulls-first] rows between UNBOUNDED PRECEDING and CURRENT ROW aggs [ROW_NUMBER()])])
-   +- FlinkLogicalCalc(select=[a, b])
-      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -338,27 +313,28 @@ FlinkLogicalCalc(select=[a, b, w0$o0], where=[=(w0$o0, b)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithoutPartitionBy">
+  <TestCase name="testRowNumberFunc">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM (
- SELECT a, b, RANK() OVER (ORDER BY a) rk FROM MyTable) t
-WHERE rk < 10
+ SELECT a, b, ROW_NUMBER() OVER (PARTITION BY b ORDER BY a) rn FROM MyTable) t
+WHERE rn <= 2
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], rk=[$2])
-+- LogicalFilter(condition=[<($2, 10)])
-   +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $0 NULLS FIRST)])
+LogicalProject(a=[$0], b=[$1], rn=[$2])
++- LogicalFilter(condition=[<=($2, 2)])
+   +- LogicalProject(a=[$0], b=[$1], rn=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalRank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], select=[a, b, w0$o0])
-+- FlinkLogicalCalc(select=[a, b])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+FlinkLogicalCalc(select=[a, b, w0$o0], where=[<=(w0$o0, 2)])
++- FlinkLogicalOverAggregate(window#0=[window(partition {1} order by [0 ASC-nulls-first] rows between UNBOUNDED PRECEDING and CURRENT ROW aggs [ROW_NUMBER()])])
+   +- FlinkLogicalCalc(select=[a, b])
+      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -375,6 +351,30 @@ LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (PARTITION BY $1 ORDER BY $0 NULL
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalOverAggregate(window#0=[window(partition {1} order by [0 ASC-nulls-first] aggs [RANK()])])
++- FlinkLogicalCalc(select=[a, b])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithoutPartitionBy">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+ SELECT a, b, RANK() OVER (ORDER BY a) rk FROM MyTable) t
+WHERE rk < 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], rk=[$2])
++- LogicalFilter(condition=[<($2, 10)])
+   +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $0 NULLS FIRST)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalRank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], select=[a, b, w0$o0])
 +- FlinkLogicalCalc(select=[a, b])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForRangeEndTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForRangeEndTest.xml
index 15feb7852de..f4606fc8eb4 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForRangeEndTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkLogicalRankRuleForRangeEndTest.xml
@@ -165,30 +165,6 @@ FlinkLogicalCalc(select=[a, b, w0$o0], where=[>(a, 10)])
 +- FlinkLogicalRank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=2], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])
    +- FlinkLogicalCalc(select=[a, b])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRowNumberFunc">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
- SELECT a, b, ROW_NUMBER() OVER (PARTITION BY b ORDER BY a) rn FROM MyTable) t
-WHERE rn <= 2
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], rn=[$2])
-+- LogicalFilter(condition=[<=($2, 2)])
-   +- LogicalProject(a=[$0], b=[$1], rn=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=2], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])
-+- FlinkLogicalCalc(select=[a, b])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -288,25 +264,25 @@ FlinkLogicalCalc(select=[a, b, w0$o0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithoutPartitionBy">
+  <TestCase name="testRowNumberFunc">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM (
- SELECT a, b, RANK() OVER (ORDER BY a) rk FROM MyTable) t
-WHERE rk < 10
+ SELECT a, b, ROW_NUMBER() OVER (PARTITION BY b ORDER BY a) rn FROM MyTable) t
+WHERE rn <= 2
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], rk=[$2])
-+- LogicalFilter(condition=[<($2, 10)])
-   +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $0 NULLS FIRST)])
+LogicalProject(a=[$0], b=[$1], rn=[$2])
++- LogicalFilter(condition=[<=($2, 2)])
+   +- LogicalProject(a=[$0], b=[$1], rn=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalRank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], select=[a, b, w0$o0])
+FlinkLogicalRank(rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=2], partitionBy=[b], orderBy=[a ASC], select=[a, b, w0$o0])
 +- FlinkLogicalCalc(select=[a, b])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
@@ -327,6 +303,30 @@ LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (PARTITION BY $1 ORDER BY $0 NULL
 FlinkLogicalCalc(select=[a, b, w0$o0 AS $2])
 +- FlinkLogicalOverAggregate(window#0=[window(partition {1} order by [0 ASC-nulls-first] aggs [RANK()])])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithoutPartitionBy">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+ SELECT a, b, RANK() OVER (ORDER BY a) rk FROM MyTable) t
+WHERE rk < 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], rk=[$2])
++- LogicalFilter(condition=[<($2, 10)])
+   +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $0 NULLS FIRST)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalRank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=9], partitionBy=[], orderBy=[a ASC], select=[a, b, w0$o0])
++- FlinkLogicalCalc(select=[a, b])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkPruneEmptyRulesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkPruneEmptyRulesTest.xml
index 9bd547f9a53..abf88a5994a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkPruneEmptyRulesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkPruneEmptyRulesTest.xml
@@ -16,28 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testSemiJoinRightIsEmpty">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 WHERE a IN (SELECT d FROM T2 WHERE 1=0)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(d=[$0])
-  LogicalFilter(condition=[=(1, 0)])
-    LogicalTableScan(table=[[default_catalog, default_database, T2]])
-})])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalValues(tuples=[[]])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testAntiJoinRightIsEmpty">
     <Resource name="sql">
       <![CDATA[SELECT * FROM T1 WHERE a NOT IN (SELECT d FROM T2 WHERE 1=0)]]>
@@ -240,6 +218,28 @@ LogicalMinus(all=[false])
 LogicalAggregate(group=[{0, 1}])
 +- LogicalProject(X=[$0], Y=[$1])
    +- LogicalValues(tuples=[[{ 30, 3 }, { 30, 3 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSemiJoinRightIsEmpty">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1 WHERE a IN (SELECT d FROM T2 WHERE 1=0)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(d=[$0])
+  LogicalFilter(condition=[=(1, 0)])
+    LogicalTableScan(table=[[default_catalog, default_database, T2]])
+})])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalValues(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkRightJoinToLeftJoinRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkRightJoinToLeftJoinRuleTest.xml
index 246e2bcf274..ce03cb892db 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkRightJoinToLeftJoinRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkRightJoinToLeftJoinRuleTest.xml
@@ -16,35 +16,33 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testRightJoin">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1 RIGHT JOIN T2 ON a = c]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testLeftJoinRemainsUnchanged">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1 LEFT JOIN T2 ON a = c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[right])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalProject(a=[$3], b=[$4], c=[$0], d=[$1], e=[$2])
-   +- LogicalJoin(condition=[=($3, $0)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
++- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testNestedProject">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM (SELECT * FROM T1 JOIN T2 ON a = c) RIGHT JOIN T3 ON a = f]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestedProject">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (SELECT * FROM T1 JOIN T2 ON a = c) RIGHT JOIN T3 ON a = f]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], g=[$6])
 +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
@@ -53,9 +51,9 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], g=[$6])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], g=[$6])
 +- LogicalProject(a=[$2], b=[$3], c=[$4], d=[$5], e=[$6], f=[$0], g=[$1])
    +- LogicalJoin(condition=[=($2, $0)], joinType=[left])
@@ -65,15 +63,14 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], g=[$6])
             :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
             +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightInnerJoinChain">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T2 RIGHT JOIN T3 on T2.c = T3.f JOIN T1 ON T1.a = T2.c]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightInnerJoinChain">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T2 RIGHT JOIN T3 on T2.c = T3.f JOIN T1 ON T1.a = T2.c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
 +- LogicalJoin(condition=[=($5, $0)], joinType=[inner])
    :- LogicalJoin(condition=[=($0, $3)], joinType=[right])
@@ -81,9 +78,9 @@ LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
 +- LogicalJoin(condition=[=($5, $0)], joinType=[inner])
    :- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$0], g=[$1])
@@ -92,92 +89,36 @@ LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightRightJoinChain">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T2 RIGHT JOIN T3 on T2.c = T3.f RIGHT JOIN T1 ON T1.a = T2.c]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
-+- LogicalJoin(condition=[=($5, $0)], joinType=[right])
-   :- LogicalJoin(condition=[=($0, $3)], joinType=[right])
-   :  :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
-+- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$5], g=[$6], a=[$0], b=[$1])
-   +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-      +- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$0], g=[$1])
-         +- LogicalJoin(condition=[=($2, $0)], joinType=[left])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightLeftJoinChain">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T2 RIGHT JOIN T3 on T2.c = T3.f LEFT JOIN T1 ON T1.a = T2.c]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
-+- LogicalJoin(condition=[=($5, $0)], joinType=[left])
-   :- LogicalJoin(condition=[=($0, $3)], joinType=[right])
-   :  :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
-+- LogicalJoin(condition=[=($5, $0)], joinType=[left])
-   :- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$0], g=[$1])
-   :  +- LogicalJoin(condition=[=($2, $0)], joinType=[left])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testLeftJoinRemainsUnchanged">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1 LEFT JOIN T2 ON a = c]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1 RIGHT JOIN T2 ON a = c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left])
++- LogicalJoin(condition=[=($0, $2)], joinType=[right])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-+- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
++- LogicalProject(a=[$3], b=[$4], c=[$0], d=[$1], e=[$2])
+   +- LogicalJoin(condition=[=($3, $0)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightJoinWithExpressionCondition">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM T1 RIGHT JOIN T2 ON a + 1 = c - 1]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithExpressionCondition">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1 RIGHT JOIN T2 ON a + 1 = c - 1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
 +- LogicalProject(a=[$0], b=[$1], c=[$3], d=[$4], e=[$5])
    +- LogicalJoin(condition=[=($2, $6)], joinType=[right])
@@ -186,9 +127,9 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
       +- LogicalProject(c=[$0], d=[$1], e=[$2], $f3=[-($0, 1)])
          +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
 +- LogicalProject(a=[$0], b=[$1], c=[$3], d=[$4], e=[$5])
    +- LogicalProject(a=[$4], b=[$5], $f2=[$6], c=[$0], d=[$1], e=[$2], $f3=[$3])
@@ -198,29 +139,81 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
          +- LogicalProject(a=[$0], b=[$1], $f2=[+($0, 1)])
             +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
-		</Resource>
-	</TestCase>
-
-	<TestCase name="testRightJoinWithProjection">
-		<Resource name="sql">
-			<![CDATA[SELECT b, d FROM T1 RIGHT JOIN T2 ON a = c]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinWithProjection">
+    <Resource name="sql">
+      <![CDATA[SELECT b, d FROM T1 RIGHT JOIN T2 ON a = c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(b=[$1], d=[$3])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[right])
    :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
 LogicalProject(b=[$1], d=[$3])
 +- LogicalProject(a=[$3], b=[$4], c=[$0], d=[$1], e=[$2])
    +- LogicalJoin(condition=[=($3, $0)], joinType=[left])
       :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
       +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightLeftJoinChain">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T2 RIGHT JOIN T3 on T2.c = T3.f LEFT JOIN T1 ON T1.a = T2.c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
++- LogicalJoin(condition=[=($5, $0)], joinType=[left])
+   :- LogicalJoin(condition=[=($0, $3)], joinType=[right])
+   :  :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
++- LogicalJoin(condition=[=($5, $0)], joinType=[left])
+   :- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$0], g=[$1])
+   :  +- LogicalJoin(condition=[=($2, $0)], joinType=[left])
+   :     :- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightRightJoinChain">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T2 RIGHT JOIN T3 on T2.c = T3.f RIGHT JOIN T1 ON T1.a = T2.c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
++- LogicalJoin(condition=[=($5, $0)], joinType=[right])
+   :- LogicalJoin(condition=[=($0, $3)], joinType=[right])
+   :  :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(c=[$0], d=[$1], e=[$2], f=[$3], g=[$4], a=[$5], b=[$6])
++- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$5], g=[$6], a=[$0], b=[$1])
+   +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+      +- LogicalProject(c=[$2], d=[$3], e=[$4], f=[$0], g=[$1])
+         +- LogicalJoin(condition=[=($2, $0)], joinType=[left])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml
index 4acfef9acbe..8c155ed2f31 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml
@@ -146,17 +146,17 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoin_Exist1">
+  <TestCase name="testSemiJoinWithNonEquiCondition_Exist1">
     <Resource name="sql">
       <![CDATA[
-SELECT * FROM MyTable1 WHERE EXISTS (SELECT * FROM MyTable2 WHERE a = d AND a = e)
+SELECT * FROM MyTable1 WHERE EXISTS (SELECT * FROM MyTable2 WHERE a = d AND a > e)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1))])
+LogicalFilter(condition=[AND(=($cor0.a, $0), >($cor0.a, $1))])
   LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -165,7 +165,7 @@ LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1))])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(=($3, $4), =($0, $3))], joinType=[semi])
++- LogicalJoin(condition=[AND(=($0, $3), >($0, $4))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -173,18 +173,18 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoin_Exist2">
+  <TestCase name="testSemiJoinWithNonEquiCondition_Exist2">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM MyTable1 WHERE EXISTS
-    (SELECT * FROM MyTable2 WHERE a = d AND a = e AND b = d)
+    (SELECT * FROM MyTable2 WHERE a = d AND a = e AND b > d)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1), =($cor0.b, $0))])
+LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1), >($cor0.b, $0))])
   LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -193,7 +193,7 @@ LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1), =($cor0.b, $0))])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(=($0, $1), =($3, $4), =($0, $3))], joinType=[semi])
++- LogicalJoin(condition=[AND(>($1, $3), =($3, $4), =($0, $3))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -201,16 +201,16 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoin_In1">
+  <TestCase name="testSemiJoinWithNonEquiCondition_In1">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a = e)]]>
+      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a > e)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalFilter(condition=[=($cor0.a, $1)])
+  LogicalFilter(condition=[>($cor0.a, $1)])
     LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -219,7 +219,7 @@ LogicalProject(d=[$0])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(=($3, $4), =($0, $3))], joinType=[semi])
++- LogicalJoin(condition=[AND(=($0, $3), >($0, $4))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -227,16 +227,16 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoin_In2">
+  <TestCase name="testSemiJoinWithNonEquiCondition_In2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a = e AND b = d)]]>
+      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a > e AND b = d)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalFilter(condition=[AND(=($cor0.a, $1), =($cor0.b, $0))])
+  LogicalFilter(condition=[AND(>($cor0.a, $1), =($cor0.b, $0))])
     LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -245,7 +245,7 @@ LogicalProject(d=[$0])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(=($0, $1), =($3, $4), =($0, $3))], joinType=[semi])
++- LogicalJoin(condition=[AND(>($0, $4), =($0, $1), =($0, $3))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -253,17 +253,17 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoinWithNonEquiCondition_Exist1">
+  <TestCase name="testSemiJoin_Exist1">
     <Resource name="sql">
       <![CDATA[
-SELECT * FROM MyTable1 WHERE EXISTS (SELECT * FROM MyTable2 WHERE a = d AND a > e)
+SELECT * FROM MyTable1 WHERE EXISTS (SELECT * FROM MyTable2 WHERE a = d AND a = e)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), >($cor0.a, $1))])
+LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1))])
   LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -272,7 +272,7 @@ LogicalFilter(condition=[AND(=($cor0.a, $0), >($cor0.a, $1))])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(=($0, $3), >($0, $4))], joinType=[semi])
++- LogicalJoin(condition=[AND(=($3, $4), =($0, $3))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -280,18 +280,18 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoinWithNonEquiCondition_Exist2">
+  <TestCase name="testSemiJoin_Exist2">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM MyTable1 WHERE EXISTS
-    (SELECT * FROM MyTable2 WHERE a = d AND a = e AND b > d)
+    (SELECT * FROM MyTable2 WHERE a = d AND a = e AND b = d)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[EXISTS({
-LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1), >($cor0.b, $0))])
+LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1), =($cor0.b, $0))])
   LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -300,7 +300,7 @@ LogicalFilter(condition=[AND(=($cor0.a, $0), =($cor0.a, $1), >($cor0.b, $0))])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(>($1, $3), =($3, $4), =($0, $3))], joinType=[semi])
++- LogicalJoin(condition=[AND(=($0, $1), =($3, $4), =($0, $3))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -308,16 +308,16 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoinWithNonEquiCondition_In1">
+  <TestCase name="testSemiJoin_In1">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a > e)]]>
+      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a = e)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalFilter(condition=[>($cor0.a, $1)])
+  LogicalFilter(condition=[=($cor0.a, $1)])
     LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -326,7 +326,7 @@ LogicalProject(d=[$0])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(=($0, $3), >($0, $4))], joinType=[semi])
++- LogicalJoin(condition=[AND(=($3, $4), =($0, $3))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
@@ -334,16 +334,16 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSemiJoinWithNonEquiCondition_In2">
+  <TestCase name="testSemiJoin_In2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a > e AND b = d)]]>
+      <![CDATA[SELECT * FROM MyTable1 WHERE a IN (SELECT d FROM MyTable2 WHERE a = e AND b = d)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalFilter(condition=[AND(>($cor0.a, $1), =($cor0.b, $0))])
+  LogicalFilter(condition=[AND(=($cor0.a, $1), =($cor0.b, $0))])
     LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 })], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
@@ -352,7 +352,7 @@ LogicalProject(d=[$0])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalJoin(condition=[AND(>($0, $4), =($0, $1), =($0, $3))], joinType=[semi])
++- LogicalJoin(condition=[AND(=($0, $1), =($3, $4), =($0, $3))], joinType=[semi])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalProject(d=[$0], e=[$1])
       +- LogicalFilter(condition=[true])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml
index b1a0af22e17..b578e1d34ad 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml
@@ -68,15 +68,15 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTE
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInToSemiJoinIntEqualsDecimal">
+  <TestCase name="testInToSemiJoinFloatEqualsDouble">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 WHERE T1.a IN (SELECT e FROM T2)]]>
+      <![CDATA[SELECT * FROM T1 WHERE T1.c IN (SELECT d FROM T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-+- LogicalFilter(condition=[IN($0, {
-LogicalProject(e=[$4])
++- LogicalFilter(condition=[IN($2, {
+LogicalProject(d=[$3])
   LogicalTableScan(table=[[default_catalog, default_database, T2]])
 })]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
@@ -85,24 +85,23 @@ LogicalProject(e=[$4])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-   +- LogicalJoin(condition=[=($5, $6)], joinType=[semi]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, DECIMAL(38, 18) a0)]
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], a0=[CAST($0):DECIMAL(38, 18)]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, DECIMAL(38, 18) a0)]
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-      +- LogicalProject(e=[$4]), rowType=[RecordType(DECIMAL(38, 18) e)]
++- LogicalJoin(condition=[=($2, $6)], joinType=[semi]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
+   +- LogicalProject(d=[$0], d0=[CAST($0):FLOAT]), rowType=[RecordType(DOUBLE d, FLOAT d0)]
+      +- LogicalProject(d=[$3]), rowType=[RecordType(DOUBLE d)]
          +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInToSemiJoinFloatEqualsDouble">
+  <TestCase name="testInToSemiJoinIntEqualsDecimal">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 WHERE T1.c IN (SELECT d FROM T2)]]>
+      <![CDATA[SELECT * FROM T1 WHERE T1.a IN (SELECT e FROM T2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-+- LogicalFilter(condition=[IN($2, {
-LogicalProject(d=[$3])
++- LogicalFilter(condition=[IN($0, {
+LogicalProject(e=[$4])
   LogicalTableScan(table=[[default_catalog, default_database, T2]])
 })]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
@@ -111,10 +110,11 @@ LogicalProject(d=[$3])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-+- LogicalJoin(condition=[=($2, $6)], joinType=[semi]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-   +- LogicalProject(d=[$0], d0=[CAST($0):FLOAT]), rowType=[RecordType(DOUBLE d, FLOAT d0)]
-      +- LogicalProject(d=[$3]), rowType=[RecordType(DOUBLE d)]
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
+   +- LogicalJoin(condition=[=($5, $6)], joinType=[semi]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, DECIMAL(38, 18) a0)]
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], a0=[CAST($0):DECIMAL(38, 18)]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, DECIMAL(38, 18) a0)]
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
+      +- LogicalProject(e=[$4]), rowType=[RecordType(DECIMAL(38, 18) e)]
          +- LogicalTableScan(table=[[default_catalog, default_database, T2]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDependentConditionDerivationRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDependentConditionDerivationRuleTest.xml
index 723e6fd0b97..2bb6d444a4e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDependentConditionDerivationRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDependentConditionDerivationRuleTest.xml
@@ -16,14 +16,14 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testThreeOr">
+  <TestCase name="testAnd">
     <Resource name="sql">
-      <![CDATA[SELECT a, d FROM MyTable1, MyTable2 WHERE (b = e AND a = 0) OR ((a = 1 AND d = 2) OR (a = 2 AND d = 1))]]>
+      <![CDATA[SELECT a, d FROM MyTable1, MyTable2 WHERE b = e AND ((a = 1 AND d = 2) OR (a = 2 AND d = 1))]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], d=[$3])
-+- LogicalFilter(condition=[OR(AND(=($1, $4), =($0, 0)), AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1)))])
++- LogicalFilter(condition=[AND(=($1, $4), OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
@@ -32,20 +32,20 @@ LogicalProject(a=[$0], d=[$3])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], d=[$3])
-+- LogicalJoin(condition=[AND(OR(AND(=($1, $4), =($0, 0)), AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[0, 1, 2]))], joinType=[inner])
++- LogicalJoin(condition=[AND(=($1, $4), OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[1, 2]), SEARCH($3, Sarg[1, 2]))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAnd">
+  <TestCase name="testAndOr">
     <Resource name="sql">
-      <![CDATA[SELECT a, d FROM MyTable1, MyTable2 WHERE b = e AND ((a = 1 AND d = 2) OR (a = 2 AND d = 1))]]>
+      <![CDATA[SELECT a, d FROM MyTable1, MyTable2 WHERE ((a = 1 AND d = 2) OR (a = 2 AND d = 1))]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], d=[$3])
-+- LogicalFilter(condition=[AND(=($1, $4), OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))))])
++- LogicalFilter(condition=[OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1)))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
@@ -54,7 +54,7 @@ LogicalProject(a=[$0], d=[$3])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], d=[$3])
-+- LogicalJoin(condition=[AND(=($1, $4), OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[1, 2]), SEARCH($3, Sarg[1, 2]))], joinType=[inner])
++- LogicalJoin(condition=[AND(OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[1, 2]), SEARCH($3, Sarg[1, 2]))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -101,28 +101,6 @@ LogicalProject(a=[$0], d=[$3])
 +- LogicalJoin(condition=[AND(OR(AND(=($0, 1), =($1, 1), =($3, 2), =($4, 2)), AND(=($0, 2), =($1, 2), =($3, 1), =($4, 1))), OR(AND(=(1, $0), =(1, $1)), AND(=(2, $0), =(2, $1))), OR(AND(=(2, $3), =(2, $4)), AND(=(1, $3), =(1, $4))))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testAndOr">
-    <Resource name="sql">
-      <![CDATA[SELECT a, d FROM MyTable1, MyTable2 WHERE ((a = 1 AND d = 2) OR (a = 2 AND d = 1))]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], d=[$3])
-+- LogicalFilter(condition=[OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1)))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0], d=[$3])
-+- LogicalJoin(condition=[AND(OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[1, 2]), SEARCH($3, Sarg[1, 2]))], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
@@ -202,6 +180,28 @@ LogicalProject(a=[$0], d=[$3])
 +- LogicalJoin(condition=[AND(OR(AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[1, 2]), SEARCH($3, Sarg[1, 2]))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testThreeOr">
+    <Resource name="sql">
+      <![CDATA[SELECT a, d FROM MyTable1, MyTable2 WHERE (b = e AND a = 0) OR ((a = 1 AND d = 2) OR (a = 2 AND d = 1))]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], d=[$3])
++- LogicalFilter(condition=[OR(AND(=($1, $4), =($0, 0)), AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1)))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], d=[$3])
++- LogicalJoin(condition=[AND(OR(AND(=($1, $4), =($0, 0)), AND(=($0, 1), =($3, 2)), AND(=($0, 2), =($3, 1))), SEARCH($0, Sarg[0, 1, 2]))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDeriveNullFilterRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDeriveNullFilterRuleTest.xml
index fc7dd67a464..29d16af7807 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDeriveNullFilterRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinDeriveNullFilterRuleTest.xml
@@ -37,14 +37,14 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerJoin_NoneEquiJoinKeys">
+  <TestCase name="testInnerJoin_NoNullCount">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 JOIN MyTable2 ON a1 > a2]]>
+      <![CDATA[SELECT * FROM MyTable1 JOIN MyTable2 ON d1 = d2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[>($0, $5)], joinType=[inner])
++- LogicalJoin(condition=[=($3, $8)], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
@@ -52,20 +52,20 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[>($0, $5)], joinType=[inner])
++- LogicalJoin(condition=[=($3, $8)], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerJoin_NoNullCount">
+  <TestCase name="testInnerJoin_NoneEquiJoinKeys">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 JOIN MyTable2 ON d1 = d2]]>
+      <![CDATA[SELECT * FROM MyTable1 JOIN MyTable2 ON a1 > a2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[=($3, $8)], joinType=[inner])
++- LogicalJoin(condition=[>($0, $5)], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
@@ -73,7 +73,7 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[=($3, $8)], joinType=[inner])
++- LogicalJoin(condition=[>($0, $5)], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
@@ -145,14 +145,14 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftJoin">
+  <TestCase name="testInnerJoin_NullCountOnRightJoinKeys">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 LEFT JOIN MyTable2 ON c1 = c2]]>
+      <![CDATA[SELECT * FROM MyTable1 JOIN MyTable2 ON b1 = b2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[=($2, $7)], joinType=[left])
++- LogicalJoin(condition=[=($1, $6)], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
@@ -160,20 +160,21 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[=($2, $7)], joinType=[left])
++- LogicalJoin(condition=[=($1, $6)], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
+   +- LogicalFilter(condition=[IS NOT NULL($1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInnerJoin_NullCountOnRightJoinKeys">
+  <TestCase name="testLeftJoin">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable1 JOIN MyTable2 ON b1 = b2]]>
+      <![CDATA[SELECT * FROM MyTable1 LEFT JOIN MyTable2 ON c1 = c2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[=($1, $6)], joinType=[inner])
++- LogicalJoin(condition=[=($2, $7)], joinType=[left])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
@@ -181,10 +182,9 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], e1=[$4], a2=[$5], b2=[$6], c2=[$7], d2=[$8], e2=[$9])
-+- LogicalJoin(condition=[=($1, $6)], joinType=[inner])
++- LogicalJoin(condition=[=($2, $7)], joinType=[left])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a1, b1, c1, d1, e1)]]])
-   +- LogicalFilter(condition=[IS NOT NULL($1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a2, b2, c2, d2, e2)]]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinPushExpressionsRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinPushExpressionsRuleTest.xml
index 1080952171f..b785cfb9cda 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinPushExpressionsRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinPushExpressionsRuleTest.xml
@@ -71,17 +71,16 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushExpressionsOnSemiJoin_NotIn">
+  <TestCase name="testPushExpressionsOnSemiJoin_NotExists">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM l WHERE a NOT IN (SELECT d FROM r WHERE b + 1 = e)]]>
+      <![CDATA[SELECT * FROM l WHERE NOT EXISTS (SELECT d FROM r WHERE CAST(b AS INTEGER) = d)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalFilter(condition=[NOT(IN($0, {
-LogicalProject(d=[$0])
-  LogicalFilter(condition=[=(+($cor0.b, 1), $1)])
-    LogicalTableScan(table=[[default_catalog, default_database, r]])
++- LogicalFilter(condition=[NOT(EXISTS({
+LogicalFilter(condition=[=(CAST($cor0.b):INTEGER, $0)])
+  LogicalTableScan(table=[[default_catalog, default_database, r]])
 }))], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, l]])
 ]]>
@@ -90,25 +89,26 @@ LogicalProject(d=[$0])
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalJoin(condition=[AND(OR(IS NULL($0), IS NULL($4), =($0, $4)), =($3, $5))], joinType=[anti])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[+($1, 1)])
+   +- LogicalJoin(condition=[=($3, $4)], joinType=[anti])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], b0=[CAST($1):INTEGER])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, l]])
-      +- LogicalProject(d=[$0], e=[$1])
+      +- LogicalProject(d=[$0])
          +- LogicalFilter(condition=[true])
             +- LogicalTableScan(table=[[default_catalog, default_database, r]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushExpressionsOnSemiJoin_NotExists">
+  <TestCase name="testPushExpressionsOnSemiJoin_NotIn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM l WHERE NOT EXISTS (SELECT d FROM r WHERE CAST(b AS INTEGER) = d)]]>
+      <![CDATA[SELECT * FROM l WHERE a NOT IN (SELECT d FROM r WHERE b + 1 = e)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalFilter(condition=[NOT(EXISTS({
-LogicalFilter(condition=[=(CAST($cor0.b):INTEGER, $0)])
-  LogicalTableScan(table=[[default_catalog, default_database, r]])
++- LogicalFilter(condition=[NOT(IN($0, {
+LogicalProject(d=[$0])
+  LogicalFilter(condition=[=(+($cor0.b, 1), $1)])
+    LogicalTableScan(table=[[default_catalog, default_database, r]])
 }))], variablesSet=[[$cor0]])
    +- LogicalTableScan(table=[[default_catalog, default_database, l]])
 ]]>
@@ -117,10 +117,10 @@ LogicalFilter(condition=[=(CAST($cor0.b):INTEGER, $0)])
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalJoin(condition=[=($3, $4)], joinType=[anti])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], b0=[CAST($1):INTEGER])
+   +- LogicalJoin(condition=[AND(OR(IS NULL($0), IS NULL($4), =($0, $4)), =($3, $5))], joinType=[anti])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[+($1, 1)])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, l]])
-      +- LogicalProject(d=[$0])
+      +- LogicalProject(d=[$0], e=[$1])
          +- LogicalFilter(condition=[true])
             +- LogicalTableScan(table=[[default_catalog, default_database, r]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinRemoveRulesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinRemoveRulesTest.xml
index 4041e2bd31e..62fc85cb745 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinRemoveRulesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinRemoveRulesTest.xml
@@ -93,29 +93,6 @@ LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
       <![CDATA[
 LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $8)])
 +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProjectJoinRemove10">
-    <Resource name="sql">
-      <![CDATA[
-SELECT e.deptno, e.slacker
-FROM emp e
-LEFT JOIN dept d ON e.deptno = d.deptno
-       ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(deptno=[$7], slacker=[$8])
-+- LogicalJoin(condition=[=($7, $9)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, emp]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, dept]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(deptno=[$7], slacker=[$8])
-+- LogicalTableScan(table=[[default_catalog, default_database, emp]])
 ]]>
     </Resource>
   </TestCase>
@@ -353,6 +330,29 @@ LogicalProject(deptno=[$7], deptno0=[$9])
 +- LogicalJoin(condition=[=($7, $9)], joinType=[left])
    :- LogicalTableScan(table=[[default_catalog, default_database, emp]])
    +- LogicalTableScan(table=[[default_catalog, default_database, dept]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProjectJoinRemove10">
+    <Resource name="sql">
+      <![CDATA[
+SELECT e.deptno, e.slacker
+FROM emp e
+LEFT JOIN dept d ON e.deptno = d.deptno
+       ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(deptno=[$7], slacker=[$8])
++- LogicalJoin(condition=[=($7, $9)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, emp]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, dept]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(deptno=[$7], slacker=[$8])
++- LogicalTableScan(table=[[default_catalog, default_database, emp]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinToMultiJoinForReorderRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinToMultiJoinForReorderRuleTest.xml
index 2cb129a3775..cdb77143051 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinToMultiJoinForReorderRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinToMultiJoinForReorderRuleTest.xml
@@ -199,39 +199,6 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
       :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
       :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
       +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRightOuterJoinAntiJoin">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c) t
-WHERE NOT EXISTS (SELECT e FROM T3  WHERE a = e)
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-+- LogicalFilter(condition=[NOT(EXISTS({
-LogicalFilter(condition=[=($cor0.a, $0)])
-  LogicalTableScan(table=[[default_catalog, default_database, T3]])
-}))], variablesSet=[[$cor0]])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-      +- LogicalJoin(condition=[=($0, $2)], joinType=[right])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-+- LogicalJoin(condition=[=($0, $4)], joinType=[anti])
-   :- MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $2), NULL]], projFields=[[{0, 1}, {0, 1}]])
-   :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   +- LogicalProject(e=[$0])
-      +- LogicalFilter(condition=[true])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
@@ -261,7 +228,7 @@ MultiJoin(joinFilter=[=($0, $2)], isFullOuterJoin=[false], joinTypes=[[INNER, IN
   <TestCase name="testInnerJoinLeftOuterJoinInnerJoinLeftOuterJoin">
     <Resource name="sql">
       <![CDATA[
-SELECT * FROM T1 JOIN T2 ON a = c LEFT OUTER JOIN 
+SELECT * FROM T1 JOIN T2 ON a = c LEFT OUTER JOIN
  T3 ON a = e JOIN
  T4 ON a = g LEFT OUTER JOIN
  T5 ON a = i
@@ -319,7 +286,7 @@ MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]]
   <TestCase name="testInnerJoinRightOuterJoinInnerJoinRightOuterJoin">
     <Resource name="sql">
       <![CDATA[
-SELECT * FROM T1 JOIN T2 ON a = c RIGHT OUTER JOIN 
+SELECT * FROM T1 JOIN T2 ON a = c RIGHT OUTER JOIN
  T3 ON a = e JOIN
  T4 ON a = g RIGHT OUTER JOIN
  T5 ON a = i
@@ -412,13 +379,36 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
    +- LogicalProject(e=[$0])
       +- LogicalFilter(condition=[true])
          +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftOuterJoinInnerJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1 LEFT OUTER JOIN T2 ON a = c JOIN T3 ON a = e]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+   :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+MultiJoin(joinFilter=[=($0, $4)], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT, INNER]], outerJoinConditions=[[NULL, =($0, $2), NULL]], projFields=[[{0, 1}, {0, 1}, {0, 1}]])
+:- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+:- LogicalTableScan(table=[[default_catalog, default_database, T2]])
++- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
   <TestCase name="testLeftOuterJoinInnerJoinLeftOuterJoinInnerJoin">
     <Resource name="sql">
       <![CDATA[
-SELECT * FROM T1 LEFT OUTER JOIN T2 ON a = c JOIN 
+SELECT * FROM T1 LEFT OUTER JOIN T2 ON a = c JOIN
  T3 ON a = e LEFT OUTER JOIN
  T4 ON a = g JOIN
  T5 ON a = i
@@ -527,8 +517,8 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
   <TestCase name="testMultiLeftOuterJoinWithAllKeyInLeft">
     <Resource name="sql">
       <![CDATA[
-SELECT * FROM T1 LEFT OUTER JOIN 
-T2 ON a = c LEFT OUTER JOIN 
+SELECT * FROM T1 LEFT OUTER JOIN
+T2 ON a = c LEFT OUTER JOIN
 T3 ON a = e LEFT OUTER JOIN
 T4 ON a = g LEFT OUTER JOIN
 T5 ON a = i
@@ -559,50 +549,36 @@ MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT, L
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinRightOuterJoin">
+  <TestCase name="testRightOuterJoinAntiJoin">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c RIGHT OUTER JOIN T3 ON a = e]]>
+      <![CDATA[
+SELECT * FROM (SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c) t
+WHERE NOT EXISTS (SELECT e FROM T3  WHERE a = e)
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($0, $4)], joinType=[right])
-   :- LogicalJoin(condition=[=($0, $2)], joinType=[right])
-   :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
++- LogicalFilter(condition=[NOT(EXISTS({
+LogicalFilter(condition=[=($cor0.a, $0)])
+  LogicalTableScan(table=[[default_catalog, default_database, T3]])
+}))], variablesSet=[[$cor0]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
+      +- LogicalJoin(condition=[=($0, $2)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $4), NULL]], projFields=[[{0, 1, 2, 3}, {0, 1}]])
-:- MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $2), NULL]], projFields=[[ALL, ALL]])
-:  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-:  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-+- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftOuterJoinInnerJoin">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 LEFT OUTER JOIN T2 ON a = c JOIN T3 ON a = e]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
++- LogicalJoin(condition=[=($0, $4)], joinType=[anti])
+   :- MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $2), NULL]], projFields=[[{0, 1}, {0, 1}]])
    :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-MultiJoin(joinFilter=[=($0, $4)], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT, INNER]], outerJoinConditions=[[NULL, =($0, $2), NULL]], projFields=[[{0, 1}, {0, 1}, {0, 1}]])
-:- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-:- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-+- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+   +- LogicalProject(e=[$0])
+      +- LogicalFilter(condition=[true])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
@@ -664,6 +640,29 @@ MultiJoin(joinFilter=[=($0, $4)], isFullOuterJoin=[false], joinTypes=[[INNER, IN
 :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightOuterJoinInnerJoinWithKeyInRight">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c JOIN T3 ON c = e]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalJoin(condition=[=($2, $4)], joinType=[inner])
+   :- LogicalJoin(condition=[=($0, $2)], joinType=[right])
+   :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+MultiJoin(joinFilter=[=($2, $4)], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER, INNER]], outerJoinConditions=[[=($0, $2), NULL, NULL]], projFields=[[{0, 1}, {0, 1}, {0, 1}]])
+:- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+:- LogicalTableScan(table=[[default_catalog, default_database, T2]])
++- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
@@ -691,14 +690,14 @@ MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT]],
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinInnerJoinWithKeyInRight">
+  <TestCase name="testRightOuterJoinLeftOuterJoinWithKeyInRight">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c JOIN T3 ON c = e]]>
+      <![CDATA[SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c LEFT OUTER JOIN T3 ON c = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($2, $4)], joinType=[inner])
++- LogicalJoin(condition=[=($2, $4)], joinType=[left])
    :- LogicalJoin(condition=[=($0, $2)], joinType=[right])
    :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
@@ -707,21 +706,21 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-MultiJoin(joinFilter=[=($2, $4)], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER, INNER]], outerJoinConditions=[[=($0, $2), NULL, NULL]], projFields=[[{0, 1}, {0, 1}, {0, 1}]])
+MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER, LEFT]], outerJoinConditions=[[=($0, $2), NULL, =($2, $4)]], projFields=[[{0, 1}, {0, 1}, {0, 1}]])
 :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 :- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRightOuterJoinLeftOuterJoinWithKeyInRight">
+  <TestCase name="testRightOuterJoinRightOuterJoin">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c LEFT OUTER JOIN T3 ON c = e]]>
+      <![CDATA[SELECT * FROM T1 RIGHT OUTER JOIN T2 ON a = c RIGHT OUTER JOIN T3 ON a = e]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($2, $4)], joinType=[left])
++- LogicalJoin(condition=[=($0, $4)], joinType=[right])
    :- LogicalJoin(condition=[=($0, $2)], joinType=[right])
    :  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
@@ -730,9 +729,10 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER, LEFT]], outerJoinConditions=[[=($0, $2), NULL, =($2, $4)]], projFields=[[{0, 1}, {0, 1}, {0, 1}]])
-:- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-:- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $4), NULL]], projFields=[[{0, 1, 2, 3}, {0, 1}]])
+:- MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $2), NULL]], projFields=[[ALL, ALL]])
+:  :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+:  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalCorrelateToJoinFromTemporalTableRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalCorrelateToJoinFromTemporalTableRuleTest.xml
index f55e06f7e17..54eb961f0c6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalCorrelateToJoinFromTemporalTableRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalCorrelateToJoinFromTemporalTableRuleTest.xml
@@ -70,61 +70,61 @@ LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcTimeTemporalJoinWithFilter">
+  <TestCase name="testLookupJoinWithFilter">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 JOIN T3 FOR SYSTEM_TIME AS OF T1.proctime AS dimTable ON T1.id = dimTable.id AND dimTable.rate > 10]]>
+      <![CDATA[SELECT * FROM T1 JOIN T2 FOR SYSTEM_TIME AS OF T1.proctime AS dimTable ON T1.id = dimTable.id AND dimTable.rate > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5], rowtime0=[$6])
+LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 2}])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
    :  +- LogicalProject(id=[$0], mount=[$1], proctime=[PROCTIME()], rowtime=[$2])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [CollectionTableSource(id, mount, rowtime)]]])
    +- LogicalFilter(condition=[AND(=($cor0.id, $0), >($1, 10))])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [CollectionTableSource(id, rate)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5], rowtime0=[$6])
-+- LogicalJoin(condition=[AND(=($0, $4), >($5, 10), __INITIAL_TEMPORAL_JOIN_CONDITION($2, __TEMPORAL_JOIN_LEFT_KEY($0), __TEMPORAL_JOIN_RIGHT_KEY($4)))], joinType=[inner])
+LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5])
++- LogicalJoin(condition=[AND(=($0, $4), >($5, 10))], joinType=[inner])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
    :  +- LogicalProject(id=[$0], mount=[$1], proctime=[PROCTIME()], rowtime=[$2])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [CollectionTableSource(id, mount, rowtime)]]])
    +- LogicalSnapshot(period=[$cor0.proctime])
-      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [CollectionTableSource(id, rate)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLookupJoinWithFilter">
+  <TestCase name="testProcTimeTemporalJoinWithFilter">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T1 JOIN T2 FOR SYSTEM_TIME AS OF T1.proctime AS dimTable ON T1.id = dimTable.id AND dimTable.rate > 10]]>
+      <![CDATA[SELECT * FROM T1 JOIN T3 FOR SYSTEM_TIME AS OF T1.proctime AS dimTable ON T1.id = dimTable.id AND dimTable.rate > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5])
+LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5], rowtime0=[$6])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 2}])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
    :  +- LogicalProject(id=[$0], mount=[$1], proctime=[PROCTIME()], rowtime=[$2])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [CollectionTableSource(id, mount, rowtime)]]])
    +- LogicalFilter(condition=[AND(=($cor0.id, $0), >($1, 10))])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [CollectionTableSource(id, rate)]]])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5])
-+- LogicalJoin(condition=[AND(=($0, $4), >($5, 10))], joinType=[inner])
+LogicalProject(id=[$0], mount=[$1], proctime=[$2], rowtime=[$3], id0=[$4], rate=[$5], rowtime0=[$6])
++- LogicalJoin(condition=[AND(=($0, $4), >($5, 10), __INITIAL_TEMPORAL_JOIN_CONDITION($2, __TEMPORAL_JOIN_LEFT_KEY($0), __TEMPORAL_JOIN_RIGHT_KEY($4)))], joinType=[inner])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
    :  +- LogicalProject(id=[$0], mount=[$1], proctime=[PROCTIME()], rowtime=[$2])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [CollectionTableSource(id, mount, rowtime)]]])
    +- LogicalSnapshot(period=[$cor0.proctime])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [CollectionTableSource(id, rate)]]])
+      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalUnnestRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalUnnestRuleTest.xml
index 5bafc282773..6c744e43ca0 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalUnnestRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/LogicalUnnestRuleTest.xml
@@ -41,66 +41,6 @@ LogicalProject(a=[$0], s=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumbleWindowAggregateWithCollectUnnest">
-    <Resource name="sql">
-      <![CDATA[
-WITH T AS (SELECT b, COLLECT(b) as `set`
-    FROM MyTable
-    GROUP BY b, TUMBLE(rowtime, INTERVAL '3' SECOND)
-)
-SELECT b, s FROM T, UNNEST(T.`set`) AS A(s) where b < 3
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$0], s=[$2])
-+- LogicalFilter(condition=[<($0, 3)])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-      :- LogicalProject(b=[$0], set=[$2])
-      :  +- LogicalAggregate(group=[{0, 1}], set=[COLLECT($0)])
-      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($3, 3000:INTERVAL SECOND)])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(s=[$0])
-         +- Uncollect
-            +- LogicalProject(set=[$cor0.set])
-               +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(b=[$0], s=[$2])
-+- LogicalFilter(condition=[<($0, 3)])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-      :- LogicalProject(b=[$0], set=[$2])
-      :  +- LogicalAggregate(group=[{0, 1}], set=[COLLECT($0)])
-      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($3, 3000:INTERVAL SECOND)])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(s=[$0])
-         +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.set)], rowType=[RecordType:peek_no_expand(BIGINT f0)])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUnnestWithValues">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM UNNEST(ARRAY[1,2,3])]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[$0])
-+- Uncollect
-   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
-      +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(EXPR$0=[$0])
-+- Uncollect
-   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
-      +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-  </TestCase>
   <TestCase name="testCrossWithUnnestForMap">
     <Resource name="sql">
       <![CDATA[SELECT a, b, v FROM MyTable CROSS JOIN UNNEST(c) as f(k, v)]]>
@@ -193,6 +133,45 @@ LogicalProject(a=[$0], s=[$2])
       :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalProject(s=[$0])
          +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.set)], rowType=[RecordType:peek_no_expand(VARCHAR(2147483647) f0)])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumbleWindowAggregateWithCollectUnnest">
+    <Resource name="sql">
+      <![CDATA[
+WITH T AS (SELECT b, COLLECT(b) as `set`
+    FROM MyTable
+    GROUP BY b, TUMBLE(rowtime, INTERVAL '3' SECOND)
+)
+SELECT b, s FROM T, UNNEST(T.`set`) AS A(s) where b < 3
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$0], s=[$2])
++- LogicalFilter(condition=[<($0, 3)])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+      :- LogicalProject(b=[$0], set=[$2])
+      :  +- LogicalAggregate(group=[{0, 1}], set=[COLLECT($0)])
+      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($3, 3000:INTERVAL SECOND)])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(s=[$0])
+         +- Uncollect
+            +- LogicalProject(set=[$cor0.set])
+               +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(b=[$0], s=[$2])
++- LogicalFilter(condition=[<($0, 3)])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+      :- LogicalProject(b=[$0], set=[$2])
+      :  +- LogicalAggregate(group=[{0, 1}], set=[COLLECT($0)])
+      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($3, 3000:INTERVAL SECOND)])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(s=[$0])
+         +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.set)], rowType=[RecordType:peek_no_expand(BIGINT f0)])
 ]]>
     </Resource>
   </TestCase>
@@ -252,31 +231,6 @@ LogicalProject(b=[$0], id=[$2], point=[$3])
       :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalProject(id=[$0], point=[$1])
          +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.set)], rowType=[RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUnnestPrimitiveArrayFromTable">
-    <Resource name="sql">
-      <![CDATA[SELECT a, b, s FROM MyTable, UNNEST(MyTable.b) AS A (s)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], s=[$3])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalProject(s=[$0])
-      +- Uncollect
-         +- LogicalProject(b=[$cor0.b])
-            +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], s=[$3])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalProject(s=[$0])
-      +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.b)], rowType=[RecordType:peek_no_expand(INTEGER f0)])
 ]]>
     </Resource>
   </TestCase>
@@ -329,6 +283,31 @@ LogicalProject(a=[$0], b=[$1], _1=[$2], _2=[$3])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.b)], rowType=[RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnnestPrimitiveArrayFromTable">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b, s FROM MyTable, UNNEST(MyTable.b) AS A (s)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], s=[$3])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(s=[$0])
+      +- Uncollect
+         +- LogicalProject(b=[$cor0.b])
+            +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], s=[$3])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(s=[$0])
+      +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS$1($cor0.b)], rowType=[RecordType:peek_no_expand(INTEGER f0)])
 ]]>
     </Resource>
   </TestCase>
@@ -509,6 +488,42 @@ LogicalProject(a=[$0], b=[$1], _1=[$2], _2=[$3], ORDINALITY=[$4])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], rowType=[RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2, INTEGER ORDINALITY)])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnnestWithOrdinalityInSubquery">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+  SELECT a, number, ordinality
+  FROM MyTable
+  CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
+) subquery
+WHERE ordinality = 1
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], number=[$1], ordinality=[$2])
++- LogicalFilter(condition=[=($2, 1)])
+   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
+      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalProject(number=[$0], ordinality=[$1])
+            +- Uncollect(withOrdinality=[true])
+               +- LogicalProject(b=[$cor0.b])
+                  +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], number=[$1], ordinality=[$2])
++- LogicalFilter(condition=[=($2, 1)])
+   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
+      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalProject(number=[$0], ordinality=[$1])
+            +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], rowType=[RecordType:peek_no_expand(INTEGER EXPR$0, INTEGER ORDINALITY)])
 ]]>
     </Resource>
   </TestCase>
@@ -573,8 +588,8 @@ LogicalProject(a=[$0], word=[$2], pos=[$3])
   <TestCase name="testUnnestWithOrdinalityWithFilter">
     <Resource name="sql">
       <![CDATA[
-SELECT a, number, ordinality 
-FROM MyTable 
+SELECT a, number, ordinality
+FROM MyTable
 CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
 WHERE number > 10 AND ordinality < 3
 ]]>
@@ -602,39 +617,24 @@ LogicalProject(a=[$0], number=[$2], ordinality=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnnestWithOrdinalityInSubquery">
+  <TestCase name="testUnnestWithValues">
     <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
-  SELECT a, number, ordinality 
-  FROM MyTable 
-  CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
-) subquery 
-WHERE ordinality = 1
-]]>
+      <![CDATA[SELECT * FROM UNNEST(ARRAY[1,2,3])]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], number=[$1], ordinality=[$2])
-+- LogicalFilter(condition=[=($2, 1)])
-   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         +- LogicalProject(number=[$0], ordinality=[$1])
-            +- Uncollect(withOrdinality=[true])
-               +- LogicalProject(b=[$cor0.b])
-                  +- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(EXPR$0=[$0])
++- Uncollect
+   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
+      +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], number=[$1], ordinality=[$2])
-+- LogicalFilter(condition=[=($2, 1)])
-   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         +- LogicalProject(number=[$0], ordinality=[$1])
-            +- LogicalTableFunctionScan(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], rowType=[RecordType:peek_no_expand(INTEGER EXPR$0, INTEGER ORDINALITY)])
+LogicalProject(EXPR$0=[$0])
++- Uncollect
+   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
+      +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectSnapshotTransposeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectSnapshotTransposeRuleTest.xml
index 58d680fb561..030c173e105 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectSnapshotTransposeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectSnapshotTransposeRuleTest.xml
@@ -41,37 +41,6 @@ FlinkLogicalJoin(condition=[=($0, $5)], joinType=[inner])
 :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 +- FlinkLogicalSnapshot(period=[$cor0.proctime])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LookupTable]], fields=[id, name, age])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinTemporalTableWithReorderedProject[mode = stream]">
-    <Resource name="sql">
-      <![CDATA[SELECT T.*, D.age, D.name, D.id
-FROM MyTable AS T
-JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D
-ON T.a = D.id]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], age=[$7], name=[$6], id=[$5])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}])
-   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
-   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[TO_TIMESTAMP(FROM_UNIXTIME($2))])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalFilter(condition=[=($cor0.a, $0)])
-      +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a, b, c, proctime, rowtime, age, name, id])
-+- FlinkLogicalJoin(condition=[=($0, $5)], joinType=[inner])
-   :- FlinkLogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
-   :  +- FlinkLogicalCalc(select=[a, b, c, PROCTIME() AS proctime, TO_TIMESTAMP(FROM_UNIXTIME(c)) AS rowtime])
-   :     +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-   +- FlinkLogicalSnapshot(period=[$cor0.proctime])
-      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LookupTable]], fields=[id, name, age])
 ]]>
     </Resource>
   </TestCase>
@@ -251,6 +220,37 @@ FlinkLogicalCalc(select=[a, b, c, proctime, rowtime, age, name, id])
    :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
    +- FlinkLogicalSnapshot(period=[$cor0.proctime])
       +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LookupTable]], fields=[id, name, age])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinTemporalTableWithReorderedProject[mode = stream]">
+    <Resource name="sql">
+      <![CDATA[SELECT T.*, D.age, D.name, D.id
+FROM MyTable AS T
+JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D
+ON T.a = D.id]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], age=[$7], name=[$6], id=[$5])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}])
+   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
+   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[TO_TIMESTAMP(FROM_UNIXTIME($2))])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalFilter(condition=[=($cor0.a, $0)])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a, b, c, proctime, rowtime, age, name, id])
++- FlinkLogicalJoin(condition=[=($0, $5)], joinType=[inner])
+   :- FlinkLogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
+   :  +- FlinkLogicalCalc(select=[a, b, c, PROCTIME() AS proctime, TO_TIMESTAMP(FROM_UNIXTIME(c)) AS rowtime])
+   :     +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- FlinkLogicalSnapshot(period=[$cor0.proctime])
+      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LookupTable]], fields=[id, name, age])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectWatermarkAssignerTransposeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectWatermarkAssignerTransposeRuleTest.xml
index a584fbbe866..3dbd7420209 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectWatermarkAssignerTransposeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/ProjectWatermarkAssignerTransposeRuleTest.xml
@@ -163,26 +163,6 @@ LogicalProject(a=[$0], EXPR$1=[EXTRACT(FLAG(SECOND), $1)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="transposeWithWatermarkWithMultipleInput">
-    <Resource name="sql">
-      <![CDATA[SELECT a FROM UdfTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalWatermarkAssigner(rowtime=[b], watermark=[myFunc($1, $2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalWatermarkAssigner(rowtime=[b], watermark=[myFunc($1, $2)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
-]]>
-		</Resource>
-	</TestCase>
   <TestCase name="transposeWithIncludeComputedRowTime">
     <Resource name="sql">
       <![CDATA[SELECT a, b, d FROM VirtualTable]]>
@@ -201,6 +181,26 @@ LogicalWatermarkAssigner(rowtime=[d], watermark=[-($2, 5000:INTERVAL SECOND)])
 +- LogicalProject(a=[$0], b=[$1], d=[$3])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2.c1, 5000:INTERVAL SECOND)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="transposeWithNestedField">
+    <Resource name="sql">
+      <![CDATA[SELECT b, d.d1, d.d2 FROM SimpleTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$1], d1=[$3.d1], d2=[$3.d2])
++- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, SimpleTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(b=[$0], d1=[$1.d1], d2=[$1.d2])
++- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
+   +- LogicalProject(b=[$1], d=[$3], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, SimpleTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -224,23 +224,23 @@ LogicalProject(b=[$0], a=[$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="transposeWithNestedField">
+  <TestCase name="transposeWithWatermarkWithMultipleInput">
     <Resource name="sql">
-      <![CDATA[SELECT b, d.d1, d.d2 FROM SimpleTable]]>
+      <![CDATA[SELECT a FROM UdfTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$1], d1=[$3.d1], d2=[$3.d2])
-+- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, SimpleTable]])
+LogicalProject(a=[$0])
++- LogicalWatermarkAssigner(rowtime=[b], watermark=[myFunc($1, $2)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(b=[$0], d1=[$1.d1], d2=[$1.d2])
-+- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
-   +- LogicalProject(b=[$1], d=[$3], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, SimpleTable]])
+LogicalProject(a=[$0])
++- LogicalWatermarkAssigner(rowtime=[b], watermark=[myFunc($1, $2)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterInCalcIntoTableSourceRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterInCalcIntoTableSourceRuleTest.xml
index ceae952923d..0e22f4d6cae 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterInCalcIntoTableSourceRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterInCalcIntoTableSourceRuleTest.xml
@@ -16,166 +16,166 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCannotPushDown">
+  <TestCase name="testCanPushDown">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE price > 10]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, 10)])
++- LogicalFilter(condition=[>($2, 2)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, price], where=[>(price, 10)])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
+FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDown3">
+  <TestCase name="testCanPushDownWithCastConstant">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR amount < 10]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > cast(1.1 as int)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
++- LogicalFilter(condition=[>($2, CAST(1.1:DECIMAL(2, 1)):INTEGER NOT NULL)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, price], where=[IS NOT NULL(amount)])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
+FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 1)]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDown3WithVirtualColumn">
+  <TestCase name="testCanPushDownWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 OR amount < 10]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
++- LogicalFilter(condition=[>($2, 2)])
    +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price], where=[IS NOT NULL(amount)])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]], fields=[name, id, amount, price])
+FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[>(amount, 2)]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownIn">
+  <TestCase name="testCannotPushDown">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE name IN ('Alice', 'Bob', 'Dave')]]>
+      <![CDATA[SELECT * FROM MyTable WHERE price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(=($0, _UTF-16LE'Alice'), =($0, _UTF-16LE'Bob'), =($0, _UTF-16LE'Dave'))])
++- LogicalFilter(condition=[>($3, 10)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, price], where=[SEARCH(name, Sarg[_UTF-16LE'Alice', _UTF-16LE'Bob', _UTF-16LE'Dave'])])
+FlinkLogicalCalc(select=[name, id, amount, price], where=[>(price, 10)])
 +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownWithCastConstant">
+  <TestCase name="testCannotPushDown3">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE price > cast(10.1 as int)]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR amount < 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, CAST(10.1:DECIMAL(3, 1)):INTEGER NOT NULL)])
++- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, price], where=[>(price, 10)])
+FlinkLogicalCalc(select=[name, id, amount, price], where=[IS NOT NULL(amount)])
 +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownWithVirtualColumn">
+  <TestCase name="testCannotPushDown3WithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE price > 10]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 OR amount < 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[>($4, 10)])
++- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
    +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price], where=[>(price, 10)])
+FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price], where=[IS NOT NULL(amount)])
 +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDown">
+  <TestCase name="testCannotPushDownIn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2]]>
+      <![CDATA[SELECT * FROM MyTable WHERE name IN ('Alice', 'Bob', 'Dave')]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($2, 2)])
++- LogicalFilter(condition=[OR(=($0, _UTF-16LE'Alice'), =($0, _UTF-16LE'Bob'), =($0, _UTF-16LE'Dave'))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]], fields=[name, id, amount, price])
+FlinkLogicalCalc(select=[name, id, amount, price], where=[SEARCH(name, Sarg[_UTF-16LE'Alice', _UTF-16LE'Bob', _UTF-16LE'Dave'])])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDownWithCastConstant">
+  <TestCase name="testCannotPushDownWithCastConstant">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > cast(1.1 as int)]]>
+      <![CDATA[SELECT * FROM MyTable WHERE price > cast(10.1 as int)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($2, CAST(1.1:DECIMAL(2, 1)):INTEGER NOT NULL)])
++- LogicalFilter(condition=[>($3, CAST(10.1:DECIMAL(3, 1)):INTEGER NOT NULL)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 1)]]], fields=[name, id, amount, price])
+FlinkLogicalCalc(select=[name, id, amount, price], where=[>(price, 10)])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDownWithVirtualColumn">
+  <TestCase name="testCannotPushDownWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[>($2, 2)])
++- LogicalFilter(condition=[>($4, 10)])
    +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[>(amount, 2)]]], fields=[name, id, amount, price])
+FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price], where=[>(price, 10)])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
@@ -270,59 +270,40 @@ FlinkLogicalCalc(select=[name, id, amount, price], where=[>(price, 10)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithInterval">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MTable
-WHERE TIMESTAMPADD(HOUR, 5, a) >= b
-OR
-TIMESTAMPADD(YEAR, 2, b) >= a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalFilter(condition=[OR(>=(+($0, *(3600000:INTERVAL HOUR, 5)), $1), >=(+($1, *(12:INTERVAL YEAR, 2)), $0))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a, b], where=[OR(>=(+(a, *(3600000:INTERVAL DAY TO SECOND, 5)), b), >=(+(b, *(12:INTERVAL YEAR TO MONTH, 2)), a))])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MTable, filter=[]]], fields=[a, b])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithTimestampWithTimeZone">
+  <TestCase name="testPartialPushDown2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MTable WHERE a > '2024-05-13 08:00:00']]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalFilter(condition=[>($0, CAST(_UTF-16LE'2024-05-13 08:00:00'):TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) NOT NULL)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
+LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
++- LogicalFilter(condition=[OR(>($2, 2), >($3, 10))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MTable, filter=[>(a, 2024-05-13 00:00:00:TIMESTAMP_WITH_LOCAL_TIME_ZONE(3))]]], fields=[a, b])
+FlinkLogicalCalc(select=[name, id, amount, price], where=[OR(>(amount, 2), >(price, 10))])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPushDown2">
+  <TestCase name="testPartialPushDown2WithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR price > 10]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 OR price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(>($2, 2), >($3, 10))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
++- LogicalFilter(condition=[OR(>($2, 2), >($4, 10))])
+   +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, price], where=[OR(>(amount, 2), >(price, 10))])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[]]], fields=[name, id, amount, price])
+FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price], where=[OR(>(amount, 2), >(price, 10))])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
@@ -364,40 +345,24 @@ FlinkLogicalCalc(select=[name, id, amount, price], where=[AND(<(id, 100), >(CAST
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPushDown2WithVirtualColumn">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 OR price > 10]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[OR(>($2, 2), >($4, 10))])
-   +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, +(amount, 1) AS virtualField, price], where=[OR(>(amount, 2), >(price, 10))])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]], fields=[name, id, amount, price])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithUdf">
+  <TestCase name="testWithInterval">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 AND myUdf(amount) < 32]]>
+      <![CDATA[SELECT * FROM MTable
+WHERE TIMESTAMPADD(HOUR, 5, a) >= b
+OR
+TIMESTAMPADD(YEAR, 2, b) >= a]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[AND(>($2, 2), <(myUdf($2), 32))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1])
++- LogicalFilter(condition=[OR(>=(+($0, *(3600000:INTERVAL HOUR, 5)), $1), >=(+($1, *(12:INTERVAL YEAR, 2)), $0))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[name, id, amount, price], where=[<(myUdf(amount), 32)])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]], fields=[name, id, amount, price])
+FlinkLogicalCalc(select=[a, b], where=[OR(>=(+(a, *(3600000:INTERVAL DAY TO SECOND, 5)), b), >=(+(b, *(12:INTERVAL YEAR TO MONTH, 2)), a))])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MTable, filter=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -423,6 +388,41 @@ LogicalProject(a=[$0])
       <![CDATA[
 FlinkLogicalCalc(select=[CASE(>(amount, 0), name, null:VARCHAR(2147483647)) AS a], where=[IS NOT NULL(CASE(>(amount, 0), name, null:VARCHAR(2147483647)))])
 +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[name, id, amount, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithTimestampWithTimeZone">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MTable WHERE a > '2024-05-13 08:00:00']]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1])
++- LogicalFilter(condition=[>($0, CAST(_UTF-16LE'2024-05-13 08:00:00'):TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) NOT NULL)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MTable, filter=[>(a, 2024-05-13 00:00:00:TIMESTAMP_WITH_LOCAL_TIME_ZONE(3))]]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithUdf">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 AND myUdf(amount) < 32]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
++- LogicalFilter(condition=[AND(>($2, 2), <(myUdf($2), 32))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[name, id, amount, price], where=[<(myUdf(amount), 32)])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]], fields=[name, id, amount, price])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterIntoTableSourceScanRuleTest.xml
index 8a27b0a7d68..a3aaacbd1e1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushFilterIntoTableSourceScanRuleTest.xml
@@ -16,52 +16,68 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCannotPushDown">
+  <TestCase name="testBasicNestedFilter">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE price > 10]]>
+      <![CDATA[SELECT * FROM NestedTable WHERE deepNested.nested1.`value` > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], deepNested=[$1], nested=[$2], deepNestedWith.=[$3], name=[$4], testMap=[$5])
++- LogicalFilter(condition=[>($1.nested1.value, 2)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], deepNested=[$1], nested=[$2], deepNestedWith.=[$3], name=[$4], testMap=[$5])
++- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, filter=[>(deepNested.nested1.value, 2)]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCanPushDown">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, 10)])
++- LogicalFilter(condition=[>($2, 2)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, 10)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDown3">
+  <TestCase name="testCanPushDownWithCastConstant">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR amount < 10]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > cast(1.1 as int)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
++- LogicalFilter(condition=[>($2, CAST(1.1:DECIMAL(2, 1)):INTEGER NOT NULL)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[IS NOT NULL($2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 1)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDown3WithVirtualColumn">
+  <TestCase name="testCanPushDownWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 OR amount < 10]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
++- LogicalFilter(condition=[>($2, 2)])
    +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -70,57 +86,56 @@ LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
 +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
-   +- LogicalFilter(condition=[IS NOT NULL($2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[>(amount, 2)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownIn">
+  <TestCase name="testCannotPushDown">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE name IN ('Alice', 'Bob', 'Dave')]]>
+      <![CDATA[SELECT * FROM MyTable WHERE price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(=($0, _UTF-16LE'Alice'), =($0, _UTF-16LE'Bob'), =($0, _UTF-16LE'Dave'))])
++- LogicalFilter(condition=[>($3, 10)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[SEARCH($0, Sarg[_UTF-16LE'Alice':VARCHAR(5) CHARACTER SET "UTF-16LE", _UTF-16LE'Bob':VARCHAR(5) CHARACTER SET "UTF-16LE", _UTF-16LE'Dave':VARCHAR(5) CHARACTER SET "UTF-16LE"]:VARCHAR(5) CHARACTER SET "UTF-16LE")])
++- LogicalFilter(condition=[>($3, 10)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownWithCastConstant">
+  <TestCase name="testCannotPushDown3">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE price > cast(10.1 as int)]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR amount < 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, CAST(10.1:DECIMAL(3, 1)):INTEGER NOT NULL)])
++- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, 10)])
++- LogicalFilter(condition=[IS NOT NULL($2)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownWithVirtualColumn">
+  <TestCase name="testCannotPushDown3WithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE price > 10]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 OR amount < 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[>($4, 10)])
++- LogicalFilter(condition=[OR(>($2, 2), <($2, 10))])
    +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -129,55 +144,57 @@ LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
 +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
-   +- LogicalFilter(condition=[>($3, 10)])
+   +- LogicalFilter(condition=[IS NOT NULL($2)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDown">
+  <TestCase name="testCannotPushDownIn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2]]>
+      <![CDATA[SELECT * FROM MyTable WHERE name IN ('Alice', 'Bob', 'Dave')]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($2, 2)])
++- LogicalFilter(condition=[OR(=($0, _UTF-16LE'Alice'), =($0, _UTF-16LE'Bob'), =($0, _UTF-16LE'Dave'))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
++- LogicalFilter(condition=[SEARCH($0, Sarg[_UTF-16LE'Alice':VARCHAR(5) CHARACTER SET "UTF-16LE", _UTF-16LE'Bob':VARCHAR(5) CHARACTER SET "UTF-16LE", _UTF-16LE'Dave':VARCHAR(5) CHARACTER SET "UTF-16LE"]:VARCHAR(5) CHARACTER SET "UTF-16LE")])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDownWithCastConstant">
+  <TestCase name="testCannotPushDownWithCastConstant">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > cast(1.1 as int)]]>
+      <![CDATA[SELECT * FROM MyTable WHERE price > cast(10.1 as int)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($2, CAST(1.1:DECIMAL(2, 1)):INTEGER NOT NULL)])
++- LogicalFilter(condition=[>($3, CAST(10.1:DECIMAL(3, 1)):INTEGER NOT NULL)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 1)]]])
++- LogicalFilter(condition=[>($3, 10)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDownWithVirtualColumn">
+  <TestCase name="testCannotPushDownWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[>($2, 2)])
++- LogicalFilter(condition=[>($4, 10)])
    +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -186,7 +203,8 @@ LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
 +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[>(amount, 2)]]])
+   +- LogicalFilter(condition=[>($3, 10)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
@@ -246,122 +264,115 @@ LogicalProject(a=[$0], b=[$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPushDown">
+  <TestCase name="testNestedFilterOnArrayField">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 AND price > 10]]>
+      <![CDATA[SELECT * FROM NestedItemTable WHERE `Result`.`Mid`.data_arr[2].`value` = 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[AND(>($2, 2), >($3, 10))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
++- LogicalFilter(condition=[=(ITEM($2.Mid.data_arr, 2).value, 3)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[>($3, 10)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
+LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
++- LogicalFilter(condition=[=(ITEM($2.Mid.data_arr, 2).value, 3)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithInterval">
+  <TestCase name="testNestedFilterOnMapKey">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MTable
-WHERE TIMESTAMPADD(HOUR, 5, a) >= b
-OR
-TIMESTAMPADD(YEAR, 2, b) >= a]]>
+      <![CDATA[SELECT * FROM NestedItemTable WHERE `Result`.`Mid`.data_map['item'].`value` = 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalFilter(condition=[OR(>=(+($0, *(3600000:INTERVAL HOUR, 5)), $1), >=(+($1, *(12:INTERVAL YEAR, 2)), $0))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
+LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
++- LogicalFilter(condition=[=(ITEM($2.Mid.data_map, _UTF-16LE'item').value, 3)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalFilter(condition=[OR(>=(+($0, *(3600000:INTERVAL DAY TO SECOND, 5)), $1), >=(+($1, *(12:INTERVAL YEAR TO MONTH, 2)), $0))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MTable, filter=[]]])
+LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
++- LogicalFilter(condition=[=(ITEM($2.Mid.data_map, _UTF-16LE'item').value, 3)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithTimestampWithTimeZone">
+  <TestCase name="testNestedFilterWithBacktickInTheName">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MTable WHERE a > '2024-05-13 08:00:00']]>
+      <![CDATA[SELECT id FROM NestedTable WHERE `deepNestedWith.`.nested.```name` = 'foo']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalFilter(condition=[>($0, CAST(_UTF-16LE'2024-05-13 08:00:00'):TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) NOT NULL)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
+LogicalProject(id=[$0])
++- LogicalFilter(condition=[=($3.nested.`name, _UTF-16LE'foo')])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, MTable, filter=[>(a, 2024-05-13 00:00:00:TIMESTAMP_WITH_LOCAL_TIME_ZONE(3))]]])
+LogicalProject(id=[$0])
++- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, filter=[=(deepNestedWith..nested.`name, _UTF-16LE'foo':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPushDown2">
+  <TestCase name="testNestedFilterWithDotInTheName">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR price > 10]]>
+      <![CDATA[SELECT id FROM NestedTable WHERE `deepNestedWith.`.nested.`.value` > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(>($2, 2), >($3, 10))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(id=[$0])
++- LogicalFilter(condition=[>($3.nested..value, 5)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[OR(>($2, 2), >($3, 10))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
+LogicalProject(id=[$0])
++- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, filter=[>(deepNestedWith..nested..value, 5)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPushDownWithVirtualColumn">
+  <TestCase name="testPartialPushDown">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 AND price > 10]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 AND price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalFilter(condition=[AND(>($2, 2), >($4, 10))])
-   +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
++- LogicalFilter(condition=[AND(>($2, 2), >($3, 10))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
-+- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
-   +- LogicalFilter(condition=[>($3, 10)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[>(amount, 2)]]])
+LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
++- LogicalFilter(condition=[>($3, 10)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnconvertedExpression">
+  <TestCase name="testPartialPushDown2">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE
-    amount > 2 AND id < 100 AND CAST(amount AS BIGINT) > 10]]>
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 OR price > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[AND(>($2, 2), <($1, 100), >(CAST($2):BIGINT, 10))])
++- LogicalFilter(condition=[OR(>($2, 2), >($3, 10))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[AND(<($1, 100), >(CAST($2):BIGINT, 10))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
++- LogicalFilter(condition=[OR(>($2, 2), >($3, 10))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
@@ -386,22 +397,66 @@ LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdf">
+  <TestCase name="testPartialPushDownWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 AND myUdf(amount) < 32]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE amount > 2 AND price > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
++- LogicalFilter(condition=[AND(>($2, 2), >($4, 10))])
+   +- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[$3], price=[$4])
++- LogicalProject(name=[$0], id=[$1], amount=[$2], virtualField=[+($2, 1)], price=[$3])
+   +- LogicalFilter(condition=[>($3, 10)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, filter=[>(amount, 2)]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnconvertedExpression">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable WHERE
+    amount > 2 AND id < 100 AND CAST(amount AS BIGINT) > 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[AND(>($2, 2), <(myUdf($2), 32))])
++- LogicalFilter(condition=[AND(>($2, 2), <($1, 100), >(CAST($2):BIGINT, 10))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
-+- LogicalFilter(condition=[<(myUdf($2), 32)])
++- LogicalFilter(condition=[AND(<($1, 100), >(CAST($2):BIGINT, 10))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithInterval">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MTable
+WHERE TIMESTAMPADD(HOUR, 5, a) >= b
+OR
+TIMESTAMPADD(YEAR, 2, b) >= a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1])
++- LogicalFilter(condition=[OR(>=(+($0, *(3600000:INTERVAL HOUR, 5)), $1), >=(+($1, *(12:INTERVAL YEAR, 2)), $0))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1])
++- LogicalFilter(condition=[OR(>=(+($0, *(3600000:INTERVAL DAY TO SECOND, 5)), $1), >=(+($1, *(12:INTERVAL YEAR TO MONTH, 2)), $0))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MTable, filter=[]]])
 ]]>
     </Resource>
   </TestCase>
@@ -432,96 +487,41 @@ LogicalProject(a=[$0])
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testBasicNestedFilter">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM NestedTable WHERE deepNested.nested1.`value` > 2]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0], deepNested=[$1], nested=[$2], deepNestedWith.=[$3], name=[$4], testMap=[$5])
-+- LogicalFilter(condition=[>($1.nested1.value, 2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(id=[$0], deepNested=[$1], nested=[$2], deepNestedWith.=[$3], name=[$4], testMap=[$5])
-+- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, filter=[>(deepNested.nested1.value, 2)]]])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testNestedFilterWithDotInTheName">
-		<Resource name="sql">
-			<![CDATA[SELECT id FROM NestedTable WHERE `deepNestedWith.`.nested.`.value` > 5]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0])
-+- LogicalFilter(condition=[>($3.nested..value, 5)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(id=[$0])
-+- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, filter=[>(deepNestedWith..nested..value, 5)]]])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testNestedFilterWithBacktickInTheName">
-		<Resource name="sql">
-			<![CDATA[SELECT id FROM NestedTable WHERE `deepNestedWith.`.nested.```name` = 'foo']]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(id=[$0])
-+- LogicalFilter(condition=[=($3.nested.`name, _UTF-16LE'foo')])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(id=[$0])
-+- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, filter=[=(deepNestedWith..nested.`name, _UTF-16LE'foo':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testNestedFilterOnMapKey">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM NestedItemTable WHERE `Result`.`Mid`.data_map['item'].`value` = 3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
-+- LogicalFilter(condition=[=(ITEM($2.Mid.data_map, _UTF-16LE'item').value, 3)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
+  <TestCase name="testWithTimestampWithTimeZone">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MTable WHERE a > '2024-05-13 08:00:00']]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1])
++- LogicalFilter(condition=[>($0, CAST(_UTF-16LE'2024-05-13 08:00:00'):TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) NOT NULL)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
-+- LogicalFilter(condition=[=(ITEM($2.Mid.data_map, _UTF-16LE'item').value, 3)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1])
++- LogicalTableScan(table=[[default_catalog, default_database, MTable, filter=[>(a, 2024-05-13 00:00:00:TIMESTAMP_WITH_LOCAL_TIME_ZONE(3))]]])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testNestedFilterOnArrayField">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM NestedItemTable WHERE `Result`.`Mid`.data_arr[2].`value` = 3]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
-+- LogicalFilter(condition=[=(ITEM($2.Mid.data_arr, 2).value, 3)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithUdf">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM MyTable WHERE amount > 2 AND myUdf(amount) < 32]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
++- LogicalFilter(condition=[AND(>($2, 2), <(myUdf($2), 32))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(ID=[$0], Timestamp=[$1], Result=[$2])
-+- LogicalFilter(condition=[=(ITEM($2.Mid.data_arr, 2).value, 3)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NestedItemTable]])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(name=[$0], id=[$1], amount=[$2], price=[$3])
++- LogicalFilter(condition=[<(myUdf($2), 32)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, filter=[>(amount, 2)]]])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushLimitIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushLimitIntoTableSourceScanRuleTest.xml
index c4c343f28fe..5a866e91ff0 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushLimitIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushLimitIntoTableSourceScanRuleTest.xml
@@ -16,13 +16,13 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCannotPushDownWithOrderBy">
+  <TestCase name="testCanPushdownFetchWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable ORDER BY c LIMIT 10]]>
+      <![CDATA[SELECT a, c FROM LimitTable OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
+LogicalSort(offset=[10], fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -30,18 +30,18 @@ LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(sort0=[$2], dir0=[ASC-nulls-first], fetch=[10])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable]], fields=[a, b, c])
++- FlinkLogicalSort(offset=[10], fetch=[10])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[20]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownWithoutFetch">
+  <TestCase name="testCanPushdownFetchWithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable OFFSET 10 ROWS]]>
+      <![CDATA[SELECT a, c FROM LimitTable FETCH FIRST 10 ROWS ONLY]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[10])
+LogicalSort(fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -49,18 +49,18 @@ LogicalSort(offset=[10])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(offset=[10])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable]], fields=[a, b, c])
++- FlinkLogicalSort(fetch=[10])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[10]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCannotPushDownWithoutLimit">
+  <TestCase name="testCanPushdownLimitWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable OFFSET 10]]>
+      <![CDATA[SELECT a, c FROM LimitTable LIMIT 10 OFFSET 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[10])
+LogicalSort(offset=[1], fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -68,18 +68,18 @@ LogicalSort(offset=[10])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(offset=[10])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable]], fields=[a, b, c])
++- FlinkLogicalSort(offset=[1], fetch=[10])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[11]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushdownFetchWithoutOffset">
+  <TestCase name="testCanPushdownLimitWithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable FETCH FIRST 10 ROWS ONLY]]>
+      <![CDATA[SELECT a, c FROM LimitTable LIMIT 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(fetch=[10])
+LogicalSort(fetch=[5])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -87,18 +87,18 @@ LogicalSort(fetch=[10])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(fetch=[10])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[10]]], fields=[a, b, c])
++- FlinkLogicalSort(fetch=[5])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[5]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushdownFetchWithOffset">
+  <TestCase name="testCannotPushDownWithOrderBy">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY]]>
+      <![CDATA[SELECT a, c FROM LimitTable ORDER BY c LIMIT 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[10], fetch=[10])
+LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -106,18 +106,18 @@ LogicalSort(offset=[10], fetch=[10])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(offset=[10], fetch=[10])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[20]]], fields=[a, b, c])
++- FlinkLogicalSort(sort0=[$2], dir0=[ASC-nulls-first], fetch=[10])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushdownLimitWithoutOffset">
+  <TestCase name="testCannotPushDownWithoutFetch">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable LIMIT 5]]>
+      <![CDATA[SELECT a, c FROM LimitTable OFFSET 10 ROWS]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(fetch=[5])
+LogicalSort(offset=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -125,18 +125,18 @@ LogicalSort(fetch=[5])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(fetch=[5])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[5]]], fields=[a, b, c])
++- FlinkLogicalSort(offset=[10])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushdownLimitWithOffset">
+  <TestCase name="testCannotPushDownWithoutLimit">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM LimitTable LIMIT 10 OFFSET 1]]>
+      <![CDATA[SELECT a, c FROM LimitTable OFFSET 10]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[1], fetch=[10])
+LogicalSort(offset=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, LimitTable]])
 ]]>
@@ -144,8 +144,8 @@ LogicalSort(offset=[1], fetch=[10])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
-+- FlinkLogicalSort(offset=[1], fetch=[10])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable, limit=[11]]], fields=[a, b, c])
++- FlinkLogicalSort(offset=[10])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, LimitTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoLegacyTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoLegacyTableSourceScanRuleTest.xml
index b07e6aef4cf..fe61433e6cb 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoLegacyTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoLegacyTableSourceScanRuleTest.xml
@@ -16,6 +16,69 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
+  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[>($0, 2)])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[>($0, 2)])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[>($0, 2)])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testNoPartitionFieldPredicate[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM MyTable WHERE id > 2]]>
@@ -73,14 +136,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($0, 2)])
++- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -89,19 +152,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($0, 2)])
++- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -110,19 +172,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($0, 2)])
++- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -131,8 +192,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -190,14 +250,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
++- LogicalFilter(condition=[>($3, 1)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -206,18 +266,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
++- LogicalFilter(condition=[>($3, 1)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -226,37 +286,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDown[sourceFetchPartitions=true, useCatalogFilter=false]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
++- LogicalFilter(condition=[>($3, 1)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -265,7 +306,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -323,14 +364,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($3, 1)])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -339,18 +380,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($3, 1)])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -359,18 +400,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($3, 1)])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -379,7 +420,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -437,14 +478,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -453,18 +494,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -473,18 +514,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -493,7 +534,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -551,14 +592,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -567,18 +608,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -587,18 +629,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -607,7 +650,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -649,14 +693,33 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDown[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 +- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -665,19 +728,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -686,19 +749,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -707,8 +770,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -769,14 +832,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -785,19 +848,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -806,19 +869,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -827,8 +890,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -889,14 +952,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -905,19 +968,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -926,8 +989,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -949,27 +1012,6 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
    +- LogicalFilter(condition=[>($0, 2)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=C, part2=1}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -1027,48 +1069,6 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 +- LogicalFilter(condition=[>($0, 2)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [partitions={part1=A, part2=1}, {part1=C, part2=1}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=C, part2=1}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [partitions={part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoTableSourceScanRuleTest.xml
index 54ceeb5b363..aca8dae21b9 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoTableSourceScanRuleTest.xml
@@ -16,26 +16,70 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testNoPartitionFieldPredicate[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[>($0, 2)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[>($0, 2)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicate[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[>($0, 2)])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNoPartitionFieldPredicate[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM MyTable WHERE id > 2]]>
     </Resource>
@@ -54,21 +98,22 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testNoPartitionFieldPredicate[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[select * from MyTable where trim(part1) = 'A' and part2 > 1]]>
+      <![CDATA[SELECT * FROM MyTable WHERE id > 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalFilter(condition=[>($0, 2)])
+   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, partitions=[{part1=A, part2=2}]]])
++- LogicalFilter(condition=[>($0, 2)])
+   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -91,14 +136,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($0, 2)])
++- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -107,19 +152,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($0, 2)])
++- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -128,19 +172,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoPartitionFieldPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($0, 2)])
++- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -149,8 +192,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -208,14 +250,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
++- LogicalFilter(condition=[>($3, 1)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -224,18 +266,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
++- LogicalFilter(condition=[>($3, 1)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -244,7 +286,27 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[>($3, 1)])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -302,14 +364,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($3, 1)])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -318,18 +380,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($3, 1)])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -338,18 +400,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate2WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[>($3, 1)])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -358,7 +420,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -416,14 +478,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -432,18 +494,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -452,18 +514,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate3WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -472,7 +534,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -530,14 +592,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -546,18 +608,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -566,18 +629,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate4WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A' OR part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(=($2, _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -586,7 +650,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -647,34 +712,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyPartitionFieldPredicate1WithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE part1 = 'A']]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'A')])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -683,19 +728,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -704,19 +749,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialPartitionFieldPredicatePushDownWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE (id > 2 OR part1 = 'A') AND part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(OR(>($0, 2), =($2, _UTF-16LE'A')), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -725,8 +770,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=2}, {part1=B, part2=3}]]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -787,14 +832,14 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -803,19 +848,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
@@ -824,19 +869,19 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateAndOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -845,8 +890,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=A, part2=2}]]])
+   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -907,49 +952,43 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
+      <![CDATA[select * from MyTable where trim(part1) = 'A' and part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
++- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
+   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
++- LogicalTableScan(table=[[test_catalog, test_database, MyTable, partitions=[{part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
+      <![CDATA[select * from MyTable where trim(part1) = 'A' and part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
++- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
+   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
++- LogicalTableScan(table=[[test_catalog, test_database, MyTable, partitions=[{part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
       <![CDATA[select * from MyTable where trim(part1) = 'A' and part2 > 1]]>
     </Resource>
@@ -957,35 +996,38 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 +- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
-   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalTableScan(table=[[test_catalog, test_database, MyTable, partitions=[{part1=A, part2=2}]]])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable, partitions=[{part1=A, part2=2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from MyTable where trim(part1) = 'A' and part2 > 1]]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
-   +- LogicalTableScan(table=[[test_catalog, test_database, MyTable]])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
+   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
-+- LogicalTableScan(table=[[test_catalog, test_database, MyTable, partitions=[{part1=A, part2=2}]]])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
++- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
@@ -994,7 +1036,7 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1002,18 +1044,18 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
    +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
+      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartitionFieldPredicateOrOtherPredicateWithVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 OR part1 = 'A']]>
+      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
++- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
@@ -1022,8 +1064,8 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[OR(>($0, 2), =($2, _UTF-16LE'A'))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+   +- LogicalFilter(condition=[>($0, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -1081,48 +1123,6 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3])
 +- LogicalFilter(condition=[>($0, 2)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM VirtualTable WHERE id > 2 AND MyUdf(part2) < 3]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
-   +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-   +- LogicalFilter(condition=[>($0, 2)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, VirtualTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}]]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml
index 8f25a6622b3..87fd6e17821 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml
@@ -144,6 +144,48 @@ LogicalProject(EXPR$0=[1])
 LogicalProject(EXPR$0=[1])
 +- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, T3, metadata=[m1, m2, m3]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestProjectWithMetadata">
+    <Resource name="sql">
+      <![CDATA[SELECT id,    deepNested.nested1 AS nested1,
+    deepNested.nested1.`value` + deepNested.nested2.num + metadata_1 as results
+FROM MetadataTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, metadata=[metadata_1, metadata_2]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testNestProjectWithUpsertSource">
+    <Resource name="sql">
+      <![CDATA[SELECT id,    deepNested.nested1 AS nested1,
+    deepNested.nested1.`value` + deepNested.nested2.num + metadata_1 as results
+FROM MetadataTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, metadata=[metadata_1, metadata_2]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
   </TestCase>
@@ -186,23 +228,6 @@ LogicalProject(EXPR$0=[ITEM($0, $2).value], EXPR$1=[ITEM($1, _UTF-16LE'item').va
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testNestedProjectFieldAccessWithNestedArrayAndRows">
-		<Resource name="sql">
-			<![CDATA[SELECT `chart`.`result`[1].`meta`.`symbol` FROM ItemTable]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[CAST(CAST(ITEM($5.result, 1).meta):RecordType:peek_no_expand(VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL symbol).symbol):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, ItemTable]])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(EXPR$0=[CAST(CAST(ITEM($0.result, 1).meta):RecordType:peek_no_expand(VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL symbol).symbol):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, ItemTable, project=[chart], metadata=[]]])
-]]>
-		</Resource>
-	</TestCase>
   <TestCase name="testNestedProjectFieldAccessWithITEMContainsTopLevelAccess">
     <Resource name="sql">
       <![CDATA[SELECT `Result`.`Mid`.data_arr[2].`value`, `Result`.`Mid`.data_arr[ID].`value`, `Result`.`Mid`.data_map['item'].`value`, `Result`.`Mid` FROM NestedItemTable]]>
@@ -237,45 +262,20 @@ LogicalProject(EXPR$0=[ITEM($0, 2).value], data_arr=[$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNestProjectWithMetadata">
+  <TestCase name="testNestedProjectFieldAccessWithNestedArrayAndRows">
     <Resource name="sql">
-      <![CDATA[SELECT id,    deepNested.nested1 AS nested1,
-    deepNested.nested1.`value` + deepNested.nested2.num + metadata_1 as results
-FROM MetadataTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, metadata=[metadata_1, metadata_2]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testNestProjectWithUpsertSource">
-    <Resource name="sql">
-      <![CDATA[SELECT id,    deepNested.nested1 AS nested1,
-    deepNested.nested1.`value` + deepNested.nested2.num + metadata_1 as results
-FROM MetadataTable]]>
+      <![CDATA[SELECT `chart`.`result`[1].`meta`.`symbol` FROM ItemTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, metadata=[metadata_1, metadata_2]]])
+LogicalProject(EXPR$0=[CAST(CAST(ITEM($5.result, 1).meta):RecordType:peek_no_expand(VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL symbol).symbol):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
++- LogicalTableScan(table=[[default_catalog, default_database, ItemTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
+LogicalProject(EXPR$0=[CAST(CAST(ITEM($0.result, 1).meta):RecordType:peek_no_expand(VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL symbol).symbol):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
++- LogicalTableScan(table=[[default_catalog, default_database, ItemTable, project=[chart], metadata=[]]])
 ]]>
     </Resource>
   </TestCase>
@@ -296,75 +296,76 @@ LogicalProject(EXPR$0=[ITEM($0.data_arr, $1).value], EXPR$1=[ITEM($0.data_map, _
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectionWithMetadataAndPhysicalFields">
+  <TestCase name="testProjectWithDuplicateMetadataKey">
     <Resource name="sql">
-      <![CDATA[SELECT metadata, f1 FROM T5]]>
+      <![CDATA[SELECT id, metadata_3, metadata_1 FROM MetadataTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(metadata=[$1], f1=[$0])
-+- LogicalProject(f1=[$0], metadata=[$1], m3=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T5, metadata=[m2, m3]]])
+LogicalProject(id=[$0], metadata_3=[$4], metadata_1=[$2])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(metadata=[$1], f1=[$0])
-+- LogicalTableScan(table=[[default_catalog, default_database, T5, project=[f1], metadata=[m2]]])
+LogicalProject(id=[$0], metadata_3=[$4], metadata_1=[$2])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectionIncludingOnlyMetadata">
+  <TestCase name="testProjectWithMapType">
     <Resource name="sql">
-      <![CDATA[SELECT metadata FROM T5]]>
+      <![CDATA[SELECT id, testMap['e']
+FROM NestedTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(metadata=[$1])
-+- LogicalProject(f1=[$0], metadata=[$1], m3=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T5, metadata=[m2, m3]]])
+LogicalProject(id=[$0], EXPR$1=[ITEM($5, _UTF-16LE'e')])
++- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalTableScan(table=[[default_catalog, default_database, T5, project=[], metadata=[m2]]])
+LogicalProject(id=[$0], EXPR$1=[ITEM($1, _UTF-16LE'e')])
++- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, project=[id, testMap], metadata=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithMapType">
+  <TestCase name="testProjectWithUdf">
     <Resource name="sql">
-      <![CDATA[SELECT id, testMap['e']
-FROM NestedTable]]>
+      <![CDATA[SELECT a, TRIM(c) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], EXPR$1=[ITEM($5, _UTF-16LE'e')])
-+- LogicalTableScan(table=[[default_catalog, default_database, NestedTable]])
+LogicalProject(a=[$0], EXPR$1=[TRIM(FLAG(BOTH), _UTF-16LE' ', $2)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], EXPR$1=[ITEM($1, _UTF-16LE'e')])
-+- LogicalTableScan(table=[[default_catalog, default_database, NestedTable, project=[id, testMap], metadata=[]]])
+LogicalProject(a=[$0], EXPR$1=[TRIM(FLAG(BOTH), _UTF-16LE' ', $1)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithDuplicateMetadataKey">
+  <TestCase name="testProjectWithUdfWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT id, metadata_3, metadata_1 FROM MetadataTable]]>
+      <![CDATA[SELECT a, my_udf(d) FROM VirtualTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], metadata_3=[$4], metadata_1=[$2])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, metadata=[metadata_1, metadata_2]]])
+LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], metadata_3=[$4], metadata_1=[$2])
-+- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
+LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -385,74 +386,73 @@ LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithUdf">
+  <TestCase name="testProjectionIncludingOnlyMetadata">
     <Resource name="sql">
-      <![CDATA[SELECT a, TRIM(c) FROM MyTable]]>
+      <![CDATA[SELECT metadata FROM T5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[TRIM(FLAG(BOTH), _UTF-16LE' ', $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(metadata=[$1])
++- LogicalProject(f1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T5, metadata=[m2, m3]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[TRIM(FLAG(BOTH), _UTF-16LE' ', $1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]])
+LogicalTableScan(table=[[default_catalog, default_database, T5, project=[], metadata=[m2]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectWithUdfWithVirtualColumn">
+  <TestCase name="testProjectionWithMetadataAndPhysicalFields">
     <Resource name="sql">
-      <![CDATA[SELECT a, my_udf(d) FROM VirtualTable]]>
+      <![CDATA[SELECT metadata, f1 FROM T5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(metadata=[$1], f1=[$0])
++- LogicalProject(f1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T5, metadata=[m2, m3]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(metadata=[$1], f1=[$0])
++- LogicalTableScan(table=[[default_catalog, default_database, T5, project=[f1], metadata=[m2]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleProjectWithVirtualColumn">
+  <TestCase name="testSimpleProject">
     <Resource name="sql">
-      <![CDATA[SELECT a, d FROM VirtualTable]]>
+      <![CDATA[SELECT a, c FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], d=[$3])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(a=[$0], c=[$2])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], d=[$3])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalTableScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleProject">
+  <TestCase name="testSimpleProjectWithVirtualColumn">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable]]>
+      <![CDATA[SELECT a, d FROM VirtualTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], d=[$3])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalTableScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]])
+LogicalProject(a=[$0], d=[$3])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushWatermarkIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushWatermarkIntoTableSourceScanRuleTest.xml
index 9d65bfeb1e5..5ba770793ae 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushWatermarkIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushWatermarkIntoTableSourceScanRuleTest.xml
@@ -16,43 +16,43 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testWatermarkAlignmentWithHint">
+  <TestCase name="testIdleSourceWithHint">
     <Resource name="sql">
-      <![CDATA[select a, c from MyTable /*+ OPTIONS('scan.watermark.alignment.group'='group1', 'scan.watermark.alignment.max-drift'='1min') */]]>
+      <![CDATA[select a, c from MyTable /*+ OPTIONS('scan.watermark.idle-timeout' = '60s')*/]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
 +- LogicalWatermarkAssigner(rowtime=[c], watermark=[-($2, 5000:INTERVAL SECOND)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{scan.watermark.alignment.max-drift=1min, scan.watermark.alignment.group=group1}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{scan.watermark.idle-timeout=60s}]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[a, c])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], watermarkAlignment=[group1, PT1M, PT1S]]], fields=[a, b, c], hints=[[[OPTIONS options:{scan.watermark.alignment.max-drift=1min, scan.watermark.alignment.group=group1}]]])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], idletimeout=[60000], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c], hints=[[[OPTIONS options:{scan.watermark.idle-timeout=60s}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIdleSourceWithHint">
+  <TestCase name="testIdleSourceWithOptions">
     <Resource name="sql">
-      <![CDATA[select a, c from MyTable /*+ OPTIONS('scan.watermark.idle-timeout' = '60s')*/]]>
+      <![CDATA[select a, c from MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
 +- LogicalWatermarkAssigner(rowtime=[c], watermark=[-($2, 5000:INTERVAL SECOND)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{scan.watermark.idle-timeout=60s}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[a, c])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], idletimeout=[60000], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c], hints=[[[OPTIONS options:{scan.watermark.idle-timeout=60s}]]])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], idletimeout=[60000], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIdleSourceWithOptions">
+  <TestCase name="testSimpleWatermark">
     <Resource name="sql">
       <![CDATA[select a, c from MyTable]]>
     </Resource>
@@ -66,25 +66,25 @@ LogicalProject(a=[$0], c=[$2])
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[a, c])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], idletimeout=[60000], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleWatermark">
+  <TestCase name="testWatermarkAlignmentWithHint">
     <Resource name="sql">
-      <![CDATA[select a, c from MyTable]]>
+      <![CDATA[select a, c from MyTable /*+ OPTIONS('scan.watermark.alignment.group'='group1', 'scan.watermark.alignment.max-drift'='1min') */]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], c=[$2])
 +- LogicalWatermarkAssigner(rowtime=[c], watermark=[-($2, 5000:INTERVAL SECOND)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[OPTIONS inheritPath:[] options:{scan.watermark.alignment.max-drift=1min, scan.watermark.alignment.group=group1}]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[a, c])
-+- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
++- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(c, 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic], watermarkAlignment=[group1, PT1M, PT1S]]], fields=[a, b, c], hints=[[[OPTIONS options:{scan.watermark.alignment.max-drift=1min, scan.watermark.alignment.group=group1}]]])
 ]]>
     </Resource>
   </TestCase>
@@ -162,45 +162,45 @@ FlinkLogicalCalc(select=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWatermarkOnComputedColumnWithQuery">
+  <TestCase name="testWatermarkOnComputedColumnWithMultipleInputs">
     <Resource name="sql">
-      <![CDATA[SELECT a, b FROM MyTable WHERE d > TO_TIMESTAMP('2020-10-09 12:12:12')]]>
+      <![CDATA[SELECT * FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalFilter(condition=[>($3, TO_TIMESTAMP(_UTF-16LE'2020-10-09 12:12:12'))])
-   +- LogicalWatermarkAssigner(rowtime=[d], watermark=[-($3, 5000:INTERVAL SECOND)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2, 5000:INTERVAL SECOND)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalWatermarkAssigner(rowtime=[c], watermark=[-($2, 5000:INTERVAL SECOND)])
+   +- LogicalProject(a=[$0], b=[$1], c=[TO_TIMESTAMP($0, $1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a, b])
-+- FlinkLogicalCalc(select=[a, b, c, d], where=[>(d, TO_TIMESTAMP('2020-10-09 12:12:12'))])
-   +- FlinkLogicalCalc(select=[a, b, c, Reinterpret(+(c, 5000:INTERVAL SECOND)) AS d])
-      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(+(c, 5000:INTERVAL SECOND), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
+FlinkLogicalCalc(select=[a, b, c])
++- FlinkLogicalCalc(select=[a, b, Reinterpret(TO_TIMESTAMP(a, b)) AS c])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(TO_TIMESTAMP(a, b), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWatermarkOnComputedColumnWithMultipleInputs">
+  <TestCase name="testWatermarkOnComputedColumnWithQuery">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable]]>
+      <![CDATA[SELECT a, b FROM MyTable WHERE d > TO_TIMESTAMP('2020-10-09 12:12:12')]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalWatermarkAssigner(rowtime=[c], watermark=[-($2, 5000:INTERVAL SECOND)])
-   +- LogicalProject(a=[$0], b=[$1], c=[TO_TIMESTAMP($0, $1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1])
++- LogicalFilter(condition=[>($3, TO_TIMESTAMP(_UTF-16LE'2020-10-09 12:12:12'))])
+   +- LogicalWatermarkAssigner(rowtime=[d], watermark=[-($3, 5000:INTERVAL SECOND)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2, 5000:INTERVAL SECOND)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a, b, c])
-+- FlinkLogicalCalc(select=[a, b, Reinterpret(TO_TIMESTAMP(a, b)) AS c])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(TO_TIMESTAMP(a, b), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b])
+FlinkLogicalCalc(select=[a, b])
++- FlinkLogicalCalc(select=[a, b, c, d], where=[>(d, TO_TIMESTAMP('2020-10-09 12:12:12'))])
+   +- FlinkLogicalCalc(select=[a, b, c, Reinterpret(+(c, 5000:INTERVAL SECOND)) AS d])
+      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[-(+(c, 5000:INTERVAL SECOND), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml
index 086f00174ce..a26065536d2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml
@@ -177,24 +177,6 @@ LogicalProject(a=[$0], b=[$1])
 FlinkLogicalCalc(select=[a, b], where=[f0])
 +- FlinkLogicalCalc(select=[a, b, pyFunc4(a, c) AS f0])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPythonFunctionAsInputOfJavaFunction">
-    <Resource name="sql">
-      <![CDATA[SELECT pyFunc1(a, b) + 1 FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[+(pyFunc1($0, $1), 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[+(f0, 1) AS EXPR$0])
-+- FlinkLogicalCalc(select=[pyFunc1(a, b) AS f0])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
@@ -294,58 +276,58 @@ FlinkLogicalCalc(select=[f0 AS EXPR$0, +(c, 1) AS EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPandasFunctionWithCompositeInputs">
+  <TestCase name="testPandasFunctionNotChainingWithGeneralPythonFunction">
     <Resource name="sql">
-      <![CDATA[SELECT a, pandasFunc1(b, d._1) FROM MyTable]]>
+      <![CDATA[SELECT pyFunc1(a, pandasFunc1(a, b)) + 1 FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[pandasFunc1($1, $3._1)])
+LogicalProject(EXPR$0=[+(pyFunc1($0, pandasFunc1($0, $1)), 1)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a, pandasFunc1(b, f0) AS EXPR$1])
-+- FlinkLogicalCalc(select=[a, b, d._1 AS f0])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+FlinkLogicalCalc(select=[+(f0, 1) AS EXPR$0])
++- FlinkLogicalCalc(select=[pyFunc1(a, f0) AS f0])
+   +- FlinkLogicalCalc(select=[a, pandasFunc1(a, b) AS f0])
+      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPythonFunctionWithCompositeInputs">
+  <TestCase name="testPandasFunctionWithCompositeInputs">
     <Resource name="sql">
-      <![CDATA[SELECT a, pyFunc1(b, d._1) FROM MyTable]]>
+      <![CDATA[SELECT a, pandasFunc1(b, d._1) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[pyFunc1($1, $3._1)])
+LogicalProject(a=[$0], EXPR$1=[pandasFunc1($1, $3._1)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[a, pyFunc1(b, f0) AS EXPR$1])
+FlinkLogicalCalc(select=[a, pandasFunc1(b, f0) AS EXPR$1])
 +- FlinkLogicalCalc(select=[a, b, d._1 AS f0])
    +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPandasFunctionNotChainingWithGeneralPythonFunction">
+  <TestCase name="testPythonFunctionAsInputOfJavaFunction">
     <Resource name="sql">
-      <![CDATA[SELECT pyFunc1(a, pandasFunc1(a, b)) + 1 FROM MyTable]]>
+      <![CDATA[SELECT pyFunc1(a, b) + 1 FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+(pyFunc1($0, pandasFunc1($0, $1)), 1)])
+LogicalProject(EXPR$0=[+(pyFunc1($0, $1), 1)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[+(f0, 1) AS EXPR$0])
-+- FlinkLogicalCalc(select=[pyFunc1(a, f0) AS f0])
-   +- FlinkLogicalCalc(select=[a, pandasFunc1(a, b) AS f0])
-      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
++- FlinkLogicalCalc(select=[pyFunc1(a, b) AS f0])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
@@ -405,6 +387,24 @@ FlinkLogicalCalc(select=[f0 AS EXPR$0, +(c, 1) AS EXPR$1])
    +- FlinkLogicalCalc(select=[c, a, b], where=[>(f0, 0)])
       +- FlinkLogicalCalc(select=[a, b, c, pyFunc2(a, c) AS f0])
          +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPythonFunctionWithCompositeInputs">
+    <Resource name="sql">
+      <![CDATA[SELECT a, pyFunc1(b, d._1) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], EXPR$1=[pyFunc1($1, $3._1)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a, pyFunc1(b, f0) AS EXPR$1])
++- FlinkLogicalCalc(select=[a, b, d._1 AS f0])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
@@ -447,42 +447,42 @@ FlinkLogicalCalc(select=[a, pyFunc1(b, f0) AS EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPythonFunctionWithCompositeWhereClause">
+  <TestCase name="testPythonFunctionWithCompositeOutputs">
     <Resource name="sql">
-      <![CDATA[SELECT a + 1 FROM MyTable where RowJavaFunc(pyFunc5(a).f0).f0 is NULL and b > 0]]>
+      <![CDATA[SELECT e.* FROM (SELECT pyFunc5(a) as e FROM MyTable) AS T]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)])
-+- LogicalFilter(condition=[AND(IS NULL(RowJavaFunc(pyFunc5($0).f0).f0), >($1, 0))])
+LogicalProject(f0=[$0.f0], f1=[$0.f1])
++- LogicalProject(e=[pyFunc5($0)])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[+(a, 1) AS EXPR$0], where=[AND(IS NULL(f0.f0), >(b, 0))])
-+- FlinkLogicalCalc(select=[a, b, RowJavaFunc(f0.f0) AS f0])
-   +- FlinkLogicalCalc(select=[a, b, pyFunc5(a) AS f0])
-      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
++- FlinkLogicalCalc(select=[pyFunc5(a) AS f0])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPythonFunctionWithCompositeOutputs">
+  <TestCase name="testPythonFunctionWithCompositeWhereClause">
     <Resource name="sql">
-      <![CDATA[SELECT e.* FROM (SELECT pyFunc5(a) as e FROM MyTable) AS T]]>
+      <![CDATA[SELECT a + 1 FROM MyTable where RowJavaFunc(pyFunc5(a).f0).f0 is NULL and b > 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[$0.f0], f1=[$0.f1])
-+- LogicalProject(e=[pyFunc5($0)])
+LogicalProject(EXPR$0=[+($0, 1)])
++- LogicalFilter(condition=[AND(IS NULL(RowJavaFunc(pyFunc5($0).f0).f0), >($1, 0))])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
-+- FlinkLogicalCalc(select=[pyFunc5(a) AS f0])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
+FlinkLogicalCalc(select=[+(a, 1) AS EXPR$0], where=[AND(IS NULL(f0.f0), >(b, 0))])
++- FlinkLogicalCalc(select=[a, b, RowJavaFunc(f0.f0) AS f0])
+   +- FlinkLogicalCalc(select=[a, b, pyFunc5(a) AS f0])
+      +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCorrelateSplitRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCorrelateSplitRuleTest.xml
index 4108f090b9a..ddd9e8adcd9 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCorrelateSplitRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCorrelateSplitRuleTest.xml
@@ -35,28 +35,6 @@ FlinkLogicalCalc(select=[a, b, c, EXPR$0])
    :- FlinkLogicalCalc(select=[a, b, c, pyFunc(c) AS f0])
    :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
    +- FlinkLogicalTableFunctionScan(invocation=[javaFunc($3)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPythonTableFunctionWithJavaFunc">
-    <Resource name="sql">
-      <![CDATA[SELECT a, b, c, x, y FROM MyTable, LATERAL TABLE(func(a * a, pyFunc(b, c))) AS T(x, y)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], x=[$3], y=[$4])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1, 2}])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableFunctionScan(invocation=[func(*($cor0.a, $cor0.a), pyFunc($cor0.b, $cor0.c))], rowType=[RecordType(INTEGER x, INTEGER y)])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a, b, c, x, y])
-+- FlinkLogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1, 2}])
-   :- FlinkLogicalCalc(select=[a, b, c, *(a, a) AS f0])
-   :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-   +- FlinkLogicalTableFunctionScan(invocation=[func($3, pyFunc($1, $2))], rowType=[RecordType(INTEGER x, INTEGER y)])
 ]]>
     </Resource>
   </TestCase>
@@ -102,6 +80,28 @@ FlinkLogicalCalc(select=[a, b, c, x, y])
    :- FlinkLogicalCalc(select=[a, b, c, d, *(d._1, a) AS f0, d._2 AS f1])
    :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d])
    +- FlinkLogicalTableFunctionScan(invocation=[func($4, pyFunc($5, $2))], rowType=[RecordType(INTEGER x, INTEGER y)])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPythonTableFunctionWithJavaFunc">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b, c, x, y FROM MyTable, LATERAL TABLE(func(a * a, pyFunc(b, c))) AS T(x, y)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], x=[$3], y=[$4])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1, 2}])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableFunctionScan(invocation=[func(*($cor0.a, $cor0.a), pyFunc($cor0.b, $cor0.c))], rowType=[RecordType(INTEGER x, INTEGER y)])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a, b, c, x, y])
++- FlinkLogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1, 2}])
+   :- FlinkLogicalCalc(select=[a, b, c, *(a, a) AS f0])
+   :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- FlinkLogicalTableFunctionScan(invocation=[func($3, pyFunc($1, $2))], rowType=[RecordType(INTEGER x, INTEGER y)])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonMapMergeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonMapMergeRuleTest.xml
index c0576ef081f..3b2b2f472a6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonMapMergeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonMapMergeRuleTest.xml
@@ -16,35 +16,35 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testMapOperationsChained">
+  <TestCase name="testMapOperationMixedWithPandasUDFAndGeneralUDF">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0')], f1=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')])
+LogicalProject(f0=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPandasScalarFunction$fc2ab005eb7004743f2fd6dcc3fab1ca*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0')], f1=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPandasScalarFunction$fc2ab005eb7004743f2fd6dcc3fab1ca*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')])
 +- LogicalTableScan(table=[[default_catalog, default_database, source]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
-+- FlinkLogicalCalc(select=[*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(a, b, c))) AS f0])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, source]], fields=[a, b, c])
++- FlinkLogicalCalc(select=[*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPandasScalarFunction$fc2ab005eb7004743f2fd6dcc3fab1ca*(f0, f1) AS f0])
+   +- FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
+      +- FlinkLogicalCalc(select=[*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*(a, b, c) AS f0])
+         +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, source]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMapOperationMixedWithPandasUDFAndGeneralUDF">
+  <TestCase name="testMapOperationsChained">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPandasScalarFunction$fc2ab005eb7004743f2fd6dcc3fab1ca*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0')], f1=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPandasScalarFunction$fc2ab005eb7004743f2fd6dcc3fab1ca*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*($0, $1, $2).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')])
+LogicalProject(f0=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0')], f1=[AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f0, _UTF-16LE'f0'), AS(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*($0, $1, $2).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')).f1, _UTF-16LE'f1')])
 +- LogicalTableScan(table=[[default_catalog, default_database, source]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
-+- FlinkLogicalCalc(select=[*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPandasScalarFunction$fc2ab005eb7004743f2fd6dcc3fab1ca*(f0, f1) AS f0])
-   +- FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
-      +- FlinkLogicalCalc(select=[*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$6d0a5b48d8e66954803fdd965425adec*(a, b, c) AS f0])
-         +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, source]], fields=[a, b, c])
++- FlinkLogicalCalc(select=[*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(*org.apache.flink.table.planner.runtime.utils.JavaUserDefinedScalarFunctions$RowPythonScalarFunction$4548a2f7c9e382d11c82a28716e0fd02*(a, b, c))) AS f0])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, source]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml
index e1ed6ffec6d..38eb87d03bd 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml
@@ -47,23 +47,6 @@ LogicalProject(EXPR$0=[COALESCE($1, _UTF-16LE'-')])
       <![CDATA[
 Calc(select=[f1 AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOnlyLastNonNull">
-    <Resource name="sql">
-      <![CDATA[SELECT COALESCE(f0, f1) FROM T]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[COALESCE($0, $1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[COALESCE(f0, f1) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2])
 ]]>
     </Resource>
   </TestCase>
@@ -159,6 +142,23 @@ LogicalProject(EXPR$0=[COALESCE(1)], EXPR$1=[COALESCE(1, 2)], EXPR$2=[COALESCE(n
       <![CDATA[
 Calc(select=[1 AS EXPR$0, 1 AS EXPR$1, 2 AS EXPR$2, 1 AS EXPR$3, 3 AS EXPR$4, 4 AS EXPR$5, '1' AS EXPR$6, '1' AS EXPR$7, '2' AS EXPR$8, '1' AS EXPR$9, '3' AS EXPR$10, '4' AS EXPR$11, 1.0 AS EXPR$12, 1.0 AS EXPR$13, 2E0 AS EXPR$14, 2E0 AS EXPR$15, 2.0 AS EXPR$16, null:DOUBLE AS EXPR$17])
 +- Values(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOnlyLastNonNull">
+    <Resource name="sql">
+      <![CDATA[SELECT COALESCE(f0, f1) FROM T]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[COALESCE($0, $1)])
++- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[COALESCE(f0, f1) AS EXPR$0])
++- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RewriteIntersectAllRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RewriteIntersectAllRuleTest.xml
index 7a3862488a8..b6c521f4d4b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RewriteIntersectAllRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RewriteIntersectAllRuleTest.xml
@@ -77,6 +77,39 @@ LogicalProject(c=[$2])
    :              +- LogicalProject(f=[$2])
    :                 +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
    +- LogicalTableFunctionScan(invocation=[$REPLICATE_ROWS$1($0, $1)], rowType=[RecordType(VARCHAR(2147483647) c)])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testIntersectAllRightIsEmpty">
+    <Resource name="sql">
+      <![CDATA[SELECT c FROM T1 INTERSECT ALL SELECT f FROM T2 WHERE 1=0]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalIntersect(all=[true])
+:- LogicalProject(c=[$2])
+:  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
++- LogicalProject(f=[$2])
+   +- LogicalFilter(condition=[=(1, 0)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(c=[$2])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}])
+   :- LogicalProject($f0=[IF(>($1, $2), $2, $1)], c=[$0])
+   :  +- LogicalFilter(condition=[AND(>=($1, 1), >=($2, 1))])
+   :     +- LogicalAggregate(group=[{0}], vcol_left_cnt=[COUNT($1)], vcol_right_cnt=[COUNT($2)])
+   :        +- LogicalUnion(all=[true])
+   :           :- LogicalProject(c=[$0], vcol_left_marker=[true], vcol_right_marker=[null:BOOLEAN])
+   :           :  +- LogicalProject(c=[$2])
+   :           :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   :           +- LogicalProject(f=[$0], vcol_left_marker=[null:BOOLEAN], vcol_right_marker=[true])
+   :              +- LogicalProject(f=[$2])
+   :                 +- LogicalFilter(condition=[=(1, 0)])
+   :                    +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalTableFunctionScan(invocation=[$REPLICATE_ROWS$1($0, $1)], rowType=[RecordType(VARCHAR(2147483647) c)])
 ]]>
     </Resource>
   </TestCase>
@@ -112,39 +145,6 @@ LogicalProject(c=[$2])
          :              +- LogicalProject(d=[$0], e=[$1], f=[$2])
          :                 +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
          +- LogicalTableFunctionScan(invocation=[$REPLICATE_ROWS$1($0, $1, $2, $3)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c)])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testIntersectAllRightIsEmpty">
-    <Resource name="sql">
-      <![CDATA[SELECT c FROM T1 INTERSECT ALL SELECT f FROM T2 WHERE 1=0]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalIntersect(all=[true])
-:- LogicalProject(c=[$2])
-:  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-+- LogicalProject(f=[$2])
-   +- LogicalFilter(condition=[=(1, 0)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(c=[$2])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}])
-   :- LogicalProject($f0=[IF(>($1, $2), $2, $1)], c=[$0])
-   :  +- LogicalFilter(condition=[AND(>=($1, 1), >=($2, 1))])
-   :     +- LogicalAggregate(group=[{0}], vcol_left_cnt=[COUNT($1)], vcol_right_cnt=[COUNT($2)])
-   :        +- LogicalUnion(all=[true])
-   :           :- LogicalProject(c=[$0], vcol_left_marker=[true], vcol_right_marker=[null:BOOLEAN])
-   :           :  +- LogicalProject(c=[$2])
-   :           :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   :           +- LogicalProject(f=[$0], vcol_left_marker=[null:BOOLEAN], vcol_right_marker=[true])
-   :              +- LogicalProject(f=[$2])
-   :                 +- LogicalFilter(condition=[=(1, 0)])
-   :                    +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-   +- LogicalTableFunctionScan(invocation=[$REPLICATE_ROWS$1($0, $1)], rowType=[RecordType(VARCHAR(2147483647) c)])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SimplifyJoinConditionRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SimplifyJoinConditionRuleTest.xml
index 6dfd8abf107..7a97b2ab032 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SimplifyJoinConditionRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SimplifyJoinConditionRuleTest.xml
@@ -16,6 +16,27 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
+  <TestCase name="testSimplifyJoinCondition">
+    <Resource name="sql">
+      <![CDATA[SELECT d FROM MyTable1 JOIN MyTable2 ON (d = a AND a > 2) OR (d = a AND b = 1)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(d=[$3])
++- LogicalJoin(condition=[OR(AND(=($3, $0), >($0, 2)), AND(=($3, $0), =($1, 1)))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(d=[$3])
++- LogicalJoin(condition=[AND(=($3, $0), OR(>($0, 2), =($1, 1)))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testSimplifyJoinConditionFromSubQuery">
     <Resource name="sql">
       <![CDATA[
@@ -50,14 +71,14 @@ LogicalProject(a=[$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimplifyJoinCondition">
+  <TestCase name="testSimplifyJoinConditionWithCastToFalse">
     <Resource name="sql">
-      <![CDATA[SELECT d FROM MyTable1 JOIN MyTable2 ON (d = a AND a > 2) OR (d = a AND b = 1)]]>
+      <![CDATA[SELECT d FROM MyTable1 JOIN MyTable2 ON CAST(0 AS BOOLEAN)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(d=[$3])
-+- LogicalJoin(condition=[OR(AND(=($3, $0), >($0, 2)), AND(=($3, $0), =($1, 1)))], joinType=[inner])
++- LogicalJoin(condition=[false], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -65,7 +86,7 @@ LogicalProject(d=[$3])
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(d=[$3])
-+- LogicalJoin(condition=[AND(=($3, $0), OR(>($0, 2), =($1, 1)))], joinType=[inner])
++- LogicalJoin(condition=[false], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -89,27 +110,6 @@ LogicalProject(d=[$3])
 +- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSimplifyJoinConditionWithCastToFalse">
-    <Resource name="sql">
-      <![CDATA[SELECT d FROM MyTable1 JOIN MyTable2 ON CAST(0 AS BOOLEAN)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(d=[$3])
-+- LogicalJoin(condition=[false], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-LogicalProject(d=[$3])
-+- LogicalJoin(condition=[false], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml
index 4137bad3f07..c7e598da846 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml
@@ -375,25 +375,6 @@ FlinkLogicalAggregate(group=[{0}], agg#0=[LAST_VALUE($3)], agg#1=[$SUM0($4)])
       +- FlinkLogicalExpand(projects=[{a, b, c, $f3, null AS $f4, 1 AS $e}, {a, b, c, null AS $f3, $f4, 2 AS $e}])
          +- FlinkLogicalCalc(select=[a, b, c, MOD(HASH_CODE(b), 1024) AS $f3, MOD(HASH_CODE(c), 1024) AS $f4])
             +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleMinAgg">
-    <Resource name="sql">
-      <![CDATA[SELECT MIN(c) FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
-+- LogicalProject(c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
-+- FlinkLogicalCalc(select=[c])
-   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -439,6 +420,25 @@ FlinkLogicalAggregate(group=[{0}], agg#0=[$SUM0($3)], agg#1=[MAX($4)])
       +- FlinkLogicalExpand(projects=[{a, b, c, $f3, null AS $f4, 1 AS $e}, {a, b, c, null AS $f3, $f4, 2 AS $e}])
          +- FlinkLogicalCalc(select=[a, b, c, MOD(HASH_CODE(b), 1024) AS $f3, MOD(HASH_CODE(c), 1024) AS $f4])
             +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleMinAgg">
+    <Resource name="sql">
+      <![CDATA[SELECT MIN(c) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
++- LogicalProject(c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
++- FlinkLogicalCalc(select=[c])
+   +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml
index b9363987891..b71a0a85a2f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml
@@ -16,30 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testPythonFunctionInJoinCondition">
-    <Resource name="sql">
-      <![CDATA[SELECT a, b, d FROM leftTable JOIN rightTable ON a=d and pyFunc(a, d)=b ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], d=[$3])
-+- LogicalJoin(condition=[AND(=($0, $3), =(pyFunc($0, $3), $1))], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, leftTable]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, rightTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-FlinkLogicalCalc(select=[a, b, d], where=[=(f0, b)])
-+- FlinkLogicalCalc(select=[a, b, d, pyFunc(a, d) AS f0])
-   +- FlinkLogicalJoin(condition=[=($0, $2)], joinType=[inner])
-      :- FlinkLogicalCalc(select=[a, b])
-      :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, leftTable]], fields=[a, b, c])
-      +- FlinkLogicalCalc(select=[d])
-         +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, rightTable]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testPythonFunctionInAboveFilter">
     <Resource name="sql">
       <![CDATA[
@@ -71,6 +47,30 @@ FlinkLogicalCalc(select=[a, +(d, 1) AS EXPR$1], where=[AND(=(f0, +(a, d)), =(f1,
       :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, leftTable]], fields=[a, b, c])
       +- FlinkLogicalCalc(select=[d])
          +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, rightTable]], fields=[d, e, f])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPythonFunctionInJoinCondition">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b, d FROM leftTable JOIN rightTable ON a=d and pyFunc(a, d)=b ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], d=[$3])
++- LogicalJoin(condition=[AND(=($0, $3), =(pyFunc($0, $3), $1))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, leftTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, rightTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+FlinkLogicalCalc(select=[a, b, d], where=[=(f0, b)])
++- FlinkLogicalCalc(select=[a, b, d, pyFunc(a, d) AS f0])
+   +- FlinkLogicalJoin(condition=[=($0, $2)], joinType=[inner])
+      :- FlinkLogicalCalc(select=[a, b])
+      :  +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, leftTable]], fields=[a, b, c])
+      +- FlinkLogicalCalc(select=[d])
+         +- FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, rightTable]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WindowGroupReorderRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WindowGroupReorderRuleTest.xml
index 03ff0534a50..bcd2d7dd414 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WindowGroupReorderRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WindowGroupReorderRuleTest.xml
@@ -223,51 +223,51 @@ LogicalProject($0=[$4], $1=[$3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSamePartitionKeysWithSameOrderKeysWithEmptyOrder">
+  <TestCase name="testSamePartitionKeysWithSameOrderKeysPrefix">
     <Resource name="sql">
       <![CDATA[
-SELECT
-    SUM(a) OVER (PARTITION BY b ORDER BY a),
-    MIN(a) OVER (PARTITION BY b),
-    MAX(a) OVER (PARTITION BY b ORDER BY a)
+SELECT a,
+    RANK() OVER (PARTITION BY b ORDER BY c, a DESC),
+    RANK() OVER (PARTITION BY b ORDER BY c, b)
 FROM MyTable
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[CASE(>(COUNT($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), 0), $SUM0($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), null:INTEGER)], EXPR$1=[MIN($0) OVER (PARTITION BY $1)], EXPR$2=[MAX($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
+LogicalProject(a=[$0], EXPR$1=[RANK() OVER (PARTITION BY $1 ORDER BY $2 NULLS FIRST, $0 DESC NULLS LAST)], EXPR$2=[RANK() OVER (PARTITION BY $1 ORDER BY $2 NULLS FIRST, $1 NULLS FIRST)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(EXPR$0=[CASE(>($3, 0), $4, null:INTEGER)], EXPR$1=[$2], EXPR$2=[$5])
-+- LogicalWindow(window#0=[window(partition {1} aggs [MIN($0)])], window#1=[window(partition {1} order by [0 ASC-nulls-first] aggs [COUNT($0), $SUM0($0), MAX($0)])])
-   +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], $1=[$3], $2=[$4])
++- LogicalWindow(window#0=[window(partition {1} order by [2 ASC-nulls-first, 0 DESC-nulls-last] aggs [RANK()])], window#1=[window(partition {1} order by [2 ASC-nulls-first, 1 ASC-nulls-first] aggs [RANK()])])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSamePartitionKeysWithSameOrderKeysPrefix">
+  <TestCase name="testSamePartitionKeysWithSameOrderKeysWithEmptyOrder">
     <Resource name="sql">
       <![CDATA[
-SELECT a,
-    RANK() OVER (PARTITION BY b ORDER BY c, a DESC),
-    RANK() OVER (PARTITION BY b ORDER BY c, b)
+SELECT
+    SUM(a) OVER (PARTITION BY b ORDER BY a),
+    MIN(a) OVER (PARTITION BY b),
+    MAX(a) OVER (PARTITION BY b ORDER BY a)
 FROM MyTable
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[RANK() OVER (PARTITION BY $1 ORDER BY $2 NULLS FIRST, $0 DESC NULLS LAST)], EXPR$2=[RANK() OVER (PARTITION BY $1 ORDER BY $2 NULLS FIRST, $1 NULLS FIRST)])
+LogicalProject(EXPR$0=[CASE(>(COUNT($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), 0), $SUM0($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST), null:INTEGER)], EXPR$1=[MIN($0) OVER (PARTITION BY $1)], EXPR$2=[MAX($0) OVER (PARTITION BY $1 ORDER BY $0 NULLS FIRST)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], $1=[$3], $2=[$4])
-+- LogicalWindow(window#0=[window(partition {1} order by [2 ASC-nulls-first, 0 DESC-nulls-last] aggs [RANK()])], window#1=[window(partition {1} order by [2 ASC-nulls-first, 1 ASC-nulls-first] aggs [RANK()])])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[CASE(>($3, 0), $4, null:INTEGER)], EXPR$1=[$2], EXPR$2=[$5])
++- LogicalWindow(window#0=[window(partition {1} aggs [MIN($0)])], window#1=[window(partition {1} order by [0 ASC-nulls-first] aggs [COUNT($0), $SUM0($0), MAX($0)])])
+   +- LogicalProject(a=[$0], b=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WrapJsonAggFunctionArgumentsRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WrapJsonAggFunctionArgumentsRuleTest.xml
index 4f7785fa546..de4f8bb7341 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WrapJsonAggFunctionArgumentsRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/WrapJsonAggFunctionArgumentsRuleTest.xml
@@ -134,46 +134,6 @@ SortAggregate(isMerge=[true], groupBy=[f0], select=[f0, Final_COUNT(count1$0) AS
          +- Calc(select=[f0, f1, f2, JSON_STRING(f0) AS $f3])
             +- Sort(orderBy=[f0 ASC])
                +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJsonArrayAgg[batchMode = false]">
-    <Resource name="sql">
-      <![CDATA[SELECT JSON_ARRAYAGG(f0) FROM T]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[JSON_ARRAYAGG_ABSENT_ON_NULL($0)])
-+- LogicalProject(f0=[$0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-GroupAggregate(select=[JSON_ARRAYAGG_ABSENT_ON_NULL($f1) AS EXPR$0])
-+- Exchange(distribution=[single])
-   +- Calc(select=[f0, JSON_STRING(f0) AS $f1])
-      +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f0], metadata=[]]], fields=[f0])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJsonArrayAgg[batchMode = true]">
-    <Resource name="sql">
-      <![CDATA[SELECT JSON_ARRAYAGG(f0) FROM T]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[JSON_ARRAYAGG_ABSENT_ON_NULL($0)])
-+- LogicalProject(f0=[$0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-SortAggregate(isMerge=[false], select=[JSON_ARRAYAGG_ABSENT_ON_NULL($f1) AS EXPR$0])
-+- Calc(select=[f0, JSON_STRING(f0) AS $f1])
-   +- Exchange(distribution=[single])
-      +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f0], metadata=[]]], fields=[f0])
 ]]>
     </Resource>
   </TestCase>
@@ -298,44 +258,43 @@ SortAggregate(isMerge=[false], select=[COUNT(*) AS EXPR$0, JSON_ARRAYAGG_ABSENT_
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJsonObjectAgg[batchMode = false]">
+  <TestCase name="testJsonArrayAgg[batchMode = false]">
     <Resource name="sql">
-      <![CDATA[SELECT JSON_OBJECTAGG(f1 VALUE f1) FROM T]]>
+      <![CDATA[SELECT JSON_ARRAYAGG(f0) FROM T]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[JSON_OBJECTAGG_NULL_ON_NULL($0, $0)])
-+- LogicalProject(f1=[$1])
+LogicalAggregate(group=[{}], EXPR$0=[JSON_ARRAYAGG_ABSENT_ON_NULL($0)])
++- LogicalProject(f0=[$0])
    +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GroupAggregate(select=[JSON_OBJECTAGG_NULL_ON_NULL($f1, $f1) AS EXPR$0])
+GroupAggregate(select=[JSON_ARRAYAGG_ABSENT_ON_NULL($f1) AS EXPR$0])
 +- Exchange(distribution=[single])
-   +- Calc(select=[f1, JSON_STRING(f1) AS $f1])
-      +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f1], metadata=[]]], fields=[f1])
+   +- Calc(select=[f0, JSON_STRING(f0) AS $f1])
+      +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f0], metadata=[]]], fields=[f0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJsonObjectAgg[batchMode = true]">
+  <TestCase name="testJsonArrayAgg[batchMode = true]">
     <Resource name="sql">
-      <![CDATA[SELECT JSON_OBJECTAGG(f1 VALUE f1) FROM T]]>
+      <![CDATA[SELECT JSON_ARRAYAGG(f0) FROM T]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[JSON_OBJECTAGG_NULL_ON_NULL($0, $0)])
-+- LogicalProject(f1=[$1])
+LogicalAggregate(group=[{}], EXPR$0=[JSON_ARRAYAGG_ABSENT_ON_NULL($0)])
++- LogicalProject(f0=[$0])
    +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-SortAggregate(isMerge=[true], select=[Final_JSON_OBJECTAGG_NULL_ON_NULL(EXPR$0) AS EXPR$0])
-+- Exchange(distribution=[single])
-   +- LocalSortAggregate(select=[Partial_JSON_OBJECTAGG_NULL_ON_NULL($f1, $f1) AS EXPR$0])
-      +- Calc(select=[f1, JSON_STRING(f1) AS $f1])
-         +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f1], metadata=[]]], fields=[f1])
+SortAggregate(isMerge=[false], select=[JSON_ARRAYAGG_ABSENT_ON_NULL($f1) AS EXPR$0])
++- Calc(select=[f0, JSON_STRING(f0) AS $f1])
+   +- Exchange(distribution=[single])
+      +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f0], metadata=[]]], fields=[f0])
 ]]>
     </Resource>
   </TestCase>
@@ -379,6 +338,26 @@ SortAggregate(isMerge=[true], groupBy=[f0], select=[f0, Final_JSON_OBJECTAGG_NUL
          +- Calc(select=[f0, f1, JSON_STRING(f0) AS $f2])
             +- Sort(orderBy=[f0 ASC])
                +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f0, f1], metadata=[]]], fields=[f0, f1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJsonObjectAggWithOtherAggs[batchMode = false]">
+    <Resource name="sql">
+      <![CDATA[SELECT COUNT(*), JSON_OBJECTAGG(f1 VALUE f1) FROM T]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[COUNT()], EXPR$1=[JSON_OBJECTAGG_NULL_ON_NULL($0, $0)])
++- LogicalProject(f1=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+GroupAggregate(select=[COUNT(*) AS EXPR$0, JSON_OBJECTAGG_NULL_ON_NULL($f1, $f1) AS EXPR$1])
++- Exchange(distribution=[single])
+   +- Calc(select=[f1, JSON_STRING(f1) AS $f1])
+      +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f1], metadata=[]]], fields=[f1])
 ]]>
     </Resource>
   </TestCase>
@@ -403,23 +382,44 @@ SortAggregate(isMerge=[true], select=[Final_COUNT(count1$0) AS EXPR$0, Final_JSO
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJsonObjectAggWithOtherAggs[batchMode = false]">
+  <TestCase name="testJsonObjectAgg[batchMode = false]">
     <Resource name="sql">
-      <![CDATA[SELECT COUNT(*), JSON_OBJECTAGG(f1 VALUE f1) FROM T]]>
+      <![CDATA[SELECT JSON_OBJECTAGG(f1 VALUE f1) FROM T]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT()], EXPR$1=[JSON_OBJECTAGG_NULL_ON_NULL($0, $0)])
+LogicalAggregate(group=[{}], EXPR$0=[JSON_OBJECTAGG_NULL_ON_NULL($0, $0)])
 +- LogicalProject(f1=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GroupAggregate(select=[COUNT(*) AS EXPR$0, JSON_OBJECTAGG_NULL_ON_NULL($f1, $f1) AS EXPR$1])
+GroupAggregate(select=[JSON_OBJECTAGG_NULL_ON_NULL($f1, $f1) AS EXPR$0])
 +- Exchange(distribution=[single])
    +- Calc(select=[f1, JSON_STRING(f1) AS $f1])
       +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f1], metadata=[]]], fields=[f1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJsonObjectAgg[batchMode = true]">
+    <Resource name="sql">
+      <![CDATA[SELECT JSON_OBJECTAGG(f1 VALUE f1) FROM T]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[JSON_OBJECTAGG_NULL_ON_NULL($0, $0)])
++- LogicalProject(f1=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+SortAggregate(isMerge=[true], select=[Final_JSON_OBJECTAGG_NULL_ON_NULL(EXPR$0) AS EXPR$0])
++- Exchange(distribution=[single])
+   +- LocalSortAggregate(select=[Partial_JSON_OBJECTAGG_NULL_ON_NULL($f1, $f1) AS EXPR$0])
+      +- Calc(select=[f1, JSON_STRING(f1) AS $f1])
+         +- TableSourceScan(table=[[default_catalog, default_database, T, project=[f1], metadata=[]]], fields=[f1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/subquery/SubqueryCorrelateVariablesValidationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/subquery/SubqueryCorrelateVariablesValidationTest.xml
index d571a4f3a6e..b5494406453 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/subquery/SubqueryCorrelateVariablesValidationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/subquery/SubqueryCorrelateVariablesValidationTest.xml
@@ -16,41 +16,65 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testWithProjectProjectCorrelate">
+  <TestCase name="testWithFilterJoinCorrelate">
     <Resource name="sql">
       <![CDATA[
-SELECT (SELECT min(t1.t1d) FROM t3 WHERE t3.t3a = 'test') min_t1d
+SELECT t1a
 FROM   t1
-WHERE  t1a = 'test'
+WHERE  EXISTS (SELECT max(t2h) FROM t2
+               LEFT OUTER JOIN t1 ttt
+               ON t2.t2a=t1.t1a)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(variablesSet=[[$cor0]], min_t1d=[$SCALAR_QUERY({
+LogicalProject(t1a=[$0])
++- LogicalFilter(condition=[EXISTS({
+LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
+  LogicalProject(t2h=[$7])
+    LogicalJoin(condition=[=($0, $cor0.t1a)], joinType=[left])
+      LogicalTableScan(table=[[default_catalog, default_database, t2]])
+      LogicalTableScan(table=[[default_catalog, default_database, t1]])
+})], variablesSet=[[$cor0]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(t1a=[$0])
++- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithProjectCaseWhenCorrelate">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+    (CASE WHEN EXISTS (SELECT min(t3d)
+                       FROM t3
+                       WHERE t3.t3a = t1.t1a)
+     THEN 1 ELSE 2 END)
+FROM   t1
+    WHERE  t1a = 'test'
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(variablesSet=[[$cor0]], EXPR$0=[CASE(EXISTS({
 LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
-  LogicalProject($f0=[$cor0.t1d])
-    LogicalFilter(condition=[=($0, _UTF-16LE'test')])
+  LogicalProject(t3d=[$3])
+    LogicalFilter(condition=[=($0, $cor0.t1a)])
       LogicalTableScan(table=[[default_catalog, default_database, t3]])
-})])
+}), 1, 2)])
 +- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
    +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(min_t1d=[$10])
-+- LogicalJoin(condition=[=($3, $9)], joinType=[left])
-   :- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-   +- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)])
-      +- LogicalProject(t1d=[$9], $f0=[$9])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
-            :  +- LogicalTableScan(table=[[default_catalog, default_database, t3]])
-            +- LogicalAggregate(group=[{0}])
-               +- LogicalProject(t1d=[$3])
-                  +- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+LogicalProject(EXPR$0=[1])
++- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
   </TestCase>
@@ -99,66 +123,42 @@ LogicalProject(min_t3d=[$9], max_t2h=[$11])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithFilterJoinCorrelate">
-	<Resource name="sql">
-			<![CDATA[
-SELECT t1a
-FROM   t1
-WHERE  EXISTS (SELECT max(t2h) FROM t2
-               LEFT OUTER JOIN t1 ttt
-               ON t2.t2a=t1.t1a)
-      ]]>
-	</Resource>
-	<Resource name="ast">
-			<![CDATA[
-LogicalProject(t1a=[$0])
-+- LogicalFilter(condition=[EXISTS({
-LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
-  LogicalProject(t2h=[$7])
-    LogicalJoin(condition=[=($0, $cor0.t1a)], joinType=[left])
-      LogicalTableScan(table=[[default_catalog, default_database, t2]])
-      LogicalTableScan(table=[[default_catalog, default_database, t1]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-]]>
-	</Resource>
-	<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(t1a=[$0])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1]])
-]]>
-	</Resource>
-  </TestCase>
-	<TestCase name="testWithProjectCaseWhenCorrelate">
-		<Resource name="sql">
-			<![CDATA[
-SELECT
-    (CASE WHEN EXISTS (SELECT min(t3d)
-                       FROM t3
-                       WHERE t3.t3a = t1.t1a)
-     THEN 1 ELSE 2 END)
+  <TestCase name="testWithProjectProjectCorrelate">
+    <Resource name="sql">
+      <![CDATA[
+SELECT (SELECT min(t1.t1d) FROM t3 WHERE t3.t3a = 'test') min_t1d
 FROM   t1
-    WHERE  t1a = 'test'
+WHERE  t1a = 'test'
       ]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(variablesSet=[[$cor0]], EXPR$0=[CASE(EXISTS({
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(variablesSet=[[$cor0]], min_t1d=[$SCALAR_QUERY({
 LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
-  LogicalProject(t3d=[$3])
-    LogicalFilter(condition=[=($0, $cor0.t1a)])
+  LogicalProject($f0=[$cor0.t1d])
+    LogicalFilter(condition=[=($0, _UTF-16LE'test')])
       LogicalTableScan(table=[[default_catalog, default_database, t3]])
-}), 1, 2)])
+})])
 +- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
    +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-LogicalProject(EXPR$0=[1])
-+- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+LogicalProject(min_t1d=[$10])
++- LogicalJoin(condition=[=($3, $9)], joinType=[left])
+   :- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+   +- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)])
+      +- LogicalProject(t1d=[$9], $f0=[$9])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
+            :  +- LogicalTableScan(table=[[default_catalog, default_database, t3]])
+            +- LogicalAggregate(group=[{0}])
+               +- LogicalProject(t1d=[$3])
+                  +- LogicalFilter(condition=[=($0, _UTF-16LE'test')])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/EnforceLocalSortAggRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/EnforceLocalSortAggRuleTest.xml
index 7dabfe77a3c..32374f9de33 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/EnforceLocalSortAggRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/EnforceLocalSortAggRuleTest.xml
@@ -136,30 +136,6 @@ Calc(select=[EXPR$0])
          +- Expand(projects=[{b, c, null AS d, 1 AS $e}, {b, null AS c, d, 2 AS $e}])
             +- Calc(select=[b, c, d])
                +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, d])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRollupWithUnmergeableAggCall">
-    <Resource name="sql">
-      <![CDATA[SELECT weightedAvg(a, 1) FROM t GROUP BY ROLLUP (b, c)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$0=[weightedAvg($2, $3)])
-   +- LogicalProject(b=[$1], c=[$2], a=[$0], $f3=[1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0])
-+- SortAggregate(isMerge=[false], groupBy=[b, c, $e], select=[b, c, $e, weightedAvg(a, $f3) AS EXPR$0])
-   +- Sort(orderBy=[b ASC, c ASC, $e ASC])
-      +- Exchange(distribution=[hash[b, c, $e]])
-         +- Expand(projects=[{b, c, a, $f3, 0 AS $e}, {b, null AS c, a, $f3, 1 AS $e}, {null AS b, null AS c, a, $f3, 3 AS $e}])
-            +- Calc(select=[b, c, a, 1 AS $f3])
-               +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
@@ -236,6 +212,30 @@ Calc(select=[EXPR$0])
                +- Expand(projects=[{b, c, 0 AS $e}, {b, null AS c, 1 AS $e}, {null AS b, null AS c, 3 AS $e}])
                   +- Calc(select=[b, c])
                      +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRollupWithUnmergeableAggCall">
+    <Resource name="sql">
+      <![CDATA[SELECT weightedAvg(a, 1) FROM t GROUP BY ROLLUP (b, c)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2])
++- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$0=[weightedAvg($2, $3)])
+   +- LogicalProject(b=[$1], c=[$2], a=[$0], $f3=[1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0])
++- SortAggregate(isMerge=[false], groupBy=[b, c, $e], select=[b, c, $e, weightedAvg(a, $f3) AS EXPR$0])
+   +- Sort(orderBy=[b ASC, c ASC, $e ASC])
+      +- Exchange(distribution=[hash[b, c, $e]])
+         +- Expand(projects=[{b, c, a, $f3, 0 AS $e}, {b, null AS c, a, $f3, 1 AS $e}, {null AS b, null AS c, a, $f3, 3 AS $e}])
+            +- Calc(select=[b, c, a, 1 AS $f3])
+               +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml
index 0c60d04880e..55fa4f14e80 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml
@@ -16,220 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCannotPushDownLocalAggAfterLimitPushDown">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  sum(amount),
-  name,
-  type
-FROM (
-  SELECT
-    *
-  FROM inventory
-  LIMIT 100
-) t
-  group by name, type]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
-   +- LogicalProject(name=[$1], type=[$4], amount=[$2])
-      +- LogicalSort(fetch=[100])
-         +- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], type=[$4])
-            +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, name, type])
-+- HashAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
-   +- Exchange(distribution=[hash[name, type]])
-      +- LocalHashAggregate(groupBy=[name, type], select=[name, type, Partial_SUM(amount) AS sum$0])
-         +- Calc(select=[name, type, amount])
-            +- Limit(offset=[0], fetch=[100], global=[true])
-               +- Exchange(distribution=[single])
-                  +- Limit(offset=[0], fetch=[100], global=[false])
-                     +- TableSourceScan(table=[[default_catalog, default_database, inventory, limit=[100]]], fields=[id, name, amount, price, type])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCannotPushDownLocalAggWithUDAF">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  udaf_collect(amount),
-  name,
-  type
-FROM inventory
-  group by name, type]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[udaf_collect($2)])
-   +- LogicalProject(name=[$1], type=[$4], amount=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, name, type])
-+- SortAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_udaf_collect(EXPR$0) AS EXPR$0])
-   +- Sort(orderBy=[name ASC, type ASC])
-      +- Exchange(distribution=[hash[name, type]])
-         +- LocalSortAggregate(groupBy=[name, type], select=[name, type, Partial_udaf_collect(amount) AS EXPR$0])
-            +- Sort(orderBy=[name ASC, type ASC])
-               +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, type, amount], metadata=[]]], fields=[name, type, amount])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCannotPushDownLocalAggWithUnsupportedDataTypes">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  max(name),
-  type
-FROM inventory
-  group by type]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], type=[$0])
-+- LogicalAggregate(group=[{0}], EXPR$0=[MAX($1)])
-   +- LogicalProject(type=[$4], name=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, type])
-+- SortAggregate(isMerge=[true], groupBy=[type], select=[type, Final_MAX(max$0) AS EXPR$0])
-   +- Sort(orderBy=[type ASC])
-      +- Exchange(distribution=[hash[type]])
-         +- LocalSortAggregate(groupBy=[type], select=[type, Partial_MAX(name) AS max$0])
-            +- Sort(orderBy=[type ASC])
-               +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[type, name], metadata=[]]], fields=[type, name])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCannotPushDownWithArgFilter">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  min(id),
-  max(amount),
-  sum(price),
-  count(id) FILTER(WHERE id > 100),
-  name
-FROM inventory
-  group by name]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], name=[$0])
-+- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)], EXPR$2=[SUM($3)], EXPR$3=[COUNT($1) FILTER $4])
-   +- LogicalProject(name=[$1], id=[$0], amount=[$2], price=[$3], $f4=[IS TRUE(>($0, 100))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, EXPR$1, EXPR$2, EXPR$3, name])
-+- HashAggregate(isMerge=[true], groupBy=[name], select=[name, Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3])
-   +- Exchange(distribution=[hash[name]])
-      +- LocalHashAggregate(groupBy=[name], select=[name, Partial_MIN(id) AS min$0, Partial_MAX(amount) AS max$1, Partial_SUM(price) AS sum$2, Partial_COUNT(id) FILTER $f4 AS count$3])
-         +- Calc(select=[name, id, amount, price, IS TRUE(>(id, 100)) AS $f4])
-            +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, id, amount, price], metadata=[]]], fields=[name, id, amount, price])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCannotPushDownWithColumnExpression">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  min(amount + price),
-  max(amount),
-  sum(price),
-  count(id),
-  name
-FROM inventory
-  group by name]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], name=[$0])
-+- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)], EXPR$2=[SUM($3)], EXPR$3=[COUNT($4)])
-   +- LogicalProject(name=[$1], $f1=[+($2, $3)], amount=[$2], price=[$3], id=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, EXPR$1, EXPR$2, EXPR$3, name])
-+- HashAggregate(isMerge=[true], groupBy=[name], select=[name, Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3])
-   +- Exchange(distribution=[hash[name]])
-      +- LocalHashAggregate(groupBy=[name], select=[name, Partial_MIN($f1) AS min$0, Partial_MAX(amount) AS max$1, Partial_SUM(price) AS sum$2, Partial_COUNT(id) AS count$3])
-         +- Calc(select=[name, +(amount, price) AS $f1, amount, price, id])
-            +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, amount, price, id], metadata=[]]], fields=[name, amount, price, id])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCannotPushDownWithUnsupportedAggFunction">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  min(id),
-  max(amount),
-  sum(price),
-  count(distinct id),
-  name
-FROM inventory
-  group by name]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], name=[$0])
-+- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)], EXPR$2=[SUM($3)], EXPR$3=[COUNT(DISTINCT $1)])
-   +- LogicalProject(name=[$1], id=[$0], amount=[$2], price=[$3])
-      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, EXPR$1, EXPR$2, EXPR$3, name])
-+- HashAggregate(isMerge=[true], groupBy=[name], select=[name, Final_MIN(min$0) AS EXPR$0, Final_MIN(min$1) AS EXPR$1, Final_MIN(min$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3])
-   +- Exchange(distribution=[hash[name]])
-      +- LocalHashAggregate(groupBy=[name], select=[name, Partial_MIN(EXPR$0) FILTER $g_1 AS min$0, Partial_MIN(EXPR$1) FILTER $g_1 AS min$1, Partial_MIN(EXPR$2) FILTER $g_1 AS min$2, Partial_COUNT(id) FILTER $g_0 AS count$3])
-         +- Calc(select=[name, id, EXPR$0, EXPR$1, EXPR$2, =(CASE(=($e, 0), 0, 1), 0) AS $g_0, =(CASE(=($e, 0), 0, 1), 1) AS $g_1])
-            +- HashAggregate(isMerge=[true], groupBy=[name, id, $e], select=[name, id, $e, Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2])
-               +- Exchange(distribution=[hash[name, id, $e]])
-                  +- LocalHashAggregate(groupBy=[name, id, $e], select=[name, id, $e, Partial_MIN(id_0) AS min$0, Partial_MAX(amount) AS max$1, Partial_SUM(price) AS sum$2])
-                     +- Expand(projects=[{name, id, amount, price, 0 AS $e, id AS id_0}, {name, null AS id, amount, price, 1 AS $e, id AS id_0}])
-                        +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, id, amount, price], metadata=[]]], fields=[name, id, amount, price])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCannotPushDownWithWindowAggFunction">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  id,
-  amount,
-  sum(price) over (partition by name),
-  name
-FROM inventory]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], amount=[$2], EXPR$2=[CASE(>(COUNT($3) OVER (PARTITION BY $1), 0), $SUM0($3) OVER (PARTITION BY $1), null:BIGINT)], name=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[id, amount, CASE(>(w0$o0, 0), w0$o1, null:BIGINT) AS EXPR$2, name])
-+- OverAggregate(partitionBy=[name], window#0=[COUNT(price) AS w0$o0, $SUM0(price) AS w0$o1 RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING], select=[id, name, amount, price, w0$o0, w0$o1])
-   +- Sort(orderBy=[name ASC])
-      +- Exchange(distribution=[hash[name]])
-         +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[id, name, amount, price], metadata=[]]], fields=[id, name, amount, price])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testCanPushDownLocalAggAfterFilterPushDown">
     <Resource name="sql">
       <![CDATA[SELECT
@@ -308,34 +94,6 @@ Calc(select=[EXPR$0, EXPR$1, name, type])
 +- HashAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1])
    +- Exchange(distribution=[hash[name, type]])
       +- TableSourceScan(table=[[default_catalog, default_database, inventory_meta, filter=[=(id, 123:BIGINT)], project=[name, type, amount], metadata=[metadata_1], aggregates=[grouping=[name,type], aggFunctions=[LongSumAggFunction(amount),LongMaxAggFunction(metadata_1)]]]], fields=[name, type, sum$0, max$1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCanPushDownLocalAggWithoutProjectionPushDown">
-    <Resource name="sql">
-      <![CDATA[SELECT
-  sum(amount),
-  name,
-  type
-FROM inventory_no_proj
-  where id = 123
-  group by name, type]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
-   +- LogicalProject(name=[$1], type=[$4], amount=[$2])
-      +- LogicalFilter(condition=[=($0, 123)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, inventory_no_proj]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0, name, type])
-+- HashAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
-   +- Exchange(distribution=[hash[name, type]])
-      +- TableSourceScan(table=[[default_catalog, default_database, inventory_no_proj, filter=[=(id, 123:BIGINT)], aggregates=[grouping=[name,type], aggFunctions=[LongSumAggFunction(amount)]]]], fields=[name, type, sum$0])
 ]]>
     </Resource>
   </TestCase>
@@ -364,6 +122,34 @@ Calc(select=[EXPR$0, type, name])
 +- HashAggregate(isMerge=[true], groupBy=[type, name], select=[type, name, Final_SUM(sum$0) AS EXPR$0])
    +- Exchange(distribution=[hash[type, name]])
       +- TableSourceScan(table=[[default_catalog, default_database, inventory_part, partitions=[{type=a}, {type=b}], filter=[=(id, 123:BIGINT)], project=[type, name, amount], metadata=[], aggregates=[grouping=[type,name], aggFunctions=[LongSumAggFunction(amount)]]]], fields=[type, name, sum$0])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCanPushDownLocalAggWithoutProjectionPushDown">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  sum(amount),
+  name,
+  type
+FROM inventory_no_proj
+  where id = 123
+  group by name, type]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
+   +- LogicalProject(name=[$1], type=[$4], amount=[$2])
+      +- LogicalFilter(condition=[=($0, 123)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, inventory_no_proj]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, name, type])
++- HashAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
+   +- Exchange(distribution=[hash[name, type]])
+      +- TableSourceScan(table=[[default_catalog, default_database, inventory_no_proj, filter=[=(id, 123:BIGINT)], aggregates=[grouping=[name,type], aggFunctions=[LongSumAggFunction(amount)]]]], fields=[name, type, sum$0])
 ]]>
     </Resource>
   </TestCase>
@@ -488,6 +274,33 @@ LogicalAggregate(group=[{}], EXPR$0=[MIN($0)], EXPR$1=[MAX($1)], EXPR$2=[SUM($2)
 HashAggregate(isMerge=[true], select=[Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2, Final_AVG(sum$3, count$4) AS EXPR$3, Final_COUNT(count$5) AS EXPR$4])
 +- Exchange(distribution=[single])
    +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[id, amount, price], metadata=[], aggregates=[grouping=[], aggFunctions=[LongMinAggFunction(id),LongMaxAggFunction(amount),LongSumAggFunction(price),LongSum0AggFunction(price),CountAggFunction(price),CountAggFunction(id)]]]], fields=[min$0, max$1, sum$2, sum$3, count$4, count$5])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCanPushDownLocalSortAggWithSort">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  sum(amount),
+  name,
+  type
+FROM inventory
+  group by name, type]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
+   +- LogicalProject(name=[$1], type=[$4], amount=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, name, type])
++- SortAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
+   +- Sort(orderBy=[name ASC, type ASC])
+      +- Exchange(distribution=[hash[name, type]])
+         +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, type, amount], metadata=[], aggregates=[grouping=[name,type], aggFunctions=[LongSumAggFunction(amount)]]]], fields=[name, type, sum$0])
 ]]>
     </Resource>
   </TestCase>
@@ -516,13 +329,18 @@ SortAggregate(isMerge=[true], select=[Final_MIN(min$0) AS EXPR$0, Final_MAX(max$
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testDisablePushDownLocalAgg">
+  <TestCase name="testCannotPushDownLocalAggAfterLimitPushDown">
     <Resource name="sql">
       <![CDATA[SELECT
   sum(amount),
   name,
   type
-FROM inventory_without_agg_push_down
+FROM (
+  SELECT
+    *
+  FROM inventory
+  LIMIT 100
+) t
   group by name, type]]>
     </Resource>
     <Resource name="ast">
@@ -530,7 +348,9 @@ FROM inventory_without_agg_push_down
 LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
    +- LogicalProject(name=[$1], type=[$4], amount=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, inventory_without_agg_push_down]])
+      +- LogicalSort(fetch=[100])
+         +- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], type=[$4])
+            +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -539,14 +359,18 @@ Calc(select=[EXPR$0, name, type])
 +- HashAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
    +- Exchange(distribution=[hash[name, type]])
       +- LocalHashAggregate(groupBy=[name, type], select=[name, type, Partial_SUM(amount) AS sum$0])
-         +- TableSourceScan(table=[[default_catalog, default_database, inventory_without_agg_push_down, project=[name, type, amount], metadata=[]]], fields=[name, type, amount])
+         +- Calc(select=[name, type, amount])
+            +- Limit(offset=[0], fetch=[100], global=[true])
+               +- Exchange(distribution=[single])
+                  +- Limit(offset=[0], fetch=[100], global=[false])
+                     +- TableSourceScan(table=[[default_catalog, default_database, inventory, limit=[100]]], fields=[id, name, amount, price, type])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCanPushDownLocalSortAggWithSort">
+  <TestCase name="testCannotPushDownLocalAggWithUDAF">
     <Resource name="sql">
       <![CDATA[SELECT
-  sum(amount),
+  udaf_collect(amount),
   name,
   type
 FROM inventory
@@ -555,7 +379,7 @@ FROM inventory
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[udaf_collect($2)])
    +- LogicalProject(name=[$1], type=[$4], amount=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
 ]]>
@@ -563,10 +387,186 @@ LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[EXPR$0, name, type])
-+- SortAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
++- SortAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_udaf_collect(EXPR$0) AS EXPR$0])
    +- Sort(orderBy=[name ASC, type ASC])
       +- Exchange(distribution=[hash[name, type]])
-         +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, type, amount], metadata=[], aggregates=[grouping=[name,type], aggFunctions=[LongSumAggFunction(amount)]]]], fields=[name, type, sum$0])
+         +- LocalSortAggregate(groupBy=[name, type], select=[name, type, Partial_udaf_collect(amount) AS EXPR$0])
+            +- Sort(orderBy=[name ASC, type ASC])
+               +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, type, amount], metadata=[]]], fields=[name, type, amount])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownLocalAggWithUnsupportedDataTypes">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  max(name),
+  type
+FROM inventory
+  group by type]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], type=[$0])
++- LogicalAggregate(group=[{0}], EXPR$0=[MAX($1)])
+   +- LogicalProject(type=[$4], name=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, type])
++- SortAggregate(isMerge=[true], groupBy=[type], select=[type, Final_MAX(max$0) AS EXPR$0])
+   +- Sort(orderBy=[type ASC])
+      +- Exchange(distribution=[hash[type]])
+         +- LocalSortAggregate(groupBy=[type], select=[type, Partial_MAX(name) AS max$0])
+            +- Sort(orderBy=[type ASC])
+               +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[type, name], metadata=[]]], fields=[type, name])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownWithArgFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  min(id),
+  max(amount),
+  sum(price),
+  count(id) FILTER(WHERE id > 100),
+  name
+FROM inventory
+  group by name]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], name=[$0])
++- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)], EXPR$2=[SUM($3)], EXPR$3=[COUNT($1) FILTER $4])
+   +- LogicalProject(name=[$1], id=[$0], amount=[$2], price=[$3], $f4=[IS TRUE(>($0, 100))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, EXPR$1, EXPR$2, EXPR$3, name])
++- HashAggregate(isMerge=[true], groupBy=[name], select=[name, Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3])
+   +- Exchange(distribution=[hash[name]])
+      +- LocalHashAggregate(groupBy=[name], select=[name, Partial_MIN(id) AS min$0, Partial_MAX(amount) AS max$1, Partial_SUM(price) AS sum$2, Partial_COUNT(id) FILTER $f4 AS count$3])
+         +- Calc(select=[name, id, amount, price, IS TRUE(>(id, 100)) AS $f4])
+            +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, id, amount, price], metadata=[]]], fields=[name, id, amount, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownWithColumnExpression">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  min(amount + price),
+  max(amount),
+  sum(price),
+  count(id),
+  name
+FROM inventory
+  group by name]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], name=[$0])
++- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)], EXPR$2=[SUM($3)], EXPR$3=[COUNT($4)])
+   +- LogicalProject(name=[$1], $f1=[+($2, $3)], amount=[$2], price=[$3], id=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, EXPR$1, EXPR$2, EXPR$3, name])
++- HashAggregate(isMerge=[true], groupBy=[name], select=[name, Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3])
+   +- Exchange(distribution=[hash[name]])
+      +- LocalHashAggregate(groupBy=[name], select=[name, Partial_MIN($f1) AS min$0, Partial_MAX(amount) AS max$1, Partial_SUM(price) AS sum$2, Partial_COUNT(id) AS count$3])
+         +- Calc(select=[name, +(amount, price) AS $f1, amount, price, id])
+            +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, amount, price, id], metadata=[]]], fields=[name, amount, price, id])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownWithUnsupportedAggFunction">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  min(id),
+  max(amount),
+  sum(price),
+  count(distinct id),
+  name
+FROM inventory
+  group by name]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], name=[$0])
++- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)], EXPR$2=[SUM($3)], EXPR$3=[COUNT(DISTINCT $1)])
+   +- LogicalProject(name=[$1], id=[$0], amount=[$2], price=[$3])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, EXPR$1, EXPR$2, EXPR$3, name])
++- HashAggregate(isMerge=[true], groupBy=[name], select=[name, Final_MIN(min$0) AS EXPR$0, Final_MIN(min$1) AS EXPR$1, Final_MIN(min$2) AS EXPR$2, Final_COUNT(count$3) AS EXPR$3])
+   +- Exchange(distribution=[hash[name]])
+      +- LocalHashAggregate(groupBy=[name], select=[name, Partial_MIN(EXPR$0) FILTER $g_1 AS min$0, Partial_MIN(EXPR$1) FILTER $g_1 AS min$1, Partial_MIN(EXPR$2) FILTER $g_1 AS min$2, Partial_COUNT(id) FILTER $g_0 AS count$3])
+         +- Calc(select=[name, id, EXPR$0, EXPR$1, EXPR$2, =(CASE(=($e, 0), 0, 1), 0) AS $g_0, =(CASE(=($e, 0), 0, 1), 1) AS $g_1])
+            +- HashAggregate(isMerge=[true], groupBy=[name, id, $e], select=[name, id, $e, Final_MIN(min$0) AS EXPR$0, Final_MAX(max$1) AS EXPR$1, Final_SUM(sum$2) AS EXPR$2])
+               +- Exchange(distribution=[hash[name, id, $e]])
+                  +- LocalHashAggregate(groupBy=[name, id, $e], select=[name, id, $e, Partial_MIN(id_0) AS min$0, Partial_MAX(amount) AS max$1, Partial_SUM(price) AS sum$2])
+                     +- Expand(projects=[{name, id, amount, price, 0 AS $e, id AS id_0}, {name, null AS id, amount, price, 1 AS $e, id AS id_0}])
+                        +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[name, id, amount, price], metadata=[]]], fields=[name, id, amount, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCannotPushDownWithWindowAggFunction">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  id,
+  amount,
+  sum(price) over (partition by name),
+  name
+FROM inventory]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], amount=[$2], EXPR$2=[CASE(>(COUNT($3) OVER (PARTITION BY $1), 0), $SUM0($3) OVER (PARTITION BY $1), null:BIGINT)], name=[$1])
++- LogicalTableScan(table=[[default_catalog, default_database, inventory]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[id, amount, CASE(>(w0$o0, 0), w0$o1, null:BIGINT) AS EXPR$2, name])
++- OverAggregate(partitionBy=[name], window#0=[COUNT(price) AS w0$o0, $SUM0(price) AS w0$o1 RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING], select=[id, name, amount, price, w0$o0, w0$o1])
+   +- Sort(orderBy=[name ASC])
+      +- Exchange(distribution=[hash[name]])
+         +- TableSourceScan(table=[[default_catalog, default_database, inventory, project=[id, name, amount, price], metadata=[]]], fields=[id, name, amount, price])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testDisablePushDownLocalAgg">
+    <Resource name="sql">
+      <![CDATA[SELECT
+  sum(amount),
+  name,
+  type
+FROM inventory_without_agg_push_down
+  group by name, type]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$2], name=[$0], type=[$1])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
+   +- LogicalProject(name=[$1], type=[$4], amount=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory_without_agg_push_down]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0, name, type])
++- HashAggregate(isMerge=[true], groupBy=[name, type], select=[name, type, Final_SUM(sum$0) AS EXPR$0])
+   +- Exchange(distribution=[hash[name, type]])
+      +- LocalHashAggregate(groupBy=[name, type], select=[name, type, Partial_SUM(amount) AS sum$0])
+         +- TableSourceScan(table=[[default_catalog, default_database, inventory_without_agg_push_down, project=[name, type, amount], metadata=[]]], fields=[name, type, amount])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml
index ea6fc21c569..a1a366a40fb 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml
@@ -16,34 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testUsingLocalAggCallFilters">
-    <Resource name="sql">
-      <![CDATA[SELECT d, MAX(e), MAX(e) FILTER (WHERE a < 10), COUNT(DISTINCT c),
-COUNT(DISTINCT c) FILTER (WHERE a > 5), COUNT(DISTINCT b) FILTER (WHERE b > 3)
-FROM z GROUP BY d]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)], EXPR$2=[MAX($1) FILTER $2], EXPR$3=[COUNT(DISTINCT $3)], EXPR$4=[COUNT(DISTINCT $3) FILTER $4], EXPR$5=[COUNT(DISTINCT $5) FILTER $6])
-+- LogicalProject(d=[$3], e=[$4], $f2=[IS TRUE(<($0, 10))], c=[$2], $f4=[IS TRUE(>($0, 5))], b=[$1], $f6=[IS TRUE(>($1, 3))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, z]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_MIN(min$0) AS EXPR$1, Final_MIN(min$1) AS EXPR$2, Final_COUNT(count$2) AS EXPR$3, Final_COUNT(count$3) AS EXPR$4, Final_COUNT(count$4) AS EXPR$5])
-+- Exchange(distribution=[hash[d]])
-   +- LocalHashAggregate(groupBy=[d], select=[d, Partial_MIN(EXPR$1) FILTER $g_15 AS min$0, Partial_MIN(EXPR$2) FILTER $g_15 AS min$1, Partial_COUNT(c) FILTER $g_7 AS count$2, Partial_COUNT(c) FILTER $g_3 AS count$3, Partial_COUNT(b) FILTER $g_12 AS count$4])
-      +- Calc(select=[d, c, b, EXPR$1, EXPR$2, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 3), IS TRUE($f4)) AS $g_3, =(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 7) AS $g_7, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 12), IS TRUE($f6)) AS $g_12, =(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 15) AS $g_15])
-         +- HashAggregate(isMerge=[true], groupBy=[d, c, $f4, b, $f6, $e], select=[d, c, $f4, b, $f6, $e, Final_MAX(max$0) AS EXPR$1, Final_MAX(max$1) AS EXPR$2])
-            +- Exchange(distribution=[hash[d, c, $f4, b, $f6, $e]])
-               +- LocalHashAggregate(groupBy=[d, c, $f4, b, $f6, $e], select=[d, c, $f4, b, $f6, $e, Partial_MAX(e) AS max$0, Partial_MAX(e) FILTER $f2 AS max$1])
-                  +- Expand(projects=[{d, e, $f2, c, $f4, null AS b, null AS $f6, 3 AS $e}, {d, e, $f2, c, null AS $f4, null AS b, null AS $f6, 7 AS $e}, {d, e, $f2, null AS c, null AS $f4, b, $f6, 12 AS $e}, {d, e, $f2, null AS c, null AS $f4, null AS b, null AS $f6, 15 AS $e}])
-                     +- Calc(select=[d, e, IS TRUE(<(a, 10)) AS $f2, c, IS TRUE(>(a, 5)) AS $f4, b, IS TRUE(>(b, 3)) AS $f6])
-                        +- TableSourceScan(table=[[default_catalog, default_database, z]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testRemoveRedundantLocalHashAgg_ShuffleKeyFromJoin">
     <Resource name="sql">
       <![CDATA[
@@ -110,6 +82,34 @@ HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS EXPR$1
                   +- Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=10], partitionBy=[a, c], orderBy=[b ASC], global=[false], select=[a, b, c])
                      +- Sort(orderBy=[a ASC, c ASC, b ASC])
                         +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUsingLocalAggCallFilters">
+    <Resource name="sql">
+      <![CDATA[SELECT d, MAX(e), MAX(e) FILTER (WHERE a < 10), COUNT(DISTINCT c),
+COUNT(DISTINCT c) FILTER (WHERE a > 5), COUNT(DISTINCT b) FILTER (WHERE b > 3)
+FROM z GROUP BY d]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)], EXPR$2=[MAX($1) FILTER $2], EXPR$3=[COUNT(DISTINCT $3)], EXPR$4=[COUNT(DISTINCT $3) FILTER $4], EXPR$5=[COUNT(DISTINCT $5) FILTER $6])
++- LogicalProject(d=[$3], e=[$4], $f2=[IS TRUE(<($0, 10))], c=[$2], $f4=[IS TRUE(>($0, 5))], b=[$1], $f6=[IS TRUE(>($1, 3))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, z]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+HashAggregate(isMerge=[true], groupBy=[d], select=[d, Final_MIN(min$0) AS EXPR$1, Final_MIN(min$1) AS EXPR$2, Final_COUNT(count$2) AS EXPR$3, Final_COUNT(count$3) AS EXPR$4, Final_COUNT(count$4) AS EXPR$5])
++- Exchange(distribution=[hash[d]])
+   +- LocalHashAggregate(groupBy=[d], select=[d, Partial_MIN(EXPR$1) FILTER $g_15 AS min$0, Partial_MIN(EXPR$2) FILTER $g_15 AS min$1, Partial_COUNT(c) FILTER $g_7 AS count$2, Partial_COUNT(c) FILTER $g_3 AS count$3, Partial_COUNT(b) FILTER $g_12 AS count$4])
+      +- Calc(select=[d, c, b, EXPR$1, EXPR$2, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 3), IS TRUE($f4)) AS $g_3, =(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 7) AS $g_7, AND(=(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 12), IS TRUE($f6)) AS $g_12, =(CASE(=($e, 3), 3, =($e, 7), 7, =($e, 12), 12, 15), 15) AS $g_15])
+         +- HashAggregate(isMerge=[true], groupBy=[d, c, $f4, b, $f6, $e], select=[d, c, $f4, b, $f6, $e, Final_MAX(max$0) AS EXPR$1, Final_MAX(max$1) AS EXPR$2])
+            +- Exchange(distribution=[hash[d, c, $f4, b, $f6, $e]])
+               +- LocalHashAggregate(groupBy=[d, c, $f4, b, $f6, $e], select=[d, c, $f4, b, $f6, $e, Partial_MAX(e) AS max$0, Partial_MAX(e) FILTER $f2 AS max$1])
+                  +- Expand(projects=[{d, e, $f2, c, $f4, null AS b, null AS $f6, 3 AS $e}, {d, e, $f2, c, null AS $f4, null AS b, null AS $f6, 7 AS $e}, {d, e, $f2, null AS c, null AS $f4, b, $f6, 12 AS $e}, {d, e, $f2, null AS c, null AS $f4, null AS b, null AS $f6, 15 AS $e}])
+                     +- Calc(select=[d, e, IS TRUE(<(a, 10)) AS $f2, c, IS TRUE(>(a, 5)) AS $f4, b, IS TRUE(>(b, 3)) AS $f6])
+                        +- TableSourceScan(table=[[default_catalog, default_database, z]], fields=[a, b, c, d, e])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalRankRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalRankRuleTest.xml
index cd844314603..665d438f966 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalRankRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalRankRuleTest.xml
@@ -16,37 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testSameRankRange">
-    <Resource name="sql">
-      <![CDATA[
-SELECT a FROM (
- SELECT a, RANK() OVER(PARTITION BY a ORDER BY SUM(b)) rk FROM x GROUP BY a
-) WHERE rk <= 5
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[<=($1, 5)])
-   +- LogicalProject(a=[$0], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
-      +- LogicalAggregate(group=[{0}], agg#0=[SUM($1)])
-         +- LogicalProject(a=[$0], b=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a])
-+- Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=5], partitionBy=[a], orderBy=[$f1 ASC], global=[true], select=[a, $f1])
-   +- Sort(orderBy=[a ASC, $f1 ASC])
-      +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS $f1])
-         +- Exchange(distribution=[hash[a]])
-            +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0])
-               +- Calc(select=[a, b])
-                  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testDiffRankRange">
     <Resource name="sql">
       <![CDATA[
@@ -108,6 +77,37 @@ Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=5], partitionBy=[a], order
             +- Sort(orderBy=[a ASC, b ASC])
                +- Calc(select=[a, b])
                   +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSameRankRange">
+    <Resource name="sql">
+      <![CDATA[
+SELECT a FROM (
+ SELECT a, RANK() OVER(PARTITION BY a ORDER BY SUM(b)) rk FROM x GROUP BY a
+) WHERE rk <= 5
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalFilter(condition=[<=($1, 5)])
+   +- LogicalProject(a=[$0], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
+      +- LogicalAggregate(group=[{0}], agg#0=[SUM($1)])
+         +- LogicalProject(a=[$0], b=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a])
++- Rank(rankType=[RANK], rankRange=[rankStart=1, rankEnd=5], partitionBy=[a], orderBy=[$f1 ASC], global=[true], select=[a, $f1])
+   +- Sort(orderBy=[a ASC, $f1 ASC])
+      +- HashAggregate(isMerge=[true], groupBy=[a], select=[a, Final_SUM(sum$0) AS $f1])
+         +- Exchange(distribution=[hash[a]])
+            +- LocalHashAggregate(groupBy=[a], select=[a, Partial_SUM(b) AS sum$0])
+               +- Calc(select=[a, b])
+                  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml
index fb75190d2c3..cdf1046921a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml
@@ -16,6 +16,41 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
+  <TestCase name="testRemoveRedundantLocalSortAggWithSort">
+    <Resource name="sql">
+      <![CDATA[
+WITH r AS (SELECT * FROM x, y WHERE a = d AND c LIKE 'He%')
+SELECT sum(b) FROM r group by a
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1])
++- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
+   +- LogicalProject(a=[$0], b=[$1])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[EXPR$0])
++- SortAggregate(isMerge=[false], groupBy=[a], select=[a, SUM(b) AS EXPR$0])
+   +- Calc(select=[a, b])
+      +- Sort(orderBy=[a ASC])
+         +- HashJoin(joinType=[InnerJoin], where=[=(a, d)], select=[a, b, d], build=[left])
+            :- Exchange(distribution=[hash[a]])
+            :  +- Calc(select=[a, b], where=[LIKE(c, 'He%')])
+            :     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
+            +- Exchange(distribution=[hash[d]])
+               +- Calc(select=[d])
+                  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testRemoveRedundantLocalSortAggWithoutSort">
     <Resource name="sql">
       <![CDATA[
@@ -77,41 +112,6 @@ SortAggregate(isMerge=[true], groupBy=[d], select=[d, Final_MIN(min$0) AS EXPR$1
                         +- Expand(projects=[{d, e, $f2, c, $f4, null AS b, null AS $f6, 3 AS $e}, {d, e, $f2, c, null AS $f4, null AS b, null AS $f6, 7 AS $e}, {d, e, $f2, null AS c, null AS $f4, b, $f6, 12 AS $e}, {d, e, $f2, null AS c, null AS $f4, null AS b, null AS $f6, 15 AS $e}])
                            +- Calc(select=[d, e, IS TRUE(<(a, 10)) AS $f2, c, IS TRUE(>(a, 5)) AS $f4, b, IS TRUE(>(b, 3)) AS $f6])
                               +- TableSourceScan(table=[[default_catalog, default_database, z]], fields=[a, b, c, d, e])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRemoveRedundantLocalSortAggWithSort">
-    <Resource name="sql">
-      <![CDATA[
-WITH r AS (SELECT * FROM x, y WHERE a = d AND c LIKE 'He%')
-SELECT sum(b) FROM r group by a
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1])
-+- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
-   +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-               +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[EXPR$0])
-+- SortAggregate(isMerge=[false], groupBy=[a], select=[a, SUM(b) AS EXPR$0])
-   +- Calc(select=[a, b])
-      +- Sort(orderBy=[a ASC])
-         +- HashJoin(joinType=[InnerJoin], where=[=(a, d)], select=[a, b, d], build=[left])
-            :- Exchange(distribution=[hash[a]])
-            :  +- Calc(select=[a, b], where=[LIKE(c, 'He%')])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-            +- Exchange(distribution=[hash[d]])
-               +- Calc(select=[d])
-                  +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml
index bd5a6a20be2..72ac683e619 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml
@@ -71,46 +71,92 @@ Calc(select=[EXPR$0], changelogMode=[I,UA])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSelect">
-    <Resource name="sql">
-      <![CDATA[SELECT word, number FROM MyTable]]>
-    </Resource>
+  <TestCase name="testPropagateUpdateKindAmongRelNodeBlocks">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(word=[$0], number=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[number, word])
++- LogicalProject(number=[$0], word=[$1])
+   +- LogicalFilter(condition=[>($1, _UTF-16LE'a')])
+      +- LogicalUnion(all=[true])
+         :- LogicalProject(number=[+($0, 1)], word=[$1])
+         :  +- LogicalProject(number=[$1], word=[$0])
+         :     +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+         +- LogicalProject(number=[-($0, 1)], word=[$1])
+            +- LogicalProject(number=[$1], word=[$0])
+               +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[number, word])
++- LogicalProject(number=[$0], word=[$1])
+   +- LogicalFilter(condition=[<($1, _UTF-16LE'a')])
+      +- LogicalUnion(all=[true])
+         :- LogicalProject(number=[+($0, 1)], word=[$1])
+         :  +- LogicalProject(number=[$1], word=[$0])
+         :     +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+         +- LogicalProject(number=[-($0, 1)], word=[$1])
+            +- LogicalProject(number=[$1], word=[$0])
+               +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+
+LogicalSink(table=[default_catalog.default_database.sink2], fields=[number, word])
++- LogicalProject(number=[$0], word=[$1])
+   +- LogicalProject(number=[$1], word=[$0])
+      +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+Sink(table=[default_catalog.default_database.sink1], fields=[number, word], changelogMode=[NONE])
++- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
+   :- Calc(select=[number, word], where=[>(word, 'a')], changelogMode=[I,UB,UA])
+   :  +- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
+   :     :- Calc(select=[+(number, 1) AS number, word], changelogMode=[I,UB,UA])
+   :     :  +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+   :     :     +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+   :     :        +- Exchange(distribution=[hash[word]], changelogMode=[I])
+   :     :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+   :     +- Calc(select=[-(number, 1) AS number, word], changelogMode=[I,UB,UA])
+   :        +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+   :           +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+   :              +- Exchange(distribution=[hash[word]], changelogMode=[I])
+   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+   +- Calc(select=[number, word], where=[<(word, 'a')], changelogMode=[I,UB,UA])
+      +- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
+         :- Calc(select=[+(number, 1) AS number, word], changelogMode=[I,UB,UA])
+         :  +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+         :     +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+         :        +- Exchange(distribution=[hash[word]], changelogMode=[I])
+         :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+         +- Calc(select=[-(number, 1) AS number, word], changelogMode=[I,UB,UA])
+            +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+               +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+                  +- Exchange(distribution=[hash[word]], changelogMode=[I])
+                     +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+
+Sink(table=[default_catalog.default_database.sink2], fields=[number, word], changelogMode=[NONE])
++- Calc(select=[number, word], changelogMode=[I,UB,UA])
+   +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+      +- Exchange(distribution=[hash[word]], changelogMode=[I])
+         +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTwoLevelGroupByLocalGlobalOff">
+  <TestCase name="testSelect">
     <Resource name="sql">
-      <![CDATA[
-SELECT cnt, COUNT(cnt) AS frequency FROM (
-  SELECT word, COUNT(number) as cnt FROM MyTable GROUP BY word
-) GROUP BY cnt
-      ]]>
+      <![CDATA[SELECT word, number FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], frequency=[COUNT()])
-+- LogicalProject(cnt=[$1])
-   +- LogicalAggregate(group=[{0}], cnt=[COUNT($1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+LogicalProject(word=[$0], number=[$1])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GroupAggregate(groupBy=[cnt], select=[cnt, COUNT_RETRACT(*) AS frequency], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[cnt]], changelogMode=[I,UB,UA])
-   +- Calc(select=[cnt], changelogMode=[I,UB,UA])
-      +- GroupAggregate(groupBy=[word], select=[word, COUNT(number) AS cnt], changelogMode=[I,UB,UA])
-         +- Exchange(distribution=[hash[word]], changelogMode=[I])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -150,12 +196,12 @@ Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS procti
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTemporalJoinWithNonEqualConditionOnKey">
+  <TestCase name="testTemporalJoinWithDeduplicateView">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM Orders AS o
- JOIN ratesChangelogStream FOR SYSTEM_TIME AS OF o.rowtime AS r
- ON o.currency = r.currency and o.currency < 5
+ JOIN DeduplicatedView FOR SYSTEM_TIME AS OF o.rowtime AS r
+ ON o.currency = r.currency
       ]]>
     </Resource>
     <Resource name="ast">
@@ -165,24 +211,28 @@ LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[$3], currency
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
    :  +- LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, Orders, source: [CollectionTableSource(amount, currency, rowtime)]]])
-   +- LogicalFilter(condition=[AND(=($cor0.currency, $0), <(CAST($cor0.currency):BIGINT, 5))])
+   +- LogicalFilter(condition=[=($cor0.currency, $0)])
       +- LogicalSnapshot(period=[$cor0.rowtime])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-            +- LogicalTableScan(table=[[default_catalog, default_database, ratesChangelogStream]])
+         +- LogicalProject(currency=[$0], rate=[$1], rowtime=[$2])
+            +- LogicalFilter(condition=[=($3, 1)])
+               +- LogicalProject(currency=[$0], rate=[$1], rowtime=[$2], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, ratesHistory, source: [CollectionTableSource(currency, rate, rowtime)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
-			<![CDATA[
+      <![CDATA[
 Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, currency0, rate, CAST(rowtime0 AS TIMESTAMP(3)) AS rowtime0], changelogMode=[I])
-+- TemporalJoin(joinType=[InnerJoin], where=[AND(=(currency, currency0), <(CAST(currency AS BIGINT), 5), __TEMPORAL_JOIN_CONDITION(rowtime, rowtime0, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency0), __TEMPORAL_JOIN_LEFT_KEY(currency), __TEMPORAL_JOIN_RIGHT_KEY(currency0)))], select=[amount, currency, rowtime, proctime, currency0, rate, rowtime0], changelogMode=[I])
++- TemporalJoin(joinType=[InnerJoin], where=[AND(=(currency, currency0), __TEMPORAL_JOIN_CONDITION(rowtime, rowtime0, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency0), __TEMPORAL_JOIN_LEFT_KEY(currency), __TEMPORAL_JOIN_RIGHT_KEY(currency0)))], select=[amount, currency, rowtime, proctime, currency0, rate, rowtime0], changelogMode=[I])
    :- Exchange(distribution=[hash[currency]], changelogMode=[I])
    :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime], changelogMode=[I])
    :     +- Calc(select=[amount, currency, rowtime, PROCTIME() AS proctime], changelogMode=[I])
    :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, Orders, source: [CollectionTableSource(amount, currency, rowtime)]]], fields=[amount, currency, rowtime], changelogMode=[I])
    +- Exchange(distribution=[hash[currency]], changelogMode=[I,UA,D])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime], changelogMode=[I,UA,D])
-         +- DropUpdateBefore(changelogMode=[I,UA,D])
-            +- TableSourceScan(table=[[default_catalog, default_database, ratesChangelogStream]], fields=[currency, rate, rowtime], changelogMode=[I,UB,UA,D])
+      +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[currency], orderBy=[ROWTIME rowtime DESC], select=[currency, rate, rowtime], changelogMode=[I,UA,D])
+         +- Exchange(distribution=[hash[currency]], changelogMode=[I])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime], changelogMode=[I])
+               +- LegacyTableSourceScan(table=[[default_catalog, default_database, ratesHistory, source: [CollectionTableSource(currency, rate, rowtime)]]], fields=[currency, rate, rowtime], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -258,42 +308,12 @@ Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS procti
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTwoLevelGroupByLocalGlobalOn">
-    <Resource name="sql">
-      <![CDATA[
-SELECT cnt, COUNT(cnt) AS frequency FROM (
-  SELECT word, COUNT(number) as cnt FROM MyTable GROUP BY word
-) GROUP BY cnt
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], frequency=[COUNT()])
-+- LogicalProject(cnt=[$1])
-   +- LogicalAggregate(group=[{0}], cnt=[COUNT($1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-GlobalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT_RETRACT(count1$0) AS frequency], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[cnt]], changelogMode=[I])
-   +- LocalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT_RETRACT(*) AS count1$0], changelogMode=[I])
-      +- Calc(select=[cnt], changelogMode=[I,UB,UA])
-         +- GlobalGroupAggregate(groupBy=[word], select=[word, COUNT(count$0) AS cnt], changelogMode=[I,UB,UA])
-            +- Exchange(distribution=[hash[word]], changelogMode=[I])
-               +- LocalGroupAggregate(groupBy=[word], select=[word, COUNT(number) AS count$0], changelogMode=[I])
-                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime], changelogMode=[I])
-                     +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTemporalJoinWithDeduplicateView">
+  <TestCase name="testTemporalJoinWithNonEqualConditionOnKey">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM Orders AS o
- JOIN DeduplicatedView FOR SYSTEM_TIME AS OF o.rowtime AS r
- ON o.currency = r.currency
+ JOIN ratesChangelogStream FOR SYSTEM_TIME AS OF o.rowtime AS r
+ ON o.currency = r.currency and o.currency < 5
       ]]>
     </Resource>
     <Resource name="ast">
@@ -303,101 +323,81 @@ LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[$3], currency
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
    :  +- LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, Orders, source: [CollectionTableSource(amount, currency, rowtime)]]])
-   +- LogicalFilter(condition=[=($cor0.currency, $0)])
+   +- LogicalFilter(condition=[AND(=($cor0.currency, $0), <(CAST($cor0.currency):BIGINT, 5))])
       +- LogicalSnapshot(period=[$cor0.rowtime])
-         +- LogicalProject(currency=[$0], rate=[$1], rowtime=[$2])
-            +- LogicalFilter(condition=[=($3, 1)])
-               +- LogicalProject(currency=[$0], rate=[$1], rowtime=[$2], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
-                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, ratesHistory, source: [CollectionTableSource(currency, rate, rowtime)]]])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+            +- LogicalTableScan(table=[[default_catalog, default_database, ratesChangelogStream]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, currency0, rate, CAST(rowtime0 AS TIMESTAMP(3)) AS rowtime0], changelogMode=[I])
-+- TemporalJoin(joinType=[InnerJoin], where=[AND(=(currency, currency0), __TEMPORAL_JOIN_CONDITION(rowtime, rowtime0, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency0), __TEMPORAL_JOIN_LEFT_KEY(currency), __TEMPORAL_JOIN_RIGHT_KEY(currency0)))], select=[amount, currency, rowtime, proctime, currency0, rate, rowtime0], changelogMode=[I])
++- TemporalJoin(joinType=[InnerJoin], where=[AND(=(currency, currency0), <(CAST(currency AS BIGINT), 5), __TEMPORAL_JOIN_CONDITION(rowtime, rowtime0, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency0), __TEMPORAL_JOIN_LEFT_KEY(currency), __TEMPORAL_JOIN_RIGHT_KEY(currency0)))], select=[amount, currency, rowtime, proctime, currency0, rate, rowtime0], changelogMode=[I])
    :- Exchange(distribution=[hash[currency]], changelogMode=[I])
    :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime], changelogMode=[I])
    :     +- Calc(select=[amount, currency, rowtime, PROCTIME() AS proctime], changelogMode=[I])
    :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, Orders, source: [CollectionTableSource(amount, currency, rowtime)]]], fields=[amount, currency, rowtime], changelogMode=[I])
    +- Exchange(distribution=[hash[currency]], changelogMode=[I,UA,D])
-      +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[currency], orderBy=[ROWTIME rowtime DESC], select=[currency, rate, rowtime], changelogMode=[I,UA,D])
-         +- Exchange(distribution=[hash[currency]], changelogMode=[I])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime], changelogMode=[I])
-               +- LegacyTableSourceScan(table=[[default_catalog, default_database, ratesHistory, source: [CollectionTableSource(currency, rate, rowtime)]]], fields=[currency, rate, rowtime], changelogMode=[I])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime], changelogMode=[I,UA,D])
+         +- DropUpdateBefore(changelogMode=[I,UA,D])
+            +- TableSourceScan(table=[[default_catalog, default_database, ratesChangelogStream]], fields=[currency, rate, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPropagateUpdateKindAmongRelNodeBlocks">
+  <TestCase name="testTwoLevelGroupByLocalGlobalOff">
+    <Resource name="sql">
+      <![CDATA[
+SELECT cnt, COUNT(cnt) AS frequency FROM (
+  SELECT word, COUNT(number) as cnt FROM MyTable GROUP BY word
+) GROUP BY cnt
+      ]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[number, word])
-+- LogicalProject(number=[$0], word=[$1])
-   +- LogicalFilter(condition=[>($1, _UTF-16LE'a')])
-      +- LogicalUnion(all=[true])
-         :- LogicalProject(number=[+($0, 1)], word=[$1])
-         :  +- LogicalProject(number=[$1], word=[$0])
-         :     +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-         +- LogicalProject(number=[-($0, 1)], word=[$1])
-            +- LogicalProject(number=[$1], word=[$0])
-               +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[number, word])
-+- LogicalProject(number=[$0], word=[$1])
-   +- LogicalFilter(condition=[<($1, _UTF-16LE'a')])
-      +- LogicalUnion(all=[true])
-         :- LogicalProject(number=[+($0, 1)], word=[$1])
-         :  +- LogicalProject(number=[$1], word=[$0])
-         :     +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-         +- LogicalProject(number=[-($0, 1)], word=[$1])
-            +- LogicalProject(number=[$1], word=[$0])
-               +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-
-LogicalSink(table=[default_catalog.default_database.sink2], fields=[number, word])
-+- LogicalProject(number=[$0], word=[$1])
-   +- LogicalProject(number=[$1], word=[$0])
-      +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+LogicalAggregate(group=[{0}], frequency=[COUNT()])
++- LogicalProject(cnt=[$1])
+   +- LogicalAggregate(group=[{0}], cnt=[COUNT($1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink1], fields=[number, word], changelogMode=[NONE])
-+- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
-   :- Calc(select=[number, word], where=[>(word, 'a')], changelogMode=[I,UB,UA])
-   :  +- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
-   :     :- Calc(select=[+(number, 1) AS number, word], changelogMode=[I,UB,UA])
-   :     :  +- Calc(select=[number, word], changelogMode=[I,UB,UA])
-   :     :     +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-   :     :        +- Exchange(distribution=[hash[word]], changelogMode=[I])
-   :     :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
-   :     +- Calc(select=[-(number, 1) AS number, word], changelogMode=[I,UB,UA])
-   :        +- Calc(select=[number, word], changelogMode=[I,UB,UA])
-   :           +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-   :              +- Exchange(distribution=[hash[word]], changelogMode=[I])
-   :                 +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
-   +- Calc(select=[number, word], where=[<(word, 'a')], changelogMode=[I,UB,UA])
-      +- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
-         :- Calc(select=[+(number, 1) AS number, word], changelogMode=[I,UB,UA])
-         :  +- Calc(select=[number, word], changelogMode=[I,UB,UA])
-         :     +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-         :        +- Exchange(distribution=[hash[word]], changelogMode=[I])
-         :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
-         +- Calc(select=[-(number, 1) AS number, word], changelogMode=[I,UB,UA])
-            +- Calc(select=[number, word], changelogMode=[I,UB,UA])
-               +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-                  +- Exchange(distribution=[hash[word]], changelogMode=[I])
+GroupAggregate(groupBy=[cnt], select=[cnt, COUNT_RETRACT(*) AS frequency], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[cnt]], changelogMode=[I,UB,UA])
+   +- Calc(select=[cnt], changelogMode=[I,UB,UA])
+      +- GroupAggregate(groupBy=[word], select=[word, COUNT(number) AS cnt], changelogMode=[I,UB,UA])
+         +- Exchange(distribution=[hash[word]], changelogMode=[I])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoLevelGroupByLocalGlobalOn">
+    <Resource name="sql">
+      <![CDATA[
+SELECT cnt, COUNT(cnt) AS frequency FROM (
+  SELECT word, COUNT(number) as cnt FROM MyTable GROUP BY word
+) GROUP BY cnt
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], frequency=[COUNT()])
++- LogicalProject(cnt=[$1])
+   +- LogicalAggregate(group=[{0}], cnt=[COUNT($1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+GlobalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT_RETRACT(count1$0) AS frequency], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[cnt]], changelogMode=[I])
+   +- LocalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT_RETRACT(*) AS count1$0], changelogMode=[I])
+      +- Calc(select=[cnt], changelogMode=[I,UB,UA])
+         +- GlobalGroupAggregate(groupBy=[word], select=[word, COUNT(count$0) AS cnt], changelogMode=[I,UB,UA])
+            +- Exchange(distribution=[hash[word]], changelogMode=[I])
+               +- LocalGroupAggregate(groupBy=[word], select=[word, COUNT(number) AS count$0], changelogMode=[I])
+                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime], changelogMode=[I])
                      +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
-
-Sink(table=[default_catalog.default_database.sink2], fields=[number, word], changelogMode=[NONE])
-+- Calc(select=[number, word], changelogMode=[I,UB,UA])
-   +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-      +- Exchange(distribution=[hash[word]], changelogMode=[I])
-         +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/DuplicateChangesInferRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/DuplicateChangesInferRuleTest.xml
index e762799c559..8485e4540c2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/DuplicateChangesInferRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/DuplicateChangesInferRuleTest.xml
@@ -52,42 +52,6 @@ Sink(table=[default_catalog.default_database.pk_append_sink], fields=[a, b, c],
 +- Calc(select=[a, b, c], duplicateChanges=[DISALLOW])
    +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
       +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCalc[testSinkWithPk = false]">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.no_pk_snk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalWatermarkAssigner(rowtime=[rt], watermark=[-($3, 1000:INTERVAL SECOND)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, append_src1]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.no_pk_snk], fields=[a, b, c], duplicateChanges=[NONE])
-+- Calc(select=[a, b, c], duplicateChanges=[DISALLOW])
-   +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
-      +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCalc[testSinkWithPk = true]">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.pk_upsert_snk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalWatermarkAssigner(rowtime=[rt], watermark=[-($3, 1000:INTERVAL SECOND)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, append_src1]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.pk_upsert_snk], fields=[a, b, c], duplicateChanges=[NONE])
-+- Calc(select=[a, b, c], duplicateChanges=[ALLOW])
-   +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[ALLOW])
-      +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[ALLOW])
 ]]>
     </Resource>
   </TestCase>
@@ -274,6 +238,42 @@ Sink(table=[default_catalog.default_database.pk_upsert_snk], fields=[a, b, EXPR$
 +- Calc(select=[a, b, CAST(NOW() AS BIGINT) AS EXPR$2], duplicateChanges=[ALLOW])
    +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
       +- TableSourceScan(table=[[default_catalog, default_database, append_src1, project=[a, b, rt], metadata=[]]], fields=[a, b, rt], duplicateChanges=[DISALLOW])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalc[testSinkWithPk = false]">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.no_pk_snk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalWatermarkAssigner(rowtime=[rt], watermark=[-($3, 1000:INTERVAL SECOND)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, append_src1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.no_pk_snk], fields=[a, b, c], duplicateChanges=[NONE])
++- Calc(select=[a, b, c], duplicateChanges=[DISALLOW])
+   +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
+      +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalc[testSinkWithPk = true]">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.pk_upsert_snk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalWatermarkAssigner(rowtime=[rt], watermark=[-($3, 1000:INTERVAL SECOND)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, append_src1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.pk_upsert_snk], fields=[a, b, c], duplicateChanges=[NONE])
++- Calc(select=[a, b, c], duplicateChanges=[ALLOW])
+   +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[ALLOW])
+      +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[ALLOW])
 ]]>
     </Resource>
   </TestCase>
@@ -940,27 +940,6 @@ Sink(table=[default_catalog.default_database.pk_upsert_snk], fields=[a, b, c], d
    +- Calc(select=[a, b, c], duplicateChanges=[DISALLOW])
       +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
          +- TableSourceScan(table=[[default_catalog, default_database, append_src2]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWindowTVF[testSinkWithPk = true]">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.pk_upsert_snk_with_time_col], fields=[a, b, c, window_start, window_end])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], window_start=[$4], window_end=[$5])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rt'), 60000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rt, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rt=[$3])
-         +- LogicalWatermarkAssigner(rowtime=[rt], watermark=[-($3, 1000:INTERVAL SECOND)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, append_src1]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.pk_upsert_snk_with_time_col], fields=[a, b, c, window_start, window_end], duplicateChanges=[NONE])
-+- Calc(select=[a, b, c, window_start, window_end], duplicateChanges=[ALLOW])
-   +- WindowTableFunction(window=[TUMBLE(time_col=[rt], size=[1 min])], duplicateChanges=[ALLOW])
-      +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
-         +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
 ]]>
     </Resource>
   </TestCase>
@@ -1022,6 +1001,27 @@ Sink(table=[default_catalog.default_database.pk_upsert_snk_with_time_col], field
          +- WindowTableFunction(window=[TUMBLE(time_col=[rt], size=[1 min])], duplicateChanges=[DISALLOW])
             +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
                +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWindowTVF[testSinkWithPk = true]">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.pk_upsert_snk_with_time_col], fields=[a, b, c, window_start, window_end])
++- LogicalProject(a=[$0], b=[$1], c=[$2], window_start=[$4], window_end=[$5])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rt'), 60000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rt, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rt=[$3])
+         +- LogicalWatermarkAssigner(rowtime=[rt], watermark=[-($3, 1000:INTERVAL SECOND)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, append_src1]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.pk_upsert_snk_with_time_col], fields=[a, b, c, window_start, window_end], duplicateChanges=[NONE])
++- Calc(select=[a, b, c, window_start, window_end], duplicateChanges=[ALLOW])
+   +- WindowTableFunction(window=[TUMBLE(time_col=[rt], size=[1 min])], duplicateChanges=[ALLOW])
+      +- WatermarkAssigner(rowtime=[rt], watermark=[-(rt, 1000:INTERVAL SECOND)], duplicateChanges=[DISALLOW])
+         +- TableSourceScan(table=[[default_catalog, default_database, append_src1]], fields=[a, b, c, rt], duplicateChanges=[DISALLOW])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ExpandWindowTableFunctionTransposeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ExpandWindowTableFunctionTransposeRuleTest.xml
index 92cccd40a94..81d3c36fce2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ExpandWindowTableFunctionTransposeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ExpandWindowTableFunctionTransposeRuleTest.xml
@@ -60,7 +60,7 @@ Calc(select=[a, window_start, window_end, $f1 AS $f3, $f2 AS $f4, $f3 AS $f5, $f
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_DistinctSplitEnabled">
+  <TestCase name="testHop_DistinctSplitEnabled">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -71,7 +71,8 @@ SELECT
    sum(d),
    max(d) filter (where b > 1000),
    count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+FROM TABLE(
+   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -79,7 +80,7 @@ GROUP BY a, window_start, window_end
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
 +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
@@ -89,13 +90,13 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, window_start, window_end, $f1 AS $f3, $f2 AS $f4, $f3 AS $f5, $f4 AS $f6])
-+- WindowAggregate(groupBy=[a], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, $SUM0($f5) AS $f1, SUM($f6_0) AS $f2, MAX($f7_0) AS $f3, $SUM0($f8) AS $f4, start('w$) AS window_start, end('w$) AS window_end])
++- WindowAggregate(groupBy=[a], window=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], select=[a, $SUM0($f5) AS $f1, SUM($f6_0) AS $f2, MAX($f7_0) AS $f3, $SUM0($f8) AS $f4, start('w$) AS window_start, end('w$) AS window_end])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, window_start, window_end, $f6, $f7, $f3 AS $f5, $f4 AS $f6_0, $f5 AS $f7_0, $f6_0 AS $f8])
-         +- WindowAggregate(groupBy=[a, $f6, $f7], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, $f6, $f7, COUNT(*) FILTER $g_3 AS $f3, SUM(d) FILTER $g_3 AS $f4, MAX(d) FILTER $g_1 AS $f5, COUNT(DISTINCT c) FILTER $g_2 AS $f6_0, start('w$) AS window_start, end('w$) AS window_end])
+         +- WindowAggregate(groupBy=[a, $f6, $f7], window=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], select=[a, $f6, $f7, COUNT(*) FILTER $g_3 AS $f3, SUM(d) FILTER $g_3 AS $f4, MAX(d) FILTER $g_1 AS $f5, COUNT(DISTINCT c) FILTER $g_2 AS $f6_0, start('w$) AS window_start, end('w$) AS window_end])
             +- Exchange(distribution=[hash[a, $f6, $f7]])
                +- Calc(select=[a, window_start, window_end, d, $f4, c, $f6, $f7, =($e, 3) AS $g_3, AND(=($e, 1), $f4) AS $g_1, =($e, 2) AS $g_2])
-                  +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+                  +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
                      +- Expand(projects=[{a, d, $f4, c, $f6, null AS $f7, 1 AS $e, rowtime}, {a, d, $f4, c, null AS $f6, $f7, 2 AS $e, rowtime}, {a, d, $f4, c, null AS $f6, null AS $f7, 3 AS $e, rowtime}])
                         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, MOD(HASH_CODE(d), 1024) AS $f6, MOD(HASH_CODE(c), 1024) AS $f7, rowtime])
                            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
@@ -103,7 +104,7 @@ Calc(select=[a, window_start, window_end, $f1 AS $f3, $f2 AS $f4, $f3 AS $f5, $f
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_DistinctSplitEnabled">
+  <TestCase name="testTumble_DistinctSplitEnabled">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -114,8 +115,7 @@ SELECT
    sum(d),
    max(d) filter (where b > 1000),
    count(distinct c) AS uv
-FROM TABLE(
-   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -123,7 +123,7 @@ GROUP BY a, window_start, window_end
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
 +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
@@ -133,13 +133,13 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, window_start, window_end, $f1 AS $f3, $f2 AS $f4, $f3 AS $f5, $f4 AS $f6])
-+- WindowAggregate(groupBy=[a], window=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], select=[a, $SUM0($f5) AS $f1, SUM($f6_0) AS $f2, MAX($f7_0) AS $f3, $SUM0($f8) AS $f4, start('w$) AS window_start, end('w$) AS window_end])
++- WindowAggregate(groupBy=[a], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, $SUM0($f5) AS $f1, SUM($f6_0) AS $f2, MAX($f7_0) AS $f3, $SUM0($f8) AS $f4, start('w$) AS window_start, end('w$) AS window_end])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, window_start, window_end, $f6, $f7, $f3 AS $f5, $f4 AS $f6_0, $f5 AS $f7_0, $f6_0 AS $f8])
-         +- WindowAggregate(groupBy=[a, $f6, $f7], window=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], select=[a, $f6, $f7, COUNT(*) FILTER $g_3 AS $f3, SUM(d) FILTER $g_3 AS $f4, MAX(d) FILTER $g_1 AS $f5, COUNT(DISTINCT c) FILTER $g_2 AS $f6_0, start('w$) AS window_start, end('w$) AS window_end])
+         +- WindowAggregate(groupBy=[a, $f6, $f7], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, $f6, $f7, COUNT(*) FILTER $g_3 AS $f3, SUM(d) FILTER $g_3 AS $f4, MAX(d) FILTER $g_1 AS $f5, COUNT(DISTINCT c) FILTER $g_2 AS $f6_0, start('w$) AS window_start, end('w$) AS window_end])
             +- Exchange(distribution=[hash[a, $f6, $f7]])
                +- Calc(select=[a, window_start, window_end, d, $f4, c, $f6, $f7, =($e, 3) AS $g_3, AND(=($e, 1), $f4) AS $g_1, =($e, 2) AS $g_2])
-                  +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
+                  +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
                      +- Expand(projects=[{a, d, $f4, c, $f6, null AS $f7, 1 AS $e, rowtime}, {a, d, $f4, c, null AS $f6, $f7, 2 AS $e, rowtime}, {a, d, $f4, c, null AS $f6, null AS $f7, 3 AS $e, rowtime}])
                         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, MOD(HASH_CODE(d), 1024) AS $f6, MOD(HASH_CODE(c), 1024) AS $f7, rowtime])
                            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/PushCalcPastChangelogNormalizeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/PushCalcPastChangelogNormalizeRuleTest.xml
index 506a22b2afd..646fa9943b4 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/PushCalcPastChangelogNormalizeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/PushCalcPastChangelogNormalizeRuleTest.xml
@@ -115,27 +115,6 @@ GroupAggregate(groupBy=[f0, f1, f2, f3], select=[f0, f1, f2, f3])
             +- ChangelogNormalize(key=[f1], condition=[SEARCH(f3, Sarg[(0..1)])])
                +- Exchange(distribution=[hash[f1]])
                   +- TableSourceScan(table=[[default_catalog, default_database, T3]], fields=[f0, f1, f2, f3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithMultiplePrimaryKeyColumns">
-    <Resource name="sql">
-      <![CDATA[SELECT f0, f1 FROM T WHERE (f1 < 1 OR f2 > 10) AND f0 IS NOT NULL]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(f0=[$0], f1=[$1])
-+- LogicalFilter(condition=[AND(OR(<($1, 1), >($2, 10)), IS NOT NULL($0))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[f0, f1])
-+- ChangelogNormalize(key=[f1, f2], condition=[IS NOT NULL(f0)])
-   +- Exchange(distribution=[hash[f1, f2]])
-      +- Calc(select=[f0, f1, f2], where=[OR(<(f1, 1), >(f2, 10))])
-         +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3, f4, f5, f6, f7])
 ]]>
     </Resource>
   </TestCase>
@@ -216,25 +195,6 @@ GroupAggregate(groupBy=[f0, f1, f2, f3], select=[f0, f1, f2, f3])
          +- Exchange(distribution=[hash[f0, f1, f2, f3]])
             +- Calc(select=[f0, f1, f2, f3], where=[(f3 < 10)])
                +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOnlyProjection">
-    <Resource name="sql">
-      <![CDATA[SELECT f1, f2 FROM T]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(f1=[$1], f2=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, T]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-ChangelogNormalize(key=[f1])
-+- Exchange(distribution=[hash[f1]])
-   +- Calc(select=[f1, f2])
-      +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3])
 ]]>
     </Resource>
   </TestCase>
@@ -271,6 +231,25 @@ GroupAggregate(groupBy=[f0, f1, f2, f3], select=[f0, f1, f2, f3])
          :- Exchange(distribution=[hash[f0, f1, f2, f3]])(reuse_id=[2])
          :  +- Reused(reference_id=[1])
          +- Reused(reference_id=[2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOnlyProjection">
+    <Resource name="sql">
+      <![CDATA[SELECT f1, f2 FROM T]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(f1=[$1], f2=[$2])
++- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+ChangelogNormalize(key=[f1])
++- Exchange(distribution=[hash[f1]])
+   +- Calc(select=[f1, f2])
+      +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3])
 ]]>
     </Resource>
   </TestCase>
@@ -539,45 +518,66 @@ GroupAggregate(groupBy=[f0, f1, f2, f3], select=[f0, f1, f2, f3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithSinglePrimaryKeyFilter">
+  <TestCase name="testWithMultipleFilters">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM T WHERE f1 < 1]]>
+      <![CDATA[SELECT f1, SUM(f1) AS `sum` FROM T WHERE f1 < 10 AND (f1 > 3 OR f2 IS NULL) GROUP BY f1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[$0], f1=[$1], f2=[$2], f3=[$3])
-+- LogicalFilter(condition=[<($1, 1)])
+LogicalAggregate(group=[{0}], sum=[SUM($0)])
++- LogicalProject(f1=[$1])
+   +- LogicalFilter(condition=[AND(<($1, 10), OR(>($1, 3), IS NULL($2)))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[f1, f1 AS sum])
++- ChangelogNormalize(key=[f1], condition=[OR(IS NULL(f2), >(f1, 3))])
+   +- Exchange(distribution=[hash[f1]])
+      +- Calc(select=[f1, f2], where=[<(f1, 10)])
+         +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithMultiplePrimaryKeyColumns">
+    <Resource name="sql">
+      <![CDATA[SELECT f0, f1 FROM T WHERE (f1 < 1 OR f2 > 10) AND f0 IS NOT NULL]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(f0=[$0], f1=[$1])
++- LogicalFilter(condition=[AND(OR(<($1, 1), >($2, 10)), IS NOT NULL($0))])
    +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-ChangelogNormalize(key=[f1])
-+- Exchange(distribution=[hash[f1]])
-   +- Calc(select=[f0, f1, f2, f3], where=[<(f1, 1)])
-      +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3])
+Calc(select=[f0, f1])
++- ChangelogNormalize(key=[f1, f2], condition=[IS NOT NULL(f0)])
+   +- Exchange(distribution=[hash[f1, f2]])
+      +- Calc(select=[f0, f1, f2], where=[OR(<(f1, 1), >(f2, 10))])
+         +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3, f4, f5, f6, f7])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithMultipleFilters">
+  <TestCase name="testWithSinglePrimaryKeyFilter">
     <Resource name="sql">
-      <![CDATA[SELECT f1, SUM(f1) AS `sum` FROM T WHERE f1 < 10 AND (f1 > 3 OR f2 IS NULL) GROUP BY f1]]>
+      <![CDATA[SELECT * FROM T WHERE f1 < 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], sum=[SUM($0)])
-+- LogicalProject(f1=[$1])
-   +- LogicalFilter(condition=[AND(<($1, 10), OR(>($1, 3), IS NULL($2)))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+LogicalProject(f0=[$0], f1=[$1], f2=[$2], f3=[$3])
++- LogicalFilter(condition=[<($1, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[f1, f1 AS sum])
-+- ChangelogNormalize(key=[f1], condition=[OR(IS NULL(f2), >(f1, 3))])
-   +- Exchange(distribution=[hash[f1]])
-      +- Calc(select=[f1, f2], where=[<(f1, 10)])
-         +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3])
+ChangelogNormalize(key=[f1])
++- Exchange(distribution=[hash[f1]])
+   +- Calc(select=[f0, f1, f2, f3], where=[<(f1, 1)])
+      +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[f0, f1, f2, f3])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcMergeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcMergeTest.xml
index 06f29420cee..b6bc21cd326 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcMergeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcMergeTest.xml
@@ -16,26 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testCalcMergeWithTopMultiNonDeterministicExpr">
-    <Resource name="sql">
-      <![CDATA[SELECT random_udf(a1) as a2, random_udf(a1) as a3 FROM (SELECT random_udf(a) as a1, b FROM MyTable) t WHERE b > 10]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a2=[random_udf($0)], a3=[random_udf($0)])
-+- LogicalFilter(condition=[>($1, 10)])
-   +- LogicalProject(a1=[random_udf($0)], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[random_udf(a1) AS a2, random_udf(a1) AS a3])
-+- Calc(select=[random_udf(a) AS a1, b], where=[(b > 10)])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testCalcMergeTopFilterHasNonDeterministicExpr">
     <Resource name="sql">
       <![CDATA[SELECT a, c FROM (SELECT a, random_udf(b) as b1, c FROM MyTable) t WHERE b1 > 10]]>
@@ -169,6 +149,26 @@ LogicalProject(a=[$0], b=[$1])
       <![CDATA[
 Calc(select=[a, b], where=[(a = b)])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalcMergeWithTopMultiNonDeterministicExpr">
+    <Resource name="sql">
+      <![CDATA[SELECT random_udf(a1) as a2, random_udf(a1) as a3 FROM (SELECT random_udf(a) as a1, b FROM MyTable) t WHERE b > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a2=[random_udf($0)], a3=[random_udf($0)])
++- LogicalFilter(condition=[>($1, 10)])
+   +- LogicalProject(a1=[random_udf($0)], b=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[random_udf(a1) AS a2, random_udf(a1) AS a3])
++- Calc(select=[random_udf(a) AS a1, b], where=[(b > 10)])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, filter=[], project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml
index d0ac50c15fc..0e1a1942201 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml
@@ -265,23 +265,6 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
       <![CDATA[
 Calc(select=[a, b, c], where=[((b > 0) AND (a < 50))])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultipleFlattening">
-    <Resource name="sql">
-      <![CDATA[SELECT MyTable2.a.*, c, MyTable2.b.* FROM MyTable2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(_1=[$0._1], _2=[$0._2], c=[$2], _10=[$1._1], _20=[$1._2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a._1 AS _1, a._2 AS _2, c, b._1 AS _10, b._2 AS _20])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -303,37 +286,36 @@ Calc(select=[c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonPrimitiveMapType">
+  <TestCase name="testMultipleFlattening">
     <Resource name="sql">
-      <![CDATA[SELECT MAP[a, c] FROM MyTable]]>
+      <![CDATA[SELECT MyTable2.a.*, c, MyTable2.b.* FROM MyTable2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[MAP($0, $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(_1=[$0._1], _2=[$0._2], c=[$2], _10=[$1._1], _20=[$1._2])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[MAP(a, c) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Calc(select=[a._1 AS _1, a._2 AS _2, c, b._1 AS _10, b._2 AS _20])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOrWithIsNullPredicate">
+  <TestCase name="testNonPrimitiveMapType">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 10 OR a IS NULL]]>
+      <![CDATA[SELECT MAP[a, c] FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalFilter(condition=[OR(=($0, 1), =($0, 10), IS NULL($0))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[MAP($0, $2)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c], where=[SEARCH(a, Sarg[1, 10; NULL AS TRUE])])
+Calc(select=[MAP(a, c) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -391,37 +373,37 @@ Calc(select=[a, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProjectAndFilter">
+  <TestCase name="testOrWithIsNullInIf">
     <Resource name="sql">
-      <![CDATA[SELECT a, b + 1 FROM MyTable WHERE b > 2]]>
+      <![CDATA[SELECT IF(c = '' OR c IS NULL, 'a', 'b') FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[+($1, 1)])
-+- LogicalFilter(condition=[>($1, 2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[IF(SEARCH($2, Sarg[_UTF-16LE'':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"; NULL AS TRUE]:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), _UTF-16LE'a', _UTF-16LE'b')])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, (b + 1) AS EXPR$1], where=[(b > 2)])
+Calc(select=[IF(SEARCH(c, Sarg[_UTF-16LE''; NULL AS TRUE]), 'a', 'b') AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOrWithIsNullInIf">
+  <TestCase name="testOrWithIsNullPredicate">
     <Resource name="sql">
-      <![CDATA[SELECT IF(c = '' OR c IS NULL, 'a', 'b') FROM MyTable]]>
+      <![CDATA[SELECT * FROM MyTable WHERE a = 1 OR a = 10 OR a IS NULL]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[IF(SEARCH($2, Sarg[_UTF-16LE'':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"; NULL AS TRUE]:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), _UTF-16LE'a', _UTF-16LE'b')])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalFilter(condition=[OR(=($0, 1), =($0, 10), IS NULL($0))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[IF(SEARCH(c, Sarg[_UTF-16LE''; NULL AS TRUE]), 'a', 'b') AS EXPR$0])
+Calc(select=[a, b, c], where=[SEARCH(a, Sarg[1, 10; NULL AS TRUE])])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -456,6 +438,24 @@ LogicalProject(EXPR$0=[MAP($1, 30:BIGINT, 10, $0)])
       <![CDATA[
 Calc(select=[MAP(b, 30, 10, a) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProjectAndFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b + 1 FROM MyTable WHERE b > 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], EXPR$1=[+($1, 1)])
++- LogicalFilter(condition=[>($1, 2)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, (b + 1) AS EXPR$1], where=[(b > 2)])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -499,107 +499,107 @@ TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTypeEquality">
+  <TestCase name="testRepeatedTryCast">
     <Resource name="sql">
-      <![CDATA[
-SELECT my_row = ROW(1, 'str') from src
-]]>
+      <![CDATA[SELECT TRY_CAST(TRY_CAST(a AS STRING) AS STRING) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[=(CAST($0):RecordType(INTEGER a, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" b), CAST(ROW(1, _UTF-16LE'str')):RecordType(INTEGER a, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" b) NOT NULL)])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(EXPR$0=[TRY_CAST($0)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[(CAST(my_row AS RecordType(INTEGER a, VARCHAR(2147483647) b)) = CAST(ROW(1, 'str') AS RecordType(INTEGER a, VARCHAR(2147483647) b))) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[my_row])
+Calc(select=[TRY_CAST(a AS VARCHAR(2147483647)) AS EXPR$0])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowType">
+  <TestCase name="testRepeatedTryCastAfterCast">
     <Resource name="sql">
-      <![CDATA[SELECT ROW(1, 'Hi', a) FROM MyTable]]>
+      <![CDATA[SELECT TRY_CAST(CAST(a AS STRING) AS STRING) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[ROW(1, _UTF-16LE'Hi', $0)])
+LogicalProject(EXPR$0=[CAST($0):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[ROW(1, 'Hi', a) AS EXPR$0])
+Calc(select=[CAST(a AS VARCHAR(2147483647)) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRepeatedTryCast">
+  <TestCase name="testRepeatedTryCastDifferentType">
     <Resource name="sql">
-      <![CDATA[SELECT TRY_CAST(TRY_CAST(a AS STRING) AS STRING) FROM MyTable]]>
+      <![CDATA[SELECT TRY_CAST(TRY_CAST(a AS STRING) AS INTEGER) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[TRY_CAST($0)])
+LogicalProject(EXPR$0=[TRY_CAST(TRY_CAST($0))])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[TRY_CAST(a AS VARCHAR(2147483647)) AS EXPR$0])
+Calc(select=[TRY_CAST(TRY_CAST(a AS VARCHAR(2147483647)) AS INTEGER) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRepeatedTryCastAfterCast">
+  <TestCase name="testRepeatedTryCastSameType">
     <Resource name="sql">
-      <![CDATA[SELECT TRY_CAST(CAST(a AS STRING) AS STRING) FROM MyTable]]>
+      <![CDATA[SELECT TRY_CAST(a AS BIGINT) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[CAST($0):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
+LogicalProject(EXPR$0=[$0])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[CAST(a AS VARCHAR(2147483647)) AS EXPR$0])
+Calc(select=[a AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRepeatedTryCastSameType">
+  <TestCase name="testRowType">
     <Resource name="sql">
-      <![CDATA[SELECT TRY_CAST(a AS BIGINT) FROM MyTable]]>
+      <![CDATA[SELECT ROW(1, 'Hi', a) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[$0])
+LogicalProject(EXPR$0=[ROW(1, _UTF-16LE'Hi', $0)])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a AS EXPR$0])
+Calc(select=[ROW(1, 'Hi', a) AS EXPR$0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRepeatedTryCastDifferentType">
+  <TestCase name="testRowTypeEquality">
     <Resource name="sql">
-      <![CDATA[SELECT TRY_CAST(TRY_CAST(a AS STRING) AS INTEGER) FROM MyTable]]>
+      <![CDATA[
+SELECT my_row = ROW(1, 'str') from src
+]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[TRY_CAST(TRY_CAST($0))])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[=(CAST($0):RecordType(INTEGER a, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" b), CAST(ROW(1, _UTF-16LE'str')):RecordType(INTEGER a, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" b) NOT NULL)])
++- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[TRY_CAST(TRY_CAST(a AS VARCHAR(2147483647)) AS INTEGER) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Calc(select=[(CAST(my_row AS RecordType(INTEGER a, VARCHAR(2147483647) b)) = CAST(ROW(1, 'str') AS RecordType(INTEGER a, VARCHAR(2147483647) b))) AS EXPR$0])
++- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[my_row])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml
index 81b903829aa..9f7107c8013 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml
@@ -347,78 +347,6 @@ Sink(table=[default_catalog.default_database.retractSink2], fields=[total_min],
    +- Exchange(distribution=[single], changelogMode=[I])
       +- Calc(select=[random_udf(a) AS a], changelogMode=[I])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testMultiSinksWithUDTF">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.retractSink1], fields=[a, total_c])
-+- LogicalProject(a=[$0], total_c=[$1])
-   +- LogicalFilter(condition=[>($0, 50)])
-      +- LogicalUnion(all=[true])
-         :- LogicalProject(a=[$0], total_c=[$2])
-         :  +- LogicalAggregate(group=[{0, 1}], total_c=[COUNT(DISTINCT $2)])
-         :     +- LogicalProject(a=[$0], b=[$1], c=[$3])
-         :        +- LogicalFilter(condition=[<>($2, _UTF-16LE'')])
-         :           +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-         :              :- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
-         :              :  +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-         :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-         +- LogicalProject(a=[$0], total_c=[0])
-            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
-               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-
-LogicalSink(table=[default_catalog.default_database.retractSink2], fields=[a, total_c])
-+- LogicalProject(a=[$0], total_c=[$1])
-   +- LogicalFilter(condition=[<($0, 50)])
-      +- LogicalUnion(all=[true])
-         :- LogicalProject(a=[$0], total_c=[$2])
-         :  +- LogicalAggregate(group=[{0, 1}], total_c=[COUNT(DISTINCT $2)])
-         :     +- LogicalProject(a=[$0], b=[$1], c=[$3])
-         :        +- LogicalFilter(condition=[<>($2, _UTF-16LE'')])
-         :           +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-         :              :- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
-         :              :  +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-         :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-         +- LogicalProject(a=[$0], total_c=[0])
-            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
-               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.retractSink1], fields=[a, total_c], changelogMode=[NONE])
-+- Union(all=[true], union=[a, total_c], changelogMode=[I,UB,UA])
-   :- Calc(select=[a, total_c], where=[>(a, 50)], changelogMode=[I,UB,UA])
-   :  +- Calc(select=[a, total_c], changelogMode=[I,UB,UA])
-   :     +- GroupAggregate(groupBy=[a, b], select=[a, b, COUNT(DISTINCT c) AS total_c], changelogMode=[I,UB,UA])
-   :        +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
-   :           +- Calc(select=[a, b, EXPR$0 AS c], changelogMode=[I])
-   :              +- Correlate(invocation=[split($cor0.c)], correlate=[table(split($cor0.c))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER], changelogMode=[I])
-   :                 +- Calc(select=[a, -(b, MOD(b, 300)) AS b, c], where=[AND(>=(b, UNIX_TIMESTAMP('${startTime}')), <>(c, ''))], changelogMode=[I])
-   :                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-   +- Calc(select=[a, CAST(total_c AS BIGINT) AS total_c], where=[>(a, 50)], changelogMode=[I])
-      +- Calc(select=[a, 0 AS total_c], where=[>=(b, UNIX_TIMESTAMP('${startTime}'))], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-
-Sink(table=[default_catalog.default_database.retractSink2], fields=[a, total_c], changelogMode=[NONE])
-+- Union(all=[true], union=[a, total_c], changelogMode=[I,UB,UA])
-   :- Calc(select=[a, total_c], where=[<(a, 50)], changelogMode=[I,UB,UA])
-   :  +- Calc(select=[a, total_c], changelogMode=[I,UB,UA])
-   :     +- GroupAggregate(groupBy=[a, b], select=[a, b, COUNT(DISTINCT c) AS total_c], changelogMode=[I,UB,UA])
-   :        +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
-   :           +- Calc(select=[a, b, EXPR$0 AS c], changelogMode=[I])
-   :              +- Correlate(invocation=[split($cor0.c)], correlate=[table(split($cor0.c))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER], changelogMode=[I])
-   :                 +- Calc(select=[a, -(b, MOD(b, 300)) AS b, c], where=[AND(>=(b, UNIX_TIMESTAMP('${startTime}')), <>(c, ''))], changelogMode=[I])
-   :                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-   +- Calc(select=[a, CAST(total_c AS BIGINT) AS total_c], where=[<(a, 50)], changelogMode=[I])
-      +- Calc(select=[a, 0 AS total_c], where=[>=(b, UNIX_TIMESTAMP('${startTime}'))], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -682,6 +610,78 @@ Sink(table=[default_catalog.default_database.retractSink], fields=[total_min], c
          +- Calc(select=[a], changelogMode=[I])
             +- Calc(select=[a, c], changelogMode=[I])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testMultiSinksWithUDTF">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.retractSink1], fields=[a, total_c])
++- LogicalProject(a=[$0], total_c=[$1])
+   +- LogicalFilter(condition=[>($0, 50)])
+      +- LogicalUnion(all=[true])
+         :- LogicalProject(a=[$0], total_c=[$2])
+         :  +- LogicalAggregate(group=[{0, 1}], total_c=[COUNT(DISTINCT $2)])
+         :     +- LogicalProject(a=[$0], b=[$1], c=[$3])
+         :        +- LogicalFilter(condition=[<>($2, _UTF-16LE'')])
+         :           +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+         :              :- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+         :              :  +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+         :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
+         +- LogicalProject(a=[$0], total_c=[0])
+            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+
+LogicalSink(table=[default_catalog.default_database.retractSink2], fields=[a, total_c])
++- LogicalProject(a=[$0], total_c=[$1])
+   +- LogicalFilter(condition=[<($0, 50)])
+      +- LogicalUnion(all=[true])
+         :- LogicalProject(a=[$0], total_c=[$2])
+         :  +- LogicalAggregate(group=[{0, 1}], total_c=[COUNT(DISTINCT $2)])
+         :     +- LogicalProject(a=[$0], b=[$1], c=[$3])
+         :        +- LogicalFilter(condition=[<>($2, _UTF-16LE'')])
+         :           +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+         :              :- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+         :              :  +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+         :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
+         +- LogicalProject(a=[$0], total_c=[0])
+            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.retractSink1], fields=[a, total_c], changelogMode=[NONE])
++- Union(all=[true], union=[a, total_c], changelogMode=[I,UB,UA])
+   :- Calc(select=[a, total_c], where=[>(a, 50)], changelogMode=[I,UB,UA])
+   :  +- Calc(select=[a, total_c], changelogMode=[I,UB,UA])
+   :     +- GroupAggregate(groupBy=[a, b], select=[a, b, COUNT(DISTINCT c) AS total_c], changelogMode=[I,UB,UA])
+   :        +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
+   :           +- Calc(select=[a, b, EXPR$0 AS c], changelogMode=[I])
+   :              +- Correlate(invocation=[split($cor0.c)], correlate=[table(split($cor0.c))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER], changelogMode=[I])
+   :                 +- Calc(select=[a, -(b, MOD(b, 300)) AS b, c], where=[AND(>=(b, UNIX_TIMESTAMP('${startTime}')), <>(c, ''))], changelogMode=[I])
+   :                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+   +- Calc(select=[a, CAST(total_c AS BIGINT) AS total_c], where=[>(a, 50)], changelogMode=[I])
+      +- Calc(select=[a, 0 AS total_c], where=[>=(b, UNIX_TIMESTAMP('${startTime}'))], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+
+Sink(table=[default_catalog.default_database.retractSink2], fields=[a, total_c], changelogMode=[NONE])
++- Union(all=[true], union=[a, total_c], changelogMode=[I,UB,UA])
+   :- Calc(select=[a, total_c], where=[<(a, 50)], changelogMode=[I,UB,UA])
+   :  +- Calc(select=[a, total_c], changelogMode=[I,UB,UA])
+   :     +- GroupAggregate(groupBy=[a, b], select=[a, b, COUNT(DISTINCT c) AS total_c], changelogMode=[I,UB,UA])
+   :        +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
+   :           +- Calc(select=[a, b, EXPR$0 AS c], changelogMode=[I])
+   :              +- Correlate(invocation=[split($cor0.c)], correlate=[table(split($cor0.c))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER], changelogMode=[I])
+   :                 +- Calc(select=[a, -(b, MOD(b, 300)) AS b, c], where=[AND(>=(b, UNIX_TIMESTAMP('${startTime}')), <>(c, ''))], changelogMode=[I])
+   :                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+   +- Calc(select=[a, CAST(total_c AS BIGINT) AS total_c], where=[<(a, 50)], changelogMode=[I])
+      +- Calc(select=[a, 0 AS total_c], where=[>=(b, UNIX_TIMESTAMP('${startTime}'))], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -930,38 +930,6 @@ Sink(table=[default_catalog.default_database.appendSink], fields=[a1, b1, c1], c
                         +- Exchange(distribution=[hash[a2]], changelogMode=[I])
                            +- Calc(select=[a AS a2], where=[AND(>=(a, 0), >=(b, 5))], changelogMode=[I])
                               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleSinkWithUDTF">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.appendSink], fields=[a, b, c, d, e, f, i, j, k, l, m, s])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], i=[$6], j=[$7], k=[$8], l=[$9], m=[$10], s=[$11])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], i=[$6], j=[$7], k=[$8], l=[$9], m=[$10])
-      :  +- LogicalFilter(condition=[AND(=($1, $4), =($0, $6))])
-      :     +- LogicalJoin(condition=[true], joinType=[inner])
-      :        :- LogicalJoin(condition=[true], joinType=[inner])
-      :        :  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-      +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.appendSink], fields=[a, b, c, d, e, f, i, j, k, l, m, EXPR$0], changelogMode=[NONE])
-+- Correlate(invocation=[split($cor0.c)], correlate=[table(split($cor0.c))], select=[a,b,c,d,e,f,i,j,k,l,m,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER d, BIGINT e, VARCHAR(2147483647) f, INTEGER i, BIGINT j, INTEGER k, VARCHAR(2147483647) l, BIGINT m, VARCHAR(2147483647) EXPR$0)], joinType=[INNER], changelogMode=[I])
-   +- Join(joinType=[InnerJoin], where=[=(a, i)], select=[a, b, c, d, e, f, i, j, k, l, m], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
-      :- Exchange(distribution=[hash[a]], changelogMode=[I])
-      :  +- Join(joinType=[InnerJoin], where=[=(b, e)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
-      :     :- Exchange(distribution=[hash[b]], changelogMode=[I])
-      :     :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-      :     +- Exchange(distribution=[hash[e]], changelogMode=[I])
-      :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[d, e, f], changelogMode=[I])
-      +- Exchange(distribution=[hash[i]], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[i, j, k, l, m], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -991,39 +959,35 @@ Sink(table=[default_catalog.default_database.retractSink], fields=[total_sum], c
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpdateAsRetractConsumedAtSourceBlock">
+  <TestCase name="testSingleSinkWithUDTF">
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.retractSink], fields=[a])
-+- LogicalProject(a=[$0])
-   +- LogicalFilter(condition=[>($0, 6)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[$3])
-         +- LogicalFilter(condition=[<=($3, 10)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-
-LogicalSink(table=[default_catalog.default_database.upsertSink], fields=[a, b])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[<($0, 6)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[$3])
-         +- LogicalFilter(condition=[<=($3, 10)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalSink(table=[default_catalog.default_database.appendSink], fields=[a, b, c, d, e, f, i, j, k, l, m, s])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], i=[$6], j=[$7], k=[$8], l=[$9], m=[$10], s=[$11])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5], i=[$6], j=[$7], k=[$8], l=[$9], m=[$10])
+      :  +- LogicalFilter(condition=[AND(=($1, $4), =($0, $6))])
+      :     +- LogicalJoin(condition=[true], joinType=[inner])
+      :        :- LogicalJoin(condition=[true], joinType=[inner])
+      :        :  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+      +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.retractSink], fields=[a], changelogMode=[NONE])
-+- Calc(select=[a], where=[>(a, 6)], changelogMode=[I,UB,UA,D])
-   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[b], orderBy=[c DESC], select=[a, b, c, w0$o0], changelogMode=[I,UB,UA,D])
-      +- Exchange(distribution=[hash[b]], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-
-Sink(table=[default_catalog.default_database.upsertSink], fields=[a, b], changelogMode=[NONE])
-+- Calc(select=[a, b], where=[<(a, 6)], changelogMode=[I,UB,UA,D])
-   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[b], orderBy=[c DESC], select=[a, b, c, w0$o0], changelogMode=[I,UB,UA,D])
-      +- Exchange(distribution=[hash[b]], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+Sink(table=[default_catalog.default_database.appendSink], fields=[a, b, c, d, e, f, i, j, k, l, m, EXPR$0], changelogMode=[NONE])
++- Correlate(invocation=[split($cor0.c)], correlate=[table(split($cor0.c))], select=[a,b,c,d,e,f,i,j,k,l,m,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, INTEGER d, BIGINT e, VARCHAR(2147483647) f, INTEGER i, BIGINT j, INTEGER k, VARCHAR(2147483647) l, BIGINT m, VARCHAR(2147483647) EXPR$0)], joinType=[INNER], changelogMode=[I])
+   +- Join(joinType=[InnerJoin], where=[=(a, i)], select=[a, b, c, d, e, f, i, j, k, l, m], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
+      :- Exchange(distribution=[hash[a]], changelogMode=[I])
+      :  +- Join(joinType=[InnerJoin], where=[=(b, e)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
+      :     :- Exchange(distribution=[hash[b]], changelogMode=[I])
+      :     :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+      :     +- Exchange(distribution=[hash[e]], changelogMode=[I])
+      :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[d, e, f], changelogMode=[I])
+      +- Exchange(distribution=[hash[i]], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[i, j, k, l, m], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -1083,6 +1047,42 @@ Sink(table=[default_catalog.default_database.retractSink], fields=[a, b, c, w0$o
 Sink(table=[default_catalog.default_database.upsertSink], fields=[a, b], changelogMode=[NONE])
 +- Calc(select=[a, b], where=[<(a, 6)], changelogMode=[I])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUpdateAsRetractConsumedAtSourceBlock">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.retractSink], fields=[a])
++- LogicalProject(a=[$0])
+   +- LogicalFilter(condition=[>($0, 6)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[$3])
+         +- LogicalFilter(condition=[<=($3, 10)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+
+LogicalSink(table=[default_catalog.default_database.upsertSink], fields=[a, b])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalFilter(condition=[<($0, 6)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[$3])
+         +- LogicalFilter(condition=[<=($3, 10)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.retractSink], fields=[a], changelogMode=[NONE])
++- Calc(select=[a], where=[>(a, 6)], changelogMode=[I,UB,UA,D])
+   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[b], orderBy=[c DESC], select=[a, b, c, w0$o0], changelogMode=[I,UB,UA,D])
+      +- Exchange(distribution=[hash[b]], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+
+Sink(table=[default_catalog.default_database.upsertSink], fields=[a, b], changelogMode=[NONE])
++- Calc(select=[a, b], where=[<(a, 6)], changelogMode=[I,UB,UA,D])
+   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[b], orderBy=[c DESC], select=[a, b, c, w0$o0], changelogMode=[I,UB,UA,D])
+      +- Exchange(distribution=[hash[b]], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml
index e01bccbbfcb..f5f7e4edfbf 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml
@@ -58,23 +58,6 @@ Calc(select=[a, 2:BIGINT AS $1], changelogMode=[I,UA,D])
 
 == Optimized Execution Plan ==
 Calc(select=[a, 2 AS $1])
-+- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=2, rankEnd=2], partitionBy=[b], orderBy=[proctime DESC], select=[a, b, proctime])
-   +- Exchange(distribution=[hash[b]])
-      +- Calc(select=[a, b, proctime])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], rank_num=[$1])
-+- LogicalFilter(condition=[=($1, 2)])
-   +- LogicalProject(a=[$0], rank_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $3 DESC NULLS LAST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, 2 AS $1])
 +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=2, rankEnd=2], partitionBy=[b], orderBy=[proctime DESC], select=[a, b, proctime])
    +- Exchange(distribution=[hash[b]])
       +- Calc(select=[a, b, proctime])
@@ -244,33 +227,9 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, 1 AS
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleLastRowOnBuiltinProctime">
+  <TestCase name="testSimpleFirstRowOnProctime">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
-LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[$5])
-+- LogicalFilter(condition=[=($5, 1)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[ROW_NUMBER() OVER (ORDER BY PROCTIME() DESC NULLS LAST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-
-== Optimized Physical Plan ==
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, 1:BIGINT AS $5], changelogMode=[I,UA,D])
-+- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[], orderBy=[$5 DESC], select=[a, b, c, proctime, rowtime, $5], changelogMode=[I,UA,D])
-   +- Exchange(distribution=[single], changelogMode=[I])
-      +- Calc(select=[a, b, c, proctime, rowtime, PROCTIME() AS $5], changelogMode=[I])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
-
-== Optimized Execution Plan ==
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, 1 AS $5])
-+- Deduplicate(keep=[LastRow], key=[], order=[PROCTIME], outputInsertOnly=[false])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[a, b, c, proctime, rowtime, PROCTIME() AS $5])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSimpleFirstRowOnProctime">
-	  <Resource name="explain">
-		  <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(EXPR$0=[$1], b=[$0], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$2=[SUM($2)])
    +- LogicalProject(b=[$1], a=[$0], c=[$2])
@@ -299,76 +258,99 @@ Calc(select=[EXPR$0, b, EXPR$2])
                +- Calc(select=[a, b, c, proctime])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
-	  </Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testSimpleLastRowOnRowtime">
+  <TestCase name="testSimpleFirstRowOnRowtime">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(EXPR$0=[$1], b=[$0], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$2=[SUM($2)])
    +- LogicalProject(b=[$1], a=[$0], c=[$2])
       +- LogicalProject(a=[$0], b=[$1], c=[$2])
-         +- LogicalFilter(condition=[=($5, 1)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $4 DESC NULLS LAST)])
+         +- LogicalFilter(condition=[<=($5, 1)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $4 NULLS FIRST)])
                +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
-Calc(select=[EXPR$0, b, EXPR$2], changelogMode=[I,UA,D])
-+- GroupAggregate(groupBy=[b], select=[b, SUM_RETRACT(a) AS EXPR$0, SUM_RETRACT(c) AS EXPR$2], changelogMode=[I,UA,D])
-   +- Exchange(distribution=[hash[b]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[b, a, c], changelogMode=[I,UB,UA,D])
-         +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[ROWTIME rowtime DESC], select=[a, b, c, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[EXPR$0, b, EXPR$2], changelogMode=[I,UA])
++- GroupAggregate(groupBy=[b], select=[b, SUM(a) AS EXPR$0, SUM(c) AS EXPR$2], changelogMode=[I,UA])
+   +- Exchange(distribution=[hash[b]], changelogMode=[I])
+      +- Calc(select=[b, a, c], changelogMode=[I])
+         +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[ROWTIME rowtime ASC], select=[a, b, c, rowtime], changelogMode=[I])
             +- Exchange(distribution=[hash[a]], changelogMode=[I])
                +- Calc(select=[a, b, c, rowtime], changelogMode=[I])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 
 == Optimized Execution Plan ==
 Calc(select=[EXPR$0, b, EXPR$2])
-+- GroupAggregate(groupBy=[b], select=[b, SUM_RETRACT(a) AS EXPR$0, SUM_RETRACT(c) AS EXPR$2])
++- GroupAggregate(groupBy=[b], select=[b, SUM(a) AS EXPR$0, SUM(c) AS EXPR$2])
    +- Exchange(distribution=[hash[b]])
       +- Calc(select=[b, a, c])
-         +- Deduplicate(keep=[LastRow], key=[a], order=[ROWTIME], outputInsertOnly=[false])
+         +- Deduplicate(keep=[FirstRow], key=[a], order=[ROWTIME], outputInsertOnly=[true])
             +- Exchange(distribution=[hash[a]])
                +- Calc(select=[a, b, c, rowtime])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimpleFirstRowOnRowtime">
+  <TestCase name="testSimpleLastRowOnBuiltinProctime">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[$5])
++- LogicalFilter(condition=[=($5, 1)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[ROW_NUMBER() OVER (ORDER BY PROCTIME() DESC NULLS LAST)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
-	  <Resource name="explain">
-		  <![CDATA[== Abstract Syntax Tree ==
+== Optimized Physical Plan ==
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, 1:BIGINT AS $5], changelogMode=[I,UA,D])
++- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[], orderBy=[$5 DESC], select=[a, b, c, proctime, rowtime, $5], changelogMode=[I,UA,D])
+   +- Exchange(distribution=[single], changelogMode=[I])
+      +- Calc(select=[a, b, c, proctime, rowtime, PROCTIME() AS $5], changelogMode=[I])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
+
+== Optimized Execution Plan ==
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, 1 AS $5])
++- Deduplicate(keep=[LastRow], key=[], order=[PROCTIME], outputInsertOnly=[false])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[a, b, c, proctime, rowtime, PROCTIME() AS $5])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSimpleLastRowOnProctime">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(EXPR$0=[$1], b=[$0], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$2=[SUM($2)])
    +- LogicalProject(b=[$1], a=[$0], c=[$2])
       +- LogicalProject(a=[$0], b=[$1], c=[$2])
-         +- LogicalFilter(condition=[<=($5, 1)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $4 NULLS FIRST)])
+         +- LogicalFilter(condition=[=($5, 1)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
                +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
-Calc(select=[EXPR$0, b, EXPR$2], changelogMode=[I,UA])
-+- GroupAggregate(groupBy=[b], select=[b, SUM(a) AS EXPR$0, SUM(c) AS EXPR$2], changelogMode=[I,UA])
-   +- Exchange(distribution=[hash[b]], changelogMode=[I])
-      +- Calc(select=[b, a, c], changelogMode=[I])
-         +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[ROWTIME rowtime ASC], select=[a, b, c, rowtime], changelogMode=[I])
+Calc(select=[EXPR$0, b, EXPR$2], changelogMode=[I,UA,D])
++- GroupAggregate(groupBy=[b], select=[b, SUM_RETRACT(a) AS EXPR$0, SUM_RETRACT(c) AS EXPR$2], changelogMode=[I,UA,D])
+   +- Exchange(distribution=[hash[b]], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[b, a, c], changelogMode=[I,UB,UA,D])
+         +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[proctime DESC], select=[a, b, c, proctime], changelogMode=[I,UB,UA,D])
             +- Exchange(distribution=[hash[a]], changelogMode=[I])
-               +- Calc(select=[a, b, c, rowtime], changelogMode=[I])
+               +- Calc(select=[a, b, c, proctime], changelogMode=[I])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 
 == Optimized Execution Plan ==
 Calc(select=[EXPR$0, b, EXPR$2])
-+- GroupAggregate(groupBy=[b], select=[b, SUM(a) AS EXPR$0, SUM(c) AS EXPR$2])
++- GroupAggregate(groupBy=[b], select=[b, SUM_RETRACT(a) AS EXPR$0, SUM_RETRACT(c) AS EXPR$2])
    +- Exchange(distribution=[hash[b]])
       +- Calc(select=[b, a, c])
-         +- Deduplicate(keep=[FirstRow], key=[a], order=[ROWTIME], outputInsertOnly=[true])
+         +- Deduplicate(keep=[LastRow], key=[a], order=[PROCTIME], outputInsertOnly=[false])
             +- Exchange(distribution=[hash[a]])
-               +- Calc(select=[a, b, c, rowtime])
+               +- Calc(select=[a, b, c, proctime])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
-	  </Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testSimpleLastRowOnProctime">
+  <TestCase name="testSimpleLastRowOnRowtime">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(EXPR$0=[$1], b=[$0], EXPR$2=[$2])
@@ -376,7 +358,7 @@ LogicalProject(EXPR$0=[$1], b=[$0], EXPR$2=[$2])
    +- LogicalProject(b=[$1], a=[$0], c=[$2])
       +- LogicalProject(a=[$0], b=[$1], c=[$2])
          +- LogicalFilter(condition=[=($5, 1)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $4 DESC NULLS LAST)])
                +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
@@ -384,9 +366,9 @@ Calc(select=[EXPR$0, b, EXPR$2], changelogMode=[I,UA,D])
 +- GroupAggregate(groupBy=[b], select=[b, SUM_RETRACT(a) AS EXPR$0, SUM_RETRACT(c) AS EXPR$2], changelogMode=[I,UA,D])
    +- Exchange(distribution=[hash[b]], changelogMode=[I,UB,UA,D])
       +- Calc(select=[b, a, c], changelogMode=[I,UB,UA,D])
-         +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[proctime DESC], select=[a, b, c, proctime], changelogMode=[I,UB,UA,D])
+         +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[ROWTIME rowtime DESC], select=[a, b, c, rowtime], changelogMode=[I,UB,UA,D])
             +- Exchange(distribution=[hash[a]], changelogMode=[I])
-               +- Calc(select=[a, b, c, proctime], changelogMode=[I])
+               +- Calc(select=[a, b, c, rowtime], changelogMode=[I])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 
 == Optimized Execution Plan ==
@@ -394,9 +376,9 @@ Calc(select=[EXPR$0, b, EXPR$2])
 +- GroupAggregate(groupBy=[b], select=[b, SUM_RETRACT(a) AS EXPR$0, SUM_RETRACT(c) AS EXPR$2])
    +- Exchange(distribution=[hash[b]])
       +- Calc(select=[b, a, c])
-         +- Deduplicate(keep=[LastRow], key=[a], order=[PROCTIME], outputInsertOnly=[false])
+         +- Deduplicate(keep=[LastRow], key=[a], order=[ROWTIME], outputInsertOnly=[false])
             +- Exchange(distribution=[hash[a]])
-               +- Calc(select=[a, b, c, proctime])
+               +- Calc(select=[a, b, c, rowtime])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeltaJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeltaJoinTest.xml
index f4a44f5c27c..cda6b9dbcda 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeltaJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeltaJoinTest.xml
@@ -215,35 +215,6 @@ Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b
 
 No available advice...
 
-== Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
-   :- Exchange(distribution=[hash[a1, a2]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-   +- Exchange(distribution=[hash[b1, b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLookupTableWithCache">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
-
-== Optimized Physical Plan With Advice ==
-Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- DeltaJoin(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1])
-   :- Exchange(distribution=[hash[a1, a2]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-   +- Exchange(distribution=[hash[b1, b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
-
-No available advice...
-
 == Optimized Execution Plan ==
 Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
@@ -601,6 +572,35 @@ Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b
    :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
    +- Exchange(distribution=[hash[b2]])
       +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLookupTableWithCache">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+
+== Optimized Physical Plan With Advice ==
+Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- DeltaJoin(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1])
+   :- Exchange(distribution=[hash[a1, a2]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+   +- Exchange(distribution=[hash[b1, b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+
+No available advice...
+
+== Optimized Execution Plan ==
+Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
+   :- Exchange(distribution=[hash[a1, a2]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+   +- Exchange(distribution=[hash[b1, b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -637,7 +637,7 @@ Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiRootsWithoutReusingDeltaJoin1">
+  <TestCase name="testMultiRootsWithReusingDeltaJoin">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
@@ -655,79 +655,75 @@ LogicalSink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Exchange(distribution=[hash[a1, a2]])(reuse_id=[1])
-+- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-
-Exchange(distribution=[hash[b1, b2]])(reuse_id=[2])
-+- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])(reuse_id=[1])
+:- Exchange(distribution=[hash[a1, a2]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
++- Exchange(distribution=[hash[b1, b2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 
 Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
-   :- Reused(reference_id=[1])
-   +- Reused(reference_id=[2])
++- Reused(reference_id=[1])
 
 Sink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Join(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Reused(reference_id=[1])
-   +- Reused(reference_id=[2])
++- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiRootsWithoutReusingDeltaJoin2">
+  <TestCase name="testMultiRootsWithReusingJoinView">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 
 LogicalSink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Exchange(distribution=[hash[a1, a2]])(reuse_id=[1])
-+- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-
-Exchange(distribution=[hash[b1, b2]])(reuse_id=[2])
-+- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])(reuse_id=[1])
+:- Exchange(distribution=[hash[a1, a2]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
++- Exchange(distribution=[hash[b1, b2]])
+   +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 
 Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
-   :- Reused(reference_id=[1])
-   +- Reused(reference_id=[2])
++- Reused(reference_id=[1])
 
 Sink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Join(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Reused(reference_id=[1])
-   +- Reused(reference_id=[2])
++- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiRootsWithReusingDeltaJoin">
+  <TestCase name="testMultiRootsWithReusingJoinView2">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 
 LogicalSink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])(reuse_id=[1])
+Join(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])(reuse_id=[1])
 :- Exchange(distribution=[hash[a1, a2]])
 :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
 +- Exchange(distribution=[hash[b1, b2]])
@@ -741,71 +737,75 @@ Sink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiRootsWithReusingJoinView">
+  <TestCase name="testMultiRootsWithoutReusingDeltaJoin1">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 
 LogicalSink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])(reuse_id=[1])
-:- Exchange(distribution=[hash[a1, a2]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-+- Exchange(distribution=[hash[b1, b2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+Exchange(distribution=[hash[a1, a2]])(reuse_id=[1])
++- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+
+Exchange(distribution=[hash[b1, b2]])(reuse_id=[2])
++- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 
 Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Reused(reference_id=[1])
++- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
+   :- Reused(reference_id=[1])
+   +- Reused(reference_id=[2])
 
 Sink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Reused(reference_id=[1])
++- Join(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Reused(reference_id=[1])
+   +- Reused(reference_id=[2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultiRootsWithReusingJoinView2">
+  <TestCase name="testMultiRootsWithoutReusingDeltaJoin2">
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 
 LogicalSink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
 +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-      +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Join(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])(reuse_id=[1])
-:- Exchange(distribution=[hash[a1, a2]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-+- Exchange(distribution=[hash[b1, b2]])
-   +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+Exchange(distribution=[hash[a1, a2]])(reuse_id=[1])
++- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+
+Exchange(distribution=[hash[b1, b2]])(reuse_id=[2])
++- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 
 Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Reused(reference_id=[1])
++- DeltaJoin(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1])
+   :- Reused(reference_id=[1])
+   +- Reused(reference_id=[2])
 
 Sink(table=[default_catalog.default_database.snk2], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Reused(reference_id=[1])
++- Join(joinType=[InnerJoin], where=[((a1 = b1) AND (a2 = b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Reused(reference_id=[1])
+   +- Reused(reference_id=[2])
 ]]>
     </Resource>
   </TestCase>
@@ -911,40 +911,6 @@ Sink(table=[default_catalog.default_database.snk], targetColumns=[[0],[1],[4],[5
       :     +- TableSourceScan(table=[[default_catalog, default_database, src1, filter=[], project=[a0, a1, a2], metadata=[]]], fields=[a0, a1, a2])
       +- Exchange(distribution=[hash[b1, b2]])
          +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testPartitionPushDown">
-    <Resource name="sql">
-      <![CDATA[
-insert into snk(l0, r0, r2)
-  select a0, b0, b2 from (
-    select a0, a2, a1 from src1WithPartition where pt = 1
-  ) join src2
-  on a1 = b1
-  and a2 = b2
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.snk], targetColumns=[[0],[4],[5]], fields=[a0, EXPR$1, EXPR$2, EXPR$3, b0, b2, EXPR$6])
-+- LogicalProject(a0=[$0], EXPR$1=[null:DOUBLE], EXPR$2=[null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], EXPR$3=[null:INTEGER], b0=[$3], b2=[$4], EXPR$6=[null:DOUBLE])
-   +- LogicalJoin(condition=[AND(=($2, $5), =($1, $4))], joinType=[inner])
-      :- LogicalProject(a0=[$0], a2=[$2], a1=[$1])
-      :  +- LogicalFilter(condition=[=($3, 1)])
-      :     +- LogicalTableScan(table=[[default_catalog, default_database, src1WithPartition]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.snk], targetColumns=[[0],[4],[5]], fields=[a0, EXPR$1, EXPR$2, EXPR$3, b0, b2, EXPR$6])
-+- Calc(select=[a0, null:DOUBLE AS EXPR$1, null:VARCHAR(2147483647) AS EXPR$2, null:INTEGER AS EXPR$3, b0, b2, null:DOUBLE AS EXPR$6])
-   +- DeltaJoin(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a2, a1, b0, b2, b1])
-      :- Exchange(distribution=[hash[a1, a2]])
-      :  +- TableSourceScan(table=[[default_catalog, default_database, src1WithPartition, partitions=[{pt=1}], project=[a0, a2, a1], metadata=[]]], fields=[a0, a2, a1])
-      +- Exchange(distribution=[hash[b1, b2]])
-         +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1025,36 +991,6 @@ Sink(table=[default_catalog.default_database.snk_for_cdc_src], fields=[a0, a1, a
    +- Exchange(distribution=[hash[b1, b2]], changelogMode=[I,UA])
       +- DropUpdateBefore(changelogMode=[I,UA])
          +- TableSourceScan(table=[[default_catalog, default_database, no_delete_src2]], fields=[b0, b2, b1], changelogMode=[I,UB,UA])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithCascadeJoin">
-    <Resource name="sql">
-      <![CDATA[insert into tmp_snk select * from src1 join src2 on src1.a1 = src2.b1 and src1.a2 = src2.b2 join src3 on src1.a1 = src3.b1 and src1.a2 = src3.b2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.tmp_snk], fields=[a0, a1, a2, a3, b0, b2, b1, b00, b20, b10])
-+- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6], b00=[$7], b20=[$8], b10=[$9])
-   +- LogicalJoin(condition=[AND(=($1, $9), =($2, $8))], joinType=[inner])
-      :- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src3]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.tmp_snk], fields=[a0, a1, a2, a3, b0, b2, b1, b00, b20, b10])
-+- Join(joinType=[InnerJoin], where=[AND(=(a1, b10), =(a2, b20))], select=[a0, a1, a2, a3, b0, b2, b1, b00, b20, b10], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a1, a2]])
-   :  +- Join(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :     :- Exchange(distribution=[hash[a1, a2]])
-   :     :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-   :     +- Exchange(distribution=[hash[b1, b2]])
-   :        +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
-   +- Exchange(distribution=[hash[b1, b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, src3]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1079,6 +1015,40 @@ Sink(table=[default_catalog.default_database.snk_for_cdc_src], fields=[a0, a1, a
    :  +- TableSourceScan(table=[[default_catalog, default_database, no_delete_src1]], fields=[a0, a1, a2, a3], changelogMode=[I,UB,UA])
    +- Exchange(distribution=[hash[b0, b1, b2]], changelogMode=[I,UB,UA])
       +- TableSourceScan(table=[[default_catalog, default_database, no_delete_src2]], fields=[b0, b2, b1], changelogMode=[I,UB,UA])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPartitionPushDown">
+    <Resource name="sql">
+      <![CDATA[
+insert into snk(l0, r0, r2)
+  select a0, b0, b2 from (
+    select a0, a2, a1 from src1WithPartition where pt = 1
+  ) join src2
+  on a1 = b1
+  and a2 = b2
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.snk], targetColumns=[[0],[4],[5]], fields=[a0, EXPR$1, EXPR$2, EXPR$3, b0, b2, EXPR$6])
++- LogicalProject(a0=[$0], EXPR$1=[null:DOUBLE], EXPR$2=[null:VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], EXPR$3=[null:INTEGER], b0=[$3], b2=[$4], EXPR$6=[null:DOUBLE])
+   +- LogicalJoin(condition=[AND(=($2, $5), =($1, $4))], joinType=[inner])
+      :- LogicalProject(a0=[$0], a2=[$2], a1=[$1])
+      :  +- LogicalFilter(condition=[=($3, 1)])
+      :     +- LogicalTableScan(table=[[default_catalog, default_database, src1WithPartition]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.snk], targetColumns=[[0],[4],[5]], fields=[a0, EXPR$1, EXPR$2, EXPR$3, b0, b2, EXPR$6])
++- Calc(select=[a0, null:DOUBLE AS EXPR$1, null:VARCHAR(2147483647) AS EXPR$2, null:INTEGER AS EXPR$3, b0, b2, null:DOUBLE AS EXPR$6])
+   +- DeltaJoin(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a2, a1, b0, b2, b1])
+      :- Exchange(distribution=[hash[a1, a2]])
+      :  +- TableSourceScan(table=[[default_catalog, default_database, src1WithPartition, partitions=[{pt=1}], project=[a0, a2, a1], metadata=[]]], fields=[a0, a2, a1])
+      +- Exchange(distribution=[hash[b1, b2]])
+         +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1245,6 +1215,30 @@ Sink(table=[default_catalog.default_database.snk], targetColumns=[[0],[4],[5]],
       :     +- TableSourceScan(table=[[default_catalog, default_database, src1WithMetadata, project=[a2, a1], metadata=[a0]]], fields=[a2, a1, a0])
       +- Exchange(distribution=[hash[b1, b2]])
          +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRetractSink">
+    <Resource name="sql">
+      <![CDATA[insert into retract_snk select * from src1 join src2 on src1.a1 = src2.b1 and src1.a2 = src2.b2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.retract_snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.retract_snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- Join(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a1, a2]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+   +- Exchange(distribution=[hash[b1, b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1323,30 +1317,6 @@ Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b
    :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
    +- Exchange(distribution=[hash[b1, b2]])
       +- TableSourceScan(table=[[default_catalog, default_database, cdc_src]], fields=[b0, b2, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRetractSink">
-    <Resource name="sql">
-      <![CDATA[insert into retract_snk select * from src1 join src2 on src1.a1 = src2.b1 and src1.a2 = src2.b2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.retract_snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.retract_snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Join(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a1, a2]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-   +- Exchange(distribution=[hash[b1, b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1454,6 +1424,36 @@ Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b
    :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
    +- Exchange(distribution=[single])
       +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithCascadeJoin">
+    <Resource name="sql">
+      <![CDATA[insert into tmp_snk select * from src1 join src2 on src1.a1 = src2.b1 and src1.a2 = src2.b2 join src3 on src1.a1 = src3.b1 and src1.a2 = src3.b2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.tmp_snk], fields=[a0, a1, a2, a3, b0, b2, b1, b00, b20, b10])
++- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6], b00=[$7], b20=[$8], b10=[$9])
+   +- LogicalJoin(condition=[AND(=($1, $9), =($2, $8))], joinType=[inner])
+      :- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, src2]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src3]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.tmp_snk], fields=[a0, a1, a2, a3, b0, b2, b1, b00, b20, b10])
++- Join(joinType=[InnerJoin], where=[AND(=(a1, b10), =(a2, b20))], select=[a0, a1, a2, a3, b0, b2, b1, b00, b20, b10], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a1, a2]])
+   :  +- Join(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :     :- Exchange(distribution=[hash[a1, a2]])
+   :     :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+   :     +- Exchange(distribution=[hash[b1, b2]])
+   :        +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+   +- Exchange(distribution=[hash[b1, b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, src3]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1552,30 +1552,6 @@ Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b
    :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
    +- Exchange(distribution=[hash[b1, b2]])
       +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWithoutLookupTable">
-    <Resource name="sql">
-      <![CDATA[insert into snk select * from src1 join non_lookup_src on src1.a1 = non_lookup_src.b1 and src1.a2 = non_lookup_src.b2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
-   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, non_lookup_src]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
-+- Join(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a1, a2]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
-   +- Exchange(distribution=[hash[b1, b2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, non_lookup_src]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
@@ -1603,6 +1579,30 @@ Sink(table=[default_catalog.default_database.tmp_sink], fields=[a0, a1, a2, b0,
    :        +- TableSourceScan(table=[[default_catalog, default_database, wm_source]], fields=[a0, a1, a2])
    +- Exchange(distribution=[hash[b2]])
       +- TableSourceScan(table=[[default_catalog, default_database, src2]], fields=[b0, b2, b1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWithoutLookupTable">
+    <Resource name="sql">
+      <![CDATA[insert into snk select * from src1 join non_lookup_src on src1.a1 = non_lookup_src.b1 and src1.a2 = non_lookup_src.b2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- LogicalProject(a0=[$0], a1=[$1], a2=[$2], a3=[$3], b0=[$4], b2=[$5], b1=[$6])
+   +- LogicalJoin(condition=[AND(=($1, $6), =($2, $5))], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, src1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, non_lookup_src]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.snk], fields=[a0, a1, a2, a3, b0, b2, b1])
++- Join(joinType=[InnerJoin], where=[AND(=(a1, b1), =(a2, b2))], select=[a0, a1, a2, a3, b0, b2, b1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a1, a2]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, src1]], fields=[a0, a1, a2, a3])
+   +- Exchange(distribution=[hash[b1, b2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, non_lookup_src]], fields=[b0, b2, b1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DynamicFunctionPlanTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DynamicFunctionPlanTest.xml
index 15d493d32f8..a8fe2803227 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DynamicFunctionPlanTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DynamicFunctionPlanTest.xml
@@ -38,30 +38,6 @@ GroupAggregate(groupBy=[cat, gmt_date], select=[cat, gmt_date, SUM(cnt) AS EXPR$
 +- Exchange(distribution=[hash[cat, gmt_date]])
    +- Calc(select=[cat, gmt_date, cnt], where=[(gmt_date = CURRENT_DATE())])
       +- TableSourceScan(table=[[default_catalog, default_database, src, filter=[], project=[cat, gmt_date, cnt], metadata=[]]], fields=[cat, gmt_date, cnt])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCalcMerge">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM ( 
-   SELECT *, SUBSTR(CAST(LOCALTIME AS VARCHAR), 1, 2) hh
-   FROM src
- ) t1 WHERE hh > 12 AND cat LIKE 'fruit%'
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[$6])
-+- LogicalFilter(condition=[AND(>(CAST($6):BIGINT, 12), LIKE($2, _UTF-16LE'fruit%'))])
-   +- LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[SUBSTR(CAST(LOCALTIME):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL, 1, 2)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, b, cat, gmt_date, cnt, ts, hh], where=[((CAST(hh AS BIGINT) > 12) AND LIKE(cat, 'fruit%'))])
-+- Calc(select=[a, b, cat, gmt_date, cnt, ts, SUBSTR(CAST(LOCALTIME() AS VARCHAR(2147483647)), 1, 2) AS hh])
-   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[a, b, cat, gmt_date, cnt, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -117,6 +93,30 @@ Calc(select=[gmt_date, ts, 'fruit' AS cat, SUBSTR(CAST(ts AS VARCHAR(2147483647)
    +- Exchange(distribution=[hash[gmt_date, ts]])
       +- Calc(select=[gmt_date, ts, cnt], where=[((gmt_date = CURRENT_DATE()) AND (cat = 'fruit') AND (ts = CURRENT_TIME()))])
          +- TableSourceScan(table=[[default_catalog, default_database, src, filter=[], project=[cat, gmt_date, cnt, ts], metadata=[]]], fields=[cat, gmt_date, cnt, ts])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCalcMerge">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM ( 
+   SELECT *, SUBSTR(CAST(LOCALTIME AS VARCHAR), 1, 2) hh
+   FROM src
+ ) t1 WHERE hh > 12 AND cat LIKE 'fruit%'
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[$6])
++- LogicalFilter(condition=[AND(>(CAST($6):BIGINT, 12), LIKE($2, _UTF-16LE'fruit%'))])
+   +- LogicalProject(a=[$0], b=[$1], cat=[$2], gmt_date=[$3], cnt=[$4], ts=[$5], hh=[SUBSTR(CAST(LOCALTIME):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL, 1, 2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, cat, gmt_date, cnt, ts, hh], where=[((CAST(hh AS BIGINT) > 12) AND LIKE(cat, 'fruit%'))])
++- Calc(select=[a, b, cat, gmt_date, cnt, ts, SUBSTR(CAST(LOCALTIME() AS VARCHAR(2147483647)), 1, 2) AS hh])
+   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[a, b, cat, gmt_date, cnt, ts])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/FilterableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/FilterableSourceTest.xml
index 1316694494e..7f29b56ef83 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/FilterableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/FilterableSourceTest.xml
@@ -16,116 +16,116 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testFullFilterMatchWithWatermark">
+  <TestCase name="testComputedColumnPushdownAcrossWatermark">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE LOWER(d) = 'hello']]>
+      <![CDATA[SELECT * FROM WithWatermark WHERE lowercase_name = 'foo']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-+- LogicalFilter(condition=[=(LOWER($3), _UTF-16LE'hello')])
-   +- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(event_time=[$0], name=[$1], lowercase_name=[$2])
++- LogicalFilter(condition=[=($2, _UTF-16LE'foo')])
+   +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$0])
+      +- LogicalProject(event_time=[$0], name=[$1], lowercase_name=[LOWER($1)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, WithWatermark]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[c], watermarkEmitStrategy=[on-periodic], filter=[=(LOWER(d), _UTF-16LE'hello':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[a, b, c, d])
+Calc(select=[Reinterpret(event_time) AS event_time, name, CAST('foo' AS VARCHAR(2147483647)) AS lowercase_name])
++- TableSourceScan(table=[[default_catalog, default_database, WithWatermark, watermark=[event_time], watermarkEmitStrategy=[on-periodic], filter=[=(LOWER(name), _UTF-16LE'foo':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[event_time, name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPartialFilterMatchWithWatermark">
+  <TestCase name="testFilterPushdownWithUdf">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE LOWER(d) = 'h' AND d IS NOT NULL]]>
+      <![CDATA[SELECT * FROM UdfTable WHERE UPPER(f) = 'welcome']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-+- LogicalFilter(condition=[AND(=(LOWER($3), _UTF-16LE'h'), IS NOT NULL($3))])
-   +- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], f=[$4])
++- LogicalFilter(condition=[=(UPPER($4), _UTF-16LE'welcome')])
+   +- LogicalWatermarkAssigner(rowtime=[c], watermark=[func(func($3, $0), $0)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[func($2, $0)], f=[$3])
+         +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c, d], where=[d IS NOT NULL])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[c], watermarkEmitStrategy=[on-periodic], filter=[=(LOWER(d), _UTF-16LE'h':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[a, b, c, d])
+Calc(select=[a, b, Reinterpret(c) AS c, func(c, a) AS d, f])
++- TableSourceScan(table=[[default_catalog, default_database, UdfTable, watermark=[func(func(func(c, a), a), a)], watermarkEmitStrategy=[on-periodic], filter=[=(UPPER(f), _UTF-16LE'welcome':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[a, b, c, f])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNoFilterMatchWithWatermark">
+  <TestCase name="testFullFilterMatchWithWatermark">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable WHERE b > 5]]>
+      <![CDATA[SELECT * FROM MyTable WHERE LOWER(d) = 'hello']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-+- LogicalFilter(condition=[>($1, 5)])
++- LogicalFilter(condition=[=(LOWER($3), _UTF-16LE'hello')])
    +- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c, d], where=[(b > 5)])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[c], watermarkEmitStrategy=[on-periodic], filter=[]]], fields=[a, b, c, d])
+TableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[c], watermarkEmitStrategy=[on-periodic], filter=[=(LOWER(d), _UTF-16LE'hello':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testComputedColumnPushdownAcrossWatermark">
+  <TestCase name="testFullPushdownWithoutWatermarkAssigner">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM WithWatermark WHERE lowercase_name = 'foo']]>
+      <![CDATA[SELECT * FROM NoWatermark WHERE LOWER(name) = 'foo' AND UPPER(name) = 'FOO']]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(event_time=[$0], name=[$1], lowercase_name=[$2])
-+- LogicalFilter(condition=[=($2, _UTF-16LE'foo')])
-   +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$0])
-      +- LogicalProject(event_time=[$0], name=[$1], lowercase_name=[LOWER($1)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, WithWatermark]])
+LogicalProject(name=[$0], event_time=[$1])
++- LogicalFilter(condition=[AND(=(LOWER($0), _UTF-16LE'foo'), =(UPPER($0), _UTF-16LE'FOO'))])
+   +- LogicalTableScan(table=[[default_catalog, default_database, NoWatermark]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[Reinterpret(event_time) AS event_time, name, CAST('foo' AS VARCHAR(2147483647)) AS lowercase_name])
-+- TableSourceScan(table=[[default_catalog, default_database, WithWatermark, watermark=[event_time], watermarkEmitStrategy=[on-periodic], filter=[=(LOWER(name), _UTF-16LE'foo':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[event_time, name])
+TableSourceScan(table=[[default_catalog, default_database, NoWatermark, filter=[and(=(LOWER(name), _UTF-16LE'foo':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), =(UPPER(name), _UTF-16LE'FOO':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"))]]], fields=[name, event_time])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testFullPushdownWithoutWatermarkAssigner">
+  <TestCase name="testNoFilterMatchWithWatermark">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM NoWatermark WHERE LOWER(name) = 'foo' AND UPPER(name) = 'FOO']]>
+      <![CDATA[SELECT * FROM MyTable WHERE b > 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], event_time=[$1])
-+- LogicalFilter(condition=[AND(=(LOWER($0), _UTF-16LE'foo'), =(UPPER($0), _UTF-16LE'FOO'))])
-   +- LogicalTableScan(table=[[default_catalog, default_database, NoWatermark]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
++- LogicalFilter(condition=[>($1, 5)])
+   +- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[default_catalog, default_database, NoWatermark, filter=[and(=(LOWER(name), _UTF-16LE'foo':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"), =(UPPER(name), _UTF-16LE'FOO':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"))]]], fields=[name, event_time])
+Calc(select=[a, b, c, d], where=[(b > 5)])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[c], watermarkEmitStrategy=[on-periodic], filter=[]]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testFilterPushdownWithUdf">
+  <TestCase name="testPartialFilterMatchWithWatermark">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM UdfTable WHERE UPPER(f) = 'welcome']]>
+      <![CDATA[SELECT * FROM MyTable WHERE LOWER(d) = 'h' AND d IS NOT NULL]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], f=[$4])
-+- LogicalFilter(condition=[=(UPPER($4), _UTF-16LE'welcome')])
-   +- LogicalWatermarkAssigner(rowtime=[c], watermark=[func(func($3, $0), $0)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[func($2, $0)], f=[$3])
-         +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
++- LogicalFilter(condition=[AND(=(LOWER($3), _UTF-16LE'h'), IS NOT NULL($3))])
+   +- LogicalWatermarkAssigner(rowtime=[c], watermark=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, Reinterpret(c) AS c, func(c, a) AS d, f])
-+- TableSourceScan(table=[[default_catalog, default_database, UdfTable, watermark=[func(func(func(c, a), a), a)], watermarkEmitStrategy=[on-periodic], filter=[=(UPPER(f), _UTF-16LE'welcome':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[a, b, c, f])
+Calc(select=[a, b, c, d], where=[d IS NOT NULL])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable, watermark=[c], watermarkEmitStrategy=[on-periodic], filter=[=(LOWER(d), _UTF-16LE'h':VARCHAR(2147483647) CHARACTER SET "UTF-16LE")]]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/InsertIntoValuesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/InsertIntoValuesTest.xml
index a10cc2f3f5f..716fe8fa273 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/InsertIntoValuesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/InsertIntoValuesTest.xml
@@ -16,9 +16,12 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testTypeInferenceWithNestedTypes">
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testTypeInferenceWithNestedTypes">
+    <Resource name="sql">
+      <![CDATA[INSERT INTO t1 VALUES (MAP['a', '123', 'b', '123456'], MAP['k1', X'C0FFEE', 'k2', X'BABE']), (CAST(NULL AS MAP<STRING, STRING>), CAST(NULL AS MAP<STRING, BYTES>)), (MAP['a', '1', 'b', '1'], MAP['k1', X'10', 'k2', X'20'])]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.t1], fields=[EXPR$0, EXPR$1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(EXPR$0=[MAP(_UTF-16LE'a', _UTF-16LE'123':VARCHAR(6) CHARACTER SET "UTF-16LE", _UTF-16LE'b', _UTF-16LE'123456':VARCHAR(6) CHARACTER SET "UTF-16LE")], EXPR$1=[MAP(_UTF-16LE'k1', X'c0ffee':VARBINARY(3), _UTF-16LE'k2', X'babe':VARBINARY(3))])
@@ -28,9 +31,9 @@ LogicalSink(table=[default_catalog.default_database.t1], fields=[EXPR$0, EXPR$1]
    +- LogicalProject(EXPR$0=[MAP(_UTF-16LE'a', _UTF-16LE'1', _UTF-16LE'b', _UTF-16LE'1')], EXPR$1=[MAP(_UTF-16LE'k1', X'10':BINARY(1), _UTF-16LE'k2', X'20':BINARY(1))])
       +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.t1], fields=[EXPR$0, EXPR$1])
 +- Union(all=[true], union=[EXPR$0, EXPR$1])
    :- Calc(select=[CAST(MAP('a', '123', 'b', '123456') AS (VARCHAR(2147483647), VARCHAR(2147483647)) MAP) AS EXPR$0, CAST(MAP('k1', X'c0ffee', 'k2', X'babe') AS (VARCHAR(2147483647), VARBINARY(2147483647)) MAP) AS EXPR$1])
@@ -40,18 +43,6 @@ Sink(table=[default_catalog.default_database.t1], fields=[EXPR$0, EXPR$1])
    +- Calc(select=[CAST(MAP('a', '1', 'b', '1') AS (VARCHAR(2147483647), VARCHAR(2147483647)) MAP) AS EXPR$0, CAST(MAP('k1', X'10', 'k2', X'20') AS (VARCHAR(2147483647), VARBINARY(2147483647)) MAP) AS EXPR$1])
       +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Sink(table=[default_catalog.default_database.t1], fields=[EXPR$0, EXPR$1])
-+- Union(all=[true], union=[EXPR$0, EXPR$1])
-   :- Calc(select=[CAST(MAP('a', '123', 'b', '123456') AS (VARCHAR(2147483647), VARCHAR(2147483647)) MAP) AS EXPR$0, CAST(MAP('k1', X'c0ffee', 'k2', X'babe') AS (VARCHAR(2147483647), VARBINARY(2147483647)) MAP) AS EXPR$1])
-   :  +- Values(tuples=[[{ 0 }]])(reuse_id=[1])
-   :- Calc(select=[null:(VARCHAR(2147483647), VARCHAR(2147483647)) MAP AS EXPR$0, null:(VARCHAR(2147483647), VARBINARY(2147483647)) MAP AS EXPR$1])
-   :  +- Reused(reference_id=[1])
-   +- Calc(select=[CAST(MAP('a', '1', 'b', '1') AS (VARCHAR(2147483647), VARCHAR(2147483647)) MAP) AS EXPR$0, CAST(MAP('k1', X'10', 'k2', X'20') AS (VARCHAR(2147483647), VARBINARY(2147483647)) MAP) AS EXPR$1])
-      +- Reused(reference_id=[1])
-]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitTest.xml
index cebecf24ca1..d14405bdded 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitTest.xml
@@ -104,23 +104,6 @@ LogicalSort(offset=[0], fetch=[0])
     <Resource name="optimized exec plan">
       <![CDATA[
 Values(tuples=[[]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLimit0WithoutOffset">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable LIMIT 0]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSort(fetch=[0])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
@@ -260,33 +243,30 @@ Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithOffset">
+  <TestCase name="testLimit0WithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 1]]>
+      <![CDATA[SELECT * FROM MyTable LIMIT 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[1], fetch=[10])
-+- LogicalProject(a=[$0], c=[$2])
+LogicalSort(fetch=[0])
++- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, c])
-+- Limit(offset=[1], fetch=[10])
-   +- Exchange(distribution=[single])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithOffset0">
+  <TestCase name="testLimitWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 0]]>
+      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[0], fetch=[10])
+LogicalSort(offset=[1], fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -294,27 +274,27 @@ LogicalSort(offset=[0], fetch=[10])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, c])
-+- Limit(offset=[0], fetch=[10])
++- Limit(offset=[1], fetch=[10])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithoutOffset">
+  <TestCase name="testLimitWithOffset0">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable LIMIT 5]]>
+      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(fetch=[5])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
+LogicalSort(offset=[0], fetch=[10])
++- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime])
-+- Limit(offset=[0], fetch=[5])
+Calc(select=[a, c])
++- Limit(offset=[0], fetch=[10])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
@@ -480,40 +460,40 @@ Calc(select=[c, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOffsetWithProcessingTime">
+  <TestCase name="testLimitWithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT proctime, c FROM MyTable OFFSET 2]]>
+      <![CDATA[SELECT * FROM MyTable LIMIT 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[2])
-+- LogicalProject(proctime=[$3], c=[$2])
+LogicalSort(fetch=[5])
++- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[PROCTIME_MATERIALIZE(proctime) AS proctime, c])
-+- Limit(offset=[2], fetch=[unlimited])
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime])
++- Limit(offset=[0], fetch=[5])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOffsetWithRowTimeDesc">
+  <TestCase name="testOffsetWithProcessingTime">
     <Resource name="sql">
-      <![CDATA[SELECT rowtime desc, c FROM MyTable OFFSET 2]]>
+      <![CDATA[SELECT proctime, c FROM MyTable OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSort(offset=[2])
-+- LogicalProject(desc=[$4], c=[$2])
++- LogicalProject(proctime=[$3], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[rowtime AS desc, c])
+Calc(select=[PROCTIME_MATERIALIZE(proctime) AS proctime, c])
 +- Limit(offset=[2], fetch=[unlimited])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
@@ -600,41 +580,41 @@ Calc(select=[rowtime, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOffsetWithRowTimeDescSecond">
+  <TestCase name="testOffsetWithRowTimeDesc">
     <Resource name="sql">
-      <![CDATA[SELECT c, rowtime desc FROM MyTable OFFSET 2]]>
+      <![CDATA[SELECT rowtime desc, c FROM MyTable OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSort(offset=[2])
-+- LogicalProject(c=[$2], desc=[$4])
++- LogicalProject(desc=[$4], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, rowtime AS desc])
+Calc(select=[rowtime AS desc, c])
 +- Limit(offset=[2], fetch=[unlimited])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyOffset">
+  <TestCase name="testOffsetWithRowTimeDescSecond">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable OFFSET 10 ROWS]]>
+      <![CDATA[SELECT c, rowtime desc FROM MyTable OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[10])
-+- LogicalProject(a=[$0], c=[$2])
+LogicalSort(offset=[2])
++- LogicalProject(c=[$2], desc=[$4])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, c])
-+- Limit(offset=[10], fetch=[unlimited])
+Calc(select=[c, rowtime AS desc])
++- Limit(offset=[2], fetch=[unlimited])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
@@ -657,6 +637,26 @@ Calc(select=[c, rowtime])
 +- Limit(offset=[2], fetch=[unlimited])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOnlyOffset">
+    <Resource name="sql">
+      <![CDATA[SELECT a, c FROM MyTable OFFSET 10 ROWS]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSort(offset=[10])
++- LogicalProject(a=[$0], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, c])
++- Limit(offset=[10], fetch=[unlimited])
+   +- Exchange(distribution=[single])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitableSourceTest.xml
index a4887179851..d87c52c36f5 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/LimitableSourceTest.xml
@@ -102,23 +102,6 @@ LogicalSort(offset=[0], fetch=[0])
     <Resource name="optimized exec plan">
       <![CDATA[
 Values(tuples=[[]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLimit0WithoutOffset">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable LIMIT 0]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSort(fetch=[0])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
@@ -258,60 +241,58 @@ Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithOffset">
+  <TestCase name="testLimit0WithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 1]]>
+      <![CDATA[SELECT * FROM MyTable LIMIT 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[1], fetch=[10])
-+- LogicalProject(a=[$0], c=[$2])
+LogicalSort(fetch=[0])
++- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Limit(offset=[1], fetch=[10])
-+- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[], limit=[11]]], fields=[a, c])
+Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithOffset0">
+  <TestCase name="testLimitWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 0]]>
+      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[0], fetch=[10])
+LogicalSort(offset=[1], fetch=[10])
 +- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Limit(offset=[0], fetch=[10])
+Limit(offset=[1], fetch=[10])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[], limit=[10]]], fields=[a, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[], limit=[11]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLimitWithoutOffset">
+  <TestCase name="testLimitWithOffset0">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable LIMIT 5]]>
+      <![CDATA[SELECT a, c FROM MyTable LIMIT 10 OFFSET 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(fetch=[5])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
+LogicalSort(offset=[0], fetch=[10])
++- LogicalProject(a=[$0], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Limit(offset=[0], fetch=[5])
+Limit(offset=[0], fetch=[10])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, limit=[5]]], fields=[a, b, c, proctime, rowtime])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[], limit=[10]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
@@ -467,33 +448,33 @@ Limit(offset=[0], fetch=[2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOffsetWithProcessingTime">
+  <TestCase name="testLimitWithoutOffset">
     <Resource name="sql">
-      <![CDATA[SELECT proctime, c FROM MyTable OFFSET 2]]>
+      <![CDATA[SELECT * FROM MyTable LIMIT 5]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[2])
-+- LogicalProject(proctime=[$3], c=[$2])
+LogicalSort(fetch=[5])
++- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Limit(offset=[2], fetch=[unlimited])
+Limit(offset=[0], fetch=[5])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[proctime, c], metadata=[]]], fields=[proctime, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, limit=[5]]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOffsetWithRowTimeDesc">
+  <TestCase name="testOffsetWithProcessingTime">
     <Resource name="sql">
-      <![CDATA[SELECT rowtime desc, c FROM MyTable OFFSET 2]]>
+      <![CDATA[SELECT proctime, c FROM MyTable OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSort(offset=[2])
-+- LogicalProject(desc=[$4], c=[$2])
++- LogicalProject(proctime=[$3], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
@@ -501,7 +482,7 @@ LogicalSort(offset=[2])
       <![CDATA[
 Limit(offset=[2], fetch=[unlimited])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[rowtime, c], metadata=[]]], fields=[rowtime, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[proctime, c], metadata=[]]], fields=[proctime, c])
 ]]>
     </Resource>
   </TestCase>
@@ -581,14 +562,14 @@ Limit(offset=[2], fetch=[unlimited])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOffsetWithRowTimeDescSecond">
+  <TestCase name="testOffsetWithRowTimeDesc">
     <Resource name="sql">
-      <![CDATA[SELECT c, rowtime desc FROM MyTable OFFSET 2]]>
+      <![CDATA[SELECT rowtime desc, c FROM MyTable OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSort(offset=[2])
-+- LogicalProject(c=[$2], desc=[$4])
++- LogicalProject(desc=[$4], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
@@ -596,26 +577,26 @@ LogicalSort(offset=[2])
       <![CDATA[
 Limit(offset=[2], fetch=[unlimited])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[c, rowtime], metadata=[]]], fields=[c, rowtime])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[rowtime, c], metadata=[]]], fields=[rowtime, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnlyOffset">
+  <TestCase name="testOffsetWithRowTimeDescSecond">
     <Resource name="sql">
-      <![CDATA[SELECT a, c FROM MyTable OFFSET 10 ROWS]]>
+      <![CDATA[SELECT c, rowtime desc FROM MyTable OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSort(offset=[10])
-+- LogicalProject(a=[$0], c=[$2])
+LogicalSort(offset=[2])
++- LogicalProject(c=[$2], desc=[$4])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Limit(offset=[10], fetch=[unlimited])
+Limit(offset=[2], fetch=[unlimited])
 +- Exchange(distribution=[single])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]], fields=[a, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[c, rowtime], metadata=[]]], fields=[c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -635,6 +616,25 @@ LogicalSort(offset=[2])
 Limit(offset=[2], fetch=[unlimited])
 +- Exchange(distribution=[single])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[c, rowtime], metadata=[]]], fields=[c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOnlyOffset">
+    <Resource name="sql">
+      <![CDATA[SELECT a, c FROM MyTable OFFSET 10 ROWS]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSort(offset=[10])
++- LogicalProject(a=[$0], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Limit(offset=[10], fetch=[unlimited])
++- Exchange(distribution=[single])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c], metadata=[]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MLPredictTableFunctionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MLPredictTableFunctionTest.xml
index 09b142825ac..b4f8876ce50 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MLPredictTableFunctionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MLPredictTableFunctionTest.xml
@@ -866,15 +866,15 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, c0
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIllegalConfig">
+  <TestCase name="testInputTableIsInsertOnlyStream">
     <Resource name="sql">
       <![CDATA[SELECT *
-FROM TABLE(ML_PREDICT(TABLE MyTable, MODEL MyModel, DESCRIPTOR(a, b), MAP['async', 'true']))]]>
+FROM TABLE(ML_PREDICT(TABLE MyTable, MODEL MyModel, DESCRIPTOR(a, b)))]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$6], f=[$7])
-+- LogicalTableFunctionScan(invocation=[ML_PREDICT(TABLE(#0), Model(MODEL default_catalog.default_database.MyModel), DESCRIPTOR(_UTF-16LE'a', _UTF-16LE'b'), MAP(_UTF-16LE'async', _UTF-16LE'true'))], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) e, INTEGER ARRAY f)])
++- LogicalTableFunctionScan(invocation=[ML_PREDICT(TABLE(#0), Model(MODEL default_catalog.default_database.MyModel), DESCRIPTOR(_UTF-16LE'a', _UTF-16LE'b'), DEFAULT())], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) e, INTEGER ARRAY f)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -883,11 +883,11 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f])
-+- MLPredictTableFunction(invocation=[ML_PREDICT(TABLE(#0), Model(MODEL default_catalog.default_database.MyModel), DESCRIPTOR(_UTF-16LE'a', _UTF-16LE'b'), MAP(_UTF-16LE'async', _UTF-16LE'true'))], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) e, INTEGER ARRAY f)])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f], changelogMode=[I])
++- MLPredictTableFunction(invocation=[ML_PREDICT(TABLE(#0), Model(MODEL default_catalog.default_database.MyModel), DESCRIPTOR(_UTF-16LE'a', _UTF-16LE'b'), DEFAULT())], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) e, INTEGER ARRAY f)], changelogMode=[I])
+   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I])
+      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -913,31 +913,6 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e,
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testInputTableIsInsertOnlyStream">
-    <Resource name="sql">
-      <![CDATA[SELECT *
-FROM TABLE(ML_PREDICT(TABLE MyTable, MODEL MyModel, DESCRIPTOR(a, b)))]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$6], f=[$7])
-+- LogicalTableFunctionScan(invocation=[ML_PREDICT(TABLE(#0), Model(MODEL default_catalog.default_database.MyModel), DESCRIPTOR(_UTF-16LE'a', _UTF-16LE'b'), DEFAULT())], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) e, INTEGER ARRAY f)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
-      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f], changelogMode=[I])
-+- MLPredictTableFunction(invocation=[ML_PREDICT(TABLE(#0), Model(MODEL default_catalog.default_database.MyModel), DESCRIPTOR(_UTF-16LE'a', _UTF-16LE'b'), DEFAULT())], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) e, INTEGER ARRAY f)], changelogMode=[I])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I])
-      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml
index 3331876c2bd..f1c3ad35fb0 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml
@@ -124,40 +124,6 @@ Calc(select=[symbol, price, CAST(w$rowtime AS TIMESTAMP(3) *ROWTIME*) AS rowTime
             +- Exchange(distribution=[hash[symbol]])
                +- WatermarkAssigner(rowtime=[ts], watermark=[-(ts, 1000:INTERVAL SECOND)])
                   +- TableSourceScan(table=[[default_catalog, default_database, Ticker1]], fields=[symbol, ts, price, tax])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOverWindowOnMatchRecognizeOnRowtimeLTZ">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-  symbol,
-  price,
-  tax,
-  matchRowtime,
-  SUM(price) OVER (
-    PARTITION BY symbol ORDER BY matchRowtime RANGE UNBOUNDED PRECEDING) as price_sum
-FROM T
-    ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3], price_sum=[CASE(>(COUNT($1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST), 0), $SUM0($1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST), null:INTEGER)]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, INTEGER price_sum)]
-+- LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-   +- LogicalMatch(partition=[[0]], order=[[1 ASC-nulls-first]], outputFields=[[symbol, price, tax, matchRowtime]], allRows=[false], after=[FLAG(SKIP TO NEXT ROW)], pattern=[_UTF-16LE'A'], isStrictStarts=[false], isStrictEnds=[false], subsets=[[]], patternDefinitions=[[>(PREV(A.$2, 0), 0)]], inputFields=[[symbol, ts_ltz, price, tax]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-      +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($1, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, Ticker]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[symbol, price, tax, matchRowtime, CASE(>(w0$o0, 0), w0$o1, null:INTEGER) AS price_sum]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, INTEGER price_sum)]
-+- OverAggregate(partitionBy=[symbol], orderBy=[matchRowtime ASC], window=[ RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[symbol, price, tax, matchRowtime, COUNT(price) AS w0$o0, $SUM0(price) AS w0$o1]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, BIGINT w0$o0, INTEGER w0$o1)]
-   +- Exchange(distribution=[hash[symbol]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-      +- Match(partitionBy=[symbol], orderBy=[ts_ltz ASC], measures=[FINAL(A.price) AS price, FINAL(A.tax) AS tax, FINAL(MATCH_ROWTIME(*.ts_ltz)) AS matchRowtime], rowsPerMatch=[ONE ROW PER MATCH], after=[SKIP TO NEXT ROW], pattern=[_UTF-16LE'A'], define=[{A=>(PREV(A.$2, 0), 0)}]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-         +- Exchange(distribution=[hash[symbol]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
-            +- WatermarkAssigner(rowtime=[ts_ltz], watermark=[-(ts_ltz, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
-               +- TableSourceScan(table=[[default_catalog, default_database, Ticker]], fields=[symbol, ts_ltz, price, tax]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
 ]]>
     </Resource>
   </TestCase>
@@ -205,6 +171,40 @@ Calc(select=[symbol, price, w$rowtime AS rowTime, w$start AS startTime])
             +- Exchange(distribution=[hash[symbol]])
                +- WatermarkAssigner(rowtime=[ts_ltz], watermark=[-(ts_ltz, 1000:INTERVAL SECOND)])
                   +- TableSourceScan(table=[[default_catalog, default_database, Ticker]], fields=[symbol, ts_ltz, price, tax])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testOverWindowOnMatchRecognizeOnRowtimeLTZ">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+  symbol,
+  price,
+  tax,
+  matchRowtime,
+  SUM(price) OVER (
+    PARTITION BY symbol ORDER BY matchRowtime RANGE UNBOUNDED PRECEDING) as price_sum
+FROM T
+    ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3], price_sum=[CASE(>(COUNT($1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST), 0), $SUM0($1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST), null:INTEGER)]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, INTEGER price_sum)]
++- LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+   +- LogicalMatch(partition=[[0]], order=[[1 ASC-nulls-first]], outputFields=[[symbol, price, tax, matchRowtime]], allRows=[false], after=[FLAG(SKIP TO NEXT ROW)], pattern=[_UTF-16LE'A'], isStrictStarts=[false], isStrictEnds=[false], subsets=[[]], patternDefinitions=[[>(PREV(A.$2, 0), 0)]], inputFields=[[symbol, ts_ltz, price, tax]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+      +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($1, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, Ticker]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[symbol, price, tax, matchRowtime, CASE(>(w0$o0, 0), w0$o1, null:INTEGER) AS price_sum]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, INTEGER price_sum)]
++- OverAggregate(partitionBy=[symbol], orderBy=[matchRowtime ASC], window=[ RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[symbol, price, tax, matchRowtime, COUNT(price) AS w0$o0, $SUM0(price) AS w0$o1]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, BIGINT w0$o0, INTEGER w0$o1)]
+   +- Exchange(distribution=[hash[symbol]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+      +- Match(partitionBy=[symbol], orderBy=[ts_ltz ASC], measures=[FINAL(A.price) AS price, FINAL(A.tax) AS tax, FINAL(MATCH_ROWTIME(*.ts_ltz)) AS matchRowtime], rowsPerMatch=[ONE ROW PER MATCH], after=[SKIP TO NEXT ROW], pattern=[_UTF-16LE'A'], define=[{A=>(PREV(A.$2, 0), 0)}]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+         +- Exchange(distribution=[hash[symbol]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
+            +- WatermarkAssigner(rowtime=[ts_ltz], watermark=[-(ts_ltz, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
+               +- TableSourceScan(table=[[default_catalog, default_database, Ticker]], fields=[symbol, ts_ltz, price, tax]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml
index d6e9667c44c..ab37dca0345 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml
@@ -474,6 +474,32 @@ GlobalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT(count$0) AS EXPR$1])
             +- Exchange(distribution=[hash[long]])
                +- MiniBatchAssigner(interval=[3000ms], mode=[RowTime])
                   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, str, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRedundantWatermarkDefinition">
+    <Resource name="sql">
+      <![CDATA[SELECT b, COUNT(DISTINCT a), MAX(b), SUM(c) FROM wmTable1 GROUP BY b]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[MAX($0)], EXPR$3=[SUM($2)])
++- LogicalProject(b=[$1], a=[$0], c=[$2])
+   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+         +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GlobalGroupAggregate(groupBy=[b], select=[b, COUNT(distinct$0 count$0) AS EXPR$1, MAX(max$1) AS EXPR$2, SUM(sum$2) AS EXPR$3])
++- Exchange(distribution=[hash[b]])
+   +- LocalGroupAggregate(groupBy=[b], select=[b, COUNT(distinct$0 a) AS count$0, MAX(b) AS max$1, SUM(c) AS sum$2, DISTINCT(a) AS distinct$0])
+      +- Calc(select=[b, a, c])
+         +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+               +- Calc(select=[b, a, c, rowtime])
+                  +- TableSourceScan(table=[[default_catalog, default_database, wmTable1]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -510,32 +536,6 @@ GlobalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT(count$0) AS EXPR$1])
                +- MiniBatchAssigner(interval=[1000ms], mode=[RowTime])
                   +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
                      +- TableSourceScan(table=[[default_catalog, default_database, wmTable1, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRedundantWatermarkDefinition">
-    <Resource name="sql">
-      <![CDATA[SELECT b, COUNT(DISTINCT a), MAX(b), SUM(c) FROM wmTable1 GROUP BY b]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[MAX($0)], EXPR$3=[SUM($2)])
-+- LogicalProject(b=[$1], a=[$0], c=[$2])
-   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-         +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GlobalGroupAggregate(groupBy=[b], select=[b, COUNT(distinct$0 count$0) AS EXPR$1, MAX(max$1) AS EXPR$2, SUM(sum$2) AS EXPR$3])
-+- Exchange(distribution=[hash[b]])
-   +- LocalGroupAggregate(groupBy=[b], select=[b, COUNT(distinct$0 a) AS count$0, MAX(b) AS max$1, SUM(c) AS sum$2, DISTINCT(a) AS distinct$0])
-      +- Calc(select=[b, a, c])
-         +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-               +- Calc(select=[b, a, c, rowtime])
-                  +- TableSourceScan(table=[[default_catalog, default_database, wmTable1]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ModifiedMonotonicityTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ModifiedMonotonicityTest.xml
index 34ff420acdb..64b5dbb6381 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ModifiedMonotonicityTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ModifiedMonotonicityTest.xml
@@ -16,9 +16,9 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testMaxWithRetractOptimizeWithLocalGlobal">
+  <TestCase name="testMaxWithRetractOptimize">
     <Resource name="sql">
-      <![CDATA[SELECT a1, max(a3) from (SELECT a1, a2, max(a3) as a3 FROM A GROUP BY a1, a2) group by a1]]>
+      <![CDATA[SELECT a1, MAX(a3) FROM (SELECT a1, a2, MAX(a3) AS a3 FROM A GROUP BY a1, a2) t GROUP BY a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
@@ -30,21 +30,18 @@ LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GlobalGroupAggregate(groupBy=[a1], select=[a1, MAX(max$0) AS EXPR$1], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[a1]], changelogMode=[I])
-   +- LocalGroupAggregate(groupBy=[a1], select=[a1, MAX(a3) AS max$0, COUNT_RETRACT(*) AS count1$1], changelogMode=[I])
-      +- Calc(select=[a1, a3], changelogMode=[I,UB,UA])
-         +- GlobalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MAX(max$0) AS a3], changelogMode=[I,UB,UA])
-            +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
-               +- LocalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MAX(a3) AS max$0], changelogMode=[I])
-                  +- MiniBatchAssigner(interval=[100ms], mode=[ProcTime], changelogMode=[I])
-                     +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
+GroupAggregate(groupBy=[a1], select=[a1, MAX(a3) AS EXPR$1], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[a1]], changelogMode=[I,UB,UA])
+   +- Calc(select=[a1, a3], changelogMode=[I,UB,UA])
+      +- GroupAggregate(groupBy=[a1, a2], select=[a1, a2, MAX(a3) AS a3], changelogMode=[I,UB,UA])
+         +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
+            +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMaxWithRetractOptimize">
+  <TestCase name="testMaxWithRetractOptimizeWithLocalGlobal">
     <Resource name="sql">
-      <![CDATA[SELECT a1, MAX(a3) FROM (SELECT a1, a2, MAX(a3) AS a3 FROM A GROUP BY a1, a2) t GROUP BY a1]]>
+      <![CDATA[SELECT a1, max(a3) from (SELECT a1, a2, max(a3) as a3 FROM A GROUP BY a1, a2) group by a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
@@ -56,12 +53,15 @@ LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GroupAggregate(groupBy=[a1], select=[a1, MAX(a3) AS EXPR$1], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[a1]], changelogMode=[I,UB,UA])
-   +- Calc(select=[a1, a3], changelogMode=[I,UB,UA])
-      +- GroupAggregate(groupBy=[a1, a2], select=[a1, a2, MAX(a3) AS a3], changelogMode=[I,UB,UA])
-         +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
-            +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
+GlobalGroupAggregate(groupBy=[a1], select=[a1, MAX(max$0) AS EXPR$1], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[a1]], changelogMode=[I])
+   +- LocalGroupAggregate(groupBy=[a1], select=[a1, MAX(a3) AS max$0, COUNT_RETRACT(*) AS count1$1], changelogMode=[I])
+      +- Calc(select=[a1, a3], changelogMode=[I,UB,UA])
+         +- GlobalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MAX(max$0) AS a3], changelogMode=[I,UB,UA])
+            +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
+               +- LocalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MAX(a3) AS max$0], changelogMode=[I])
+                  +- MiniBatchAssigner(interval=[100ms], mode=[ProcTime], changelogMode=[I])
+                     +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -114,52 +114,52 @@ GlobalGroupAggregate(groupBy=[a1], select=[a1, MIN_RETRACT(min$0) AS EXPR$1], ch
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMinWithRetractOptimizeWithLocalGlobal">
+  <TestCase name="testMinWithRetractOptimize">
     <Resource name="sql">
-      <![CDATA[SELECT min(a3) from (SELECT a1, a2, min(a3) as a3 FROM A GROUP BY a1, a2)]]>
+      <![CDATA[SELECT a1, MIN(a3) FROM (SELECT a1, a2, MIN(a3) AS a3 FROM A GROUP BY a1, a2) t GROUP BY a1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
-+- LogicalProject(a3=[$2])
+LogicalAggregate(group=[{0}], EXPR$1=[MIN($1)])
++- LogicalProject(a1=[$0], a3=[$2])
    +- LogicalAggregate(group=[{0, 1}], a3=[MIN($2)])
       +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GlobalGroupAggregate(select=[MIN(min$0) AS EXPR$0], changelogMode=[I,UA,D])
-+- Exchange(distribution=[single], changelogMode=[I])
-   +- LocalGroupAggregate(select=[MIN(a3) AS min$0, COUNT_RETRACT(*) AS count1$1], changelogMode=[I])
-      +- Calc(select=[a3], changelogMode=[I,UB,UA])
-         +- GlobalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MIN(min$0) AS a3], changelogMode=[I,UB,UA])
-            +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
-               +- LocalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MIN(a3) AS min$0], changelogMode=[I])
-                  +- MiniBatchAssigner(interval=[100ms], mode=[ProcTime], changelogMode=[I])
-                     +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
+GroupAggregate(groupBy=[a1], select=[a1, MIN(a3) AS EXPR$1], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[a1]], changelogMode=[I,UB,UA])
+   +- Calc(select=[a1, a3], changelogMode=[I,UB,UA])
+      +- GroupAggregate(groupBy=[a1, a2], select=[a1, a2, MIN(a3) AS a3], changelogMode=[I,UB,UA])
+         +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
+            +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMinWithRetractOptimize">
+  <TestCase name="testMinWithRetractOptimizeWithLocalGlobal">
     <Resource name="sql">
-      <![CDATA[SELECT a1, MIN(a3) FROM (SELECT a1, a2, MIN(a3) AS a3 FROM A GROUP BY a1, a2) t GROUP BY a1]]>
+      <![CDATA[SELECT min(a3) from (SELECT a1, a2, min(a3) as a3 FROM A GROUP BY a1, a2)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[MIN($1)])
-+- LogicalProject(a1=[$0], a3=[$2])
+LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
++- LogicalProject(a3=[$2])
    +- LogicalAggregate(group=[{0, 1}], a3=[MIN($2)])
       +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-GroupAggregate(groupBy=[a1], select=[a1, MIN(a3) AS EXPR$1], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[a1]], changelogMode=[I,UB,UA])
-   +- Calc(select=[a1, a3], changelogMode=[I,UB,UA])
-      +- GroupAggregate(groupBy=[a1, a2], select=[a1, a2, MIN(a3) AS a3], changelogMode=[I,UB,UA])
-         +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
-            +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
+GlobalGroupAggregate(select=[MIN(min$0) AS EXPR$0], changelogMode=[I,UA,D])
++- Exchange(distribution=[single], changelogMode=[I])
+   +- LocalGroupAggregate(select=[MIN(a3) AS min$0, COUNT_RETRACT(*) AS count1$1], changelogMode=[I])
+      +- Calc(select=[a3], changelogMode=[I,UB,UA])
+         +- GlobalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MIN(min$0) AS a3], changelogMode=[I,UB,UA])
+            +- Exchange(distribution=[hash[a1, a2]], changelogMode=[I])
+               +- LocalGroupAggregate(groupBy=[a1, a2], select=[a1, a2, MIN(a3) AS min$0], changelogMode=[I])
+                  +- MiniBatchAssigner(interval=[100ms], mode=[ProcTime], changelogMode=[I])
+                     +- DataStreamScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MultiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MultiJoinTest.xml
index 149ed09e911..aae5d7ca429 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MultiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MultiJoinTest.xml
@@ -639,38 +639,6 @@ Calc(select=[user_id_0, name, order_id, payment_id])
    :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
    +- Exchange(distribution=[hash[user_id_2]])
       +- TableSourceScan(table=[[default_catalog, default_database, Payments, project=[payment_id, user_id_2], metadata=[]]], fields=[payment_id, user_id_2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testThreeWayLeftOuterJoinExplain">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalProject(user_id_0=[$0], name=[$1], order_id=[$3], payment_id=[$6])
-+- LogicalJoin(condition=[=($0, $8)], joinType=[left])
-   :- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :- LogicalTableScan(table=[[default_catalog, default_database, Users]])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, Payments]])
-
-== Optimized Physical Plan ==
-Calc(select=[user_id_0, name, order_id, payment_id])
-+- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, LEFT], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[=(user_id_0, user_id_1), =(user_id_0, user_id_2)], select=[user_id_0,name,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
-   :- Exchange(distribution=[hash[user_id_0]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, Users, project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
-   :- Exchange(distribution=[hash[user_id_1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
-   +- Exchange(distribution=[hash[user_id_2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, Payments, project=[payment_id, user_id_2], metadata=[]]], fields=[payment_id, user_id_2])
-
-== Optimized Execution Plan ==
-Calc(select=[user_id_0, name, order_id, payment_id])
-+- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, LEFT], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[(user_id_0 = user_id_1), (user_id_0 = user_id_2)], select=[user_id_0,name,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
-   :- Exchange(distribution=[hash[user_id_0]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, Users, project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
-   :- Exchange(distribution=[hash[user_id_1]])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
-   +- Exchange(distribution=[hash[user_id_2]])
-      +- TableSourceScan(table=[[default_catalog, default_database, Payments, project=[payment_id, user_id_2], metadata=[]]], fields=[payment_id, user_id_2])
 ]]>
     </Resource>
   </TestCase>
@@ -790,54 +758,54 @@ Calc(select=[name, proctime, rowtime, price])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testThreeWayLeftOuterJoinWithWhereClauseRelPlan">
+  <TestCase name="testThreeWayLeftOuterJoinExecPlan">
     <Resource name="sql">
-      <![CDATA[SELECT u.user_id_0, u.name, o.order_id, p.payment_id FROM Users u LEFT JOIN Orders o ON u.user_id_0 = o.user_id_1 LEFT JOIN Payments p ON u.user_id_0 = p.user_id_2 WHERE u.name = 'Gus' AND p.price > 10]]>
+      <![CDATA[SELECT u.user_id_0, u.name, o.order_id, p.payment_id FROM Users u LEFT JOIN Orders o ON u.user_id_0 = o.user_id_1 LEFT JOIN Payments p ON u.user_id_0 = p.user_id_2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(user_id_0=[$0], name=[$1], order_id=[$3], payment_id=[$6])
-+- LogicalFilter(condition=[AND(=($1, _UTF-16LE'Gus'), >($7, 10))])
-   +- LogicalJoin(condition=[=($0, $8)], joinType=[left])
-      :- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-      :  :- LogicalTableScan(table=[[default_catalog, default_database, Users]])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, Payments]])
++- LogicalJoin(condition=[=($0, $8)], joinType=[left])
+   :- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :- LogicalTableScan(table=[[default_catalog, default_database, Users]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, Payments]])
 ]]>
     </Resource>
-    <Resource name="optimized rel plan">
+    <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[user_id_0, CAST('Gus' AS VARCHAR(2147483647)) AS name, order_id, CAST(payment_id AS VARCHAR(2147483647)) AS payment_id])
-+- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, INNER], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[=(user_id_0, user_id_1), =(user_id_0, user_id_2)], select=[user_id_0,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
+Calc(select=[user_id_0, name, order_id, payment_id])
++- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, LEFT], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[(user_id_0 = user_id_1), (user_id_0 = user_id_2)], select=[user_id_0,name,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
    :- Exchange(distribution=[hash[user_id_0]])
-   :  +- Calc(select=[user_id_0])
-   :     +- ChangelogNormalize(key=[user_id_0], condition=[=(name, 'Gus')])
-   :        +- Exchange(distribution=[hash[user_id_0]])
-   :           +- TableSourceScan(table=[[default_catalog, default_database, Users, filter=[], project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, Users, project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
    :- Exchange(distribution=[hash[user_id_1]])
    :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
    +- Exchange(distribution=[hash[user_id_2]])
-      +- Calc(select=[payment_id, user_id_2], where=[>(price, 10)])
-         +- TableSourceScan(table=[[default_catalog, default_database, Payments, filter=[]]], fields=[payment_id, price, user_id_2])
+      +- TableSourceScan(table=[[default_catalog, default_database, Payments, project=[payment_id, user_id_2], metadata=[]]], fields=[payment_id, user_id_2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testThreeWayLeftOuterJoinExecPlan">
-    <Resource name="sql">
-      <![CDATA[SELECT u.user_id_0, u.name, o.order_id, p.payment_id FROM Users u LEFT JOIN Orders o ON u.user_id_0 = o.user_id_1 LEFT JOIN Payments p ON u.user_id_0 = p.user_id_2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
+  <TestCase name="testThreeWayLeftOuterJoinExplain">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(user_id_0=[$0], name=[$1], order_id=[$3], payment_id=[$6])
 +- LogicalJoin(condition=[=($0, $8)], joinType=[left])
    :- LogicalJoin(condition=[=($0, $4)], joinType=[left])
    :  :- LogicalTableScan(table=[[default_catalog, default_database, Users]])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
    +- LogicalTableScan(table=[[default_catalog, default_database, Payments]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
+
+== Optimized Physical Plan ==
+Calc(select=[user_id_0, name, order_id, payment_id])
++- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, LEFT], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[=(user_id_0, user_id_1), =(user_id_0, user_id_2)], select=[user_id_0,name,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
+   :- Exchange(distribution=[hash[user_id_0]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, Users, project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
+   :- Exchange(distribution=[hash[user_id_1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
+   +- Exchange(distribution=[hash[user_id_2]])
+      +- TableSourceScan(table=[[default_catalog, default_database, Payments, project=[payment_id, user_id_2], metadata=[]]], fields=[payment_id, user_id_2])
+
+== Optimized Execution Plan ==
 Calc(select=[user_id_0, name, order_id, payment_id])
 +- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, LEFT], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[(user_id_0 = user_id_1), (user_id_0 = user_id_2)], select=[user_id_0,name,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
    :- Exchange(distribution=[hash[user_id_0]])
@@ -873,6 +841,38 @@ Calc(select=[user_id_0, name, order_id, payment_id])
    :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
    +- Exchange(distribution=[hash[user_id_2]])
       +- TableSourceScan(table=[[default_catalog, default_database, Payments, project=[payment_id, user_id_2], metadata=[]]], fields=[payment_id, user_id_2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testThreeWayLeftOuterJoinWithWhereClauseExecPlan">
+    <Resource name="sql">
+      <![CDATA[SELECT u.user_id_0, u.name, o.order_id, p.payment_id FROM Users u LEFT JOIN Orders o ON u.user_id_0 = o.user_id_1 LEFT JOIN Payments p ON u.user_id_0 = p.user_id_2 WHERE u.name = 'Gus' AND p.price > 10]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(user_id_0=[$0], name=[$1], order_id=[$3], payment_id=[$6])
++- LogicalFilter(condition=[AND(=($1, _UTF-16LE'Gus'), >($7, 10))])
+   +- LogicalJoin(condition=[=($0, $8)], joinType=[left])
+      :- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :  :- LogicalTableScan(table=[[default_catalog, default_database, Users]])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, Payments]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[user_id_0, CAST('Gus' AS VARCHAR(2147483647)) AS name, order_id, CAST(payment_id AS VARCHAR(2147483647)) AS payment_id])
++- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, INNER], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[(user_id_0 = user_id_1), (user_id_0 = user_id_2)], select=[user_id_0,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
+   :- Exchange(distribution=[hash[user_id_0]])
+   :  +- Calc(select=[user_id_0])
+   :     +- ChangelogNormalize(key=[user_id_0], condition=[(name = 'Gus')])
+   :        +- Exchange(distribution=[hash[user_id_0]])
+   :           +- TableSourceScan(table=[[default_catalog, default_database, Users, filter=[], project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
+   :- Exchange(distribution=[hash[user_id_1]])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
+   +- Exchange(distribution=[hash[user_id_2]])
+      +- Calc(select=[payment_id, user_id_2], where=[(price > 10)])
+         +- TableSourceScan(table=[[default_catalog, default_database, Payments, filter=[]]], fields=[payment_id, price, user_id_2])
 ]]>
     </Resource>
   </TestCase>
@@ -917,7 +917,7 @@ Calc(select=[user_id_0, CAST('Gus' AS VARCHAR(2147483647)) AS name, order_id, CA
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testThreeWayLeftOuterJoinWithWhereClauseExecPlan">
+  <TestCase name="testThreeWayLeftOuterJoinWithWhereClauseRelPlan">
     <Resource name="sql">
       <![CDATA[SELECT u.user_id_0, u.name, o.order_id, p.payment_id FROM Users u LEFT JOIN Orders o ON u.user_id_0 = o.user_id_1 LEFT JOIN Payments p ON u.user_id_0 = p.user_id_2 WHERE u.name = 'Gus' AND p.price > 10]]>
     </Resource>
@@ -932,48 +932,20 @@ LogicalProject(user_id_0=[$0], name=[$1], order_id=[$3], payment_id=[$6])
       +- LogicalTableScan(table=[[default_catalog, default_database, Payments]])
 ]]>
     </Resource>
-    <Resource name="optimized exec plan">
+    <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[user_id_0, CAST('Gus' AS VARCHAR(2147483647)) AS name, order_id, CAST(payment_id AS VARCHAR(2147483647)) AS payment_id])
-+- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, INNER], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[(user_id_0 = user_id_1), (user_id_0 = user_id_2)], select=[user_id_0,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
++- MultiJoin(commonJoinKey=[user_id_0], joinTypes=[LEFT, INNER], inputUniqueKeys=[(user_id_0), (order_id), (payment_id)], joinConditions=[=(user_id_0, user_id_1), =(user_id_0, user_id_2)], select=[user_id_0,order_id,user_id_1,payment_id,user_id_2], rowType=[RecordType(VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) payment_id, VARCHAR(2147483647) user_id_2)])
    :- Exchange(distribution=[hash[user_id_0]])
    :  +- Calc(select=[user_id_0])
-   :     +- ChangelogNormalize(key=[user_id_0], condition=[(name = 'Gus')])
+   :     +- ChangelogNormalize(key=[user_id_0], condition=[=(name, 'Gus')])
    :        +- Exchange(distribution=[hash[user_id_0]])
    :           +- TableSourceScan(table=[[default_catalog, default_database, Users, filter=[], project=[user_id_0, name], metadata=[]]], fields=[user_id_0, name])
    :- Exchange(distribution=[hash[user_id_1]])
    :  +- TableSourceScan(table=[[default_catalog, default_database, Orders, project=[order_id, user_id_1], metadata=[]]], fields=[order_id, user_id_1])
    +- Exchange(distribution=[hash[user_id_2]])
-      +- Calc(select=[payment_id, user_id_2], where=[(price > 10)])
+      +- Calc(select=[payment_id, user_id_2], where=[>(price, 10)])
          +- TableSourceScan(table=[[default_catalog, default_database, Payments, filter=[]]], fields=[payment_id, price, user_id_2])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTwoWayJoinWithUnion">
-    <Resource name="sql">
-      <![CDATA[WITH OrdersUnion as (SELECT * FROM Orders UNION ALL SELECT * FROM Orders2) SELECT * FROM OrdersUnion o LEFT JOIN Users u ON o.user_id_1 = u.user_id_0]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(order_id=[$0], user_id_1=[$1], product=[$2], user_id_0=[$3], name=[$4], cash=[$5])
-+- LogicalJoin(condition=[=($1, $3)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(order_id=[$0], user_id_1=[$1], product=[$2])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
-   :  +- LogicalProject(order_id=[$0], user_id_1=[$1], product=[$2])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, Orders2]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, Users]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-MultiJoin(commonJoinKey=[user_id_1], joinTypes=[LEFT], inputUniqueKeys=[noUniqueKey, (user_id_0)], joinConditions=[=(user_id_1, user_id_0)], select=[order_id,user_id_1,product,user_id_0,name,cash], rowType=[RecordType(VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) product, VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, INTEGER cash)])
-:- Exchange(distribution=[hash[user_id_1]])
-:  +- Union(all=[true], union=[order_id, user_id_1, product])
-:     :- TableSourceScan(table=[[default_catalog, default_database, Orders]], fields=[order_id, user_id_1, product])
-:     +- TableSourceScan(table=[[default_catalog, default_database, Orders2]], fields=[order_id, user_id_1, product])
-+- Exchange(distribution=[hash[user_id_0]])
-   +- TableSourceScan(table=[[default_catalog, default_database, Users]], fields=[user_id_0, name, cash])
 ]]>
     </Resource>
   </TestCase>
@@ -1008,6 +980,34 @@ Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=
             +- Calc(select=[id, price, CAST(rowtime AS TIMESTAMP(3)) AS rowtime])
                +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 5000:INTERVAL SECOND)])
                   +- TableSourceScan(table=[[default_catalog, default_database, EventTable2]], fields=[id, price, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoWayJoinWithUnion">
+    <Resource name="sql">
+      <![CDATA[WITH OrdersUnion as (SELECT * FROM Orders UNION ALL SELECT * FROM Orders2) SELECT * FROM OrdersUnion o LEFT JOIN Users u ON o.user_id_1 = u.user_id_0]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(order_id=[$0], user_id_1=[$1], product=[$2], user_id_0=[$3], name=[$4], cash=[$5])
++- LogicalJoin(condition=[=($1, $3)], joinType=[left])
+   :- LogicalUnion(all=[true])
+   :  :- LogicalProject(order_id=[$0], user_id_1=[$1], product=[$2])
+   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
+   :  +- LogicalProject(order_id=[$0], user_id_1=[$1], product=[$2])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, Orders2]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, Users]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+MultiJoin(commonJoinKey=[user_id_1], joinTypes=[LEFT], inputUniqueKeys=[noUniqueKey, (user_id_0)], joinConditions=[=(user_id_1, user_id_0)], select=[order_id,user_id_1,product,user_id_0,name,cash], rowType=[RecordType(VARCHAR(2147483647) order_id, VARCHAR(2147483647) user_id_1, VARCHAR(2147483647) product, VARCHAR(2147483647) user_id_0, VARCHAR(2147483647) name, INTEGER cash)])
+:- Exchange(distribution=[hash[user_id_1]])
+:  +- Union(all=[true], union=[order_id, user_id_1, product])
+:     :- TableSourceScan(table=[[default_catalog, default_database, Orders]], fields=[order_id, user_id_1, product])
+:     +- TableSourceScan(table=[[default_catalog, default_database, Orders2]], fields=[order_id, user_id_1, product])
++- Exchange(distribution=[hash[user_id_0]])
+   +- TableSourceScan(table=[[default_catalog, default_database, Users]], fields=[user_id_0, name, cash])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml
index 25b672b8802..b54ca5ed035 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml
@@ -16,39 +16,39 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testAggWithNonDeterministicFilterArgs[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testAggWithNonDeterministicFilterArgsOnCdcSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select
   a
   ,count(*) cnt
   ,cast(count(distinct c) filter (where b > UNIX_TIMESTAMP() - 180) as varchar) valid_uv
-from T
+from cdc
 group by a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, valid_uv])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, cnt, valid_uv])
 +- LogicalProject(a=[$0], cnt=[$1], valid_uv=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL])
    +- LogicalAggregate(group=[{0}], cnt=[COUNT()], agg#1=[COUNT(DISTINCT $1) FILTER $2])
       +- LogicalProject(a=[$0], c=[$2], $f2=[IS TRUE(>($1, -(UNIX_TIMESTAMP(), 180)))])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, valid_uv])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, cnt, valid_uv])
 +- Calc(select=[a, cnt, CAST($f2 AS VARCHAR(2147483647)) AS valid_uv])
-   +- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt, COUNT(DISTINCT c) FILTER $f2 AS $f2])
+   +- GroupAggregate(groupBy=[a], select=[a, COUNT_RETRACT(*) AS cnt, COUNT_RETRACT(DISTINCT c) FILTER $f2 AS $f2])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, (b > (UNIX_TIMESTAMP() - 180)) IS TRUE AS $f2])
-            +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
+            +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c, b], metadata=[]]], fields=[a, c, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggWithNonDeterministicFilterArgs[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testAggWithNonDeterministicFilterArgsOnCdcSource[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -56,7 +56,7 @@ select
   a
   ,count(*) cnt
   ,cast(count(distinct c) filter (where b > UNIX_TIMESTAMP() - 180) as varchar) valid_uv
-from T
+from cdc
 group by a
 ]]>
     </Resource>
@@ -66,21 +66,21 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cn
 +- LogicalProject(a=[$0], cnt=[$1], valid_uv=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL])
    +- LogicalAggregate(group=[{0}], cnt=[COUNT()], agg#1=[COUNT(DISTINCT $1) FILTER $2])
       +- LogicalProject(a=[$0], c=[$2], $f2=[IS TRUE(>($1, -(UNIX_TIMESTAMP(), 180)))])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, valid_uv])
 +- Calc(select=[a, cnt, CAST($f2 AS VARCHAR(2147483647)) AS valid_uv])
-   +- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt, COUNT(DISTINCT c) FILTER $f2 AS $f2])
+   +- GroupAggregate(groupBy=[a], select=[a, COUNT_RETRACT(*) AS cnt, COUNT_RETRACT(DISTINCT c) FILTER $f2 AS $f2])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, (b > (UNIX_TIMESTAMP() - 180)) IS TRUE AS $f2])
-            +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
+            +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c, b], metadata=[]]], fields=[a, c, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggWithNonDeterministicFilterArgsOnCdcSource[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testAggWithNonDeterministicFilterArgs[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -88,7 +88,7 @@ select
   a
   ,count(*) cnt
   ,cast(count(distinct c) filter (where b > UNIX_TIMESTAMP() - 180) as varchar) valid_uv
-from cdc
+from T
 group by a
 ]]>
     </Resource>
@@ -98,49 +98,49 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cn
 +- LogicalProject(a=[$0], cnt=[$1], valid_uv=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL])
    +- LogicalAggregate(group=[{0}], cnt=[COUNT()], agg#1=[COUNT(DISTINCT $1) FILTER $2])
       +- LogicalProject(a=[$0], c=[$2], $f2=[IS TRUE(>($1, -(UNIX_TIMESTAMP(), 180)))])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, valid_uv])
 +- Calc(select=[a, cnt, CAST($f2 AS VARCHAR(2147483647)) AS valid_uv])
-   +- GroupAggregate(groupBy=[a], select=[a, COUNT_RETRACT(*) AS cnt, COUNT_RETRACT(DISTINCT c) FILTER $f2 AS $f2])
+   +- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt, COUNT(DISTINCT c) FILTER $f2 AS $f2])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, (b > (UNIX_TIMESTAMP() - 180)) IS TRUE AS $f2])
-            +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c, b], metadata=[]]], fields=[a, c, b])
+            +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAggWithNonDeterministicFilterArgsOnCdcSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testAggWithNonDeterministicFilterArgs[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select
   a
   ,count(*) cnt
   ,cast(count(distinct c) filter (where b > UNIX_TIMESTAMP() - 180) as varchar) valid_uv
-from cdc
+from T
 group by a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, cnt, valid_uv])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, valid_uv])
 +- LogicalProject(a=[$0], cnt=[$1], valid_uv=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL])
    +- LogicalAggregate(group=[{0}], cnt=[COUNT()], agg#1=[COUNT(DISTINCT $1) FILTER $2])
       +- LogicalProject(a=[$0], c=[$2], $f2=[IS TRUE(>($1, -(UNIX_TIMESTAMP(), 180)))])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, cnt, valid_uv])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, valid_uv])
 +- Calc(select=[a, cnt, CAST($f2 AS VARCHAR(2147483647)) AS valid_uv])
-   +- GroupAggregate(groupBy=[a], select=[a, COUNT_RETRACT(*) AS cnt, COUNT_RETRACT(DISTINCT c) FILTER $f2 AS $f2])
+   +- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt, COUNT(DISTINCT c) FILTER $f2 AS $f2])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, (b > (UNIX_TIMESTAMP() - 180)) IS TRUE AS $f2])
-            +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c, b], metadata=[]]], fields=[a, c, b])
+            +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
@@ -220,11 +220,11 @@ Calc(select=[a, c-day, b, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
-select a, nd, b from (
+insert into sink_with_composite_pk
+select a, uv, b, nd from (
  select
   a, uv, b, nd,
   row_number() over (partition by a order by uv desc) rn
@@ -243,8 +243,8 @@ select a, nd, b from (
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
-+- LogicalProject(a=[$0], nd=[$3], b=[$2])
+LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
++- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3])
    +- LogicalFilter(condition=[=($4, 1)])
       +- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
          +- LogicalProject(a=[$0], uv=[COUNT(DISTINCT $1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], b=[$1], nd=[ndAggFunc(CAST($0):BIGINT) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)])
@@ -253,23 +253,22 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
-+- Calc(select=[a, nd, b])
-   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
-      +- Exchange(distribution=[hash[a]])
-         +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
-            +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
-               +- Exchange(distribution=[hash[a]])
-                  +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
-                     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
+Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
++- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
+         +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
+            +- Exchange(distribution=[hash[a]])
+               +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
+                  +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
-select a, nd, b from (
+insert into sink_with_composite_pk
+select a, uv, b, nd from (
  select
   a, uv, b, nd,
   row_number() over (partition by a order by uv desc) rn
@@ -288,8 +287,8 @@ select a, nd, b from (
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
-+- LogicalProject(a=[$0], nd=[$3], b=[$2])
+LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
++- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3])
    +- LogicalFilter(condition=[=($4, 1)])
       +- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
          +- LogicalProject(a=[$0], uv=[COUNT(DISTINCT $1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], b=[$1], nd=[ndAggFunc(CAST($0):BIGINT) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)])
@@ -298,23 +297,22 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
-+- Calc(select=[a, nd, b])
-   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
-      +- Exchange(distribution=[hash[a]])
-         +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
-            +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
-               +- Exchange(distribution=[hash[a]])
-                  +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
-                     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
+Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
++- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
+         +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
+            +- Exchange(distribution=[hash[a]])
+               +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
+                  +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_composite_pk
-select a, uv, b, nd from (
+insert into sink_without_pk
+select a, nd, b from (
  select
   a, uv, b, nd,
   row_number() over (partition by a order by uv desc) rn
@@ -333,8 +331,8 @@ select a, uv, b, nd from (
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
-+- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
++- LogicalProject(a=[$0], nd=[$3], b=[$2])
    +- LogicalFilter(condition=[=($4, 1)])
       +- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
          +- LogicalProject(a=[$0], uv=[COUNT(DISTINCT $1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], b=[$1], nd=[ndAggFunc(CAST($0):BIGINT) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)])
@@ -343,22 +341,23 @@ LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fie
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
-+- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
-         +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
-            +- Exchange(distribution=[hash[a]])
-               +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
-                  +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
++- Calc(select=[a, nd, b])
+   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
+      +- Exchange(distribution=[hash[a]])
+         +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
+            +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
+               +- Exchange(distribution=[hash[a]])
+                  +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
+                     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testAppendRankOnMultiOverWithNonDeterministicUdafSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_composite_pk
-select a, uv, b, nd from (
+insert into sink_without_pk
+select a, nd, b from (
  select
   a, uv, b, nd,
   row_number() over (partition by a order by uv desc) rn
@@ -377,8 +376,8 @@ select a, uv, b, nd from (
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
-+- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
++- LogicalProject(a=[$0], nd=[$3], b=[$2])
    +- LogicalFilter(condition=[=($4, 1)])
       +- LogicalProject(a=[$0], uv=[$1], b=[$2], nd=[$3], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
          +- LogicalProject(a=[$0], uv=[COUNT(DISTINCT $1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], b=[$1], nd=[ndAggFunc(CAST($0):BIGINT) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)])
@@ -387,14 +386,15 @@ LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fie
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, uv, b, nd])
-+- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
-         +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
-            +- Exchange(distribution=[hash[a]])
-               +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
-                  +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, nd, b])
++- Calc(select=[a, nd, b])
+   +- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[uv DESC], select=[a, uv, b, nd])
+      +- Exchange(distribution=[hash[a]])
+         +- Calc(select=[a, w0$o0 AS uv, b, w0$o1 AS nd])
+            +- OverAggregate(partitionBy=[a], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, proctime, $3, COUNT(DISTINCT b) AS w0$o0, ndAggFunc($3) AS w0$o1])
+               +- Exchange(distribution=[hash[a]])
+                  +- Calc(select=[a, b, proctime, CAST(a AS BIGINT) AS $3])
+                     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -538,139 +538,141 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], up
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkNonDeterministicFuncSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_without_pk
-select t1.a, t1.b, t2.c
+select ndFunc(t2.a) a, t1.b, t1.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_without_pk for system_time as of t1.proctime as t2
+) t1 join dim_with_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$7])
++- LogicalProject(a=[ndFunc($5)], b=[$1], c=[$2])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
++- Calc(select=[ndFunc(a0) AS a, b, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, c, a0], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcJoinDimWithPkNonDeterministicLocalCondition2[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
-select t1.a, t1.b, t2.c
+insert into sink_with_pk
+select t1.a, t2.b as version, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_without_pk for system_time as of t1.proctime as t2
+) t1 join dim_with_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
+  -- check dim table data's freshness
+  and t2.b > UNIX_TIMESTAMP() - 300
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$7])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, version, c])
++- LogicalProject(a=[$0], version=[$6], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-      +- LogicalFilter(condition=[=($cor0.a, $0)])
+      +- LogicalFilter(condition=[AND(=($cor0.a, $0), >($1, -(UNIX_TIMESTAMP(), 300)))])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, version, c], upsertMaterialize=[true])
++- Calc(select=[a, b AS version, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], where=[(b > (UNIX_TIMESTAMP() - 300))], select=[a, a, b, c], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a], metadata=[]]], fields=[a])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithoutPkSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkNonDeterministicLocalCondition[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
-select t1.a, t1.b, t2.c
+insert into sink_without_pk
+select t1.a, t1.b, t1.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_without_pk for system_time as of t1.proctime as t2
-on t1.a = t2.a
+) t1 join dim_with_pk for system_time as of t1.proctime as t2
+on t1.a = t2.a and ndFunc(t2.b) > 100
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$7])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-      +- LogicalFilter(condition=[=($cor0.a, $0)])
+      +- LogicalFilter(condition=[AND(=($cor0.a, $0), >(ndFunc($1), 100))])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], where=[(ndFunc(b) > 100)], select=[a, b, c, a], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithoutPkSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcJoinDimWithPkOnlySinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
-select t1.a, t1.b, t2.c
+insert into sink_without_pk
+select t1.a, t1.b, t1.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_without_pk for system_time as of t1.proctime as t2
+) t1 join dim_with_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$7])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, c, a0], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkNonDeterministicFuncSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkOnlySinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_without_pk
-select ndFunc(t2.a) a, t1.b, t1.c
+select t1.a, t1.b, t1.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
@@ -680,7 +682,7 @@ on t1.a = t2.a
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[ndFunc($5)], b=[$1], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
@@ -692,65 +694,63 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     <Resource name="optimized exec plan">
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- Calc(select=[ndFunc(a0) AS a, b, c])
++- Calc(select=[a, b, c])
    +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, c, a0], upsertKey=[[0]])
       +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkNonDeterministicLocalCondition2[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkOutputNoPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
-select t1.a, t2.b as version, t2.c
+insert into sink_without_pk
+select t1.a, t2.b, t1.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
-  -- check dim table data's freshness
-  and t2.b > UNIX_TIMESTAMP() - 300
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, version, c])
-+- LogicalProject(a=[$0], version=[$6], c=[$7])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$6], c=[$2])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-      +- LogicalFilter(condition=[AND(=($cor0.a, $0), >($1, -(UNIX_TIMESTAMP(), 300)))])
+      +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
             +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, version, c], upsertMaterialize=[true])
-+- Calc(select=[a, b AS version, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], where=[(b > (UNIX_TIMESTAMP() - 300))], select=[a, a, b, c], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a], metadata=[]]], fields=[a])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
++- Calc(select=[a, b, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, c, a0, b], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c], metadata=[]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkNonDeterministicLocalCondition[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkOutputNoPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_without_pk
-select t1.a, t1.b, t1.c
+select t1.a, t2.b, t1.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
-on t1.a = t2.a and ndFunc(t2.b) > 100
+on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[$0], b=[$6], c=[$2])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-      +- LogicalFilter(condition=[AND(=($cor0.a, $0), >(ndFunc($1), 100))])
+      +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
             +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
@@ -759,16 +759,16 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], where=[(ndFunc(b) > 100)], select=[a, b, c, a], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, c, a0, b], upsertMaterialize=[true], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c], metadata=[]]], fields=[a, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkOnlySinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
-select t1.a, t1.b, t1.c
+insert into sink_with_pk
+select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
@@ -777,8 +777,8 @@ on t1.a = t2.a
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
@@ -789,18 +789,19 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, c, a0], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- DropUpdateBefore
+         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkOnlySinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
-select t1.a, t1.b, t1.c
+insert into sink_with_pk
+select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
@@ -809,8 +810,8 @@ on t1.a = t2.a
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
@@ -821,18 +822,19 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, c, a0], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- DropUpdateBefore
+         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkOutputNoPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_without_pk
-select t1.a, t2.b, t1.c
+select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
@@ -842,7 +844,7 @@ on t1.a = t2.a
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$6], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
@@ -855,16 +857,16 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, c, a0, b], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c], metadata=[]]], fields=[a, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkOutputNoPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcJoinDimWithPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_without_pk
-select t1.a, t2.b, t1.c
+select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
 ) t1 join dim_with_pk for system_time as of t1.proctime as t2
@@ -874,7 +876,7 @@ on t1.a = t2.a
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$6], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
@@ -887,138 +889,136 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
       <![CDATA[
 Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, c, a0, b], upsertMaterialize=[true], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, c], metadata=[]]], fields=[a, c])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithoutPkSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_with_pk for system_time as of t1.proctime as t2
+) t1 join dim_without_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
       +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcJoinDimWithoutPkSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_with_pk for system_time as of t1.proctime as t2
+) t1 join dim_without_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
+   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
       +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_with_pk for system_time as of t1.proctime as t2
+) t1 join dim_without_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- DropUpdateBefore
-         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 join dim_with_pk for system_time as of t1.proctime as t2
+) t1 join dim_without_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- DropUpdateBefore
-         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[InnerJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -1128,133 +1128,133 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, version,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcLeftJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcLeftJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 left join dim_without_pk for system_time as of t1.proctime as t2
+) t1 left join dim_with_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- DropUpdateBefore
+         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcLeftJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcLeftJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 left join dim_without_pk for system_time as of t1.proctime as t2
+) t1 left join dim_with_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- DropUpdateBefore
+         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcLeftJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcLeftJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 left join dim_with_pk for system_time as of t1.proctime as t2
+) t1 left join dim_without_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- DropUpdateBefore
-         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcLeftJoinDimWithPkSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcLeftJoinDimWithoutPkSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select t1.a, t1.b, t2.c
 from (
   select *, proctime() proctime from cdc
-) t1 left join dim_with_pk for system_time as of t1.proctime as t2
+) t1 left join dim_without_pk for system_time as of t1.proctime as t2
 on t1.a = t2.a
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$7])
    +- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 4}])
       :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
       :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
       +- LogicalFilter(condition=[=($cor0.a, $0)])
          +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, dim_with_pk]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, dim_without_pk]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a, b, c])
-   +- LookupJoin(table=[default_catalog.default_database.dim_with_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertKey=[[0]])
-      +- DropUpdateBefore
-         +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
+   +- LookupJoin(table=[default_catalog.default_database.dim_without_pk], joinType=[LeftOuterJoin], lookup=[a=a], select=[a, b, a0, c], upsertMaterialize=[true], upsertKey=[[0]])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -1363,17 +1363,17 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcRowtimeIntervalJoinSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcRowtimeIntervalJoinSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 SELECT t2.a, t1.b, t2.c FROM cdc_with_watermark t1 JOIN cdc_with_watermark t2 ON
   t1.a = t2.a AND t1.op_ts > t2.op_ts - INTERVAL '5' SECOND
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$5], b=[$1], c=[$7])
    +- LogicalJoin(condition=[AND(=($0, $5), >($4, -($9, 5000:INTERVAL SECOND)))], joinType=[inner])
       :- LogicalWatermarkAssigner(rowtime=[op_ts], watermark=[-($4, 5000:INTERVAL SECOND)])
@@ -1384,33 +1384,35 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- Calc(select=[a0 AS a, b, c])
    +- Join(joinType=[InnerJoin], where=[((a = a0) AND (op_ts > (op_ts0 - 5000:INTERVAL SECOND)))], select=[a, b, op_ts, a0, c, op_ts0], leftInputSpec=[JoinKeyContainsUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
       :- Exchange(distribution=[hash[a]])
       :  +- Calc(select=[a, b, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
       :     +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-      :        +- Calc(select=[a, b, op_ts])
-      :           +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
+      :        +- DropUpdateBefore
+      :           +- Calc(select=[a, b, op_ts])
+      :              +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
             +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-               +- Calc(select=[a, c, op_ts])
-                  +- Reused(reference_id=[1])
+               +- DropUpdateBefore
+                  +- Calc(select=[a, c, op_ts])
+                     +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcRowtimeIntervalJoinSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcRowtimeIntervalJoinSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 SELECT t2.a, t1.b, t2.c FROM cdc_with_watermark t1 JOIN cdc_with_watermark t2 ON
   t1.a = t2.a AND t1.op_ts > t2.op_ts - INTERVAL '5' SECOND
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$5], b=[$1], c=[$7])
    +- LogicalJoin(condition=[AND(=($0, $5), >($4, -($9, 5000:INTERVAL SECOND)))], joinType=[inner])
       :- LogicalWatermarkAssigner(rowtime=[op_ts], watermark=[-($4, 5000:INTERVAL SECOND)])
@@ -1421,33 +1423,35 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- Calc(select=[a0 AS a, b, c])
    +- Join(joinType=[InnerJoin], where=[((a = a0) AND (op_ts > (op_ts0 - 5000:INTERVAL SECOND)))], select=[a, b, op_ts, a0, c, op_ts0], leftInputSpec=[JoinKeyContainsUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
       :- Exchange(distribution=[hash[a]])
       :  +- Calc(select=[a, b, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
       :     +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-      :        +- Calc(select=[a, b, op_ts])
-      :           +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
+      :        +- DropUpdateBefore
+      :           +- Calc(select=[a, b, op_ts])
+      :              +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
             +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-               +- Calc(select=[a, c, op_ts])
-                  +- Reused(reference_id=[1])
+               +- DropUpdateBefore
+                  +- Calc(select=[a, c, op_ts])
+                     +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcRowtimeIntervalJoinSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcRowtimeIntervalJoinSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 SELECT t2.a, t1.b, t2.c FROM cdc_with_watermark t1 JOIN cdc_with_watermark t2 ON
   t1.a = t2.a AND t1.op_ts > t2.op_ts - INTERVAL '5' SECOND
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$5], b=[$1], c=[$7])
    +- LogicalJoin(condition=[AND(=($0, $5), >($4, -($9, 5000:INTERVAL SECOND)))], joinType=[inner])
       :- LogicalWatermarkAssigner(rowtime=[op_ts], watermark=[-($4, 5000:INTERVAL SECOND)])
@@ -1458,35 +1462,33 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a0 AS a, b, c])
    +- Join(joinType=[InnerJoin], where=[((a = a0) AND (op_ts > (op_ts0 - 5000:INTERVAL SECOND)))], select=[a, b, op_ts, a0, c, op_ts0], leftInputSpec=[JoinKeyContainsUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
       :- Exchange(distribution=[hash[a]])
       :  +- Calc(select=[a, b, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
       :     +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-      :        +- DropUpdateBefore
-      :           +- Calc(select=[a, b, op_ts])
-      :              +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
+      :        +- Calc(select=[a, b, op_ts])
+      :           +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
             +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-               +- DropUpdateBefore
-                  +- Calc(select=[a, c, op_ts])
-                     +- Reused(reference_id=[1])
+               +- Calc(select=[a, c, op_ts])
+                  +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcRowtimeIntervalJoinSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcRowtimeIntervalJoinSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 SELECT t2.a, t1.b, t2.c FROM cdc_with_watermark t1 JOIN cdc_with_watermark t2 ON
   t1.a = t2.a AND t1.op_ts > t2.op_ts - INTERVAL '5' SECOND
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$5], b=[$1], c=[$7])
    +- LogicalJoin(condition=[AND(=($0, $5), >($4, -($9, 5000:INTERVAL SECOND)))], joinType=[inner])
       :- LogicalWatermarkAssigner(rowtime=[op_ts], watermark=[-($4, 5000:INTERVAL SECOND)])
@@ -1497,21 +1499,19 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- Calc(select=[a0 AS a, b, c])
    +- Join(joinType=[InnerJoin], where=[((a = a0) AND (op_ts > (op_ts0 - 5000:INTERVAL SECOND)))], select=[a, b, op_ts, a0, c, op_ts0], leftInputSpec=[JoinKeyContainsUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
       :- Exchange(distribution=[hash[a]])
       :  +- Calc(select=[a, b, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
       :     +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-      :        +- DropUpdateBefore
-      :           +- Calc(select=[a, b, op_ts])
-      :              +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
+      :        +- Calc(select=[a, b, op_ts])
+      :           +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_watermark, project=[a, b, c, op_ts], metadata=[]]], fields=[a, b, c, op_ts])(reuse_id=[1])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, c, CAST(op_ts AS TIMESTAMP_WITH_LOCAL_TIME_ZONE(3)) AS op_ts])
             +- WatermarkAssigner(rowtime=[op_ts], watermark=[(op_ts - 5000:INTERVAL SECOND)])
-               +- DropUpdateBefore
-                  +- Calc(select=[a, c, op_ts])
-                     +- Reused(reference_id=[1])
+               +- Calc(select=[a, c, op_ts])
+                  +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -1549,70 +1549,20 @@ from cdc_with_meta t1, lateral table(str_split(c)) as T(c1)
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
-+- LogicalProject(a=[CAST($0):INTEGER], b=[CAST($4):BIGINT], c=[$7])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]])
-      +- LogicalTableFunctionScan(invocation=[str_split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
-+- Calc(select=[CAST(a AS INTEGER) AS a, CAST(metadata_1 AS BIGINT) AS b, EXPR$0 AS c])
-   +- Correlate(invocation=[str_split($cor0.c)], correlate=[table(str_split($cor0.c))], select=[a,b,c,d,metadata_1,metadata_2,metadata_3,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, BOOLEAN d, INTEGER metadata_1, VARCHAR(2147483647) metadata_2, BIGINT metadata_3, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]], fields=[a, b, c, d, metadata_1, metadata_2, metadata_3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCdcWithMetaLegacySinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
-    <Resource name="sql">
-      <![CDATA[
-insert into legacy_upsert_sink
-select a, metadata_3, c
-from cdc_with_meta
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalLegacySink(name=[`default_catalog`.`default_database`.`legacy_upsert_sink`], fields=[a, b, c])
-+- LogicalProject(a=[CAST($0):INTEGER], b=[$6], c=[CAST($2):VARCHAR(100) CHARACTER SET "UTF-16LE"])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
-      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-LegacySink(name=[`default_catalog`.`default_database`.`legacy_upsert_sink`], fields=[a, b, c])
-+- Calc(select=[CAST(a AS INTEGER) AS a, metadata_3 AS b, CAST(c AS VARCHAR(100)) AS c])
-   +- DropUpdateBefore
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCdcWithMetaLegacySinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
-    <Resource name="sql">
-      <![CDATA[
-insert into legacy_upsert_sink
-select a, metadata_3, c
-from cdc_with_meta
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalLegacySink(name=[`default_catalog`.`default_database`.`legacy_upsert_sink`], fields=[a, b, c])
-+- LogicalProject(a=[CAST($0):INTEGER], b=[$6], c=[CAST($2):VARCHAR(100) CHARACTER SET "UTF-16LE"])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
-      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
++- LogicalProject(a=[CAST($0):INTEGER], b=[CAST($4):BIGINT], c=[$7])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]])
+      +- LogicalTableFunctionScan(invocation=[str_split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-LegacySink(name=[`default_catalog`.`default_database`.`legacy_upsert_sink`], fields=[a, b, c])
-+- Calc(select=[CAST(a AS INTEGER) AS a, metadata_3 AS b, CAST(c AS VARCHAR(100)) AS c])
-   +- DropUpdateBefore
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
++- Calc(select=[CAST(a AS INTEGER) AS a, CAST(metadata_1 AS BIGINT) AS b, EXPR$0 AS c])
+   +- Correlate(invocation=[str_split($cor0.c)], correlate=[table(str_split($cor0.c))], select=[a,b,c,d,metadata_1,metadata_2,metadata_3,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, BOOLEAN d, INTEGER metadata_1, VARCHAR(2147483647) metadata_2, BIGINT metadata_3, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]], fields=[a, b, c, d, metadata_1, metadata_2, metadata_3])
 ]]>
     </Resource>
   </TestCase>
@@ -1661,17 +1611,17 @@ Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcWithMetaSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcWithMetaSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select a, metadata_3, c
 from cdc_with_meta
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
       +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]])
@@ -1679,13 +1629,14 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
 +- Calc(select=[a, metadata_3, c])
-   +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
+   +- DropUpdateBefore
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcWithMetaSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcWithMetaSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -1710,17 +1661,17 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcWithMetaSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcWithMetaSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select a, metadata_3, c
 from cdc_with_meta
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
       +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta, metadata=[metadata_1, metadata_2, metadata_3]]])
@@ -1728,10 +1679,9 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, me
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
 +- Calc(select=[a, metadata_3, c])
-   +- DropUpdateBefore
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
+   +- TableSourceScan(table=[[default_catalog, default_database, cdc_with_meta, project=[a, c], metadata=[metadata_3]]], fields=[a, c, metadata_3])
 ]]>
     </Resource>
   </TestCase>
@@ -1785,30 +1735,31 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcWithNonDeterministicFuncSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcWithNonDeterministicFuncSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select a, ndFunc(b), c
 from cdc
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, EXPR$1, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, EXPR$1, c])
 +- LogicalProject(a=[$0], EXPR$1=[ndFunc($1)], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, EXPR$1, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, EXPR$1, c])
 +- Calc(select=[a, ndFunc(b) AS EXPR$1, c])
-   +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
+   +- DropUpdateBefore
+      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcWithNonDeterministicFuncSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testCdcWithNonDeterministicFuncSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -1832,34 +1783,33 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, EXPR$1, c
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCdcWithNonDeterministicFuncSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testCdcWithNonDeterministicFuncSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select a, ndFunc(b), c
 from cdc
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, EXPR$1, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, EXPR$1, c])
 +- LogicalProject(a=[$0], EXPR$1=[ndFunc($1)], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, EXPR$1, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, EXPR$1, c])
 +- Calc(select=[a, ndFunc(b) AS EXPR$1, c])
-   +- DropUpdateBefore
-      +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGlobalNonDeterministicAggOnAppendSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testGlobalNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select
   max(a)
   ,ndAggFunc(b) ndCnt
@@ -1869,7 +1819,7 @@ from T
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[EXPR$0, ndCnt, mc])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$0, ndCnt, mc])
 +- LogicalAggregate(group=[{}], EXPR$0=[MAX($0)], ndCnt=[ndAggFunc($1)], mc=[MAX($2)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, T]])
@@ -1877,7 +1827,7 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[EX
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[EXPR$0, ndCnt, mc])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$0, ndCnt, mc])
 +- GroupAggregate(select=[MAX(a) AS EXPR$0, ndAggFunc(b) AS ndCnt, MAX(c) AS mc])
    +- Exchange(distribution=[single])
       +- Calc(select=[a, b, c])
@@ -1885,7 +1835,7 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[EXPR$0, n
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGlobalNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testGlobalNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -1914,10 +1864,10 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$0, ndCn
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGlobalNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testGlobalNonDeterministicAggOnAppendSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select
   max(a)
   ,ndAggFunc(b) ndCnt
@@ -1927,7 +1877,7 @@ from T
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$0, ndCnt, mc])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[EXPR$0, ndCnt, mc])
 +- LogicalAggregate(group=[{}], EXPR$0=[MAX($0)], ndCnt=[ndAggFunc($1)], mc=[MAX($2)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, T]])
@@ -1935,7 +1885,7 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$0, ndCnt, mc])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[EXPR$0, ndCnt, mc])
 +- GroupAggregate(select=[MAX(a) AS EXPR$0, ndAggFunc(b) AS ndCnt, MAX(c) AS mc])
    +- Exchange(distribution=[single])
       +- Calc(select=[a, b, c])
@@ -2034,10 +1984,11 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[EXPR$0, cnt,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHasBothSidesUk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testJoinHasBothSidesUkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-select t1.a, t2.a, t2.`c-day`, t2.b, t2.d
+insert into sink_with_pk
+select t1.a, t2.a, t2.`c-day`
 from (
   select a, b, c, d
   from cdc
@@ -2051,28 +2002,30 @@ join (
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], a0=[$4], c-day=[$6], b=[$5], d=[$7])
-+- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-   +- LogicalProject(a=[$0], b=[$1], c-day=[CONCAT($2, DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd'))], d=[$3])
-      +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
++- LogicalProject(a=[CAST($0):INTEGER], b=[CAST($4):BIGINT], c=[$6])
+   +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+      +- LogicalProject(a=[$0], b=[$1], c-day=[CONCAT($2, DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd'))], d=[$3])
+         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, a0, c-day, b0 AS b, d])
-+- Join(joinType=[InnerJoin], where=[(b = b0)], select=[a, b, a0, b0, c-day, d], leftInputSpec=[HasUniqueKey], rightInputSpec=[HasUniqueKey])
-   :- Exchange(distribution=[hash[b]])
-   :  +- Calc(select=[a, b])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c, d], metadata=[]]], fields=[a, b, c, d])(reuse_id=[1])
-   +- Exchange(distribution=[hash[b]])
-      +- Calc(select=[a, b, CONCAT(c, DATE_FORMAT(CURRENT_TIMESTAMP(), 'yyMMdd')) AS c-day, d])
-         +- Reused(reference_id=[1])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
++- Calc(select=[CAST(a AS INTEGER) AS a, CAST(a0 AS BIGINT) AS b, c-day AS c])
+   +- Join(joinType=[InnerJoin], where=[(b = b0)], select=[a, b, a0, b0, c-day], leftInputSpec=[HasUniqueKey], rightInputSpec=[HasUniqueKey])
+      :- Exchange(distribution=[hash[b]])
+      :  +- Calc(select=[a, b])
+      :     +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])(reuse_id=[1])
+      +- Exchange(distribution=[hash[b]])
+         +- Calc(select=[a, b, CONCAT(c, DATE_FORMAT(CURRENT_TIMESTAMP(), 'yyMMdd')) AS c-day])
+            +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHasBothSidesUk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testJoinHasBothSidesUk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 select t1.a, t2.a, t2.`c-day`, t2.b, t2.d
@@ -2110,11 +2063,10 @@ Calc(select=[a, a0, c-day, b0 AS b, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinHasBothSidesUkSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testJoinHasBothSidesUk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
-select t1.a, t2.a, t2.`c-day`
+select t1.a, t2.a, t2.`c-day`, t2.b, t2.d
 from (
   select a, b, c, d
   from cdc
@@ -2128,26 +2080,24 @@ join (
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
-+- LogicalProject(a=[CAST($0):INTEGER], b=[CAST($4):BIGINT], c=[$6])
-   +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-      +- LogicalProject(a=[$0], b=[$1], c-day=[CONCAT($2, DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd'))], d=[$3])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+LogicalProject(a=[$0], a0=[$4], c-day=[$6], b=[$5], d=[$7])
++- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+   :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+   +- LogicalProject(a=[$0], b=[$1], c-day=[CONCAT($2, DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd'))], d=[$3])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c], upsertMaterialize=[true])
-+- Calc(select=[CAST(a AS INTEGER) AS a, CAST(a0 AS BIGINT) AS b, c-day AS c])
-   +- Join(joinType=[InnerJoin], where=[(b = b0)], select=[a, b, a0, b0, c-day], leftInputSpec=[HasUniqueKey], rightInputSpec=[HasUniqueKey])
-      :- Exchange(distribution=[hash[b]])
-      :  +- Calc(select=[a, b])
-      :     +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c], metadata=[]]], fields=[a, b, c])(reuse_id=[1])
-      +- Exchange(distribution=[hash[b]])
-         +- Calc(select=[a, b, CONCAT(c, DATE_FORMAT(CURRENT_TIMESTAMP(), 'yyMMdd')) AS c-day])
-            +- Reused(reference_id=[1])
+Calc(select=[a, a0, c-day, b0 AS b, d])
++- Join(joinType=[InnerJoin], where=[(b = b0)], select=[a, b, a0, b0, c-day, d], leftInputSpec=[HasUniqueKey], rightInputSpec=[HasUniqueKey])
+   :- Exchange(distribution=[hash[b]])
+   :  +- Calc(select=[a, b])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, cdc, project=[a, b, c, d], metadata=[]]], fields=[a, b, c, d])(reuse_id=[1])
+   +- Exchange(distribution=[hash[b]])
+      +- Calc(select=[a, b, CONCAT(c, DATE_FORMAT(CURRENT_TIMESTAMP(), 'yyMMdd')) AS c-day, d])
+         +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -2269,7 +2219,7 @@ Calc(select=[a, c-day, b, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMatchRecognizeSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testMatchRecognizeSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -2309,7 +2259,7 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, EXPR$2
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMatchRecognizeSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testMatchRecognizeSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -2538,10 +2488,10 @@ Sink(table=[default_catalog.default_database.sink2], fields=[a, b, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonDeterministicAggOnAppendSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select
   a
   ,ndAggFunc(b) ndCnt
@@ -2552,7 +2502,7 @@ group by a
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, ndCnt, mc])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, ndCnt, mc])
 +- LogicalAggregate(group=[{0}], ndCnt=[ndAggFunc($1)], mc=[MAX($2)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, T]])
@@ -2560,7 +2510,7 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, ndCnt, mc])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, ndCnt, mc])
 +- GroupAggregate(groupBy=[a], select=[a, ndAggFunc(b) AS ndCnt, MAX(c) AS mc])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, b, c])
@@ -2568,7 +2518,7 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, ndCnt,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_pk
@@ -2598,10 +2548,10 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, ndCnt, mc
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testNonDeterministicAggOnAppendSourceSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testNonDeterministicAggOnAppendSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select
   a
   ,ndAggFunc(b) ndCnt
@@ -2612,7 +2562,7 @@ group by a
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, ndCnt, mc])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, ndCnt, mc])
 +- LogicalAggregate(group=[{0}], ndCnt=[ndAggFunc($1)], mc=[MAX($2)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, T]])
@@ -2620,7 +2570,7 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, nd
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, ndCnt, mc])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, ndCnt, mc])
 +- GroupAggregate(groupBy=[a], select=[a, ndAggFunc(b) AS ndCnt, MAX(c) AS mc])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, b, c])
@@ -2728,10 +2678,10 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, EXPR$1
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProctimeDedupOnCdcWithMetadataSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testProctimeDedupOnCdcWithMetadataSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 SELECT a, metadata_3, c
 FROM (
   SELECT *,
@@ -2743,7 +2693,7 @@ WHERE rowNum = 1
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
    +- LogicalFilter(condition=[=($7, 1)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY PROCTIME() NULLS FIRST)])
@@ -2753,7 +2703,7 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
 +- Calc(select=[a, metadata_3, c])
    +- Rank(strategy=[RetractStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[$7 ASC], select=[a, c, metadata_3, $7])
       +- Exchange(distribution=[hash[a]])
@@ -2762,10 +2712,10 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metada
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProctimeDedupOnCdcWithMetadataSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testProctimeDedupOnCdcWithMetadataSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 SELECT a, metadata_3, c
 FROM (
   SELECT *,
@@ -2777,7 +2727,7 @@ WHERE rowNum = 1
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
    +- LogicalFilter(condition=[=($7, 1)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY PROCTIME() NULLS FIRST)])
@@ -2787,7 +2737,7 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, me
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
 +- Calc(select=[a, metadata_3, c])
    +- Rank(strategy=[RetractStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=1], partitionBy=[a], orderBy=[$7 ASC], select=[a, c, metadata_3, $7])
       +- Exchange(distribution=[hash[a]])
@@ -2858,7 +2808,7 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, c, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRetractRankOutputRowNumberSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testRetractRankOutputRowNumberSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_composite_pk
@@ -2892,7 +2842,7 @@ Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRetractRankOutputRowNumberSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testRetractRankOutputRowNumberSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
 insert into sink_with_composite_pk
@@ -3385,113 +3335,113 @@ Sink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testUpsertSourceSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select a, b, c
 from upsert_src
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- ChangelogNormalize(key=[a])
    +- Exchange(distribution=[hash[a]])
       +- TableSourceScan(table=[[default_catalog, default_database, upsert_src, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testUpsertSourceSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select a, b, c
 from upsert_src
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
 +- ChangelogNormalize(key=[a])
    +- Exchange(distribution=[hash[a]])
       +- TableSourceScan(table=[[default_catalog, default_database, upsert_src, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testUpsertSourceSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select a, b, c
 from upsert_src
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- ChangelogNormalize(key=[a])
    +- Exchange(distribution=[hash[a]])
       +- TableSourceScan(table=[[default_catalog, default_database, upsert_src, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testUpsertSourceSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select a, b, c
 from upsert_src
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, c])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- ChangelogNormalize(key=[a])
    +- Exchange(distribution=[hash[a]])
       +- TableSourceScan(table=[[default_catalog, default_database, upsert_src, project=[a, b, c], metadata=[]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceWithMetaSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testUpsertSourceWithMetaSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select metadata_1, b, metadata_2
 from upsert_src_with_meta
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2])
 +- LogicalProject(metadata_1=[$4], b=[$1], metadata_2=[$5])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5])
       +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src_with_meta, metadata=[metadata_1, metadata_2]]])
@@ -3499,7 +3449,7 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[me
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2], upsertMaterialize=[true])
 +- Calc(select=[metadata_1, b, metadata_2])
    +- ChangelogNormalize(key=[a])
       +- Exchange(distribution=[hash[a]])
@@ -3507,17 +3457,17 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceWithMetaSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testUpsertSourceWithMetaSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_without_pk
+insert into sink_with_pk
 select metadata_1, b, metadata_2
 from upsert_src_with_meta
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
+LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2])
 +- LogicalProject(metadata_1=[$4], b=[$1], metadata_2=[$5])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5])
       +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src_with_meta, metadata=[metadata_1, metadata_2]]])
@@ -3525,7 +3475,7 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[me
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
+Sink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2], upsertMaterialize=[true])
 +- Calc(select=[metadata_1, b, metadata_2])
    +- ChangelogNormalize(key=[a])
       +- Exchange(distribution=[hash[a]])
@@ -3533,17 +3483,17 @@ Sink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceWithMetaSinkWithPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
+  <TestCase name="testUpsertSourceWithMetaSinkWithoutPk[nonDeterministicUpdateStrategy=IGNORE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select metadata_1, b, metadata_2
 from upsert_src_with_meta
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
 +- LogicalProject(metadata_1=[$4], b=[$1], metadata_2=[$5])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5])
       +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src_with_meta, metadata=[metadata_1, metadata_2]]])
@@ -3551,7 +3501,7 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[metad
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2], upsertMaterialize=[true])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
 +- Calc(select=[metadata_1, b, metadata_2])
    +- ChangelogNormalize(key=[a])
       +- Exchange(distribution=[hash[a]])
@@ -3559,17 +3509,17 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUpsertSourceWithMetaSinkWithPk[nonDeterministicUpdateStrategy=IGNORE]">
+  <TestCase name="testUpsertSourceWithMetaSinkWithoutPk[nonDeterministicUpdateStrategy=TRY_RESOLVE]">
     <Resource name="sql">
       <![CDATA[
-insert into sink_with_pk
+insert into sink_without_pk
 select metadata_1, b, metadata_2
 from upsert_src_with_meta
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2])
+LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
 +- LogicalProject(metadata_1=[$4], b=[$1], metadata_2=[$5])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5])
       +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src_with_meta, metadata=[metadata_1, metadata_2]]])
@@ -3577,7 +3527,7 @@ LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[metad
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink_with_pk], fields=[metadata_1, b, metadata_2], upsertMaterialize=[true])
+Sink(table=[default_catalog.default_database.sink_without_pk], fields=[metadata_1, b, metadata_2])
 +- Calc(select=[metadata_1, b, metadata_2])
    +- ChangelogNormalize(key=[a])
       +- Exchange(distribution=[hash[a]])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSinkTest.xml
index 47cafef7a68..a9cefad0452 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSinkTest.xml
@@ -91,14 +91,4 @@ Sink(table=[default_catalog.default_database.sink], fields=[a, EXPR$1, EXPR$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWrongFields">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO sink PARTITION (b=1) SELECT a, b, c FROM MyTable]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWrongStatic">
-    <Resource name="sql">
-      <![CDATA[INSERT INTO sink PARTITION (a=1) SELECT b, c FROM MyTable]]>
-    </Resource>
-  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSourceTest.xml
index 4cc60cf4764..6dc56a75523 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/PartitionableSourceTest.xml
@@ -109,50 +109,49 @@ Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPushDownNonExistentPartition[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[SELECT * FROM PartitionableTable WHERE part2 = 4]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
++- LogicalFilter(condition=[=($3, 4)])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
+Values(tuples=[[]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownNonExistentPartition[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM PartitionableTable WHERE part2 = 4]]>
+      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[=($3, 4)])
+LogicalProject(name=[$1])
++- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
+      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Values(tuples=[[]])
+TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
+LogicalProject(name=[$1])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
@@ -160,37 +159,35 @@ LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
+TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
+LogicalProject(name=[$1])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
+TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$1])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
@@ -198,17 +195,18 @@ LogicalProject(name=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
+Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
-      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$1])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable]])
@@ -216,17 +214,18 @@ LogicalProject(name=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
+Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[test_catalog, test_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeysWithSingleProjection[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testPushDownPartitionAndFiltersContainPartitionKeys[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select name from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
+      <![CDATA[select * from PartitionableAndFilterableTable where part1 = 'A' and part2 > 1 and id > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$1])
+LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(=($2, _UTF-16LE'A'), >($3, 1), >($0, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable]])
@@ -234,7 +233,8 @@ LogicalProject(name=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[name], metadata=[]]], fields=[name])
+Calc(select=[id, name, CAST('A' AS VARCHAR(2147483647)) AS part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[default_catalog, default_database, PartitionableAndFilterableTable, partitions=[{part1=A, part2=2}], filter=[>(id, 1)], project=[id, name, part2], metadata=[]]], fields=[id, name, part2])
 ]]>
     </Resource>
   </TestCase>
@@ -333,45 +333,45 @@ Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
+      <![CDATA[select * from PartitionableTable where trim(part1) = 'A' and part2 > 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
++- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
       +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id > 2)])
-+- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
+Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField])
++- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=2}]]], fields=[id, name, part1, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnconvertedExpression[sourceFetchPartitions=true, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
     <Resource name="sql">
-      <![CDATA[select * from PartitionableTable where trim(part1) = 'A' and part2 > 1]]>
+      <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
-+- LogicalFilter(condition=[AND(=(TRIM(FLAG(BOTH), _UTF-16LE' ', $2), _UTF-16LE'A'), >($3, 1))])
++- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
+      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField])
-+- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=2}]]], fields=[id, name, part1, part2])
+Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id > 2)])
++- TableSourceScan(table=[[test_catalog, test_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=false]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
@@ -390,7 +390,7 @@ Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id >
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=false, useCatalogFilter=true]">
+  <TestCase name="testWithUdfAndVirtualColumn[sourceFetchPartitions=true, useCatalogFilter=false]">
     <Resource name="sql">
       <![CDATA[SELECT * FROM PartitionableTable WHERE id > 2 AND MyUdf(part2) < 3]]>
     </Resource>
@@ -399,13 +399,13 @@ Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id >
 LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[$4])
 +- LogicalFilter(condition=[AND(>($0, 2), <(MyUdf($3), 3))])
    +- LogicalProject(id=[$0], name=[$1], part1=[$2], part2=[$3], virtualField=[+($3, 1)])
-      +- LogicalTableScan(table=[[test_catalog, test_database, PartitionableTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, PartitionableTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[id, name, part1, part2, (part2 + 1) AS virtualField], where=[(id > 2)])
-+- TableSourceScan(table=[[test_catalog, test_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
++- TableSourceScan(table=[[default_catalog, default_database, PartitionableTable, partitions=[{part1=A, part2=1}, {part1=C, part2=1}], filter=[]]], fields=[id, name, part1, part2])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ProcessTableFunctionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ProcessTableFunctionTest.xml
index 0729d0807f3..98094f9591a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ProcessTableFunctionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ProcessTableFunctionTest.xml
@@ -49,28 +49,6 @@ LogicalProject(score=[$0], out=[$1])
     <Resource name="optimized rel plan">
       <![CDATA[
 ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($1), 1, DEFAULT(), DEFAULT())], uid=[f], select=[score,out], rowType=[RecordType(INTEGER score, VARCHAR(2147483647) out)])
-+- Exchange(distribution=[hash[score]])
-   +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testViewOfDifferentPartitionKey">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM v]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(score=[$0], out=[$1])
-+- LogicalProject(score=[$0], out=[$1])
-   +- LogicalTableFunctionScan(invocation=[f(TABLE(#0) PARTITION BY($1), 1, DEFAULT(), DEFAULT())], rowType=[RecordType(INTEGER score, VARCHAR(2147483647) out)])
-      +- LogicalProject(name=[$0], score=[$1])
-         +- LogicalProject(name=[$0], score=[$1])
-            +- LogicalValues(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($1), 1, DEFAULT(), DEFAULT())], uid=[f], select=[score,out], rowType=[RecordType(INTEGER score, VARCHAR(2147483647) out)])
 +- Exchange(distribution=[hash[score]])
    +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
 ]]>
@@ -111,70 +89,6 @@ LogicalProject(out=[$0], rowtime=[$1])
 ProcessTableFunction(invocation=[f(TABLE(#0), DESCRIPTOR(_UTF-16LE'ts'), DEFAULT())], uid=[null], select=[out,rowtime], rowType=[RecordType(VARCHAR(2147483647) out, TIMESTAMP_LTZ(3) *ROWTIME* rowtime)])
 +- WatermarkAssigner(rowtime=[ts], watermark=[ts])
    +- TableSourceScan(table=[[default_catalog, default_database, t_watermarked]], fields=[name, score, ts])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testScalarArgsNoUid">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM f(i => 1, b => true)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(out=[$0])
-+- LogicalTableFunctionScan(invocation=[f(1, true, DEFAULT(), DEFAULT())], rowType=[RecordType(VARCHAR(2147483647) out)])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-ProcessTableFunction(invocation=[f(1, true, DEFAULT(), DEFAULT())], uid=[null], select=[out], rowType=[RecordType(VARCHAR(2147483647) out)])
-+- Values(tuples=[[{  }]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUidPipelineSplitIntoTwoFunctions">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
-+- LogicalProject(name=[$0], out=[$1])
-   +- LogicalTableFunctionScan(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'a')], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
-      +- LogicalProject(name=[$0], score=[$1])
-         +- LogicalProject(name=[$0], score=[$1])
-            +- LogicalValues(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
-
-LogicalSink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
-+- LogicalProject(name=[$0], out=[$1])
-   +- LogicalTableFunctionScan(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'b')], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
-      +- LogicalProject(name=[$0], score=[$1])
-         +- LogicalProject(name=[$0], score=[$1])
-            +- LogicalValues(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
-+- Union(all=[true], union=[name, out])
-   :- ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'a')], uid=[a], select=[name,out], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
-   :  +- Exchange(distribution=[hash[name]])(reuse_id=[1])
-   :     +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
-   +- ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'b')], uid=[b], select=[name,out], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
-      +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testScalarArgsWithUid">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM f(uid => 'my-uid', i => 1, b => true)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(out=[$0])
-+- LogicalTableFunctionScan(invocation=[f(1, true, DEFAULT(), _UTF-16LE'my-uid')], rowType=[RecordType(VARCHAR(2147483647) out)])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-ProcessTableFunction(invocation=[f(1, true, DEFAULT(), _UTF-16LE'my-uid')], uid=[my-uid], select=[out], rowType=[RecordType(VARCHAR(2147483647) out)])
-+- Values(tuples=[[{  }]])
 ]]>
     </Resource>
   </TestCase>
@@ -224,6 +138,40 @@ LogicalProject(name=[$0], score=[$1], out=[$2])
       <![CDATA[
 ProcessTableFunction(invocation=[f(TABLE(#0), 1, DEFAULT(), DEFAULT())], uid=[null], select=[name,score,out], rowType=[RecordType(VARCHAR(5) name, INTEGER score, VARCHAR(2147483647) out)])
 +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testScalarArgsNoUid">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM f(i => 1, b => true)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(out=[$0])
++- LogicalTableFunctionScan(invocation=[f(1, true, DEFAULT(), DEFAULT())], rowType=[RecordType(VARCHAR(2147483647) out)])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+ProcessTableFunction(invocation=[f(1, true, DEFAULT(), DEFAULT())], uid=[null], select=[out], rowType=[RecordType(VARCHAR(2147483647) out)])
++- Values(tuples=[[{  }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testScalarArgsWithUid">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM f(uid => 'my-uid', i => 1, b => true)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(out=[$0])
++- LogicalTableFunctionScan(invocation=[f(1, true, DEFAULT(), _UTF-16LE'my-uid')], rowType=[RecordType(VARCHAR(2147483647) out)])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+ProcessTableFunction(invocation=[f(1, true, DEFAULT(), _UTF-16LE'my-uid')], uid=[my-uid], select=[out], rowType=[RecordType(VARCHAR(2147483647) out)])
++- Values(tuples=[[{  }]])
 ]]>
     </Resource>
   </TestCase>
@@ -245,6 +193,27 @@ LogicalProject(name=[$0], score=[$1], out=[$2])
 ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), DEFAULT())], uid=[f], select=[name,score,out], rowType=[RecordType(VARCHAR(5) name, INTEGER score, VARCHAR(2147483647) out)])
 +- Exchange(distribution=[hash[name]])
    +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTypedRowSemanticTableIgnoringColumnNames">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM f(u => TABLE t_name_diff, i => 1)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(out=[$0])
++- LogicalTableFunctionScan(invocation=[f(TABLE(#0), 1, DEFAULT(), DEFAULT())], rowType=[RecordType(VARCHAR(2147483647) out)])
+   +- LogicalProject(name=[$0], different=[$1])
+      +- LogicalProject(name=[_UTF-16LE'Bob'], different=[12])
+         +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+ProcessTableFunction(invocation=[f(TABLE(#0), 1, DEFAULT(), DEFAULT())], uid=[null], select=[out], rowType=[RecordType(VARCHAR(2147483647) out)])
++- Calc(select=['Bob' AS name, 12 AS different])
+   +- Values(tuples=[[{ 0 }]])
 ]]>
     </Resource>
   </TestCase>
@@ -307,6 +276,36 @@ Sink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
    :        +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
    +- Calc(select=['Alice' AS name, out], where=[(name = 'Alice')])
       +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUidPipelineSplitIntoTwoFunctions">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
++- LogicalProject(name=[$0], out=[$1])
+   +- LogicalTableFunctionScan(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'a')], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
+      +- LogicalProject(name=[$0], score=[$1])
+         +- LogicalProject(name=[$0], score=[$1])
+            +- LogicalValues(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
+
+LogicalSink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
++- LogicalProject(name=[$0], out=[$1])
+   +- LogicalTableFunctionScan(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'b')], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
+      +- LogicalProject(name=[$0], score=[$1])
+         +- LogicalProject(name=[$0], score=[$1])
+            +- LogicalValues(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.t_keyed_sink], fields=[name, out])
++- Union(all=[true], union=[name, out])
+   :- ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'a')], uid=[a], select=[name,out], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
+   :  +- Exchange(distribution=[hash[name]])(reuse_id=[1])
+   :     +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
+   +- ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($0), 1, DEFAULT(), _UTF-16LE'b')], uid=[b], select=[name,out], rowType=[RecordType(VARCHAR(5) name, VARCHAR(2147483647) out)])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -327,24 +326,25 @@ ProcessTableFunction(invocation=[f(1, true, DEFAULT(), DEFAULT())], uid=[null],
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTypedRowSemanticTableIgnoringColumnNames">
+  <TestCase name="testViewOfDifferentPartitionKey">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM f(u => TABLE t_name_diff, i => 1)]]>
+      <![CDATA[SELECT * FROM v]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(out=[$0])
-+- LogicalTableFunctionScan(invocation=[f(TABLE(#0), 1, DEFAULT(), DEFAULT())], rowType=[RecordType(VARCHAR(2147483647) out)])
-   +- LogicalProject(name=[$0], different=[$1])
-      +- LogicalProject(name=[_UTF-16LE'Bob'], different=[12])
-         +- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(score=[$0], out=[$1])
++- LogicalProject(score=[$0], out=[$1])
+   +- LogicalTableFunctionScan(invocation=[f(TABLE(#0) PARTITION BY($1), 1, DEFAULT(), DEFAULT())], rowType=[RecordType(INTEGER score, VARCHAR(2147483647) out)])
+      +- LogicalProject(name=[$0], score=[$1])
+         +- LogicalProject(name=[$0], score=[$1])
+            +- LogicalValues(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-ProcessTableFunction(invocation=[f(TABLE(#0), 1, DEFAULT(), DEFAULT())], uid=[null], select=[out], rowType=[RecordType(VARCHAR(2147483647) out)])
-+- Calc(select=['Bob' AS name, 12 AS different])
-   +- Values(tuples=[[{ 0 }]])
+ProcessTableFunction(invocation=[f(TABLE(#0) PARTITION BY($1), 1, DEFAULT(), DEFAULT())], uid=[f], select=[score,out], rowType=[RecordType(INTEGER score, VARCHAR(2147483647) out)])
++- Exchange(distribution=[hash[score]])
+   +- Values(tuples=[[{ _UTF-16LE'Bob', 12 }, { _UTF-16LE'Alice', 42 }]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml
index 643bc3223f9..f1e816408d4 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml
@@ -636,42 +636,6 @@ Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=
 +- Exchange(distribution=[hash[a]], changelogMode=[I])
    +- Calc(select=[a, b, c], changelogMode=[I])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTopNOrderByCountAndOtherField">
-    <Resource name="sql">
-      <![CDATA[
-SELECT *
-FROM (
-  SELECT a, b, count_c,
-      ROW_NUMBER() OVER (PARTITION BY b ORDER BY count_c DESC, a ASC) AS row_num
-  FROM (
-SELECT a, b, COUNT(*) AS count_c
-FROM MyTable
-GROUP BY a, b
-      ))
-WHERE row_num <= 10
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[$3])
-+- LogicalFilter(condition=[<=($3, 10)])
-   +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST, $0 NULLS FIRST)])
-      +- LogicalAggregate(group=[{0, 1}], count_c=[COUNT()])
-         +- LogicalProject(a=[$0], b=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Rank(strategy=[UpdateFastStrategy[0,1]], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[b], orderBy=[count_c DESC, a ASC], select=[a, b, count_c, w0$o0], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[b]], changelogMode=[I,UA])
-   +- GroupAggregate(groupBy=[a, b], select=[a, b, COUNT(*) AS count_c], changelogMode=[I,UA])
-      +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
-         +- Calc(select=[a, b], changelogMode=[I])
-            +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -708,49 +672,6 @@ Rank(strategy=[RetractStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1,
       +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
          +- Calc(select=[a, b, c], changelogMode=[I])
             +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUpdatableRankAfterLookupJoin">
-    <Resource name="sql">
-      <![CDATA[
-SELECT *
-FROM (
-  SELECT name, ids,
-      ROW_NUMBER() OVER (PARTITION BY name ORDER BY ids DESC) as rank_num
-  FROM (
-     SELECT name, SUM(id) FILTER (WHERE id > 0) as ids
-     FROM V1
-     GROUP BY name
-  ))
-WHERE rank_num <= 3
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(name=[$0], ids=[$1], rank_num=[$2])
-+- LogicalFilter(condition=[<=($2, 3)])
-   +- LogicalProject(name=[$0], ids=[$1], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalAggregate(group=[{0}], ids=[SUM($1) FILTER $2])
-         +- LogicalProject(name=[$6], id=[$5], $f2=[IS TRUE(>($5, 0))])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7])
-               +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0, 3}])
-                  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-                  +- LogicalFilter(condition=[=($cor1.a, $0)])
-                     +- LogicalSnapshot(period=[$cor1.proctime])
-                        +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Rank(strategy=[UpdateFastStrategy[0]], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[name], orderBy=[ids DESC], select=[name, ids, w0$o0])
-+- Exchange(distribution=[hash[name]])
-   +- GroupAggregate(groupBy=[name], select=[name, SUM(id) FILTER $f2 AS ids])
-      +- Exchange(distribution=[hash[name]])
-         +- Calc(select=[name, id, IS TRUE(>(id, 0)) AS $f2])
-            +- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name])
-               +- Calc(select=[a])
-                  +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -794,6 +715,42 @@ GroupAggregate(select=[MAX_RETRACT(a) AS EXPR$0], changelogMode=[I,UA,D])
                +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
                   +- Calc(select=[a, b], changelogMode=[I])
                      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTopNOrderByCountAndOtherField">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM (
+  SELECT a, b, count_c,
+      ROW_NUMBER() OVER (PARTITION BY b ORDER BY count_c DESC, a ASC) AS row_num
+  FROM (
+SELECT a, b, COUNT(*) AS count_c
+FROM MyTable
+GROUP BY a, b
+      ))
+WHERE row_num <= 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[$3])
++- LogicalFilter(condition=[<=($3, 10)])
+   +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST, $0 NULLS FIRST)])
+      +- LogicalAggregate(group=[{0, 1}], count_c=[COUNT()])
+         +- LogicalProject(a=[$0], b=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Rank(strategy=[UpdateFastStrategy[0,1]], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[b], orderBy=[count_c DESC, a ASC], select=[a, b, count_c, w0$o0], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[b]], changelogMode=[I,UA])
+   +- GroupAggregate(groupBy=[a, b], select=[a, b, COUNT(*) AS count_c], changelogMode=[I,UA])
+      +- Exchange(distribution=[hash[a, b]], changelogMode=[I])
+         +- Calc(select=[a, b], changelogMode=[I])
+            +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -979,31 +936,33 @@ Rank(strategy=[RetractStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTopNth">
+  <TestCase name="testTopNWithFilter">
     <Resource name="sql">
       <![CDATA[
-SELECT *
+SELECT row_num, a, c
 FROM (
   SELECT a, b, c,
       ROW_NUMBER() OVER (PARTITION BY a ORDER BY b DESC) as row_num
-  FROM MyTable)
-WHERE row_num = 10
+  FROM MyTable
+  WHERE c > 1000)
+WHERE row_num <= 10 AND b IS NOT NULL
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], row_num=[$3])
-+- LogicalFilter(condition=[=($3, 10)])
+LogicalProject(row_num=[$3], a=[$0], c=[$2])
++- LogicalFilter(condition=[AND(<=($3, 10), IS NOT NULL($1))])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalFilter(condition=[>($2, 1000)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, 10 AS $3], changelogMode=[I,UA,D])
-+- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=10, rankEnd=10], partitionBy=[a], orderBy=[b DESC], select=[a, b, c], changelogMode=[I,UA,D])
+Calc(select=[row_num, a, c], where=[IS NOT NULL(b)], changelogMode=[I,UB,UA,D])
++- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, row_num], changelogMode=[I,UB,UA,D])
    +- Exchange(distribution=[hash[a]], changelogMode=[I])
-      +- Calc(select=[a, b, c], changelogMode=[I])
+      +- Calc(select=[a, b, c], where=[>(c, 1000)], changelogMode=[I])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 ]]>
     </Resource>
@@ -1085,33 +1044,31 @@ Rank(strategy=[RetractStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTopNWithFilter">
+  <TestCase name="testTopNth">
     <Resource name="sql">
       <![CDATA[
-SELECT row_num, a, c
+SELECT *
 FROM (
   SELECT a, b, c,
       ROW_NUMBER() OVER (PARTITION BY a ORDER BY b DESC) as row_num
-  FROM MyTable
-  WHERE c > 1000)
-WHERE row_num <= 10 AND b IS NOT NULL
+  FROM MyTable)
+WHERE row_num = 10
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(row_num=[$3], a=[$0], c=[$2])
-+- LogicalFilter(condition=[AND(<=($3, 10), IS NOT NULL($1))])
+LogicalProject(a=[$0], b=[$1], c=[$2], row_num=[$3])
++- LogicalFilter(condition=[=($3, 10)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalFilter(condition=[>($2, 1000)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[row_num, a, c], where=[IS NOT NULL(b)], changelogMode=[I,UB,UA,D])
-+- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=10], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, row_num], changelogMode=[I,UB,UA,D])
+Calc(select=[a, b, c, 10 AS $3], changelogMode=[I,UA,D])
++- Rank(strategy=[AppendFastStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=10, rankEnd=10], partitionBy=[a], orderBy=[b DESC], select=[a, b, c], changelogMode=[I,UA,D])
    +- Exchange(distribution=[hash[a]], changelogMode=[I])
-      +- Calc(select=[a, b, c], where=[>(c, 1000)], changelogMode=[I])
+      +- Calc(select=[a, b, c], changelogMode=[I])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime], changelogMode=[I])
 ]]>
     </Resource>
@@ -1147,6 +1104,84 @@ Rank(strategy=[RetractStrategy], rankType=[ROW_NUMBER], rankRange=[rankStart=1,
    +- GroupAggregate(groupBy=[category, shopId], select=[category, shopId, MAX(price) AS max_price], changelogMode=[I,UB,UA])
       +- Exchange(distribution=[hash[category, shopId]], changelogMode=[I])
          +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[category, shopId, price], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUpdatableRankAfterIntermediateScan">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalAggregate(group=[{0}], b=[MAX($1)], c=[MIN($2)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+
+LogicalSink(table=[default_catalog.default_database.sink], fields=[a, b, c])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalFilter(condition=[<($3, 3)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
+         +- LogicalAggregate(group=[{0}], b=[MAX($1)], c=[MIN($2)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupAggregate(groupBy=[a], select=[a, MAX(b) AS b, MIN(c) AS c])(reuse_id=[1])
++- Exchange(distribution=[hash[a]])
+   +- Calc(select=[a, b, c])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+
+Sink(table=[default_catalog.default_database.sink], fields=[a, b, c])
++- Reused(reference_id=[1])
+
+Sink(table=[default_catalog.default_database.sink], fields=[a, b, c])
++- Rank(strategy=[UpdateFastStrategy[0]], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=2], partitionBy=[a], orderBy=[b DESC], select=[a, b, c])
+   +- Exchange(distribution=[hash[a]])
+      +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUpdatableRankAfterLookupJoin">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM (
+  SELECT name, ids,
+      ROW_NUMBER() OVER (PARTITION BY name ORDER BY ids DESC) as rank_num
+  FROM (
+     SELECT name, SUM(id) FILTER (WHERE id > 0) as ids
+     FROM V1
+     GROUP BY name
+  ))
+WHERE rank_num <= 3
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(name=[$0], ids=[$1], rank_num=[$2])
++- LogicalFilter(condition=[<=($2, 3)])
+   +- LogicalProject(name=[$0], ids=[$1], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
+      +- LogicalAggregate(group=[{0}], ids=[SUM($1) FILTER $2])
+         +- LogicalProject(name=[$6], id=[$5], $f2=[IS TRUE(>($5, 0))])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7])
+               +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0, 3}])
+                  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+                  +- LogicalFilter(condition=[=($cor1.a, $0)])
+                     +- LogicalSnapshot(period=[$cor1.proctime])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Rank(strategy=[UpdateFastStrategy[0]], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[name], orderBy=[ids DESC], select=[name, ids, w0$o0])
++- Exchange(distribution=[hash[name]])
+   +- GroupAggregate(groupBy=[name], select=[name, SUM(id) FILTER $f2 AS ids])
+      +- Exchange(distribution=[hash[name]])
+         +- Calc(select=[name, id, IS TRUE(>(id, 0)) AS $f2])
+            +- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name])
+               +- Calc(select=[a])
+                  +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -1185,41 +1220,6 @@ Rank(strategy=[UpdateFastStrategy[0,1]], rankType=[ROW_NUMBER], rankRange=[rankS
                +- Exchange(distribution=[hash[c]])
                   +- Calc(select=[a, b, c, PROCTIME() AS $5])
                      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUpdatableRankAfterIntermediateScan">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalAggregate(group=[{0}], b=[MAX($1)], c=[MIN($2)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-
-LogicalSink(table=[default_catalog.default_database.sink], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalFilter(condition=[<($3, 3)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
-         +- LogicalAggregate(group=[{0}], b=[MAX($1)], c=[MIN($2)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupAggregate(groupBy=[a], select=[a, MAX(b) AS b, MIN(c) AS c])(reuse_id=[1])
-+- Exchange(distribution=[hash[a]])
-   +- Calc(select=[a, b, c])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-
-Sink(table=[default_catalog.default_database.sink], fields=[a, b, c])
-+- Reused(reference_id=[1])
-
-Sink(table=[default_catalog.default_database.sink], fields=[a, b, c])
-+- Rank(strategy=[UpdateFastStrategy[0]], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=2], partitionBy=[a], orderBy=[b DESC], select=[a, b, c])
-   +- Exchange(distribution=[hash[a]])
-      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml
index fb767490766..11627aa5388 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml
@@ -119,37 +119,6 @@ Calc(select=[EXPR$0])
    +- Exchange(distribution=[hash[rowtime]])
       +- Calc(select=[CAST(rowtime AS TIMESTAMP(3)) AS rowtime, long])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[rowtime, long, int, proctime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testKeepProcessTimeAttrAfterSubGraphOptimize">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.appendSink1], fields=[long, sum])
-+- LogicalProject(long=[$1], sum=[CAST($2):BIGINT])
-   +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
-      +- LogicalProject($f0=[$TUMBLE($2, 10000:INTERVAL SECOND)], long=[$0], int=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-
-LogicalSink(table=[default_catalog.default_database.appendSink2], fields=[long, sum])
-+- LogicalProject(long=[$1], sum=[CAST($2):BIGINT])
-   +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
-      +- LogicalProject($f0=[$TUMBLE($2, 10000:INTERVAL SECOND)], long=[$0], int=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[long, CAST(EXPR$1 AS BIGINT) AS sum])(reuse_id=[1])
-+- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, proctime, 10000)], select=[long, SUM(int) AS EXPR$1])
-   +- Exchange(distribution=[hash[long]])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[long, int, proctime])
-
-Sink(table=[default_catalog.default_database.appendSink1], fields=[long, sum])
-+- Reused(reference_id=[1])
-
-Sink(table=[default_catalog.default_database.appendSink2], fields=[long, sum])
-+- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -188,6 +157,37 @@ Calc(select=[rowtime, proctime, long, int0 AS int, long0])
    +- Exchange(distribution=[hash[long]])
       +- Calc(select=[long], where=[(int < 20)])
          +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testKeepProcessTimeAttrAfterSubGraphOptimize">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.appendSink1], fields=[long, sum])
++- LogicalProject(long=[$1], sum=[CAST($2):BIGINT])
+   +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
+      +- LogicalProject($f0=[$TUMBLE($2, 10000:INTERVAL SECOND)], long=[$0], int=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+
+LogicalSink(table=[default_catalog.default_database.appendSink2], fields=[long, sum])
++- LogicalProject(long=[$1], sum=[CAST($2):BIGINT])
+   +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
+      +- LogicalProject($f0=[$TUMBLE($2, 10000:INTERVAL SECOND)], long=[$0], int=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[long, CAST(EXPR$1 AS BIGINT) AS sum])(reuse_id=[1])
++- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, proctime, 10000)], select=[long, SUM(int) AS EXPR$1])
+   +- Exchange(distribution=[hash[long]])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[long, int, proctime])
+
+Sink(table=[default_catalog.default_database.appendSink1], fields=[long, sum])
++- Reused(reference_id=[1])
+
+Sink(table=[default_catalog.default_database.appendSink2], fields=[long, sum])
++- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -286,31 +286,6 @@ LogicalProject(rowtime=[$0], proctime=[$3], s=[$4])
 Calc(select=[rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, EXPR$0 AS s])
 +- Correlate(invocation=[tableFunc(CAST($cor0.rowtime):TIMESTAMP(3), PROCTIME_MATERIALIZE($cor0.proctime), _UTF-16LE'')], correlate=[table(tableFunc(CAST($cor0.rowtime AS TIMESTAMP(3)),PROCTIME_MATERIALIZE($cor0.proctime),''))], select=[rowtime,long,int,proctime,EXPR$0], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, BIGINT long, INTEGER int, TIMESTAMP_LTZ(3) *PROCTIME* proctime, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
    +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[rowtime, long, int, proctime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWindowWithAggregationOnRowtime">
-    <Resource name="sql">
-      <![CDATA[
-SELECT MIN(rowtime), long FROM MyTable1
-GROUP BY long, TUMBLE(rowtime, INTERVAL '0.1' SECOND)
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$2], long=[$0])
-+- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)])
-   +- LogicalProject(long=[$1], $f1=[$TUMBLE($0, 100:INTERVAL SECOND)], rowtime=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0, long])
-+- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, rowtime, 100)], select=[long, MIN(rowtime) AS EXPR$0])
-   +- Exchange(distribution=[hash[long]])
-      +- Calc(select=[CAST(rowtime AS TIMESTAMP(3)) AS rowtime, long, int])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[rowtime, long, int])
 ]]>
     </Resource>
   </TestCase>
@@ -363,58 +338,83 @@ Calc(select=[w$end AS EXPR$0, long, EXPR$2])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowWithAggregationOnRowtimeWithHaving">
+  <TestCase name="testWindow2">
+    <Resource name="sql">
+      <![CDATA[
+SELECT TUMBLE_END(rowtime, INTERVAL '0.1' SECOND) AS `rowtime`,
+    `long`,
+   SUM(`int`)
+FROM MyTable1
+   GROUP BY `long`, TUMBLE(rowtime, INTERVAL '0.1' SECOND)
+
+        ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(rowtime=[TUMBLE_END($1)], long=[$0], EXPR$2=[$2])
++- LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
+   +- LogicalProject(long=[$1], $f1=[$TUMBLE($0, 100:INTERVAL SECOND)], int=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[w$end AS rowtime, long, EXPR$2])
++- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, rowtime, 100)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[long, SUM(int) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+   +- Exchange(distribution=[hash[long]])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[rowtime, long, int])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWindowWithAggregationOnRowtime">
     <Resource name="sql">
       <![CDATA[
 SELECT MIN(rowtime), long FROM MyTable1
-GROUP BY long, TUMBLE(rowtime, INTERVAL '1' SECOND)
-HAVING QUARTER(TUMBLE_END(rowtime, INTERVAL '1' SECOND)) = 1
+GROUP BY long, TUMBLE(rowtime, INTERVAL '0.1' SECOND)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[$2], long=[$0])
-+- LogicalFilter(condition=[=(EXTRACT(FLAG(QUARTER), TUMBLE_END($1)), 1)])
-   +- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)])
-      +- LogicalProject(long=[$1], $f1=[$TUMBLE($0, 1000:INTERVAL SECOND)], rowtime=[$0])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
++- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)])
+   +- LogicalProject(long=[$1], $f1=[$TUMBLE($0, 100:INTERVAL SECOND)], rowtime=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[EXPR$0, long], where=[(EXTRACT(QUARTER, w$end) = 1)])
-+- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, rowtime, 1000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[long, MIN(rowtime) AS EXPR$0, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+Calc(select=[EXPR$0, long])
++- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, rowtime, 100)], select=[long, MIN(rowtime) AS EXPR$0])
    +- Exchange(distribution=[hash[long]])
       +- Calc(select=[CAST(rowtime AS TIMESTAMP(3)) AS rowtime, long, int])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[rowtime, long, int])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindow2">
+  <TestCase name="testWindowWithAggregationOnRowtimeWithHaving">
     <Resource name="sql">
       <![CDATA[
-SELECT TUMBLE_END(rowtime, INTERVAL '0.1' SECOND) AS `rowtime`,
-    `long`,
-   SUM(`int`)
-FROM MyTable1
-   GROUP BY `long`, TUMBLE(rowtime, INTERVAL '0.1' SECOND)
-
-        ]]>
+SELECT MIN(rowtime), long FROM MyTable1
+GROUP BY long, TUMBLE(rowtime, INTERVAL '1' SECOND)
+HAVING QUARTER(TUMBLE_END(rowtime, INTERVAL '1' SECOND)) = 1
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(rowtime=[TUMBLE_END($1)], long=[$0], EXPR$2=[$2])
-+- LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
-   +- LogicalProject(long=[$1], $f1=[$TUMBLE($0, 100:INTERVAL SECOND)], int=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalProject(EXPR$0=[$2], long=[$0])
++- LogicalFilter(condition=[=(EXTRACT(FLAG(QUARTER), TUMBLE_END($1)), 1)])
+   +- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)])
+      +- LogicalProject(long=[$1], $f1=[$TUMBLE($0, 1000:INTERVAL SECOND)], rowtime=[$0])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[w$end AS rowtime, long, EXPR$2])
-+- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, rowtime, 100)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[long, SUM(int) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+Calc(select=[EXPR$0, long], where=[(EXTRACT(QUARTER, w$end) = 1)])
++- GroupWindowAggregate(groupBy=[long], window=[TumblingGroupWindow('w$, rowtime, 1000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[long, MIN(rowtime) AS EXPR$0, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
    +- Exchange(distribution=[hash[long]])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[rowtime, long, int])
+      +- Calc(select=[CAST(rowtime AS TIMESTAMP(3)) AS rowtime, long, int])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable1]], fields=[rowtime, long, int])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SetOperatorsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SetOperatorsTest.xml
index 0a190d8d5f8..92998e94061 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SetOperatorsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SetOperatorsTest.xml
@@ -262,16 +262,16 @@ GroupAggregate(groupBy=[a, b, c], select=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnionNullableTypes">
+  <TestCase name="testUnionAnyType">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM A UNION ALL SELECT CASE WHEN c > 0 THEN b ELSE NULL END FROM A]]>
+      <![CDATA[SELECT a FROM A UNION ALL SELECT b FROM A]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
 :  +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-+- LogicalProject(EXPR$0=[CASE(>($2, 0), $1, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" _2))])
++- LogicalProject(b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
@@ -279,22 +279,22 @@ LogicalUnion(all=[true])
       <![CDATA[
 Union(all=[true], union=[a])
 :- Calc(select=[a])
-:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b, c])(reuse_id=[1])
-+- Calc(select=[CASE((c > 0), b, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)) AS EXPR$0])
+:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b])(reuse_id=[1])
++- Calc(select=[b])
    +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnionAnyType">
+  <TestCase name="testUnionNullableTypes">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM A UNION ALL SELECT b FROM A]]>
+      <![CDATA[SELECT a FROM A UNION ALL SELECT CASE WHEN c > 0 THEN b ELSE NULL END FROM A]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
 :  +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-+- LogicalProject(b=[$1])
++- LogicalProject(EXPR$0=[CASE(>($2, 0), $1, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) CHARACTER SET "UTF-16LE" _2))])
    +- LogicalTableScan(table=[[default_catalog, default_database, A]])
 ]]>
     </Resource>
@@ -302,8 +302,8 @@ LogicalUnion(all=[true])
       <![CDATA[
 Union(all=[true], union=[a])
 :- Calc(select=[a])
-:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b])(reuse_id=[1])
-+- Calc(select=[b])
+:  +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a, b, c])(reuse_id=[1])
++- Calc(select=[CASE((c > 0), b, null:RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2)) AS EXPR$0])
    +- Reused(reference_id=[1])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortLimitTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortLimitTest.xml
index 3157cc9128c..fd429290e9a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortLimitTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortLimitTest.xml
@@ -140,35 +140,35 @@ Calc(select=[a])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortProcessingTimeDescWithOffset">
+  <TestCase name="testSortProcessingTimeDescWithOffSet0AndLimit1">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY proctime desc, c OFFSET 2]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY proctime DESC LIMIT 1 OFFSET 0]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[2])
-   +- LogicalProject(a=[$0], proctime=[$3], c=[$2])
++- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[0], fetch=[1])
+   +- LogicalProject(a=[$0], proctime=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- SortLimit(orderBy=[proctime DESC, c ASC], offset=[2], fetch=[unlimited], strategy=[AppendFastStrategy])
++- SortLimit(orderBy=[proctime DESC], offset=[0], fetch=[1], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortProcessingTimeDescWithOffSet0AndLimit1">
+  <TestCase name="testSortProcessingTimeDescWithOffSet1AndLimit1">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY proctime DESC LIMIT 1 OFFSET 0]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY proctime desc LIMIT 1 OFFSET 1]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[0], fetch=[1])
++- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[1], fetch=[1])
    +- LogicalProject(a=[$0], proctime=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -176,28 +176,28 @@ LogicalProject(a=[$0])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- SortLimit(orderBy=[proctime DESC], offset=[0], fetch=[1], strategy=[AppendFastStrategy])
++- SortLimit(orderBy=[proctime DESC], offset=[1], fetch=[1], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortProcessingTimeDescWithOffSet1AndLimit1">
+  <TestCase name="testSortProcessingTimeDescWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY proctime desc LIMIT 1 OFFSET 1]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY proctime desc, c OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], offset=[1], fetch=[1])
-   +- LogicalProject(a=[$0], proctime=[$3])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[2])
+   +- LogicalProject(a=[$0], proctime=[$3], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- SortLimit(orderBy=[proctime DESC], offset=[1], fetch=[1], strategy=[AppendFastStrategy])
++- SortLimit(orderBy=[proctime DESC, c ASC], offset=[2], fetch=[unlimited], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
@@ -725,27 +725,6 @@ Calc(select=[a])
 +- SortLimit(orderBy=[rowtime DESC, c ASC], offset=[0], fetch=[2], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSortRowTimeDescWithOffset">
-    <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime desc, c OFFSET 2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[2])
-   +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a])
-+- SortLimit(orderBy=[rowtime DESC, c ASC], offset=[2], fetch=[unlimited], strategy=[AppendFastStrategy])
-   +- Exchange(distribution=[single])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -824,6 +803,27 @@ Calc(select=[a])
 +- SortLimit(orderBy=[rowtime DESC], offset=[1], fetch=[1], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSortRowTimeDescWithOffset">
+    <Resource name="sql">
+      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime desc, c OFFSET 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], offset=[2])
+   +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a])
++- SortLimit(orderBy=[rowtime DESC, c ASC], offset=[2], fetch=[unlimited], strategy=[AppendFastStrategy])
+   +- Exchange(distribution=[single])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -1103,35 +1103,35 @@ Calc(select=[a])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortWithoutTimeWithLimit">
+  <TestCase name="testSortRowTimeWithLimit">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY c LIMIT 2]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime, c LIMIT 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[2])
-   +- LogicalProject(a=[$0], c=[$2])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first], fetch=[2])
+   +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- SortLimit(orderBy=[c ASC], offset=[0], fetch=[2], strategy=[AppendFastStrategy])
++- SortLimit(orderBy=[rowtime ASC, c ASC], offset=[0], fetch=[2], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortRowTimeWithLimit">
+  <TestCase name="testSortRowTimeWithOffset">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime, c LIMIT 2]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime, c OFFSET 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first], fetch=[2])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first], offset=[2])
    +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -1139,28 +1139,28 @@ LogicalProject(a=[$0])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- SortLimit(orderBy=[rowtime ASC, c ASC], offset=[0], fetch=[2], strategy=[AppendFastStrategy])
++- SortLimit(orderBy=[rowtime ASC, c ASC], offset=[2], fetch=[unlimited], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortRowTimeWithOffset">
+  <TestCase name="testSortWithoutTimeWithLimit">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime, c OFFSET 2]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY c LIMIT 2]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first], offset=[2])
-   +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
++- LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[2])
+   +- LogicalProject(a=[$0], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- SortLimit(orderBy=[rowtime ASC, c ASC], offset=[2], fetch=[unlimited], strategy=[AppendFastStrategy])
++- SortLimit(orderBy=[c ASC], offset=[0], fetch=[2], strategy=[AppendFastStrategy])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortTest.xml
index d3de16eee5a..22a2cfc58fc 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SortTest.xml
@@ -58,35 +58,35 @@ Calc(select=[a])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortRowTimeSecondDesc">
+  <TestCase name="testSortProcessingTimeSecond">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY c, rowtime desc]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY c, proctime]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last])
-   +- LogicalProject(a=[$0], c=[$2], rowtime=[$4])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
+   +- LogicalProject(a=[$0], c=[$2], proctime=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- Sort(orderBy=[c ASC, rowtime DESC])
++- Sort(orderBy=[c ASC, proctime ASC])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortProcessingTimeSecond">
+  <TestCase name="testSortProcessingTimeSecondDesc">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY c, proctime]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY c, proctime desc]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last])
    +- LogicalProject(a=[$0], c=[$2], proctime=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -94,41 +94,41 @@ LogicalProject(a=[$0])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- Sort(orderBy=[c ASC, proctime ASC])
++- Sort(orderBy=[c ASC, proctime DESC])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortProcessingTimeSecondDesc">
+  <TestCase name="testSortRowTime">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY c, proctime desc]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime, c]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last])
-   +- LogicalProject(a=[$0], c=[$2], proctime=[$3])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
+   +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- Sort(orderBy=[c ASC, proctime DESC])
++- TemporalSort(orderBy=[rowtime ASC, c ASC])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortRowTime">
+  <TestCase name="testSortRowTimeDesc">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime, c]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime desc, c]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
    +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -136,7 +136,7 @@ LogicalProject(a=[$0])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- TemporalSort(orderBy=[rowtime ASC, c ASC])
++- Sort(orderBy=[rowtime DESC, c ASC])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
@@ -163,43 +163,43 @@ Calc(select=[a])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortWithoutTime">
+  <TestCase name="testSortRowTimeSecondDesc">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY c]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY c, rowtime desc]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], dir0=[ASC-nulls-first])
-   +- LogicalProject(a=[$0], c=[$2])
++- LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC-nulls-first], dir1=[DESC-nulls-last])
+   +- LogicalProject(a=[$0], c=[$2], rowtime=[$4])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- Sort(orderBy=[c ASC])
++- Sort(orderBy=[c ASC, rowtime DESC])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSortRowTimeDesc">
+  <TestCase name="testSortWithoutTime">
     <Resource name="sql">
-      <![CDATA[SELECT a FROM MyTable ORDER BY rowtime desc, c]]>
+      <![CDATA[SELECT a FROM MyTable ORDER BY c]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$2], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
-   +- LogicalProject(a=[$0], rowtime=[$4], c=[$2])
++- LogicalSort(sort0=[$1], dir0=[ASC-nulls-first])
+   +- LogicalProject(a=[$0], c=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a])
-+- Sort(orderBy=[rowtime DESC, c ASC])
++- Sort(orderBy=[c ASC])
    +- Exchange(distribution=[single])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SourceWatermarkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SourceWatermarkTest.xml
index cc48573fe55..8febcf11a1e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SourceWatermarkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SourceWatermarkTest.xml
@@ -16,25 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testWatermarkWithUdf">
-    <Resource name="sql">
-      <![CDATA[SELECT a - b FROM UdfTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[-($0, $1)])
-+- LogicalWatermarkAssigner(rowtime=[c], watermark=[func(func($3, $0), $0)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[func($2, $0)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[(a - b) AS EXPR$0])
-+- TableSourceScan(table=[[default_catalog, default_database, UdfTable, watermark=[func(func(func(c, a), a), a)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testProjectTransposeWatermarkAssigner">
     <Resource name="sql">
       <![CDATA[SELECT a, b, ts FROM t1]]>
@@ -122,6 +103,25 @@ LogicalProject(a=[$0], b=[$1], c=[$2])
     <Resource name="optimized exec plan">
       <![CDATA[
 TableSourceScan(table=[[default_catalog, default_database, VirtualTable, watermark=[-(+(c, 5000:INTERVAL SECOND), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWatermarkOnComputedColumnExcludedRowTime2">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b, SECOND(d) FROM VirtualTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], EXPR$2=[EXTRACT(FLAG(SECOND), $3)])
++- LogicalWatermarkAssigner(rowtime=[d], watermark=[-($3, 5000:INTERVAL SECOND)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2, 5000:INTERVAL SECOND)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, b, EXTRACT(SECOND, CAST(Reinterpret((c + 5000:INTERVAL SECOND)) AS TIMESTAMP(3))) AS EXPR$2])
++- TableSourceScan(table=[[default_catalog, default_database, VirtualTable, watermark=[-(+(c, 5000:INTERVAL SECOND), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -202,41 +202,41 @@ Calc(select=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWatermarkOnComputedColumnExcludedRowTime2">
+  <TestCase name="testWatermarkWithMetadata">
     <Resource name="sql">
-      <![CDATA[SELECT a, b, SECOND(d) FROM VirtualTable]]>
+      <![CDATA[SELECT a, b FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], EXPR$2=[EXTRACT(FLAG(SECOND), $3)])
-+- LogicalWatermarkAssigner(rowtime=[d], watermark=[-($3, 5000:INTERVAL SECOND)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($2, 5000:INTERVAL SECOND)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(a=[$0], b=[$1])
++- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], originTime=[$3], rowtime=[TO_TIMESTAMP(FROM_UNIXTIME(/($3, 1000)), _UTF-16LE'yyyy-MM-dd HH:mm:ss')])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, metadata=[originTime]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, EXTRACT(SECOND, CAST(Reinterpret((c + 5000:INTERVAL SECOND)) AS TIMESTAMP(3))) AS EXPR$2])
-+- TableSourceScan(table=[[default_catalog, default_database, VirtualTable, watermark=[-(+(c, 5000:INTERVAL SECOND), 5000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
+Calc(select=[a, b])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[originTime], watermark=[TO_TIMESTAMP(FROM_UNIXTIME(/(originTime, 1000)), _UTF-16LE'yyyy-MM-dd HH:mm:ss')], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, originTime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWatermarkWithMetadata">
+  <TestCase name="testWatermarkWithUdf">
     <Resource name="sql">
-      <![CDATA[SELECT a, b FROM MyTable]]>
+      <![CDATA[SELECT a - b FROM UdfTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1])
-+- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], originTime=[$3], rowtime=[TO_TIMESTAMP(FROM_UNIXTIME(/($3, 1000)), _UTF-16LE'yyyy-MM-dd HH:mm:ss')])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, metadata=[originTime]]])
+LogicalProject(EXPR$0=[-($0, $1)])
++- LogicalWatermarkAssigner(rowtime=[c], watermark=[func(func($3, $0), $0)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[func($2, $0)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, UdfTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b], metadata=[originTime], watermark=[TO_TIMESTAMP(FROM_UNIXTIME(/(originTime, 1000)), _UTF-16LE'yyyy-MM-dd HH:mm:ss')], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, originTime])
+Calc(select=[(a - b) AS EXPR$0])
++- TableSourceScan(table=[[default_catalog, default_database, UdfTable, watermark=[func(func(func(c, a), a), a)], watermarkEmitStrategy=[on-periodic]]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/StreamSinkReuseTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/StreamSinkReuseTest.xml
index 59198a2e151..66a1dfef9f6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/StreamSinkReuseTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/StreamSinkReuseTest.xml
@@ -16,9 +16,9 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testSinkReuse">
-		<Resource name="ast">
-			<![CDATA[
+  <TestCase name="testSinkReuse">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -35,9 +35,9 @@ LogicalSink(table=[default_catalog.default_database.sink2], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source4]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
@@ -48,11 +48,11 @@ Sink(table=[default_catalog.default_database.sink2], fields=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source3]], fields=[x, y])
    +- TableSourceScan(table=[[default_catalog, default_database, source4]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseFromSameSource">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseFromSameSource">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -61,19 +61,19 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])(reuse_id=[1])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithDifferentFieldNames">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithDifferentFieldNames">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -82,19 +82,19 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x1, y1])
 +- LogicalProject(x1=[$0], y1=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, filed_name_change_source]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
    +- TableSourceScan(table=[[default_catalog, default_database, filed_name_change_source]], fields=[x1, y1])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithHint">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithHint">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -107,9 +107,9 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y], hints
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore1}]]])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
@@ -118,11 +118,11 @@ Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPT
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y], hints=[[[OPTIONS options:{path=ignore2}]]])
 +- TableSourceScan(table=[[default_catalog, default_database, source2]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithOverwrite">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithOverwrite">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -135,9 +135,9 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
@@ -146,11 +146,11 @@ Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- TableSourceScan(table=[[default_catalog, default_database, source2]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithPartialColumns">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithPartialColumns">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], targetColumns=[[0]], fields=[x, EXPR$1])
 +- LogicalProject(x=[$0], EXPR$1=[null:BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -163,9 +163,9 @@ LogicalSink(table=[default_catalog.default_database.sink1], targetColumns=[[0]],
 +- LogicalProject(x=[$0], EXPR$1=[null:BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, source3]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 TableSourceScan(table=[[default_catalog, default_database, source1, project=[x, y], metadata=[]]], fields=[x, y])(reuse_id=[1])
 
 Sink(table=[default_catalog.default_database.sink1], targetColumns=[[0]], fields=[x, EXPR$1])
@@ -179,11 +179,11 @@ Sink(table=[default_catalog.default_database.sink1], targetColumns=[[1]], fields
 +- Calc(select=[null:BIGINT AS EXPR$0, y])
    +- Reused(reference_id=[1])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithPartition">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithPartition">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.partitionedSink], fields=[EXPR$0, y])
 +- LogicalProject(EXPR$0=[1:BIGINT], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -200,9 +200,9 @@ LogicalSink(table=[default_catalog.default_database.partitionedSink], fields=[x,
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source4]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.partitionedSink], fields=[EXPR$0, y])
 +- Union(all=[true], union=[EXPR$0, y])
    :- Calc(select=[1 AS EXPR$0, y])
@@ -217,11 +217,11 @@ Sink(table=[default_catalog.default_database.partitionedSink], fields=[EXPR$0, y
 Sink(table=[default_catalog.default_database.partitionedSink], fields=[x, y])
 +- TableSourceScan(table=[[default_catalog, default_database, source4]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithTypeCoercionSource">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithTypeCoercionSource">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[$0], y=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, source1]])
@@ -230,20 +230,20 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- LogicalProject(x=[CAST($0):BIGINT], y=[CAST($1):BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, type_coercion_source]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.sink1], fields=[x, y])
 +- Union(all=[true], union=[x, y])
    :- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
    +- Calc(select=[CAST(x AS BIGINT) AS x, CAST(y AS BIGINT) AS y])
       +- TableSourceScan(table=[[default_catalog, default_database, type_coercion_source]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithUpsertAndRetract">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithUpsertAndRetract">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.upsertSink], fields=[a, b])
 +- LogicalProject(a=[CAST($0):BIGINT], b=[CAST($1):BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, retractSource]])
@@ -256,9 +256,9 @@ LogicalSink(table=[default_catalog.default_database.upsertSink], fields=[a, b])
 +- LogicalProject(a=[CAST($0):BIGINT], b=[CAST($1):BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsertSource]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Sink(table=[default_catalog.default_database.upsertSink], fields=[a, b])
 +- Union(all=[true], union=[a, b])
    :- Calc(select=[CAST(x AS BIGINT) AS a, CAST(y AS BIGINT) AS b])
@@ -271,11 +271,11 @@ Sink(table=[default_catalog.default_database.upsertSink], fields=[a, b])
 Sink(table=[default_catalog.default_database.upsertSink], fields=[x, y])
 +- TableSourceScan(table=[[default_catalog, default_database, source1]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testSinkReuseWithUpsertMaterialize">
-		<Resource name="ast">
-			<![CDATA[
+    </Resource>
+  </TestCase>
+  <TestCase name="testSinkReuseWithUpsertMaterialize">
+    <Resource name="ast">
+      <![CDATA[
 LogicalSink(table=[default_catalog.default_database.upsertPKSink], fields=[a, b])
 +- LogicalProject(a=[CAST($0):BIGINT], b=[CAST($1):BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsertSource]])
@@ -288,9 +288,9 @@ LogicalSink(table=[default_catalog.default_database.upsertPKSink], fields=[a, b]
 +- LogicalProject(a=[CAST($0):BIGINT], b=[CAST($1):BIGINT])
    +- LogicalTableScan(table=[[default_catalog, default_database, upsertSource2]])
 ]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Calc(select=[CAST(x AS BIGINT) AS a, CAST(y AS BIGINT) AS b])(reuse_id=[1])
 +- ChangelogNormalize(key=[x])
    +- Exchange(distribution=[hash[x]])
@@ -305,6 +305,6 @@ Sink(table=[default_catalog.default_database.upsertPKSink], fields=[a, b])
 +- Calc(select=[CAST(x AS BIGINT) AS a, CAST(y AS BIGINT) AS b])
    +- TableSourceScan(table=[[default_catalog, default_database, upsertSource2]], fields=[x, y])
 ]]>
-		</Resource>
-	</TestCase>
+    </Resource>
+  </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml
index 5b5622d341b..5bf4359078a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml
@@ -16,34 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testSubplanReuseOnCalcWithNonDeterministicUdf">
-    <Resource name="sql">
-      <![CDATA[
-(SELECT a FROM x WHERE b > random_udf(a))
-UNION ALL
-(SELECT a FROM x WHERE b > random_udf(a))
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[true])
-:- LogicalProject(a=[$0])
-:  +- LogicalFilter(condition=[>($1, random_udf($0))])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-+- LogicalProject(a=[$0])
-   +- LogicalFilter(condition=[>($1, random_udf($0))])
-      +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Union(all=[true], union=[a])
-:- Calc(select=[a], where=[(b > random_udf(a))])(reuse_id=[1])
-:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-+- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testDisableReuseTableSource">
     <Resource name="sql">
       <![CDATA[
@@ -231,6 +203,34 @@ Join(joinType=[InnerJoin], where=[(b = e0)], select=[a, b, d, e, a0, b0, d0, e0]
       +- Exchange(distribution=[hash[d]])
          +- Calc(select=[d, e], where=[(d > 5)])
             +- Reused(reference_id=[2])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testReuseTableSourceWithProjectPushDownAndMetaDataKey">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink1], fields=[a1, b1, my_time1, d1])
++- LogicalProject(a1=[$0], b1=[CAST($1):VARCHAR(32) CHARACTER SET "UTF-16LE"], my_time1=[CAST($2):TIMESTAMP(6)], d1=[CAST($3):DECIMAL(20, 2)])
+   +- LogicalProject(a=[$0], b=[$1], my_time=[$4], d1=[CAST($3):DECIMAL(28, 2)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], my_time=[$4], unUse_time=[$5])
+         +- LogicalTableScan(table=[[default_catalog, default_database, reuseTable, metadata=[ts1, ts2]]])
+
+LogicalSink(table=[default_catalog.default_database.sink2], fields=[a2, update_time])
++- LogicalProject(a2=[$0], update_time=[CAST($1):TIMESTAMP(6)])
+   +- LogicalProject(a=[$0], update_time=[$4])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], my_time=[$4], unUse_time=[$5])
+         +- LogicalTableScan(table=[[default_catalog, default_database, reuseTable, metadata=[ts1, ts2]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink1], fields=[a1, b1, my_time1, d1])
++- Calc(select=[a AS a1, CAST(b AS VARCHAR(32)) AS b1, CAST(my_time AS TIMESTAMP(6)) AS my_time1, CAST(CAST(d AS DECIMAL(28, 2)) AS DECIMAL(20, 2)) AS d1])
+   +- TableSourceScan(table=[[default_catalog, default_database, reuseTable, project=[a, b, d], metadata=[ts1]]], fields=[a, b, d, my_time])
+
+Sink(table=[default_catalog.default_database.sink2], fields=[a2, update_time])
++- Calc(select=[a AS a2, CAST(my_time AS TIMESTAMP(6)) AS update_time])
+   +- TableSourceScan(table=[[default_catalog, default_database, reuseTable, project=[a], metadata=[ts1]]], fields=[a, my_time])
 ]]>
     </Resource>
   </TestCase>
@@ -464,31 +464,31 @@ Union(all=[true], union=[a, EXPR$1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testReuseTableSourceWithProjectPushDownAndMetaDataKey">
+  <TestCase name="testSubplanReuseOnCalcWithNonDeterministicUdf">
+    <Resource name="sql">
+      <![CDATA[
+(SELECT a FROM x WHERE b > random_udf(a))
+UNION ALL
+(SELECT a FROM x WHERE b > random_udf(a))
+      ]]>
+    </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink1], fields=[a1, b1, my_time1, d1])
-+- LogicalProject(a1=[$0], b1=[CAST($1):VARCHAR(32) CHARACTER SET "UTF-16LE"], my_time1=[CAST($2):TIMESTAMP(6)], d1=[CAST($3):DECIMAL(20, 2)])
-   +- LogicalProject(a=[$0], b=[$1], my_time=[$4], d1=[CAST($3):DECIMAL(28, 2)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], my_time=[$4], unUse_time=[$5])
-         +- LogicalTableScan(table=[[default_catalog, default_database, reuseTable, metadata=[ts1, ts2]]])
-
-LogicalSink(table=[default_catalog.default_database.sink2], fields=[a2, update_time])
-+- LogicalProject(a2=[$0], update_time=[CAST($1):TIMESTAMP(6)])
-   +- LogicalProject(a=[$0], update_time=[$4])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], my_time=[$4], unUse_time=[$5])
-         +- LogicalTableScan(table=[[default_catalog, default_database, reuseTable, metadata=[ts1, ts2]]])
+LogicalUnion(all=[true])
+:- LogicalProject(a=[$0])
+:  +- LogicalFilter(condition=[>($1, random_udf($0))])
+:     +- LogicalTableScan(table=[[default_catalog, default_database, x]])
++- LogicalProject(a=[$0])
+   +- LogicalFilter(condition=[>($1, random_udf($0))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, x]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Sink(table=[default_catalog.default_database.sink1], fields=[a1, b1, my_time1, d1])
-+- Calc(select=[a AS a1, CAST(b AS VARCHAR(32)) AS b1, CAST(my_time AS TIMESTAMP(6)) AS my_time1, CAST(CAST(d AS DECIMAL(28, 2)) AS DECIMAL(20, 2)) AS d1])
-   +- TableSourceScan(table=[[default_catalog, default_database, reuseTable, project=[a, b, d], metadata=[ts1]]], fields=[a, b, d, my_time])
-
-Sink(table=[default_catalog.default_database.sink2], fields=[a2, update_time])
-+- Calc(select=[a AS a2, CAST(my_time AS TIMESTAMP(6)) AS update_time])
-   +- TableSourceScan(table=[[default_catalog, default_database, reuseTable, project=[a], metadata=[ts1]]], fields=[a, my_time])
+Union(all=[true], union=[a])
+:- Calc(select=[a], where=[(b > random_udf(a))])(reuse_id=[1])
+:  +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
++- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -726,38 +726,6 @@ Union(all=[true], union=[a, b])
 :           +- TableSourceScan(table=[[default_catalog, default_database, y]], fields=[d, e, f])
 +- Calc(select=[a, (b * 2) AS b])
    +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSubplanReuseOnOverWindow">
-    <Resource name="sql">
-      <![CDATA[
-WITH r AS (SELECT a, b, RANK() OVER (ORDER BY c DESC) FROM x)
-SELECT * FROM r r1, r r2 WHERE r1.a = r2.a AND r1.b < 100 AND r2.b > 10
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], EXPR$2=[$2], a0=[$3], b0=[$4], EXPR$20=[$5])
-+- LogicalFilter(condition=[AND(=($0, $3), <($1, 100), >($4, 10))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      +- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, w0$o0, a0, b0, w0$o00], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-:- Exchange(distribution=[hash[a]])
-:  +- Calc(select=[a, b, w0$o0], where=[(b < 100)])
-:     +- OverAggregate(orderBy=[c DESC], window=[ RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, c, RANK(*) AS w0$o0])(reuse_id=[1])
-:        +- Exchange(distribution=[single])
-:           +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
-+- Exchange(distribution=[hash[a]])
-   +- Calc(select=[a, b, w0$o0], where=[(b > 10)])
-      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -795,6 +763,38 @@ Union(all=[true], union=[a, b])
 :        +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
 +- Calc(select=[a, (b * 2) AS b], where=[(b < 10)])
    +- Reused(reference_id=[1])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSubplanReuseOnOverWindow">
+    <Resource name="sql">
+      <![CDATA[
+WITH r AS (SELECT a, b, RANK() OVER (ORDER BY c DESC) FROM x)
+SELECT * FROM r r1, r r2 WHERE r1.a = r2.a AND r1.b < 100 AND r2.b > 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], EXPR$2=[$2], a0=[$3], b0=[$4], EXPR$20=[$5])
++- LogicalFilter(condition=[AND(=($0, $3), <($1, 100), >($4, 10))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      +- LogicalProject(a=[$0], b=[$1], EXPR$2=[RANK() OVER (ORDER BY $2 DESC NULLS LAST)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, x]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Join(joinType=[InnerJoin], where=[(a = a0)], select=[a, b, w0$o0, a0, b0, w0$o00], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+:- Exchange(distribution=[hash[a]])
+:  +- Calc(select=[a, b, w0$o0], where=[(b < 100)])
+:     +- OverAggregate(orderBy=[c DESC], window=[ RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, c, RANK(*) AS w0$o0])(reuse_id=[1])
+:        +- Exchange(distribution=[single])
+:           +- TableSourceScan(table=[[default_catalog, default_database, x]], fields=[a, b, c])
++- Exchange(distribution=[hash[a]])
+   +- Calc(select=[a, b, w0$o0], where=[(b > 10)])
+      +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml
index 3b8442cbc28..1547e7db4c2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml
@@ -102,22 +102,6 @@ Calc(select=[a, b, c], changelogMode=[I,UA,D])
             +- Calc(select=[id, a, +(a, 1) AS b, c, TO_TIMESTAMP(c) AS ts], changelogMode=[I,UA,D])
                +- DropUpdateBefore(changelogMode=[I,UA,D])
                   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[id, a, c], changelogMode=[I,UB,UA,D])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testDataStreamScan">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM DataStreamTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, DataStreamTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-DataStreamScan(table=[[default_catalog, default_database, DataStreamTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -273,33 +257,19 @@ WatermarkAssigner(rowtime=[d], watermark=[(d - 1:INTERVAL SECOND)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinOnChangelogSourceWithEventsDuplicate">
+  <TestCase name="testDataStreamScan">
     <Resource name="sql">
-      <![CDATA[
-SELECT o.currency_name, o.amount, r.rate, o.amount * r.rate
-FROM orders AS o JOIN rates_history AS r
-ON o.currency_id = r.currency_id AND o.currency_name = r.currency_name
-]]>
+      <![CDATA[SELECT * FROM DataStreamTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(currency_name=[$2], amount=[$0], rate=[$5], EXPR$3=[*($0, $5)])
-+- LogicalJoin(condition=[AND(=($1, $3), =($2, $4))], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, orders]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, rates_history]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalTableScan(table=[[default_catalog, default_database, DataStreamTable]])
 ]]>
     </Resource>
-    <Resource name="optimized rel plan">
+    <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[currency_name, amount, rate, *(amount, rate) AS EXPR$3], changelogMode=[I,UB,UA,D])
-+- Join(joinType=[InnerJoin], where=[AND(=(currency_id, currency_id0), =(currency_name, currency_name0))], select=[amount, currency_id, currency_name, currency_id0, currency_name0, rate], leftInputSpec=[NoUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey], changelogMode=[I,UB,UA,D])
-   :- Exchange(distribution=[hash[currency_id, currency_name]], changelogMode=[I])
-   :  +- TableSourceScan(table=[[default_catalog, default_database, orders]], fields=[amount, currency_id, currency_name], changelogMode=[I])
-   +- Exchange(distribution=[hash[currency_id, currency_name]], changelogMode=[I,UB,UA,D])
-      +- ChangelogNormalize(key=[currency_id], changelogMode=[I,UB,UA,D])
-         +- Exchange(distribution=[hash[currency_id]], changelogMode=[I,UA])
-            +- DropUpdateBefore(changelogMode=[I,UA])
-               +- TableSourceScan(table=[[default_catalog, default_database, rates_history]], fields=[currency_id, currency_name, rate], changelogMode=[I,UB,UA])
+DataStreamScan(table=[[default_catalog, default_database, DataStreamTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -378,6 +348,36 @@ Calc(select=[currency_name, amount, rate, *(amount, rate) AS EXPR$3], changelogM
    :  +- TableSourceScan(table=[[default_catalog, default_database, orders]], fields=[amount, currency_id, currency_name], changelogMode=[I])
    +- Exchange(distribution=[hash[currency_id, currency_name]], changelogMode=[I,UB,UA])
       +- TableSourceScan(table=[[default_catalog, default_database, rates_history]], fields=[currency_id, currency_name, rate], changelogMode=[I,UB,UA])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinOnChangelogSourceWithEventsDuplicate">
+    <Resource name="sql">
+      <![CDATA[
+SELECT o.currency_name, o.amount, r.rate, o.amount * r.rate
+FROM orders AS o JOIN rates_history AS r
+ON o.currency_id = r.currency_id AND o.currency_name = r.currency_name
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(currency_name=[$2], amount=[$0], rate=[$5], EXPR$3=[*($0, $5)])
++- LogicalJoin(condition=[AND(=($1, $3), =($2, $4))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, orders]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, rates_history]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[currency_name, amount, rate, *(amount, rate) AS EXPR$3], changelogMode=[I,UB,UA,D])
++- Join(joinType=[InnerJoin], where=[AND(=(currency_id, currency_id0), =(currency_name, currency_name0))], select=[amount, currency_id, currency_name, currency_id0, currency_name0, rate], leftInputSpec=[NoUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey], changelogMode=[I,UB,UA,D])
+   :- Exchange(distribution=[hash[currency_id, currency_name]], changelogMode=[I])
+   :  +- TableSourceScan(table=[[default_catalog, default_database, orders]], fields=[amount, currency_id, currency_name], changelogMode=[I])
+   +- Exchange(distribution=[hash[currency_id, currency_name]], changelogMode=[I,UB,UA,D])
+      +- ChangelogNormalize(key=[currency_id], changelogMode=[I,UB,UA,D])
+         +- Exchange(distribution=[hash[currency_id]], changelogMode=[I,UA])
+            +- DropUpdateBefore(changelogMode=[I,UA])
+               +- TableSourceScan(table=[[default_catalog, default_database, rates_history]], fields=[currency_id, currency_name, rate], changelogMode=[I,UB,UA])
 ]]>
     </Resource>
   </TestCase>
@@ -629,12 +629,12 @@ Join(joinType=[LeftOuterJoin], where=[(id = id0)], select=[id, b, c, id0, a], le
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnionUpsertSourceAndAggregation">
+  <TestCase name="testUnionChangelogSourceAndAggregation">
     <Resource name="sql">
       <![CDATA[
 SELECT b, ts, a
 FROM (
-  SELECT * FROM upsert_src
+  SELECT * FROM changelog_src
   UNION ALL
   SELECT MAX(ts) as t, a, MAX(b) as b FROM append_src GROUP BY a
 )
@@ -645,7 +645,7 @@ FROM (
 LogicalProject(b=[$2], ts=[$0], a=[$1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(ts=[$0], a=[$1], b=[$2])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, changelog_src]])
    +- LogicalProject(t=[$1], a=[$0], b=[$2])
       +- LogicalAggregate(group=[{0}], t=[MAX($1)], b=[MAX($2)])
          +- LogicalProject(a=[$1], ts=[$0], b=[$2])
@@ -655,10 +655,9 @@ LogicalProject(b=[$2], ts=[$0], a=[$1])
     <Resource name="optimized rel plan">
       <![CDATA[
 Union(all=[true], union=[b, ts, a], changelogMode=[I,UA,D])
-:- Calc(select=[b, ts, CAST(a AS INTEGER) AS a], changelogMode=[I,UA,D])
-:  +- ChangelogNormalize(key=[a], changelogMode=[I,UA,D])
-:     +- Exchange(distribution=[hash[a]], changelogMode=[UA,PD])
-:        +- TableSourceScan(table=[[default_catalog, default_database, upsert_src]], fields=[ts, a, b], changelogMode=[UA,PD])
+:- Calc(select=[b, ts, a], changelogMode=[I,UA,D])
+:  +- DropUpdateBefore(changelogMode=[I,UA,D])
+:     +- TableSourceScan(table=[[default_catalog, default_database, changelog_src]], fields=[ts, a, b], changelogMode=[I,UB,UA,D])
 +- Calc(select=[b, t AS ts, a], changelogMode=[I,UA])
    +- GroupAggregate(groupBy=[a], select=[a, MAX(ts) AS t, MAX(b) AS b], changelogMode=[I,UA])
       +- Exchange(distribution=[hash[a]], changelogMode=[I])
@@ -666,12 +665,12 @@ Union(all=[true], union=[b, ts, a], changelogMode=[I,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnionChangelogSourceAndAggregation">
+  <TestCase name="testUnionUpsertSourceAndAggregation">
     <Resource name="sql">
       <![CDATA[
 SELECT b, ts, a
 FROM (
-  SELECT * FROM changelog_src
+  SELECT * FROM upsert_src
   UNION ALL
   SELECT MAX(ts) as t, a, MAX(b) as b FROM append_src GROUP BY a
 )
@@ -682,7 +681,7 @@ FROM (
 LogicalProject(b=[$2], ts=[$0], a=[$1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(ts=[$0], a=[$1], b=[$2])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, changelog_src]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, upsert_src]])
    +- LogicalProject(t=[$1], a=[$0], b=[$2])
       +- LogicalAggregate(group=[{0}], t=[MAX($1)], b=[MAX($2)])
          +- LogicalProject(a=[$1], ts=[$0], b=[$2])
@@ -692,9 +691,10 @@ LogicalProject(b=[$2], ts=[$0], a=[$1])
     <Resource name="optimized rel plan">
       <![CDATA[
 Union(all=[true], union=[b, ts, a], changelogMode=[I,UA,D])
-:- Calc(select=[b, ts, a], changelogMode=[I,UA,D])
-:  +- DropUpdateBefore(changelogMode=[I,UA,D])
-:     +- TableSourceScan(table=[[default_catalog, default_database, changelog_src]], fields=[ts, a, b], changelogMode=[I,UB,UA,D])
+:- Calc(select=[b, ts, CAST(a AS INTEGER) AS a], changelogMode=[I,UA,D])
+:  +- ChangelogNormalize(key=[a], changelogMode=[I,UA,D])
+:     +- Exchange(distribution=[hash[a]], changelogMode=[UA,PD])
+:        +- TableSourceScan(table=[[default_catalog, default_database, upsert_src]], fields=[ts, a, b], changelogMode=[UA,PD])
 +- Calc(select=[b, t AS ts, a], changelogMode=[I,UA])
    +- GroupAggregate(groupBy=[a], select=[a, MAX(ts) AS t, MAX(b) AS b], changelogMode=[I,UA])
       +- Exchange(distribution=[hash[a]], changelogMode=[I])
@@ -745,6 +745,26 @@ Calc(select=[id, Reinterpret(TO_TIMESTAMP(c)) AS ts], changelogMode=[I,UA,D])
 +- ChangelogNormalize(key=[id], changelogMode=[I,UA,D])
    +- Exchange(distribution=[hash[id]], changelogMode=[UA,PD])
       +- TableSourceScan(table=[[default_catalog, default_database, src, project=[id, c], metadata=[], watermark=[-(TO_TIMESTAMP(c), 1000:INTERVAL SECOND)], watermarkEmitStrategy=[on-periodic]]], fields=[id, c], changelogMode=[UA,PD])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWatermarkAndChangelogSource">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM src WHERE a > 1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(ts=[$0], a=[$1], b=[$2])
++- LogicalFilter(condition=[>($1, 1)])
+   +- LogicalWatermarkAssigner(rowtime=[ts], watermark=[-($0, 5000:INTERVAL SECOND)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[ts, a, b], where=[>(a, 1)], changelogMode=[I,UB,UA,D])
++- WatermarkAssigner(rowtime=[ts], watermark=[-(ts, 5000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[ts, a, b], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
@@ -771,26 +791,6 @@ Calc(select=[w$start AS EXPR$0, EXPR$1], changelogMode=[I])
 +- GroupWindowAggregate(window=[TumblingGroupWindow('w$, $f2, 10000)], properties=[w$start, w$end, w$proctime], select=[COUNT(*) AS EXPR$1, start('w$) AS w$start, end('w$) AS w$end, proctime('w$) AS w$proctime], changelogMode=[I])
    +- Exchange(distribution=[single], changelogMode=[I,UB,UA])
       +- TableSourceScan(table=[[default_catalog, default_database, src, project=[a], metadata=[]]], fields=[a], changelogMode=[I,UB,UA])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWatermarkAndChangelogSource">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM src WHERE a > 1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(ts=[$0], a=[$1], b=[$2])
-+- LogicalFilter(condition=[>($1, 1)])
-   +- LogicalWatermarkAssigner(rowtime=[ts], watermark=[-($0, 5000:INTERVAL SECOND)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[ts, a, b], where=[>(a, 1)], changelogMode=[I,UB,UA,D])
-+- WatermarkAssigner(rowtime=[ts], watermark=[-(ts, 5000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[ts, a, b], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml
index 6c99c4a5e0f..1c4bfc45466 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml
@@ -32,7 +32,7 @@ Sink(table=[default_catalog.default_database.appendSink], fields=[EXPR$0, c], ch
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendStreamToSinkWithoutPkForceKeyBy">
+  <TestCase name="testAppendStreamToSinkWithPkAutoKeyBy">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.sink], fields=[id, city_name])
@@ -54,23 +54,34 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
     "type" : "Source: source[]",
     "pact" : "Data Source",
     "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, source]], fields=[id, city_name])",
-    "parallelism" : 4
+    "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "ConstraintEnforcer[]",
+    "pact" : "Operator",
+    "contents" : "[]:ConstraintEnforcer[NotNullEnforcer(fields=[id])]",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
   }, {
     "id" : ,
     "type" : "Sink: sink[]",
     "pact" : "Data Sink",
     "contents" : "[]:Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])",
-    "parallelism" : 4,
+    "parallelism" : 9,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "FORWARD",
+      "ship_strategy" : "HASH",
       "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendStreamToSinkWithoutPkForceKeyBySingleParallelism">
+  <TestCase name="testAppendStreamToSinkWithPkForceKeyBy">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.sink], fields=[id, city_name])
@@ -93,22 +104,33 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
     "pact" : "Data Source",
     "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, source]], fields=[id, city_name])",
     "parallelism" : 4
+  }, {
+    "id" : ,
+    "type" : "ConstraintEnforcer[]",
+    "pact" : "Operator",
+    "contents" : "[]:ConstraintEnforcer[NotNullEnforcer(fields=[id])]",
+    "parallelism" : 4,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
   }, {
     "id" : ,
     "type" : "Sink: sink[]",
     "pact" : "Data Sink",
     "contents" : "[]:Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])",
-    "parallelism" : 1,
+    "parallelism" : 4,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "REBALANCE",
+      "ship_strategy" : "HASH",
       "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendStreamToSinkWithPkAutoKeyBy">
+  <TestCase name="testAppendStreamToSinkWithPkNoKeyBy">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.sink], fields=[id, city_name])
@@ -150,14 +172,14 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
     "parallelism" : 9,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "HASH",
+      "ship_strategy" : "REBALANCE",
       "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendStreamToSinkWithPkForceKeyBy">
+  <TestCase name="testAppendStreamToSinkWithoutPkForceKeyBy">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.sink], fields=[id, city_name])
@@ -180,17 +202,6 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
     "pact" : "Data Source",
     "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, source]], fields=[id, city_name])",
     "parallelism" : 4
-  }, {
-    "id" : ,
-    "type" : "ConstraintEnforcer[]",
-    "pact" : "Operator",
-    "contents" : "[]:ConstraintEnforcer[NotNullEnforcer(fields=[id])]",
-    "parallelism" : 4,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
   }, {
     "id" : ,
     "type" : "Sink: sink[]",
@@ -199,14 +210,14 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
     "parallelism" : 4,
     "predecessors" : [ {
       "id" : ,
-      "ship_strategy" : "HASH",
+      "ship_strategy" : "FORWARD",
       "side" : "second"
     } ]
   } ]
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAppendStreamToSinkWithPkNoKeyBy">
+  <TestCase name="testAppendStreamToSinkWithoutPkForceKeyBySingleParallelism">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalSink(table=[default_catalog.default_database.sink], fields=[id, city_name])
@@ -228,24 +239,13 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
     "type" : "Source: source[]",
     "pact" : "Data Source",
     "contents" : "[]:TableSourceScan(table=[[default_catalog, default_database, source]], fields=[id, city_name])",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "ConstraintEnforcer[]",
-    "pact" : "Operator",
-    "contents" : "[]:ConstraintEnforcer[NotNullEnforcer(fields=[id])]",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
+    "parallelism" : 4
   }, {
     "id" : ,
     "type" : "Sink: sink[]",
     "pact" : "Data Sink",
     "contents" : "[]:Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])",
-    "parallelism" : 9,
+    "parallelism" : 1,
     "predecessors" : [ {
       "id" : ,
       "ship_strategy" : "REBALANCE",
@@ -255,50 +255,6 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInsertPartColumn">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.zm_test], targetColumns=[[0]], fields=[a, m1, m2, m3, m4])
-+- LogicalProject(a=[CAST($0):BIGINT], m1=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP], m2=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP], m3=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP], m4=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.zm_test], targetColumns=[[0]], fields=[a, m1, m2, m3, m4], changelogMode=[NONE])
-+- Calc(select=[CAST(a AS BIGINT) AS a, null:(VARCHAR(2147483647), BIGINT) MAP AS m1, null:(VARCHAR(2147483647), BIGINT) MAP AS m2, null:(VARCHAR(2147483647), BIGINT) MAP AS m3, null:(VARCHAR(2147483647), BIGINT) MAP AS m4], changelogMode=[I])
-   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-	<TestCase name="testDistribution">
-		<Resource name="ast">
-			<![CDATA[
-LogicalSink(table=[default_catalog.default_database.sink], fields=[a, b])
-+- LogicalSort(sort0=[$0], dir0=[ASC-nulls-first])
-   +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Sink(table=[default_catalog.default_database.sink], fields=[a, b])
-+- Sort(orderBy=[a ASC])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[a, b])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-		</Resource>
-		<Resource name="optimized rel plan">
-			<![CDATA[
-Sink(table=[default_catalog.default_database.sink], fields=[a, b])
-+- Sort(orderBy=[a ASC])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[a, b])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-		</Resource>
-	</TestCase>
   <TestCase name="testAppendUpsertAndRetractSink">
     <Resource name="ast">
       <![CDATA[
@@ -513,6 +469,41 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name, ts, r
 }]]>
     </Resource>
   </TestCase>
+  <TestCase name="testDistribution">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink], fields=[a, b])
++- LogicalSort(sort0=[$0], dir0=[ASC-nulls-first])
+   +- LogicalProject(a=[$0], b=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink], fields=[a, b])
++- Sort(orderBy=[a ASC])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[a, b])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInsertPartColumn">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.zm_test], targetColumns=[[0]], fields=[a, m1, m2, m3, m4])
++- LogicalProject(a=[CAST($0):BIGINT], m1=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP], m2=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP], m3=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP], m4=[null:(VARCHAR(2147483647) CHARACTER SET "UTF-16LE", BIGINT) MAP])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.zm_test], targetColumns=[[0]], fields=[a, m1, m2, m3, m4], changelogMode=[NONE])
++- Calc(select=[CAST(a AS BIGINT) AS a, null:(VARCHAR(2147483647), BIGINT) MAP AS m1, null:(VARCHAR(2147483647), BIGINT) MAP AS m2, null:(VARCHAR(2147483647), BIGINT) MAP AS m3, null:(VARCHAR(2147483647), BIGINT) MAP AS m4], changelogMode=[I])
+   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testInsertWithTargetColumnsAndSqlHint">
     <Resource name="ast">
       <![CDATA[
@@ -675,25 +666,6 @@ Sink(table=[default_catalog.default_database.retractSink], fields=[cnt, a], chan
          +- Exchange(distribution=[hash[a]], changelogMode=[I])
             +- Calc(select=[a], changelogMode=[I])
                +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUpsertSink">
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.upsertSink], fields=[a, cnt])
-+- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-   +- LogicalProject(a=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.upsertSink], fields=[a, cnt], changelogMode=[NONE])
-+- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt], changelogMode=[I,UA])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I])
-      +- Calc(select=[a], changelogMode=[I])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -746,6 +718,40 @@ Sink(table=[default_catalog.default_database.sink], fields=[id, city_name])
 }]]>
     </Resource>
   </TestCase>
+  <TestCase name="testSinkDisorderChangeLogWithJoin">
+    <Resource name="sql">
+      <![CDATA[
+INSERT INTO SinkJoinChangeLog
+SELECT T.person, T.sum_votes, award.prize FROM
+   (SELECT person, SUM(votes) AS sum_votes FROM src GROUP BY person) T, award
+   WHERE T.sum_votes = award.votes
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.SinkJoinChangeLog], fields=[person, sum_votes, prize])
++- LogicalProject(person=[$0], sum_votes=[$1], prize=[$3])
+   +- LogicalFilter(condition=[=($1, $2)])
+      +- LogicalJoin(condition=[true], joinType=[inner])
+         :- LogicalAggregate(group=[{0}], sum_votes=[SUM($1)])
+         :  +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, award]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.SinkJoinChangeLog], fields=[person, sum_votes, prize], upsertMaterialize=[true])
++- Calc(select=[person, sum_votes, prize])
+   +- Join(joinType=[InnerJoin], where=[(sum_votes = votes)], select=[person, sum_votes, votes, prize], leftInputSpec=[HasUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
+      :- Exchange(distribution=[hash[sum_votes]])
+      :  +- GroupAggregate(groupBy=[person], select=[person, SUM(votes) AS sum_votes])
+      :     +- Exchange(distribution=[hash[person]])
+      :        +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[person, votes])
+      +- Exchange(distribution=[hash[votes]])
+         +- TableSourceScan(table=[[default_catalog, default_database, award]], fields=[votes, prize])
+]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testSinkDisorderChangeLogWithRank">
     <Resource name="sql">
       <![CDATA[
@@ -779,6 +785,25 @@ Sink(table=[default_catalog.default_database.SinkRankChangeLog], fields=[person,
             +- GroupAggregate(groupBy=[person], select=[person, SUM(votes) AS sum_votes])
                +- Exchange(distribution=[hash[person]])
                   +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[person, votes])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUpsertSink">
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.upsertSink], fields=[a, cnt])
++- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+   +- LogicalProject(a=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.upsertSink], fields=[a, cnt], changelogMode=[NONE])
++- GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt], changelogMode=[I,UA])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I])
+      +- Calc(select=[a], changelogMode=[I])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -801,40 +826,6 @@ Sink(table=[default_catalog.default_database.upsertSink], fields=[a, cnt], chang
       +- Exchange(distribution=[hash[a]], changelogMode=[I])
          +- Calc(select=[a], changelogMode=[I])
             +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSinkDisorderChangeLogWithJoin">
-    <Resource name="sql">
-      <![CDATA[
-INSERT INTO SinkJoinChangeLog
-SELECT T.person, T.sum_votes, award.prize FROM
-   (SELECT person, SUM(votes) AS sum_votes FROM src GROUP BY person) T, award
-   WHERE T.sum_votes = award.votes
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalSink(table=[default_catalog.default_database.SinkJoinChangeLog], fields=[person, sum_votes, prize])
-+- LogicalProject(person=[$0], sum_votes=[$1], prize=[$3])
-   +- LogicalFilter(condition=[=($1, $2)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalAggregate(group=[{0}], sum_votes=[SUM($1)])
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, src]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, award]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Sink(table=[default_catalog.default_database.SinkJoinChangeLog], fields=[person, sum_votes, prize], upsertMaterialize=[true])
-+- Calc(select=[person, sum_votes, prize])
-   +- Join(joinType=[InnerJoin], where=[(sum_votes = votes)], select=[person, sum_votes, votes, prize], leftInputSpec=[HasUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
-      :- Exchange(distribution=[hash[sum_votes]])
-      :  +- GroupAggregate(groupBy=[person], select=[person, SUM(votes) AS sum_votes])
-      :     +- Exchange(distribution=[hash[person]])
-      :        +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[person, votes])
-      +- Exchange(distribution=[hash[votes]])
-         +- TableSourceScan(table=[[default_catalog, default_database, award]], fields=[votes, prize])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml
index 25e49f40e4d..8b53de0c16c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml
@@ -105,24 +105,6 @@ LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.
       <![CDATA[
 Calc(select=[id, deepNested.nested1 AS nested1, ((deepNested.nested1.value + deepNested.nested2.num) + metadata_1) AS results])
 +- TableSourceScan(table=[[default_catalog, default_database, T, project=[id, deepNested], metadata=[metadata_1]]], fields=[id, deepNested, metadata_1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProjectionPushDownOnly">
-    <Resource name="sql">
-      <![CDATA[SELECT id, ts1, tags FROM src]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], ts1=[$5], tags=[$2])
-+- LogicalProject(id=[$0], name=[$1], tags=[$2], op=[$3], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[id, (ts + 10000:INTERVAL SECOND) AS ts1, tags])
-+- TableSourceScan(table=[[default_catalog, default_database, src, project=[id, ts, tags], metadata=[]]], fields=[id, ts, tags])
 ]]>
     </Resource>
   </TestCase>
@@ -204,21 +186,21 @@ Calc(select=[PROCTIME_MATERIALIZE(ptime) AS ptime, name, val, id])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testReadsComputedColumnWithoutProjectionPushDown">
+  <TestCase name="testProjectionPushDownOnly">
     <Resource name="sql">
-      <![CDATA[SELECT id, ts1, op FROM src]]>
+      <![CDATA[SELECT id, ts1, tags FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts1=[$5], op=[$3])
-+- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]])
+LogicalProject(id=[$0], ts1=[$5], tags=[$2])
++- LogicalProject(id=[$0], name=[$1], tags=[$2], op=[$3], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, (ts + 10000:INTERVAL SECOND) AS ts1, CAST(op AS VARCHAR(2147483647)) AS op])
-+- TableSourceScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]], fields=[id, name, op, tags, ts])
+Calc(select=[id, (ts + 10000:INTERVAL SECOND) AS ts1, tags])
++- TableSourceScan(table=[[default_catalog, default_database, src, project=[id, ts, tags], metadata=[]]], fields=[id, ts, tags])
 ]]>
     </Resource>
   </TestCase>
@@ -240,34 +222,21 @@ Calc(select=[id, (ts + 10000:INTERVAL SECOND) AS ts1, CAST(op AS VARCHAR(2147483
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeTableSourceGroupWindow">
+  <TestCase name="testReadsComputedColumnWithoutProjectionPushDown">
     <Resource name="sql">
-      <![CDATA[
-SELECT name,
-    TUMBLE_END(rowtime, INTERVAL '10' MINUTE),
-    AVG(val)
-FROM rowTimeT WHERE val > 100
-   GROUP BY name, TUMBLE(rowtime, INTERVAL '10' MINUTE)
-      ]]>
+      <![CDATA[SELECT id, ts1, op FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(name=[$0], EXPR$1=[TUMBLE_END($1)], EXPR$2=[$2])
-+- LogicalAggregate(group=[{0, 1}], EXPR$2=[AVG($2)])
-   +- LogicalProject(name=[$3], $f1=[$TUMBLE($1, 600000:INTERVAL MINUTE)], val=[$2])
-      +- LogicalFilter(condition=[>($2, 100)])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
+LogicalProject(id=[$0], ts1=[$5], op=[$3])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[name, w$end AS EXPR$1, EXPR$2])
-+- GroupWindowAggregate(groupBy=[name], window=[TumblingGroupWindow('w$, rowtime, 600000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[name, AVG(val) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
-   +- Exchange(distribution=[hash[name]])
-      +- Calc(select=[rowtime, val, name], where=[(val > 100)])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-            +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT, project=[rowtime, val, name], metadata=[]]], fields=[rowtime, val, name])
+Calc(select=[id, (ts + 10000:INTERVAL SECOND) AS ts1, CAST(op AS VARCHAR(2147483647)) AS op])
++- TableSourceScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]], fields=[id, name, op, tags, ts])
 ]]>
     </Resource>
   </TestCase>
@@ -289,7 +258,7 @@ Calc(select=[ts, id, name, CAST(tags AS VARCHAR(2147483647)) AS tags, CAST(op AS
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testReadsMetaDataWithoutProjectionPushDown">
+  <TestCase name="testReadsMetaDataWithProjectionPushDown">
     <Resource name="sql">
       <![CDATA[SELECT id, ts, tags FROM src]]>
     </Resource>
@@ -303,44 +272,56 @@ LogicalProject(id=[$0], ts=[$4], tags=[$2])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[id, ts, CAST(tags AS VARCHAR(2147483647)) AS tags])
-+- TableSourceScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]], fields=[id, name, op, tags, ts])
++- TableSourceScan(table=[[default_catalog, default_database, src, project=[id], metadata=[tags, ts]]], fields=[id, tags, ts])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableSourceWithTimestampRowTimeField">
+  <TestCase name="testReadsMetaDataWithoutProjectionPushDown">
     <Resource name="sql">
-      <![CDATA[SELECT rowtime, id, name, val FROM rowTimeT]]>
+      <![CDATA[SELECT id, ts, tags FROM src]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(rowtime=[$1], id=[$0], name=[$3], val=[$2])
-+- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
+LogicalProject(id=[$0], ts=[$4], tags=[$2])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[rowtime, id, name, val])
-+- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-   +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
+Calc(select=[id, ts, CAST(tags AS VARCHAR(2147483647)) AS tags])
++- TableSourceScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]], fields=[id, name, op, tags, ts])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testReadsMetaDataWithProjectionPushDown">
+  <TestCase name="testRowTimeTableSourceGroupWindow">
     <Resource name="sql">
-      <![CDATA[SELECT id, ts, tags FROM src]]>
+      <![CDATA[
+SELECT name,
+    TUMBLE_END(rowtime, INTERVAL '10' MINUTE),
+    AVG(val)
+FROM rowTimeT WHERE val > 100
+   GROUP BY name, TUMBLE(rowtime, INTERVAL '10' MINUTE)
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts=[$4], tags=[$2])
-+- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, src, metadata=[op, tags, ts]]])
+LogicalProject(name=[$0], EXPR$1=[TUMBLE_END($1)], EXPR$2=[$2])
++- LogicalAggregate(group=[{0, 1}], EXPR$2=[AVG($2)])
+   +- LogicalProject(name=[$3], $f1=[$TUMBLE($1, 600000:INTERVAL MINUTE)], val=[$2])
+      +- LogicalFilter(condition=[>($2, 100)])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[id, ts, CAST(tags AS VARCHAR(2147483647)) AS tags])
-+- TableSourceScan(table=[[default_catalog, default_database, src, project=[id], metadata=[tags, ts]]], fields=[id, tags, ts])
+Calc(select=[name, w$end AS EXPR$1, EXPR$2])
++- GroupWindowAggregate(groupBy=[name], window=[TumblingGroupWindow('w$, rowtime, 600000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[name, AVG(val) AS EXPR$2, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+   +- Exchange(distribution=[hash[name]])
+      +- Calc(select=[rowtime, val, name], where=[(val > 100)])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+            +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT, project=[rowtime, val, name], metadata=[]]], fields=[rowtime, val, name])
 ]]>
     </Resource>
   </TestCase>
@@ -359,6 +340,25 @@ LogicalProject(rowtime=[$1], id=[$0], name=[$3], val=[$2])
       <![CDATA[
 Calc(select=[rowtime, id, name, val])
 +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT, watermark=[SOURCE_WATERMARK()]]], fields=[id, rowtime, val, name])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTableSourceWithTimestampRowTimeField">
+    <Resource name="sql">
+      <![CDATA[SELECT rowtime, id, name, val FROM rowTimeT]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(rowtime=[$1], id=[$0], name=[$3], val=[$2])
++- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[rowtime, id, name, val])
++- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+   +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnionTest.xml
index db3012d7868..2969cdc7486 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnionTest.xml
@@ -16,42 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testUnionDiffRowTime">
-    <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
- SELECT id, ts, name, timestamp_col FROM t1
- UNION ALL
- SELECT id, ts, name, timestamp_ltz_col FROM t2)
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
-+- LogicalUnion(all=[true]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
-   :- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
-   :  +- LogicalWatermarkAssigner(rowtime=[timestamp_col], watermark=[$3]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) *ROWTIME* timestamp_col, BIGINT val, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
-   :     +- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3], val=[$4], timestamp_ltz_col=[TO_TIMESTAMP_LTZ($1, 3)]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) timestamp_col, BIGINT val, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, t1]]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) timestamp_col, BIGINT val)]
-   +- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_ltz_col=[$4]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP_LTZ(3) *ROWTIME* timestamp_ltz_col)]
-      +- LogicalWatermarkAssigner(rowtime=[timestamp_ltz_col], watermark=[$4]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) timestamp_col, TIMESTAMP_LTZ(3) *ROWTIME* timestamp_ltz_col)]
-         +- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3], timestamp_ltz_col=[TO_TIMESTAMP_LTZ($1, 3)]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) timestamp_col, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
-            +- LogicalTableScan(table=[[default_catalog, default_database, t2]]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) timestamp_col)]
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Union(all=[true], union=[id, ts, name, timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
-:- Calc(select=[id, ts, CAST(name AS VARCHAR(2147483647)) AS name, timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
-:  +- WatermarkAssigner(rowtime=[timestamp_col], watermark=[timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
-:     +- TableSourceScan(table=[[default_catalog, default_database, t1, project=[id, ts, name, timestamp_col], metadata=[]]], fields=[id, ts, name, timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) timestamp_col)]
-+- Calc(select=[id, ts, name, CAST(timestamp_ltz_col AS TIMESTAMP(3) *ROWTIME*) AS timestamp_ltz_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_ltz_col)]
-   +- WatermarkAssigner(rowtime=[timestamp_ltz_col], watermark=[timestamp_ltz_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP_LTZ(3) *ROWTIME* timestamp_ltz_col)]
-      +- Calc(select=[id, ts, name, TO_TIMESTAMP_LTZ(ts, 3) AS timestamp_ltz_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
-         +- TableSourceScan(table=[[default_catalog, default_database, t2, project=[id, ts, name], metadata=[]]], fields=[id, ts, name]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name)]
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testUnionAll">
     <Resource name="sql">
       <![CDATA[
@@ -117,6 +81,42 @@ Union(all=[true], union=[a, b]), rowType=[RecordType(INTEGER a, DECIMAL(20, 1) b
 :  +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[a, b, c]), rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c)]
 +- Calc(select=[a, CAST(0.0 AS DECIMAL(20, 1)) AS EXPR$1]), rowType=[RecordType(INTEGER a, DECIMAL(20, 1) EXPR$1)]
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c]), rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c)]
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnionDiffRowTime">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+ SELECT id, ts, name, timestamp_col FROM t1
+ UNION ALL
+ SELECT id, ts, name, timestamp_ltz_col FROM t2)
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
++- LogicalUnion(all=[true]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
+   :- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
+   :  +- LogicalWatermarkAssigner(rowtime=[timestamp_col], watermark=[$3]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) *ROWTIME* timestamp_col, BIGINT val, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
+   :     +- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3], val=[$4], timestamp_ltz_col=[TO_TIMESTAMP_LTZ($1, 3)]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) timestamp_col, BIGINT val, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, t1]]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) timestamp_col, BIGINT val)]
+   +- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_ltz_col=[$4]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP_LTZ(3) *ROWTIME* timestamp_ltz_col)]
+      +- LogicalWatermarkAssigner(rowtime=[timestamp_ltz_col], watermark=[$4]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) timestamp_col, TIMESTAMP_LTZ(3) *ROWTIME* timestamp_ltz_col)]
+         +- LogicalProject(id=[$0], ts=[$1], name=[$2], timestamp_col=[$3], timestamp_ltz_col=[TO_TIMESTAMP_LTZ($1, 3)]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) timestamp_col, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
+            +- LogicalTableScan(table=[[default_catalog, default_database, t2]]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) timestamp_col)]
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Union(all=[true], union=[id, ts, name, timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
+:- Calc(select=[id, ts, CAST(name AS VARCHAR(2147483647)) AS name, timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
+:  +- WatermarkAssigner(rowtime=[timestamp_col], watermark=[timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) *ROWTIME* timestamp_col)]
+:     +- TableSourceScan(table=[[default_catalog, default_database, t1, project=[id, ts, name, timestamp_col], metadata=[]]], fields=[id, ts, name, timestamp_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(32) name, TIMESTAMP(3) timestamp_col)]
++- Calc(select=[id, ts, name, CAST(timestamp_ltz_col AS TIMESTAMP(3) *ROWTIME*) AS timestamp_ltz_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP(3) *ROWTIME* timestamp_ltz_col)]
+   +- WatermarkAssigner(rowtime=[timestamp_ltz_col], watermark=[timestamp_ltz_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP_LTZ(3) *ROWTIME* timestamp_ltz_col)]
+      +- Calc(select=[id, ts, name, TO_TIMESTAMP_LTZ(ts, 3) AS timestamp_ltz_col]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) timestamp_ltz_col)]
+         +- TableSourceScan(table=[[default_catalog, default_database, t2, project=[id, ts, name], metadata=[]]], fields=[id, ts, name]), rowType=[RecordType(INTEGER id, BIGINT ts, VARCHAR(2147483647) name)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnnestTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnnestTest.xml
index 77d1e1a758b..c33bc89966d 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnnestTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/UnnestTest.xml
@@ -16,26 +16,7 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-	<TestCase name="testUnnestWithValues">
-		<Resource name="sql">
-			<![CDATA[SELECT * FROM UNNEST(ARRAY[1,2,3])]]>
-		</Resource>
-		<Resource name="ast">
-			<![CDATA[
-LogicalProject(EXPR$0=[$0])
-+- Uncollect
-   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
-      +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-		</Resource>
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Correlate(invocation=[$UNNEST_ROWS$1(ARRAY(1, 2, 3))], correlate=[table($UNNEST_ROWS$1(ARRAY(1, 2, 3)))], select=[f0], rowType=[RecordType:peek_no_expand(INTEGER f0)], joinType=[INNER])
-+- Values(tuples=[[{  }]])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testCrossWithUnnest">
+  <TestCase name="testCrossWithUnnest">
     <Resource name="sql">
       <![CDATA[SELECT a, s FROM MyTable, UNNEST(MyTable.c) as A (s)]]>
     </Resource>
@@ -142,33 +123,6 @@ Calc(select=[a, f0 AS s])
       +- Exchange(distribution=[hash[a]])
          +- Calc(select=[a, b], where=[(a < 5)])
             +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testUnnestWithInvalidLookupJoinHint">
-    <Resource name="sql">
-      <![CDATA[
-SELECT /*+ LOOKUP('table'='D', 'retry-predicate'='lookup_miss','retry-strategy'='fixed_delay', 
-         'fixed-delay'='155 ms', 'max-attempts'='10') */ T2.a
-FROM T2 CROSS JOIN UNNEST(T2.b) AS D(c)
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}], joinHints=[[[LOOKUP inheritPath:[0] options:{retry-strategy=fixed_delay, max-attempts=10, fixed-delay=155 ms, retry-predicate=lookup_miss, table=D}]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
-   +- LogicalProject(c=[$0])
-      +- Uncollect
-         +- LogicalProject(b=[$cor0.b])
-            +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a])
-+- Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,f0], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER f0)], joinType=[INNER])
-   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -260,6 +214,29 @@ Calc(select=[b, _1 AS id, _2 AS point])
       +- Exchange(distribution=[hash[b]])
          +- Calc(select=[b, c], where=[(b < 3)])
             +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnnestObjectArrayFromTableWithFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT a, b, s, t FROM MyTable, UNNEST(MyTable.b) AS A (s, t) WHERE s > 13]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], s=[$2], t=[$3])
++- LogicalFilter(condition=[>($2, 13)])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(s=[$0], t=[$1])
+         +- Uncollect
+            +- LogicalProject(b=[$cor0.b])
+               +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,_1,_2], rowType=[RecordType(INTEGER a, RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2) ARRAY b, INTEGER _1, VARCHAR(2147483647) _2)], joinType=[INNER], condition=[>($0, 13)])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -308,26 +285,30 @@ Calc(select=[a, b, f0 AS s])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnnestObjectArrayFromTableWithFilter">
+  <TestCase name="testUnnestWithInvalidLookupJoinHint">
     <Resource name="sql">
-      <![CDATA[SELECT a, b, s, t FROM MyTable, UNNEST(MyTable.b) AS A (s, t) WHERE s > 13]]>
+      <![CDATA[
+SELECT /*+ LOOKUP('table'='D', 'retry-predicate'='lookup_miss','retry-strategy'='fixed_delay',
+         'fixed-delay'='155 ms', 'max-attempts'='10') */ T2.a
+FROM T2 CROSS JOIN UNNEST(T2.b) AS D(c)
+]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], s=[$2], t=[$3])
-+- LogicalFilter(condition=[>($2, 13)])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalProject(s=[$0], t=[$1])
-         +- Uncollect
-            +- LogicalProject(b=[$cor0.b])
-               +- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(a=[$0])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}], joinHints=[[[LOOKUP inheritPath:[0] options:{retry-strategy=fixed_delay, max-attempts=10, fixed-delay=155 ms, retry-predicate=lookup_miss, table=D}]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T2]], hints=[[[ALIAS inheritPath:[] options:[T2]]]])
+   +- LogicalProject(c=[$0])
+      +- Uncollect
+         +- LogicalProject(b=[$cor0.b])
+            +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,_1,_2], rowType=[RecordType(INTEGER a, RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2) ARRAY b, INTEGER _1, VARCHAR(2147483647) _2)], joinType=[INNER], condition=[>($0, 13)])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+Calc(select=[a])
++- Correlate(invocation=[$UNNEST_ROWS$1($cor0.b)], correlate=[table($UNNEST_ROWS$1($cor0.b))], select=[a,b,f0], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER f0)], joinType=[INNER])
+   +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -486,6 +467,38 @@ LogicalProject(a=[$0], b=[$1], _1=[$2], _2=[$3], ORDINALITY=[$4])
       <![CDATA[
 Correlate(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], correlate=[table($UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b))], select=[a,b,_1,_2,ORDINALITY], rowType=[RecordType(INTEGER a, RecordType:peek_no_expand(INTEGER _1, VARCHAR(2147483647) _2) ARRAY b, INTEGER _1, VARCHAR(2147483647) _2, INTEGER ORDINALITY)], joinType=[INNER], condition=[>($0, 1)])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testUnnestWithOrdinalityInSubquery">
+    <Resource name="sql">
+      <![CDATA[
+SELECT * FROM (
+  SELECT a, number, ordinality
+  FROM MyTable
+  CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
+) subquery
+WHERE ordinality = 1
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], number=[$1], ordinality=[$2])
++- LogicalFilter(condition=[=($2, 1)])
+   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
+      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
+         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalProject(number=[$0], ordinality=[$1])
+            +- Uncollect(withOrdinality=[true])
+               +- LogicalProject(b=[$cor0.b])
+                  +- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, number, ordinality])
++- Correlate(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], correlate=[table($UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b))], select=[a,b,number,ordinality], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER number, INTEGER ordinality)], joinType=[INNER], condition=[=($1, 1)])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -547,8 +560,8 @@ Calc(select=[a, EXPR$0 AS word, ORDINALITY AS pos])
   <TestCase name="testUnnestWithOrdinalityWithFilter">
     <Resource name="sql">
       <![CDATA[
-SELECT a, number, ordinality 
-FROM MyTable 
+SELECT a, number, ordinality
+FROM MyTable
 CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
 WHERE number > 10 AND ordinality < 3
 ]]>
@@ -573,35 +586,22 @@ Calc(select=[a, EXPR$0 AS number, ORDINALITY AS ordinality])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testUnnestWithOrdinalityInSubquery">
+  <TestCase name="testUnnestWithValues">
     <Resource name="sql">
-      <![CDATA[
-SELECT * FROM (
-  SELECT a, number, ordinality 
-  FROM MyTable 
-  CROSS JOIN UNNEST(b) WITH ORDINALITY AS t(number, ordinality)
-) subquery 
-WHERE ordinality = 1
-]]>
+      <![CDATA[SELECT * FROM UNNEST(ARRAY[1,2,3])]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], number=[$1], ordinality=[$2])
-+- LogicalFilter(condition=[=($2, 1)])
-   +- LogicalProject(a=[$0], number=[$2], ordinality=[$3])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
-         :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         +- LogicalProject(number=[$0], ordinality=[$1])
-            +- Uncollect(withOrdinality=[true])
-               +- LogicalProject(b=[$cor0.b])
-                  +- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(EXPR$0=[$0])
++- Uncollect
+   +- LogicalProject(EXPR$0=[ARRAY(1, 2, 3)])
+      +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, number, ordinality])
-+- Correlate(invocation=[$UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b)], correlate=[table($UNNEST_ROWS_WITH_ORDINALITY$1($cor0.b))], select=[a,b,number,ordinality], rowType=[RecordType(INTEGER a, INTEGER ARRAY b, INTEGER number, INTEGER ordinality)], joinType=[INNER], condition=[=($1, 1)])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b])
+Correlate(invocation=[$UNNEST_ROWS$1(ARRAY(1, 2, 3))], correlate=[table($UNNEST_ROWS$1(ARRAY(1, 2, 3)))], select=[f0], rowType=[RecordType:peek_no_expand(INTEGER f0)], joinType=[INNER])
++- Values(tuples=[[{  }]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml
index 48aac784bb2..098ecd36f34 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml
@@ -38,22 +38,6 @@ Union(all=[true], union=[EXPR$0, EXPR$1]), rowType=[RecordType(INTEGER EXPR$0, D
 :  +- Values(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
 +- Calc(select=[3 AS EXPR$0, 4.0 AS EXPR$1]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(20, 1) EXPR$1)]
    +- Values(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleRow">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM (VALUES (1, 2, 3)) AS T(a, b, c)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalValues(tuples=[[{ 1, 2, 3 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Values(tuples=[[{ 1, 2, 3 }]])
 ]]>
     </Resource>
   </TestCase>
@@ -101,6 +85,22 @@ LogicalProject(EXPR$0=[$0])
       <![CDATA[
 Calc(select=[null:INTEGER AS EXPR$0])
 +- Values(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleRow">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (VALUES (1, 2, 3)) AS T(a, b, c)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalValues(tuples=[[{ 1, 2, 3 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Values(tuples=[[{ 1, 2, 3 }]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/VectorSearchTableFunctionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/VectorSearchTableFunctionTest.xml
index 4cae7258fea..bbcb4e474d2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/VectorSearchTableFunctionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/VectorSearchTableFunctionTest.xml
@@ -247,62 +247,62 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSearchTableWithProjection">
+  <TestCase name="testSearchTableWithMetadataTable">
     <Resource name="sql">
       <![CDATA[SELECT * FROM QueryTable, LATERAL TABLE(
-VECTOR_SEARCH(
-    (SELECT add_one(e) as e1, g, proctime FROM VectorTableWithProctime), DESCRIPTOR(`g`), QueryTable.d, 10))]]>
+  VECTOR_SEARCH(
+    TABLE VectorTableWithMetadata,
+    DESCRIPTOR(`g`),
+    QueryTable.d,
+    10  )
+)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e1=[$6], g=[$7], proctime0=[$8], score=[$9])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$6], f=[$7], g=[$8], h=[$9], score=[$10])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3}])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
    :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, QueryTable]])
-   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(BIGINT e1, FLOAT ARRAY g, TIMESTAMP_LTZ(3) *PROCTIME* proctime, DOUBLE score)])
-      +- LogicalProject(e1=[add_one(CAST($0):BIGINT)], g=[$2], proctime=[$3])
-         +- LogicalProject(e=[$0], f=[$1], g=[$2], proctime=[PROCTIME()])
-            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithProctime]])
+   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(INTEGER e, FLOAT ARRAY f, FLOAT ARRAY g, INTEGER h, DOUBLE score)])
+      +- LogicalProject(e=[$0], f=[$1], g=[$2], h=[$3])
+         +- LogicalProject(e=[$0], f=[$2], g=[$1], h=[+($0, 1)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithMetadata, metadata=[f]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e1, g, PROCTIME_MATERIALIZE(proctime0) AS proctime0, score])
-+- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithProctime], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, add_one(CAST(e AS BIGINT)) AS e1, g, PROCTIME() AS proctime0, score])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f, g, h, score])
++- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithMetadata], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, e, f, g, +(e, 1) AS h, score])
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, QueryTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSearchTableWithMetadataTable">
+  <TestCase name="testSearchTableWithProjection">
     <Resource name="sql">
       <![CDATA[SELECT * FROM QueryTable, LATERAL TABLE(
-  VECTOR_SEARCH(
-    TABLE VectorTableWithMetadata,
-    DESCRIPTOR(`g`),
-    QueryTable.d,
-    10  )
-)]]>
+VECTOR_SEARCH(
+    (SELECT add_one(e) as e1, g, proctime FROM VectorTableWithProctime), DESCRIPTOR(`g`), QueryTable.d, 10))]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e=[$6], f=[$7], g=[$8], h=[$9], score=[$10])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], e1=[$6], g=[$7], proctime0=[$8], score=[$9])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3}])
    :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
    :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, QueryTable]])
-   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(INTEGER e, FLOAT ARRAY f, FLOAT ARRAY g, INTEGER h, DOUBLE score)])
-      +- LogicalProject(e=[$0], f=[$1], g=[$2], h=[$3])
-         +- LogicalProject(e=[$0], f=[$2], g=[$1], h=[+($0, 1)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithMetadata, metadata=[f]]])
+   +- LogicalTableFunctionScan(invocation=[VECTOR_SEARCH(TABLE(#0), DESCRIPTOR(_UTF-16LE'g'), $cor0.d, 10)], rowType=[RecordType(BIGINT e1, FLOAT ARRAY g, TIMESTAMP_LTZ(3) *PROCTIME* proctime, DOUBLE score)])
+      +- LogicalProject(e1=[add_one(CAST($0):BIGINT)], g=[$2], proctime=[$3])
+         +- LogicalProject(e=[$0], f=[$1], g=[$2], proctime=[PROCTIME()])
+            +- LogicalTableScan(table=[[default_catalog, default_database, VectorTableWithProctime]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e, f, g, h, score])
-+- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithMetadata], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, e, f, g, +(e, 1) AS h, score])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, e1, g, PROCTIME_MATERIALIZE(proctime0) AS proctime0, score])
++- VectorSearchTableFunction(table=[default_catalog.default_database.VectorTableWithProctime], joinType=[InnerJoin], columnToSearch=[g], columnToQuery=[d], topK=[10], select=[a, b, c, d, rowtime, proctime, add_one(CAST(e AS BIGINT)) AS e1, g, PROCTIME() AS proctime0, score])
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, QueryTable]], fields=[a, b, c, d, rowtime])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml
index fa3bfb19827..0f121f15cbc 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml
@@ -90,62 +90,51 @@ Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTimeAttributePropagateForWindowDeduplicate">
+  <TestCase name="testOnWindowTVF">
     <Resource name="sql">
       <![CDATA[
-SELECT
-   window_start,
-   window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   weightedAvg(b, e) AS wAvg,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE tmp, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY window_start, window_end
+SELECT *
+FROM (
+SELECT *,
+   ROW_NUMBER() OVER(PARTITION BY a, window_start, window_end
+   ORDER BY rowtime DESC) as rownum
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+)
+WHERE rownum <= 1
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], wAvg=[weightedAvg($4, $5)], uv=[COUNT(DISTINCT $6)])
-+- LogicalProject(window_start=[$6], window_end=[$7], d=[$4], $f3=[IS TRUE(>($2, 1000))], b=[$2], e=[$5], c=[$3])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(rowtime=[$0], a=[$1], b=[$2], c=[$3], d=[$4], e=[$5])
-         +- LogicalProject(rowtime=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-            +- LogicalFilter(condition=[<=($10, 1)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 DESC NULLS LAST)])
-                  +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[$10])
++- LogicalFilter(condition=[<=($10, 1)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 DESC NULLS LAST)])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, wAvg, uv])
-+- GlobalWindowAggregate(window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[COUNT(count1$0) AS EXPR$2, SUM(sum$1) AS EXPR$3, MAX(max$2) AS EXPR$4, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[single])
-      +- LocalWindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f3 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Calc(select=[d, IS TRUE(>(b, 1000)) AS $f3, b, e, c, window_time AS rowtime])
-            +- WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])
-               +- Exchange(distribution=[hash[a]])
-                  +- Calc(select=[a, b, c, d, e, rowtime, window_start, window_end, window_time])
-                     +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
-                        +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-                           +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-                              +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, 1 AS w0$o0])
++- WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])
+   +- Exchange(distribution=[hash[a]])
+      +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnWindowTVF">
+  <TestCase name="testOnWindowTVFKeepFirstRow">
     <Resource name="sql">
       <![CDATA[
 SELECT *
 FROM (
 SELECT *,
    ROW_NUMBER() OVER(PARTITION BY a, window_start, window_end
-   ORDER BY rowtime DESC) as rownum
+   ORDER BY rowtime ASC) as rownum
 FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 )
 WHERE rownum <= 1
@@ -155,7 +144,7 @@ WHERE rownum <= 1
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[$10])
 +- LogicalFilter(condition=[<=($10, 1)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 DESC NULLS LAST)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 NULLS FIRST)])
       +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
             +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
@@ -166,7 +155,7 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, 1 AS w0$o0])
-+- WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])
++- WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[FirstRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])
    +- Exchange(distribution=[hash[a]])
       +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
          +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
@@ -250,40 +239,51 @@ Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOnWindowTVFKeepFirstRow">
+  <TestCase name="testTimeAttributePropagateForWindowDeduplicate">
     <Resource name="sql">
       <![CDATA[
-SELECT *
-FROM (
-SELECT *,
-   ROW_NUMBER() OVER(PARTITION BY a, window_start, window_end
-   ORDER BY rowtime ASC) as rownum
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-)
-WHERE rownum <= 1
+SELECT
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   weightedAvg(b, e) AS wAvg,
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE tmp, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY window_start, window_end
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[$10])
-+- LogicalFilter(condition=[<=($10, 1)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 NULLS FIRST)])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], wAvg=[weightedAvg($4, $5)], uv=[COUNT(DISTINCT $6)])
++- LogicalProject(window_start=[$6], window_end=[$7], d=[$4], $f3=[IS TRUE(>($2, 1000))], b=[$2], e=[$5], c=[$3])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(rowtime=[$0], a=[$1], b=[$2], c=[$3], d=[$4], e=[$5])
+         +- LogicalProject(rowtime=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
+            +- LogicalFilter(condition=[<=($10, 1)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 DESC NULLS LAST)])
+                  +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, 1 AS w0$o0])
-+- WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[FirstRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])
-   +- Exchange(distribution=[hash[a]])
-      +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, wAvg, uv])
++- GlobalWindowAggregate(window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[COUNT(count1$0) AS EXPR$2, SUM(sum$1) AS EXPR$3, MAX(max$2) AS EXPR$4, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[single])
+      +- LocalWindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f3 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Calc(select=[d, IS TRUE(>(b, 1000)) AS $f3, b, e, c, window_time AS rowtime])
+            +- WindowDeduplicate(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], keep=[LastRow], partitionKeys=[a], orderKey=[rowtime], order=[ROWTIME])
+               +- Exchange(distribution=[hash[a]])
+                  +- Calc(select=[a, b, c, d, e, rowtime, window_start, window_end, window_time])
+                     +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+                        +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+                           +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+                              +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml
index 5b553d5e558..07098bba996 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml
@@ -219,76 +219,63 @@ Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime,
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTimeAttributePropagateForWindowRank1">
+  <TestCase name="testSimplifyCumulateWindowTVFBeforeWindowRankWithCalc">
     <Resource name="sql">
       <![CDATA[
-SELECT
-   a,
-   window_start,
-   window_end,
-   sum(cnt),
-   sum(sum_d),
-   max(max_d)
-FROM TABLE(TUMBLE(TABLE tmp1, DESCRIPTOR(rowtime), INTERVAL '1' HOUR))
-GROUP BY a, window_start, window_end
+SELECT window_start, window_end, window_time, a, b, c, d, e
+FROM (
+SELECT *,
+   ROW_NUMBER() OVER(PARTITION BY a, window_start, window_end ORDER BY b DESC) as rownum
+FROM TABLE(
+  CUMULATE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+)
+WHERE rownum <= 3
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[MAX($5)])
-+- LogicalProject(a=[$1], window_start=[$7], window_end=[$8], cnt=[$2], sum_d=[$3], max_d=[$4])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 3600000:INTERVAL HOUR)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT cnt, DECIMAL(38, 3) sum_d, DECIMAL(10, 3) max_d, BIGINT wAvg, BIGINT uv, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(rowtime=[$0], a=[$1], cnt=[$2], sum_d=[$3], max_d=[$4], wAvg=[$5], uv=[$6])
-         +- LogicalProject(rowtime=[$3], a=[$0], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8])
-            +- LogicalFilter(condition=[<=($9, 3)])
-               +- LogicalProject(a=[$0], window_start=[$1], window_end=[$2], window_time=[$3], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $1, $2 ORDER BY $4 DESC NULLS LAST)])
-                  +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], sum_d=[SUM($4)], max_d=[MAX($4) FILTER $5], wAvg=[weightedAvg($6, $7)], uv=[COUNT(DISTINCT $8)])
-                     +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], window_time=[$9], d=[$3], $f5=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-                        +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                              +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                                 +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                                    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(window_start=[$7], window_end=[$8], window_time=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
++- LogicalFilter(condition=[<=($10, 3)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $1 DESC NULLS LAST)])
+      +- LogicalTableFunctionScan(invocation=[CUMULATE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5])
-+- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[1 h])], select=[a, SUM(sum$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, start('w$) AS window_start, end('w$) AS window_end])
+Calc(select=[window_start, window_end, window_time, a, b, c, d, e])
++- WindowRank(window=[CUMULATE(win_start=[window_start], win_end=[window_end], max_size=[1 h], step=[10 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, d, e, window_start, window_end, window_time])
    +- Exchange(distribution=[hash[a]])
-      +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[1 h])], select=[a, SUM(cnt) AS sum$0, SUM(sum_d) AS sum$1, MAX(max_d) AS max$2, slice_end('w$) AS $slice_end])
-         +- Calc(select=[a, cnt, sum_d, max_d, window_time AS rowtime])
-            +- WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[cnt DESC], select=[a, window_start, window_end, window_time, cnt, sum_d, max_d])
-               +- Exchange(distribution=[hash[a]])
-                  +- Calc(select=[a, window_start, window_end, window_time, cnt, sum_d, max_d])
-                     +- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, SUM(sum$1) AS sum_d, MAX(max$2) AS max_d, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])
-                        +- Exchange(distribution=[hash[a]])
-                           +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f5 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-                              +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f5, b, e, c, rowtime])
-                                 +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-                                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+      +- Calc(select=[a, b, c, d, e, window_start, window_end, window_time])
+         +- WindowTableFunction(window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+               +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimplifyCumulateWindowTVFBeforeWindowRankWithCalc">
+  <TestCase name="testSimplifyHopWindowTVFBeforeWindowRank">
     <Resource name="sql">
       <![CDATA[
-SELECT window_start, window_end, window_time, a, b, c, d, e
+SELECT *
 FROM (
 SELECT *,
    ROW_NUMBER() OVER(PARTITION BY a, window_start, window_end ORDER BY b DESC) as rownum
 FROM TABLE(
-  CUMULATE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 )
 WHERE rownum <= 3
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(window_start=[$7], window_end=[$8], window_time=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[$10])
 +- LogicalFilter(condition=[<=($10, 3)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalTableFunctionScan(invocation=[CUMULATE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
             +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
                +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
@@ -297,14 +284,13 @@ LogicalProject(window_start=[$7], window_end=[$8], window_time=[$9], a=[$0], b=[
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[window_start, window_end, window_time, a, b, c, d, e])
-+- WindowRank(window=[CUMULATE(win_start=[window_start], win_end=[window_end], max_size=[1 h], step=[10 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, d, e, window_start, window_end, window_time])
+Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, w0$o0])
++- WindowRank(window=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, d, e, rowtime, proctime, window_start, window_end, window_time, w0$o0])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, b, c, d, e, window_start, window_end, window_time])
-         +- WindowTableFunction(window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+      +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -468,40 +454,54 @@ Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimplifyHopWindowTVFBeforeWindowRank">
+  <TestCase name="testTimeAttributePropagateForWindowRank1">
     <Resource name="sql">
       <![CDATA[
-SELECT *
-FROM (
-SELECT *,
-   ROW_NUMBER() OVER(PARTITION BY a, window_start, window_end ORDER BY b DESC) as rownum
-FROM TABLE(
-  HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
-)
-WHERE rownum <= 3
+SELECT
+   a,
+   window_start,
+   window_end,
+   sum(cnt),
+   sum(sum_d),
+   max(max_d)
+FROM TABLE(TUMBLE(TABLE tmp1, DESCRIPTOR(rowtime), INTERVAL '1' HOUR))
+GROUP BY a, window_start, window_end
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[$10])
-+- LogicalFilter(condition=[<=($10, 3)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[MAX($5)])
++- LogicalProject(a=[$1], window_start=[$7], window_end=[$8], cnt=[$2], sum_d=[$3], max_d=[$4])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 3600000:INTERVAL HOUR)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT cnt, DECIMAL(38, 3) sum_d, DECIMAL(10, 3) max_d, BIGINT wAvg, BIGINT uv, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(rowtime=[$0], a=[$1], cnt=[$2], sum_d=[$3], max_d=[$4], wAvg=[$5], uv=[$6])
+         +- LogicalProject(rowtime=[$3], a=[$0], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8])
+            +- LogicalFilter(condition=[<=($9, 3)])
+               +- LogicalProject(a=[$0], window_start=[$1], window_end=[$2], window_time=[$3], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $1, $2 ORDER BY $4 DESC NULLS LAST)])
+                  +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], sum_d=[SUM($4)], max_d=[MAX($4) FILTER $5], wAvg=[weightedAvg($6, $7)], uv=[COUNT(DISTINCT $8)])
+                     +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], window_time=[$9], d=[$3], $f5=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+                        +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                              +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                                 +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                                    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, e, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, w0$o0])
-+- WindowRank(window=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[b DESC], select=[a, b, c, d, e, rowtime, proctime, window_start, window_end, window_time, w0$o0])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5])
++- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[1 h])], select=[a, SUM(sum$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, start('w$) AS window_start, end('w$) AS window_end])
    +- Exchange(distribution=[hash[a]])
-      +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+      +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[1 h])], select=[a, SUM(cnt) AS sum$0, SUM(sum_d) AS sum$1, MAX(max_d) AS max$2, slice_end('w$) AS $slice_end])
+         +- Calc(select=[a, cnt, sum_d, max_d, window_time AS rowtime])
+            +- WindowRank(window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rankType=[ROW_NUMBER], rankRange=[rankStart=1, rankEnd=3], partitionBy=[a], orderBy=[cnt DESC], select=[a, window_start, window_end, window_time, cnt, sum_d, max_d])
+               +- Exchange(distribution=[hash[a]])
+                  +- Calc(select=[a, window_start, window_end, window_time, cnt, sum_d, max_d])
+                     +- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS cnt, SUM(sum$1) AS sum_d, MAX(max$2) AS max_d, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])
+                        +- Exchange(distribution=[hash[a]])
+                           +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f5 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+                              +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f5, b, e, c, rowtime])
+                                 +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+                                    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowTableFunctionTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowTableFunctionTest.xml
index 35b704568ad..e583fc3f0a0 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowTableFunctionTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowTableFunctionTest.xml
@@ -69,34 +69,6 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, wi
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSessionTVFWithPartitionKeys">
-    <Resource name="sql">
-      <![CDATA[
-SELECT *
-FROM TABLE(SESSION(TABLE MyTable PARTITION BY (b, a), DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($1, $0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
-      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
-+- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[15 min], partition keys=[b, a])])
-   +- Exchange(distribution=[hash[b, a]])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-         +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -316,6 +288,34 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, wi
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProctimeWindowTVFWithMiniBatch">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
++- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
+      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, PROCTIME_MATERIALIZE(window_time) AS window_time])
++- WindowTableFunction(window=[TUMBLE(time_col=[proctime], size=[15 min])])
+   +- MiniBatchAssigner(interval=[5000ms], mode=[ProcTime])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+         +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -435,17 +435,17 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, wi
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumbleTVFProctime">
+  <TestCase name="testSessionTVFWithPartitionKeys">
     <Resource name="sql">
       <![CDATA[
 SELECT *
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
+FROM TABLE(SESSION(TABLE MyTable PARTITION BY (b, a), DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
++- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($1, $0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -454,25 +454,26 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], wind
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, PROCTIME_MATERIALIZE(window_time) AS window_time])
-+- WindowTableFunction(window=[TUMBLE(time_col=[proctime], size=[15 min])])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
++- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[15 min], partition keys=[b, a])])
+   +- Exchange(distribution=[hash[b, a]])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+         +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProctimeWindowTVFWithMiniBatch">
+  <TestCase name="testTumbleTVF">
     <Resource name="sql">
       <![CDATA[
 SELECT *
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
++- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -481,26 +482,25 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], wind
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, PROCTIME_MATERIALIZE(window_time) AS window_time])
-+- WindowTableFunction(window=[TUMBLE(time_col=[proctime], size=[15 min])])
-   +- MiniBatchAssigner(interval=[5000ms], mode=[ProcTime])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-         +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
++- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumbleTVF">
+  <TestCase name="testTumbleTVFProctime">
     <Resource name="sql">
       <![CDATA[
 SELECT *
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
++- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -509,20 +509,23 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], wind
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
-+- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, PROCTIME_MATERIALIZE(window_time) AS window_time])
++- WindowTableFunction(window=[TUMBLE(time_col=[proctime], size=[15 min])])
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumbleTVFWithOffset">
+  <TestCase name="testTumbleTVFWithNamedParams">
     <Resource name="sql">
       <![CDATA[
 SELECT *
 FROM TABLE(TUMBLE(
-   TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE, INTERVAL '5' MINUTE))
+   DATA => TABLE MyTable,
+   TIMECOL => DESCRIPTOR(rowtime),
+   SIZE => INTERVAL '15' MINUTE,
+   `OFFSET` => INTERVAL '5' MINUTE))
 ]]>
     </Resource>
     <Resource name="ast">
@@ -545,21 +548,18 @@ Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, wi
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumbleTVFWithNamedParams">
+  <TestCase name="testTumbleTVFWithNegativeOffset">
     <Resource name="sql">
       <![CDATA[
 SELECT *
 FROM TABLE(TUMBLE(
-   DATA => TABLE MyTable,
-   TIMECOL => DESCRIPTOR(rowtime),
-   SIZE => INTERVAL '15' MINUTE,
-   `OFFSET` => INTERVAL '5' MINUTE))
+   TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE, INTERVAL '-5' MINUTE))
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE, 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
++- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE, -300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -569,28 +569,25 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], wind
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
-+- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min], offset=[5 min])])
++- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min], offset=[-5 min])])
    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
       +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWindowTVFWithNamedParamsOrderChange">
+  <TestCase name="testTumbleTVFWithOffset">
     <Resource name="sql">
       <![CDATA[
 SELECT *
-FROM TABLE(
-     SESSION(
-         DATA => TABLE MyTable PARTITION BY (b, a),
-         GAP => INTERVAL '15' MINUTE,
-         TIMECOL => DESCRIPTOR(rowtime)))
+FROM TABLE(TUMBLE(
+   TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE, INTERVAL '5' MINUTE))
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($1, $0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
++- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE, 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -600,26 +597,28 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], wind
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
-+- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[15 min], partition keys=[b, a])])
-   +- Exchange(distribution=[hash[b, a]])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-         +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
++- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min], offset=[5 min])])
+   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumbleTVFWithNegativeOffset">
+  <TestCase name="testWindowTVFWithNamedParamsOrderChange">
     <Resource name="sql">
       <![CDATA[
 SELECT *
-FROM TABLE(TUMBLE(
-   TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE, INTERVAL '-5' MINUTE))
+FROM TABLE(
+     SESSION(
+         DATA => TABLE MyTable PARTITION BY (b, a),
+         GAP => INTERVAL '15' MINUTE,
+         TIMECOL => DESCRIPTOR(rowtime)))
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], window_start=[$6], window_end=[$7], window_time=[$8])
-+- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE, -300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
++- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($1, $0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5])
       +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 1000:INTERVAL SECOND)])
          +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
@@ -629,10 +628,11 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[$5], wind
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, b, c, d, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time])
-+- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min], offset=[-5 min])])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-      +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
++- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[15 min], partition keys=[b, a])])
+   +- Exchange(distribution=[hash[b, a]])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+         +- Calc(select=[a, b, c, d, rowtime, PROCTIME() AS proctime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml
index bc33b9bfc7b..d55076afeb5 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml
@@ -548,36 +548,6 @@ LogicalAggregate(group=[{}], EXPR$0=[MAX($0)], EXPR$1=[MAX($1)], EXPR$2=[MAX($2)
 GroupAggregate(select=[MAX(byte) AS EXPR$0, MAX(short) AS EXPR$1, MAX(int) AS EXPR$2, MAX(long) AS EXPR$3, MAX(float) AS EXPR$4, MAX(double) AS EXPR$5, MAX(decimal3020) AS EXPR$6, MAX(decimal105) AS EXPR$7, MAX(boolean) AS EXPR$8, MAX(date) AS EXPR$9, MAX(time) AS EXPR$10, MAX(timestamp) AS EXPR$11, MAX(string) AS EXPR$12]), rowType=[RecordType(TINYINT EXPR$0, SMALLINT EXPR$1, INTEGER EXPR$2, BIGINT EXPR$3, FLOAT EXPR$4, DOUBLE EXPR$5, DECIMAL(30, 20) EXPR$6, DECIMAL(10, 5) EXPR$7, BOOLEAN EXPR$8, DATE EXPR$9, TIME(0) EXPR$10, TIMESTAMP(3) EXPR$11, VARCHAR(2147483647) EXPR$12)]
 +- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSum">
-    <Resource name="sql">
-      <![CDATA[
-SELECT SUM(`byte`),
-       SUM(`short`),
-       SUM(`int`),
-       SUM(`long`),
-       SUM(`float`),
-       SUM(`double`),
-       SUM(`decimal3020`),
-       SUM(`decimal105`)
-FROM MyTable1
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[SUM($0)], EXPR$1=[SUM($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[SUM($5)], EXPR$6=[SUM($6)], EXPR$7=[SUM($7)]), rowType=[RecordType(TINYINT EXPR$0, SMALLINT EXPR$1, INTEGER EXPR$2, BIGINT EXPR$3, FLOAT EXPR$4, DOUBLE EXPR$5, DECIMAL(38, 20) EXPR$6, DECIMAL(38, 5) EXPR$7)]
-+- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-GroupAggregate(select=[SUM(byte) AS EXPR$0, SUM(short) AS EXPR$1, SUM(int) AS EXPR$2, SUM(long) AS EXPR$3, SUM(float) AS EXPR$4, SUM(double) AS EXPR$5, SUM(decimal3020) AS EXPR$6, SUM(decimal105) AS EXPR$7]), rowType=[RecordType(TINYINT EXPR$0, SMALLINT EXPR$1, INTEGER EXPR$2, BIGINT EXPR$3, FLOAT EXPR$4, DOUBLE EXPR$5, DECIMAL(38, 20) EXPR$6, DECIMAL(38, 5) EXPR$7)]
-+- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-   +- Calc(select=[byte, short, int, long, float, double, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
@@ -662,6 +632,36 @@ GroupAggregate(select=[MIN(a) AS EXPR$0], changelogMode=[I,UA,D])
          +- Exchange(distribution=[hash[b]], changelogMode=[I])
             +- Calc(select=[b, a], changelogMode=[I])
                +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[a, b, c, d], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSum">
+    <Resource name="sql">
+      <![CDATA[
+SELECT SUM(`byte`),
+       SUM(`short`),
+       SUM(`int`),
+       SUM(`long`),
+       SUM(`float`),
+       SUM(`double`),
+       SUM(`decimal3020`),
+       SUM(`decimal105`)
+FROM MyTable1
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[SUM($0)], EXPR$1=[SUM($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[SUM($5)], EXPR$6=[SUM($6)], EXPR$7=[SUM($7)]), rowType=[RecordType(TINYINT EXPR$0, SMALLINT EXPR$1, INTEGER EXPR$2, BIGINT EXPR$3, FLOAT EXPR$4, DOUBLE EXPR$5, DECIMAL(38, 20) EXPR$6, DECIMAL(38, 5) EXPR$7)]
++- LogicalProject(byte=[$0], short=[$1], int=[$2], long=[$3], float=[$4], double=[$5], decimal3020=[$11], decimal105=[$12]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+GroupAggregate(select=[SUM(byte) AS EXPR$0, SUM(short) AS EXPR$1, SUM(int) AS EXPR$2, SUM(long) AS EXPR$3, SUM(float) AS EXPR$4, SUM(double) AS EXPR$5, SUM(decimal3020) AS EXPR$6, SUM(decimal105) AS EXPR$7]), rowType=[RecordType(TINYINT EXPR$0, SMALLINT EXPR$1, INTEGER EXPR$2, BIGINT EXPR$3, FLOAT EXPR$4, DOUBLE EXPR$5, DECIMAL(38, 20) EXPR$6, DECIMAL(38, 5) EXPR$7)]
++- Exchange(distribution=[single]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+   +- Calc(select=[byte, short, int, long, float, double, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[byte, short, int, long, float, double, boolean, string, date, time, timestamp, decimal3020, decimal105]), rowType=[RecordType(TINYINT byte, SMALLINT short, INTEGER int, BIGINT long, FLOAT float, DOUBLE double, BOOLEAN boolean, VARCHAR(2147483647) string, DATE date, TIME(0) time, TIMESTAMP(3) timestamp, DECIMAL(30, 20) decimal3020, DECIMAL(10, 5) decimal105)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/DistinctAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/DistinctAggregateTest.xml
index 9a79c57e503..b18f001342d 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/DistinctAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/DistinctAggregateTest.xml
@@ -754,97 +754,6 @@ GlobalGroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, MIN_RETRA
                               +- LocalGroupAggregate(groupBy=[a], select=[a, AVG(b) AS (sum$0, count$1), MAX(c) AS max$2])
                                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=false, aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
-+- LogicalProject(c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupAggregate(select=[COUNT(DISTINCT c) AS EXPR$0])
-+- Exchange(distribution=[single])
-   +- Calc(select=[c])
-      +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=false, aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
-+- LogicalProject(c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GlobalGroupAggregate(select=[COUNT(distinct$0 count$0) AS EXPR$0])
-+- Exchange(distribution=[single])
-   +- LocalGroupAggregate(select=[COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0])
-      +- Calc(select=[c])
-         +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
-+- LogicalProject(c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupAggregate(partialFinalType=[FINAL], select=[$SUM0_RETRACT($f1_0) AS $f0])
-+- Exchange(distribution=[single])
-   +- GroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(DISTINCT c) AS $f1_0])
-      +- Exchange(distribution=[hash[$f1]])
-         +- Calc(select=[c, MOD(HASH_CODE(c), 1024) AS $f1])
-            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
-+- LogicalProject(c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GlobalGroupAggregate(partialFinalType=[FINAL], select=[$SUM0_RETRACT(sum$0) AS $f0])
-+- Exchange(distribution=[single])
-   +- LocalGroupAggregate(partialFinalType=[FINAL], select=[$SUM0_RETRACT($f1_0) AS sum$0, COUNT_RETRACT(*) AS count1$1])
-      +- GlobalGroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(distinct$0 count$0) AS $f1_0])
-         +- Exchange(distribution=[hash[$f1]])
-            +- LocalGroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0])
-               +- Calc(select=[c, MOD(HASH_CODE(c), 1024) AS $f1])
-                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1001,29 +910,6 @@ GlobalGroupAggregate(groupBy=[a], select=[a, COUNT(distinct$0 count$0) AS EXPR$1
       +- Calc(select=[a, b])
          +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleDistinctAggWithGroupBy[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT a, COUNT(DISTINCT c) FROM MyTable GROUP BY a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
-+- LogicalProject(a=[$0], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0_RETRACT($f2_0) AS $f1])
-+- Exchange(distribution=[hash[a]])
-   +- GroupAggregate(groupBy=[a, $f2], partialFinalType=[PARTIAL], select=[a, $f2, COUNT(DISTINCT c) AS $f2_0])
-      +- Exchange(distribution=[hash[a, $f2]])
-         +- Calc(select=[a, c, MOD(HASH_CODE(c), 1024) AS $f2])
-            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1117,6 +1003,29 @@ GlobalGroupAggregate(groupBy=[a], select=[a, COUNT(distinct$0 count$0) AS EXPR$1
       +- Calc(select=[a, c])
          +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleDistinctAggWithGroupBy[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT a, COUNT(DISTINCT c) FROM MyTable GROUP BY a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
++- LogicalProject(a=[$0], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0_RETRACT($f2_0) AS $f1])
++- Exchange(distribution=[hash[a]])
+   +- GroupAggregate(groupBy=[a, $f2], partialFinalType=[PARTIAL], select=[a, $f2, COUNT(DISTINCT c) AS $f2_0])
+      +- Exchange(distribution=[hash[a, $f2]])
+         +- Calc(select=[a, c, MOD(HASH_CODE(c), 1024) AS $f2])
+            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1142,6 +1051,97 @@ GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0_RET
                +- Calc(select=[a, c, MOD(HASH_CODE(c), 1024) AS $f2])
                   +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=false, aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
++- LogicalProject(c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupAggregate(select=[COUNT(DISTINCT c) AS EXPR$0])
++- Exchange(distribution=[single])
+   +- Calc(select=[c])
+      +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=false, aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
++- LogicalProject(c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GlobalGroupAggregate(select=[COUNT(distinct$0 count$0) AS EXPR$0])
++- Exchange(distribution=[single])
+   +- LocalGroupAggregate(select=[COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0])
+      +- Calc(select=[c])
+         +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
++- LogicalProject(c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupAggregate(partialFinalType=[FINAL], select=[$SUM0_RETRACT($f1_0) AS $f0])
++- Exchange(distribution=[single])
+   +- GroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(DISTINCT c) AS $f1_0])
+      +- Exchange(distribution=[hash[$f1]])
+         +- Calc(select=[c, MOD(HASH_CODE(c), 1024) AS $f1])
+            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
++- LogicalProject(c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GlobalGroupAggregate(partialFinalType=[FINAL], select=[$SUM0_RETRACT(sum$0) AS $f0])
++- Exchange(distribution=[single])
+   +- LocalGroupAggregate(partialFinalType=[FINAL], select=[$SUM0_RETRACT($f1_0) AS sum$0, COUNT_RETRACT(*) AS count1$1])
+      +- GlobalGroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(distinct$0 count$0) AS $f1_0])
+         +- Exchange(distribution=[hash[$f1]])
+            +- LocalGroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0])
+               +- Calc(select=[c, MOD(HASH_CODE(c), 1024) AS $f1])
+                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1696,43 +1696,6 @@ GlobalGroupAggregate(groupBy=[a], select=[a, COUNT(distinct$0 count$0) AS EXPR$1
       +- Calc(select=[a, b])
          +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSumCountWithSingleDistinctAndRetraction[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-  b, SUM(b1), COUNT(DISTINCT b1), COUNT(1)
-FROM(
-   SELECT
-     a, COUNT(b) as b, MAX(b) as b1
-   FROM MyTable
-   GROUP BY a
-) GROUP BY b
-       ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT(DISTINCT $1)], EXPR$3=[COUNT()])
-+- LogicalProject(b=[$1], b1=[$2])
-   +- LogicalAggregate(group=[{0}], b=[COUNT($1)], b1=[MAX($1)])
-      +- LogicalProject(a=[$0], b=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-GroupAggregate(groupBy=[b], partialFinalType=[FINAL], select=[b, SUM_RETRACT($f2_0) AS $f1, $SUM0_RETRACT($f3) AS $f2, $SUM0_RETRACT($f4) AS $f3], changelogMode=[I,UA,D])
-+- Exchange(distribution=[hash[b]], changelogMode=[I,UB,UA,D])
-   +- GroupAggregate(groupBy=[b, $f2], partialFinalType=[PARTIAL], select=[b, $f2, SUM_RETRACT(b1) AS $f2_0, COUNT_RETRACT(DISTINCT b1) AS $f3, COUNT_RETRACT(*) AS $f4], changelogMode=[I,UB,UA,D])
-      +- Exchange(distribution=[hash[b, $f2]], changelogMode=[I,UB,UA])
-         +- Calc(select=[b, b1, MOD(HASH_CODE(b1), 1024) AS $f2], changelogMode=[I,UB,UA])
-            +- GroupAggregate(groupBy=[a], select=[a, COUNT(b) AS b, MAX(b) AS b1], changelogMode=[I,UB,UA])
-               +- Exchange(distribution=[hash[a]], changelogMode=[I])
-                  +- Calc(select=[a, b], changelogMode=[I])
-                     +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime], changelogMode=[I])
-                        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -1856,28 +1819,40 @@ GlobalGroupAggregate(groupBy=[b], select=[b, SUM_RETRACT((sum$0, count$1)) AS EX
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTwoDistinctAggregateWithNonDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testSumCountWithSingleDistinctAndRetraction[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT c, SUM(DISTINCT a), SUM(a), COUNT(DISTINCT b) FROM MyTable GROUP BY c]]>
+      <![CDATA[
+SELECT
+  b, SUM(b1), COUNT(DISTINCT b1), COUNT(1)
+FROM(
+   SELECT
+     a, COUNT(b) as b, MAX(b) as b1
+   FROM MyTable
+   GROUP BY a
+) GROUP BY b
+       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[SUM(DISTINCT $1)], EXPR$2=[SUM($1)], EXPR$3=[COUNT(DISTINCT $2)])
-+- LogicalProject(c=[$2], a=[$0], b=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT(DISTINCT $1)], EXPR$3=[COUNT()])
++- LogicalProject(b=[$1], b1=[$2])
+   +- LogicalAggregate(group=[{0}], b=[COUNT($1)], b1=[MAX($1)])
+      +- LogicalProject(a=[$0], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
-    <Resource name="optimized exec plan">
+    <Resource name="optimized rel plan">
       <![CDATA[
-GroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, SUM_RETRACT($f3_0) AS $f1, SUM_RETRACT($f4_0) AS $f2, $SUM0_RETRACT($f5) AS $f3])
-+- Exchange(distribution=[hash[c]])
-   +- GroupAggregate(groupBy=[c, $f3, $f4], partialFinalType=[PARTIAL], select=[c, $f3, $f4, SUM(DISTINCT a) FILTER $g_1 AS $f3_0, SUM(a) FILTER $g_3 AS $f4_0, COUNT(DISTINCT b) FILTER $g_2 AS $f5])
-      +- Exchange(distribution=[hash[c, $f3, $f4]])
-         +- Calc(select=[a, b, c, $f3, $f4, ($e = 1) AS $g_1, ($e = 3) AS $g_3, ($e = 2) AS $g_2])
-            +- Expand(projects=[{a, b, c, $f3, null AS $f4, 1 AS $e}, {a, b, c, null AS $f3, $f4, 2 AS $e}, {a, b, c, null AS $f3, null AS $f4, 3 AS $e}])
-               +- Calc(select=[a, b, c, MOD(HASH_CODE(a), 1024) AS $f3, MOD(HASH_CODE(b), 1024) AS $f4])
-                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+GroupAggregate(groupBy=[b], partialFinalType=[FINAL], select=[b, SUM_RETRACT($f2_0) AS $f1, $SUM0_RETRACT($f3) AS $f2, $SUM0_RETRACT($f4) AS $f3], changelogMode=[I,UA,D])
++- Exchange(distribution=[hash[b]], changelogMode=[I,UB,UA,D])
+   +- GroupAggregate(groupBy=[b, $f2], partialFinalType=[PARTIAL], select=[b, $f2, SUM_RETRACT(b1) AS $f2_0, COUNT_RETRACT(DISTINCT b1) AS $f3, COUNT_RETRACT(*) AS $f4], changelogMode=[I,UB,UA,D])
+      +- Exchange(distribution=[hash[b, $f2]], changelogMode=[I,UB,UA])
+         +- Calc(select=[b, b1, MOD(HASH_CODE(b1), 1024) AS $f2], changelogMode=[I,UB,UA])
+            +- GroupAggregate(groupBy=[a], select=[a, COUNT(b) AS b, MAX(b) AS b1], changelogMode=[I,UB,UA])
+               +- Exchange(distribution=[hash[a]], changelogMode=[I])
+                  +- Calc(select=[a, b], changelogMode=[I])
+                     +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime], changelogMode=[I])
+                        +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -1918,6 +1893,26 @@ GlobalGroupAggregate(groupBy=[b], partialFinalType=[FINAL], select=[b, SUM_RETRA
                            +- Calc(select=[a, b], changelogMode=[I])
                               +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime], changelogMode=[I])
                                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTwoDistinctAggregateWithNonDistinctAgg[splitDistinctAggEnabled=false, aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT c, SUM(DISTINCT a), SUM(a), COUNT(DISTINCT b) FROM MyTable GROUP BY c]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[SUM(DISTINCT $1)], EXPR$2=[SUM($1)], EXPR$3=[COUNT(DISTINCT $2)])
++- LogicalProject(c=[$2], a=[$0], b=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupAggregate(groupBy=[c], select=[c, SUM(DISTINCT a) AS EXPR$1, SUM(a) AS EXPR$2, COUNT(DISTINCT b) AS EXPR$3])
++- Exchange(distribution=[hash[c]])
+   +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -1942,7 +1937,7 @@ GlobalGroupAggregate(groupBy=[c], select=[c, SUM(distinct$0 sum$0) AS EXPR$1, SU
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTwoDistinctAggregateWithNonDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testTwoDistinctAggregateWithNonDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[SELECT c, SUM(DISTINCT a), SUM(a), COUNT(DISTINCT b) FROM MyTable GROUP BY c]]>
     </Resource>
@@ -1955,21 +1950,19 @@ LogicalAggregate(group=[{0}], EXPR$1=[SUM(DISTINCT $1)], EXPR$2=[SUM($1)], EXPR$
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-GlobalGroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, SUM_RETRACT((sum$0, count$1)) AS $f1, SUM_RETRACT((sum$2, count$3)) AS $f2, $SUM0_RETRACT(sum$4) AS $f3])
+GroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, SUM_RETRACT($f3_0) AS $f1, SUM_RETRACT($f4_0) AS $f2, $SUM0_RETRACT($f5) AS $f3])
 +- Exchange(distribution=[hash[c]])
-   +- LocalGroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, SUM_RETRACT($f3_0) AS (sum$0, count$1), SUM_RETRACT($f4_0) AS (sum$2, count$3), $SUM0_RETRACT($f5) AS sum$4, COUNT_RETRACT(*) AS count1$5])
-      +- GlobalGroupAggregate(groupBy=[c, $f3, $f4], partialFinalType=[PARTIAL], select=[c, $f3, $f4, SUM(distinct$0 sum$0) AS $f3_0, SUM(sum$1) AS $f4_0, COUNT(distinct$1 count$2) AS $f5])
-         +- Exchange(distribution=[hash[c, $f3, $f4]])
-            +- LocalGroupAggregate(groupBy=[c, $f3, $f4], partialFinalType=[PARTIAL], select=[c, $f3, $f4, SUM(distinct$0 a) FILTER $g_1 AS sum$0, SUM(a) FILTER $g_3 AS sum$1, COUNT(distinct$1 b) FILTER $g_2 AS count$2, DISTINCT(a) AS distinct$0, DISTINCT(b) AS distinct$1])
-               +- Calc(select=[a, b, c, $f3, $f4, ($e = 1) AS $g_1, ($e = 3) AS $g_3, ($e = 2) AS $g_2])
-                  +- Expand(projects=[{a, b, c, $f3, null AS $f4, 1 AS $e}, {a, b, c, null AS $f3, $f4, 2 AS $e}, {a, b, c, null AS $f3, null AS $f4, 3 AS $e}])
-                     +- Calc(select=[a, b, c, MOD(HASH_CODE(a), 1024) AS $f3, MOD(HASH_CODE(b), 1024) AS $f4])
-                        +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-                           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- GroupAggregate(groupBy=[c, $f3, $f4], partialFinalType=[PARTIAL], select=[c, $f3, $f4, SUM(DISTINCT a) FILTER $g_1 AS $f3_0, SUM(a) FILTER $g_3 AS $f4_0, COUNT(DISTINCT b) FILTER $g_2 AS $f5])
+      +- Exchange(distribution=[hash[c, $f3, $f4]])
+         +- Calc(select=[a, b, c, $f3, $f4, ($e = 1) AS $g_1, ($e = 3) AS $g_3, ($e = 2) AS $g_2])
+            +- Expand(projects=[{a, b, c, $f3, null AS $f4, 1 AS $e}, {a, b, c, null AS $f3, $f4, 2 AS $e}, {a, b, c, null AS $f3, null AS $f4, 3 AS $e}])
+               +- Calc(select=[a, b, c, MOD(HASH_CODE(a), 1024) AS $f3, MOD(HASH_CODE(b), 1024) AS $f4])
+                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTwoDistinctAggregateWithNonDistinctAgg[splitDistinctAggEnabled=false, aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testTwoDistinctAggregateWithNonDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[SELECT c, SUM(DISTINCT a), SUM(a), COUNT(DISTINCT b) FROM MyTable GROUP BY c]]>
     </Resource>
@@ -1982,10 +1975,17 @@ LogicalAggregate(group=[{0}], EXPR$1=[SUM(DISTINCT $1)], EXPR$2=[SUM($1)], EXPR$
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-GroupAggregate(groupBy=[c], select=[c, SUM(DISTINCT a) AS EXPR$1, SUM(a) AS EXPR$2, COUNT(DISTINCT b) AS EXPR$3])
+GlobalGroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, SUM_RETRACT((sum$0, count$1)) AS $f1, SUM_RETRACT((sum$2, count$3)) AS $f2, $SUM0_RETRACT(sum$4) AS $f3])
 +- Exchange(distribution=[hash[c]])
-   +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+   +- LocalGroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, SUM_RETRACT($f3_0) AS (sum$0, count$1), SUM_RETRACT($f4_0) AS (sum$2, count$3), $SUM0_RETRACT($f5) AS sum$4, COUNT_RETRACT(*) AS count1$5])
+      +- GlobalGroupAggregate(groupBy=[c, $f3, $f4], partialFinalType=[PARTIAL], select=[c, $f3, $f4, SUM(distinct$0 sum$0) AS $f3_0, SUM(sum$1) AS $f4_0, COUNT(distinct$1 count$2) AS $f5])
+         +- Exchange(distribution=[hash[c, $f3, $f4]])
+            +- LocalGroupAggregate(groupBy=[c, $f3, $f4], partialFinalType=[PARTIAL], select=[c, $f3, $f4, SUM(distinct$0 a) FILTER $g_1 AS sum$0, SUM(a) FILTER $g_3 AS sum$1, COUNT(distinct$1 b) FILTER $g_2 AS count$2, DISTINCT(a) AS distinct$0, DISTINCT(b) AS distinct$1])
+               +- Calc(select=[a, b, c, $f3, $f4, ($e = 1) AS $g_1, ($e = 3) AS $g_3, ($e = 2) AS $g_2])
+                  +- Expand(projects=[{a, b, c, $f3, null AS $f4, 1 AS $e}, {a, b, c, null AS $f3, $f4, 2 AS $e}, {a, b, c, null AS $f3, null AS $f4, 3 AS $e}])
+                     +- Calc(select=[a, b, c, MOD(HASH_CODE(a), 1024) AS $f3, MOD(HASH_CODE(b), 1024) AS $f4])
+                        +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+                           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml
index 675d83f5f9c..cdd14d681b1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml
@@ -102,6 +102,31 @@ Calc(select=[EXPR$0, w$start AS EXPR$1], where=[(($f1 > 0) AND (EXTRACT(QUARTER,
    +- Exchange(distribution=[single])
       +- Calc(select=[rowtime, a])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testHopWindowWithProctime">
+    <Resource name="sql">
+      <![CDATA[
+select sum(a), max(b)
+from MyTable1
+group by HOP(c, INTERVAL '1' SECOND, INTERVAL '1' MINUTE)
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
++- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$1=[MAX($2)])
+   +- LogicalProject($f0=[$HOP($2, 1000:INTERVAL SECOND, 60000:INTERVAL MINUTE)], a=[$0], b=[$1])
+      +- LogicalProject(a=[$0], b=[$1], c=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupWindowAggregate(window=[SlidingGroupWindow('w$, $f2, 60000, 1000)], select=[SUM(a) AS EXPR$0, MAX(b) AS EXPR$1])
++- Exchange(distribution=[single])
+   +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -131,31 +156,6 @@ Calc(select=[EXPR$0, wAvg, w$start AS EXPR$2, w$end AS EXPR$3])
    +- Exchange(distribution=[single])
       +- Calc(select=[proctime, c, CAST(a AS BIGINT) AS a])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testHopWindowWithProctime">
-    <Resource name="sql">
-      <![CDATA[
-select sum(a), max(b)
-from MyTable1
-group by HOP(c, INTERVAL '1' SECOND, INTERVAL '1' MINUTE)
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
-+- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$1=[MAX($2)])
-   +- LogicalProject($f0=[$HOP($2, 1000:INTERVAL SECOND, 60000:INTERVAL MINUTE)], a=[$0], b=[$1])
-      +- LogicalProject(a=[$0], b=[$1], c=[PROCTIME()])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupWindowAggregate(window=[SlidingGroupWindow('w$, $f2, 60000, 1000)], select=[SUM(a) AS EXPR$0, MAX(b) AS EXPR$1])
-+- Exchange(distribution=[single])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -478,35 +478,6 @@ Calc(select=[EXPR$0])
             +- Exchange(distribution=[hash[a, b, c]])
                +- Calc(select=[a, b, c, rowtime])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumbleFunction">
-    <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(*),
-    weightedAvg(c, a) AS wAvg,
-    TUMBLE_START(rowtime, INTERVAL '15' MINUTE),
-    TUMBLE_END(rowtime, INTERVAL '15' MINUTE)
-FROM MyTable
-    GROUP BY TUMBLE(rowtime, INTERVAL '15' MINUTE)
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], wAvg=[$2], EXPR$2=[TUMBLE_START($0)], EXPR$3=[TUMBLE_END($0)])
-+- LogicalAggregate(group=[{0}], EXPR$0=[COUNT()], wAvg=[weightedAvg($1, $2)])
-   +- LogicalProject($f0=[$TUMBLE($4, 900000:INTERVAL MINUTE)], c=[$2], $f2=[CAST($0):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0, wAvg, w$start AS EXPR$2, w$end AS EXPR$3])
-+- GroupWindowAggregate(window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[COUNT(*) AS EXPR$0, weightedAvg(c, a) AS wAvg, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[rowtime, c, CAST(a AS BIGINT) AS a])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -578,6 +549,35 @@ Calc(select=[EXPR$0])
             +- Exchange(distribution=[hash[a, b, c]])
                +- Calc(select=[a, b, c, rowtime])
                   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumbleFunction">
+    <Resource name="sql">
+      <![CDATA[
+SELECT COUNT(*),
+    weightedAvg(c, a) AS wAvg,
+    TUMBLE_START(rowtime, INTERVAL '15' MINUTE),
+    TUMBLE_END(rowtime, INTERVAL '15' MINUTE)
+FROM MyTable
+    GROUP BY TUMBLE(rowtime, INTERVAL '15' MINUTE)
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], wAvg=[$2], EXPR$2=[TUMBLE_START($0)], EXPR$3=[TUMBLE_END($0)])
++- LogicalAggregate(group=[{0}], EXPR$0=[COUNT()], wAvg=[weightedAvg($1, $2)])
+   +- LogicalProject($f0=[$TUMBLE($4, 900000:INTERVAL MINUTE)], c=[$2], $f2=[CAST($0):BIGINT])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[EXPR$0, wAvg, w$start AS EXPR$2, w$end AS EXPR$3])
++- GroupWindowAggregate(window=[TumblingGroupWindow('w$, rowtime, 900000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[COUNT(*) AS EXPR$0, weightedAvg(c, a) AS wAvg, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[rowtime, c, CAST(a AS BIGINT) AS a])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml
index 886793c3291..88e69acd291 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml
@@ -159,6 +159,40 @@ Calc(select=[deptno, c])
       +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
          +- Calc(select=[deptno])
             +- TableSourceScan(table=[[default_catalog, default_database, emps]], fields=[empno, name, deptno, gender, city, empid, age, slacker, manager, joinedat])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCaseWhenRefGroupingSetsNullableCols">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+    case
+     when g1 = 1 then 'aaa'
+     when g2 = 1 then 'bbb'
+    end as gt,
+    b, c,
+    AVG(a) AS a
+FROM (select *, 1 g1, 1 g2 from MyTable) t
+    GROUP BY GROUPING SETS ((g1, b), (g2, b, c))
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(gt=[CASE(=($0, 1), _UTF-16LE'aaa', =($2, 1), _UTF-16LE'bbb', null:CHAR(3) CHARACTER SET "UTF-16LE")], b=[$1], c=[$3], a=[$4])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 1}, {1, 2, 3}]], a=[AVG($4)])
+   +- LogicalProject(g1=[$3], b=[$1], g2=[$4], c=[$2], a=[$0])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], g1=[1], g2=[1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[CASE((g1 = 1), 'aaa', (g2 = 1), 'bbb', null:CHAR(3)) AS gt, b, c, a])
++- GroupAggregate(groupBy=[g1, b, g2, c, $e], select=[g1, b, g2, c, $e, AVG(a) AS a])
+   +- Exchange(distribution=[hash[g1, b, g2, c, $e]])
+      +- Expand(projects=[{g1, b, null AS g2, null AS c, a, 3 AS $e}, {null AS g1, b, g2, c, a, 8 AS $e}])
+         +- Calc(select=[1 AS g1, b, 1 AS g2, c, a])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -317,29 +351,6 @@ Calc(select=[deptno, gender, CASE(($e = 0), 0, ($e = 1), 5, 7) AS EXPR$2, c])
       +- Expand(projects=[{gender, deptno, 0 AS $e}, {gender, null AS deptno, 1 AS $e}, {null AS gender, null AS deptno, 3 AS $e}])
          +- Calc(select=[gender, CAST(10 AS INTEGER) AS deptno], where=[(deptno = 10)])
             +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSimpleCube">
-    <Resource name="sql">
-      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY CUBE(deptno, gender)]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], c=[$2])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], c=[COUNT()])
-   +- LogicalProject(deptno=[$1], gender=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[(deptno + 1) AS EXPR$0, c])
-+- GroupAggregate(groupBy=[deptno, gender, $e], select=[deptno, gender, $e, COUNT(*) AS c])
-   +- Exchange(distribution=[hash[deptno, gender, $e]])
-      +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
-         +- Calc(select=[deptno, gender])
-            +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -478,6 +489,36 @@ Calc(select=[deptno, gender, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS gd, CASE(($e
       +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
          +- Calc(select=[deptno, gender])
             +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testGroupingInOrderByClause">
+    <Resource name="sql">
+      <![CDATA[
+SELECT COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno) ORDER BY GROUPING(deptno), c
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$0])
++- LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
+   +- LogicalProject(c=[$1], EXPR$1=[$2])
+      +- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()], agg#1=[GROUPING($0)])
+         +- LogicalProject(deptno=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[c])
++- Sort(orderBy=[EXPR$1 ASC, c ASC])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[c, CASE(($e = 0), 0, 1) AS EXPR$1])
+         +- GroupAggregate(groupBy=[deptno, $e], select=[deptno, $e, COUNT(*) AS c])
+            +- Exchange(distribution=[hash[deptno, $e]])
+               +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
+                  +- Calc(select=[deptno])
+                     +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -659,36 +700,6 @@ Calc(select=[EXPR$0, c])
       +- Expand(projects=[{EXPR$0, 0 AS $e}, {null AS EXPR$0, 1 AS $e}])
          +- Calc(select=[(deptno + 1) AS EXPR$0])
             +- TableSourceScan(table=[[default_catalog, default_database, emps]], fields=[empno, name, deptno, gender, city, empid, age, slacker, manager, joinedat])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testGroupingInOrderByClause">
-    <Resource name="sql">
-      <![CDATA[
-SELECT COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno) ORDER BY GROUPING(deptno), c
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(c=[$0])
-+- LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC-nulls-first], dir1=[ASC-nulls-first])
-   +- LogicalProject(c=[$1], EXPR$1=[$2])
-      +- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()], agg#1=[GROUPING($0)])
-         +- LogicalProject(deptno=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[c])
-+- Sort(orderBy=[EXPR$1 ASC, c ASC])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[c, CASE(($e = 0), 0, 1) AS EXPR$1])
-         +- GroupAggregate(groupBy=[deptno, $e], select=[deptno, $e, COUNT(*) AS c])
-            +- Exchange(distribution=[hash[deptno, $e]])
-               +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
-                  +- Calc(select=[deptno])
-                     +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -862,6 +873,29 @@ Calc(select=[($f0 + 1) AS half1, c])
       +- Expand(projects=[{$f0, gender, $f2, 0 AS $e}, {$f0, gender, null AS $f2, 1 AS $e}, {$f0, null AS gender, $f2, 2 AS $e}, {$f0, null AS gender, null AS $f2, 3 AS $e}, {null AS $f0, null AS gender, $f2, 6 AS $e}, {null AS $f0, null AS gender, null AS $f2, 7 AS $e}])
          +- Calc(select=[(deptno / 2) AS $f0, gender, SUBSTRING(ename, 1, 1) AS $f2])
             +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRollupOn1Column">
+    <Resource name="sql">
+      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno)]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[+($0, 1)], c=[$1])
++- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()])
+   +- LogicalProject(deptno=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[(deptno + 1) AS EXPR$0, c])
++- GroupAggregate(groupBy=[deptno, $e], select=[deptno, $e, COUNT(*) AS c])
+   +- Exchange(distribution=[hash[deptno, $e]])
+      +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
+         +- Calc(select=[deptno])
+            +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
 ]]>
     </Resource>
   </TestCase>
@@ -963,60 +997,26 @@ Calc(select=[(deptno + 1) AS d1, c], where=[(c > 3)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRollupOn1Column">
+  <TestCase name="testSimpleCube">
     <Resource name="sql">
-      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY ROLLUP(deptno)]]>
+      <![CDATA[SELECT deptno + 1, COUNT(*) AS c FROM emp GROUP BY CUBE(deptno, gender)]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[+($0, 1)], c=[$1])
-+- LogicalAggregate(group=[{0}], groups=[[{0}, {}]], c=[COUNT()])
-   +- LogicalProject(deptno=[$1])
+LogicalProject(EXPR$0=[+($0, 1)], c=[$2])
++- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], c=[COUNT()])
+   +- LogicalProject(deptno=[$1], gender=[$2])
       +- LogicalTableScan(table=[[default_catalog, default_database, emp]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[(deptno + 1) AS EXPR$0, c])
-+- GroupAggregate(groupBy=[deptno, $e], select=[deptno, $e, COUNT(*) AS c])
-   +- Exchange(distribution=[hash[deptno, $e]])
-      +- Expand(projects=[{deptno, 0 AS $e}, {null AS deptno, 1 AS $e}])
-         +- Calc(select=[deptno])
++- GroupAggregate(groupBy=[deptno, gender, $e], select=[deptno, gender, $e, COUNT(*) AS c])
+   +- Exchange(distribution=[hash[deptno, gender, $e]])
+      +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
+         +- Calc(select=[deptno, gender])
             +- TableSourceScan(table=[[default_catalog, default_database, emp]], fields=[ename, deptno, gender])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCaseWhenRefGroupingSetsNullableCols">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-    case
-     when g1 = 1 then 'aaa'
-     when g2 = 1 then 'bbb'
-    end as gt,
-    b, c,
-    AVG(a) AS a
-FROM (select *, 1 g1, 1 g2 from MyTable) t
-    GROUP BY GROUPING SETS ((g1, b), (g2, b, c))
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(gt=[CASE(=($0, 1), _UTF-16LE'aaa', =($2, 1), _UTF-16LE'bbb', null:CHAR(3) CHARACTER SET "UTF-16LE")], b=[$1], c=[$3], a=[$4])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 1}, {1, 2, 3}]], a=[AVG($4)])
-   +- LogicalProject(g1=[$3], b=[$1], g2=[$4], c=[$2], a=[$0])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], g1=[1], g2=[1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[CASE((g1 = 1), 'aaa', (g2 = 1), 'bbb', null:CHAR(3)) AS gt, b, c, a])
-+- GroupAggregate(groupBy=[g1, b, g2, c, $e], select=[g1, b, g2, c, $e, AVG(a) AS a])
-   +- Exchange(distribution=[hash[g1, b, g2, c, $e]])
-      +- Expand(projects=[{g1, b, null AS g2, null AS c, a, 3 AS $e}, {null AS g1, b, g2, c, a, 8 AS $e}])
-         +- Calc(select=[1 AS g1, b, 1 AS g2, c, a])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/IncrementalAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/IncrementalAggregateTest.xml
index e0541113396..18b735e9ab4 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/IncrementalAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/IncrementalAggregateTest.xml
@@ -211,30 +211,6 @@ GlobalGroupAggregate(groupBy=[c], partialFinalType=[FINAL], select=[c, MIN_RETRA
                            +- LocalGroupAggregate(groupBy=[a], select=[a, AVG(b) AS (sum$0, count$1), MAX(c) AS max$2])
                               +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
-+- LogicalProject(c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GlobalGroupAggregate(partialFinalType=[FINAL], select=[$SUM0(count$0) AS $f0])
-+- Exchange(distribution=[single])
-   +- IncrementalGroupAggregate(partialAggGrouping=[$f1], finalAggGrouping=[], select=[COUNT(distinct$0 count$0) AS count$0])
-      +- Exchange(distribution=[hash[$f1]])
-         +- LocalGroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0])
-            +- Calc(select=[c, MOD(HASH_CODE(c), 1024) AS $f1])
-               +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -266,6 +242,31 @@ Calc(select=[a, $f1 AS EXPR$1, CASE(($f3 = 0), null:BIGINT, $f2) AS EXPR$2, (CAS
                      +- Calc(select=[a, b, c, MOD(HASH_CODE(b), 1024) AS $f3, MOD(HASH_CODE(c), 1024) AS $f4])
                         +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSingleDistinctAggWithAndNonDistinctAggOnSameColumn[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT a, COUNT(DISTINCT b), SUM(b), AVG(b) FROM MyTable GROUP BY a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[SUM($1)], EXPR$3=[AVG($1)])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, $f1, $f2, IF(($f4 = 0), null:BIGINT, ($f3 / $f4)) AS $f3])
++- GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(count$0) AS $f1, SUM(sum$1) AS $f2, $SUM0(sum$2) AS $f3, $SUM0(count$3) AS $f4])
+   +- Exchange(distribution=[hash[a]])
+      +- IncrementalGroupAggregate(partialAggGrouping=[a, $f2], finalAggGrouping=[a], select=[a, COUNT(distinct$0 count$0) AS count$0, SUM(sum$1) AS sum$1, $SUM0(sum$2) AS sum$2, COUNT(count$3) AS count$3])
+         +- Exchange(distribution=[hash[a, $f2]])
+            +- LocalGroupAggregate(groupBy=[a, $f2], partialFinalType=[PARTIAL], select=[a, $f2, COUNT(distinct$0 b) AS count$0, SUM(b) AS sum$1, $SUM0(b) AS sum$2, COUNT(b) AS count$3, DISTINCT(b) AS distinct$0])
+               +- Calc(select=[a, b, MOD(HASH_CODE(b), 1024) AS $f2])
+                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -293,28 +294,27 @@ GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(cou
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleDistinctAggWithAndNonDistinctAggOnSameColumn[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testSingleDistinctAgg[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
-      <![CDATA[SELECT a, COUNT(DISTINCT b), SUM(b), AVG(b) FROM MyTable GROUP BY a]]>
+      <![CDATA[SELECT COUNT(DISTINCT c) FROM MyTable]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[SUM($1)], EXPR$3=[AVG($1)])
-+- LogicalProject(a=[$0], b=[$1])
+LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)])
++- LogicalProject(c=[$2])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, $f1, $f2, IF(($f4 = 0), null:BIGINT, ($f3 / $f4)) AS $f3])
-+- GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(count$0) AS $f1, SUM(sum$1) AS $f2, $SUM0(sum$2) AS $f3, $SUM0(count$3) AS $f4])
-   +- Exchange(distribution=[hash[a]])
-      +- IncrementalGroupAggregate(partialAggGrouping=[a, $f2], finalAggGrouping=[a], select=[a, COUNT(distinct$0 count$0) AS count$0, SUM(sum$1) AS sum$1, $SUM0(sum$2) AS sum$2, COUNT(count$3) AS count$3])
-         +- Exchange(distribution=[hash[a, $f2]])
-            +- LocalGroupAggregate(groupBy=[a, $f2], partialFinalType=[PARTIAL], select=[a, $f2, COUNT(distinct$0 b) AS count$0, SUM(b) AS sum$1, $SUM0(b) AS sum$2, COUNT(b) AS count$3, DISTINCT(b) AS distinct$0])
-               +- Calc(select=[a, b, MOD(HASH_CODE(b), 1024) AS $f2])
-                  +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-                     +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+GlobalGroupAggregate(partialFinalType=[FINAL], select=[$SUM0(count$0) AS $f0])
++- Exchange(distribution=[single])
+   +- IncrementalGroupAggregate(partialAggGrouping=[$f1], finalAggGrouping=[], select=[COUNT(distinct$0 count$0) AS count$0])
+      +- Exchange(distribution=[hash[$f1]])
+         +- LocalGroupAggregate(groupBy=[$f1], partialFinalType=[PARTIAL], select=[$f1, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0])
+            +- Calc(select=[c, MOD(HASH_CODE(c), 1024) AS $f1])
+               +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -454,6 +454,30 @@ GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(cou
                   +- Calc(select=[a, b, c, MOD(HASH_CODE(b), 1024) AS $f3, MOD(HASH_CODE(c), 1024) AS $f4])
                      +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSomeColumnsBothInDistinctAggAndGroupBy[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[SELECT a, COUNT(DISTINCT a), COUNT(b) FROM MyTable GROUP BY a]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $0)], EXPR$2=[COUNT($1)])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(count$0) AS $f1, $SUM0(count$1) AS $f2])
++- Exchange(distribution=[hash[a]])
+   +- IncrementalGroupAggregate(partialAggGrouping=[a], finalAggGrouping=[a], select=[a, COUNT(distinct$0 count$0) AS count$0, COUNT(count$1) AS count$1])
+      +- Exchange(distribution=[hash[a]])
+         +- LocalGroupAggregate(groupBy=[a], partialFinalType=[PARTIAL], select=[a, COUNT(distinct$0 a) AS count$0, COUNT(b) AS count$1, DISTINCT(a) AS distinct$0])
+            +- Calc(select=[a, b])
+               +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -493,30 +517,6 @@ GlobalGroupAggregate(groupBy=[b], partialFinalType=[FINAL], select=[b, SUM_RETRA
                         +- Calc(select=[a, b], changelogMode=[I])
                            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime], changelogMode=[I])
                               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSomeColumnsBothInDistinctAggAndGroupBy[splitDistinctAggEnabled=true, aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[SELECT a, COUNT(DISTINCT a), COUNT(b) FROM MyTable GROUP BY a]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $0)], EXPR$2=[COUNT($1)])
-+- LogicalProject(a=[$0], b=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GlobalGroupAggregate(groupBy=[a], partialFinalType=[FINAL], select=[a, $SUM0(count$0) AS $f1, $SUM0(count$1) AS $f2])
-+- Exchange(distribution=[hash[a]])
-   +- IncrementalGroupAggregate(partialAggGrouping=[a], finalAggGrouping=[a], select=[a, COUNT(distinct$0 count$0) AS count$0, COUNT(count$1) AS count$1])
-      +- Exchange(distribution=[hash[a]])
-         +- LocalGroupAggregate(groupBy=[a], partialFinalType=[PARTIAL], select=[a, COUNT(distinct$0 a) AS count$0, COUNT(b) AS count$1, DISTINCT(a) AS distinct$0])
-            +- Calc(select=[a, b])
-               +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/OverAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/OverAggregateTest.xml
index 35c13da188e..40f7b8bf809 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/OverAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/OverAggregateTest.xml
@@ -48,64 +48,6 @@ OverAggregate(partitionBy=[a], orderBy=[ts ASC], window=[ RANGE BETWEEN UNBOUNDE
       +- Exchange(distribution=[hash[a, b]])
          +- WatermarkAssigner(rowtime=[ts], watermark=[ts])
             +- TableSourceScan(table=[[default_catalog, default_database, src]], fields=[a, b, ts])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProctimeBoundedDistinctPartitionedRowOver">
-    <Resource name="sql">
-      <![CDATA[
-SELECT c,
-    COUNT(DISTINCT a) OVER (PARTITION BY c ORDER BY proctime
-        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS cnt1,
-    SUM(DISTINCT a) OVER (PARTITION BY c ORDER BY proctime
-        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS sum1
-FROM MyTable
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(c=[$2], cnt1=[COUNT(DISTINCT $0) OVER (PARTITION BY $2 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], sum1=[CASE(>(COUNT(DISTINCT $0) OVER (PARTITION BY $2 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), 0), $SUM0(DISTINCT $0) OVER (PARTITION BY $2 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), null:INTEGER)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[c, w0$o0 AS cnt1, CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS sum1])
-+- OverAggregate(partitionBy=[c], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, c, proctime, COUNT(DISTINCT a) AS w0$o0, $SUM0(DISTINCT a) AS w0$o1])
-   +- Exchange(distribution=[hash[c]])
-      +- Calc(select=[a, c, proctime])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProctimeBoundedDistinctWithNonDistinctPartitionedRowOver">
-    <Resource name="sql">
-      <![CDATA[
-SELECT b,
-    COUNT(a) OVER (PARTITION BY b ORDER BY proctime
-        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS cnt1,
-    SUM(a) OVER (PARTITION BY b ORDER BY proctime
-        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS sum1,
-    COUNT(DISTINCT a) OVER (PARTITION BY b ORDER BY proctime
-        ROWS BETWEEN 2 preceding AND CURRENT ROW) AS cnt2,
-    sum(DISTINCT c) OVER (PARTITION BY b ORDER BY proctime
-        ROWS BETWEEN 2 preceding AND CURRENT ROW) AS sum2
-FROM MyTable
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$1], cnt1=[COUNT($0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], sum1=[CASE(>(COUNT($0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), 0), $SUM0($0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), null:INTEGER)], cnt2=[COUNT(DISTINCT $0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], sum2=[CASE(>(COUNT(DISTINCT $2) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), 0), $SUM0(DISTINCT $2) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), null:BIGINT)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[b, w0$o0 AS cnt1, CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS sum1, w0$o2 AS cnt2, CASE((w0$o3 > 0), w0$o4, null:BIGINT) AS sum2])
-+- OverAggregate(partitionBy=[b], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, c, proctime, COUNT(a) AS w0$o0, $SUM0(a) AS w0$o1, COUNT(DISTINCT a) AS w0$o2, COUNT(DISTINCT c) AS w0$o3, $SUM0(DISTINCT c) AS w0$o4])
-   +- Exchange(distribution=[hash[b]])
-      +- Calc(select=[a, b, c, proctime])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -324,6 +266,64 @@ Calc(select=[c, w0$o0 AS $1])
 +- OverAggregate(partitionBy=[c], orderBy=[proctime ASC], window=[ ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, b, c, proctime, rowtime, COUNT(a) AS w0$o0])
    +- Exchange(distribution=[hash[c]])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProctimeBoundedDistinctPartitionedRowOver">
+    <Resource name="sql">
+      <![CDATA[
+SELECT c,
+    COUNT(DISTINCT a) OVER (PARTITION BY c ORDER BY proctime
+        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS cnt1,
+    SUM(DISTINCT a) OVER (PARTITION BY c ORDER BY proctime
+        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS sum1
+FROM MyTable
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(c=[$2], cnt1=[COUNT(DISTINCT $0) OVER (PARTITION BY $2 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], sum1=[CASE(>(COUNT(DISTINCT $0) OVER (PARTITION BY $2 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), 0), $SUM0(DISTINCT $0) OVER (PARTITION BY $2 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), null:INTEGER)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[c, w0$o0 AS cnt1, CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS sum1])
++- OverAggregate(partitionBy=[c], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, c, proctime, COUNT(DISTINCT a) AS w0$o0, $SUM0(DISTINCT a) AS w0$o1])
+   +- Exchange(distribution=[hash[c]])
+      +- Calc(select=[a, c, proctime])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProctimeBoundedDistinctWithNonDistinctPartitionedRowOver">
+    <Resource name="sql">
+      <![CDATA[
+SELECT b,
+    COUNT(a) OVER (PARTITION BY b ORDER BY proctime
+        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS cnt1,
+    SUM(a) OVER (PARTITION BY b ORDER BY proctime
+        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS sum1,
+    COUNT(DISTINCT a) OVER (PARTITION BY b ORDER BY proctime
+        ROWS BETWEEN 2 preceding AND CURRENT ROW) AS cnt2,
+    sum(DISTINCT c) OVER (PARTITION BY b ORDER BY proctime
+        ROWS BETWEEN 2 preceding AND CURRENT ROW) AS sum2
+FROM MyTable
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$1], cnt1=[COUNT($0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], sum1=[CASE(>(COUNT($0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), 0), $SUM0($0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), null:INTEGER)], cnt2=[COUNT(DISTINCT $0) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING)], sum2=[CASE(>(COUNT(DISTINCT $2) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), 0), $SUM0(DISTINCT $2) OVER (PARTITION BY $1 ORDER BY $3 NULLS FIRST ROWS 2 PRECEDING), null:BIGINT)])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[b, w0$o0 AS cnt1, CASE((w0$o0 > 0), w0$o1, null:INTEGER) AS sum1, w0$o2 AS cnt2, CASE((w0$o3 > 0), w0$o4, null:BIGINT) AS sum2])
++- OverAggregate(partitionBy=[b], orderBy=[proctime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, b, c, proctime, COUNT(a) AS w0$o0, $SUM0(a) AS w0$o1, COUNT(DISTINCT a) AS w0$o2, COUNT(DISTINCT c) AS w0$o3, $SUM0(DISTINCT c) AS w0$o4])
+   +- Exchange(distribution=[hash[b]])
+      +- Calc(select=[a, b, c, proctime])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml
index 090e814992e..042b69ff4f1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml
@@ -83,31 +83,6 @@ Calc(select=[EXPR$0])
          +- Calc(select=[b, a])
             +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testGroupAggregateWithExpressionInSelect">
-    <Resource name="sql">
-      <![CDATA[SELECT MIN(c), AVG(a) FROM (SELECT a, b + 3 AS d, c FROM MyTable) GROUP BY d]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
-+- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[AVG($2)])
-   +- LogicalProject(d=[$1], c=[$2], a=[$0])
-      +- LogicalProject(a=[$0], d=[+($1, 3)], c=[$2])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0, EXPR$1])
-+- GlobalGroupAggregate(groupBy=[d], select=[d, MIN(min$0) AS EXPR$0, AVG((sum$1, count$2)) AS EXPR$1])
-   +- Exchange(distribution=[hash[d]])
-      +- LocalGroupAggregate(groupBy=[d], select=[d, MIN(c) AS min$0, AVG(a) AS (sum$1, count$2)])
-         +- Calc(select=[(b + 3) AS d, c, a])
-            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -133,50 +108,75 @@ GlobalGroupAggregate(select=[COUNT(count$0) AS EXPR$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithFilter">
+  <TestCase name="testGroupAggregateWithConstant">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM (SELECT b, SUM(a) FROM MyTable GROUP BY b) WHERE b = 2]]>
+      <![CDATA[SELECT four, SUM(a) FROM (SELECT b, 4 AS four, a FROM MyTable) GROUP BY b, four]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$0], EXPR$1=[$1])
-+- LogicalFilter(condition=[=($0, 2)])
-   +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-      +- LogicalProject(b=[$1], a=[$0])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(four=[$1], EXPR$1=[$2])
++- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
+   +- LogicalProject(b=[$1], four=[4], a=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[CAST(2 AS BIGINT) AS b, EXPR$1])
+Calc(select=[4 AS four, EXPR$1])
 +- GlobalGroupAggregate(groupBy=[b], select=[b, SUM(sum$0) AS EXPR$1])
    +- Exchange(distribution=[hash[b]])
       +- LocalGroupAggregate(groupBy=[b], select=[b, SUM(a) AS sum$0])
-         +- Calc(select=[CAST(2 AS BIGINT) AS b, a], where=[(b = 2)])
+         +- Calc(select=[b, a])
             +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupAggregateWithConstant">
+  <TestCase name="testGroupAggregateWithExpressionInSelect">
     <Resource name="sql">
-      <![CDATA[SELECT four, SUM(a) FROM (SELECT b, 4 AS four, a FROM MyTable) GROUP BY b, four]]>
+      <![CDATA[SELECT MIN(c), AVG(a) FROM (SELECT a, b + 3 AS d, c FROM MyTable) GROUP BY d]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(four=[$1], EXPR$1=[$2])
-+- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
-   +- LogicalProject(b=[$1], four=[4], a=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
++- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[AVG($2)])
+   +- LogicalProject(d=[$1], c=[$2], a=[$0])
+      +- LogicalProject(a=[$0], d=[+($1, 3)], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[4 AS four, EXPR$1])
+Calc(select=[EXPR$0, EXPR$1])
++- GlobalGroupAggregate(groupBy=[d], select=[d, MIN(min$0) AS EXPR$0, AVG((sum$1, count$2)) AS EXPR$1])
+   +- Exchange(distribution=[hash[d]])
+      +- LocalGroupAggregate(groupBy=[d], select=[d, MIN(c) AS min$0, AVG(a) AS (sum$1, count$2)])
+         +- Calc(select=[(b + 3) AS d, c, a])
+            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testGroupAggregateWithFilter">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM (SELECT b, SUM(a) FROM MyTable GROUP BY b) WHERE b = 2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$0], EXPR$1=[$1])
++- LogicalFilter(condition=[=($0, 2)])
+   +- LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
+      +- LogicalProject(b=[$1], a=[$0])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[CAST(2 AS BIGINT) AS b, EXPR$1])
 +- GlobalGroupAggregate(groupBy=[b], select=[b, SUM(sum$0) AS EXPR$1])
    +- Exchange(distribution=[hash[b]])
       +- LocalGroupAggregate(groupBy=[b], select=[b, SUM(a) AS sum$0])
-         +- Calc(select=[b, a])
+         +- Calc(select=[CAST(2 AS BIGINT) AS b, a], where=[(b = 2)])
             +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
index b3dbc3a2ca4..71a9bd5df9a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
@@ -323,6 +323,42 @@ Calc(select=[a, b, uv])
             +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
                +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
                   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testCantTranslateToWindowAgg_GroupOnOnlyStart[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   window_start,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   weightedAvg(b, e) AS wAvg,
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY window_start
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0}], EXPR$1=[COUNT()], EXPR$2=[SUM($1)], EXPR$3=[MAX($1) FILTER $2], wAvg=[weightedAvg($3, $4)], uv=[COUNT(DISTINCT $5)])
++- LogicalProject(window_start=[$7], d=[$3], $f2=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+GroupAggregate(groupBy=[window_start], select=[window_start, COUNT(*) AS EXPR$1, SUM(d) AS EXPR$2, MAX(d) FILTER $f2 AS EXPR$3, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv])
++- Exchange(distribution=[hash[window_start]])
+   +- Calc(select=[window_start, d, IS TRUE(>(b, 1000)) AS $f2, b, e, c])
+      +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, e, rowtime], metadata=[]]], fields=[b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -393,42 +429,6 @@ Calc(select=[a, uv])
             +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
                +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
                   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testCantTranslateToWindowAgg_GroupOnOnlyStart[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   window_start,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   weightedAvg(b, e) AS wAvg,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY window_start
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0}], EXPR$1=[COUNT()], EXPR$2=[SUM($1)], EXPR$3=[MAX($1) FILTER $2], wAvg=[weightedAvg($3, $4)], uv=[COUNT(DISTINCT $5)])
-+- LogicalProject(window_start=[$7], d=[$3], $f2=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-GroupAggregate(groupBy=[window_start], select=[window_start, COUNT(*) AS EXPR$1, SUM(d) AS EXPR$2, MAX(d) FILTER $f2 AS EXPR$3, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv])
-+- Exchange(distribution=[hash[window_start]])
-   +- Calc(select=[window_start, d, IS TRUE(>(b, 1000)) AS $f2, b, e, c])
-      +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, e, rowtime], metadata=[]]], fields=[b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -813,7 +813,7 @@ Calc(select=[a, b, $f3 AS EXPR$2, $f4 AS uv])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCumulate_OnProctime[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testCumulate_OnProctimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -826,7 +826,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-  CUMULATE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  CUMULATE(TABLE MyCDCTable, DESCRIPTOR(proctime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -838,22 +838,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[proctime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[proctime], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime], changelogMode=[I,UB,UA,D])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime], changelogMode=[I,UB,UA,D])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCumulate_OnProctimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testCumulate_OnProctime[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -866,7 +866,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-  CUMULATE(TABLE MyCDCTable, DESCRIPTOR(proctime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  CUMULATE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -878,22 +878,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[proctime], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime], changelogMode=[I,UB,UA,D])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime], changelogMode=[I,UB,UA,D])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[proctime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCumulate_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testCumulate_OnRowtimeWithCDCSource[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -906,7 +906,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-  CUMULATE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  CUMULATE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -918,21 +918,21 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCumulate_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testCumulate_OnRowtimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -945,7 +945,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-  CUMULATE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  CUMULATE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -957,22 +957,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT(count1$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f4 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(count1$0) AS EXPR$3, SUM_RETRACT((sum$1, count$2)) AS EXPR$4, MAX_RETRACT(max$3) AS EXPR$5, weightedAvg_RETRACT(weightedavg$4) AS wAvg, COUNT_RETRACT(distinct$0 count$5) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(*) AS count1$0, SUM_RETRACT(d) AS (sum$1, count$2), MAX_RETRACT(d) FILTER $f4 AS max$3, weightedAvg_RETRACT(b, e) AS weightedavg$4, COUNT_RETRACT(distinct$0 c) AS count$5, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end], changelogMode=[I,UB,UA,D])
+         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCumulate_OnRowtimeWithCDCSource[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testCumulate_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -985,7 +985,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-  CUMULATE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  CUMULATE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -997,21 +997,21 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testCumulate_OnRowtimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testCumulate_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1024,7 +1024,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-  CUMULATE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
+  CUMULATE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '10' MINUTE, INTERVAL '1' HOUR))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1036,18 +1036,18 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(count1$0) AS EXPR$3, SUM_RETRACT((sum$1, count$2)) AS EXPR$4, MAX_RETRACT(max$3) AS EXPR$5, weightedAvg_RETRACT(weightedavg$4) AS wAvg, COUNT_RETRACT(distinct$0 count$5) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT_RETRACT(*) AS count1$0, SUM_RETRACT(d) AS (sum$1, count$2), MAX_RETRACT(d) FILTER $f4 AS max$3, weightedAvg_RETRACT(b, e) AS weightedavg$4, COUNT_RETRACT(distinct$0 c) AS count$5, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end], changelogMode=[I,UB,UA,D])
-         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT(count1$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f4 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -1695,7 +1695,7 @@ Calc(select=[a, b, $f3 AS EXPR$2, $f4 AS uv])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_OnProctime[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testHop_OnProctimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1708,7 +1708,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-   HOP(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+   HOP(TABLE MyCDCTable, DESCRIPTOR(proctime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1720,22 +1720,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[HOP(time_col=[proctime], size=[10 min], slide=[5 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- WindowAggregate(groupBy=[a], window=[HOP(time_col=[proctime], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime], changelogMode=[I,UB,UA,D])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime], changelogMode=[I,UB,UA,D])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_OnProctimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testHop_OnProctime[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1748,7 +1748,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-   HOP(TABLE MyCDCTable, DESCRIPTOR(proctime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+   HOP(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1760,22 +1760,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- WindowAggregate(groupBy=[a], window=[HOP(time_col=[proctime], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime], changelogMode=[I,UB,UA,D])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime], changelogMode=[I,UB,UA,D])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[HOP(time_col=[proctime], size=[10 min], slide=[5 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testHop_OnRowtimeWithCDCSource[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1788,7 +1788,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+   HOP(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1800,21 +1800,21 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- WindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testHop_OnRowtimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1827,7 +1827,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+   HOP(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1839,22 +1839,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- GlobalWindowAggregate(groupBy=[a], window=[HOP(slice_end=[$slice_end], size=[10 min], slide=[5 min])], select=[a, COUNT(count1$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- LocalWindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f4 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- GlobalWindowAggregate(groupBy=[a], window=[HOP(slice_end=[$slice_end], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(count1$0) AS EXPR$3, SUM_RETRACT((sum$1, count$2)) AS EXPR$4, MAX_RETRACT(max$3) AS EXPR$5, weightedAvg_RETRACT(weightedavg$4) AS wAvg, COUNT_RETRACT(distinct$0 count$5) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- LocalWindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(*) AS count1$0, SUM_RETRACT(d) AS (sum$1, count$2), MAX_RETRACT(d) FILTER $f4 AS max$3, weightedAvg_RETRACT(b, e) AS weightedavg$4, COUNT_RETRACT(distinct$0 c) AS count$5, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end], changelogMode=[I,UB,UA,D])
+         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_OnRowtimeWithCDCSource[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testHop_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1867,7 +1867,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-   HOP(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1879,21 +1879,21 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- WindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testHop_OnRowtimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testHop_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -1906,7 +1906,7 @@ SELECT
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
 FROM TABLE(
-   HOP(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -1918,18 +1918,18 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- GlobalWindowAggregate(groupBy=[a], window=[HOP(slice_end=[$slice_end], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(count1$0) AS EXPR$3, SUM_RETRACT((sum$1, count$2)) AS EXPR$4, MAX_RETRACT(max$3) AS EXPR$5, weightedAvg_RETRACT(weightedavg$4) AS wAvg, COUNT_RETRACT(distinct$0 count$5) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- LocalWindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT_RETRACT(*) AS count1$0, SUM_RETRACT(d) AS (sum$1, count$2), MAX_RETRACT(d) FILTER $f4 AS max$3, weightedAvg_RETRACT(b, e) AS weightedavg$4, COUNT_RETRACT(distinct$0 c) AS count$5, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end], changelogMode=[I,UB,UA,D])
-         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- GlobalWindowAggregate(groupBy=[a], window=[HOP(slice_end=[$slice_end], size=[10 min], slide=[5 min])], select=[a, COUNT(count1$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalWindowAggregate(groupBy=[a], window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f4 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -2975,199 +2975,97 @@ Sink(table=[default_catalog.default_database.sink], fields=[ws, we, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSession_DistinctSplitEnabled[aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   window_start,
-   window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   count(distinct c) AS uv
-FROM TABLE(
-  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(proctime), INTERVAL '5' MINUTE))
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'proctime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[proctime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, proctime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, PROCTIME() AS proctime, rowtime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSession_DistinctSplitEnabled[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testSessionWindowTVFWithPartitionKeyWhenCantMerge[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
-   a,
    window_start,
    window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   count(distinct c) AS uv
-FROM TABLE(
-  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(proctime), INTERVAL '5' MINUTE))
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'proctime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[proctime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, proctime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, PROCTIME() AS proctime, rowtime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSession_OnProctime[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
    a,
-   window_start,
-   window_end,
    count(*),
    sum(d),
    max(d) filter (where b > 1000),
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
-FROM TABLE(
-  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(proctime), INTERVAL '5' MINUTE))
+FROM (
+  SELECT window_start, rowtime, d, proctime, e, b, c, window_end, window_time, a
+  FROM TABLE(SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
+  WHERE window_start >= TIMESTAMP '2021-01-01 10:10:00.000'
+)
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'proctime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(window_start=[$1], window_end=[$2], a=[$0], EXPR$3=[$3], EXPR$4=[$4], EXPR$5=[$5], wAvg=[$6], uv=[$7])
++- LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
+   +- LogicalProject(a=[$9], window_start=[$0], window_end=[$7], d=[$2], $f4=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
+      +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
+         +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
+            +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[proctime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+Calc(select=[window_start, window_end, a, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(win_start=[window_start], win_end=[window_end], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+      +- Calc(select=[a, window_start, window_end, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c], where=[>=(window_start, 2021-01-01 10:10:00)])
+         +- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])])
+            +- Exchange(distribution=[hash[a]])
+               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSession_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testSessionWindowTVFWithPartitionKeyWhenCantMerge[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
-   a,
    window_start,
    window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   weightedAvg(b, e) AS wAvg,
-   count(distinct c) AS uv
-FROM TABLE(
-  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSession_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
    a,
-   window_start,
-   window_end,
    count(*),
    sum(d),
    max(d) filter (where b > 1000),
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
-FROM TABLE(
-  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
+FROM (
+  SELECT window_start, rowtime, d, proctime, e, b, c, window_end, window_time, a
+  FROM TABLE(SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
+  WHERE window_start >= TIMESTAMP '2021-01-01 10:10:00.000'
+)
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(window_start=[$1], window_end=[$2], a=[$0], EXPR$3=[$3], EXPR$4=[$4], EXPR$5=[$5], wAvg=[$6], uv=[$7])
++- LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
+   +- LogicalProject(a=[$9], window_start=[$0], window_end=[$7], d=[$2], $f4=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
+      +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
+         +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
+            +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+Calc(select=[window_start, window_end, a, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(win_start=[window_start], win_end=[window_end], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+      +- Calc(select=[a, window_start, window_end, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c], where=[>=(window_start, 2021-01-01 10:10:00)])
+         +- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])])
+            +- Exchange(distribution=[hash[a]])
+               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -3258,100 +3156,6 @@ Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, wAvg, uv])
             +- Exchange(distribution=[single])
                +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
                   +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, e, rowtime], metadata=[]]], fields=[b, c, d, e, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSessionWindowTVFWithPartitionKeyWhenCantMerge[aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   window_start,
-   window_end,
-   a,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   weightedAvg(b, e) AS wAvg,
-   count(distinct c) AS uv
-FROM (
-  SELECT window_start, rowtime, d, proctime, e, b, c, window_end, window_time, a
-  FROM TABLE(SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
-  WHERE window_start >= TIMESTAMP '2021-01-01 10:10:00.000'
-)
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(window_start=[$1], window_end=[$2], a=[$0], EXPR$3=[$3], EXPR$4=[$4], EXPR$5=[$5], wAvg=[$6], uv=[$7])
-+- LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-   +- LogicalProject(a=[$9], window_start=[$0], window_end=[$7], d=[$2], $f4=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
-      +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
-         +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
-            +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[window_start, window_end, a, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(win_start=[window_start], win_end=[window_end], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, window_start, window_end, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c], where=[>=(window_start, 2021-01-01 10:10:00)])
-         +- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])])
-            +- Exchange(distribution=[hash[a]])
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSessionWindowTVFWithPartitionKeyWhenCantMerge[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   window_start,
-   window_end,
-   a,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   weightedAvg(b, e) AS wAvg,
-   count(distinct c) AS uv
-FROM (
-  SELECT window_start, rowtime, d, proctime, e, b, c, window_end, window_time, a
-  FROM TABLE(SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
-  WHERE window_start >= TIMESTAMP '2021-01-01 10:10:00.000'
-)
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(window_start=[$1], window_end=[$2], a=[$0], EXPR$3=[$3], EXPR$4=[$4], EXPR$5=[$5], wAvg=[$6], uv=[$7])
-+- LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-   +- LogicalProject(a=[$9], window_start=[$0], window_end=[$7], d=[$2], $f4=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
-      +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
-         +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
-            +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[window_start, window_end, a, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[SESSION(win_start=[window_start], win_end=[window_end], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, window_start, window_end, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c], where=[>=(window_start, 2021-01-01 10:10:00)])
-         +- WindowTableFunction(window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])])
-            +- Exchange(distribution=[hash[a]])
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-                  +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -3412,6 +3216,202 @@ Calc(select=[a, b, window_start, window_end, EXPR$4, EXPR$5, EXPR$6, wAvg, uv])
       +- Calc(select=[b, a, d, (b > 1000) IS TRUE AS $f5, e, c, rowtime])
          +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSession_DistinctSplitEnabled[aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   count(distinct c) AS uv
+FROM TABLE(
+  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(proctime), INTERVAL '5' MINUTE))
+GROUP BY a, window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'proctime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[proctime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, proctime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, PROCTIME() AS proctime, rowtime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSession_DistinctSplitEnabled[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   count(distinct c) AS uv
+FROM TABLE(
+  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(proctime), INTERVAL '5' MINUTE))
+GROUP BY a, window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'proctime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[proctime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, proctime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, PROCTIME() AS proctime, rowtime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSession_OnProctime[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   weightedAvg(b, e) AS wAvg,
+   count(distinct c) AS uv
+FROM TABLE(
+  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(proctime), INTERVAL '5' MINUTE))
+GROUP BY a, window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'proctime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[proctime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSession_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   weightedAvg(b, e) AS wAvg,
+   count(distinct c) AS uv
+FROM TABLE(
+  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
+GROUP BY a, window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSession_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   weightedAvg(b, e) AS wAvg,
+   count(distinct c) AS uv
+FROM TABLE(
+  SESSION(TABLE MyTable PARTITION BY a, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE))
+GROUP BY a, window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[SESSION(TABLE(#0) PARTITION BY($0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[SESSION(time_col=[rowtime], gap=[5 min], partition keys=[a])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -4104,263 +4104,35 @@ Calc(select=[a, window_start, window_end, $f1 AS $f3, $f2 AS $f4, $f3 AS $f5, $f
 SELECT
    a,
    window_start,
-   window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, uv])
-+- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[proctime], size=[15 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, proctime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, d, PROCTIME() AS proctime, rowtime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_GroupingSets1[aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   b,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], uv=[$4])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
-   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, uv])
-+- WindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a, b, $e]])
-      +- Expand(projects=[{a, null AS b, c, 4 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_GroupingSets1[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   b,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], uv=[$4])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
-   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, uv])
-+- GlobalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 count$0) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a, b, $e]])
-      +- LocalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Expand(projects=[{a, null AS b, c, 4 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_GroupingSets[aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   b,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY GROUPING SETS ((a, window_start, window_end), (b, window_start, window_end))
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$3], uv=[$4])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 1, 2}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
-   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], b=[$1], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, uv])
-+- WindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a, b, $e]])
-      +- Expand(projects=[{a, null AS b, c, 1 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_GroupingSets[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   b,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY GROUPING SETS ((a, window_start, window_end), (b, window_start, window_end))
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$3], uv=[$4])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 1, 2}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
-   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], b=[$1], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, uv])
-+- GlobalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 count$0) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a, b, $e]])
-      +- LocalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Expand(projects=[{a, null AS b, c, 1 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_GroupingSetsDistinctSplitEnabled[aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   b,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], EXPR$2=[$4], EXPR$3=[$5], EXPR$4=[$6], uv=[$7])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], EXPR$2=[COUNT()], EXPR$3=[SUM($4)], EXPR$4=[MAX($4) FILTER $5], uv=[COUNT(DISTINCT $6)])
-   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], d=[$3], $f5=[IS TRUE(>($1, 1000))], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, $f3 AS EXPR$2, $f4 AS EXPR$3, $f5 AS EXPR$4, $f6 AS uv])
-+- WindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, b, $e, $SUM0($f7) AS $f3, SUM($f8_0) AS $f4, MAX($f9_0) AS $f5, $SUM0($f10) AS $f6, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a, b, $e]])
-      +- Calc(select=[a, b, window_start, window_end, $e, $f8, $f9, $f5 AS $f7, $f6 AS $f8_0, $f7 AS $f9_0, $f8_0 AS $f10])
-         +- WindowAggregate(groupBy=[a, b, $e, $f8, $f9], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, $f8, $f9, COUNT(*) FILTER $g_3 AS $f5, SUM(d) FILTER $g_3 AS $f6, MAX(d) FILTER $g_1 AS $f7, COUNT(DISTINCT c) FILTER $g_2 AS $f8_0, start('w$) AS window_start, end('w$) AS window_end])
-            +- Exchange(distribution=[hash[a, b, $e, $f8, $f9]])
-               +- Calc(select=[a, b, d, $f5, c, $e, $f8, $f9, =($e_0, 3) AS $g_3, AND(=($e_0, 1), $f5) AS $g_1, =($e_0, 2) AS $g_2, rowtime])
-                  +- Expand(projects=[{a, b, d, $f5, c, $e, $f8, null AS $f9, 1 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, $f9, 2 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, null AS $f9, 3 AS $e_0, rowtime}])
-                     +- Calc(select=[a, b, d, $f5, c, $e, MOD(HASH_CODE(d), 1024) AS $f8, MOD(HASH_CODE(c), 1024) AS $f9, rowtime])
-                        +- Expand(projects=[{a, null AS b, d, $f5, c, 4 AS $e, rowtime}, {null AS a, b, d, $f5, c, 8 AS $e, rowtime}])
-                           +- Calc(select=[a, b, d, IS TRUE(>(b, 1000)) AS $f5, c, rowtime])
-                              +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-                                 +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_GroupingSetsDistinctSplitEnabled[aggPhaseEnforcer=TWO_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   b,
+   window_end,
    count(*),
    sum(d),
    max(d) filter (where b > 1000),
    count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
+GROUP BY a, window_start, window_end
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], EXPR$2=[$4], EXPR$3=[$5], EXPR$4=[$6], uv=[$7])
-+- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], EXPR$2=[COUNT()], EXPR$3=[SUM($4)], EXPR$4=[MAX($4) FILTER $5], uv=[COUNT(DISTINCT $6)])
-   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], d=[$3], $f5=[IS TRUE(>($1, 1000))], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], uv=[COUNT(DISTINCT $5)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, b, $f3 AS EXPR$2, $f4 AS EXPR$3, $f5 AS EXPR$4, $f6 AS uv])
-+- GlobalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(win_end=[$window_end], size=[15 min])], select=[a, b, $e, $SUM0(sum$0) AS $f3, SUM(sum$1) AS $f4, MAX(max$2) AS $f5, $SUM0(sum$3) AS $f6, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a, b, $e]])
-      +- LocalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, b, $e, $SUM0($f7) AS sum$0, SUM($f8_0) AS sum$1, MAX($f9_0) AS max$2, $SUM0($f10) AS sum$3, slice_end('w$) AS $window_end])
-         +- Calc(select=[a, b, window_start, window_end, $e, $f8, $f9, $f5 AS $f7, $f6 AS $f8_0, $f7 AS $f9_0, $f8_0 AS $f10])
-            +- GlobalWindowAggregate(groupBy=[a, b, $e, $f8, $f9], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, b, $e, $f8, $f9, COUNT(count1$0) AS $f5, SUM(sum$1) AS $f6, MAX(max$2) AS $f7, COUNT(distinct$0 count$3) AS $f8_0, start('w$) AS window_start, end('w$) AS window_end])
-               +- Exchange(distribution=[hash[a, b, $e, $f8, $f9]])
-                  +- LocalWindowAggregate(groupBy=[a, b, $e, $f8, $f9], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, $f8, $f9, COUNT(*) FILTER $g_3 AS count1$0, SUM(d) FILTER $g_3 AS sum$1, MAX(d) FILTER $g_1 AS max$2, COUNT(distinct$0 c) FILTER $g_2 AS count$3, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-                     +- Calc(select=[a, b, d, $f5, c, $e, $f8, $f9, =($e_0, 3) AS $g_3, AND(=($e_0, 1), $f5) AS $g_1, =($e_0, 2) AS $g_2, rowtime])
-                        +- Expand(projects=[{a, b, d, $f5, c, $e, $f8, null AS $f9, 1 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, $f9, 2 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, null AS $f9, 3 AS $e_0, rowtime}])
-                           +- Calc(select=[a, b, d, $f5, c, $e, MOD(HASH_CODE(d), 1024) AS $f8, MOD(HASH_CODE(c), 1024) AS $f9, rowtime])
-                              +- Expand(projects=[{a, null AS b, d, $f5, c, 4 AS $e, rowtime}, {null AS a, b, d, $f5, c, 8 AS $e, rowtime}])
-                                 +- Calc(select=[a, b, d, IS TRUE(>(b, 1000)) AS $f5, c, rowtime])
-                                    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-                                       +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, uv])
++- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[proctime], size=[15 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, c, proctime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, d, PROCTIME() AS proctime, rowtime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -4609,76 +4381,304 @@ Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, uv])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_GroupOnlyWindowColumns[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testTumble_GroupOnlyWindowColumns[aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], uv=[COUNT(DISTINCT $4)])
++- LogicalProject(window_start=[$7], window_end=[$8], d=[$3], $f3=[IS TRUE(>($1, 1000))], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, uv])
++- WindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS EXPR$2, SUM(d) AS EXPR$3, MAX(d) FILTER $f3 AS EXPR$4, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[d, IS TRUE(>(b, 1000)) AS $f3, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, rowtime], metadata=[]]], fields=[b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_GroupOnlyWindowColumns[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], uv=[COUNT(DISTINCT $4)])
++- LogicalProject(window_start=[$7], window_end=[$8], d=[$3], $f3=[IS TRUE(>($1, 1000))], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, uv])
++- GlobalWindowAggregate(window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[COUNT(count1$0) AS EXPR$2, SUM(sum$1) AS EXPR$3, MAX(max$2) AS EXPR$4, COUNT(distinct$0 count$3) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[single])
+      +- LocalWindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f3 AS max$2, COUNT(distinct$0 c) AS count$3, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Calc(select=[d, IS TRUE(>(b, 1000)) AS $f3, c, rowtime])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, rowtime], metadata=[]]], fields=[b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_GroupingSets1[aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   b,
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], uv=[$4])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
+   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], c=[$2])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, b, uv])
++- WindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a, b, $e]])
+      +- Expand(projects=[{a, null AS b, c, 4 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_GroupingSets1[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   b,
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], uv=[$4])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
+   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], c=[$2])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, b, uv])
++- GlobalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 count$0) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a, b, $e]])
+      +- LocalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Expand(projects=[{a, null AS b, c, 4 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_GroupingSetsDistinctSplitEnabled[aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   b,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], EXPR$2=[$4], EXPR$3=[$5], EXPR$4=[$6], uv=[$7])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], EXPR$2=[COUNT()], EXPR$3=[SUM($4)], EXPR$4=[MAX($4) FILTER $5], uv=[COUNT(DISTINCT $6)])
+   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], d=[$3], $f5=[IS TRUE(>($1, 1000))], c=[$2])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, b, $f3 AS EXPR$2, $f4 AS EXPR$3, $f5 AS EXPR$4, $f6 AS uv])
++- WindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, b, $e, $SUM0($f7) AS $f3, SUM($f8_0) AS $f4, MAX($f9_0) AS $f5, $SUM0($f10) AS $f6, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a, b, $e]])
+      +- Calc(select=[a, b, window_start, window_end, $e, $f8, $f9, $f5 AS $f7, $f6 AS $f8_0, $f7 AS $f9_0, $f8_0 AS $f10])
+         +- WindowAggregate(groupBy=[a, b, $e, $f8, $f9], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, $f8, $f9, COUNT(*) FILTER $g_3 AS $f5, SUM(d) FILTER $g_3 AS $f6, MAX(d) FILTER $g_1 AS $f7, COUNT(DISTINCT c) FILTER $g_2 AS $f8_0, start('w$) AS window_start, end('w$) AS window_end])
+            +- Exchange(distribution=[hash[a, b, $e, $f8, $f9]])
+               +- Calc(select=[a, b, d, $f5, c, $e, $f8, $f9, =($e_0, 3) AS $g_3, AND(=($e_0, 1), $f5) AS $g_1, =($e_0, 2) AS $g_2, rowtime])
+                  +- Expand(projects=[{a, b, d, $f5, c, $e, $f8, null AS $f9, 1 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, $f9, 2 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, null AS $f9, 3 AS $e_0, rowtime}])
+                     +- Calc(select=[a, b, d, $f5, c, $e, MOD(HASH_CODE(d), 1024) AS $f8, MOD(HASH_CODE(c), 1024) AS $f9, rowtime])
+                        +- Expand(projects=[{a, null AS b, d, $f5, c, 4 AS $e, rowtime}, {null AS a, b, d, $f5, c, 8 AS $e, rowtime}])
+                           +- Calc(select=[a, b, d, IS TRUE(>(b, 1000)) AS $f5, c, rowtime])
+                              +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+                                 +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_GroupingSetsDistinctSplitEnabled[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   b,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY GROUPING SETS ((a), (b)), window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], EXPR$2=[$4], EXPR$3=[$5], EXPR$4=[$6], uv=[$7])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 2, 3}, {1, 2, 3}]], EXPR$2=[COUNT()], EXPR$3=[SUM($4)], EXPR$4=[MAX($4) FILTER $5], uv=[COUNT(DISTINCT $6)])
+   +- LogicalProject(a=[$0], b=[$1], window_start=[$7], window_end=[$8], d=[$3], $f5=[IS TRUE(>($1, 1000))], c=[$2])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, b, $f3 AS EXPR$2, $f4 AS EXPR$3, $f5 AS EXPR$4, $f6 AS uv])
++- GlobalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(win_end=[$window_end], size=[15 min])], select=[a, b, $e, $SUM0(sum$0) AS $f3, SUM(sum$1) AS $f4, MAX(max$2) AS $f5, $SUM0(sum$3) AS $f6, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a, b, $e]])
+      +- LocalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], select=[a, b, $e, $SUM0($f7) AS sum$0, SUM($f8_0) AS sum$1, MAX($f9_0) AS max$2, $SUM0($f10) AS sum$3, slice_end('w$) AS $window_end])
+         +- Calc(select=[a, b, window_start, window_end, $e, $f8, $f9, $f5 AS $f7, $f6 AS $f8_0, $f7 AS $f9_0, $f8_0 AS $f10])
+            +- GlobalWindowAggregate(groupBy=[a, b, $e, $f8, $f9], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, b, $e, $f8, $f9, COUNT(count1$0) AS $f5, SUM(sum$1) AS $f6, MAX(max$2) AS $f7, COUNT(distinct$0 count$3) AS $f8_0, start('w$) AS window_start, end('w$) AS window_end])
+               +- Exchange(distribution=[hash[a, b, $e, $f8, $f9]])
+                  +- LocalWindowAggregate(groupBy=[a, b, $e, $f8, $f9], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, $f8, $f9, COUNT(*) FILTER $g_3 AS count1$0, SUM(d) FILTER $g_3 AS sum$1, MAX(d) FILTER $g_1 AS max$2, COUNT(distinct$0 c) FILTER $g_2 AS count$3, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+                     +- Calc(select=[a, b, d, $f5, c, $e, $f8, $f9, =($e_0, 3) AS $g_3, AND(=($e_0, 1), $f5) AS $g_1, =($e_0, 2) AS $g_2, rowtime])
+                        +- Expand(projects=[{a, b, d, $f5, c, $e, $f8, null AS $f9, 1 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, $f9, 2 AS $e_0, rowtime}, {a, b, d, $f5, c, $e, null AS $f8, null AS $f9, 3 AS $e_0, rowtime}])
+                           +- Calc(select=[a, b, d, $f5, c, $e, MOD(HASH_CODE(d), 1024) AS $f8, MOD(HASH_CODE(c), 1024) AS $f9, rowtime])
+                              +- Expand(projects=[{a, null AS b, d, $f5, c, 4 AS $e, rowtime}, {null AS a, b, d, $f5, c, 8 AS $e, rowtime}])
+                                 +- Calc(select=[a, b, d, IS TRUE(>(b, 1000)) AS $f5, c, rowtime])
+                                    +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+                                       +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, d, rowtime], metadata=[]]], fields=[a, b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_GroupingSets[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
-   window_start,
-   window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
+   a,
+   b,
    count(distinct c) AS uv
 FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY window_start, window_end
+GROUP BY GROUPING SETS ((a, window_start, window_end), (b, window_start, window_end))
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], uv=[COUNT(DISTINCT $4)])
-+- LogicalProject(window_start=[$7], window_end=[$8], d=[$3], $f3=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$3], uv=[$4])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 1, 2}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
+   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], b=[$1], c=[$2])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, uv])
-+- WindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS EXPR$2, SUM(d) AS EXPR$3, MAX(d) FILTER $f3 AS EXPR$4, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[d, IS TRUE(>(b, 1000)) AS $f3, c, rowtime])
+Calc(select=[a, b, uv])
++- WindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a, b, $e]])
+      +- Expand(projects=[{a, null AS b, c, 1 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
          +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, rowtime], metadata=[]]], fields=[b, c, d, rowtime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_GroupOnlyWindowColumns[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testTumble_GroupingSets[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
-   window_start,
-   window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
+   a,
+   b,
    count(distinct c) AS uv
 FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY window_start, window_end
+GROUP BY GROUPING SETS ((a, window_start, window_end), (b, window_start, window_end))
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], uv=[COUNT(DISTINCT $4)])
-+- LogicalProject(window_start=[$7], window_end=[$8], d=[$3], $f3=[IS TRUE(>($1, 1000))], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(a=[$0], b=[$3], uv=[$4])
++- LogicalAggregate(group=[{0, 1, 2, 3}], groups=[[{0, 1, 2}, {1, 2, 3}]], uv=[COUNT(DISTINCT $4)])
+   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], b=[$1], c=[$2])
+      +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[window_start, window_end, EXPR$2, EXPR$3, EXPR$4, uv])
-+- GlobalWindowAggregate(window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[COUNT(count1$0) AS EXPR$2, SUM(sum$1) AS EXPR$3, MAX(max$2) AS EXPR$4, COUNT(distinct$0 count$3) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[single])
-      +- LocalWindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f3 AS max$2, COUNT(distinct$0 c) AS count$3, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Calc(select=[d, IS TRUE(>(b, 1000)) AS $f3, c, rowtime])
+Calc(select=[a, b, uv])
++- GlobalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 count$0) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a, b, $e]])
+      +- LocalWindowAggregate(groupBy=[a, b, $e], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, b, $e, COUNT(distinct$0 c) AS count$0, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Expand(projects=[{a, null AS b, c, 1 AS $e, rowtime}, {null AS a, b, c, 8 AS $e, rowtime}])
             +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[b, c, d, rowtime], metadata=[]]], fields=[b, c, d, rowtime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -4755,7 +4755,7 @@ Calc(select=[EXPR$0, EXPR$1, EXPR$2, wAvg, uv])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_UdafWithoutMerge[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testTumble_OnProctimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -4765,31 +4765,32 @@ SELECT
    count(*),
    sum(d),
    max(d) filter (where b > 1000),
-   weightedAvgWithoutMerge(b, e) AS wAvg,
+   weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyCDCTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvgWithoutMerge($5, $6)], uv=[COUNT(DISTINCT $7)])
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
 +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvgWithoutMerge(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[proctime], size=[15 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime], changelogMode=[I,UB,UA,D])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime], changelogMode=[I,UB,UA,D])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
@@ -4832,7 +4833,7 @@ Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_OnProctimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testTumble_OnRowtimeWithCDCSource[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -4844,7 +4845,7 @@ SELECT
    max(d) filter (where b > 1000),
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyCDCTable, DESCRIPTOR(proctime), INTERVAL '15' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -4852,7 +4853,7 @@ GROUP BY a, window_start, window_end
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
 +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'proctime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
@@ -4862,16 +4863,15 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[proctime], size=[15 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
++- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
    +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, proctime], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
          +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-            +- Calc(select=[a, b, c, d, e, rowtime, PROCTIME() AS proctime], changelogMode=[I,UB,UA,D])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
+  <TestCase name="testTumble_OnRowtimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -4883,7 +4883,7 @@ SELECT
    max(d) filter (where b > 1000),
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -4895,21 +4895,22 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
++- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT_RETRACT(count1$0) AS EXPR$3, SUM_RETRACT((sum$1, count$2)) AS EXPR$4, MAX_RETRACT(max$3) AS EXPR$5, weightedAvg_RETRACT(weightedavg$4) AS wAvg, COUNT_RETRACT(distinct$0 count$5) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
+   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
+      +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT_RETRACT(*) AS count1$0, SUM_RETRACT(d) AS (sum$1, count$2), MAX_RETRACT(d) FILTER $f4 AS max$3, weightedAvg_RETRACT(b, e) AS weightedavg$4, COUNT_RETRACT(distinct$0 c) AS count$5, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end], changelogMode=[I,UB,UA,D])
+         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testTumble_OnRowtime[aggPhaseEnforcer=ONE_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -4939,54 +4940,15 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
-+- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
++- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvg(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
    +- Exchange(distribution=[hash[a]])
-      +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f4 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTumble_OnRowtimeWithCDCSource[aggPhaseEnforcer=ONE_PHASE]">
-    <Resource name="sql">
-      <![CDATA[
-SELECT
-   a,
-   window_start,
-   window_end,
-   count(*),
-   sum(d),
-   max(d) filter (where b > 1000),
-   weightedAvg(b, e) AS wAvg,
-   count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
-GROUP BY a, window_start, window_end
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT_RETRACT(*) AS EXPR$3, SUM_RETRACT(d) AS EXPR$4, MAX_RETRACT(d) FILTER $f4 AS EXPR$5, weightedAvg_RETRACT(b, e) AS wAvg, COUNT_RETRACT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTumble_OnRowtimeWithCDCSource[aggPhaseEnforcer=TWO_PHASE]">
+  <TestCase name="testTumble_OnRowtime[aggPhaseEnforcer=TWO_PHASE]">
     <Resource name="sql">
       <![CDATA[
 SELECT
@@ -4998,7 +4960,7 @@ SELECT
    max(d) filter (where b > 1000),
    weightedAvg(b, e) AS wAvg,
    count(distinct c) AS uv
-FROM TABLE(TUMBLE(TABLE MyCDCTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
 GROUP BY a, window_start, window_end
       ]]>
     </Resource>
@@ -5010,18 +4972,18 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
          +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
             +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyCDCTable]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv], changelogMode=[I])
-+- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT_RETRACT(count1$0) AS EXPR$3, SUM_RETRACT((sum$1, count$2)) AS EXPR$4, MAX_RETRACT(max$3) AS EXPR$5, weightedAvg_RETRACT(weightedavg$4) AS wAvg, COUNT_RETRACT(distinct$0 count$5) AS uv, start('w$) AS window_start, end('w$) AS window_end], changelogMode=[I])
-   +- Exchange(distribution=[hash[a]], changelogMode=[I,UB,UA,D])
-      +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT_RETRACT(*) AS count1$0, SUM_RETRACT(d) AS (sum$1, count$2), MAX_RETRACT(d) FILTER $f4 AS max$3, weightedAvg_RETRACT(b, e) AS weightedavg$4, COUNT_RETRACT(distinct$0 c) AS count$5, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end], changelogMode=[I,UB,UA,D])
-         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime], changelogMode=[I,UB,UA,D])
-            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)], changelogMode=[I,UB,UA,D])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyCDCTable]], fields=[a, b, c, d, e, rowtime], changelogMode=[I,UB,UA,D])
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- GlobalWindowAggregate(groupBy=[a], window=[TUMBLE(slice_end=[$slice_end], size=[15 min])], select=[a, COUNT(count1$0) AS EXPR$3, SUM(sum$1) AS EXPR$4, MAX(max$2) AS EXPR$5, weightedAvg(weightedavg$3) AS wAvg, COUNT(distinct$0 count$4) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- LocalWindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS count1$0, SUM(d) AS sum$1, MAX(d) FILTER $f4 AS max$2, weightedAvg(b, e) AS weightedavg$3, COUNT(distinct$0 c) AS count$4, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+         +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+            +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -5160,6 +5122,44 @@ Calc(select=[a, b, uv])
          +- Expand(projects=[{a, b, c, 0 AS $e, rowtime}, {a, null AS b, c, 4 AS $e, rowtime}, {null AS a, null AS b, c, 12 AS $e, rowtime}])
             +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, b, c, rowtime], metadata=[]]], fields=[a, b, c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTumble_UdafWithoutMerge[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+SELECT
+   a,
+   window_start,
+   window_end,
+   count(*),
+   sum(d),
+   max(d) filter (where b > 1000),
+   weightedAvgWithoutMerge(b, e) AS wAvg,
+   count(distinct c) AS uv
+FROM TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE))
+GROUP BY a, window_start, window_end
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvgWithoutMerge($5, $6)], uv=[COUNT(DISTINCT $7)])
++- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, window_start, window_end, EXPR$3, EXPR$4, EXPR$5, wAvg, uv])
++- WindowAggregate(groupBy=[a], window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[a, COUNT(*) AS EXPR$3, SUM(d) AS EXPR$4, MAX(d) FILTER $f4 AS EXPR$5, weightedAvgWithoutMerge(b, e) AS wAvg, COUNT(DISTINCT c) AS uv, start('w$) AS window_start, end('w$) AS window_end])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, d, IS TRUE(>(b, 1000)) AS $f4, b, e, c, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, e, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/IntervalJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/IntervalJoinTest.xml
index 39d97369d02..680bc4a3bbb 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/IntervalJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/IntervalJoinTest.xml
@@ -91,19 +91,17 @@ Calc(select=[a0 AS a])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIntervalNotCnfCondition">
+  <TestCase name="testInteravlJoinSingleTimeCondition">
     <Resource name="sql">
       <![CDATA[
 SELECT t2.a FROM MyTable t1 JOIN MyTable2 t2 ON
-  t1.a = t2.a AND
-  (t1.proctime > t2.proctime - INTERVAL '5' SECOND OR
-   t1.proctime < t2.rowtime + INTERVAL '5' SECOND)
+  t1.a = t2.a AND t1.proctime > t2.proctime - INTERVAL '5' SECOND
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$5])
-+- LogicalJoin(condition=[AND(=($0, $5), OR(>($3, -($8, 5000:INTERVAL SECOND)), <($3, +($9, 5000:INTERVAL SECOND))))], joinType=[inner])
++- LogicalJoin(condition=[AND(=($0, $5), >($3, -($8, 5000:INTERVAL SECOND)))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -111,113 +109,108 @@ LogicalProject(a=[$5])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a0 AS a])
-+- Join(joinType=[InnerJoin], where=[((a = a0) AND ((proctime > (proctime0 - 5000:INTERVAL SECOND)) OR (proctime < (rowtime + 5000:INTERVAL SECOND))))], select=[a, proctime, a0, proctime0, rowtime], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
++- Join(joinType=[InnerJoin], where=[((a = a0) AND (proctime > (proctime0 - 5000:INTERVAL SECOND)))], select=[a, proctime, a0, proctime0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime, CAST(rowtime AS TIMESTAMP(3)) AS rowtime])
+      +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testInteravlJoinSingleTimeCondition">
+  <TestCase name="testIntervalJoinOnTimestampLtzRowtime">
     <Resource name="sql">
       <![CDATA[
-SELECT t2.a FROM MyTable t1 JOIN MyTable2 t2 ON
-  t1.a = t2.a AND t1.proctime > t2.proctime - INTERVAL '5' SECOND
+SELECT t2.a FROM MyTable3 t1 JOIN MyTable4 t2 ON
+  t1.a = t2.a AND
+  t1.rowtime > t2.rowtime - INTERVAL '5' SECOND AND
+  t1.rowtime < t2.rowtime + INTERVAL '5' SECOND
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$5])
-+- LogicalJoin(condition=[AND(=($0, $5), >($3, -($8, 5000:INTERVAL SECOND)))], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(a=[$4])
++- LogicalJoin(condition=[AND(=($0, $4), >($3, -($7, 5000:INTERVAL SECOND)), <($3, +($7, 5000:INTERVAL SECOND)))], joinType=[inner])
+   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
+   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[TO_TIMESTAMP_LTZ($1, 3)])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable3]])
+   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[TO_TIMESTAMP_LTZ($1, 3)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable4]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a0 AS a])
-+- Join(joinType=[InnerJoin], where=[((a = a0) AND (proctime > (proctime0 - 5000:INTERVAL SECOND)))], select=[a, proctime, a0, proctime0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-4999, leftUpperBound=4999, leftTimeIndex=1, rightTimeIndex=1], where=[((a = a0) AND (rowtime > (rowtime0 - 5000:INTERVAL SECOND)) AND (rowtime < (rowtime0 + 5000:INTERVAL SECOND)))], select=[a, rowtime, a0, rowtime0])
    :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime])
-   :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+   :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+   :     +- Calc(select=[a, TO_TIMESTAMP_LTZ(b, 3) AS rowtime])
+   :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable3, project=[a, b], metadata=[]]], fields=[a, b])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+         +- Calc(select=[a, TO_TIMESTAMP_LTZ(b, 3) AS rowtime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable4, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeInnerJoinAndWindowAggregationOnFirst">
+  <TestCase name="testIntervalNotCnfCondition">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.b, SUM(t2.a) AS aSum, COUNT(t2.b) AS bCnt
-FROM MyTable t1, MyTable2 t2
-WHERE t1.a = t2.a AND
-  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' MINUTE AND t2.rowtime + INTERVAL '1' HOUR
-GROUP BY TUMBLE(t1.rowtime, INTERVAL '6' HOUR), t1.b
+SELECT t2.a FROM MyTable t1 JOIN MyTable2 t2 ON
+  t1.a = t2.a AND
+  (t1.proctime > t2.proctime - INTERVAL '5' SECOND OR
+   t1.proctime < t2.rowtime + INTERVAL '5' SECOND)
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$1], aSum=[$2], bCnt=[$3])
-+- LogicalAggregate(group=[{0, 1}], aSum=[SUM($2)], bCnt=[COUNT($3)])
-   +- LogicalProject($f0=[$TUMBLE($4, 21600000:INTERVAL HOUR)], b=[$1], a0=[$5], b0=[$6])
-      +- LogicalFilter(condition=[AND(=($0, $5), >=($4, -($9, 600000:INTERVAL MINUTE)), <=($4, +($9, 3600000:INTERVAL HOUR)))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(a=[$5])
++- LogicalJoin(condition=[AND(=($0, $5), OR(>($3, -($8, 5000:INTERVAL SECOND)), <($3, +($9, 5000:INTERVAL SECOND))))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 21600000)], select=[b, SUM(a0) AS aSum, COUNT(b0) AS bCnt])
-+- Exchange(distribution=[hash[b]])
-   +- Calc(select=[rowtime, b, a0, b0])
-      +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-600000, leftUpperBound=3600000, leftTimeIndex=2, rightTimeIndex=2], where=[((a = a0) AND (rowtime >= (rowtime0 - 600000:INTERVAL MINUTE)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, b, rowtime, a0, b0, rowtime0])
-         :- Exchange(distribution=[hash[a]])
-         :  +- Calc(select=[a, b, rowtime])
-         :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-         +- Exchange(distribution=[hash[a]])
-            +- Calc(select=[a, b, rowtime])
-               +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
+Calc(select=[a0 AS a])
++- Join(joinType=[InnerJoin], where=[((a = a0) AND ((proctime > (proctime0 - 5000:INTERVAL SECOND)) OR (proctime < (rowtime + 5000:INTERVAL SECOND))))], select=[a, proctime, a0, proctime0, rowtime], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a]])
+   :  +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime])
+   :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, PROCTIME_MATERIALIZE(proctime) AS proctime, CAST(rowtime AS TIMESTAMP(3)) AS rowtime])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testIntervalJoinOnTimestampLtzRowtime">
+  <TestCase name="testJoinWithEquiProcTime">
     <Resource name="sql">
       <![CDATA[
-SELECT t2.a FROM MyTable3 t1 JOIN MyTable4 t2 ON
-  t1.a = t2.a AND
-  t1.rowtime > t2.rowtime - INTERVAL '5' SECOND AND
-  t1.rowtime < t2.rowtime + INTERVAL '5' SECOND
+SELECT t1.a, t2.b FROM MyTable t1, MyTable2 t2 WHERE
+  t1.a = t2.a AND t1.proctime = t2.proctime
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$4])
-+- LogicalJoin(condition=[AND(=($0, $4), >($3, -($7, 5000:INTERVAL SECOND)), <($3, +($7, 5000:INTERVAL SECOND)))], joinType=[inner])
-   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
-   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[TO_TIMESTAMP_LTZ($1, 3)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable3]])
-   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[TO_TIMESTAMP_LTZ($1, 3)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable4]])
+LogicalProject(a=[$0], b=[$6])
++- LogicalFilter(condition=[AND(=($0, $5), =($3, $8))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a0 AS a])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-4999, leftUpperBound=4999, leftTimeIndex=1, rightTimeIndex=1], where=[((a = a0) AND (rowtime > (rowtime0 - 5000:INTERVAL SECOND)) AND (rowtime < (rowtime0 + 5000:INTERVAL SECOND)))], select=[a, rowtime, a0, rowtime0])
+Calc(select=[a, b])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=0, leftUpperBound=0, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime = proctime0))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
-   :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-   :     +- Calc(select=[a, TO_TIMESTAMP_LTZ(b, 3) AS rowtime])
-   :        +- TableSourceScan(table=[[default_catalog, default_database, MyTable3, project=[a, b], metadata=[]]], fields=[a, b])
+   :  +- Calc(select=[a, proctime])
+   :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
    +- Exchange(distribution=[hash[a]])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-         +- Calc(select=[a, TO_TIMESTAMP_LTZ(b, 3) AS rowtime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable4, project=[a, b], metadata=[]]], fields=[a, b])
+      +- Calc(select=[a, b, proctime])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -311,18 +304,19 @@ Calc(select=[a, b0 AS b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcessingTimeInnerJoinWithOnClause">
+  <TestCase name="testProcTimeFullOuterJoin">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b FROM MyTable t1 JOIN MyTable2 t2 ON
-    t1.a = t2.a AND
-    t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b
+FROM MyTable t1 Full OUTER JOIN MyTable2 t2 ON
+  t1.a = t2.a AND
+  t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[inner])
++- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[full])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -330,7 +324,7 @@ LogicalProject(a=[$0], b=[$6])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[FullOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
@@ -340,17 +334,19 @@ Calc(select=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcessingTimeInnerJoinWithoutEqualCondition">
+  <TestCase name="testProcTimeLeftOuterJoin">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b FROM MyTable t1 JOIN MyTable2 t2 ON
-    t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b
+FROM MyTable t1 LEFT OUTER JOIN MyTable2 t2 ON
+  t1.a = t2.a AND
+  t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(>=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[inner])
++- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[left])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -358,37 +354,37 @@ LogicalProject(a=[$0], b=[$6])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=1], where=[((proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, b, proctime0])
-   :- Exchange(distribution=[single])
++- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
+   :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[b, proctime])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, b, proctime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcessingTimeInnerJoinWithWhereClause">
+  <TestCase name="testProcTimeRightOuterJoin">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b FROM MyTable t1, MyTable2 t2 WHERE
-    t1.a = t2.a AND
-    t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b
+FROM MyTable t1 RIGHT OUTER JOIN MyTable2 t2 ON
+  t1.a = t2.a AND
+  t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalFilter(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[RightOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
@@ -398,19 +394,18 @@ Calc(select=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcTimeFullOuterJoin">
+  <TestCase name="testProcessingTimeInnerJoinWithOnClause">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b
-FROM MyTable t1 Full OUTER JOIN MyTable2 t2 ON
-  t1.a = t2.a AND
-  t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b FROM MyTable t1 JOIN MyTable2 t2 ON
+    t1.a = t2.a AND
+    t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[full])
++- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -418,7 +413,7 @@ LogicalProject(a=[$0], b=[$6])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[FullOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
@@ -428,17 +423,18 @@ Calc(select=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithEquiProcTime">
+  <TestCase name="testProcessingTimeInnerJoinWithWhereClause">
     <Resource name="sql">
       <![CDATA[
 SELECT t1.a, t2.b FROM MyTable t1, MyTable2 t2 WHERE
-  t1.a = t2.a AND t1.proctime = t2.proctime
+    t1.a = t2.a AND
+    t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalFilter(condition=[AND(=($0, $5), =($3, $8))])
++- LogicalFilter(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))])
    +- LogicalJoin(condition=[true], joinType=[inner])
       :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
@@ -447,7 +443,7 @@ LogicalProject(a=[$0], b=[$6])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=0, leftUpperBound=0, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime = proctime0))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
    :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
@@ -457,19 +453,17 @@ Calc(select=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcTimeRightOuterJoin">
+  <TestCase name="testProcessingTimeInnerJoinWithoutEqualCondition">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b
-FROM MyTable t1 RIGHT OUTER JOIN MyTable2 t2 ON
-  t1.a = t2.a AND
-  t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b FROM MyTable t1 JOIN MyTable2 t2 ON
+    t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[right])
++- LogicalJoin(condition=[AND(>=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -477,29 +471,29 @@ LogicalProject(a=[$0], b=[$6])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[RightOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
-   :- Exchange(distribution=[hash[a]])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=1], where=[((proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, b, proctime0])
+   :- Exchange(distribution=[single])
    :  +- Calc(select=[a, proctime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, b, proctime])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[b, proctime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testProcTimeLeftOuterJoin">
+  <TestCase name="testRowTimeFullOuterJoin">
     <Resource name="sql">
       <![CDATA[
 SELECT t1.a, t2.b
-FROM MyTable t1 LEFT OUTER JOIN MyTable2 t2 ON
+FROM MyTable t1 FULL OUTER JOIN MyTable2 t2 ON
   t1.a = t2.a AND
-  t1.proctime BETWEEN t2.proctime - INTERVAL '1' HOUR AND t2.proctime + INTERVAL '1' HOUR
+  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' SECOND AND t2.rowtime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(=($0, $5), >=($3, -($8, 3600000:INTERVAL HOUR)), <=($3, +($8, 3600000:INTERVAL HOUR)))], joinType=[left])
++- LogicalJoin(condition=[AND(=($0, $5), >=($4, -($9, 10000:INTERVAL SECOND)), <=($4, +($9, 3600000:INTERVAL HOUR)))], joinType=[full])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
@@ -507,43 +501,49 @@ LogicalProject(a=[$0], b=[$6])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[LeftOuterJoin], windowBounds=[isRowTime=false, leftLowerBound=-3600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (proctime >= (proctime0 - 3600000:INTERVAL HOUR)) AND (proctime <= (proctime0 + 3600000:INTERVAL HOUR)))], select=[a, proctime, a0, b, proctime0])
++- IntervalJoin(joinType=[FullOuterJoin], windowBounds=[isRowTime=true, leftLowerBound=-10000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (rowtime >= (rowtime0 - 10000:INTERVAL SECOND)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, rowtime, a0, b, rowtime0])
    :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, proctime])
+   :  +- Calc(select=[a, rowtime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
    +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, b, proctime])
+      +- Calc(select=[a, b, rowtime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeFullOuterJoin">
+  <TestCase name="testRowTimeInnerJoinAndWindowAggregationOnFirst">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b
-FROM MyTable t1 FULL OUTER JOIN MyTable2 t2 ON
-  t1.a = t2.a AND
-  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' SECOND AND t2.rowtime + INTERVAL '1' HOUR
+SELECT t1.b, SUM(t2.a) AS aSum, COUNT(t2.b) AS bCnt
+FROM MyTable t1, MyTable2 t2
+WHERE t1.a = t2.a AND
+  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' MINUTE AND t2.rowtime + INTERVAL '1' HOUR
+GROUP BY TUMBLE(t1.rowtime, INTERVAL '6' HOUR), t1.b
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(=($0, $5), >=($4, -($9, 10000:INTERVAL SECOND)), <=($4, +($9, 3600000:INTERVAL HOUR)))], joinType=[full])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+LogicalProject(b=[$1], aSum=[$2], bCnt=[$3])
++- LogicalAggregate(group=[{0, 1}], aSum=[SUM($2)], bCnt=[COUNT($3)])
+   +- LogicalProject($f0=[$TUMBLE($4, 21600000:INTERVAL HOUR)], b=[$1], a0=[$5], b0=[$6])
+      +- LogicalFilter(condition=[AND(=($0, $5), >=($4, -($9, 600000:INTERVAL MINUTE)), <=($4, +($9, 3600000:INTERVAL HOUR)))])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b])
-+- IntervalJoin(joinType=[FullOuterJoin], windowBounds=[isRowTime=true, leftLowerBound=-10000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (rowtime >= (rowtime0 - 10000:INTERVAL SECOND)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, rowtime, a0, b, rowtime0])
-   :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, rowtime])
-   :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, b, rowtime])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
+GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, rowtime, 21600000)], select=[b, SUM(a0) AS aSum, COUNT(b0) AS bCnt])
++- Exchange(distribution=[hash[b]])
+   +- Calc(select=[rowtime, b, a0, b0])
+      +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-600000, leftUpperBound=3600000, leftTimeIndex=2, rightTimeIndex=2], where=[((a = a0) AND (rowtime >= (rowtime0 - 600000:INTERVAL MINUTE)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, b, rowtime, a0, b0, rowtime0])
+         :- Exchange(distribution=[hash[a]])
+         :  +- Calc(select=[a, b, rowtime])
+         :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+         +- Exchange(distribution=[hash[a]])
+            +- Calc(select=[a, b, rowtime])
+               +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -612,60 +612,60 @@ Calc(select=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeInnerJoinWithoutEqualCondition">
+  <TestCase name="testRowTimeInnerJoinWithWhereClause">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b FROM MyTable t1 JOIN MyTable2 t2 ON
-  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' SECOND AND t2.rowtime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b FROM MyTable t1, MyTable2 t2 WHERE
+  t1.a = t2.a AND
+  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' MINUTE AND t2.rowtime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalJoin(condition=[AND(>=($4, -($9, 10000:INTERVAL SECOND)), <=($4, +($9, 3600000:INTERVAL HOUR)))], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalFilter(condition=[AND(=($0, $5), >=($4, -($9, 600000:INTERVAL MINUTE)), <=($4, +($9, 3600000:INTERVAL HOUR)))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-10000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=1], where=[((rowtime >= (rowtime0 - 10000:INTERVAL SECOND)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, rowtime, b, rowtime0])
-   :- Exchange(distribution=[single])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (rowtime >= (rowtime0 - 600000:INTERVAL MINUTE)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, rowtime, a0, b, rowtime0])
+   :- Exchange(distribution=[hash[a]])
    :  +- Calc(select=[a, rowtime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[b, rowtime])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, b, rowtime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeInnerJoinWithWhereClause">
+  <TestCase name="testRowTimeInnerJoinWithoutEqualCondition">
     <Resource name="sql">
       <![CDATA[
-SELECT t1.a, t2.b FROM MyTable t1, MyTable2 t2 WHERE
-  t1.a = t2.a AND
-  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' MINUTE AND t2.rowtime + INTERVAL '1' HOUR
+SELECT t1.a, t2.b FROM MyTable t1 JOIN MyTable2 t2 ON
+  t1.rowtime BETWEEN t2.rowtime - INTERVAL '10' SECOND AND t2.rowtime + INTERVAL '1' HOUR
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$6])
-+- LogicalFilter(condition=[AND(=($0, $5), >=($4, -($9, 600000:INTERVAL MINUTE)), <=($4, +($9, 3600000:INTERVAL HOUR)))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
++- LogicalJoin(condition=[AND(>=($4, -($9, 10000:INTERVAL SECOND)), <=($4, +($9, 3600000:INTERVAL HOUR)))], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-600000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=2], where=[((a = a0) AND (rowtime >= (rowtime0 - 600000:INTERVAL MINUTE)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, rowtime, a0, b, rowtime0])
-   :- Exchange(distribution=[hash[a]])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-10000, leftUpperBound=3600000, leftTimeIndex=1, rightTimeIndex=1], where=[((rowtime >= (rowtime0 - 10000:INTERVAL SECOND)) AND (rowtime <= (rowtime0 + 3600000:INTERVAL HOUR)))], select=[a, rowtime, b, rowtime0])
+   :- Exchange(distribution=[single])
    :  +- Calc(select=[a, rowtime])
    :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, b, rowtime])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[b, rowtime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
@@ -727,51 +727,6 @@ Calc(select=[a, b])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, b, rowtime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSemiIntervalJoinWithSimpleConditionAndGroup">
-    <Resource name="sql">
-      <![CDATA[
-SELECT t1.a FROM MyTable t1 WHERE t1.a IN (
- SELECT t2.a FROM MyTable2 t2
-   WHERE t1.b = t2.b AND t1.rowtime between t2.rowtime and t2.rowtime + INTERVAL '5' MINUTE
-   GROUP BY t2.a
-)
-    ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0])
-+- LogicalFilter(condition=[IN($0, {
-LogicalAggregate(group=[{0}])
-  LogicalProject(a=[$0])
-    LogicalFilter(condition=[AND(=($cor0.b, $1), >=($cor0.rowtime, $4), <=($cor0.rowtime, +($4, 300000:INTERVAL MINUTE)))])
-      LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-})], variablesSet=[[$cor0]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a])
-+- Join(joinType=[InnerJoin], where=[((b = b0) AND (rowtime = rowtime0) AND (a = a0))], select=[a, b, rowtime, a0, b0, rowtime0], leftInputSpec=[NoUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey])
-   :- Exchange(distribution=[hash[b, rowtime, a]])
-   :  +- Calc(select=[a, b, CAST(rowtime) AS rowtime])
-   :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])(reuse_id=[1])
-   +- Exchange(distribution=[hash[b0, rowtime0, a]])
-      +- GroupAggregate(groupBy=[a, b0, rowtime0], select=[a, b0, rowtime0])
-         +- Exchange(distribution=[hash[a, b0, rowtime0]])
-            +- Calc(select=[a, b0, rowtime0])
-               +- Join(joinType=[InnerJoin], where=[((b0 = b) AND (rowtime0 >= rowtime) AND (rowtime0 <= (rowtime + 300000:INTERVAL MINUTE)))], select=[a, b, rowtime, b0, rowtime0], leftInputSpec=[NoUniqueKey], rightInputSpec=[HasUniqueKey])
-                  :- Exchange(distribution=[hash[b]])
-                  :  +- Calc(select=[a, b, CAST(rowtime) AS rowtime])
-                  :     +- DataStreamScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, proctime, rowtime])
-                  +- Exchange(distribution=[hash[b]])
-                     +- GroupAggregate(groupBy=[b, rowtime], select=[b, rowtime])
-                        +- Exchange(distribution=[hash[b, rowtime]])
-                           +- Calc(select=[b, CAST(rowtime) AS rowtime])
-                              +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinReorderTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinReorderTest.xml
index ed5cd849857..aebfc13fefb 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinReorderTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinReorderTest.xml
@@ -2249,7 +2249,7 @@ Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithoutColumnStats[isBushyJoinReorder=true]">
+  <TestCase name="testWithoutColumnStats[isBushyJoinReorder=false]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1, T2, T3, T4, T5
@@ -2274,27 +2274,27 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- Join(joinType=[InnerJoin], where=[=(c1, c5)], select=[a1, b1, c1, a3, b3, c3, a2, b2, c2, a4, b4, c4, a5, b5, c5], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[c1]])
-   :  +- Join(joinType=[InnerJoin], where=[=(c1, c2)], select=[a1, b1, c1, a3, b3, c3, a2, b2, c2, a4, b4, c4], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :     :- Exchange(distribution=[hash[c1]])
-   :     :  +- Join(joinType=[InnerJoin], where=[=(c1, c3)], select=[a1, b1, c1, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :     :     :- Exchange(distribution=[hash[c1]])
-   :     :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-   :     :     +- Exchange(distribution=[hash[c3]])
-   :     :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
-   :     +- Exchange(distribution=[hash[c2]])
-   :        +- Join(joinType=[InnerJoin], where=[=(c2, c4)], select=[a2, b2, c2, a4, b4, c4], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :           :- Exchange(distribution=[hash[c2]])
-   :           :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-   :           +- Exchange(distribution=[hash[c4]])
-   :              +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-   +- Exchange(distribution=[hash[c5]])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
++- Join(joinType=[InnerJoin], where=[AND(=(c1, c5), =(c1, c3), =(c1, c2), =(c4, c1))], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[c1, c1, c1, c1]])
+   :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   +- Exchange(distribution=[hash[c5, c3, c2, c4]])
+      +- Join(joinType=[InnerJoin], where=[AND(=(c2, c4), =(c5, c2), =(c3, c2))], select=[a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+         :- Exchange(distribution=[hash[c2, c2, c2]])
+         :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+         +- Exchange(distribution=[hash[c4, c5, c3]])
+            +- Join(joinType=[InnerJoin], where=[AND(=(c5, c3), =(c3, c4))], select=[a5, b5, c5, a4, b4, c4, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+               :- Exchange(distribution=[hash[c5, c4]])
+               :  +- Join(joinType=[InnerJoin], where=[=(c5, c4)], select=[a5, b5, c5, a4, b4, c4], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+               :     :- Exchange(distribution=[hash[c5]])
+               :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
+               :     +- Exchange(distribution=[hash[c4]])
+               :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+               +- Exchange(distribution=[hash[c3, c3]])
+                  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testWithoutColumnStats[isBushyJoinReorder=false]">
+  <TestCase name="testWithoutColumnStats[isBushyJoinReorder=true]">
     <Resource name="sql">
       <![CDATA[
 SELECT * FROM T1, T2, T3, T4, T5
@@ -2319,23 +2319,23 @@ LogicalProject(a1=[$0], b1=[$1], c1=[$2], a2=[$3], b2=[$4], c2=[$5], a3=[$6], b3
     <Resource name="optimized rel plan">
       <![CDATA[
 Calc(select=[a1, b1, c1, a2, b2, c2, a3, b3, c3, a4, b4, c4, a5, b5, c5])
-+- Join(joinType=[InnerJoin], where=[AND(=(c1, c5), =(c1, c3), =(c1, c2), =(c4, c1))], select=[a1, b1, c1, a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[c1, c1, c1, c1]])
-   :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
-   +- Exchange(distribution=[hash[c5, c3, c2, c4]])
-      +- Join(joinType=[InnerJoin], where=[AND(=(c2, c4), =(c5, c2), =(c3, c2))], select=[a2, b2, c2, a5, b5, c5, a4, b4, c4, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-         :- Exchange(distribution=[hash[c2, c2, c2]])
-         :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
-         +- Exchange(distribution=[hash[c4, c5, c3]])
-            +- Join(joinType=[InnerJoin], where=[AND(=(c5, c3), =(c3, c4))], select=[a5, b5, c5, a4, b4, c4, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-               :- Exchange(distribution=[hash[c5, c4]])
-               :  +- Join(joinType=[InnerJoin], where=[=(c5, c4)], select=[a5, b5, c5, a4, b4, c4], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-               :     :- Exchange(distribution=[hash[c5]])
-               :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
-               :     +- Exchange(distribution=[hash[c4]])
-               :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
-               +- Exchange(distribution=[hash[c3, c3]])
-                  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
++- Join(joinType=[InnerJoin], where=[=(c1, c5)], select=[a1, b1, c1, a3, b3, c3, a2, b2, c2, a4, b4, c4, a5, b5, c5], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[c1]])
+   :  +- Join(joinType=[InnerJoin], where=[=(c1, c2)], select=[a1, b1, c1, a3, b3, c3, a2, b2, c2, a4, b4, c4], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :     :- Exchange(distribution=[hash[c1]])
+   :     :  +- Join(joinType=[InnerJoin], where=[=(c1, c3)], select=[a1, b1, c1, a3, b3, c3], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :     :     :- Exchange(distribution=[hash[c1]])
+   :     :     :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1)]]], fields=[a1, b1, c1])
+   :     :     +- Exchange(distribution=[hash[c3]])
+   :     :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3)]]], fields=[a3, b3, c3])
+   :     +- Exchange(distribution=[hash[c2]])
+   :        +- Join(joinType=[InnerJoin], where=[=(c2, c4)], select=[a2, b2, c2, a4, b4, c4], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :           :- Exchange(distribution=[hash[c2]])
+   :           :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]], fields=[a2, b2, c2])
+   :           +- Exchange(distribution=[hash[c4]])
+   :              +- LegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4)]]], fields=[a4, b4, c4])
+   +- Exchange(distribution=[hash[c5]])
+      +- LegacyTableSourceScan(table=[[default_catalog, default_database, T5, source: [TestTableSource(a5, b5, c5)]]], fields=[a5, b5, c5])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinTest.xml
index ce391145efd..a74cd1a8389 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/JoinTest.xml
@@ -481,40 +481,6 @@ Calc(select=[a1, 1 AS a2, CAST(2 AS INTEGER) AS b1, 1 AS b2])
             +- Exchange(distribution=[hash[b1]])
                +- Calc(select=[CAST(2 AS INTEGER) AS b1, b2], where=[(b1 = 2)])
                   +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testLeftJoinWithEqualPk">
-    <Resource name="sql">
-      <![CDATA[SELECT a1, b1 FROM (SELECT SUM(a2) AS a2, a1 FROM A GROUP BY a1) LEFT JOIN (SELECT SUM(b2) AS b2, b1 FROM B GROUP BY b1) ON a1 = b1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$1], b1=[$3])
-+- LogicalJoin(condition=[=($1, $3)], joinType=[left])
-   :- LogicalProject(a2=[$1], a1=[$0])
-   :  +- LogicalAggregate(group=[{0}], a2=[SUM($1)])
-   :     +- LogicalProject(a1=[$0], a2=[$1])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, A]])
-   +- LogicalProject(b2=[$1], b1=[$0])
-      +- LogicalAggregate(group=[{0}], b2=[SUM($1)])
-         +- LogicalProject(b1=[$0], b2=[$1])
-            +- LogicalTableScan(table=[[default_catalog, default_database, B]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Join(joinType=[LeftOuterJoin], where=[=(a1, b1)], select=[a1, b1], leftInputSpec=[JoinKeyContainsUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey], changelogMode=[I,UA,D])
-:- Exchange(distribution=[hash[a1]], changelogMode=[I,UA])
-:  +- GroupAggregate(groupBy=[a1], select=[a1], changelogMode=[I,UA])
-:     +- Exchange(distribution=[hash[a1]], changelogMode=[I])
-:        +- Calc(select=[a1, a2], changelogMode=[I])
-:           +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
-+- Exchange(distribution=[hash[b1]], changelogMode=[I,UA])
-   +- GroupAggregate(groupBy=[b1], select=[b1], changelogMode=[I,UA])
-      +- Exchange(distribution=[hash[b1]], changelogMode=[I])
-         +- Calc(select=[b1, b2], changelogMode=[I])
-            +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -552,30 +518,6 @@ Calc(select=[a1, a2, b1, b2], changelogMode=[I,UB,UA])
             +- Exchange(distribution=[hash[b1]], changelogMode=[I])
                +- Calc(select=[b1, b2], changelogMode=[I])
                   +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinAndSelectOnPartialCompositePrimaryKey">
-    <Resource name="sql">
-      <![CDATA[SELECT A.a1 FROM A LEFT JOIN tableWithCompositePk T ON A.a1 = T.pk1]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0])
-+- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-   :- LogicalTableScan(table=[[default_catalog, default_database, A]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, tableWithCompositePk]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a1])
-+- Join(joinType=[LeftOuterJoin], where=[(a1 = pk1)], select=[a1, pk1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a1]])
-   :  +- Calc(select=[a1])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3])
-   +- Exchange(distribution=[hash[pk1]])
-      +- TableSourceScan(table=[[default_catalog, default_database, tableWithCompositePk, project=[pk1], metadata=[]]], fields=[pk1])
 ]]>
     </Resource>
   </TestCase>
@@ -609,6 +551,30 @@ Sink(table=[default_catalog.default_database.sink], fields=[a, b, d])
       +- Exchange(distribution=[hash[c]])
          +- MiniBatchAssigner(interval=[10000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, right_table]], fields=[c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinAndSelectOnPartialCompositePrimaryKey">
+    <Resource name="sql">
+      <![CDATA[SELECT A.a1 FROM A LEFT JOIN tableWithCompositePk T ON A.a1 = T.pk1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0])
++- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, A]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, tableWithCompositePk]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a1])
++- Join(joinType=[LeftOuterJoin], where=[(a1 = pk1)], select=[a1, pk1], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a1]])
+   :  +- Calc(select=[a1])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3])
+   +- Exchange(distribution=[hash[pk1]])
+      +- TableSourceScan(table=[[default_catalog, default_database, tableWithCompositePk, project=[pk1], metadata=[]]], fields=[pk1])
 ]]>
     </Resource>
   </TestCase>
@@ -885,6 +851,40 @@ Calc(select=[a1, b1], changelogMode=[I,UA,D])
    +- Exchange(distribution=[hash[b1]], changelogMode=[I])
       +- Calc(select=[b1, b2], changelogMode=[I])
          +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinWithEqualPk">
+    <Resource name="sql">
+      <![CDATA[SELECT a1, b1 FROM (SELECT SUM(a2) AS a2, a1 FROM A GROUP BY a1) LEFT JOIN (SELECT SUM(b2) AS b2, b1 FROM B GROUP BY b1) ON a1 = b1]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$1], b1=[$3])
++- LogicalJoin(condition=[=($1, $3)], joinType=[left])
+   :- LogicalProject(a2=[$1], a1=[$0])
+   :  +- LogicalAggregate(group=[{0}], a2=[SUM($1)])
+   :     +- LogicalProject(a1=[$0], a2=[$1])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, A]])
+   +- LogicalProject(b2=[$1], b1=[$0])
+      +- LogicalAggregate(group=[{0}], b2=[SUM($1)])
+         +- LogicalProject(b1=[$0], b2=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, B]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Join(joinType=[LeftOuterJoin], where=[=(a1, b1)], select=[a1, b1], leftInputSpec=[JoinKeyContainsUniqueKey], rightInputSpec=[JoinKeyContainsUniqueKey], changelogMode=[I,UA,D])
+:- Exchange(distribution=[hash[a1]], changelogMode=[I,UA])
+:  +- GroupAggregate(groupBy=[a1], select=[a1], changelogMode=[I,UA])
+:     +- Exchange(distribution=[hash[a1]], changelogMode=[I])
+:        +- Calc(select=[a1, a2], changelogMode=[I])
+:           +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
++- Exchange(distribution=[hash[b1]], changelogMode=[I,UA])
+   +- GroupAggregate(groupBy=[b1], select=[b1], changelogMode=[I,UA])
+      +- Exchange(distribution=[hash[b1]], changelogMode=[I])
+         +- Calc(select=[b1, b2], changelogMode=[I])
+            +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -1184,31 +1184,6 @@ Calc(select=[b, y])
    :     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
    +- Exchange(distribution=[hash[z]])
       +- TableSourceScan(table=[[default_catalog, default_database, s]], fields=[x, y, z])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRightJoinNonEqui">
-    <Resource name="sql">
-      <![CDATA[SELECT a1, b1 FROM A RIGHT JOIN B ON a1 = b1 AND a2 > b2]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a1=[$0], b1=[$3])
-+- LogicalJoin(condition=[AND(=($0, $3), >($1, $4))], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, A]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, B]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a1, b1], changelogMode=[I,UA,D])
-+- Join(joinType=[RightOuterJoin], where=[AND(=(a1, b1), >(a2, b2))], select=[a1, a2, b1, b2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I,UA,D])
-   :- Exchange(distribution=[hash[a1]], changelogMode=[I])
-   :  +- Calc(select=[a1, a2], changelogMode=[I])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
-   +- Exchange(distribution=[hash[b1]], changelogMode=[I])
-      +- Calc(select=[b1, b2], changelogMode=[I])
-         +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -1258,6 +1233,31 @@ Join(joinType=[RightOuterJoin], where=[=(a1, b1)], select=[a1, b1], leftInputSpe
 +- Exchange(distribution=[hash[b1]], changelogMode=[I])
    +- Calc(select=[b1], changelogMode=[I])
       +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightJoinNonEqui">
+    <Resource name="sql">
+      <![CDATA[SELECT a1, b1 FROM A RIGHT JOIN B ON a1 = b1 AND a2 > b2]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a1=[$0], b1=[$3])
++- LogicalJoin(condition=[AND(=($0, $3), >($1, $4))], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, A]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, B]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a1, b1], changelogMode=[I,UA,D])
++- Join(joinType=[RightOuterJoin], where=[AND(=(a1, b1), >(a2, b2))], select=[a1, a2, b1, b2], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I,UA,D])
+   :- Exchange(distribution=[hash[a1]], changelogMode=[I])
+   :  +- Calc(select=[a1, a2], changelogMode=[I])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, A]], fields=[a1, a2, a3], changelogMode=[I])
+   +- Exchange(distribution=[hash[b1]], changelogMode=[I])
+      +- Calc(select=[b1, b2], changelogMode=[I])
+         +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -1369,31 +1369,6 @@ Calc(select=[a1, CAST(a2 AS BIGINT) AS a2, CAST(2 AS INTEGER) AS b1, b2])
          +- Exchange(distribution=[hash[b1]])
             +- Calc(select=[CAST(2 AS INTEGER) AS b1, b2], where=[(b1 = 2)])
                +- TableSourceScan(table=[[default_catalog, default_database, B]], fields=[b1, b2, b3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRightOuterJoinEquiPred">
-    <Resource name="sql">
-      <![CDATA[SELECT b, y FROM t RIGHT OUTER JOIN s ON a = z]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$1], y=[$4])
-+- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-   :- LogicalTableScan(table=[[default_catalog, default_database, t]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, s]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[b, y])
-+- Join(joinType=[RightOuterJoin], where=[(a = z)], select=[a, b, y, z], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-   :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, b])
-   :     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
-   +- Exchange(distribution=[hash[z]])
-      +- Calc(select=[y, z])
-         +- TableSourceScan(table=[[default_catalog, default_database, s]], fields=[x, y, z])
 ]]>
     </Resource>
   </TestCase>
@@ -1616,6 +1591,31 @@ Calc(select=[b, y])
    :     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
    +- Exchange(distribution=[hash[z]])
       +- TableSourceScan(table=[[default_catalog, default_database, s]], fields=[x, y, z])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRightOuterJoinEquiPred">
+    <Resource name="sql">
+      <![CDATA[SELECT b, y FROM t RIGHT OUTER JOIN s ON a = z]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$1], y=[$4])
++- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+   :- LogicalTableScan(table=[[default_catalog, default_database, t]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, s]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[b, y])
++- Join(joinType=[RightOuterJoin], where=[(a = z)], select=[a, b, y, z], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+   :- Exchange(distribution=[hash[a]])
+   :  +- Calc(select=[a, b])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, t]], fields=[a, b, c])
+   +- Exchange(distribution=[hash[z]])
+      +- Calc(select=[y, z])
+         +- TableSourceScan(table=[[default_catalog, default_database, s]], fields=[x, y, z])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml
index 3fd724e5530..ba5669b8459 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml
@@ -273,6 +273,57 @@ GroupAggregate(groupBy=[b], select=[b, COUNT_RETRACT(a) AS EXPR$1, SUM_RETRACT(c
             +- GroupAggregate(groupBy=[a, b], select=[a, b, SUM(c) AS c, SUM(d) AS d])
                +- Exchange(distribution=[hash[a, b]])
                   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, d])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinAsyncTableKeyOrderedWithAppendOnlySource">
+    <Resource name="sql">
+      <![CDATA[SELECT /*+ LOOKUP('table'='D', 'async'='true', 'output-mode'='allow_unordered') */ * FROM (SELECT *, PROCTIME() AS proctime FROM AppendOnlyTable) AS T JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.id = D.id]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(id=[$0], name=[$1], age=[$2], proctime=[$3], id0=[$4], name0=[$5], age0=[$6])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=D}]]])
+   :- LogicalProject(id=[$0], name=[$1], age=[$2], proctime=[PROCTIME()])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, AppendOnlyTable]], hints=[[[ALIAS inheritPath:[] options:[AppendOnlyTable]]]])
+   +- LogicalFilter(condition=[=($cor0.id, $0)])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[id, name, age, PROCTIME_MATERIALIZE(proctime) AS proctime, id0, name0, age0])
++- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=id], select=[id, name, age, proctime, id0, name0, age0], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
+   +- Calc(select=[id, name, age, PROCTIME() AS proctime])
+      +- TableSourceScan(table=[[default_catalog, default_database, AppendOnlyTable]], fields=[id, name, age])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testJoinAsyncTableKeyOrderedWithCdcSource">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalProject(id=[$0], name=[$1], age=[$2], proctime=[$3], id0=[$4], name0=[$5], age0=[$6])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=D}]]])
+   :- LogicalProject(id=[$0], name=[$1], age=[$2], proctime=[PROCTIME()])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, UpsertTable]], hints=[[[ALIAS inheritPath:[] options:[UpsertTable]]]])
+   +- LogicalFilter(condition=[=($cor0.id, $0)])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
+
+== Optimized Physical Plan ==
+Calc(select=[id, name, age, PROCTIME_MATERIALIZE(proctime) AS proctime, id0, name0, age0])
++- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=id], select=[id, name, age, proctime, id0, name0, age0], async=[ORDERED, KEY_ORDERED: true, 180000ms, 100])
+   +- Calc(select=[id, name, age, PROCTIME() AS proctime])
+      +- DropUpdateBefore
+         +- TableSourceScan(table=[[default_catalog, default_database, UpsertTable]], fields=[id, name, age])
+
+== Optimized Execution Plan ==
+Calc(select=[id, name, age, PROCTIME_MATERIALIZE(proctime) AS proctime, id0, name0, age0])
++- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=id], select=[id, name, age, proctime, id0, name0, age0], async=[ORDERED, KEY_ORDERED: true, 180000ms, 100])
+   +- Calc(select=[id, name, age, PROCTIME() AS proctime])
+      +- DropUpdateBefore
+         +- TableSourceScan(table=[[default_catalog, default_database, UpsertTable]], fields=[id, name, age])
 ]]>
     </Resource>
   </TestCase>
@@ -448,96 +499,35 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, n
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithAsyncAndRetryHint">
-    <Resource name="explain">
-      <![CDATA[== Abstract Syntax Tree ==
-LogicalSink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
-+- LogicalProject(a=[$0], name=[$6], age=[$7])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{retry-strategy=fixed_delay, time-out=600s, max-attempts=3, output-mode=allow_unordered, fixed-delay=10s, retry-predicate=lookup_miss, table=D, capacity=300}]]])
-      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[ALIAS inheritPath:[] options:[T]]]])
-      +- LogicalFilter(condition=[=($cor0.a, $0)])
-         +- LogicalSnapshot(period=[$cor0.proctime])
-            +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
-
-== Optimized Physical Plan ==
-Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
-+- Calc(select=[a, name, age])
-   +- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 300], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])
-      +- Calc(select=[a])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-
-== Optimized Execution Plan ==
-Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
-+- Calc(select=[a, name, age])
-   +- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 300], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])
-      +- Calc(select=[a])
-         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-
-== Physical Execution Plan ==
-{
-  "nodes" : [ {
-    "id" : ,
-    "type" : "Source: Collection Source",
-    "pact" : "Data Source",
-    "contents" : "Source: Collection Source",
-    "parallelism" : 1
-  }, {
-    "id" : ,
-    "type" : "SourceConversion[]",
-    "pact" : "Operator",
-    "contents" : "[]:SourceConversion(table=[default_catalog.default_database.MyTable], fields=[a, b, c, proctime, rowtime])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "LookupJoin[]",
-    "pact" : "Operator",
-    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 300], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Calc[]",
-    "pact" : "Operator",
-    "contents" : "[]:Calc(select=[a, name, age])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  }, {
-    "id" : ,
-    "type" : "Sink: Sink1[]",
-    "pact" : "Data Sink",
-    "contents" : "[]:Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])",
-    "parallelism" : 1,
-    "predecessors" : [ {
-      "id" : ,
-      "ship_strategy" : "FORWARD",
-      "side" : "second"
-    } ]
-  } ]
-}]]>
+  <TestCase name="testJoinTemporalTableWithCTE">
+    <Resource name="sql">
+      <![CDATA[
+WITH MyLookupTable AS (SELECT * FROM MyTable),
+OtherLookupTable AS (SELECT * FROM LookupTable)
+SELECT MyLookupTable.b FROM MyLookupTable
+JOIN OtherLookupTable FOR SYSTEM_TIME AS OF MyLookupTable.proctime AS D
+ON MyLookupTable.a = D.id AND D.age = 10
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$1])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}])
+   :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalFilter(condition=[AND(=($cor0.a, $0), =($2, 10))])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalProject(id=[$0], name=[$1], age=[$2])
+            +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[b])
++- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[InnerJoin], lookup=[age=10, id=a], where=[(age = 10)], select=[a, b, id])
+   +- Calc(select=[a, b])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+]]>
     </Resource>
   </TestCase>
   <TestCase name="testJoinTemporalTableWithCalcPushDown">
@@ -568,43 +558,6 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, n
 ]]>
     </Resource>
   </TestCase>
-	<TestCase name="testJoinAsyncTableKeyOrderedWithCdcSource">
-		<Resource name="explain">
-			<![CDATA[== Abstract Syntax Tree ==
-LogicalProject(id=[$0], name=[$1], age=[$2], proctime=[$3], id0=[$4], name0=[$5], age0=[$6])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{async=true, output-mode=allow_unordered, table=D}]]])
-   :- LogicalProject(id=[$0], name=[$1], age=[$2], proctime=[PROCTIME()])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, UpsertTable]], hints=[[[ALIAS inheritPath:[] options:[UpsertTable]]]])
-   +- LogicalFilter(condition=[=($cor0.id, $0)])
-      +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
-
-== Optimized Physical Plan ==
-Calc(select=[id, name, age, PROCTIME_MATERIALIZE(proctime) AS proctime, id0, name0, age0])
-+- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=id], select=[id, name, age, proctime, id0, name0, age0], async=[ORDERED, KEY_ORDERED: true, 180000ms, 100])
-   +- Calc(select=[id, name, age, PROCTIME() AS proctime])
-      +- DropUpdateBefore
-         +- TableSourceScan(table=[[default_catalog, default_database, UpsertTable]], fields=[id, name, age])
-
-== Optimized Execution Plan ==
-Calc(select=[id, name, age, PROCTIME_MATERIALIZE(proctime) AS proctime, id0, name0, age0])
-+- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=id], select=[id, name, age, proctime, id0, name0, age0], async=[ORDERED, KEY_ORDERED: true, 180000ms, 100])
-   +- Calc(select=[id, name, age, PROCTIME() AS proctime])
-      +- DropUpdateBefore
-         +- TableSourceScan(table=[[default_catalog, default_database, UpsertTable]], fields=[id, name, age])
-]]>
-		</Resource>
-	</TestCase>
-	<TestCase name="testJoinAsyncTableKeyOrderedWithAppendOnlySource">
-		<Resource name="optimized exec plan">
-			<![CDATA[
-Calc(select=[id, name, age, PROCTIME_MATERIALIZE(proctime) AS proctime, id0, name0, age0])
-+- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=id], select=[id, name, age, proctime, id0, name0, age0], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
-   +- Calc(select=[id, name, age, PROCTIME() AS proctime])
-      +- TableSourceScan(table=[[default_catalog, default_database, AppendOnlyTable]], fields=[id, name, age])
-]]>
-		</Resource>
-	</TestCase>
   <TestCase name="testJoinTemporalTableWithComputedColumn">
     <Resource name="sql">
       <![CDATA[
@@ -662,37 +615,6 @@ Calc(select=[a, b, c, name, age, nominal_age])
 +- LookupJoin(table=[default_catalog.default_database.LookupTableWithComputedColumn], joinType=[InnerJoin], lookup=[id=a], where=[((age + 1) > 12)], select=[a, b, c, id, name, age, (age + 1) AS nominal_age])
    +- Calc(select=[a, b, c])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testJoinTemporalTableWithCTE">
-    <Resource name="sql">
-      <![CDATA[
-WITH MyLookupTable AS (SELECT * FROM MyTable),
-OtherLookupTable AS (SELECT * FROM LookupTable)
-SELECT MyLookupTable.b FROM MyLookupTable
-JOIN OtherLookupTable FOR SYSTEM_TIME AS OF MyLookupTable.proctime AS D
-ON MyLookupTable.a = D.id AND D.age = 10
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$1])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalFilter(condition=[AND(=($cor0.a, $0), =($2, 10))])
-      +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalProject(id=[$0], name=[$1], age=[$2])
-            +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[b])
-+- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[InnerJoin], lookup=[age=10, id=a], where=[(age = 10)], select=[a, b, id])
-   +- Calc(select=[a, b])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -1280,6 +1202,98 @@ Calc(select=[a, b, c, name])
 ]]>
     </Resource>
   </TestCase>
+  <TestCase name="testJoinWithAsyncAndRetryHint">
+    <Resource name="explain">
+      <![CDATA[== Abstract Syntax Tree ==
+LogicalSink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
++- LogicalProject(a=[$0], name=[$6], age=[$7])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{retry-strategy=fixed_delay, time-out=600s, max-attempts=3, output-mode=allow_unordered, fixed-delay=10s, retry-predicate=lookup_miss, table=D, capacity=300}]]])
+      :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[ALIAS inheritPath:[] options:[T]]]])
+      +- LogicalFilter(condition=[=($cor0.a, $0)])
+         +- LogicalSnapshot(period=[$cor0.proctime])
+            +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
+
+== Optimized Physical Plan ==
+Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
++- Calc(select=[a, name, age])
+   +- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 300], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])
+      +- Calc(select=[a])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+
+== Optimized Execution Plan ==
+Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
++- Calc(select=[a, name, age])
+   +- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 300], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])
+      +- Calc(select=[a])
+         +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+
+== Physical Execution Plan ==
+{
+  "nodes" : [ {
+    "id" : ,
+    "type" : "Source: Collection Source",
+    "pact" : "Data Source",
+    "contents" : "Source: Collection Source",
+    "parallelism" : 1
+  }, {
+    "id" : ,
+    "type" : "SourceConversion[]",
+    "pact" : "Operator",
+    "contents" : "[]:SourceConversion(table=[default_catalog.default_database.MyTable], fields=[a, b, c, proctime, rowtime])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[a])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "LookupJoin[]",
+    "pact" : "Operator",
+    "contents" : "[]:LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 300], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Calc[]",
+    "pact" : "Operator",
+    "contents" : "[]:Calc(select=[a, name, age])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  }, {
+    "id" : ,
+    "type" : "Sink: Sink1[]",
+    "pact" : "Data Sink",
+    "contents" : "[]:Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])",
+    "parallelism" : 1,
+    "predecessors" : [ {
+      "id" : ,
+      "ship_strategy" : "FORWARD",
+      "side" : "second"
+    } ]
+  } ]
+}]]>
+    </Resource>
+  </TestCase>
   <TestCase name="testJoinWithAsyncHint">
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
@@ -1496,53 +1510,60 @@ Sink(table=[default_catalog.default_database.Sink1], fields=[a, name, age])
 }]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultipleJoinHintsWithSameTableName">
+  <TestCase name="testLeftJoinTemporalTable">
     <Resource name="sql">
-      <![CDATA[
-SELECT /*+ LOOKUP('table'='AsyncLookupTable', 'output-mode'='allow_unordered'),
-           LOOKUP('table'='AsyncLookupTable', 'output-mode'='ordered') */ *
-FROM MyTable AS T
-JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime
- ON T.a = AsyncLookupTable.id
-      ]]>
+      <![CDATA[SELECT * FROM MyTable AS T LEFT JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.a = D.id]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{output-mode=allow_unordered, table=AsyncLookupTable}][LOOKUP inheritPath:[0] options:{output-mode=ordered, table=AsyncLookupTable}]]])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[ALIAS inheritPath:[] options:[T]]]])
++- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 3}])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalFilter(condition=[=($cor0.a, $0)])
       +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]], hints=[[[ALIAS inheritPath:[] options:[AsyncLookupTable]]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
++- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[LeftOuterJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age])
    +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftJoinTemporalTable">
+  <TestCase name="testMultipleJoinHintsWithDifferentTableAlias">
     <Resource name="sql">
-      <![CDATA[SELECT * FROM MyTable AS T LEFT JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D ON T.a = D.id]]>
+      <![CDATA[
+SELECT /*+ LOOKUP('table'='D', 'output-mode'='allow_unordered'),
+           LOOKUP('table'='D1', 'retry-predicate'='lookup_miss', 'retry-strategy'='fixed_delay', 'fixed-delay'='10s', 'max-attempts'='3') */ *
+FROM MyTable AS T
+JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D
+  ON T.a = D.id
+JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D1
+  ON T.a = D1.id
+      ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 3}])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalFilter(condition=[=($cor0.a, $0)])
-      +- LogicalSnapshot(period=[$cor0.proctime])
+LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7], id0=[$8], name0=[$9], age0=[$10])
++- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{output-mode=allow_unordered, table=D}][LOOKUP inheritPath:[0] options:{retry-strategy=fixed_delay, max-attempts=3, fixed-delay=10s, retry-predicate=lookup_miss, table=D1}]]])
+   :- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0, 0] options:{output-mode=allow_unordered, table=D}][LOOKUP inheritPath:[0, 0] options:{retry-strategy=fixed_delay, max-attempts=3, fixed-delay=10s, retry-predicate=lookup_miss, table=D1}]]])
+   :  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[ALIAS inheritPath:[] options:[T]]]])
+   :  +- LogicalFilter(condition=[=($cor0.a, $0)])
+   :     +- LogicalSnapshot(period=[$cor0.proctime])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
+   +- LogicalFilter(condition=[=($cor1.a, $0)])
+      +- LogicalSnapshot(period=[$cor1.proctime])
          +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, name, age])
-+- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[LeftOuterJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age])
-   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, name, age, id0, name0, age0])
++- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age, id0, name0, age0], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])
+   +- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
+      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -1587,7 +1608,7 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, n
 SELECT /*+ LOOKUP('table'='D', 'output-mode'='allow_unordered'),
            LOOKUP('table'='D', 'output-mode'='ordered') */ *
 FROM MyTable AS T
-JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D 
+JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D
  ON T.a = D.id
       ]]>
     </Resource>
@@ -1609,38 +1630,31 @@ Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, n
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testMultipleJoinHintsWithDifferentTableAlias">
+  <TestCase name="testMultipleJoinHintsWithSameTableName">
     <Resource name="sql">
       <![CDATA[
-SELECT /*+ LOOKUP('table'='D', 'output-mode'='allow_unordered'),
-           LOOKUP('table'='D1', 'retry-predicate'='lookup_miss', 'retry-strategy'='fixed_delay', 'fixed-delay'='10s', 'max-attempts'='3') */ *
+SELECT /*+ LOOKUP('table'='AsyncLookupTable', 'output-mode'='allow_unordered'),
+           LOOKUP('table'='AsyncLookupTable', 'output-mode'='ordered') */ *
 FROM MyTable AS T
-JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime AS D 
-  ON T.a = D.id
-JOIN LookupTable FOR SYSTEM_TIME AS OF T.proctime AS D1 
-  ON T.a = D1.id
+JOIN AsyncLookupTable FOR SYSTEM_TIME AS OF T.proctime
+ ON T.a = AsyncLookupTable.id
       ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7], id0=[$8], name0=[$9], age0=[$10])
-+- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{output-mode=allow_unordered, table=D}][LOOKUP inheritPath:[0] options:{retry-strategy=fixed_delay, max-attempts=3, fixed-delay=10s, retry-predicate=lookup_miss, table=D1}]]])
-   :- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0, 0] options:{output-mode=allow_unordered, table=D}][LOOKUP inheritPath:[0, 0] options:{retry-strategy=fixed_delay, max-attempts=3, fixed-delay=10s, retry-predicate=lookup_miss, table=D1}]]])
-   :  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[ALIAS inheritPath:[] options:[T]]]])
-   :  +- LogicalFilter(condition=[=($cor0.a, $0)])
-   :     +- LogicalSnapshot(period=[$cor0.proctime])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]])
-   +- LogicalFilter(condition=[=($cor1.a, $0)])
-      +- LogicalSnapshot(period=[$cor1.proctime])
-         +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 3}], joinHints=[[[LOOKUP inheritPath:[0] options:{output-mode=allow_unordered, table=AsyncLookupTable}][LOOKUP inheritPath:[0] options:{output-mode=ordered, table=AsyncLookupTable}]]])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]], hints=[[[ALIAS inheritPath:[] options:[T]]]])
+   +- LogicalFilter(condition=[=($cor0.a, $0)])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalTableScan(table=[[default_catalog, default_database, AsyncLookupTable]], hints=[[[ALIAS inheritPath:[] options:[AsyncLookupTable]]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, name, age, id0, name0, age0])
-+- LookupJoin(table=[default_catalog.default_database.LookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age, id0, name0, age0], retry=[lookup_miss, FIXED_DELAY, 10000ms, 3])
-   +- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
-      +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
+Calc(select=[a, b, c, PROCTIME_MATERIALIZE(proctime) AS proctime, rowtime, id, name, age])
++- LookupJoin(table=[default_catalog.default_database.AsyncLookupTable], joinType=[InnerJoin], lookup=[id=a], select=[a, b, c, proctime, rowtime, id, name, age], async=[UNORDERED, KEY_ORDERED: false, 180000ms, 100])
+   +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalFunctionJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalFunctionJoinTest.xml
index 4698d8fab5e..57151c8c52e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalFunctionJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalFunctionJoinTest.xml
@@ -16,30 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testSimpleJoin">
-    <Resource name="sql">
-      <![CDATA[SELECT o_amount * rate as rate FROM Orders AS o, LATERAL TABLE (Rates(o.o_rowtime)) AS r WHERE currency = o_currency]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(rate=[*($0, $4)])
-+- LogicalFilter(condition=[=($3, $1)])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-      :- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
-      +- LogicalTableFunctionScan(invocation=[Rates($cor0.o_rowtime)], rowType=[RecordType(VARCHAR(2147483647) currency, INTEGER rate, TIMESTAMP(3) *ROWTIME* rowtime)])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[(o_amount * rate) AS rate])
-+- TemporalJoin(joinType=[InnerJoin], where=[(__TEMPORAL_JOIN_CONDITION(o_rowtime, rowtime, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency)) AND (currency = o_currency))], select=[o_amount, o_currency, o_rowtime, currency, rate, rowtime])
-   :- Exchange(distribution=[hash[o_currency]])
-   :  +- DataStreamScan(table=[[default_catalog, default_database, Orders]], fields=[o_amount, o_currency, o_rowtime])
-   +- Exchange(distribution=[hash[currency]])
-      +- DataStreamScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testComplexJoin">
     <Resource name="sql">
       <![CDATA[SELECT * FROM (SELECT o_amount * rate as rate, secondary_key as secondary_key FROM Orders AS o, LATERAL TABLE (Rates(o_rowtime)) AS r WHERE currency = o_currency AND (rate > 120 OR secondary_key = o_secondary_key)), Table3 WHERE t3_secondary_key = secondary_key]]>
@@ -98,6 +74,30 @@ Calc(select=[(o_amount * rate) AS rate])
    :     +- DataStreamScan(table=[[default_catalog, default_database, Orders]], fields=[o_amount, o_currency, o_rowtime])
    +- Exchange(distribution=[hash[currency]])
       +- DataStreamScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSimpleJoin">
+    <Resource name="sql">
+      <![CDATA[SELECT o_amount * rate as rate FROM Orders AS o, LATERAL TABLE (Rates(o.o_rowtime)) AS r WHERE currency = o_currency]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(rate=[*($0, $4)])
++- LogicalFilter(condition=[=($3, $1)])
+   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+      :- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
+      +- LogicalTableFunctionScan(invocation=[Rates($cor0.o_rowtime)], rowType=[RecordType(VARCHAR(2147483647) currency, INTEGER rate, TIMESTAMP(3) *ROWTIME* rowtime)])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[(o_amount * rate) AS rate])
++- TemporalJoin(joinType=[InnerJoin], where=[(__TEMPORAL_JOIN_CONDITION(o_rowtime, rowtime, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency)) AND (currency = o_currency))], select=[o_amount, o_currency, o_rowtime, currency, rate, rowtime])
+   :- Exchange(distribution=[hash[o_currency]])
+   :  +- DataStreamScan(table=[[default_catalog, default_database, Orders]], fields=[o_amount, o_currency, o_rowtime])
+   +- Exchange(distribution=[hash[currency]])
+      +- DataStreamScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml
index 84f4f3eada6..cdae635225c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml
@@ -639,44 +639,6 @@ Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS procti
             +- Calc(select=[currency, rate])
                +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
                   +- TableSourceScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProcTimeTemporalJoinWithViewWithPredicates">
-    <Resource name="sql">
-      <![CDATA[SELECT * FROM Orders AS o JOIN rates_last_value FOR SYSTEM_TIME AS OF o.proctime AS r on o.currency = r.currency AND o.amount > 10 AND r.rate < 100]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[$3], currency0=[$4], rate=[$5])
-+- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1, 3}])
-   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-   :  +- LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[PROCTIME()])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
-   +- LogicalFilter(condition=[AND(=($cor0.currency, $0), >($cor0.amount, 10), <($1, 100))])
-      +- LogicalSnapshot(period=[$cor0.proctime])
-         +- LogicalAggregate(group=[{0}], rate=[LAST_VALUE($1)])
-            +- LogicalProject(currency=[$0], rate=[$1])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, RatesHistory]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, currency0, rate])
-+- TemporalJoin(joinType=[InnerJoin], where=[((currency = currency0) AND __TEMPORAL_JOIN_CONDITION(proctime, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency0), __TEMPORAL_JOIN_LEFT_KEY(currency), __TEMPORAL_JOIN_RIGHT_KEY(currency0)))], select=[amount, currency, rowtime, proctime, currency0, rate])
-   :- Exchange(distribution=[hash[currency]])
-   :  +- Calc(select=[amount, currency, rowtime, proctime], where=[(amount > 10)])
-   :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-   :        +- Calc(select=[amount, currency, rowtime, PROCTIME() AS proctime])
-   :           +- TableSourceScan(table=[[default_catalog, default_database, Orders]], fields=[amount, currency, rowtime])
-   +- Exchange(distribution=[hash[currency]])
-      +- Calc(select=[currency, rate], where=[(rate < 100)])
-         +- GroupAggregate(groupBy=[currency], select=[currency, LAST_VALUE(rate) AS rate])
-            +- Exchange(distribution=[hash[currency]])
-               +- Calc(select=[currency, rate])
-                  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-                     +- TableSourceScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -751,6 +713,44 @@ Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS procti
             +- Exchange(distribution=[hash[currency]])
                +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
                   +- TableSourceScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProcTimeTemporalJoinWithViewWithPredicates">
+    <Resource name="sql">
+      <![CDATA[SELECT * FROM Orders AS o JOIN rates_last_value FOR SYSTEM_TIME AS OF o.proctime AS r on o.currency = r.currency AND o.amount > 10 AND r.rate < 100]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[$3], currency0=[$4], rate=[$5])
++- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0, 1, 3}])
+   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+   :  +- LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[PROCTIME()])
+   :     +- LogicalTableScan(table=[[default_catalog, default_database, Orders]])
+   +- LogicalFilter(condition=[AND(=($cor0.currency, $0), >($cor0.amount, 10), <($1, 100))])
+      +- LogicalSnapshot(period=[$cor0.proctime])
+         +- LogicalAggregate(group=[{0}], rate=[LAST_VALUE($1)])
+            +- LogicalProject(currency=[$0], rate=[$1])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, RatesHistory]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[amount, currency, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, currency0, rate])
++- TemporalJoin(joinType=[InnerJoin], where=[((currency = currency0) AND __TEMPORAL_JOIN_CONDITION(proctime, __TEMPORAL_JOIN_CONDITION_PRIMARY_KEY(currency0), __TEMPORAL_JOIN_LEFT_KEY(currency), __TEMPORAL_JOIN_RIGHT_KEY(currency0)))], select=[amount, currency, rowtime, proctime, currency0, rate])
+   :- Exchange(distribution=[hash[currency]])
+   :  +- Calc(select=[amount, currency, rowtime, proctime], where=[(amount > 10)])
+   :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+   :        +- Calc(select=[amount, currency, rowtime, PROCTIME() AS proctime])
+   :           +- TableSourceScan(table=[[default_catalog, default_database, Orders]], fields=[amount, currency, rowtime])
+   +- Exchange(distribution=[hash[currency]])
+      +- Calc(select=[currency, rate], where=[(rate < 100)])
+         +- GroupAggregate(groupBy=[currency], select=[currency, LAST_VALUE(rate) AS rate])
+            +- Exchange(distribution=[hash[currency]])
+               +- Calc(select=[currency, rate])
+                  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+                     +- TableSourceScan(table=[[default_catalog, default_database, RatesHistory]], fields=[currency, rate, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml
index d780d55df54..77a528d3fb3 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml
@@ -1846,7 +1846,7 @@ Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, windo
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimplifyHopWindowTVFBeforeWindowJoinWithTwoCalc">
+  <TestCase name="testSimplifyHopWindowTVFBeforeWindowJoinWithRightCalc">
     <Resource name="sql">
       <![CDATA[
 SELECT *
@@ -1854,7 +1854,6 @@ FROM (
   SELECT *
   FROM TABLE(
   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
-  WHERE c > 10
 ) L
 JOIN (
   SELECT *
@@ -1870,12 +1869,11 @@ ON L.window_start = R.window_start AND L.window_end = R.window_end AND L.a = R.a
 LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7], a0=[$8], b0=[$9], c0=[$10], rowtime0=[$11], proctime0=[$12], window_start0=[$13], window_end0=[$14], window_time0=[$15])
 +- LogicalJoin(condition=[AND(=($5, $13), =($6, $14), =($0, $8))], joinType=[inner])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7])
-   :  +- LogicalFilter(condition=[>($2, 10)])
-   :     +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-   :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-   :           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-   :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-   :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   :  +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   :     +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+   :        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+   :           +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+   :              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7])
       +- LogicalFilter(condition=[>($2, 10)])
          +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
@@ -1890,11 +1888,10 @@ LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start
 Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, PROCTIME_MATERIALIZE(proctime0) AS proctime0, window_start0, window_end0, window_time0])
 +- WindowJoin(leftWindow=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], rightWindow=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], joinType=[InnerJoin], where=[=(a, a0)], select=[a, b, c, rowtime, proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, proctime0, window_start0, window_end0, window_time0])
    :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, b, c, rowtime, proctime, window_start, window_end, window_time], where=[>(c, 10)])
-   :     +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
-   :        +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-   :           +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
-   :              +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
+   :  +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
+   :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+   :        +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
+   :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, b, c, rowtime, proctime, window_start, window_end, window_time], where=[>(c, 10)])
          +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
@@ -1904,7 +1901,7 @@ Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, windo
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSimplifyHopWindowTVFBeforeWindowJoinWithRightCalc">
+  <TestCase name="testSimplifyHopWindowTVFBeforeWindowJoinWithTwoCalc">
     <Resource name="sql">
       <![CDATA[
 SELECT *
@@ -1912,6 +1909,7 @@ FROM (
   SELECT *
   FROM TABLE(
   HOP(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '5' MINUTE, INTERVAL '10' MINUTE))
+  WHERE c > 10
 ) L
 JOIN (
   SELECT *
@@ -1927,11 +1925,12 @@ ON L.window_start = R.window_start AND L.window_end = R.window_end AND L.a = R.a
 LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7], a0=[$8], b0=[$9], c0=[$10], rowtime0=[$11], proctime0=[$12], window_start0=[$13], window_end0=[$14], window_time0=[$15])
 +- LogicalJoin(condition=[AND(=($5, $13), =($6, $14), =($0, $8))], joinType=[inner])
    :- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7])
-   :  +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-   :     +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-   :        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-   :           +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-   :              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   :  +- LogicalFilter(condition=[>($2, 10)])
+   :     +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+   :           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+   :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+   :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7])
       +- LogicalFilter(condition=[>($2, 10)])
          +- LogicalTableFunctionScan(invocation=[HOP(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 300000:INTERVAL MINUTE, 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
@@ -1946,10 +1945,11 @@ LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start
 Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, PROCTIME_MATERIALIZE(proctime0) AS proctime0, window_start0, window_end0, window_time0])
 +- WindowJoin(leftWindow=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], rightWindow=[HOP(win_start=[window_start], win_end=[window_end], size=[10 min], slide=[5 min])], joinType=[InnerJoin], where=[=(a, a0)], select=[a, b, c, rowtime, proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, proctime0, window_start0, window_end0, window_time0])
    :- Exchange(distribution=[hash[a]])
-   :  +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
-   :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-   :        +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
-   :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
+   :  +- Calc(select=[a, b, c, rowtime, proctime, window_start, window_end, window_time], where=[>(c, 10)])
+   :     +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
+   :        +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+   :           +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
+   :              +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
    +- Exchange(distribution=[hash[a]])
       +- Calc(select=[a, b, c, rowtime, proctime, window_start, window_end, window_time], where=[>(c, 10)])
          +- WindowTableFunction(window=[HOP(time_col=[rowtime], size=[10 min], slide=[5 min])])
@@ -2059,69 +2059,6 @@ Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, windo
          +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
             +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTimeAttributePropagateForWindowJoin1">
-    <Resource name="sql">
-      <![CDATA[
-SELECT tmp1.*, MyTable4.* FROM tmp1 JOIN MyTable4 ON
- tmp1.a = MyTable4.a AND
- tmp1.rowtime BETWEEN
-   MyTable4.rowtime - INTERVAL '10' SECOND AND
-   MyTable4.rowtime + INTERVAL '1' HOUR
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(rowtime=[$0], a=[$1], l_cnt=[$2], l_uv=[$3], r_cnt=[$4], r_uv=[$5], a0=[$6], b=[$7], c=[$8], rowtime0=[$9], proctime=[$10])
-+- LogicalJoin(condition=[AND(=($1, $6), >=($0, -($9, 10000:INTERVAL SECOND)), <=($0, +($9, 3600000:INTERVAL HOUR)))], joinType=[inner])
-   :- LogicalProject(rowtime=[$3], a=[$0], l_cnt=[$4], l_uv=[$5], r_cnt=[$10], r_uv=[$11])
-   :  +- LogicalJoin(condition=[AND(=($1, $7), =($2, $8), =($0, $6))], joinType=[inner])
-   :     :- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
-   :     :  +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
-   :     :     +- LogicalTableFunctionScan(invocation=[CUMULATE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-   :     :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-   :     :           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-   :     :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-   :     :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   :     +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
-   :        +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
-   :           +- LogicalTableFunctionScan(invocation=[CUMULATE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-   :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-   :                 +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-   :                    +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-   :                       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable4]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[rowtime, a, l_cnt, l_uv, r_cnt, r_uv, a0, b, c, rowtime0, PROCTIME_MATERIALIZE(proctime) AS proctime])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-10000, leftUpperBound=3600000, leftTimeIndex=0, rightTimeIndex=3], where=[AND(=(a, a0), >=(rowtime, -(rowtime0, 10000:INTERVAL SECOND)), <=(rowtime, +(rowtime0, 3600000:INTERVAL HOUR)))], select=[rowtime, a, l_cnt, l_uv, r_cnt, r_uv, a0, b, c, rowtime0, proctime])
-   :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[window_time AS rowtime, a, cnt AS l_cnt, uv AS l_uv, cnt0 AS r_cnt, uv0 AS r_uv])
-   :     +- WindowJoin(leftWindow=[CUMULATE(win_start=[window_start], win_end=[window_end], max_size=[1 h], step=[10 min])], rightWindow=[CUMULATE(win_start=[window_start], win_end=[window_end], max_size=[1 h], step=[10 min])], joinType=[InnerJoin], where=[=(a, a0)], select=[a, window_start, window_end, window_time, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])
-   :        :- Exchange(distribution=[hash[a]])
-   :        :  +- Calc(select=[a, window_start, window_end, window_time, cnt, uv])
-   :        :     +- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])
-   :        :        +- Exchange(distribution=[hash[a]])
-   :        :           +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-   :        :              +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-   :        :                 +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
-   :        +- Exchange(distribution=[hash[a]])
-   :           +- Calc(select=[a, window_start, window_end, cnt, uv])
-   :              +- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])
-   :                 +- Exchange(distribution=[hash[a]])
-   :                    +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
-   :                       +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-   :                          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
-   +- Exchange(distribution=[hash[a]])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-         +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
-            +- TableSourceScan(table=[[default_catalog, default_database, MyTable4]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -2288,6 +2225,69 @@ Calc(select=[rowtime, a, l_b, l_c, r_b, r_c, a0, b, c, rowtime0, PROCTIME_MATERI
       +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
          +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
             +- TableSourceScan(table=[[default_catalog, default_database, MyTable3]], fields=[a, b, c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTimeAttributePropagateForWindowJoin1">
+    <Resource name="sql">
+      <![CDATA[
+SELECT tmp1.*, MyTable4.* FROM tmp1 JOIN MyTable4 ON
+ tmp1.a = MyTable4.a AND
+ tmp1.rowtime BETWEEN
+   MyTable4.rowtime - INTERVAL '10' SECOND AND
+   MyTable4.rowtime + INTERVAL '1' HOUR
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(rowtime=[$0], a=[$1], l_cnt=[$2], l_uv=[$3], r_cnt=[$4], r_uv=[$5], a0=[$6], b=[$7], c=[$8], rowtime0=[$9], proctime=[$10])
++- LogicalJoin(condition=[AND(=($1, $6), >=($0, -($9, 10000:INTERVAL SECOND)), <=($0, +($9, 3600000:INTERVAL HOUR)))], joinType=[inner])
+   :- LogicalProject(rowtime=[$3], a=[$0], l_cnt=[$4], l_uv=[$5], r_cnt=[$10], r_uv=[$11])
+   :  +- LogicalJoin(condition=[AND(=($1, $7), =($2, $8), =($0, $6))], joinType=[inner])
+   :     :- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
+   :     :  +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
+   :     :     +- LogicalTableFunctionScan(invocation=[CUMULATE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   :     :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+   :     :           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+   :     :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+   :     :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   :     +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
+   :        +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
+   :           +- LogicalTableFunctionScan(invocation=[CUMULATE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+   :                 +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+   :                    +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+   :                       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable4]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[rowtime, a, l_cnt, l_uv, r_cnt, r_uv, a0, b, c, rowtime0, PROCTIME_MATERIALIZE(proctime) AS proctime])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-10000, leftUpperBound=3600000, leftTimeIndex=0, rightTimeIndex=3], where=[AND(=(a, a0), >=(rowtime, -(rowtime0, 10000:INTERVAL SECOND)), <=(rowtime, +(rowtime0, 3600000:INTERVAL HOUR)))], select=[rowtime, a, l_cnt, l_uv, r_cnt, r_uv, a0, b, c, rowtime0, proctime])
+   :- Exchange(distribution=[hash[a]])
+   :  +- Calc(select=[window_time AS rowtime, a, cnt AS l_cnt, uv AS l_uv, cnt0 AS r_cnt, uv0 AS r_uv])
+   :     +- WindowJoin(leftWindow=[CUMULATE(win_start=[window_start], win_end=[window_end], max_size=[1 h], step=[10 min])], rightWindow=[CUMULATE(win_start=[window_start], win_end=[window_end], max_size=[1 h], step=[10 min])], joinType=[InnerJoin], where=[=(a, a0)], select=[a, window_start, window_end, window_time, cnt, uv, a0, window_start0, window_end0, cnt0, uv0])
+   :        :- Exchange(distribution=[hash[a]])
+   :        :  +- Calc(select=[a, window_start, window_end, window_time, cnt, uv])
+   :        :     +- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])
+   :        :        +- Exchange(distribution=[hash[a]])
+   :        :           +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+   :        :              +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+   :        :                 +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
+   :        +- Exchange(distribution=[hash[a]])
+   :           +- Calc(select=[a, window_start, window_end, cnt, uv])
+   :              +- GlobalWindowAggregate(groupBy=[a], window=[CUMULATE(slice_end=[$slice_end], max_size=[1 h], step=[10 min])], select=[a, COUNT(count1$0) AS cnt, COUNT(distinct$0 count$1) AS uv, start('w$) AS window_start, end('w$) AS window_end, rowtime('w$) AS window_time])
+   :                 +- Exchange(distribution=[hash[a]])
+   :                    +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
+   :                       +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+   :                          +- TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
+   +- Exchange(distribution=[hash[a]])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+         +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
+            +- TableSourceScan(table=[[default_catalog, default_database, MyTable4]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -2365,6 +2365,50 @@ Calc(select=[a, window_start, window_end, PROCTIME_MATERIALIZE(window_time) AS w
                   +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
                      +- Calc(select=[a, c, PROCTIME() AS proctime, rowtime])
                         +- TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testWindowJoinWithoutProjections">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM
+  TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE)) AS L
+JOIN
+  TABLE(TUMBLE(TABLE MyTable2, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE)) AS R
+ON L.window_start = R.window_start AND L.window_end = R.window_end AND L.a = R.a
+      ]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7], a0=[$8], b0=[$9], c0=[$10], rowtime0=[$11], proctime0=[$12], window_start0=[$13], window_end0=[$14], window_time0=[$15])
++- LogicalJoin(condition=[AND(=($5, $13), =($6, $14), =($0, $8))], joinType=[inner])
+   :- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+   :     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+   :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+]]>
+    </Resource>
+    <Resource name="optimized rel plan">
+      <![CDATA[
+Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, PROCTIME_MATERIALIZE(proctime0) AS proctime0, window_start0, window_end0, window_time0])
++- WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[=(a, a0)], select=[a, b, c, rowtime, proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, proctime0, window_start0, window_end0, window_time0])
+   :- Exchange(distribution=[hash[a]])
+   :  +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+   :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+   :        +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
+   :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
+   +- Exchange(distribution=[hash[a]])
+      +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
+            +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
+               +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -2424,50 +2468,6 @@ Calc(select=[window_start, window_end, a, cnt AS l_cnt, uv AS l_uv, cnt0 AS r_cn
                      +- LocalWindowAggregate(groupBy=[a], window=[CUMULATE(time_col=[rowtime], max_size=[1 h], step=[10 min])], select=[a, COUNT(*) AS count1$0, COUNT(distinct$0 c) AS count$1, DISTINCT(c) AS distinct$0, slice_end('w$) AS $slice_end])
                         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
                            +- TableSourceScan(table=[[default_catalog, default_database, MyTable2, project=[a, c, rowtime], metadata=[]]], fields=[a, c, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testWindowJoinWithoutProjections">
-    <Resource name="sql">
-      <![CDATA[
-SELECT *
-FROM
-  TABLE(TUMBLE(TABLE MyTable, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE)) AS L
-JOIN
-  TABLE(TUMBLE(TABLE MyTable2, DESCRIPTOR(rowtime), INTERVAL '15' MINUTE)) AS R
-ON L.window_start = R.window_start AND L.window_end = R.window_end AND L.a = R.a
-      ]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4], window_start=[$5], window_end=[$6], window_time=[$7], a0=[$8], b0=[$9], c0=[$10], rowtime0=[$11], proctime0=[$12], window_start0=[$13], window_end0=[$14], window_time0=[$15])
-+- LogicalJoin(condition=[AND(=($5, $13), =($6, $14), =($0, $8))], joinType=[inner])
-   :- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-   :  +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-   :     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-   :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableFunctionScan(invocation=[TUMBLE(TABLE(#0), DESCRIPTOR(_UTF-16LE'rowtime'), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
-]]>
-    </Resource>
-    <Resource name="optimized rel plan">
-      <![CDATA[
-Calc(select=[a, b, c, rowtime, PROCTIME_MATERIALIZE(proctime) AS proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, PROCTIME_MATERIALIZE(proctime0) AS proctime0, window_start0, window_end0, window_time0])
-+- WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], rightWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], size=[15 min])], joinType=[InnerJoin], where=[=(a, a0)], select=[a, b, c, rowtime, proctime, window_start, window_end, window_time, a0, b0, c0, rowtime0, proctime0, window_start0, window_end0, window_time0])
-   :- Exchange(distribution=[hash[a]])
-   :  +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
-   :     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-   :        +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
-   :           +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
-   +- Exchange(distribution=[hash[a]])
-      +- WindowTableFunction(window=[TUMBLE(time_col=[rowtime], size=[15 min])])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 1000:INTERVAL SECOND)])
-            +- Calc(select=[a, b, c, rowtime, PROCTIME() AS proctime])
-               +- TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/AggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/AggregateTest.xml
index 7d0572181e7..449feb4d76e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/AggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/AggregateTest.xml
@@ -151,23 +151,6 @@ Calc(select=[4 AS four, EXPR$0])
    +- Exchange(distribution=[hash[b]])
       +- Calc(select=[b, a])
          +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSimpleAggregate">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[AS($0, _UTF-16LE'b')], f0=[AS($1.f0, _UTF-16LE'f0')], f1=[AS($1.f1, _UTF-16LE'f1')])
-+- LogicalAggregate(group=[{1}], TMP_0=[CountMinMax($0)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[b, TMP_0.f0 AS f0, TMP_0.f1 AS f1])
-+- GroupAggregate(groupBy=[b], select=[b, CountMinMax(a) AS TMP_0])
-   +- Exchange(distribution=[hash[b]])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -209,39 +192,39 @@ Calc(select=[CAST(2 AS INTEGER) AS b, EXPR$0])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupDistinctAggregateWithUDAGG">
+  <TestCase name="testGroupDistinctAggregate">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
-+- LogicalAggregate(group=[{1}], EXPR$0=[*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*(DISTINCT $0, $2)], EXPR$1=[*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*($0, $2)])
-   +- LogicalProject(a=[$0], c=[$2], b0=[CAST($1):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
++- LogicalAggregate(group=[{1}], EXPR$0=[SUM(DISTINCT $0)], EXPR$1=[COUNT(DISTINCT $2)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[EXPR$0, EXPR$1])
-+- GroupAggregate(groupBy=[c], select=[c, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*(DISTINCT a, b0) AS EXPR$0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*(a, b0) AS EXPR$1])
-   +- Exchange(distribution=[hash[c]])
-      +- Calc(select=[a, c, CAST(b AS BIGINT) AS b0])
-         +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
++- GroupAggregate(groupBy=[b], select=[b, SUM(DISTINCT a) AS EXPR$0, COUNT(DISTINCT c) AS EXPR$1])
+   +- Exchange(distribution=[hash[b]])
+      +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGroupDistinctAggregate">
+  <TestCase name="testGroupDistinctAggregateWithUDAGG">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
-+- LogicalAggregate(group=[{1}], EXPR$0=[SUM(DISTINCT $0)], EXPR$1=[COUNT(DISTINCT $2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
++- LogicalAggregate(group=[{1}], EXPR$0=[*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*(DISTINCT $0, $2)], EXPR$1=[*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*($0, $2)])
+   +- LogicalProject(a=[$0], c=[$2], b0=[CAST($1):BIGINT])
+      +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[EXPR$0, EXPR$1])
-+- GroupAggregate(groupBy=[b], select=[b, SUM(DISTINCT a) AS EXPR$0, COUNT(DISTINCT c) AS EXPR$1])
-   +- Exchange(distribution=[hash[b]])
-      +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
++- GroupAggregate(groupBy=[c], select=[c, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*(DISTINCT a, b0) AS EXPR$0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvg*(a, b0) AS EXPR$1])
+   +- Exchange(distribution=[hash[c]])
+      +- Calc(select=[a, c, CAST(b AS BIGINT) AS b0])
+         +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -272,6 +255,23 @@ LogicalProject(b=[AS($0, _UTF-16LE'b')], f0=[AS($1.f0, _UTF-16LE'f0')], f1=[AS($
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[b, TMP_0.f0 AS f0, TMP_0.f1 AS f1, TMP_0.f2 AS f2])
++- GroupAggregate(groupBy=[b], select=[b, CountMinMax(a) AS TMP_0])
+   +- Exchange(distribution=[hash[b]])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSimpleAggregate">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[AS($0, _UTF-16LE'b')], f0=[AS($1.f0, _UTF-16LE'f0')], f1=[AS($1.f1, _UTF-16LE'f1')])
++- LogicalAggregate(group=[{1}], TMP_0=[CountMinMax($0)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[b, TMP_0.f0 AS f0, TMP_0.f1 AS f1])
 +- GroupAggregate(groupBy=[b], select=[b, CountMinMax(a) AS TMP_0])
    +- Exchange(distribution=[hash[b]])
       +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CalcTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CalcTest.xml
index 106ab5becae..161dc10e888 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CalcTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CalcTest.xml
@@ -56,20 +56,6 @@ LogicalFilter(condition=[AND(SEARCH($1, Sarg[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,
       <![CDATA[
 Calc(select=[a, b, CAST('xx' AS VARCHAR(2147483647)) AS c], where=[(SEARCH(b, Sarg[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]) AND (c = 'xx'))])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSimpleMap">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(f0=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f0, _UTF-16LE'f0')], f1=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f1, _UTF-16LE'f1')], f2=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f2, _UTF-16LE'f2')], f3=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f3, _UTF-16LE'f3')])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f0 AS f0, *org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f1 AS f1, *org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f2 AS f2, *org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f3 AS f3])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -119,44 +105,44 @@ Calc(select=[a, b, c], where=[(SEARCH(b, Sarg[(-..1), (1..2), (2..3), (3..4),
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTypeEquality">
+  <TestCase name="testRenameColumns">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(_c0=[=($0, ROW(1, _UTF-16LE'str'))])
+LogicalProject(a2=[$0], b2=[$1])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[(my_row = ROW(1, 'str')) AS _c0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[my_row])
+Calc(select=[a AS a2, b AS b2])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testScalarResult">
+  <TestCase name="testRowTypeEquality">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[AS(*org.apache.flink.table.planner.expressions.utils.Func1$$879c8537562dbe74f3349fa0e6502755*($0), _UTF-16LE'f0')])
+LogicalProject(_c0=[=($0, ROW(1, _UTF-16LE'str'))])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[*org.apache.flink.table.planner.expressions.utils.Func1$$879c8537562dbe74f3349fa0e6502755*(a) AS f0])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Calc(select=[(my_row = ROW(1, 'str')) AS _c0])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[my_row])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRenameColumns">
+  <TestCase name="testScalarResult">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a2=[$0], b2=[$1])
+LogicalProject(f0=[AS(*org.apache.flink.table.planner.expressions.utils.Func1$$879c8537562dbe74f3349fa0e6502755*($0), _UTF-16LE'f0')])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a AS a2, b AS b2])
+Calc(select=[*org.apache.flink.table.planner.expressions.utils.Func1$$879c8537562dbe74f3349fa0e6502755*(a) AS f0])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -195,6 +181,20 @@ GroupWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 5)], select=[COUNT
 +- Exchange(distribution=[single])
    +- Calc(select=[a, b, c, d, rowtime, UPPER(c) AS $f5])
       +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, d, rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSimpleMap">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(f0=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f0, _UTF-16LE'f0')], f1=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f1, _UTF-16LE'f1')], f2=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f2, _UTF-16LE'f2')], f3=[AS(*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*($0, $1, $2).f3, _UTF-16LE'f3')])
++- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[*org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f0 AS f0, *org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f1 AS f1, *org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f2 AS f2, *org.apache.flink.table.planner.expressions.utils.Func23$$79c21fb5a52b78edece166661f30bbd0*(a, b, c).f3 AS f3])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CorrelateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CorrelateTest.xml
index c8f0dc74bee..10853369c0b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CorrelateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/CorrelateTest.xml
@@ -178,28 +178,6 @@ LogicalProject(f0=[AS($3, _UTF-16LE'f0')], f1=[AS($4, _UTF-16LE'f1')])
 Calc(select=[f0, f1_0 AS f1])
 +- Correlate(invocation=[*org.apache.flink.table.planner.utils.TableFunc2*($2)], correlate=[table(*org.apache.flink.table.planner.utils.TableFunc2*(f3))], select=[f1,f2,f3,f0,f1_0], rowType=[RecordType(INTEGER f1, BIGINT f2, VARCHAR(2147483647) f3, VARCHAR(2147483647) f0, INTEGER f1_0)], joinType=[INNER])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[f1, f2, f3])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testInnerJoinConstantNonDeterministicFunction">
-    <Resource name="sql">
-      <![CDATA[
-SELECT *
-FROM MyTable, LATERAL TABLE(str_split('Jack,John')) AS T
-]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], EXPR$0=[$3])
-+- LogicalJoin(condition=[true], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-   +- LogicalTableFunctionScan(invocation=[str_split(_UTF-16LE'Jack,John')], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Correlate(invocation=[str_split(_UTF-16LE'Jack,John')], correlate=[table(str_split('Jack,John'))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
-+- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -240,24 +218,24 @@ Correlate(invocation=[str_split(_UTF-16LE'Jack,John', _UTF-16LE',')], correlate=
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testLeftJoinConstantNonDeterministicFunction">
+  <TestCase name="testInnerJoinConstantNonDeterministicFunction">
     <Resource name="sql">
       <![CDATA[
 SELECT *
-FROM MyTable Left JOIN LATERAL TABLE(str_split('Jack,John')) AS T ON TRUE
+FROM MyTable, LATERAL TABLE(str_split('Jack,John')) AS T
 ]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], EXPR$0=[$3])
-+- LogicalJoin(condition=[true], joinType=[left])
++- LogicalJoin(condition=[true], joinType=[inner])
    :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
    +- LogicalTableFunctionScan(invocation=[str_split(_UTF-16LE'Jack,John')], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Correlate(invocation=[str_split(_UTF-16LE'Jack,John')], correlate=[table(str_split('Jack,John'))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[LEFT])
+Correlate(invocation=[str_split(_UTF-16LE'Jack,John')], correlate=[table(str_split('Jack,John'))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[INNER])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
@@ -281,6 +259,28 @@ LogicalProject(a=[$0], b=[$1], c=[$2], EXPR$0=[$3])
       <![CDATA[
 Correlate(invocation=[str_split(_UTF-16LE'Jack,John', _UTF-16LE',')], correlate=[table(str_split('Jack,John',','))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[LEFT])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testLeftJoinConstantNonDeterministicFunction">
+    <Resource name="sql">
+      <![CDATA[
+SELECT *
+FROM MyTable Left JOIN LATERAL TABLE(str_split('Jack,John')) AS T ON TRUE
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], b=[$1], c=[$2], EXPR$0=[$3])
++- LogicalJoin(condition=[true], joinType=[left])
+   :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalTableFunctionScan(invocation=[str_split(_UTF-16LE'Jack,John')], rowType=[RecordType(VARCHAR(2147483647) EXPR$0)])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Correlate(invocation=[str_split(_UTF-16LE'Jack,John')], correlate=[table(str_split('Jack,John'))], select=[a,b,c,EXPR$0], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) EXPR$0)], joinType=[LEFT])
++- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -301,32 +301,32 @@ Calc(select=[c, s])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testScalarFunction">
+  <TestCase name="testPojoType">
     <Resource name="ast">
       <![CDATA[
 LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}])
 :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-+- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*(SUBSTRING($2, 2))], rowType=[RecordType(VARCHAR(2147483647) s)])
++- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.PojoTableFunc*($2)], rowType=[RecordType(VARCHAR(2147483647) name, INTEGER age)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Correlate(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*(SUBSTRING($2, 2))], correlate=[table(*org.apache.flink.table.planner.utils.TableFunc1*(SUBSTRING(c, 2)))], select=[a,b,c,s], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) s)], joinType=[INNER])
+Correlate(invocation=[*org.apache.flink.table.planner.utils.PojoTableFunc*($2)], correlate=[table(*org.apache.flink.table.planner.utils.PojoTableFunc*(c))], select=[a,b,c,name,age], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) name, INTEGER age)], joinType=[INNER])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPojoType">
+  <TestCase name="testScalarFunction">
     <Resource name="ast">
       <![CDATA[
 LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{}])
 :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-+- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.PojoTableFunc*($2)], rowType=[RecordType(VARCHAR(2147483647) name, INTEGER age)])
++- LogicalTableFunctionScan(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*(SUBSTRING($2, 2))], rowType=[RecordType(VARCHAR(2147483647) s)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Correlate(invocation=[*org.apache.flink.table.planner.utils.PojoTableFunc*($2)], correlate=[table(*org.apache.flink.table.planner.utils.PojoTableFunc*(c))], select=[a,b,c,name,age], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) name, INTEGER age)], joinType=[INNER])
+Correlate(invocation=[*org.apache.flink.table.planner.utils.TableFunc1*(SUBSTRING($2, 2))], correlate=[table(*org.apache.flink.table.planner.utils.TableFunc1*(SUBSTRING(c, 2)))], select=[a,b,c,s], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) s)], joinType=[INNER])
 +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTableAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTableAggregateTest.xml
index 45571d25214..94788691eb7 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTableAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTableAggregateTest.xml
@@ -42,11 +42,11 @@ Calc(select=[EXPR$0, f1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTimeMaterializer">
+  <TestCase name="testSingleWindow">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f0=[$1], _c1=[AS(+($2, 1), _UTF-16LE'_c1')], EXPR$0=[$3], EXPR$1=[$4])
-+- LogicalWindowTableAggregate(group=[{4}], tableAggregate=[[EmptyTableAggFunc($0, $1)]], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowTableAggregate(group=[{2}], tableAggregate=[[EmptyTableAggFunc($0, $1)]], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1])
    +- LogicalWatermarkAssigner(rowtime=[d], watermark=[$3])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[PROCTIME()])
          +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
@@ -55,20 +55,19 @@ LogicalProject(f0=[$1], _c1=[AS(+($2, 1), _UTF-16LE'_c1')], EXPR$0=[$3], EXPR$1=
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[f0, (f1 + 1) AS _c1, EXPR$0, EXPR$1])
-+- GroupWindowTableAggregate(groupBy=[e], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1], select=[e, EmptyTableAggFunc(a, b) AS (f0, f1), start('w) AS EXPR$0, end('w) AS EXPR$1])
-   +- Exchange(distribution=[hash[e]])
-      +- Calc(select=[a, b, c, d, PROCTIME_MATERIALIZE(e) AS e])
-         +- WatermarkAssigner(rowtime=[d], watermark=[d])
-            +- Calc(select=[a, b, c, d, PROCTIME() AS e])
-               +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
++- GroupWindowTableAggregate(groupBy=[c], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1], select=[c, EmptyTableAggFunc(a, b) AS (f0, f1), start('w) AS EXPR$0, end('w) AS EXPR$1])
+   +- Exchange(distribution=[hash[c]])
+      +- WatermarkAssigner(rowtime=[d], watermark=[d])
+         +- Calc(select=[a, b, c, d, PROCTIME() AS e])
+            +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testSingleWindow">
+  <TestCase name="testTimeMaterializer">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f0=[$1], _c1=[AS(+($2, 1), _UTF-16LE'_c1')], EXPR$0=[$3], EXPR$1=[$4])
-+- LogicalWindowTableAggregate(group=[{2}], tableAggregate=[[EmptyTableAggFunc($0, $1)]], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowTableAggregate(group=[{4}], tableAggregate=[[EmptyTableAggFunc($0, $1)]], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1])
    +- LogicalWatermarkAssigner(rowtime=[d], watermark=[$3])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[PROCTIME()])
          +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
@@ -77,11 +76,12 @@ LogicalProject(f0=[$1], _c1=[AS(+($2, 1), _UTF-16LE'_c1')], EXPR$0=[$3], EXPR$1=
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[f0, (f1 + 1) AS _c1, EXPR$0, EXPR$1])
-+- GroupWindowTableAggregate(groupBy=[c], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1], select=[c, EmptyTableAggFunc(a, b) AS (f0, f1), start('w) AS EXPR$0, end('w) AS EXPR$1])
-   +- Exchange(distribution=[hash[c]])
-      +- WatermarkAssigner(rowtime=[d], watermark=[d])
-         +- Calc(select=[a, b, c, d, PROCTIME() AS e])
-            +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
++- GroupWindowTableAggregate(groupBy=[e], window=[TumblingGroupWindow('w, d, 5)], properties=[EXPR$0, EXPR$1], select=[e, EmptyTableAggFunc(a, b) AS (f0, f1), start('w) AS EXPR$0, end('w) AS EXPR$1])
+   +- Exchange(distribution=[hash[e]])
+      +- Calc(select=[a, b, c, d, PROCTIME_MATERIALIZE(e) AS e])
+         +- WatermarkAssigner(rowtime=[d], watermark=[d])
+            +- Calc(select=[a, b, c, d, PROCTIME() AS e])
+               +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTest.xml
index 8e87a1daaf4..8562c253d03 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/GroupWindowTest.xml
@@ -80,35 +80,35 @@ GroupWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 5)], select=[COUNT
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAllProcessingTimeSlidingGroupWindowOverCount">
+  <TestCase name="testAllEventTimeTumblingGroupWindowOverTime">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[$0])
-+- LogicalWindowAggregate(group=[{}], EXPR$0=[COUNT($1)], window=[SlidingGroupWindow('w, proctime, 2, 1)], properties=[])
++- LogicalWindowAggregate(group=[{}], EXPR$0=[COUNT($1)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[])
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-GroupWindowAggregate(window=[SlidingGroupWindow('w, proctime, 2, 1)], select=[COUNT(int) AS EXPR$0])
+GroupWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 5)], select=[COUNT(int) AS EXPR$0])
 +- Exchange(distribution=[single])
-   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, proctime])
+   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testAllEventTimeTumblingGroupWindowOverTime">
+  <TestCase name="testAllProcessingTimeSlidingGroupWindowOverCount">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[$0])
-+- LogicalWindowAggregate(group=[{}], EXPR$0=[COUNT($1)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[])
++- LogicalWindowAggregate(group=[{}], EXPR$0=[COUNT($1)], window=[SlidingGroupWindow('w, proctime, 2, 1)], properties=[])
    +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-GroupWindowAggregate(window=[TumblingGroupWindow('w, rowtime, 5)], select=[COUNT(int) AS EXPR$0])
+GroupWindowAggregate(window=[SlidingGroupWindow('w, proctime, 2, 1)], select=[COUNT(int) AS EXPR$0])
 +- Exchange(distribution=[single])
-   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, rowtime])
+   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, proctime])
 ]]>
     </Resource>
   </TestCase>
@@ -209,22 +209,6 @@ GroupWindowAggregate(groupBy=[string], window=[SessionGroupWindow('w, rowtime, 7
 +- Exchange(distribution=[hash[string]])
    +- Calc(select=[long, int, string, rowtime, CAST(int AS BIGINT) AS int0])
       +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProcessingTimeSlidingGroupWindowOverCount">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(string=[$0], EXPR$0=[$1])
-+- LogicalWindowAggregate(group=[{2}], EXPR$0=[COUNT($1)], window=[SlidingGroupWindow('w, proctime, 2, 1)], properties=[])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupWindowAggregate(groupBy=[string], window=[SlidingGroupWindow('w, proctime, 2, 1)], select=[string, COUNT(int) AS EXPR$0])
-+- Exchange(distribution=[hash[string]])
-   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, proctime])
 ]]>
     </Resource>
   </TestCase>
@@ -309,22 +293,6 @@ GroupWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w, rowtime,
 +- Exchange(distribution=[hash[string]])
    +- Calc(select=[long, int, string, rowtime, CAST(int AS BIGINT) AS int0])
       +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, rowtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testSlideWindowStartEnd">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(string=[$0], EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3])
-+- LogicalWindowAggregate(group=[{2}], EXPR$0=[COUNT($1)], window=[SlidingGroupWindow('w, rowtime, 10, 5)], properties=[EXPR$1, EXPR$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-GroupWindowAggregate(groupBy=[string], window=[SlidingGroupWindow('w, rowtime, 10, 5)], properties=[EXPR$1, EXPR$2], select=[string, COUNT(int) AS EXPR$0, start('w) AS EXPR$1, end('w) AS EXPR$2])
-+- Exchange(distribution=[hash[string]])
-   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, rowtime])
 ]]>
     </Resource>
   </TestCase>
@@ -345,6 +313,22 @@ GroupWindowAggregate(window=[SlidingGroupWindow('w2, proctime, 20, 10)], select=
    +- GroupWindowAggregate(groupBy=[string], window=[TumblingGroupWindow('w1, proctime, 50)], properties=[EXPR$0], select=[string, COUNT(int) AS EXPR$1, proctime('w1) AS EXPR$0])
       +- Exchange(distribution=[hash[string]])
          +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, proctime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProcessingTimeSlidingGroupWindowOverCount">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(string=[$0], EXPR$0=[$1])
++- LogicalWindowAggregate(group=[{2}], EXPR$0=[COUNT($1)], window=[SlidingGroupWindow('w, proctime, 2, 1)], properties=[])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupWindowAggregate(groupBy=[string], window=[SlidingGroupWindow('w, proctime, 2, 1)], select=[string, COUNT(int) AS EXPR$0])
++- Exchange(distribution=[hash[string]])
+   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, proctime])
 ]]>
     </Resource>
   </TestCase>
@@ -410,6 +394,22 @@ Calc(select=[EXPR$0 AS we1, string, EXPR$1 AS cnt, EXPR$2 AS ws, EXPR$0 AS we2])
 +- GroupWindowAggregate(groupBy=[string], window=[SessionGroupWindow('w, rowtime, 3)], properties=[EXPR$0, EXPR$2], select=[string, COUNT(int) AS EXPR$1, end('w) AS EXPR$0, start('w) AS EXPR$2])
    +- Exchange(distribution=[hash[string]])
       +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[rowtime, int, string])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testSlideWindowStartEnd">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(string=[$0], EXPR$0=[$1], EXPR$1=[$2], EXPR$2=[$3])
++- LogicalWindowAggregate(group=[{2}], EXPR$0=[COUNT($1)], window=[SlidingGroupWindow('w, rowtime, 10, 5)], properties=[EXPR$1, EXPR$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+GroupWindowAggregate(groupBy=[string], window=[SlidingGroupWindow('w, rowtime, 10, 5)], properties=[EXPR$1, EXPR$2], select=[string, COUNT(int) AS EXPR$0, start('w) AS EXPR$1, end('w) AS EXPR$2])
++- Exchange(distribution=[hash[string]])
+   +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[long, int, string, rowtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/JoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/JoinTest.xml
index f3eb69b1caa..35e6158a31c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/JoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/JoinTest.xml
@@ -35,25 +35,6 @@ Join(joinType=[InnerJoin], where=[(((a = 1) AND (d = 1)) OR ((b = 2) AND (d = 5)
 +- Exchange(distribution=[single])
    +- Calc(select=[d, e], where=[SEARCH(d, Sarg[1, 5])])
       +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRowTimeInnerJoinWithTimeAccessed">
-    <Resource name="ast">
-      <![CDATA[
-LogicalFilter(condition=[AND(=($0, $4), >=($3, -($7, 300000:INTERVAL DAY TO SECOND)), <($3, $7), >($3, $6))])
-+- LogicalJoin(condition=[true], joinType=[inner])
-   :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-300000, leftUpperBound=-1, leftTimeIndex=3, rightTimeIndex=3], where=[((a = d) AND (lrtime >= (rrtime - 300000:INTERVAL DAY TO SECOND)) AND (lrtime < rrtime) AND (lrtime > f))], select=[a, b, c, lrtime, d, e, f, rrtime])
-:- Exchange(distribution=[hash[a]])
-:  +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, lrtime])
-+- Exchange(distribution=[hash[d]])
-   +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[d, e, f, rrtime])
 ]]>
     </Resource>
   </TestCase>
@@ -319,29 +300,6 @@ Calc(select=[b, y])
    :     +- DataStreamScan(table=[[default_catalog, default_database, T]], fields=[a, b, c])
    +- Exchange(distribution=[hash[z]])
       +- DataStreamScan(table=[[default_catalog, default_database, S]], fields=[x, y, z])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRowTimeWindowInnerJoin">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], e=[$5], lrtime=[$3])
-+- LogicalFilter(condition=[AND(=($0, $4), >=($3, -($7, 300000:INTERVAL DAY TO SECOND)), <($3, +($7, 3000:INTERVAL DAY TO SECOND)))])
-   +- LogicalJoin(condition=[true], joinType=[inner])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, e, lrtime])
-+- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-300000, leftUpperBound=2999, leftTimeIndex=1, rightTimeIndex=2], where=[((a = d) AND (lrtime >= (rrtime - 300000:INTERVAL DAY TO SECOND)) AND (lrtime < (rrtime + 3000:INTERVAL DAY TO SECOND)))], select=[a, lrtime, d, e, rrtime])
-   :- Exchange(distribution=[hash[a]])
-   :  +- Calc(select=[a, lrtime])
-   :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, lrtime])
-   +- Exchange(distribution=[hash[d]])
-      +- Calc(select=[d, e, rrtime])
-         +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[d, e, f, rrtime])
 ]]>
     </Resource>
   </TestCase>
@@ -364,6 +322,25 @@ Calc(select=[b, y])
    +- Exchange(distribution=[hash[z]])
       +- Calc(select=[y, z])
          +- DataStreamScan(table=[[default_catalog, default_database, S]], fields=[x, y, z])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRowTimeInnerJoinWithTimeAccessed">
+    <Resource name="ast">
+      <![CDATA[
+LogicalFilter(condition=[AND(=($0, $4), >=($3, -($7, 300000:INTERVAL DAY TO SECOND)), <($3, $7), >($3, $6))])
++- LogicalJoin(condition=[true], joinType=[inner])
+   :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-300000, leftUpperBound=-1, leftTimeIndex=3, rightTimeIndex=3], where=[((a = d) AND (lrtime >= (rrtime - 300000:INTERVAL DAY TO SECOND)) AND (lrtime < rrtime) AND (lrtime > f))], select=[a, b, c, lrtime, d, e, f, rrtime])
+:- Exchange(distribution=[hash[a]])
+:  +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, lrtime])
++- Exchange(distribution=[hash[d]])
+   +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[d, e, f, rrtime])
 ]]>
     </Resource>
   </TestCase>
@@ -386,6 +363,29 @@ Calc(select=[a, e, lrtime])
    +- Exchange(distribution=[hash[d]])
       +- Calc(select=[d, e, rrtime])
          +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[d, e, f, rrtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRowTimeWindowInnerJoin">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[$0], e=[$5], lrtime=[$3])
++- LogicalFilter(condition=[AND(=($0, $4), >=($3, -($7, 300000:INTERVAL DAY TO SECOND)), <($3, +($7, 3000:INTERVAL DAY TO SECOND)))])
+   +- LogicalJoin(condition=[true], joinType=[inner])
+      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[a, e, lrtime])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-300000, leftUpperBound=2999, leftTimeIndex=1, rightTimeIndex=2], where=[((a = d) AND (lrtime >= (rrtime - 300000:INTERVAL DAY TO SECOND)) AND (lrtime < (rrtime + 3000:INTERVAL DAY TO SECOND)))], select=[a, lrtime, d, e, rrtime])
+   :- Exchange(distribution=[hash[a]])
+   :  +- Calc(select=[a, lrtime])
+   :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[a, b, c, lrtime])
+   +- Exchange(distribution=[hash[d]])
+      +- Calc(select=[d, e, rrtime])
+         +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[d, e, f, rrtime])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/OverAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/OverAggregateTest.xml
index 3047a06dfcd..c2b407d4832 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/OverAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/OverAggregateTest.xml
@@ -203,36 +203,36 @@ Calc(select=[a, w0$o0 AS _c1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeBoundedPartitionedRangeOver">
+  <TestCase name="testRowTimeBoundedNonPartitionedRowsOver">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], _c1=[AS(AVG($2) OVER (PARTITION BY $0 ORDER BY $4 NULLS FIRST RANGE 7200000 PRECEDING), _UTF-16LE'_c1')], wAvg=[AS(*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*($2, CAST($0):BIGINT) OVER (PARTITION BY $0 ORDER BY $4 NULLS FIRST RANGE 7200000 PRECEDING), _UTF-16LE'wAvg')])
+LogicalProject(c=[$2], _c1=[AS(COUNT($0) OVER (ORDER BY $4 NULLS FIRST ROWS 2 PRECEDING), _UTF-16LE'_c1')])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, w0$o0 AS _c1, w0$o1 AS wAvg])
-+- OverAggregate(partitionBy=[a], orderBy=[rowtime ASC], window=[ RANGE BETWEEN 7200000 PRECEDING AND CURRENT ROW], select=[a, c, rowtime, $3, AVG(c) AS w0$o0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*(c, $3) AS w0$o1])
-   +- Exchange(distribution=[hash[a]])
-      +- Calc(select=[a, c, rowtime, CAST(a AS BIGINT) AS $3])
+Calc(select=[c, w0$o0 AS _c1])
++- OverAggregate(orderBy=[rowtime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, c, rowtime, COUNT(a) AS w0$o0])
+   +- Exchange(distribution=[single])
+      +- Calc(select=[a, c, rowtime])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeBoundedNonPartitionedRowsOver">
+  <TestCase name="testRowTimeBoundedPartitionedRangeOver">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], _c1=[AS(COUNT($0) OVER (ORDER BY $4 NULLS FIRST ROWS 2 PRECEDING), _UTF-16LE'_c1')])
+LogicalProject(a=[$0], _c1=[AS(AVG($2) OVER (PARTITION BY $0 ORDER BY $4 NULLS FIRST RANGE 7200000 PRECEDING), _UTF-16LE'_c1')], wAvg=[AS(*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*($2, CAST($0):BIGINT) OVER (PARTITION BY $0 ORDER BY $4 NULLS FIRST RANGE 7200000 PRECEDING), _UTF-16LE'wAvg')])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, w0$o0 AS _c1])
-+- OverAggregate(orderBy=[rowtime ASC], window=[ ROWS BETWEEN 2 PRECEDING AND CURRENT ROW], select=[a, c, rowtime, COUNT(a) AS w0$o0])
-   +- Exchange(distribution=[single])
-      +- Calc(select=[a, c, rowtime])
+Calc(select=[a, w0$o0 AS _c1, w0$o1 AS wAvg])
++- OverAggregate(partitionBy=[a], orderBy=[rowtime ASC], window=[ RANGE BETWEEN 7200000 PRECEDING AND CURRENT ROW], select=[a, c, rowtime, $3, AVG(c) AS w0$o0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*(c, $3) AS w0$o1])
+   +- Exchange(distribution=[hash[a]])
+      +- Calc(select=[a, c, rowtime, CAST(a AS BIGINT) AS $3])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
@@ -322,34 +322,34 @@ Calc(select=[c, w0$o0 AS _c1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeUnboundedPartitionedRowsOver">
+  <TestCase name="testRowTimeUnboundedPartitionedRangeOver">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], _c1=[AS(COUNT($0) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST ROWS UNBOUNDED PRECEDING), _UTF-16LE'_c1')], wAvg=[AS(*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*($2, CAST($0):BIGINT) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST ROWS UNBOUNDED PRECEDING), _UTF-16LE'wAvg')])
+LogicalProject(a=[$0], c=[$2], _c2=[AS(COUNT($0) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST), _UTF-16LE'_c2')], wAvg=[AS(*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*($2, CAST($0):BIGINT) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST), _UTF-16LE'wAvg')])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[c, w0$o0 AS _c1, w0$o1 AS wAvg])
-+- OverAggregate(partitionBy=[c], orderBy=[rowtime ASC], window=[ ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, rowtime, $3, COUNT(a) AS w0$o0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*(c, $3) AS w0$o1])
+Calc(select=[a, c, w0$o0 AS _c2, w0$o1 AS wAvg])
++- OverAggregate(partitionBy=[c], orderBy=[rowtime ASC], window=[ RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, rowtime, $3, COUNT(a) AS w0$o0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*(c, $3) AS w0$o1])
    +- Exchange(distribution=[hash[c]])
       +- Calc(select=[a, c, rowtime, CAST(a AS BIGINT) AS $3])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testRowTimeUnboundedPartitionedRangeOver">
+  <TestCase name="testRowTimeUnboundedPartitionedRowsOver">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], _c2=[AS(COUNT($0) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST), _UTF-16LE'_c2')], wAvg=[AS(*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*($2, CAST($0):BIGINT) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST), _UTF-16LE'wAvg')])
+LogicalProject(c=[$2], _c1=[AS(COUNT($0) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST ROWS UNBOUNDED PRECEDING), _UTF-16LE'_c1')], wAvg=[AS(*org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*($2, CAST($0):BIGINT) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST ROWS UNBOUNDED PRECEDING), _UTF-16LE'wAvg')])
 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a, c, w0$o0 AS _c2, w0$o1 AS wAvg])
-+- OverAggregate(partitionBy=[c], orderBy=[rowtime ASC], window=[ RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, rowtime, $3, COUNT(a) AS w0$o0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*(c, $3) AS w0$o1])
+Calc(select=[c, w0$o0 AS _c1, w0$o1 AS wAvg])
++- OverAggregate(partitionBy=[c], orderBy=[rowtime ASC], window=[ ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW], select=[a, c, rowtime, $3, COUNT(a) AS w0$o0, *org.apache.flink.table.planner.plan.utils.JavaUserDefinedAggFunctions$WeightedAvgWithRetract*(c, $3) AS w0$o1])
    +- Exchange(distribution=[hash[c]])
       +- Calc(select=[a, c, rowtime, CAST(a AS BIGINT) AS $3])
          +- DataStreamScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, proctime, rowtime])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonGroupWindowAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonGroupWindowAggregateTest.xml
index e4941a3eb03..5443691498c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonGroupWindowAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonGroupWindowAggregateTest.xml
@@ -16,47 +16,47 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testPandasEventTimeSlidingGroupWindowOverCount">
+  <TestCase name="testGeneralEventTimeSessionGroupWindowOverTime">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$0], EXPR$0=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$0=[PandasAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, proctime, 5, 2)], properties=[])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
+LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$2=[TestPythonAggregateFunction($0, $2)], window=[SessionGroupWindow('w, rowtime, 7)], properties=[EXPR$0, EXPR$1])
+   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, proctime, 5, 2)], select=[b, PandasAggregateFunction(a, c) AS EXPR$0])
-+- Exchange(distribution=[hash[b]])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
++- PythonGroupWindowAggregate(groupBy=[b], window=[SessionGroupWindow('w, rowtime, 7)], properties=[EXPR$0, EXPR$1], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
+   +- Exchange(distribution=[hash[b]])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPandasEventTimeTumblingGroupWindowOverTime">
+  <TestCase name="testGeneralEventTimeSlidingGroupWindowOverCount">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1])
-   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
+LogicalProject(b=[$0], EXPR$0=[$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$0=[TestPythonAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, proctime, 5, 2)], properties=[])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
-+- PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
-   +- Exchange(distribution=[hash[b]])
-      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
+PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, proctime, 5, 2)], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$0])
++- Exchange(distribution=[hash[b]])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPandasEventTimeSlidingGroupWindowOverTime">
+  <TestCase name="testGeneralEventTimeSlidingGroupWindowOverTime">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$2=[TestPythonAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1])
    +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
@@ -64,42 +64,25 @@ LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
-+- PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
++- PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
    +- Exchange(distribution=[hash[b]])
       +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testPandasEventTimeTumblingGroupWindowOverCount">
+  <TestCase name="testGeneralEventTimeTumblingGroupWindowOverCount">
     <Resource name="ast">
       <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$0=[PandasAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, proctime, 2)], properties=[])
++- LogicalWindowAggregate(group=[{1}], EXPR$0=[TestPythonAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, proctime, 2)], properties=[])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, proctime, 2)], select=[b, PandasAggregateFunction(a, c) AS EXPR$0])
-+- Exchange(distribution=[hash[b]])
-   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testGeneralEventTimeSlidingGroupWindowOverCount">
-	<Resource name="ast">
-  	  <![CDATA[
-LogicalProject(b=[$0], EXPR$0=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$0=[TestPythonAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, proctime, 5, 2)], properties=[])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-]]>
-	</Resource>
-	<Resource name="optimized exec plan">
-	  <![CDATA[
-PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, proctime, 5, 2)], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$0])
+PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, proctime, 2)], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$0])
 +- Exchange(distribution=[hash[b]])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
@@ -107,76 +90,93 @@ PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, proctime,
   </TestCase>
   <TestCase name="testGeneralEventTimeTumblingGroupWindowOverTime">
     <Resource name="ast">
-	  <![CDATA[
+      <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
 +- LogicalWindowAggregate(group=[{1}], EXPR$2=[TestPythonAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1])
    +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-	</Resource>
-	<Resource name="optimized exec plan">
-	  <![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
 +- PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
    +- Exchange(distribution=[hash[b]])
       +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testGeneralEventTimeSlidingGroupWindowOverTime">
-	<Resource name="ast">
-	  <![CDATA[
+  <TestCase name="testPandasEventTimeSlidingGroupWindowOverCount">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$0], EXPR$0=[$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$0=[PandasAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, proctime, 5, 2)], properties=[])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, proctime, 5, 2)], select=[b, PandasAggregateFunction(a, c) AS EXPR$0])
++- Exchange(distribution=[hash[b]])
+   +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testPandasEventTimeSlidingGroupWindowOverTime">
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$2=[TestPythonAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1])
    +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-	</Resource>
+    </Resource>
     <Resource name="optimized exec plan">
-	  <![CDATA[
+      <![CDATA[
 Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
-+- PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
++- PythonGroupWindowAggregate(groupBy=[b], window=[SlidingGroupWindow('w, rowtime, 5, 2)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
    +- Exchange(distribution=[hash[b]])
       +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testGeneralEventTimeTumblingGroupWindowOverCount">
+  <TestCase name="testPandasEventTimeTumblingGroupWindowOverCount">
     <Resource name="ast">
-	  <![CDATA[
+      <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$0=[TestPythonAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, proctime, 2)], properties=[])
++- LogicalWindowAggregate(group=[{1}], EXPR$0=[PandasAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, proctime, 2)], properties=[])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-	</Resource>
-	<Resource name="optimized exec plan">
-	  <![CDATA[
-PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, proctime, 2)], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$0])
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, proctime, 2)], select=[b, PandasAggregateFunction(a, c) AS EXPR$0])
 +- Exchange(distribution=[hash[b]])
    +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
-	</Resource>
+    </Resource>
   </TestCase>
-  <TestCase name="testGeneralEventTimeSessionGroupWindowOverTime">
-	<Resource name="ast">
-	  <![CDATA[
+  <TestCase name="testPandasEventTimeTumblingGroupWindowOverTime">
+    <Resource name="ast">
+      <![CDATA[
 LogicalProject(b=[$0], EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$1])
-+- LogicalWindowAggregate(group=[{1}], EXPR$2=[TestPythonAggregateFunction($0, $2)], window=[SessionGroupWindow('w, rowtime, 7)], properties=[EXPR$0, EXPR$1])
++- LogicalWindowAggregate(group=[{1}], EXPR$2=[PandasAggregateFunction($0, $2)], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1])
    +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$3])
       +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
-	</Resource>
-	<Resource name="optimized exec plan">
-	  <![CDATA[
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
 Calc(select=[b, EXPR$0, EXPR$1, EXPR$2])
-+- PythonGroupWindowAggregate(groupBy=[b], window=[SessionGroupWindow('w, rowtime, 7)], properties=[EXPR$0, EXPR$1], select=[b, TestPythonAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
++- PythonGroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w, rowtime, 5)], properties=[EXPR$0, EXPR$1], select=[b, PandasAggregateFunction(a, c) AS EXPR$2, start('w) AS EXPR$0, end('w) AS EXPR$1])
    +- Exchange(distribution=[hash[b]])
       +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
          +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c, rowtime])
 ]]>
-	</Resource>
+    </Resource>
   </TestCase>
 </Root>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonTableAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonTableAggregateTest.xml
index 9f6abdedad3..da71c16cbf0 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonTableAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/PythonTableAggregateTest.xml
@@ -33,39 +33,39 @@ Calc(select=[f0 AS d, f1 AS e])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableAggregateWithoutKeys">
+  <TestCase name="testTableAggregateMixedWithJavaCalls">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(d=[AS($0, _UTF-16LE'd')], e=[AS($1, _UTF-16LE'e')])
-+- LogicalTableAggregate(group=[{}], tableAggregate=[[PythonEmptyTableAggFunc($0, $2)]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(d=[AS($1, _UTF-16LE'd')], e=[AS($2, _UTF-16LE'e')])
++- LogicalTableAggregate(group=[{1}], tableAggregate=[[PythonEmptyTableAggFunc($0, $2)]])
+   +- LogicalProject(a=[$0], b=[$1], $f3=[+($2, 1)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[f0 AS d, f1 AS e])
-+- PythonGroupTableAggregate(select=[PythonEmptyTableAggFunc(a, c) AS (f0, f1)])
-   +- Exchange(distribution=[single])
-      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
++- PythonGroupTableAggregate(groupBy=[b], select=[b, PythonEmptyTableAggFunc(a, $f3) AS (f0, f1)])
+   +- Exchange(distribution=[hash[b]])
+      +- Calc(select=[a, b, (c + 1) AS $f3])
+         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableAggregateMixedWithJavaCalls">
+  <TestCase name="testTableAggregateWithoutKeys">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(d=[AS($1, _UTF-16LE'd')], e=[AS($2, _UTF-16LE'e')])
-+- LogicalTableAggregate(group=[{1}], tableAggregate=[[PythonEmptyTableAggFunc($0, $2)]])
-   +- LogicalProject(a=[$0], b=[$1], $f3=[+($2, 1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(d=[AS($0, _UTF-16LE'd')], e=[AS($1, _UTF-16LE'e')])
++- LogicalTableAggregate(group=[{}], tableAggregate=[[PythonEmptyTableAggFunc($0, $2)]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[f0 AS d, f1 AS e])
-+- PythonGroupTableAggregate(groupBy=[b], select=[b, PythonEmptyTableAggFunc(a, $f3) AS (f0, f1)])
-   +- Exchange(distribution=[hash[b]])
-      +- Calc(select=[a, b, (c + 1) AS $f3])
-         +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
++- PythonGroupTableAggregate(select=[PythonEmptyTableAggFunc(a, c) AS (f0, f1)])
+   +- Exchange(distribution=[single])
+      +- TableSourceScan(table=[[default_catalog, default_database, MyTable]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/SetOperatorsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/SetOperatorsTest.xml
index c87dac22aa4..526a373529b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/SetOperatorsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/SetOperatorsTest.xml
@@ -16,27 +16,6 @@ See the License for the specific language governing permissions and
 limitations under the License.
 -->
 <Root>
-  <TestCase name="testInUncorrelated">
-    <Resource name="ast">
-      <![CDATA[
-LogicalFilter(condition=[IN($0, {
-LogicalProject(x=[$0])
-  LogicalTableScan(table=[[default_catalog, default_database, Table2]])
-})])
-+- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Join(joinType=[LeftSemiJoin], where=[(a = x)], select=[a, b, c], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-:- Exchange(distribution=[hash[a]])
-:  +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
-+- Exchange(distribution=[hash[x]])
-   +- Calc(select=[x])
-      +- TableSourceScan(table=[[default_catalog, default_database, Table2]], fields=[x, y])
-]]>
-    </Resource>
-  </TestCase>
   <TestCase name="testFilterUnionTranspose">
     <Resource name="ast">
       <![CDATA[
@@ -58,6 +37,27 @@ Calc(select=[EXPR$0 AS a, b, EXPR$1 AS c])
          :  +- TableSourceScan(table=[[default_catalog, default_database, left]], fields=[a, b, c])
          +- Calc(select=[a, b, c], where=[(a > 0)])
             +- TableSourceScan(table=[[default_catalog, default_database, right]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testInUncorrelated">
+    <Resource name="ast">
+      <![CDATA[
+LogicalFilter(condition=[IN($0, {
+LogicalProject(x=[$0])
+  LogicalTableScan(table=[[default_catalog, default_database, Table2]])
+})])
++- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Join(joinType=[LeftSemiJoin], where=[(a = x)], select=[a, b, c], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
+:- Exchange(distribution=[hash[a]])
+:  +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
++- Exchange(distribution=[hash[x]])
+   +- Calc(select=[x])
+      +- TableSourceScan(table=[[default_catalog, default_database, Table2]], fields=[x, y])
 ]]>
     </Resource>
   </TestCase>
@@ -84,27 +84,6 @@ Join(joinType=[LeftSemiJoin], where=[(a = EXPR$0)], select=[a, b, c], leftInputS
          +- Exchange(distribution=[hash[y]])
             +- Calc(select=[x, y], where=[LIKE(y, '%Hanoi%')])
                +- TableSourceScan(table=[[default_catalog, default_database, tableB]], fields=[x, y])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testProjectUnionTranspose">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(b=[$1], c=[$2])
-+- LogicalUnion(all=[true])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, left]])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, right]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Union(all=[true], union=[b, c])
-:- Calc(select=[b, c])
-:  +- TableSourceScan(table=[[default_catalog, default_database, left]], fields=[a, b, c])
-+- Calc(select=[b, c])
-   +- TableSourceScan(table=[[default_catalog, default_database, right]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -134,6 +113,27 @@ Join(joinType=[LeftSemiJoin], where=[(b = w)], select=[a, b, c], leftInputSpec=[
 +- Exchange(distribution=[hash[w]])
    +- Calc(select=[w])
       +- TableSourceScan(table=[[default_catalog, default_database, tableC]], fields=[w, z])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProjectUnionTranspose">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(b=[$1], c=[$2])
++- LogicalUnion(all=[true])
+   :- LogicalProject(a=[$0], b=[$1], c=[$2])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, left]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, right]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Union(all=[true], union=[b, c])
+:- Calc(select=[b, c])
+:  +- TableSourceScan(table=[[default_catalog, default_database, left]], fields=[a, b, c])
++- Calc(select=[b, c])
+   +- TableSourceScan(table=[[default_catalog, default_database, right]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableAggregateTest.xml
index 94e19398cd6..79ee3d2f267 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableAggregateTest.xml
@@ -96,11 +96,11 @@ GroupTableAggregate(groupBy=[f0], select=[f0, EmptyTableAggFuncWithIntResultType
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableAggregateWithoutGroupBy">
+  <TestCase name="testTableAggregateWithSelectStar">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[*org.apache.flink.table.planner.expressions.utils.Func0$$6ad060e6c46e5cd996d7b888db472ebc*($0)], b=[$1])
-+- LogicalTableAggregate(group=[{}], tableAggregate=[[EmptyTableAggFunc($0, $1)]])
+LogicalProject(f0=[$0], f1=[$1])
++- LogicalTableAggregate(group=[{}], tableAggregate=[[EmptyTableAggFunc($1)]])
    +- LogicalWatermarkAssigner(rowtime=[d], watermark=[$3])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[PROCTIME()])
          +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
@@ -108,12 +108,11 @@ LogicalProject(a=[*org.apache.flink.table.planner.expressions.utils.Func0$$6ad06
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[*org.apache.flink.table.planner.expressions.utils.Func0$$6ad060e6c46e5cd996d7b888db472ebc*(f0) AS a, f1 AS b])
-+- GroupTableAggregate(select=[EmptyTableAggFunc(a, b) AS (f0, f1)])
-   +- Exchange(distribution=[single])
-      +- WatermarkAssigner(rowtime=[d], watermark=[d])
-         +- Calc(select=[a, b, c, d, PROCTIME() AS e])
-            +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
+GroupTableAggregate(select=[EmptyTableAggFunc(b) AS (f0, f1)])
++- Exchange(distribution=[single])
+   +- WatermarkAssigner(rowtime=[d], watermark=[d])
+      +- Calc(select=[a, b, c, d, PROCTIME() AS e])
+         +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
@@ -138,11 +137,11 @@ GroupTableAggregate(select=[EmptyTableAggFunc(d, e) AS (f0, f1)])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testTableAggregateWithSelectStar">
+  <TestCase name="testTableAggregateWithoutGroupBy">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[$0], f1=[$1])
-+- LogicalTableAggregate(group=[{}], tableAggregate=[[EmptyTableAggFunc($1)]])
+LogicalProject(a=[*org.apache.flink.table.planner.expressions.utils.Func0$$6ad060e6c46e5cd996d7b888db472ebc*($0)], b=[$1])
++- LogicalTableAggregate(group=[{}], tableAggregate=[[EmptyTableAggFunc($0, $1)]])
    +- LogicalWatermarkAssigner(rowtime=[d], watermark=[$3])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[PROCTIME()])
          +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
@@ -150,11 +149,12 @@ LogicalProject(f0=[$0], f1=[$1])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-GroupTableAggregate(select=[EmptyTableAggFunc(b) AS (f0, f1)])
-+- Exchange(distribution=[single])
-   +- WatermarkAssigner(rowtime=[d], watermark=[d])
-      +- Calc(select=[a, b, c, d, PROCTIME() AS e])
-         +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
+Calc(select=[*org.apache.flink.table.planner.expressions.utils.Func0$$6ad060e6c46e5cd996d7b888db472ebc*(f0) AS a, f1 AS b])
++- GroupTableAggregate(select=[EmptyTableAggFunc(a, b) AS (f0, f1)])
+   +- Exchange(distribution=[single])
+      +- WatermarkAssigner(rowtime=[d], watermark=[d])
+         +- Calc(select=[a, b, c, d, PROCTIME() AS e])
+            +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c, d])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableSourceTest.xml
index b85eb7d846d..c17313c1187 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TableSourceTest.xml
@@ -61,27 +61,6 @@ LogicalProject(rtime=[$1])
       <![CDATA[
 WatermarkAssigner(rowtime=[rtime], watermark=[rtime])
 +- TableSourceScan(table=[[default_catalog, default_database, T, project=[rtime], metadata=[]]], fields=[rtime])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testRowTimeTableSourceGroupWindow">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(name=[$0], EXPR$0=[$2], EXPR$1=[$1])
-+- LogicalWindowAggregate(group=[{3}], EXPR$1=[AVG($2)], window=[TumblingGroupWindow('w, rowtime, 600000)], properties=[EXPR$0])
-   +- LogicalFilter(condition=[>($2, 100)])
-      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[name, EXPR$0, EXPR$1])
-+- GroupWindowAggregate(groupBy=[name], window=[TumblingGroupWindow('w, rowtime, 600000)], properties=[EXPR$0], select=[name, AVG(val) AS EXPR$1, end('w) AS EXPR$0])
-   +- Exchange(distribution=[hash[name]])
-      +- Calc(select=[id, rowtime, val, name], where=[(val > 100)])
-         +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-            +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
 ]]>
     </Resource>
   </TestCase>
@@ -99,22 +78,6 @@ LogicalProject(name=[$3], val=[$2], rtime=[$1], id=[$0])
 WatermarkAssigner(rowtime=[rtime], watermark=[rtime])
 +- Calc(select=[name, val, rtime, id])
    +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[id, rtime, val, name])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testTableSourceWithTimestampRowTimeField">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(rowtime=[$1], id=[$0], name=[$3], val=[$2])
-+- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[rowtime, id, name, val])
-+- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-   +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
 ]]>
     </Resource>
   </TestCase>
@@ -133,6 +96,27 @@ Calc(select=[PROCTIME_MATERIALIZE(ptime) AS ptime, name, val, id])
 +- WatermarkAssigner(rowtime=[rtime], watermark=[rtime])
    +- Calc(select=[id, rtime, val, name, PROCTIME() AS ptime])
       +- TableSourceScan(table=[[default_catalog, default_database, T]], fields=[id, rtime, val, name])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testRowTimeTableSourceGroupWindow">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(name=[$0], EXPR$0=[$2], EXPR$1=[$1])
++- LogicalWindowAggregate(group=[{3}], EXPR$1=[AVG($2)], window=[TumblingGroupWindow('w, rowtime, 600000)], properties=[EXPR$0])
+   +- LogicalFilter(condition=[>($2, 100)])
+      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[name, EXPR$0, EXPR$1])
++- GroupWindowAggregate(groupBy=[name], window=[TumblingGroupWindow('w, rowtime, 600000)], properties=[EXPR$0], select=[name, AVG(val) AS EXPR$1, end('w) AS EXPR$0])
+   +- Exchange(distribution=[hash[name]])
+      +- Calc(select=[id, rowtime, val, name], where=[(val > 100)])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+            +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
 ]]>
     </Resource>
   </TestCase>
@@ -154,6 +138,22 @@ Calc(select=[name, EXPR$0, EXPR$1])
       +- Calc(select=[id, rowtime, val, name], where=[(val > 100)])
          +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 5000:INTERVAL SECOND)])
             +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testTableSourceWithTimestampRowTimeField">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(rowtime=[$1], id=[$0], name=[$3], val=[$2])
++- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+   +- LogicalTableScan(table=[[default_catalog, default_database, rowTimeT]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[rowtime, id, name, val])
++- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+   +- TableSourceScan(table=[[default_catalog, default_database, rowTimeT]], fields=[id, rowtime, val, name])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TwoStageAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TwoStageAggregateTest.xml
index 02dd026a67d..dac7e628ba2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TwoStageAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/TwoStageAggregateTest.xml
@@ -52,27 +52,6 @@ GlobalGroupAggregate(groupBy=[b], select=[b, AVG((sum$0, count$1)) AS EXPR$0])
       +- Calc(select=[b, CAST(a AS DOUBLE) AS a0])
          +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
             +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testGroupAggregateWithExpressionInSelect">
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
-+- LogicalAggregate(group=[{1}], EXPR$0=[MIN($2)], EXPR$1=[AVG($0)])
-   +- LogicalProject(a=[$0], d=[MOD($1, 3)], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[EXPR$0, EXPR$1])
-+- GlobalGroupAggregate(groupBy=[d], select=[d, MIN(min$0) AS EXPR$0, AVG((sum$1, count$2)) AS EXPR$1])
-   +- Exchange(distribution=[hash[d]])
-      +- LocalGroupAggregate(groupBy=[d], select=[d, MIN(c) AS min$0, AVG(a) AS (sum$1, count$2)])
-         +- Calc(select=[a, MOD(b, 3) AS d, c])
-            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
-               +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
@@ -115,6 +94,27 @@ Calc(select=[4 AS four, EXPR$0])
          +- Calc(select=[b, a])
             +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
                +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testGroupAggregateWithExpressionInSelect">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
++- LogicalAggregate(group=[{1}], EXPR$0=[MIN($2)], EXPR$1=[AVG($0)])
+   +- LogicalProject(a=[$0], d=[MOD($1, 3)], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, Table1]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[EXPR$0, EXPR$1])
++- GlobalGroupAggregate(groupBy=[d], select=[d, MIN(min$0) AS EXPR$0, AVG((sum$1, count$2)) AS EXPR$1])
+   +- Exchange(distribution=[hash[d]])
+      +- LocalGroupAggregate(groupBy=[d], select=[d, MIN(c) AS min$0, AVG(a) AS (sum$1, count$2)])
+         +- Calc(select=[a, MOD(b, 3) AS d, c])
+            +- MiniBatchAssigner(interval=[1000ms], mode=[ProcTime])
+               +- TableSourceScan(table=[[default_catalog, default_database, Table1]], fields=[a, b, c])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/ValuesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/ValuesTest.xml
index f56313f6db6..477ffef8d0c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/ValuesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/table/ValuesTest.xml
@@ -171,26 +171,6 @@ Union(all=[true], union=[f0, f1, f2])
 :  +- Reused(reference_id=[1])
 +- Calc(select=[0E-1 AS f0, 'D' AS f1, CAST(4 AS INTEGER) AS f2])
    +- Reused(reference_id=[1])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testValuesOverrideSchema">
-    <Resource name="ast">
-      <![CDATA[
-LogicalUnion(all=[true])
-:- LogicalProject(a=[CAST(+(1, 2)):BIGINT], b=[CAST(_UTF-16LE'ABC':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-:  +- LogicalValues(tuples=[[{ 0 }]])
-+- LogicalProject(a=[CAST(2:BIGINT):BIGINT], b=[CAST(_UTF-16LE'ABC':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-   +- LogicalValues(tuples=[[{ 0 }]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Union(all=[true], union=[a, b])
-:- Calc(select=[CAST(3 AS BIGINT) AS a, CAST('ABC' AS VARCHAR(2147483647)) AS b])
-:  +- Values(tuples=[[{ 0 }]])(reuse_id=[1])
-+- Calc(select=[CAST(2 AS BIGINT) AS a, CAST('ABC' AS VARCHAR(2147483647)) AS b])
-   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
@@ -226,37 +206,57 @@ Union(all=[true], union=[a, b])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testValuesWithComplexNesting">
+  <TestCase name="testValuesOverrideNullability">
+    <Resource name="ast">
+      <![CDATA[
+LogicalProject(a=[CAST(+(1, 2)):BIGINT NOT NULL], b=[_UTF-16LE'ABC':VARCHAR(4) CHARACTER SET "UTF-16LE"], c=[X'01020300':BINARY(4)])
++- LogicalValues(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Calc(select=[3 AS a, 'ABC' AS b, X'01020300' AS c])
++- Values(tuples=[[{ 0 }]])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testValuesOverrideSchema">
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(number=[CAST(1:DOUBLE):DOUBLE], row=[ROW(_UTF-16LE'A    ', 2:DECIMAL(10, 2), ROW(00:00:00))], array=[ARRAY(1:BIGINT)])
+:- LogicalProject(a=[CAST(+(1, 2)):BIGINT], b=[CAST(_UTF-16LE'ABC':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
 :  +- LogicalValues(tuples=[[{ 0 }]])
-+- LogicalProject(number=[CAST(3.141592653589793E0:DOUBLE):DOUBLE], row=[ROW(_UTF-16LE'ABC  ', 3.0E0:DECIMAL(10, 2), ROW(00:00:00))], array=[ARRAY(3:BIGINT)])
++- LogicalProject(a=[CAST(2:BIGINT):BIGINT], b=[CAST(_UTF-16LE'ABC':VARCHAR(2147483647) CHARACTER SET "UTF-16LE"):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
    +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Union(all=[true], union=[number, row, array])
-:- Calc(select=[CAST(1 AS DOUBLE) AS number, ROW('A    ', 2, ROW(00:00:00)) AS row, ARRAY(1) AS array])
+Union(all=[true], union=[a, b])
+:- Calc(select=[CAST(3 AS BIGINT) AS a, CAST('ABC' AS VARCHAR(2147483647)) AS b])
 :  +- Values(tuples=[[{ 0 }]])(reuse_id=[1])
-+- Calc(select=[CAST(3.141592653589793E0 AS DOUBLE) AS number, ROW('ABC  ', 3.0E0, ROW(00:00:00)) AS row, ARRAY(3) AS array])
++- Calc(select=[CAST(2 AS BIGINT) AS a, CAST('ABC' AS VARCHAR(2147483647)) AS b])
    +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testValuesOverrideNullability">
+  <TestCase name="testValuesWithComplexNesting">
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[CAST(+(1, 2)):BIGINT NOT NULL], b=[_UTF-16LE'ABC':VARCHAR(4) CHARACTER SET "UTF-16LE"], c=[X'01020300':BINARY(4)])
-+- LogicalValues(tuples=[[{ 0 }]])
+LogicalUnion(all=[true])
+:- LogicalProject(number=[CAST(1:DOUBLE):DOUBLE], row=[ROW(_UTF-16LE'A    ', 2:DECIMAL(10, 2), ROW(00:00:00))], array=[ARRAY(1:BIGINT)])
+:  +- LogicalValues(tuples=[[{ 0 }]])
++- LogicalProject(number=[CAST(3.141592653589793E0:DOUBLE):DOUBLE], row=[ROW(_UTF-16LE'ABC  ', 3.0E0:DECIMAL(10, 2), ROW(00:00:00))], array=[ARRAY(3:BIGINT)])
+   +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[3 AS a, 'ABC' AS b, X'01020300' AS c])
-+- Values(tuples=[[{ 0 }]])
+Union(all=[true], union=[number, row, array])
+:- Calc(select=[CAST(1 AS DOUBLE) AS number, ROW('A    ', 2, ROW(00:00:00)) AS row, ARRAY(1) AS array])
+:  +- Values(tuples=[[{ 0 }]])(reuse_id=[1])
++- Calc(select=[CAST(3.141592653589793E0 AS DOUBLE) AS number, ROW('ABC  ', 3.0E0, ROW(00:00:00)) AS row, ARRAY(3) AS array])
+   +- Reused(reference_id=[1])
 ]]>
     </Resource>
   </TestCase>
