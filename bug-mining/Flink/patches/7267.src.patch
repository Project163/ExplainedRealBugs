diff --git a/flink-clients/src/main/java/org/apache/flink/client/program/StreamContextEnvironment.java b/flink-clients/src/main/java/org/apache/flink/client/program/StreamContextEnvironment.java
index 21ddca61694..07f47573666 100644
--- a/flink-clients/src/main/java/org/apache/flink/client/program/StreamContextEnvironment.java
+++ b/flink-clients/src/main/java/org/apache/flink/client/program/StreamContextEnvironment.java
@@ -303,6 +303,7 @@ public class StreamContextEnvironment extends StreamExecutionEnvironment {
     private void checkCheckpointConfig(Configuration clusterConfigMap, List<String> errors) {
         CheckpointConfig expectedCheckpointConfig = new CheckpointConfig();
         expectedCheckpointConfig.configure(clusterConfigMap);
+        configureCheckpointStorage(clusterConfigMap, expectedCheckpointConfig);
         checkConfigurationObject(
                 expectedCheckpointConfig.toConfiguration(),
                 checkpointCfg.toConfiguration(),
diff --git a/flink-clients/src/test/java/org/apache/flink/client/program/StreamContextEnvironmentTest.java b/flink-clients/src/test/java/org/apache/flink/client/program/StreamContextEnvironmentTest.java
index 85f6279fc58..1af115a402a 100644
--- a/flink-clients/src/test/java/org/apache/flink/client/program/StreamContextEnvironmentTest.java
+++ b/flink-clients/src/test/java/org/apache/flink/client/program/StreamContextEnvironmentTest.java
@@ -121,6 +121,36 @@ class StreamContextEnvironmentTest {
                         CheckpointConfig.class.getSimpleName(), "setCheckpointStorage");
     }
 
+    @ParameterizedTest
+    @MethodSource("provideExecutors")
+    void testDisallowCheckpointStorageByConfiguration(
+            ThrowingConsumer<StreamExecutionEnvironment, Exception> executor) {
+        final Configuration clusterConfig = new Configuration();
+
+        Configuration jobConfig = new Configuration();
+        String disallowedPath = "file:///flink/disallowed/modification";
+        jobConfig.set(CheckpointingOptions.CHECKPOINT_STORAGE, "jobmanager");
+        jobConfig.set(CheckpointingOptions.CHECKPOINTS_DIRECTORY, disallowedPath);
+        final ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
+        final StreamContextEnvironment environment =
+                new StreamContextEnvironment(
+                        new MockExecutorServiceLoader(),
+                        clusterConfig,
+                        jobConfig,
+                        classLoader,
+                        true,
+                        true,
+                        false,
+                        Collections.emptyList());
+
+        environment.fromCollection(Collections.singleton(1)).sinkTo(new DiscardingSink<>());
+        assertThatThrownBy(() -> executor.accept(environment))
+                .isInstanceOf(MutatedConfigurationException.class)
+                .hasMessageContainingAll(
+                        CheckpointingOptions.CHECKPOINT_STORAGE.key(),
+                        CheckpointingOptions.CHECKPOINTS_DIRECTORY.key());
+    }
+
     @ParameterizedTest
     @MethodSource("provideExecutors")
     void testAllowCheckpointStorage(
diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java
index 891aabc52f6..343308edcf2 100644
--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java
@@ -73,6 +73,8 @@ import org.apache.flink.core.execution.PipelineExecutorServiceLoader;
 import org.apache.flink.core.fs.Path;
 import org.apache.flink.runtime.clusterframework.types.ResourceProfile;
 import org.apache.flink.runtime.scheduler.ClusterDatasetCorruptedException;
+import org.apache.flink.runtime.state.CheckpointStorage;
+import org.apache.flink.runtime.state.CheckpointStorageLoader;
 import org.apache.flink.runtime.state.KeyGroupRangeAssignment;
 import org.apache.flink.runtime.state.StateBackend;
 import org.apache.flink.runtime.state.StateBackendLoader;
@@ -1065,6 +1067,11 @@ public class StreamExecutionEnvironment implements AutoCloseable {
 
         config.configure(configuration, classLoader);
         checkpointCfg.configure(configuration);
+
+        // here we should make sure the configured checkpoint storage will take effect
+        // this needs to happen after checkpointCfg#configure(...) to override the effect of
+        // checkpointCfg#setCheckpointStorage(checkpointDirectory)
+        configureCheckpointStorage(configuration, checkpointCfg);
     }
 
     private void registerCustomListeners(
@@ -1098,6 +1105,17 @@ public class StreamExecutionEnvironment implements AutoCloseable {
         }
     }
 
+    protected void configureCheckpointStorage(
+            ReadableConfig configuration, CheckpointConfig checkpointCfg) {
+        try {
+            Optional<CheckpointStorage> storageOptional =
+                    CheckpointStorageLoader.fromConfig(configuration, userClassloader, null);
+            storageOptional.ifPresent(checkpointCfg::setCheckpointStorage);
+        } catch (DynamicCodeLoadingException e) {
+            throw new WrappingRuntimeException(e);
+        }
+    }
+
     // --------------------------------------------------------------------------------------------
     // Data stream creations
     // --------------------------------------------------------------------------------------------
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironmentTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironmentTest.java
index 4cb61a7d4ac..f04ce7a7883 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironmentTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironmentTest.java
@@ -25,12 +25,16 @@ import org.apache.flink.api.common.typeinfo.TypeInformation;
 import org.apache.flink.api.common.typeinfo.Types;
 import org.apache.flink.api.java.typeutils.GenericTypeInfo;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable;
+import org.apache.flink.configuration.CheckpointingOptions;
 import org.apache.flink.configuration.Configuration;
 import org.apache.flink.configuration.ExecutionOptions;
 import org.apache.flink.configuration.PipelineOptions;
+import org.apache.flink.core.fs.Path;
 import org.apache.flink.core.testutils.CheckedThread;
 import org.apache.flink.core.testutils.OneShotLatch;
 import org.apache.flink.runtime.clusterframework.types.ResourceProfile;
+import org.apache.flink.runtime.state.CheckpointStorage;
+import org.apache.flink.runtime.state.storage.JobManagerCheckpointStorage;
 import org.apache.flink.streaming.api.datastream.DataStream;
 import org.apache.flink.streaming.api.datastream.DataStreamSource;
 import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;
@@ -473,6 +477,21 @@ class StreamExecutionEnvironmentTest {
         }
     }
 
+    @Test
+    void testConfigureCheckpointStorage() {
+        Configuration configuration = new Configuration();
+        String path = "file:///valid";
+        configuration.set(CheckpointingOptions.CHECKPOINT_STORAGE, "jobmanager");
+        configuration.set(CheckpointingOptions.CHECKPOINTS_DIRECTORY, path);
+        StreamExecutionEnvironment env =
+                StreamExecutionEnvironment.getExecutionEnvironment(configuration);
+
+        CheckpointStorage storage = env.getCheckpointConfig().getCheckpointStorage();
+        assertThat(storage).isInstanceOf(JobManagerCheckpointStorage.class);
+        assertThat(((JobManagerCheckpointStorage) storage).getCheckpointPath())
+                .isEqualTo(new Path(path));
+    }
+
     /////////////////////////////////////////////////////////////
     // Utilities
     /////////////////////////////////////////////////////////////
