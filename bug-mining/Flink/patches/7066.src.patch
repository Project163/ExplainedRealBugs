diff --git a/flink-annotations/src/main/java/org/apache/flink/FlinkVersion.java b/flink-annotations/src/main/java/org/apache/flink/FlinkVersion.java
index 90c137e8851..e11ab58379b 100644
--- a/flink-annotations/src/main/java/org/apache/flink/FlinkVersion.java
+++ b/flink-annotations/src/main/java/org/apache/flink/FlinkVersion.java
@@ -87,7 +87,11 @@ public enum FlinkVersion {
         return Optional.ofNullable(CODE_MAP.get(code));
     }
 
-    /** Returns the current version. */
+    public static FlinkVersion valueOf(int majorVersion, int minorVersion) {
+        return FlinkVersion.valueOf("v" + majorVersion + "_" + minorVersion);
+    }
+
+    /** Returns the version for the current branch. */
     public static FlinkVersion current() {
         return values()[values().length - 1];
     }
diff --git a/flink-connectors/flink-connector-kafka/pom.xml b/flink-connectors/flink-connector-kafka/pom.xml
index 73b2b04255f..607af881a51 100644
--- a/flink-connectors/flink-connector-kafka/pom.xml
+++ b/flink-connectors/flink-connector-kafka/pom.xml
@@ -222,6 +222,13 @@ under the License.
 			<scope>test</scope>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 		<!-- ArchUit test dependencies -->
 
 		<dependency>
@@ -279,4 +286,47 @@ under the License.
 		</plugins>
 	</build>
 
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumerBaseMigrationTest.java b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumerBaseMigrationTest.java
index d1c641aa63f..eefa9cd1ae6 100644
--- a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumerBaseMigrationTest.java
+++ b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaConsumerBaseMigrationTest.java
@@ -36,9 +36,9 @@ import org.apache.flink.streaming.connectors.kafka.internals.KafkaTopicPartition
 import org.apache.flink.streaming.connectors.kafka.internals.KafkaTopicsDescriptor;
 import org.apache.flink.streaming.util.AbstractStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OperatorSnapshotUtil;
+import org.apache.flink.test.util.MigrationTest;
 import org.apache.flink.util.SerializedValue;
 
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
@@ -62,20 +62,9 @@ import static org.powermock.api.mockito.PowerMockito.when;
 /**
  * Tests for checking whether {@link FlinkKafkaConsumerBase} can restore from snapshots that were
  * done using previous Flink versions' {@link FlinkKafkaConsumerBase}.
- *
- * <p>For regenerating the binary snapshot files run {@link #writeSnapshot()} on the corresponding
- * Flink release-* branch.
  */
 @RunWith(Parameterized.class)
-public class FlinkKafkaConsumerBaseMigrationTest {
-
-    /**
-     * TODO change this to the corresponding savepoint version to be written (e.g. {@link
-     * FlinkVersion#v1_3} for 1.3) TODO and remove all @Ignore annotations on write*Snapshot()
-     * methods to generate savepoints TODO Note: You should generate the savepoint based on the
-     * release branch instead of the master.
-     */
-    private final FlinkVersion flinkGenerateSavepointVersion = null;
+public class FlinkKafkaConsumerBaseMigrationTest implements MigrationTest {
 
     private static final HashMap<KafkaTopicPartition, Long> PARTITION_STATE = new HashMap<>();
 
@@ -92,7 +81,8 @@ public class FlinkKafkaConsumerBaseMigrationTest {
 
     @Parameterized.Parameters(name = "Migration Savepoint: {0}")
     public static Collection<FlinkVersion> parameters() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_17);
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_8, MigrationTest.getMostRecentlyPublishedVersion());
     }
 
     public FlinkKafkaConsumerBaseMigrationTest(FlinkVersion testMigrateVersion) {
@@ -100,9 +90,8 @@ public class FlinkKafkaConsumerBaseMigrationTest {
     }
 
     /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeSnapshot(FlinkVersion flinkGenerateSavepointVersion) throws Exception {
         writeSnapshot(
                 "src/test/resources/kafka-consumer-migration-test-flink"
                         + flinkGenerateSavepointVersion
diff --git a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationOperatorTest.java b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationOperatorTest.java
index 5e87f04b85a..5de210d4220 100644
--- a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationOperatorTest.java
+++ b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationOperatorTest.java
@@ -20,7 +20,6 @@ package org.apache.flink.streaming.connectors.kafka;
 
 import org.apache.flink.FlinkVersion;
 
-import org.junit.Ignore;
 import org.junit.runners.Parameterized;
 
 import java.util.Arrays;
@@ -28,7 +27,7 @@ import java.util.Collection;
 
 /**
  * Migration test from FlinkKafkaProducer011 operator. This test depends on the resource generated
- * by {@link FlinkKafkaProducer011MigrationTest#writeSnapshot()}.
+ * by removed {@code FlinkKafkaProducer011MigrationTest#writeSnapshot()}.
  *
  * <p>Warning: We need to rename the generated resource based on the file naming pattern specified
  * by the {@link #getOperatorSnapshotPath(FlinkVersion)} method then copy the resource to the path
@@ -52,9 +51,8 @@ public class FlinkKafkaProducerMigrationOperatorTest extends FlinkKafkaProducerM
                 + "-snapshot";
     }
 
-    @Ignore
     @Override
-    public void writeSnapshot() throws Exception {
-        throw new UnsupportedOperationException();
+    public void writeSnapshot(FlinkVersion targetVersion) throws Exception {
+        // There is no need to generate snapshots for these tests in newer versions.
     }
 }
diff --git a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationTest.java b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationTest.java
index 220023ba4c8..53a94b3166a 100644
--- a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationTest.java
+++ b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducerMigrationTest.java
@@ -23,6 +23,7 @@ import org.apache.flink.api.common.typeutils.base.IntSerializer;
 import org.apache.flink.runtime.jobgraph.OperatorID;
 import org.apache.flink.streaming.api.operators.StreamSink;
 import org.apache.flink.streaming.util.OneInputStreamOperatorTestHarness;
+import org.apache.flink.test.util.MigrationTest;
 
 import org.apache.kafka.clients.producer.ProducerConfig;
 import org.junit.runner.RunWith;
@@ -34,15 +35,13 @@ import java.util.Properties;
 /**
  * Tests for checking whether {@link FlinkKafkaProducer} can restore from snapshots that were done
  * using previous Flink versions' {@link FlinkKafkaProducer}.
- *
- * <p>For regenerating the binary snapshot files run {@link #writeSnapshot()} on the corresponding
- * Flink release-* branch.
  */
 @RunWith(Parameterized.class)
 public class FlinkKafkaProducerMigrationTest extends KafkaMigrationTestBase {
     @Parameterized.Parameters(name = "Migration Savepoint: {0}")
     public static Collection<FlinkVersion> parameters() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_17);
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_8, MigrationTest.getMostRecentlyPublishedVersion());
     }
 
     public FlinkKafkaProducerMigrationTest(FlinkVersion testMigrateVersion) {
diff --git a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaMigrationTestBase.java b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaMigrationTestBase.java
index b08bb05e3f1..540c625347d 100644
--- a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaMigrationTestBase.java
+++ b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaMigrationTestBase.java
@@ -26,24 +26,22 @@ import org.apache.flink.streaming.connectors.kafka.internals.KeyedSerializationS
 import org.apache.flink.streaming.util.OneInputStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OperatorSnapshotUtil;
 import org.apache.flink.streaming.util.serialization.KeyedSerializationSchema;
+import org.apache.flink.test.util.MigrationTest;
 
 import org.junit.AfterClass;
 import org.junit.BeforeClass;
-import org.junit.Ignore;
 import org.junit.Test;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
 import java.util.Arrays;
-import java.util.Optional;
 import java.util.Properties;
 
 import static org.apache.flink.util.Preconditions.checkNotNull;
-import static org.apache.flink.util.Preconditions.checkState;
 
 /** The base class with migration tests for the Kafka Exactly-Once Producer. */
 @SuppressWarnings("serial")
-public abstract class KafkaMigrationTestBase extends KafkaTestBase {
+public abstract class KafkaMigrationTestBase extends KafkaTestBase implements MigrationTest {
 
     protected static final Logger LOG = LoggerFactory.getLogger(KafkaMigrationTestBase.class);
     protected static final String TOPIC = "flink-kafka-producer-migration-test";
@@ -55,14 +53,6 @@ public abstract class KafkaMigrationTestBase extends KafkaTestBase {
     protected final KeyedSerializationSchema<Integer> integerKeyedSerializationSchema =
             new KeyedSerializationSchemaWrapper<>(integerSerializationSchema);
 
-    /**
-     * TODO change this to the corresponding savepoint version to be written (e.g. {@link
-     * FlinkVersion#v1_3} for 1.3) TODO and remove all @Ignore annotations on write*Snapshot()
-     * methods to generate savepoints TODO Note: You should generate the savepoint based on the
-     * release branch instead of the master.
-     */
-    protected final Optional<FlinkVersion> flinkGenerateSavepointVersion = Optional.empty();
-
     public KafkaMigrationTestBase(FlinkVersion testMigrateVersion) {
         this.testMigrateVersion = checkNotNull(testMigrateVersion);
     }
@@ -89,17 +79,14 @@ public abstract class KafkaMigrationTestBase extends KafkaTestBase {
     @AfterClass
     public static void shutDownServices() throws Exception {}
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeSnapshot(FlinkVersion flinkGenerateSavepointVersion) throws Exception {
         try {
-            checkState(flinkGenerateSavepointVersion.isPresent());
             startClusters();
 
             OperatorSubtaskState snapshot = initializeTestState();
             OperatorSnapshotUtil.writeStateHandle(
-                    snapshot, getOperatorSnapshotPath(flinkGenerateSavepointVersion.get()));
+                    snapshot, getOperatorSnapshotPath(flinkGenerateSavepointVersion));
         } finally {
             shutdownClusters();
         }
diff --git a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaSerializerUpgradeTest.java b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaSerializerUpgradeTest.java
index 0d89d39b8ee..9886885d559 100644
--- a/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaSerializerUpgradeTest.java
+++ b/flink-connectors/flink-connector-kafka/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaSerializerUpgradeTest.java
@@ -41,23 +41,22 @@ import static org.hamcrest.Matchers.is;
  */
 class KafkaSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "transaction-state-serializer",
-                            flinkVersion,
-                            TransactionStateSerializerSetup.class,
-                            TransactionStateSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "context-state-serializer",
-                            flinkVersion,
-                            ContextStateSerializerSetup.class,
-                            ContextStateSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "transaction-state-serializer",
+                        flinkVersion,
+                        TransactionStateSerializerSetup.class,
+                        TransactionStateSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "context-state-serializer",
+                        flinkVersion,
+                        ContextStateSerializerSetup.class,
+                        ContextStateSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-connectors/flink-connector-kafka/src/test/resources/log4j2-test.properties b/flink-connectors/flink-connector-kafka/src/test/resources/log4j2-test.properties
index 863665cf4f7..6ab97f20762 100644
--- a/flink-connectors/flink-connector-kafka/src/test/resources/log4j2-test.properties
+++ b/flink-connectors/flink-connector-kafka/src/test/resources/log4j2-test.properties
@@ -36,3 +36,6 @@ logger.zookeeper.name = org.apache.zookeeper
 logger.zookeeper.level = OFF
 logger.I0Itec.name = org.I0Itec
 logger.I0Itec.level = OFF
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-connectors/flink-hadoop-compatibility/pom.xml b/flink-connectors/flink-hadoop-compatibility/pom.xml
index 354d4f25f93..271586cbd17 100644
--- a/flink-connectors/flink-hadoop-compatibility/pom.xml
+++ b/flink-connectors/flink-hadoop-compatibility/pom.xml
@@ -108,6 +108,13 @@ under the License.
 			<type>test-jar</type>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 		<!-- ArchUit test dependencies -->
 
 		<dependency>
@@ -237,4 +244,47 @@ under the License.
 		</plugins>
 	</build>
 
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-connectors/flink-hadoop-compatibility/src/test/java/org/apache/flink/api/java/typeutils/runtime/WritableSerializerUpgradeTest.java b/flink-connectors/flink-hadoop-compatibility/src/test/java/org/apache/flink/api/java/typeutils/runtime/WritableSerializerUpgradeTest.java
index 9bbad27f00e..f953fa40957 100644
--- a/flink-connectors/flink-hadoop-compatibility/src/test/java/org/apache/flink/api/java/typeutils/runtime/WritableSerializerUpgradeTest.java
+++ b/flink-connectors/flink-hadoop-compatibility/src/test/java/org/apache/flink/api/java/typeutils/runtime/WritableSerializerUpgradeTest.java
@@ -41,17 +41,16 @@ import static org.hamcrest.Matchers.is;
 class WritableSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<WritableName, WritableName> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "writeable-serializer",
-                            flinkVersion,
-                            WritableSerializerSetup.class,
-                            WritableSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "writeable-serializer",
+                        flinkVersion,
+                        WritableSerializerSetup.class,
+                        WritableSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-connectors/flink-hadoop-compatibility/src/test/resources/log4j2-test.properties b/flink-connectors/flink-hadoop-compatibility/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..0e58bcd0c15 100644
--- a/flink-connectors/flink-hadoop-compatibility/src/test/resources/log4j2-test.properties
+++ b/flink-connectors/flink-hadoop-compatibility/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-core/pom.xml b/flink-core/pom.xml
index 21ebe12cee7..cdbbd12ec2c 100644
--- a/flink-core/pom.xml
+++ b/flink-core/pom.xml
@@ -133,6 +133,12 @@ under the License.
 			<scope>test</scope>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
 	</dependencies>
 
 	<build>
@@ -162,4 +168,47 @@ under the License.
 
 	</build>
 
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerUpgradeTest.java
index 5630903dca3..2b0d40e1753 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerUpgradeTest.java
@@ -35,23 +35,22 @@ import static org.hamcrest.Matchers.is;
 /** A {@link TypeSerializerUpgradeTestBase} for {@link GenericArraySerializer}. */
 class CompositeTypeSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "either-serializer",
-                            flinkVersion,
-                            EitherSerializerSetup.class,
-                            EitherSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "generic-array-serializer",
-                            flinkVersion,
-                            GenericArraySerializerSetup.class,
-                            GenericArraySerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "either-serializer",
+                        flinkVersion,
+                        EitherSerializerSetup.class,
+                        EitherSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "generic-array-serializer",
+                        flinkVersion,
+                        GenericArraySerializerSetup.class,
+                        GenericArraySerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java
index e47dbc01516..afd328f660f 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java
@@ -23,10 +23,10 @@ import org.apache.flink.core.memory.DataInputDeserializer;
 import org.apache.flink.core.memory.DataInputView;
 import org.apache.flink.core.memory.DataOutputSerializer;
 import org.apache.flink.core.memory.DataOutputView;
+import org.apache.flink.test.util.MigrationTest;
 
 import org.assertj.core.api.HamcrestCondition;
 import org.hamcrest.Matcher;
-import org.junit.jupiter.api.Disabled;
 import org.junit.jupiter.api.TestInstance;
 import org.junit.jupiter.params.ParameterizedTest;
 import org.junit.jupiter.params.provider.MethodSource;
@@ -35,8 +35,9 @@ import java.io.IOException;
 import java.nio.file.Files;
 import java.nio.file.Path;
 import java.nio.file.Paths;
+import java.util.ArrayList;
 import java.util.Collection;
-import java.util.Set;
+import java.util.List;
 
 import static org.apache.flink.util.Preconditions.checkNotNull;
 import static org.apache.flink.util.Preconditions.checkState;
@@ -44,19 +45,10 @@ import static org.assertj.core.api.AssertionsForInterfaceTypes.assertThat;
 import static org.assertj.core.api.Assumptions.assumeThat;
 import static org.hamcrest.CoreMatchers.not;
 
-/**
- * A test base for testing {@link TypeSerializer} upgrades.
- *
- * <p>You can run {@link #generateTestSetupFiles(TestSpecification)} on a Flink branch to
- * (re-)generate the test data files.
- */
+/** A test base for testing {@link TypeSerializer} upgrades. */
 @TestInstance(TestInstance.Lifecycle.PER_CLASS)
-public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedElementT> {
-
-    public static final FlinkVersion CURRENT_VERSION = FlinkVersion.v1_17;
-
-    public static final Set<FlinkVersion> MIGRATION_VERSIONS =
-            FlinkVersion.rangeOf(FlinkVersion.v1_11, CURRENT_VERSION);
+public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedElementT>
+        implements MigrationTest {
 
     // ------------------------------------------------------------------------------
     //  APIs
@@ -66,7 +58,22 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
      * Creates a collection of {@link TestSpecification} which will be used as input for
      * parametrized tests.
      */
-    public abstract Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception;
+    public abstract Collection<TestSpecification<?, ?>> createTestSpecifications(
+            FlinkVersion currentVersion) throws Exception;
+
+    public Collection<FlinkVersion> getMigrationVersions() {
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_11, MigrationTest.getMostRecentlyPublishedVersion());
+    }
+
+    public final Collection<TestSpecification<?, ?>> createTestSpecificationsForAllVersions()
+            throws Exception {
+        List<TestSpecification<?, ?>> specificationList = new ArrayList<>();
+        for (FlinkVersion version : getMigrationVersions()) {
+            specificationList.addAll(createTestSpecifications(version));
+        }
+        return specificationList;
+    }
 
     /**
      * Setup code for a {@link TestSpecification}. This creates the serializer before upgrade and
@@ -242,10 +249,8 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
      * generating the test files, e.g. to generate test files for {@link FlinkVersion#v1_8}, you
      * should be under the release-1.8 branch.
      */
-    @Disabled
-    @ParameterizedTest(name = "Test Specification = {0}")
-    @MethodSource("createTestSpecifications")
-    void generateTestSetupFiles(
+    @ParameterizedSnapshotsGenerator("createTestSpecifications")
+    public void generateTestSetupFiles(
             TestSpecification<PreviousElementT, UpgradedElementT> testSpecification)
             throws Exception {
         Files.createDirectories(getSerializerSnapshotFilePath(testSpecification).getParent());
@@ -268,7 +273,8 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
             // ... then write the serializer snapshot
             DataOutputSerializer serializerSnapshotOut =
                     new DataOutputSerializer(INITIAL_OUTPUT_BUFFER_SIZE);
-            writeSerializerSnapshot(serializerSnapshotOut, priorSerializer, CURRENT_VERSION);
+            writeSerializerSnapshot(
+                    serializerSnapshotOut, priorSerializer, testSpecification.flinkVersion);
             writeContentsTo(
                     getGenerateSerializerSnapshotFilePath(testSpecification),
                     serializerSnapshotOut.getCopyOfBuffer());
@@ -280,7 +286,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
     // ------------------------------------------------------------------------------
 
     @ParameterizedTest(name = "Test Specification = {0}")
-    @MethodSource("createTestSpecifications")
+    @MethodSource("createTestSpecificationsForAllVersions")
     void restoreSerializerIsValid(
             TestSpecification<PreviousElementT, UpgradedElementT> testSpecification)
             throws Exception {
@@ -308,7 +314,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
     }
 
     @ParameterizedTest(name = "Test Specification = {0}")
-    @MethodSource("createTestSpecifications")
+    @MethodSource("createTestSpecificationsForAllVersions")
     void upgradedSerializerHasExpectedSchemaCompatibility(
             TestSpecification<PreviousElementT, UpgradedElementT> testSpecification)
             throws Exception {
@@ -331,7 +337,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
     }
 
     @ParameterizedTest(name = "Test Specification = {0}")
-    @MethodSource("createTestSpecifications")
+    @MethodSource("createTestSpecificationsForAllVersions")
     void upgradedSerializerIsValidAfterMigration(
             TestSpecification<PreviousElementT, UpgradedElementT> testSpecification)
             throws Exception {
@@ -369,7 +375,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
     }
 
     @ParameterizedTest(name = "Test Specification = {0}")
-    @MethodSource("createTestSpecifications")
+    @MethodSource("createTestSpecificationsForAllVersions")
     void upgradedSerializerIsValidAfterReconfiguration(
             TestSpecification<PreviousElementT, UpgradedElementT> testSpecification)
             throws Exception {
@@ -400,7 +406,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
     }
 
     @ParameterizedTest(name = "Test Specification = {0}")
-    @MethodSource("createTestSpecifications")
+    @MethodSource("createTestSpecificationsForAllVersions")
     void upgradedSerializerIsValidWhenCompatibleAsIs(
             TestSpecification<PreviousElementT, UpgradedElementT> testSpecification)
             throws Exception {
@@ -481,7 +487,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
                 + "/src/test/resources/"
                 + testSpecification.name
                 + "-"
-                + CURRENT_VERSION;
+                + testSpecification.flinkVersion;
     }
 
     private Path getSerializerSnapshotFilePath(
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/BasicTypeSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/BasicTypeSerializerUpgradeTest.java
index 322c4d32cda..0aa0eaebcf7 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/BasicTypeSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/BasicTypeSerializerUpgradeTest.java
@@ -27,204 +27,186 @@ import java.util.Collection;
 /** A {@link TypeSerializerUpgradeTestBase} for BaseType Serializers. */
 class BasicTypeSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "big-dec-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.BigDecSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.BigDecSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "big-int-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.BigIntSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.BigIntSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "boolean-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.BooleanSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.BooleanSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "boolean-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.BooleanValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications
-                                    .BooleanValueSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "byte-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.ByteSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.ByteSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "byte-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.ByteValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.ByteValueSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "char-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.CharSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.CharSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "char-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.CharValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.CharValueSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "date-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.DateSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.DateSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "double-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.DoubleSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.DoubleSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "double-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.DoubleValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications
-                                    .DoubleValueSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "float-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.FloatSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.FloatSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "float-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.FloatValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications
-                                    .FloatValueSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "int-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.IntSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.IntSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "int-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.IntValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.IntValueSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "long-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.LongSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.LongSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "long-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.LongValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.LongValueSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "null-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.NullValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.NullValueSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "short-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.ShortSerializerSetup.class,
-                            BasicTypeSerializerUpgradeTestSpecifications.ShortSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "short-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.ShortValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications
-                                    .ShortValueSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "sql-date-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.SqlDateSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.SqlDateSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "sql-time-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.SqlTimeSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.SqlTimeSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "sql-timestamp-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.SqlTimestampSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications
-                                    .SqlTimestampSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "string-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.StringSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications.StringSerializerVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "string-value-serializer",
-                            flinkVersion,
-                            BasicTypeSerializerUpgradeTestSpecifications.StringValueSerializerSetup
-                                    .class,
-                            BasicTypeSerializerUpgradeTestSpecifications
-                                    .StringValueSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "big-dec-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.BigDecSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.BigDecSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "big-int-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.BigIntSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.BigIntSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "boolean-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.BooleanSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.BooleanSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "boolean-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.BooleanValueSerializerSetup
+                                .class,
+                        BasicTypeSerializerUpgradeTestSpecifications.BooleanValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "byte-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.ByteSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.ByteSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "byte-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.ByteValueSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.ByteValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "char-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.CharSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.CharSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "char-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.CharValueSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.CharValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "date-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.DateSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.DateSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "double-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.DoubleSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.DoubleSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "double-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.DoubleValueSerializerSetup
+                                .class,
+                        BasicTypeSerializerUpgradeTestSpecifications.DoubleValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "float-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.FloatSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.FloatSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "float-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.FloatValueSerializerSetup
+                                .class,
+                        BasicTypeSerializerUpgradeTestSpecifications.FloatValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "int-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.IntSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.IntSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "int-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.IntValueSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.IntValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "long-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.LongSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.LongSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "long-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.LongValueSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.LongValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "null-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.NullValueSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.NullValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "short-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.ShortSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.ShortSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "short-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.ShortValueSerializerSetup
+                                .class,
+                        BasicTypeSerializerUpgradeTestSpecifications.ShortValueSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "sql-date-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.SqlDateSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.SqlDateSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "sql-time-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.SqlTimeSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.SqlTimeSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "sql-timestamp-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.SqlTimestampSerializerSetup
+                                .class,
+                        BasicTypeSerializerUpgradeTestSpecifications.SqlTimestampSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "string-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.StringSerializerSetup.class,
+                        BasicTypeSerializerUpgradeTestSpecifications.StringSerializerVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "string-value-serializer",
+                        flinkVersion,
+                        BasicTypeSerializerUpgradeTestSpecifications.StringValueSerializerSetup
+                                .class,
+                        BasicTypeSerializerUpgradeTestSpecifications.StringValueSerializerVerifier
+                                .class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java
index 2d1fff2b694..dd1f990f26f 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java
@@ -40,23 +40,22 @@ import static org.hamcrest.Matchers.is;
 class EnumSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<TestEnum, TestEnum> {
     private static final String SPEC_NAME = "enum-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            EnumSerializerSetup.class,
-                            EnumSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME + "reconfig",
-                            flinkVersion,
-                            EnumSerializerReconfigSetup.class,
-                            EnumSerializerReconfigVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        EnumSerializerSetup.class,
+                        EnumSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME + "reconfig",
+                        flinkVersion,
+                        EnumSerializerReconfigSetup.class,
+                        EnumSerializerReconfigVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/ListSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/ListSerializerUpgradeTest.java
index 30ee1165110..44c78477b82 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/ListSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/ListSerializerUpgradeTest.java
@@ -37,17 +37,16 @@ class ListSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<List<Strin
 
     private static final String SPEC_NAME = "list-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            ListSerializerSetup.class,
-                            ListSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        ListSerializerSetup.class,
+                        ListSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/MapSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/MapSerializerUpgradeTest.java
index 538e2910ac0..8a9b1881491 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/MapSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/MapSerializerUpgradeTest.java
@@ -39,17 +39,16 @@ class MapSerializerUpgradeTest
 
     private static final String SPEC_NAME = "map-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            MapSerializerSetup.class,
-                            MapSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        MapSerializerSetup.class,
+                        MapSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/array/PrimitiveArraySerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/array/PrimitiveArraySerializerUpgradeTest.java
index 2571b96e4d5..6bcf0262cd0 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/array/PrimitiveArraySerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/array/PrimitiveArraySerializerUpgradeTest.java
@@ -27,82 +27,81 @@ import java.util.Collection;
 /** Migration tests for primitive array type serializers' snapshots. */
 class PrimitiveArraySerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "boolean-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveBooleanArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveBooleanArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "byte-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveByteArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveByteArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "char-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveCharArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveCharArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "double-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveDoubleArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveDoubleArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "float-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveFloatArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveFloatArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "int-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveIntArraySetup
-                                    .class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveIntArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "long-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveLongArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveLongArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "short-primitive-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveShortArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveShortArrayVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "string-array-serializer",
-                            flinkVersion,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveStringArraySetup.class,
-                            PrimitiveArraySerializerUpgradeTestSpecifications
-                                    .PrimitiveStringArrayVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "boolean-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveBooleanArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications
+                                .PrimitiveBooleanArrayVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "byte-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveByteArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveByteArrayVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "char-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveCharArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveCharArrayVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "double-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveDoubleArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications
+                                .PrimitiveDoubleArrayVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "float-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveFloatArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications
+                                .PrimitiveFloatArrayVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "int-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveIntArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveIntArrayVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "long-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveLongArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveLongArrayVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "short-primitive-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveShortArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications
+                                .PrimitiveShortArrayVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "string-array-serializer",
+                        flinkVersion,
+                        PrimitiveArraySerializerUpgradeTestSpecifications.PrimitiveStringArraySetup
+                                .class,
+                        PrimitiveArraySerializerUpgradeTestSpecifications
+                                .PrimitiveStringArrayVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/CopyableSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/CopyableSerializerUpgradeTest.java
index 615504500fe..fb116b5e5ae 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/CopyableSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/CopyableSerializerUpgradeTest.java
@@ -42,16 +42,15 @@ import static org.hamcrest.Matchers.is;
 class CopyableSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<SimpleCopyable, SimpleCopyable> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "copyable-value-serializer",
-                            flinkVersion,
-                            CopyableSerializerSetup.class,
-                            CopyableSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "copyable-value-serializer",
+                        flinkVersion,
+                        CopyableSerializerSetup.class,
+                        CopyableSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/NullableSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/NullableSerializerUpgradeTest.java
index 300dca67033..8897db6f607 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/NullableSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/NullableSerializerUpgradeTest.java
@@ -35,24 +35,23 @@ import static org.hamcrest.CoreMatchers.is;
 /** A {@link TypeSerializerUpgradeTestBase} for {@link NullableSerializer}. */
 class NullableSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Long, Long> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "nullable-padded-serializer",
-                            flinkVersion,
-                            NullablePaddedSerializerSetup.class,
-                            NullablePaddedSerializerVerifier.class));
-
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "nullable-not-padded-serializer",
-                            flinkVersion,
-                            NullableNotPaddedSerializerSetup.class,
-                            NullableNotPaddedSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "nullable-padded-serializer",
+                        flinkVersion,
+                        NullablePaddedSerializerSetup.class,
+                        NullablePaddedSerializerVerifier.class));
+
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "nullable-not-padded-serializer",
+                        flinkVersion,
+                        NullableNotPaddedSerializerSetup.class,
+                        NullableNotPaddedSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/PojoSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/PojoSerializerUpgradeTest.java
index dbc357fde48..75a37c5d771 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/PojoSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/PojoSerializerUpgradeTest.java
@@ -28,8 +28,8 @@ import java.util.List;
 /** A {@link TypeSerializerUpgradeTestBase} for the {@link PojoSerializer}. */
 class PojoSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
-        ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
+    @Override
+    public Collection<FlinkVersion> getMigrationVersions() {
         // for PojoSerializer we also test against 1.7, 1.8, and 1.9 because we have snapshots
         // for this which go beyond what we have for the usual subclasses of
         // TypeSerializerUpgradeTestBase. We don't have snapshot data for 1.10, but the
@@ -38,87 +38,89 @@ class PojoSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Ob
         testVersions.add(FlinkVersion.v1_7);
         testVersions.add(FlinkVersion.v1_8);
         testVersions.add(FlinkVersion.v1_9);
-        testVersions.addAll(MIGRATION_VERSIONS);
-        for (FlinkVersion flinkVersion : testVersions) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-identical-schema",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications.IdenticalPojoSchemaSetup.class,
-                            PojoSerializerUpgradeTestSpecifications.IdenticalPojoSchemaVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-modified-schema",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications.ModifiedPojoSchemaSetup.class,
-                            PojoSerializerUpgradeTestSpecifications.ModifiedPojoSchemaVerifier
-                                    .class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-different-field-types",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .DifferentFieldTypePojoSchemaSetup.class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .DifferentFieldTypePojoSchemaVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-modified-schema-in-registered-subclass",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .ModifiedRegisteredPojoSubclassSchemaSetup.class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .ModifiedRegisteredPojoSubclassSchemaVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-different-field-types-in-registered-subclass",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .DifferentFieldTypePojoSubclassSchemaSetup.class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .DifferentFieldTypePojoSubclassSchemaVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-non-registered-subclass",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications.NonRegisteredPojoSubclassSetup
-                                    .class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .NonRegisteredPojoSubclassVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-different-subclass-registration-order",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .DifferentPojoSubclassRegistrationOrderSetup.class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .DifferentPojoSubclassRegistrationOrderVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-missing-registered-subclass",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .MissingRegisteredPojoSubclassSetup.class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .MissingRegisteredPojoSubclassVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-new-registered-subclass",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications.NewRegisteredPojoSubclassSetup
-                                    .class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .NewRegisteredPojoSubclassVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "pojo-serializer-with-new-and-missing-registered-subclasses",
-                            flinkVersion,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .NewAndMissingRegisteredPojoSubclassesSetup.class,
-                            PojoSerializerUpgradeTestSpecifications
-                                    .NewAndMissingRegisteredPojoSubclassesVerifier.class));
-        }
+        testVersions.addAll(super.getMigrationVersions());
+        return testVersions;
+    }
+
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
+        Collection<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-identical-schema",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications.IdenticalPojoSchemaSetup.class,
+                        PojoSerializerUpgradeTestSpecifications.IdenticalPojoSchemaVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-modified-schema",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications.ModifiedPojoSchemaSetup.class,
+                        PojoSerializerUpgradeTestSpecifications.ModifiedPojoSchemaVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-different-field-types",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications.DifferentFieldTypePojoSchemaSetup
+                                .class,
+                        PojoSerializerUpgradeTestSpecifications.DifferentFieldTypePojoSchemaVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-modified-schema-in-registered-subclass",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications
+                                .ModifiedRegisteredPojoSubclassSchemaSetup.class,
+                        PojoSerializerUpgradeTestSpecifications
+                                .ModifiedRegisteredPojoSubclassSchemaVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-different-field-types-in-registered-subclass",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications
+                                .DifferentFieldTypePojoSubclassSchemaSetup.class,
+                        PojoSerializerUpgradeTestSpecifications
+                                .DifferentFieldTypePojoSubclassSchemaVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-non-registered-subclass",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications.NonRegisteredPojoSubclassSetup
+                                .class,
+                        PojoSerializerUpgradeTestSpecifications.NonRegisteredPojoSubclassVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-different-subclass-registration-order",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications
+                                .DifferentPojoSubclassRegistrationOrderSetup.class,
+                        PojoSerializerUpgradeTestSpecifications
+                                .DifferentPojoSubclassRegistrationOrderVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-missing-registered-subclass",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications.MissingRegisteredPojoSubclassSetup
+                                .class,
+                        PojoSerializerUpgradeTestSpecifications
+                                .MissingRegisteredPojoSubclassVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-new-registered-subclass",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications.NewRegisteredPojoSubclassSetup
+                                .class,
+                        PojoSerializerUpgradeTestSpecifications.NewRegisteredPojoSubclassVerifier
+                                .class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "pojo-serializer-with-new-and-missing-registered-subclasses",
+                        flinkVersion,
+                        PojoSerializerUpgradeTestSpecifications
+                                .NewAndMissingRegisteredPojoSubclassesSetup.class,
+                        PojoSerializerUpgradeTestSpecifications
+                                .NewAndMissingRegisteredPojoSubclassesVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/RowSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/RowSerializerUpgradeTest.java
index fc9a40ca1a7..bbe2ab4fcf2 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/RowSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/RowSerializerUpgradeTest.java
@@ -34,6 +34,7 @@ import org.hamcrest.Matcher;
 
 import java.util.ArrayList;
 import java.util.Collection;
+import java.util.Collections;
 import java.util.List;
 
 import static org.hamcrest.Matchers.is;
@@ -42,23 +43,25 @@ import static org.hamcrest.Matchers.is;
 @VisibleForTesting
 public class RowSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Row, Row> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
-        ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
+    @Override
+    public Collection<FlinkVersion> getMigrationVersions() {
         // for RowSerializer we also test against 1.10 and newer because we have snapshots
         // for this which go beyond what we have for the usual subclasses of
         // TypeSerializerUpgradeTestBase
         List<FlinkVersion> testVersions = new ArrayList<>();
         testVersions.add(FlinkVersion.v1_10);
-        testVersions.addAll(MIGRATION_VERSIONS);
-        for (FlinkVersion flinkVersion : testVersions) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "row-serializer",
-                            flinkVersion,
-                            RowSerializerSetup.class,
-                            RowSerializerVerifier.class));
-        }
-        return testSpecifications;
+        testVersions.addAll(super.getMigrationVersions());
+        return testVersions;
+    }
+
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
+        return Collections.singletonList(
+                new TestSpecification<>(
+                        "row-serializer",
+                        flinkVersion,
+                        RowSerializerSetup.class,
+                        RowSerializerVerifier.class));
     }
 
     public static TypeSerializer<Row> createRowSerializer() {
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/TupleSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/TupleSerializerUpgradeTest.java
index 4785be4b63d..88b0fca7a7d 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/TupleSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/TupleSerializerUpgradeTest.java
@@ -39,17 +39,16 @@ class TupleSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<
                 Tuple3<String, String, Integer>, Tuple3<String, String, Integer>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "tuple-serializer",
-                            flinkVersion,
-                            TupleSerializerSetup.class,
-                            TupleSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "tuple-serializer",
+                        flinkVersion,
+                        TupleSerializerSetup.class,
+                        TupleSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/ValueSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/ValueSerializerUpgradeTest.java
index eda3aa76f3b..4eb75016221 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/ValueSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/ValueSerializerUpgradeTest.java
@@ -41,16 +41,15 @@ class ValueSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<
                 ValueSerializerUpgradeTest.NameValue, ValueSerializerUpgradeTest.NameValue> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "value-serializer",
-                            flinkVersion,
-                            ValueSerializerSetup.class,
-                            ValueSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "value-serializer",
+                        flinkVersion,
+                        ValueSerializerSetup.class,
+                        ValueSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerUpgradeTest.java
index 23acbd294dd..85eed047597 100644
--- a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerUpgradeTest.java
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/runtime/kryo/KryoSerializerUpgradeTest.java
@@ -43,34 +43,33 @@ import static org.hamcrest.Matchers.is;
 @SuppressWarnings("WeakerAccess")
 class KryoSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "kryo-type-serializer-empty-config",
-                            flinkVersion,
-                            KryoTypeSerializerEmptyConfigSetup.class,
-                            KryoTypeSerializerEmptyConfigVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "kryo-type-serializer-unrelated-config-after-restore",
-                            flinkVersion,
-                            KryoTypeSerializerEmptyConfigSetup.class,
-                            KryoTypeSerializerWithUnrelatedConfigVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "kryo-type-serializer-changed-registration-order",
-                            flinkVersion,
-                            KryoTypeSerializerChangedRegistrationOrderSetup.class,
-                            KryoTypeSerializerChangedRegistrationOrderVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "kryo-custom-type-serializer-changed-registration-order",
-                            flinkVersion,
-                            KryoCustomTypeSerializerChangedRegistrationOrderSetup.class,
-                            KryoCustomTypeSerializerChangedRegistrationOrderVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "kryo-type-serializer-empty-config",
+                        flinkVersion,
+                        KryoTypeSerializerEmptyConfigSetup.class,
+                        KryoTypeSerializerEmptyConfigVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "kryo-type-serializer-unrelated-config-after-restore",
+                        flinkVersion,
+                        KryoTypeSerializerEmptyConfigSetup.class,
+                        KryoTypeSerializerWithUnrelatedConfigVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "kryo-type-serializer-changed-registration-order",
+                        flinkVersion,
+                        KryoTypeSerializerChangedRegistrationOrderSetup.class,
+                        KryoTypeSerializerChangedRegistrationOrderVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "kryo-custom-type-serializer-changed-registration-order",
+                        flinkVersion,
+                        KryoCustomTypeSerializerChangedRegistrationOrderSetup.class,
+                        KryoCustomTypeSerializerChangedRegistrationOrderVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-core/src/test/resources/log4j2-test.properties b/flink-core/src/test/resources/log4j2-test.properties
index 3a8b6f23dc3..1566202ee85 100644
--- a/flink-core/src/test/resources/log4j2-test.properties
+++ b/flink-core/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-formats/flink-avro/pom.xml b/flink-formats/flink-avro/pom.xml
index 0bc19478397..0c8f0f26b55 100644
--- a/flink-formats/flink-avro/pom.xml
+++ b/flink-formats/flink-avro/pom.xml
@@ -176,6 +176,13 @@ under the License.
 			<type>test-jar</type>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 	</dependencies>
 
 	<build>
@@ -278,4 +285,47 @@ under the License.
 		</plugins>
 	</build>
 
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-formats/flink-avro/src/test/java/org/apache/flink/formats/avro/typeutils/AvroSerializerUpgradeTest.java b/flink-formats/flink-avro/src/test/java/org/apache/flink/formats/avro/typeutils/AvroSerializerUpgradeTest.java
index d9a599f78b2..443482fd087 100644
--- a/flink-formats/flink-avro/src/test/java/org/apache/flink/formats/avro/typeutils/AvroSerializerUpgradeTest.java
+++ b/flink-formats/flink-avro/src/test/java/org/apache/flink/formats/avro/typeutils/AvroSerializerUpgradeTest.java
@@ -37,23 +37,22 @@ import static org.hamcrest.Matchers.is;
 /** Tests based on {@link TypeSerializerUpgradeTestBase} for the {@link AvroSerializer}. */
 class AvroSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "generic-avro-serializer",
-                            flinkVersion,
-                            GenericAvroSerializerSetup.class,
-                            GenericAvroSerializerVerifier.class));
-
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "specific-avro-serializer",
-                            flinkVersion,
-                            SpecificAvroSerializerSetup.class,
-                            SpecificAvroSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "generic-avro-serializer",
+                        flinkVersion,
+                        GenericAvroSerializerSetup.class,
+                        GenericAvroSerializerVerifier.class));
+
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "specific-avro-serializer",
+                        flinkVersion,
+                        SpecificAvroSerializerSetup.class,
+                        SpecificAvroSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-formats/flink-avro/src/test/resources/log4j2-test.properties b/flink-formats/flink-avro/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..0e58bcd0c15 100644
--- a/flink-formats/flink-avro/src/test/resources/log4j2-test.properties
+++ b/flink-formats/flink-avro/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-fs-tests/pom.xml b/flink-fs-tests/pom.xml
index 79cee532e49..5cc60a47231 100644
--- a/flink-fs-tests/pom.xml
+++ b/flink-fs-tests/pom.xml
@@ -117,6 +117,13 @@ under the License.
 			<type>test-jar</type>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 		<dependency>
 			<groupId>org.apache.hadoop</groupId>
 			<artifactId>hadoop-hdfs</artifactId>
@@ -195,6 +202,48 @@ under the License.
 				</dependency>
 			</dependencies>
 		</profile>
+
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
 	</profiles>
 
 	<build>
diff --git a/flink-fs-tests/src/test/java/org/apache/flink/hdfstests/ContinuousFileProcessingMigrationTest.java b/flink-fs-tests/src/test/java/org/apache/flink/hdfstests/ContinuousFileProcessingMigrationTest.java
index 4dc76bd9d4a..643620eb3b4 100644
--- a/flink-fs-tests/src/test/java/org/apache/flink/hdfstests/ContinuousFileProcessingMigrationTest.java
+++ b/flink-fs-tests/src/test/java/org/apache/flink/hdfstests/ContinuousFileProcessingMigrationTest.java
@@ -41,6 +41,7 @@ import org.apache.flink.streaming.runtime.streamrecord.StreamRecord;
 import org.apache.flink.streaming.util.AbstractStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OneInputStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OperatorSnapshotUtil;
+import org.apache.flink.test.util.MigrationTest;
 import org.apache.flink.util.OperatingSystem;
 
 import org.apache.commons.io.FileUtils;
@@ -48,7 +49,6 @@ import org.junit.Assert;
 import org.junit.Assume;
 import org.junit.BeforeClass;
 import org.junit.ClassRule;
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.rules.TemporaryFolder;
 import org.junit.runner.RunWith;
@@ -57,49 +57,30 @@ import org.junit.runners.Parameterized;
 import java.io.File;
 import java.io.FileOutputStream;
 import java.io.IOException;
-import java.util.Arrays;
+import java.nio.file.Files;
+import java.nio.file.Paths;
 import java.util.Collection;
-
-import static org.apache.flink.util.Preconditions.checkNotNull;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
 
 /** Tests that verify the migration from previous Flink version snapshots. */
 @RunWith(Parameterized.class)
-public class ContinuousFileProcessingMigrationTest {
+public class ContinuousFileProcessingMigrationTest implements MigrationTest {
 
     private static final int LINES_PER_FILE = 10;
 
     private static final long INTERVAL = 100;
 
-    @Parameterized.Parameters(name = "Migration Savepoint / Mod Time: {0}")
-    public static Collection<Tuple2<FlinkVersion, Long>> parameters() {
-        return Arrays.asList(
-                Tuple2.of(FlinkVersion.v1_8, 1555215710000L),
-                Tuple2.of(FlinkVersion.v1_9, 1567499868000L),
-                Tuple2.of(FlinkVersion.v1_10, 1594559333000L),
-                Tuple2.of(FlinkVersion.v1_11, 1594561663000L),
-                Tuple2.of(FlinkVersion.v1_12, 1613720148000L),
-                Tuple2.of(FlinkVersion.v1_13, 1627550216000L),
-                Tuple2.of(FlinkVersion.v1_14, 1633938795000L),
-                Tuple2.of(FlinkVersion.v1_15, 1651918450000L),
-                Tuple2.of(FlinkVersion.v1_16, 1666860418000L),
-                Tuple2.of(FlinkVersion.v1_17, 1679595854026L));
+    @Parameterized.Parameters(name = "Migration Savepoint: {0}")
+    public static Collection<FlinkVersion> parameters() {
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_8, MigrationTest.getMostRecentlyPublishedVersion());
     }
 
-    /**
-     * TODO change this to the corresponding savepoint version to be written (e.g. {@link
-     * FlinkVersion#v1_3} for 1.3) TODO and remove all @Ignore annotations on write*Snapshot()
-     * methods to generate savepoints TODO Note: You should generate the savepoint based on the
-     * release branch instead of the master.
-     */
-    private final FlinkVersion flinkGenerateSavepointVersion = null;
-
     private final FlinkVersion testMigrateVersion;
-    private final Long expectedModTime;
 
-    public ContinuousFileProcessingMigrationTest(
-            Tuple2<FlinkVersion, Long> migrationVersionAndModTime) {
-        this.testMigrateVersion = migrationVersionAndModTime.f0;
-        this.expectedModTime = migrationVersionAndModTime.f1;
+    public ContinuousFileProcessingMigrationTest(FlinkVersion testMigrateVersion) {
+        this.testMigrateVersion = testMigrateVersion;
     }
 
     @ClassRule public static TemporaryFolder tempFolder = new TemporaryFolder();
@@ -111,12 +92,10 @@ public class ContinuousFileProcessingMigrationTest {
                 !OperatingSystem.isWindows());
     }
 
-    /** Manually run this to write binary snapshot data. Remove @Ignore to run. */
-    @Ignore
-    @Test
-    public void writeReaderSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeReaderSnapshot(FlinkVersion flinkGenerateSavepointVersion) throws Exception {
 
-        File testFolder = tempFolder.newFolder();
+        File testFolder = Files.createTempDirectory("tmpDirPrefix").toFile();
 
         TimestampedFileInputSplit split1 =
                 new TimestampedFileInputSplit(0, 3, new Path("test/test1"), 0, 100, null);
@@ -212,10 +191,9 @@ public class ContinuousFileProcessingMigrationTest {
         Assert.assertTrue(testHarness.getOutput().contains(new StreamRecord<>(split4)));
     }
 
-    /** Manually run this to write binary snapshot data. Remove @Ignore to run. */
-    @Ignore
-    @Test
-    public void writeMonitoringSourceSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeMonitoringSourceSnapshot(FlinkVersion flinkGenerateSavepointVersion)
+            throws Exception {
 
         File testFolder = tempFolder.newFolder();
 
@@ -310,17 +288,34 @@ public class ContinuousFileProcessingMigrationTest {
 
         testHarness.setup();
 
-        testHarness.initializeState(
-                OperatorSnapshotUtil.getResourceFilename(
-                        "monitoring-function-migration-test-"
-                                + expectedModTime
-                                + "-flink"
-                                + testMigrateVersion
-                                + "-snapshot"));
+        // Get the exact filename
+        Tuple2<String, Long> fileNameAndModTime = getResourceFilename(testMigrateVersion);
+
+        testHarness.initializeState(fileNameAndModTime.f0);
 
         testHarness.open();
 
-        Assert.assertEquals((long) expectedModTime, monitoringFunction.getGlobalModificationTime());
+        Assert.assertEquals(
+                fileNameAndModTime.f1.longValue(), monitoringFunction.getGlobalModificationTime());
+    }
+
+    private Tuple2<String, Long> getResourceFilename(FlinkVersion version) throws IOException {
+        String resourceDirectory = OperatorSnapshotUtil.getResourceFilename("");
+        Pattern fileNamePattern =
+                Pattern.compile(
+                        "monitoring-function-migration-test-(\\d+)-flink"
+                                + version.toString()
+                                + "-snapshot");
+
+        for (java.nio.file.Path file : Files.newDirectoryStream(Paths.get(resourceDirectory))) {
+            String fileName = file.getFileName().toString();
+            Matcher matcher = fileNamePattern.matcher(fileName);
+            if (matcher.matches()) {
+                return new Tuple2<>(file.toString(), Long.parseLong(matcher.group(1)));
+            }
+        }
+
+        throw new IllegalArgumentException("The snapshot for " + version + " not found");
     }
 
     private static class BlockingFileInputFormat extends FileInputFormat<FileInputSplit> {
@@ -413,17 +408,6 @@ public class ContinuousFileProcessingMigrationTest {
         return new Tuple2<>(file, str.toString());
     }
 
-    private FileInputSplit createSplitFromTimestampedSplit(TimestampedFileInputSplit split) {
-        checkNotNull(split);
-
-        return new FileInputSplit(
-                split.getSplitNumber(),
-                split.getPath(),
-                split.getStart(),
-                split.getLength(),
-                split.getHostnames());
-    }
-
     private OneInputStreamOperatorTestHarness<TimestampedFileInputSplit, FileInputSplit>
             createHarness(BlockingFileInputFormat format) throws Exception {
         ExecutionConfig config = new ExecutionConfig();
diff --git a/flink-fs-tests/src/test/resources/log4j2-test.properties b/flink-fs-tests/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..0e58bcd0c15 100644
--- a/flink-fs-tests/src/test/resources/log4j2-test.properties
+++ b/flink-fs-tests/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-libraries/flink-cep/pom.xml b/flink-libraries/flink-cep/pom.xml
index 8b9e179661f..4f8c4858414 100644
--- a/flink-libraries/flink-cep/pom.xml
+++ b/flink-libraries/flink-cep/pom.xml
@@ -95,6 +95,13 @@ under the License.
             <version>${project.version}</version>
             <scope>test</scope>
         </dependency>
+
+        <dependency>
+            <groupId>org.apache.flink</groupId>
+            <artifactId>fink-migration-test-utils</artifactId>
+            <version>${project.version}</version>
+            <scope>test</scope>
+        </dependency>
     </dependencies>
     
     <build>
@@ -112,4 +119,48 @@ under the License.
             </plugin>
         </plugins>
     </build>
+
+    <profiles>
+        <profile>
+            <id>generate-migration-test-data</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-antrun-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>generate-migration-test-data</id>
+                                <phase>package</phase>
+                                <goals>
+                                    <goal>run</goal>
+                                </goals>
+                                <configuration>
+                                    <target>
+                                        <condition property="optional.classes" value="--classes '${generate.classes}'"
+                                                   else="">
+                                            <isset property="generate.classes"/>
+                                        </condition>
+                                        <condition property="optional.prefixes"
+                                                   value="--prefixes '${generate.prefixes}'" else="">
+                                            <isset property="generate.prefixes"/>
+                                        </condition>
+                                        <java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+                                              fork="true" failonerror="true" dir="${project.basedir}">
+                                            <classpath refid="maven.test.classpath"/>
+                                            <arg value="--dir"/>
+                                            <arg line="${project.basedir}"/>
+                                            <arg value="--version"/>
+                                            <arg value="${generate.version}"/>
+                                            <arg line="${optional.classes}"/>
+                                            <arg line="${optional.prefixes}"/>
+                                        </java>
+                                    </target>
+                                </configuration>
+                            </execution>
+                        </executions>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>
diff --git a/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/NFASerializerUpgradeTest.java b/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/NFASerializerUpgradeTest.java
index 9d5152a414a..5b850cd1409 100644
--- a/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/NFASerializerUpgradeTest.java
+++ b/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/NFASerializerUpgradeTest.java
@@ -43,40 +43,39 @@ import static org.hamcrest.Matchers.is;
 /** Migration tests for NFA-related serializers. */
 class NFASerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "event-id-serializer",
-                            flinkVersion,
-                            EventIdSerializerSetup.class,
-                            EventIdSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "node-id-serializer",
-                            flinkVersion,
-                            NodeIdSerializerSetup.class,
-                            NodeIdSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "dewey-number-serializer",
-                            flinkVersion,
-                            DeweyNumberSerializerSetup.class,
-                            DeweyNumberSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "shared-buffer-edge-serializer",
-                            flinkVersion,
-                            SharedBufferEdgeSerializerSetup.class,
-                            SharedBufferEdgeSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "nfa-state-serializer",
-                            flinkVersion,
-                            NFAStateSerializerSetup.class,
-                            NFAStateSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "event-id-serializer",
+                        flinkVersion,
+                        EventIdSerializerSetup.class,
+                        EventIdSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "node-id-serializer",
+                        flinkVersion,
+                        NodeIdSerializerSetup.class,
+                        NodeIdSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "dewey-number-serializer",
+                        flinkVersion,
+                        DeweyNumberSerializerSetup.class,
+                        DeweyNumberSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "shared-buffer-edge-serializer",
+                        flinkVersion,
+                        SharedBufferEdgeSerializerSetup.class,
+                        SharedBufferEdgeSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "nfa-state-serializer",
+                        flinkVersion,
+                        NFAStateSerializerSetup.class,
+                        NFAStateSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/nfa/sharedbuffer/LockableTypeSerializerUpgradeTest.java b/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/nfa/sharedbuffer/LockableTypeSerializerUpgradeTest.java
index d65a06a58cf..166666da855 100644
--- a/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/nfa/sharedbuffer/LockableTypeSerializerUpgradeTest.java
+++ b/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/nfa/sharedbuffer/LockableTypeSerializerUpgradeTest.java
@@ -38,17 +38,16 @@ class LockableTypeSerializerUpgradeTest
 
     private static final String SPEC_NAME = "lockable-type-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            LockableTypeSerializerSetup.class,
-                            LockableTypeSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        LockableTypeSerializerSetup.class,
+                        LockableTypeSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/operator/CEPMigrationTest.java b/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/operator/CEPMigrationTest.java
index d6de6913933..54d323771b2 100644
--- a/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/operator/CEPMigrationTest.java
+++ b/flink-libraries/flink-cep/src/test/java/org/apache/flink/cep/operator/CEPMigrationTest.java
@@ -35,8 +35,8 @@ import org.apache.flink.streaming.runtime.streamrecord.StreamRecord;
 import org.apache.flink.streaming.util.KeyedOneInputStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OneInputStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OperatorSnapshotUtil;
+import org.apache.flink.test.util.MigrationTest;
 
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
@@ -57,31 +57,23 @@ import static org.junit.Assert.assertTrue;
  * write*()} method on the corresponding Flink release-* branch.
  */
 @RunWith(Parameterized.class)
-public class CEPMigrationTest {
-
-    /**
-     * TODO change this to the corresponding savepoint version to be written (e.g. {@link
-     * FlinkVersion#v1_3} for 1.3) TODO and remove all @Ignore annotations on write*Snapshot()
-     * methods to generate savepoints TODO Note: You should generate the savepoint based on the
-     * release branch instead of the master.
-     */
-    private final FlinkVersion flinkGenerateSavepointVersion = null;
+public class CEPMigrationTest implements MigrationTest {
 
     private final FlinkVersion migrateVersion;
 
     @Parameterized.Parameters(name = "Migration Savepoint: {0}")
     public static Collection<FlinkVersion> parameters() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_17);
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_8, MigrationTest.getMostRecentlyPublishedVersion());
     }
 
     public CEPMigrationTest(FlinkVersion migrateVersion) {
         this.migrateVersion = migrateVersion;
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeAfterBranchingPatternSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeAfterBranchingPatternSnapshot(FlinkVersion flinkGenerateSavepointVersion)
+            throws Exception {
 
         KeySelector<Event, Integer> keySelector =
                 new KeySelector<Event, Integer>() {
@@ -246,10 +238,9 @@ public class CEPMigrationTest {
         }
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeStartingNewPatternAfterMigrationSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeStartingNewPatternAfterMigrationSnapshot(
+            FlinkVersion flinkGenerateSavepointVersion) throws Exception {
 
         KeySelector<Event, Integer> keySelector =
                 new KeySelector<Event, Integer>() {
@@ -427,10 +418,9 @@ public class CEPMigrationTest {
         }
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeSinglePatternAfterMigrationSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeSinglePatternAfterMigrationSnapshot(FlinkVersion flinkGenerateSavepointVersion)
+            throws Exception {
 
         KeySelector<Event, Integer> keySelector =
                 new KeySelector<Event, Integer>() {
@@ -525,10 +515,9 @@ public class CEPMigrationTest {
         }
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeAndOrSubtypConditionsPatternAfterMigrationSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeAndOrSubtypConditionsPatternAfterMigrationSnapshot(
+            FlinkVersion flinkGenerateSavepointVersion) throws Exception {
 
         KeySelector<Event, Integer> keySelector =
                 new KeySelector<Event, Integer>() {
diff --git a/flink-libraries/flink-cep/src/test/resources/log4j2-test.properties b/flink-libraries/flink-cep/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..0e58bcd0c15 100644
--- a/flink-libraries/flink-cep/src/test/resources/log4j2-test.properties
+++ b/flink-libraries/flink-cep/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-runtime/pom.xml b/flink-runtime/pom.xml
index a205b471847..527011d1419 100644
--- a/flink-runtime/pom.xml
+++ b/flink-runtime/pom.xml
@@ -256,6 +256,13 @@ under the License.
 			<scope>test</scope>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 		<!-- Used only for additional logging. Optional because of unclear EPL 1.0 license compatibility. -->
 		<dependency>
 			<groupId>com.github.oshi</groupId>
@@ -382,4 +389,48 @@ under the License.
 			</plugin>
 		</plugins>
 	</build>
+
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/state/ArrayListSerializerUpgradeTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/state/ArrayListSerializerUpgradeTest.java
index 21f665c4ce6..6e988885cf9 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/state/ArrayListSerializerUpgradeTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/state/ArrayListSerializerUpgradeTest.java
@@ -38,16 +38,15 @@ class ArrayListSerializerUpgradeTest
 
     private static final String SPEC_NAME = "arraylist-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            ArrayListSerializerSetup.class,
-                            ArrayListSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        ArrayListSerializerSetup.class,
+                        ArrayListSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/state/JavaSerializerUpgradeTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/state/JavaSerializerUpgradeTest.java
index 5389037ccdc..7a81e16a55f 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/state/JavaSerializerUpgradeTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/state/JavaSerializerUpgradeTest.java
@@ -37,18 +37,17 @@ class JavaSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Serializab
 
     private static final String SPEC_NAME = "java-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
 
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            JavaSerializerSetup.class,
-                            JavaSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        JavaSerializerSetup.class,
+                        JavaSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/state/VoidNamespaceSerializerUpgradeTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/state/VoidNamespaceSerializerUpgradeTest.java
index c4909c6f6a4..abb5c469a57 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/state/VoidNamespaceSerializerUpgradeTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/state/VoidNamespaceSerializerUpgradeTest.java
@@ -37,17 +37,16 @@ class VoidNamespaceSerializerUpgradeTest
 
     private static final String SPEC_NAME = "void-namespace-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            VoidNamespaceSerializerSetup.class,
-                            VoidNamespaceSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        VoidNamespaceSerializerSetup.class,
+                        VoidNamespaceSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/state/ttl/TtlSerializerUpgradeTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/state/ttl/TtlSerializerUpgradeTest.java
index c2951aef246..9dedc8c27a1 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/state/ttl/TtlSerializerUpgradeTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/state/ttl/TtlSerializerUpgradeTest.java
@@ -39,17 +39,16 @@ import static org.hamcrest.Matchers.is;
 class TtlSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<TtlValue<String>, TtlValue<String>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "ttl-serializer",
-                            flinkVersion,
-                            TtlSerializerSetup.class,
-                            TtlSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "ttl-serializer",
+                        flinkVersion,
+                        TtlSerializerSetup.class,
+                        TtlSerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-runtime/src/test/resources/log4j2-test.properties b/flink-runtime/src/test/resources/log4j2-test.properties
index bbf1d4f09f0..12a0bc12a80 100644
--- a/flink-runtime/src/test/resources/log4j2-test.properties
+++ b/flink-runtime/src/test/resources/log4j2-test.properties
@@ -27,6 +27,9 @@ appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
 
-# Resource leak detetor only works with logging enabled at error level
+# Resource leak detector only works with logging enabled at error level
 logger.netty.name = org.apache.flink.shaded.netty4.io.netty.util.ResourceLeakDetector
 logger.netty.level = ERROR
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-scala/pom.xml b/flink-scala/pom.xml
index c06dd031b87..2ae22c36b83 100644
--- a/flink-scala/pom.xml
+++ b/flink-scala/pom.xml
@@ -118,6 +118,13 @@ under the License.
 			<scope>test</scope>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 	</dependencies>
 
 	<build>
@@ -278,4 +285,48 @@ under the License.
 
 		</plugins>
 	</build>
+
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/OptionSerializerUpgradeTest.java b/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/OptionSerializerUpgradeTest.java
index 1216fad83ce..36bb609be8e 100644
--- a/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/OptionSerializerUpgradeTest.java
+++ b/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/OptionSerializerUpgradeTest.java
@@ -43,17 +43,16 @@ class OptionSerializerUpgradeTest
 
     private static final String SPEC_NAME = "scala-option-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            ScalaOptionSerializerSetup.class,
-                            ScalaOptionSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        ScalaOptionSerializerSetup.class,
+                        ScalaOptionSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerUpgradeTest.java b/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerUpgradeTest.java
index ea017631648..a0df1fcb4e7 100644
--- a/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerUpgradeTest.java
+++ b/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerUpgradeTest.java
@@ -42,17 +42,16 @@ class ScalaEitherSerializerUpgradeTest
 
     private static final String SPEC_NAME = "scala-either-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            EitherSerializerSetup.class,
-                            EitherSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        EitherSerializerSetup.class,
+                        EitherSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaTrySerializerUpgradeTest.java b/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaTrySerializerUpgradeTest.java
index db9905542e2..dd6b5f4a043 100644
--- a/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaTrySerializerUpgradeTest.java
+++ b/flink-scala/src/test/java/org/apache/flink/api/scala/typeutils/ScalaTrySerializerUpgradeTest.java
@@ -43,17 +43,16 @@ class ScalaTrySerializerUpgradeTest
 
     private static final String SPEC_NAME = "scala-try-serializer";
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            SPEC_NAME,
-                            flinkVersion,
-                            ScalaTrySerializerSetup.class,
-                            ScalaTrySerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        SPEC_NAME,
+                        flinkVersion,
+                        ScalaTrySerializerSetup.class,
+                        ScalaTrySerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-scala/src/test/resources/log4j2-test.properties b/flink-scala/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..0e58bcd0c15 100644
--- a/flink-scala/src/test/resources/log4j2-test.properties
+++ b/flink-scala/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerUpgradeTest.scala b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerUpgradeTest.scala
index 78e53988399..228b9a4b288 100644
--- a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerUpgradeTest.scala
+++ b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerUpgradeTest.scala
@@ -31,18 +31,17 @@ import java.util
 class EnumValueSerializerUpgradeTest
   extends TypeSerializerUpgradeTestBase[Letters.Value, Letters.Value] {
 
-  override def createTestSpecifications(): util.Collection[TestSpecification[_, _]] = {
+  override def createTestSpecifications(
+      migrationVersion: FlinkVersion): util.Collection[TestSpecification[_, _]] = {
     val testSpecifications =
       new util.ArrayList[TypeSerializerUpgradeTestBase.TestSpecification[_, _]]
 
-    TypeSerializerUpgradeTestBase.MIGRATION_VERSIONS.forEach(
-      migrationVersion =>
-        testSpecifications.add(
-          new TypeSerializerUpgradeTestBase.TestSpecification[Letters.Value, Letters.Value](
-            "scala-enum-serializer",
-            migrationVersion,
-            classOf[EnumValueSerializerSetup],
-            classOf[EnumValueSerializerVerifier])))
+    testSpecifications.add(
+      new TypeSerializerUpgradeTestBase.TestSpecification[Letters.Value, Letters.Value](
+        "scala-enum-serializer",
+        migrationVersion,
+        classOf[EnumValueSerializerSetup],
+        classOf[EnumValueSerializerVerifier]))
 
     testSpecifications
   }
diff --git a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/ScalaCaseClassSerializerUpgradeTest.scala b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/ScalaCaseClassSerializerUpgradeTest.scala
index 74a922273d5..c50aa7c0f0d 100644
--- a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/ScalaCaseClassSerializerUpgradeTest.scala
+++ b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/ScalaCaseClassSerializerUpgradeTest.scala
@@ -34,17 +34,16 @@ import java.util
 class ScalaCaseClassSerializerUpgradeTest
   extends TypeSerializerUpgradeTestBase[CustomCaseClass, CustomCaseClass] {
 
-  override def createTestSpecifications(): util.Collection[TestSpecification[_, _]] = {
+  override def createTestSpecifications(
+      migrationVersion: FlinkVersion): util.Collection[TestSpecification[_, _]] = {
     val testSpecifications =
       new util.ArrayList[TypeSerializerUpgradeTestBase.TestSpecification[_, _]]
-    TypeSerializerUpgradeTestBase.MIGRATION_VERSIONS.forEach(
-      migrationVersion =>
-        testSpecifications.add(
-          new TypeSerializerUpgradeTestBase.TestSpecification[CustomCaseClass, CustomCaseClass](
-            "scala-case-class-serializer",
-            migrationVersion,
-            classOf[ScalaCaseClassSerializerSetup],
-            classOf[ScalaCaseClassSerializerVerifier])))
+    testSpecifications.add(
+      new TypeSerializerUpgradeTestBase.TestSpecification[CustomCaseClass, CustomCaseClass](
+        "scala-case-class-serializer",
+        migrationVersion,
+        classOf[ScalaCaseClassSerializerSetup],
+        classOf[ScalaCaseClassSerializerVerifier]))
 
     testSpecifications
   }
diff --git a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/TraversableSerializerUpgradeTest.scala b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/TraversableSerializerUpgradeTest.scala
index 0c10c75e56d..610beece36f 100644
--- a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/TraversableSerializerUpgradeTest.scala
+++ b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/TraversableSerializerUpgradeTest.scala
@@ -38,66 +38,65 @@ import scala.collection.{mutable, BitSet, LinearSeq}
 class TraversableSerializerUpgradeTest
   extends TypeSerializerUpgradeTestBase[TraversableOnce[_], TraversableOnce[_]] {
 
-  override def createTestSpecifications(): util.Collection[TestSpecification[_, _]] = {
+  override def createTestSpecifications(
+      migrationVersion: FlinkVersion): util.Collection[TestSpecification[_, _]] = {
     val testSpecifications =
       new util.ArrayList[TypeSerializerUpgradeTestBase.TestSpecification[_, _]]
-    TypeSerializerUpgradeTestBase.MIGRATION_VERSIONS.forEach(
-      migrationVersion => {
-        testSpecifications.add(
-          new TestSpecification[BitSet, BitSet](
-            "traversable-serializer-bitset",
-            migrationVersion,
-            classOf[BitsetSerializerSetup],
-            classOf[BitsetSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[IndexedSeq[Int], IndexedSeq[Int]](
-            "traversable-serializer-indexedseq",
-            migrationVersion,
-            classOf[IndexedSeqSerializerSetup],
-            classOf[IndexedSeqSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[LinearSeq[Int], LinearSeq[Int]](
-            "traversable-serializer-linearseq",
-            migrationVersion,
-            classOf[LinearSeqSerializerSetup],
-            classOf[LinearSeqSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[Map[String, Int], Map[String, Int]](
-            "traversable-serializer-map",
-            migrationVersion,
-            classOf[MapSerializerSetup],
-            classOf[MapSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[mutable.MutableList[Int], mutable.MutableList[Int]](
-            "traversable-serializer-mutable-list",
-            migrationVersion,
-            classOf[MutableListSerializerSetup],
-            classOf[MutableListSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[Seq[Int], Seq[Int]](
-            "traversable-serializer-seq",
-            migrationVersion,
-            classOf[SeqSerializerSetup],
-            classOf[SeqSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[Set[Int], Set[Int]](
-            "traversable-serializer-set",
-            migrationVersion,
-            classOf[SetSerializerSetup],
-            classOf[SetSerializerVerifier]))
-        testSpecifications.add(
-          new TestSpecification[Seq[(Int, String)], Seq[(Int, String)]](
-            "traversable-serializer-with-case-class",
-            migrationVersion,
-            classOf[SeqWithCaseClassSetup],
-            classOf[SeqWithCaseClassVerifier]))
-        testSpecifications.add(
-          new TestSpecification[Seq[Pojo], Seq[Pojo]](
-            "traversable-serializer-with-pojo",
-            migrationVersion,
-            classOf[SeqWithPojoSetup],
-            classOf[SeqWithPojoVerifier]))
-      })
+    testSpecifications.add(
+      new TestSpecification[BitSet, BitSet](
+        "traversable-serializer-bitset",
+        migrationVersion,
+        classOf[BitsetSerializerSetup],
+        classOf[BitsetSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[IndexedSeq[Int], IndexedSeq[Int]](
+        "traversable-serializer-indexedseq",
+        migrationVersion,
+        classOf[IndexedSeqSerializerSetup],
+        classOf[IndexedSeqSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[LinearSeq[Int], LinearSeq[Int]](
+        "traversable-serializer-linearseq",
+        migrationVersion,
+        classOf[LinearSeqSerializerSetup],
+        classOf[LinearSeqSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[Map[String, Int], Map[String, Int]](
+        "traversable-serializer-map",
+        migrationVersion,
+        classOf[MapSerializerSetup],
+        classOf[MapSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[mutable.MutableList[Int], mutable.MutableList[Int]](
+        "traversable-serializer-mutable-list",
+        migrationVersion,
+        classOf[MutableListSerializerSetup],
+        classOf[MutableListSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[Seq[Int], Seq[Int]](
+        "traversable-serializer-seq",
+        migrationVersion,
+        classOf[SeqSerializerSetup],
+        classOf[SeqSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[Set[Int], Set[Int]](
+        "traversable-serializer-set",
+        migrationVersion,
+        classOf[SetSerializerSetup],
+        classOf[SetSerializerVerifier]))
+    testSpecifications.add(
+      new TestSpecification[Seq[(Int, String)], Seq[(Int, String)]](
+        "traversable-serializer-with-case-class",
+        migrationVersion,
+        classOf[SeqWithCaseClassSetup],
+        classOf[SeqWithCaseClassVerifier]))
+    testSpecifications.add(
+      new TestSpecification[Seq[Pojo], Seq[Pojo]](
+        "traversable-serializer-with-pojo",
+        migrationVersion,
+        classOf[SeqWithPojoSetup],
+        classOf[SeqWithPojoVerifier]))
+
     testSpecifications
   }
 }
diff --git a/flink-streaming-java/pom.xml b/flink-streaming-java/pom.xml
index 5e9b80bd329..b0c215c2e3b 100644
--- a/flink-streaming-java/pom.xml
+++ b/flink-streaming-java/pom.xml
@@ -94,6 +94,13 @@ under the License.
 			<scope>test</scope>
 			<type>test-jar</type>
 		</dependency>
+
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
 	</dependencies>
 
 	<build>
@@ -112,4 +119,47 @@ under the License.
 		</plugins>
 	</build>
 
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/datastream/UnionSerializerUpgradeTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/datastream/UnionSerializerUpgradeTest.java
index 42360965213..1f500960e6b 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/datastream/UnionSerializerUpgradeTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/datastream/UnionSerializerUpgradeTest.java
@@ -40,22 +40,21 @@ class UnionSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<
                 TaggedUnion<String, Long>, TaggedUnion<String, Long>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "union-serializer-one",
-                            flinkVersion,
-                            UnionSerializerOneSetup.class,
-                            UnionSerializerOneVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "union-serializer-two",
-                            flinkVersion,
-                            UnionSerializerTwoSetup.class,
-                            UnionSerializerTwoVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "union-serializer-one",
+                        flinkVersion,
+                        UnionSerializerOneSetup.class,
+                        UnionSerializerOneVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "union-serializer-two",
+                        flinkVersion,
+                        UnionSerializerTwoSetup.class,
+                        UnionSerializerTwoVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkStateSerializerUpgradeTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkStateSerializerUpgradeTest.java
index f5b7fb6626f..0365e72a5c5 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkStateSerializerUpgradeTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkStateSerializerUpgradeTest.java
@@ -44,17 +44,16 @@ public class TwoPhaseCommitSinkStateSerializerUpgradeTest
                 TwoPhaseCommitSinkFunction.State<Integer, String>,
                 TwoPhaseCommitSinkFunction.State<Integer, String>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "two-phase-commit-sink-state-serializer",
-                            flinkVersion,
-                            TwoPhaseCommitSinkStateSerializerSetup.class,
-                            TwoPhaseCommitSinkStateSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "two-phase-commit-sink-state-serializer",
+                        flinkVersion,
+                        TwoPhaseCommitSinkStateSerializerSetup.class,
+                        TwoPhaseCommitSinkStateSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/TimerSerializerUpgradeTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/TimerSerializerUpgradeTest.java
index 7eb0523e509..4ce6184c7a5 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/TimerSerializerUpgradeTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/TimerSerializerUpgradeTest.java
@@ -37,17 +37,16 @@ class TimerSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<
                 TimerHeapInternalTimer<String, Integer>, TimerHeapInternalTimer<String, Integer>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "timer-serializer",
-                            flinkVersion,
-                            TimerSerializerSetup.class,
-                            TimerSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "timer-serializer",
+                        flinkVersion,
+                        TimerSerializerSetup.class,
+                        TimerSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/co/BufferEntrySerializerUpgradeTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/co/BufferEntrySerializerUpgradeTest.java
index 66c16916741..74a25d46502 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/co/BufferEntrySerializerUpgradeTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/co/BufferEntrySerializerUpgradeTest.java
@@ -39,17 +39,16 @@ import static org.hamcrest.Matchers.is;
 class BufferEntrySerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<BufferEntry<String>, BufferEntry<String>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "buffer-entry-serializer",
-                            flinkVersion,
-                            BufferEntrySerializerSetup.class,
-                            BufferEntrySerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "buffer-entry-serializer",
+                        flinkVersion,
+                        BufferEntrySerializerSetup.class,
+                        BufferEntrySerializerVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorMigrationTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorMigrationTest.java
index 7a7186eb1f1..fbf8437551f 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorMigrationTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperatorMigrationTest.java
@@ -54,9 +54,9 @@ import org.apache.flink.streaming.util.KeyedOneInputStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OneInputStreamOperatorTestHarness;
 import org.apache.flink.streaming.util.OperatorSnapshotUtil;
 import org.apache.flink.streaming.util.TestHarnessUtil;
+import org.apache.flink.test.util.MigrationTest;
 import org.apache.flink.util.Collector;
 
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
@@ -75,39 +75,28 @@ import static org.junit.Assert.fail;
  *
  * <p>This also checks whether {@link WindowOperator} can restore from a checkpoint of the aligned
  * processing-time windows operator of previous Flink versions.
- *
- * <p>For regenerating the binary snapshot file you have to run the {@code write*()} method on the
- * corresponding Flink release-* branch.
  */
 @RunWith(Parameterized.class)
-public class WindowOperatorMigrationTest {
+public class WindowOperatorMigrationTest implements MigrationTest {
 
     @Parameterized.Parameters(name = "Migration Savepoint: {0}")
     public static Collection<FlinkVersion> parameters() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_17);
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_8, MigrationTest.getMostRecentlyPublishedVersion());
     }
 
     private static final TypeInformation<Tuple2<String, Integer>> STRING_INT_TUPLE =
             TypeInformation.of(new TypeHint<Tuple2<String, Integer>>() {});
 
-    /**
-     * TODO change this to the corresponding savepoint version to be written (e.g. {@link
-     * FlinkVersion#v1_3} for 1.3) TODO and remove all @Ignore annotations on write*Snapshot()
-     * methods to generate savepoints TODO Note: You should generate the savepoint based on the
-     * release branch instead of the master.
-     */
-    private final FlinkVersion flinkGenerateSavepointVersion = null;
-
     private final FlinkVersion testMigrateVersion;
 
     public WindowOperatorMigrationTest(FlinkVersion testMigrateVersion) {
         this.testMigrateVersion = testMigrateVersion;
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeSessionWindowsWithCountTriggerSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeSessionWindowsWithCountTriggerSnapshot(
+            FlinkVersion flinkGenerateSavepointVersion) throws Exception {
         final int sessionSize = 3;
 
         ListStateDescriptor<Tuple2<String, Integer>> stateDesc =
@@ -236,10 +225,9 @@ public class WindowOperatorMigrationTest {
         testHarness.close();
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeSessionWindowsWithCountTriggerInMintConditionSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeSessionWindowsWithCountTriggerInMintConditionSnapshot(
+            FlinkVersion flinkGenerateSavepointVersion) throws Exception {
 
         final int sessionSize = 3;
 
@@ -374,10 +362,9 @@ public class WindowOperatorMigrationTest {
         testHarness.close();
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeReducingEventTimeWindowsSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeReducingEventTimeWindowsSnapshot(FlinkVersion flinkGenerateSavepointVersion)
+            throws Exception {
         final int windowSize = 3;
 
         ReducingStateDescriptor<Tuple2<String, Integer>> stateDesc =
@@ -527,10 +514,9 @@ public class WindowOperatorMigrationTest {
         testHarness.close();
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeApplyEventTimeWindowsSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeApplyEventTimeWindowsSnapshot(FlinkVersion flinkGenerateSavepointVersion)
+            throws Exception {
         final int windowSize = 3;
 
         ListStateDescriptor<Tuple2<String, Integer>> stateDesc =
@@ -676,10 +662,9 @@ public class WindowOperatorMigrationTest {
         testHarness.close();
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeReducingProcessingTimeWindowsSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeReducingProcessingTimeWindowsSnapshot(
+            FlinkVersion flinkGenerateSavepointVersion) throws Exception {
         final int windowSize = 3;
 
         ReducingStateDescriptor<Tuple2<String, Integer>> stateDesc =
@@ -815,10 +800,9 @@ public class WindowOperatorMigrationTest {
         testHarness.close();
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeApplyProcessingTimeWindowsSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeApplyProcessingTimeWindowsSnapshot(FlinkVersion flinkGenerateSavepointVersion)
+            throws Exception {
         final int windowSize = 3;
 
         ListStateDescriptor<Tuple2<String, Integer>> stateDesc =
@@ -950,10 +934,9 @@ public class WindowOperatorMigrationTest {
         testHarness.close();
     }
 
-    /** Manually run this to write binary snapshot data. */
-    @Ignore
-    @Test
-    public void writeWindowsWithKryoSerializedKeysSnapshot() throws Exception {
+    @SnapshotsGenerator
+    public void writeWindowsWithKryoSerializedKeysSnapshot(
+            FlinkVersion flinkGenerateSavepointVersion) throws Exception {
         final int windowSize = 3;
 
         TypeInformation<Tuple2<NonPojoType, Integer>> inputType =
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowSerializerUpgradeTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowSerializerUpgradeTest.java
index e24421ebc29..c60a7267a67 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowSerializerUpgradeTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/operators/windowing/WindowSerializerUpgradeTest.java
@@ -39,23 +39,22 @@ import static org.hamcrest.Matchers.is;
  */
 class WindowSerializerUpgradeTest extends TypeSerializerUpgradeTestBase<Object, Object> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "time-window-serializer",
-                            flinkVersion,
-                            TimeWindowSerializerSetup.class,
-                            TimeWindowSerializerVerifier.class));
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "global-window-serializer",
-                            flinkVersion,
-                            GlobalWindowSerializerSetup.class,
-                            GlobalWindowSerializerVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "time-window-serializer",
+                        flinkVersion,
+                        TimeWindowSerializerSetup.class,
+                        TimeWindowSerializerVerifier.class));
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "global-window-serializer",
+                        flinkVersion,
+                        GlobalWindowSerializerSetup.class,
+                        GlobalWindowSerializerVerifier.class));
         return testSpecifications;
     }
 
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerUpgradeTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerUpgradeTest.java
index 721b40e5c1b..3348c7f3e02 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerUpgradeTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerUpgradeTest.java
@@ -37,17 +37,16 @@ import static org.hamcrest.Matchers.is;
 class StreamElementSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<StreamElement, StreamElement> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() throws Exception {
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
 
         ArrayList<TestSpecification<?, ?>> testSpecifications = new ArrayList<>();
-        for (FlinkVersion flinkVersion : MIGRATION_VERSIONS) {
-            testSpecifications.add(
-                    new TestSpecification<>(
-                            "stream-element-serializer",
-                            flinkVersion,
-                            StreamElementSetup.class,
-                            StreamElementVerifier.class));
-        }
+        testSpecifications.add(
+                new TestSpecification<>(
+                        "stream-element-serializer",
+                        flinkVersion,
+                        StreamElementSetup.class,
+                        StreamElementVerifier.class));
 
         return testSpecifications;
     }
diff --git a/flink-streaming-java/src/test/resources/log4j2-test.properties b/flink-streaming-java/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..0e58bcd0c15 100644
--- a/flink-streaming-java/src/test/resources/log4j2-test.properties
+++ b/flink-streaming-java/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-table/flink-table-runtime/pom.xml b/flink-table/flink-table-runtime/pom.xml
index f4a66dabf18..de60fed50f8 100644
--- a/flink-table/flink-table-runtime/pom.xml
+++ b/flink-table/flink-table-runtime/pom.xml
@@ -118,6 +118,13 @@ under the License.
 			<type>test-jar</type>
 			<scope>test</scope>
 		</dependency>
+
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
 	</dependencies>
 
 	<build>
@@ -170,4 +177,48 @@ under the License.
 			</plugin>
 		</plugins>
 	</build>
+
+	<profiles>
+		<profile>
+			<id>generate-migration-test-data</id>
+			<build>
+				<plugins>
+					<plugin>
+						<artifactId>maven-antrun-plugin</artifactId>
+						<executions>
+							<execution>
+								<id>generate-migration-test-data</id>
+								<phase>package</phase>
+								<goals>
+									<goal>run</goal>
+								</goals>
+								<configuration>
+									<target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+										<java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+											  fork="true" failonerror="true" dir="${project.basedir}">
+											<classpath refid="maven.test.classpath"/>
+											<arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+											<arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+										</java>
+									</target>
+								</configuration>
+							</execution>
+						</executions>
+					</plugin>
+				</plugins>
+			</build>
+		</profile>
+	</profiles>
 </project>
diff --git a/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializerUpgradeTest.java b/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializerUpgradeTest.java
index b53e9c687f7..988c3ddd7df 100644
--- a/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializerUpgradeTest.java
+++ b/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializerUpgradeTest.java
@@ -25,13 +25,13 @@ import org.apache.flink.api.common.typeutils.TypeSerializerMatchers;
 import org.apache.flink.api.common.typeutils.TypeSerializerSchemaCompatibility;
 import org.apache.flink.api.common.typeutils.TypeSerializerUpgradeTestBase;
 import org.apache.flink.api.common.typeutils.base.LongSerializer;
-import org.apache.flink.util.FlinkRuntimeException;
+import org.apache.flink.test.util.MigrationTest;
 
 import org.hamcrest.Matcher;
 
 import java.util.Collection;
+import java.util.Collections;
 import java.util.LinkedList;
-import java.util.stream.Collectors;
 
 import static org.hamcrest.Matchers.is;
 
@@ -40,21 +40,20 @@ import static org.hamcrest.Matchers.is;
 public class LinkedListSerializerUpgradeTest
         extends TypeSerializerUpgradeTestBase<LinkedList<Long>, LinkedList<Long>> {
 
-    public Collection<TestSpecification<?, ?>> createTestSpecifications() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_13, CURRENT_VERSION).stream()
-                .map(
-                        version -> {
-                            try {
-                                return new TestSpecification<>(
-                                        "linked-list-serializer",
-                                        version,
-                                        LinkedListSerializerSetup.class,
-                                        LinkedListSerializerVerifier.class);
-                            } catch (Exception e) {
-                                throw new FlinkRuntimeException(e);
-                            }
-                        })
-                .collect(Collectors.toList());
+    @Override
+    public Collection<FlinkVersion> getMigrationVersions() {
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_13, MigrationTest.getMostRecentlyPublishedVersion());
+    }
+
+    public Collection<TestSpecification<?, ?>> createTestSpecifications(FlinkVersion flinkVersion)
+            throws Exception {
+        return Collections.singletonList(
+                new TestSpecification<>(
+                        "linked-list-serializer",
+                        flinkVersion,
+                        LinkedListSerializerSetup.class,
+                        LinkedListSerializerVerifier.class));
     }
 
     public static TypeSerializer<LinkedList<Long>> createLinkedListSerializer() {
diff --git a/flink-table/flink-table-runtime/src/test/resources/log4j2-test.properties b/flink-table/flink-table-runtime/src/test/resources/log4j2-test.properties
index 835c2ec9a3d..465aad61b5b 100644
--- a/flink-table/flink-table-runtime/src/test/resources/log4j2-test.properties
+++ b/flink-table/flink-table-runtime/src/test/resources/log4j2-test.properties
@@ -26,3 +26,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
\ No newline at end of file
diff --git a/flink-test-utils-parent/flink-migration-test-utils/README.md b/flink-test-utils-parent/flink-migration-test-utils/README.md
new file mode 100644
index 00000000000..9ec4c059116
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/README.md
@@ -0,0 +1,99 @@
+# Add State Migration Tests
+
+This module collects tools that help to generate test data for the state migration tests.
+
+The following dependency needs to be added to the module's Maven config in case a
+migration test is meant to be added to that module:
+
+```xml
+<dependency>
+    <groupId>org.apache.flink</groupId>
+    <artifactId>fink-migration-test-utils</artifactId>
+    <version>${project.version}</version>
+    <scope>test</scope>
+</dependency>
+```
+
+and the following profile
+
+```xml
+<profile>
+    <id>generate-migration-test-data</id>
+    <build>
+        <plugins>
+            <plugin>
+                <artifactId>maven-antrun-plugin</artifactId>
+                <executions>
+                    <execution>
+                        <id>generate-migration-test-data</id>
+                        <phase>package</phase>
+                        <goals>
+                            <goal>run</goal>
+                        </goals>
+                        <configuration>
+                            <target>
+                                <condition property="optional.classes" value="--classes '${generate.classes}'"
+                                           else="">
+                                    <isset property="generate.classes"/>
+                                </condition>
+                                <condition property="optional.prefixes"
+                                           value="--prefixes '${generate.prefixes}'" else="">
+                                    <isset property="generate.prefixes"/>
+                                </condition>
+                                <java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+                                      fork="true" failonerror="true" dir="${project.basedir}">
+                                    <classpath refid="maven.test.classpath"/>
+                                    <arg value="--dir"/>
+                                    <arg line="${project.basedir}"/>
+                                    <arg value="--version"/>
+                                    <arg value="${generate.version}"/>
+                                    <arg line="${optional.classes}"/>
+                                    <arg line="${optional.prefixes}"/>
+                                </java>
+                            </target>
+                        </configuration>
+                    </execution>
+                </executions>
+            </plugin>
+        </plugins>
+    </build>
+</profile>
+```
+
+To show the log during generating, add
+
+```
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
+```
+
+to the `log4j2-test.properties` of this module.
+
+The state migration tests should satisfy
+
+1. The tests are named like `*(Test|ITCase).(java|scala)`.
+2. The test class name is the same with the file name.
+3. The test implements `org.apache.flink.test.util.MigrationTest` and the snapshots generator methods are labeled
+   with `@SnapshotsGenerator` or `@ParameterizedSnapshotsGenerator`.
+
+# Generating Snapshots
+
+To generate the snapshots for all the tests,
+execute from within the target version's release branch:
+
+```shell
+mvn clean package -Pgenerate-migration-test-data -Dgenerate.version=1.17 -nsu -Dfast -DskipTests
+```
+
+The version (`1.17` in the command above) should be replaced with the target one.
+
+By default, it will search for the migration tests under `src/test/java` and `src/test/scala`. It is also supported
+to change the default search paths or only generate for specific classes:
+
+```shell
+# Change the default search paths
+mvn clean package -Pgenerate-migration-test-data -Dgenerate.prefixes=xx,yy,zz -Dgenerate.version=1.17 -nsu -Dfast -DskipTests
+
+# Generate for the specified classes
+mvn clean package -Pgenerate-migration-test-data -Dgenerate.classes=class1,class2 -Dgenerate.version=1.17 -nsu -Dfast -DskipTests
+```
\ No newline at end of file
diff --git a/flink-test-utils-parent/flink-migration-test-utils/pom.xml b/flink-test-utils-parent/flink-migration-test-utils/pom.xml
new file mode 100644
index 00000000000..e0f191f8c15
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/pom.xml
@@ -0,0 +1,53 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+Licensed to the Apache Software Foundation (ASF) under one
+or more contributor license agreements.  See the NOTICE file
+distributed with this work for additional information
+regarding copyright ownership.  The ASF licenses this file
+to you under the Apache License, Version 2.0 (the
+"License"); you may not use this file except in compliance
+with the License.  You may obtain a copy of the License at
+
+  http://www.apache.org/licenses/LICENSE-2.0
+
+Unless required by applicable law or agreed to in writing,
+software distributed under the License is distributed on an
+"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+KIND, either express or implied.  See the License for the
+specific language governing permissions and limitations
+under the License.
+-->
+<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+
+    <modelVersion>4.0.0</modelVersion>
+
+    <parent>
+        <groupId>org.apache.flink</groupId>
+        <artifactId>flink-test-utils-parent</artifactId>
+        <version>1.18-SNAPSHOT</version>
+    </parent>
+
+    <artifactId>fink-migration-test-utils</artifactId>
+    <name>Flink : Test utils : MigrationTestUtils</name>
+
+    <packaging>jar</packaging>
+
+    <dependencies>
+        <dependency>
+            <groupId>org.apache.flink</groupId>
+            <artifactId>flink-annotations</artifactId>
+            <version>${project.version}</version>
+        </dependency>
+
+        <dependency>
+            <groupId>org.junit.vintage</groupId>
+            <artifactId>junit-vintage-engine</artifactId>
+        </dependency>
+
+        <dependency>
+            <groupId>commons-cli</groupId>
+            <artifactId>commons-cli</artifactId>
+        </dependency>
+    </dependencies>
+</project>
diff --git a/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/MigrationTestsSnapshotGenerator.java b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/MigrationTestsSnapshotGenerator.java
new file mode 100644
index 00000000000..320f88dbf3e
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/MigrationTestsSnapshotGenerator.java
@@ -0,0 +1,253 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.test.migration;
+
+import org.apache.flink.FlinkVersion;
+import org.apache.flink.test.util.MigrationTest;
+
+import org.apache.commons.cli.CommandLine;
+import org.apache.commons.cli.CommandLineParser;
+import org.apache.commons.cli.DefaultParser;
+import org.apache.commons.cli.HelpFormatter;
+import org.apache.commons.cli.Option;
+import org.apache.commons.cli.Options;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+import java.io.File;
+import java.io.FileNotFoundException;
+import java.nio.file.DirectoryStream;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.regex.Matcher;
+import java.util.regex.Pattern;
+
+/**
+ * This class aims to generate the snapshots for all the state migration tests. A migration test
+ * should implement {@link MigrationTest} interface and its name should match {@code
+ * *(Test|ITCase)(.java|.scala)}. For scala tests, we also require the class name is the same with
+ * the containing filename.
+ */
+public class MigrationTestsSnapshotGenerator {
+
+    private static final Logger LOG =
+            LoggerFactory.getLogger(MigrationTestsSnapshotGenerator.class);
+
+    private static final String DEFAULT_PATH_PREFIXES = "src/test/java,src/test/scala";
+
+    private static final Option OPTION_HELP =
+            Option.builder()
+                    .longOpt("help")
+                    .required(false)
+                    .hasArg(false)
+                    .desc("print this help information.")
+                    .build();
+
+    private static final Option OPTION_DIR =
+            Option.builder()
+                    .longOpt("dir")
+                    .required()
+                    .hasArg()
+                    .desc("The root directory for scanning. Required.")
+                    .build();
+
+    private static final Option OPTION_VERSION =
+            Option.builder()
+                    .longOpt("version")
+                    .required()
+                    .hasArg()
+                    .desc("The version to generate. Required.")
+                    .build();
+
+    private static final Option OPTION_PREFIXES =
+            Option.builder()
+                    .longOpt("prefixes")
+                    .required(false)
+                    .hasArg()
+                    .desc(
+                            "The prefix paths to scan under the root directory, separated by \",\". Default to \""
+                                    + DEFAULT_PATH_PREFIXES
+                                    + "\"")
+                    .build();
+
+    private static final Option OPTION_CLASSES =
+            Option.builder()
+                    .longOpt("classes")
+                    .required(false)
+                    .hasArg()
+                    .desc(
+                            "The specified qualified class name to generate test data, "
+                                    + "separated by \",\". This option has a higher priority than the prefix option.")
+                    .build();
+
+    private static final Pattern VERSION_PATTERN = Pattern.compile("v?([0-9]+)[._]([0-9]+)");
+
+    private static final String CLASS_NAME_GROUP = "className";
+    private static final Pattern CLASS_NAME_PATTERN =
+            Pattern.compile("(?<" + CLASS_NAME_GROUP + ">[a-zA-Z0-9]*(Test|ITCase))(.java|.scala)");
+
+    public static void main(String[] args) throws Throwable {
+        // Detect for --help first. We cannot directly use the command
+        // line parser since it always detects the required options.
+        for (String s : args) {
+            if (s.equals("--" + OPTION_HELP.getLongOpt())) {
+                HelpFormatter helpFormatter = new HelpFormatter();
+                helpFormatter.setOptionComparator(null);
+                helpFormatter.printHelp(
+                        "java " + MigrationTestsSnapshotGenerator.class.getName(), createOptions());
+                return;
+            }
+        }
+
+        Options options = createOptions();
+        CommandLineParser parser = new DefaultParser();
+        CommandLine commandLine = parser.parse(options, args);
+
+        File rootDirectory = new File(commandLine.getOptionValue(OPTION_DIR));
+        if (!rootDirectory.exists() || !rootDirectory.isDirectory()) {
+            throw new FileNotFoundException(
+                    rootDirectory + " does not exist or is not a directory.");
+        }
+
+        String versionName = commandLine.getOptionValue(OPTION_VERSION);
+        Matcher versionMatcher = VERSION_PATTERN.matcher(versionName);
+        if (!versionMatcher.matches()) {
+            throw new IllegalArgumentException(
+                    "Version "
+                            + versionName
+                            + "could not be parsed, "
+                            + "please specify the version with format like 1.17, 1_17, v1_17, v1.17");
+        }
+        FlinkVersion version =
+                FlinkVersion.valueOf(
+                        Integer.parseInt(versionMatcher.group(1)),
+                        Integer.parseInt(versionMatcher.group(2)));
+
+        LOG.info("Start test data generating for module {} and version {}", rootDirectory, version);
+        List<Class<?>> migrationTests;
+        if (commandLine.hasOption(OPTION_CLASSES)) {
+            migrationTests =
+                    loadSpecifiedMigrationTests(
+                            commandLine.getOptionValue(OPTION_CLASSES).split(",\\s*"));
+        } else {
+            String[] prefixes =
+                    commandLine
+                            .getOptionValue(OPTION_PREFIXES, DEFAULT_PATH_PREFIXES)
+                            .split(",\\s*");
+            migrationTests = findMigrationTests(rootDirectory.getAbsolutePath(), prefixes);
+        }
+
+        for (Class<?> migrationTestClass : migrationTests) {
+            LOG.info("Start test data generating for {}", migrationTestClass.getName());
+            SnapshotGeneratorUtils.executeGenerate(migrationTestClass, version);
+            LOG.info("Finish test data generating for {}", migrationTestClass.getName());
+        }
+    }
+
+    private static Options createOptions() {
+        Options options = new Options();
+
+        // The root directory for the scanning
+        options.addOption(OPTION_HELP);
+        options.addOption(OPTION_DIR);
+        options.addOption(OPTION_VERSION);
+        options.addOption(OPTION_PREFIXES);
+        options.addOption(OPTION_CLASSES);
+        return options;
+    }
+
+    private static List<Class<?>> loadSpecifiedMigrationTests(String[] specifiedClassNames)
+            throws Exception {
+        List<Class<?>> migrationTestClasses = new ArrayList<>();
+        for (String name : specifiedClassNames) {
+            try {
+                Class<?> clazz = Class.forName(name);
+                if (MigrationTest.class.isAssignableFrom(clazz)) {
+                    migrationTestClasses.add(clazz);
+                }
+            } catch (ClassNotFoundException e) {
+                LOG.warn("Class " + name + " does not exist.");
+            }
+        }
+        return migrationTestClasses;
+    }
+
+    private static List<Class<?>> findMigrationTests(String rootDirectory, String[] prefixes)
+            throws Exception {
+        List<Class<?>> migrationTestClasses = new ArrayList<>();
+        for (String prefix : prefixes) {
+            recursivelyFindMigrationTests(rootDirectory, prefix, "", migrationTestClasses);
+        }
+
+        return migrationTestClasses;
+    }
+
+    private static void recursivelyFindMigrationTests(
+            String rootDirectory, String prefix, String packageName, List<Class<?>> result)
+            throws Exception {
+        File codeDirectory = new File(rootDirectory + File.separator + prefix);
+        if (!codeDirectory.exists()) {
+            LOG.debug("{} doesn't exist and will be skipped.", codeDirectory);
+            return;
+        }
+
+        // Search all the directories
+        try (DirectoryStream<Path> stream = Files.newDirectoryStream(codeDirectory.toPath())) {
+            for (Path entry : stream) {
+                File file = entry.toFile();
+                if (file.isDirectory()) {
+                    recursivelyFindMigrationTests(
+                            rootDirectory,
+                            prefix + File.separator + file.getName(),
+                            qualifiedName(packageName, file.getName()),
+                            result);
+                } else {
+                    Matcher m = CLASS_NAME_PATTERN.matcher(file.getName());
+                    if (m.matches()) {
+                        String className = qualifiedName(packageName, m.group(CLASS_NAME_GROUP));
+
+                        // We require the class name to match the file name
+                        // for both java and scala.
+                        try {
+                            Class<?> clazz =
+                                    Class.forName(
+                                            className,
+                                            false,
+                                            MigrationTestsSnapshotGenerator.class.getClassLoader());
+                            if (MigrationTest.class.isAssignableFrom(clazz)) {
+                                result.add(Class.forName(className));
+                            }
+                        } catch (ClassNotFoundException e) {
+                            LOG.warn(
+                                    "The class "
+                                            + className
+                                            + " is not found, which might be excluded from the classpath.");
+                        }
+                    }
+                }
+            }
+        }
+    }
+
+    private static String qualifiedName(String packageName, String simpleName) {
+        return packageName.isEmpty() ? simpleName : packageName + "." + simpleName;
+    }
+}
diff --git a/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/PublishedVersionUtils.java b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/PublishedVersionUtils.java
new file mode 100644
index 00000000000..844338cadf4
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/PublishedVersionUtils.java
@@ -0,0 +1,48 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.test.migration;
+
+import org.apache.flink.FlinkVersion;
+
+import java.io.BufferedReader;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.util.Objects;
+
+/** Utilities for update and read the most-recently published flink version. */
+public class PublishedVersionUtils {
+
+    private static final String MOST_RECENTLY_PUBLISHED_VERSION_FILE =
+            "most_recently_published_version";
+
+    public static FlinkVersion getMostRecentlyPublishedVersion() {
+        try (InputStream input =
+                        Objects.requireNonNull(
+                                PublishedVersionUtils.class.getResourceAsStream(
+                                        "/" + MOST_RECENTLY_PUBLISHED_VERSION_FILE),
+                                "The most-recently published version file does not exist");
+                BufferedReader reader = new BufferedReader(new InputStreamReader(input))) {
+            String versionName = reader.readLine();
+            return FlinkVersion.valueOf(versionName);
+        } catch (IOException e) {
+            throw new RuntimeException("Failed to parse the latest published version", e);
+        }
+    }
+}
diff --git a/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/SnapshotGeneratorUtils.java b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/SnapshotGeneratorUtils.java
new file mode 100644
index 00000000000..bf13d98752d
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/migration/SnapshotGeneratorUtils.java
@@ -0,0 +1,181 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.test.migration;
+
+import org.apache.flink.FlinkVersion;
+import org.apache.flink.test.util.MigrationTest;
+
+import org.junit.ClassRule;
+import org.junit.Rule;
+import org.junit.rules.ExternalResource;
+import org.junit.rules.RunRules;
+import org.junit.rules.TestRule;
+import org.junit.runner.Description;
+import org.junit.runners.Parameterized;
+import org.junit.runners.model.Statement;
+
+import java.lang.annotation.Annotation;
+import java.lang.reflect.Array;
+import java.lang.reflect.Constructor;
+import java.lang.reflect.Field;
+import java.lang.reflect.Method;
+import java.lang.reflect.Modifier;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.List;
+
+/** A utility class to execute generateSnapshots method for migration tests. */
+class SnapshotGeneratorUtils {
+
+    static void executeGenerate(Class<?> migrationTestClass, FlinkVersion flinkVersion)
+            throws Throwable {
+        for (Method method : migrationTestClass.getMethods()) {
+            if (method.isAnnotationPresent(MigrationTest.SnapshotsGenerator.class)) {
+                executeGenerateMethods(migrationTestClass, method, flinkVersion);
+            } else if (method.isAnnotationPresent(
+                    MigrationTest.ParameterizedSnapshotsGenerator.class)) {
+                String parametersMethodName =
+                        method.getAnnotation(MigrationTest.ParameterizedSnapshotsGenerator.class)
+                                .value();
+                Method parametersMethod =
+                        migrationTestClass.getMethod(parametersMethodName, FlinkVersion.class);
+                executeParameterizedGenerateMethods(
+                        migrationTestClass, method, parametersMethod, flinkVersion);
+            }
+        }
+    }
+
+    private static void executeGenerateMethods(
+            Class<?> migrationTestClass, Method method, FlinkVersion version) throws Throwable {
+        method.setAccessible(true);
+        List<TestRule> classRules = getRuleFields(migrationTestClass, ClassRule.class, null);
+
+        executeWithRules(
+                classRules,
+                new Statement() {
+                    @Override
+                    public void evaluate() throws Throwable {
+                        Object migrationTest = createMigrationTest(migrationTestClass);
+                        List<TestRule> rules =
+                                getRuleFields(migrationTestClass, Rule.class, migrationTest);
+                        executeWithRules(
+                                rules,
+                                new Statement() {
+                                    @Override
+                                    public void evaluate() throws Throwable {
+                                        method.invoke(migrationTest, version);
+                                    }
+                                });
+                    }
+                });
+    }
+
+    private static void executeParameterizedGenerateMethods(
+            Class<?> migrationTestClass,
+            Method method,
+            Method parametersMethod,
+            FlinkVersion version)
+            throws Throwable {
+        method.setAccessible(true);
+        parametersMethod.setAccessible(true);
+        List<TestRule> classRules = getRuleFields(migrationTestClass, ClassRule.class, null);
+
+        executeWithRules(
+                classRules,
+                new Statement() {
+                    @Override
+                    public void evaluate() throws Throwable {
+                        Object migrationTest = createMigrationTest(migrationTestClass);
+                        List<TestRule> rules =
+                                getRuleFields(migrationTestClass, Rule.class, migrationTest);
+                        Collection<?> arguments =
+                                (Collection<?>) parametersMethod.invoke(migrationTest, version);
+                        for (Object argument : arguments) {
+                            executeWithRules(
+                                    rules,
+                                    new Statement() {
+                                        @Override
+                                        public void evaluate() throws Throwable {
+                                            method.invoke(migrationTest, argument);
+                                        }
+                                    });
+                        }
+                    }
+                });
+    }
+
+    private static void executeWithRules(List<TestRule> rules, Statement statement)
+            throws Throwable {
+        new RunRules(statement, rules, Description.EMPTY).evaluate();
+    }
+
+    private static List<TestRule> getRuleFields(
+            Class<?> migrationTestClass, Class<? extends Annotation> tagClass, Object migrationTest)
+            throws IllegalAccessException {
+        List<TestRule> rules = new ArrayList<>();
+
+        Field[] fields = migrationTestClass.getFields();
+        for (Field field : fields) {
+            if (ExternalResource.class.isAssignableFrom(field.getType())
+                    && field.isAnnotationPresent(tagClass)) {
+                field.setAccessible(true);
+                rules.add((ExternalResource) field.get(migrationTest));
+            }
+        }
+
+        return rules;
+    }
+
+    private static Object createMigrationTest(Class<?> migrationTestClass) throws Exception {
+        Constructor<?>[] constructors = migrationTestClass.getDeclaredConstructors();
+        for (Constructor<?> constructor : constructors) {
+            if (constructor.getParameterCount() == 0) {
+                constructor.setAccessible(true);
+                return constructor.newInstance();
+            }
+        }
+
+        // This class does not have a constructor without argument.
+        Constructor<?> constructor = constructors[0];
+        constructor.setAccessible(true);
+
+        // Check if we could find method labeled with @Parameterized.Parameters
+        for (Method method : migrationTestClass.getMethods()) {
+            if (Modifier.isStatic(method.getModifiers())
+                    && method.isAnnotationPresent(Parameterized.Parameters.class)) {
+                Object argumentLists = method.invoke(null);
+                if (argumentLists instanceof Collection) {
+                    return constructor.newInstance(
+                            ((Collection<?>) argumentLists).iterator().next());
+                } else if (argumentLists.getClass().isArray()) {
+                    return constructor.newInstance(Array.get(argumentLists, 0));
+                } else {
+                    throw new RuntimeException(
+                            "Failed to create parameterized class object due to argument lists type not supported: "
+                                    + argumentLists.getClass());
+                }
+            }
+        }
+
+        throw new RuntimeException(
+                "Could not create the object for "
+                        + migrationTestClass
+                        + ": No default constructor or @Parameterized.Parameters method found.");
+    }
+}
diff --git a/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/util/MigrationTest.java b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/util/MigrationTest.java
new file mode 100644
index 00000000000..c54d7e9cb57
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/src/main/java/org/apache/flink/test/util/MigrationTest.java
@@ -0,0 +1,70 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.test.util;
+
+import org.apache.flink.FlinkVersion;
+import org.apache.flink.test.migration.PublishedVersionUtils;
+
+import java.lang.annotation.ElementType;
+import java.lang.annotation.Retention;
+import java.lang.annotation.RetentionPolicy;
+import java.lang.annotation.Target;
+
+/** Interface for state migration tests. */
+public interface MigrationTest {
+
+    static FlinkVersion getMostRecentlyPublishedVersion() {
+        return PublishedVersionUtils.getMostRecentlyPublishedVersion();
+    }
+
+    /**
+     * Marks a method as snapshots generator. The method should be like
+     *
+     * <pre>
+     * {@literal @}SnapshotsGenerator
+     * void function(FlinkVersion version) {}
+     * </pre>
+     */
+    @Retention(RetentionPolicy.RUNTIME)
+    @Target(ElementType.METHOD)
+    @interface SnapshotsGenerator {}
+
+    /**
+     * Marks a method as parameterized snapshots generator. The value should be the method that
+     * returns Collection of arguments.
+     *
+     * <p>The method generating parameters should be like
+     *
+     * <pre>
+     * Collection<?> generateMethodParameters(FlinkVersion version) {}
+     * </pre>
+     *
+     * <p>The generator method should be like
+     *
+     * <pre>
+     * {@literal @}ParameterizedSnapshotsGenerator("generateMethodParameters")
+     * void function(T parameter) {}
+     * </pre>
+     */
+    @Retention(RetentionPolicy.RUNTIME)
+    @Target(ElementType.METHOD)
+    @interface ParameterizedSnapshotsGenerator {
+        String value();
+    }
+}
diff --git a/flink-test-utils-parent/flink-migration-test-utils/src/main/resources/most_recently_published_version b/flink-test-utils-parent/flink-migration-test-utils/src/main/resources/most_recently_published_version
new file mode 100644
index 00000000000..af046b521d6
--- /dev/null
+++ b/flink-test-utils-parent/flink-migration-test-utils/src/main/resources/most_recently_published_version
@@ -0,0 +1 @@
+v1_17
\ No newline at end of file
diff --git a/flink-test-utils-parent/pom.xml b/flink-test-utils-parent/pom.xml
index d2c56bfe6d0..56dbec750f2 100644
--- a/flink-test-utils-parent/pom.xml
+++ b/flink-test-utils-parent/pom.xml
@@ -39,6 +39,7 @@ under the License.
 		<module>flink-test-utils</module>
 		<module>flink-connector-test-utils</module>
 		<module>flink-clients-test-utils</module>
+		<module>flink-migration-test-utils</module>
 	</modules>
 
 </project>
diff --git a/flink-tests/pom.xml b/flink-tests/pom.xml
index 3d8b3ea89a1..9b9d1ca791a 100644
--- a/flink-tests/pom.xml
+++ b/flink-tests/pom.xml
@@ -283,6 +283,13 @@ under the License.
 			<scope>test</scope>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>fink-migration-test-utils</artifactId>
+			<version>${project.version}</version>
+			<scope>test</scope>
+		</dependency>
+
 		<!-- utility to scan classpaths -->
 		<dependency>
 			<groupId>org.reflections</groupId>
@@ -696,4 +703,48 @@ under the License.
 			</plugin>
 		</plugins>
 	</build>
+
+    <profiles>
+        <profile>
+            <id>generate-migration-test-data</id>
+            <build>
+                <plugins>
+                    <plugin>
+                        <artifactId>maven-antrun-plugin</artifactId>
+                        <executions>
+                            <execution>
+                                <id>generate-migration-test-data</id>
+                                <phase>package</phase>
+                                <goals>
+                                    <goal>run</goal>
+                                </goals>
+                                <configuration>
+                                    <target>
+										<condition property="optional.classes" value="--classes '${generate.classes}'"
+												   else="">
+											<isset property="generate.classes"/>
+										</condition>
+										<condition property="optional.prefixes"
+												   value="--prefixes '${generate.prefixes}'" else="">
+											<isset property="generate.prefixes"/>
+										</condition>
+                                        <java classname="org.apache.flink.test.migration.MigrationTestsSnapshotGenerator"
+                                              fork="true" failonerror="true" dir="${project.basedir}">
+                                            <classpath refid="maven.test.classpath"/>
+                                            <arg value="--dir"/>
+											<arg line="${project.basedir}"/>
+											<arg value="--version"/>
+                                            <arg value="${generate.version}"/>
+											<arg line="${optional.classes}"/>
+											<arg line="${optional.prefixes}"/>
+                                        </java>
+                                    </target>
+                                </configuration>
+                            </execution>
+                        </executions>
+                    </plugin>
+                </plugins>
+            </build>
+        </profile>
+    </profiles>
 </project>
diff --git a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobSnapshotMigrationITCase.java b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobSnapshotMigrationITCase.java
index 9a74ae25c13..b055b3a1dca 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobSnapshotMigrationITCase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobSnapshotMigrationITCase.java
@@ -43,14 +43,18 @@ import org.apache.flink.streaming.api.watermark.Watermark;
 import org.apache.flink.streaming.runtime.streamrecord.StreamRecord;
 import org.apache.flink.test.checkpointing.utils.MigrationTestUtils;
 import org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase;
+import org.apache.flink.test.util.MigrationTest;
 import org.apache.flink.util.Collector;
 
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
 
+import javax.annotation.Nullable;
+
 import java.util.Collection;
 import java.util.LinkedList;
+import java.util.function.BiFunction;
 import java.util.stream.Collectors;
 
 import static org.junit.Assert.assertEquals;
@@ -60,62 +64,82 @@ import static org.junit.Assert.assertEquals;
  * previous Flink versions, as well as for different state backends.
  */
 @RunWith(Parameterized.class)
-public class StatefulJobSnapshotMigrationITCase extends SnapshotMigrationTestBase {
+public class StatefulJobSnapshotMigrationITCase extends SnapshotMigrationTestBase
+        implements MigrationTest {
 
     private static final int NUM_SOURCE_ELEMENTS = 4;
 
-    // TODO increase this to newer version to create and test snapshot migration for newer versions
-    private static final FlinkVersion currentVersion = FlinkVersion.v1_17;
+    @Parameterized.Parameters(name = "Test snapshot: {0}")
+    public static Collection<SnapshotSpec> createSpecsForTestRuns() {
+        return internalParameters(null);
+    }
+
+    public static Collection<SnapshotSpec> createSpecsForTestDataGeneration(
+            FlinkVersion targetVersion) {
+        return internalParameters(targetVersion);
+    }
 
-    // TODO change this to CREATE_SNAPSHOT to (re)create binary snapshots
-    // TODO Note: You should generate the snapshot based on the release branch instead of the
-    // master.
-    private static final ExecutionMode executionMode = ExecutionMode.VERIFY_SNAPSHOT;
+    private static Collection<SnapshotSpec> internalParameters(
+            @Nullable FlinkVersion targetGeneratingVersion) {
+        BiFunction<FlinkVersion, FlinkVersion, Collection<FlinkVersion>> getFlinkVersions =
+                (minInclVersion, maxInclVersion) -> {
+                    if (targetGeneratingVersion != null) {
+                        return FlinkVersion.rangeOf(minInclVersion, maxInclVersion).stream()
+                                .filter(v -> v.equals(targetGeneratingVersion))
+                                .collect(Collectors.toList());
+                    } else {
+                        return FlinkVersion.rangeOf(minInclVersion, maxInclVersion);
+                    }
+                };
 
-    @Parameterized.Parameters(name = "Test snapshot: {0}")
-    public static Collection<SnapshotSpec> parameters() {
         Collection<SnapshotSpec> parameters = new LinkedList<>();
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.MEMORY_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_CANONICAL,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_14)));
+                        getFlinkVersions.apply(FlinkVersion.v1_8, FlinkVersion.v1_14)));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_CANONICAL,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_CANONICAL,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_8, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_8,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_NATIVE,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_NATIVE,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
                         SnapshotType.CHECKPOINT,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
                         SnapshotType.CHECKPOINT,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
-        if (executionMode == ExecutionMode.CREATE_SNAPSHOT) {
-            parameters =
-                    parameters.stream()
-                            .filter(x -> x.getFlinkVersion().equals(currentVersion))
-                            .collect(Collectors.toList());
-        }
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         return parameters;
     }
 
@@ -125,8 +149,18 @@ public class StatefulJobSnapshotMigrationITCase extends SnapshotMigrationTestBas
         this.snapshotSpec = snapshotSpec;
     }
 
+    @ParameterizedSnapshotsGenerator("createSpecsForTestDataGeneration")
+    public void generateSnapshots(SnapshotSpec snapshotSpec) throws Exception {
+        testOrCreateSavepoint(ExecutionMode.CREATE_SNAPSHOT, snapshotSpec);
+    }
+
     @Test
     public void testSavepoint() throws Exception {
+        testOrCreateSavepoint(ExecutionMode.VERIFY_SNAPSHOT, snapshotSpec);
+    }
+
+    private void testOrCreateSavepoint(ExecutionMode executionMode, SnapshotSpec snapshotSpec)
+            throws Exception {
 
         final int parallelism = 4;
 
diff --git a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobWBroadcastStateMigrationITCase.java b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobWBroadcastStateMigrationITCase.java
index c73910846db..aad555cf1f5 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobWBroadcastStateMigrationITCase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/StatefulJobWBroadcastStateMigrationITCase.java
@@ -36,6 +36,7 @@ import org.apache.flink.streaming.api.functions.co.KeyedBroadcastProcessFunction
 import org.apache.flink.streaming.api.functions.source.SourceFunction;
 import org.apache.flink.test.checkpointing.utils.MigrationTestUtils;
 import org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase;
+import org.apache.flink.test.util.MigrationTest;
 import org.apache.flink.util.Collector;
 
 import org.junit.Assert;
@@ -43,10 +44,13 @@ import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
 
+import javax.annotation.Nullable;
+
 import java.util.Collection;
 import java.util.HashMap;
 import java.util.LinkedList;
 import java.util.Map;
+import java.util.function.BiFunction;
 import java.util.stream.Collectors;
 
 /**
@@ -55,62 +59,82 @@ import java.util.stream.Collectors;
  * state backends.
  */
 @RunWith(Parameterized.class)
-public class StatefulJobWBroadcastStateMigrationITCase extends SnapshotMigrationTestBase {
+public class StatefulJobWBroadcastStateMigrationITCase extends SnapshotMigrationTestBase
+        implements MigrationTest {
 
     private static final int NUM_SOURCE_ELEMENTS = 4;
 
-    // TODO increase this to newer version to create and test snapshot migration for newer versions
-    private static final FlinkVersion currentVersion = FlinkVersion.v1_17;
+    @Parameterized.Parameters(name = "Test snapshot: {0}")
+    public static Collection<SnapshotSpec> createSpecsForTestRuns() {
+        return internalParameters(null);
+    }
+
+    public static Collection<SnapshotSpec> createSpecsForTestDataGeneration(
+            FlinkVersion targetVersion) {
+        return internalParameters(targetVersion);
+    }
 
-    // TODO change this to CREATE_SNAPSHOT to (re)create binary snapshots
-    // TODO Note: You should generate the snapshot based on the release branch instead of the
-    // master.
-    private static final ExecutionMode executionMode = ExecutionMode.VERIFY_SNAPSHOT;
+    private static Collection<SnapshotSpec> internalParameters(
+            @Nullable FlinkVersion targetGeneratingVersion) {
+        BiFunction<FlinkVersion, FlinkVersion, Collection<FlinkVersion>> getFlinkVersions =
+                (minInclVersion, maxInclVersion) -> {
+                    if (targetGeneratingVersion != null) {
+                        return FlinkVersion.rangeOf(minInclVersion, maxInclVersion).stream()
+                                .filter(v -> v.equals(targetGeneratingVersion))
+                                .collect(Collectors.toList());
+                    } else {
+                        return FlinkVersion.rangeOf(minInclVersion, maxInclVersion);
+                    }
+                };
 
-    @Parameterized.Parameters(name = "Test snapshot: {0}")
-    public static Collection<SnapshotSpec> parameters() {
         Collection<SnapshotSpec> parameters = new LinkedList<>();
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.MEMORY_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_CANONICAL,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_14)));
+                        getFlinkVersions.apply(FlinkVersion.v1_8, FlinkVersion.v1_14)));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_CANONICAL,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_CANONICAL,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_8, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_8,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_NATIVE,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
                         SnapshotType.SAVEPOINT_NATIVE,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
                         SnapshotType.CHECKPOINT,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         parameters.addAll(
                 SnapshotSpec.withVersions(
                         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
                         SnapshotType.CHECKPOINT,
-                        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)));
-        if (executionMode == ExecutionMode.CREATE_SNAPSHOT) {
-            parameters =
-                    parameters.stream()
-                            .filter(x -> x.getFlinkVersion().equals(currentVersion))
-                            .collect(Collectors.toList());
-        }
+                        getFlinkVersions.apply(
+                                FlinkVersion.v1_15,
+                                MigrationTest.getMostRecentlyPublishedVersion())));
         return parameters;
     }
 
@@ -120,9 +144,18 @@ public class StatefulJobWBroadcastStateMigrationITCase extends SnapshotMigration
         this.snapshotSpec = snapshotSpec;
     }
 
+    @ParameterizedSnapshotsGenerator("createSpecsForTestDataGeneration")
+    public void generateSnapshots(SnapshotSpec snapshotSpec) throws Exception {
+        testOrCreateSavepoint(ExecutionMode.CREATE_SNAPSHOT, snapshotSpec);
+    }
+
     @Test
     public void testSavepoint() throws Exception {
+        testOrCreateSavepoint(ExecutionMode.VERIFY_SNAPSHOT, snapshotSpec);
+    }
 
+    private void testOrCreateSavepoint(ExecutionMode executionMode, SnapshotSpec snapshotSpec)
+            throws Exception {
         final int parallelism = 4;
 
         final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/AbstractOperatorRestoreTestBase.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/AbstractOperatorRestoreTestBase.java
index 7c90f9b4f70..f31826d2bd7 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/AbstractOperatorRestoreTestBase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/AbstractOperatorRestoreTestBase.java
@@ -18,6 +18,7 @@
 
 package org.apache.flink.test.state.operator.restore;
 
+import org.apache.flink.FlinkVersion;
 import org.apache.flink.api.common.JobStatus;
 import org.apache.flink.api.common.restartstrategy.RestartStrategies;
 import org.apache.flink.api.common.time.Deadline;
@@ -32,6 +33,7 @@ import org.apache.flink.runtime.testutils.MiniClusterResourceConfiguration;
 import org.apache.flink.streaming.api.CheckpointingMode;
 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
 import org.apache.flink.streaming.api.graph.StreamingJobGraphGenerator;
+import org.apache.flink.test.util.MigrationTest;
 import org.apache.flink.test.util.MiniClusterWithClientResource;
 import org.apache.flink.testutils.TestingUtils;
 import org.apache.flink.testutils.executor.TestExecutorResource;
@@ -45,10 +47,17 @@ import org.junit.ClassRule;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.rules.TemporaryFolder;
+import org.junit.runners.Parameterized;
 
 import java.io.File;
+import java.net.URI;
 import java.net.URL;
+import java.nio.file.DirectoryStream;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.nio.file.Paths;
 import java.time.Duration;
+import java.util.Collection;
 import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.ScheduledExecutorService;
 import java.util.concurrent.TimeUnit;
@@ -68,10 +77,17 @@ import static org.junit.Assert.assertNotNull;
  * Modify the job topology, and restore from the savepoint created in step 1.
  *
  * <p>The savepoint _metadata file for the current branch is stored in the savepointPath in {@link
- * AbstractOperatorRestoreTestBase#migrateJob}, please create the corresponding test resource
- * directory and copy the _metadata file by hand.
+ * AbstractOperatorRestoreTestBase#migrateJob}.
  */
-public abstract class AbstractOperatorRestoreTestBase extends TestLogger {
+public abstract class AbstractOperatorRestoreTestBase extends TestLogger implements MigrationTest {
+
+    private final FlinkVersion flinkVersion;
+
+    @Parameterized.Parameters(name = "Migrate Savepoint: {0}")
+    public static Collection<FlinkVersion> parameters() {
+        return FlinkVersion.rangeOf(
+                FlinkVersion.v1_8, MigrationTest.getMostRecentlyPublishedVersion());
+    }
 
     @ClassRule
     public static final TestExecutorResource<ScheduledExecutorService> EXECUTOR_RESOURCE =
@@ -104,16 +120,33 @@ public abstract class AbstractOperatorRestoreTestBase extends TestLogger {
                             .setNumberSlotsPerTaskManager(NUM_SLOTS_PER_TM)
                             .build());
 
-    private final boolean allowNonRestoredState;
     private final ScheduledExecutor scheduledExecutor =
             new ScheduledExecutorServiceAdapter(EXECUTOR_RESOURCE.getExecutor());
 
-    protected AbstractOperatorRestoreTestBase() {
-        this(true);
+    protected AbstractOperatorRestoreTestBase(FlinkVersion flinkVersion) {
+        this.flinkVersion = flinkVersion;
     }
 
-    protected AbstractOperatorRestoreTestBase(boolean allowNonRestoredState) {
-        this.allowNonRestoredState = allowNonRestoredState;
+    protected void internalGenerateSnapshots(FlinkVersion targetVersion) throws Exception {
+        ClusterClient<?> clusterClient = cluster.getClusterClient();
+        final Deadline deadline = Deadline.now().plus(TEST_TIMEOUT);
+
+        // Submit job with old version savepoint and create a migrated savepoint in the new version.
+        // Any old version is ok, and we choose 1.8 directly.
+        String savepointPath = migrateJob(FlinkVersion.v1_8, clusterClient, deadline);
+
+        Path targetPath = getSavepointPath(targetVersion);
+        Files.createDirectories(targetPath);
+
+        // copy the savepoint to the given directory
+        try (DirectoryStream<Path> childrenFiles =
+                Files.newDirectoryStream(Paths.get(new URI(savepointPath)))) {
+            for (Path filePath : childrenFiles) {
+                Files.copy(
+                        filePath,
+                        Paths.get(targetPath.toString(), filePath.getFileName().toString()));
+            }
+        }
     }
 
     @Test
@@ -122,17 +155,20 @@ public abstract class AbstractOperatorRestoreTestBase extends TestLogger {
         final Deadline deadline = Deadline.now().plus(TEST_TIMEOUT);
 
         // submit job with old version savepoint and create a migrated savepoint in the new version
-        String savepointPath = migrateJob(clusterClient, deadline);
+        String savepointPath = migrateJob(flinkVersion, clusterClient, deadline);
+
         // restore from migrated new version savepoint
         restoreJob(clusterClient, deadline, savepointPath);
     }
 
-    private String migrateJob(ClusterClient<?> clusterClient, Deadline deadline) throws Throwable {
+    private String migrateJob(
+            FlinkVersion flinkVersion, ClusterClient<?> clusterClient, Deadline deadline)
+            throws Exception {
 
         URL savepointResource =
                 AbstractOperatorRestoreTestBase.class
                         .getClassLoader()
-                        .getResource("operatorstate/" + getMigrationSavepointName());
+                        .getResource("operatorstate/" + getMigrationSavepointName(flinkVersion));
         if (savepointResource == null) {
             throw new IllegalArgumentException("Savepoint file does not exist.");
         }
@@ -201,7 +237,7 @@ public abstract class AbstractOperatorRestoreTestBase extends TestLogger {
             throws Exception {
         JobGraph jobToRestore = createJobGraph(ExecutionMode.RESTORE);
         jobToRestore.setSavepointRestoreSettings(
-                SavepointRestoreSettings.forPath(savepointPath, allowNonRestoredState));
+                SavepointRestoreSettings.forPath(savepointPath, true));
 
         assertNotNull("Job doesn't have a JobID.", jobToRestore.getJobID());
 
@@ -237,6 +273,12 @@ public abstract class AbstractOperatorRestoreTestBase extends TestLogger {
         return StreamingJobGraphGenerator.createJobGraph(env.getStreamGraph());
     }
 
+    private Path getSavepointPath(FlinkVersion version) {
+        return Paths.get(
+                System.getProperty("user.dir"),
+                "src/test/resources/operatorstate/" + getMigrationSavepointName(version));
+    }
+
     /**
      * Recreates the job used to create the new version savepoint.
      *
@@ -256,7 +298,7 @@ public abstract class AbstractOperatorRestoreTestBase extends TestLogger {
      *
      * @return savepoint directory to use
      */
-    protected abstract String getMigrationSavepointName();
+    protected abstract String getMigrationSavepointName(FlinkVersion version);
 
     private static String escapeRegexCharacters(String string) {
         return string.replaceAll("\\(", "\\\\(").replaceAll("\\)", "\\\\)");
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/AbstractKeyedOperatorRestoreTestBase.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/AbstractKeyedOperatorRestoreTestBase.java
index 6f63d3e3b2c..fdc85b298b5 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/AbstractKeyedOperatorRestoreTestBase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/AbstractKeyedOperatorRestoreTestBase.java
@@ -28,21 +28,12 @@ import org.apache.flink.test.state.operator.restore.ExecutionMode;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
 
-import java.util.Collection;
-
 /** Base class for all keyed operator restore tests. */
 @RunWith(Parameterized.class)
 public abstract class AbstractKeyedOperatorRestoreTestBase extends AbstractOperatorRestoreTestBase {
 
-    private final FlinkVersion flinkVersion;
-
-    @Parameterized.Parameters(name = "Migrate Savepoint: {0}")
-    public static Collection<FlinkVersion> parameters() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_17);
-    }
-
     public AbstractKeyedOperatorRestoreTestBase(FlinkVersion flinkVersion) {
-        this.flinkVersion = flinkVersion;
+        super(flinkVersion);
     }
 
     @Override
@@ -62,7 +53,7 @@ public abstract class AbstractKeyedOperatorRestoreTestBase extends AbstractOpera
     }
 
     @Override
-    protected String getMigrationSavepointName() {
+    protected String getMigrationSavepointName(FlinkVersion flinkVersion) {
         return "complexKeyed-flink" + flinkVersion;
     }
 }
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/KeyedComplexChainTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/KeyedComplexChainTest.java
index 04939a6f45c..98150aca70c 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/KeyedComplexChainTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/keyed/KeyedComplexChainTest.java
@@ -31,6 +31,11 @@ public class KeyedComplexChainTest extends AbstractKeyedOperatorRestoreTestBase
         super(flinkVersion);
     }
 
+    @SnapshotsGenerator
+    public void generateSnapshots(FlinkVersion targetVersion) throws Exception {
+        internalGenerateSnapshots(targetVersion);
+    }
+
     @Override
     protected void createRestoredJob(StreamExecutionEnvironment env) {
         /** Source -> keyBy -> C(Window -> StatefulMap2) -> StatefulMap1 */
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/AbstractNonKeyedOperatorRestoreTestBase.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/AbstractNonKeyedOperatorRestoreTestBase.java
index 26a68d92dae..eb5af92c2d4 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/AbstractNonKeyedOperatorRestoreTestBase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/AbstractNonKeyedOperatorRestoreTestBase.java
@@ -28,8 +28,6 @@ import org.apache.flink.test.state.operator.restore.ExecutionMode;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
 
-import java.util.Collection;
-
 import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.createFirstStatefulMap;
 import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.createSecondStatefulMap;
 import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.createSource;
@@ -41,21 +39,8 @@ import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.c
 public abstract class AbstractNonKeyedOperatorRestoreTestBase
         extends AbstractOperatorRestoreTestBase {
 
-    private final FlinkVersion flinkVersion;
-
-    @Parameterized.Parameters(name = "Migrate Savepoint: {0}")
-    public static Collection<FlinkVersion> parameters() {
-        return FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_17);
-    }
-
     protected AbstractNonKeyedOperatorRestoreTestBase(FlinkVersion flinkVersion) {
-        this.flinkVersion = flinkVersion;
-    }
-
-    protected AbstractNonKeyedOperatorRestoreTestBase(
-            FlinkVersion flinkVersion, boolean allowNonRestoredState) {
-        super(allowNonRestoredState);
-        this.flinkVersion = flinkVersion;
+        super(flinkVersion);
     }
 
     @Override
@@ -78,7 +63,7 @@ public abstract class AbstractNonKeyedOperatorRestoreTestBase
     }
 
     @Override
-    protected String getMigrationSavepointName() {
+    protected String getMigrationSavepointName(FlinkVersion flinkVersion) {
         return "nonKeyed-flink" + flinkVersion;
     }
 }
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainBreakTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainBreakTest.java
index 8a142fdc389..f49805ca344 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainBreakTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainBreakTest.java
@@ -37,6 +37,11 @@ public class ChainBreakTest extends AbstractNonKeyedOperatorRestoreTestBase {
         super(flinkVersion);
     }
 
+    @SnapshotsGenerator
+    public void generateSnapshots(FlinkVersion targetVersion) throws Exception {
+        internalGenerateSnapshots(targetVersion);
+    }
+
     @Override
     public void createRestoredJob(StreamExecutionEnvironment env) {
         /**
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthDecreaseTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthDecreaseTest.java
index a72e9ad4bf6..516450c54ed 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthDecreaseTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthDecreaseTest.java
@@ -32,6 +32,8 @@ import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.c
 /**
  * Verifies that the state of all operators is restored if a topology change removes an operator
  * from a chain.
+ *
+ * <p>The test shares the snapshots generated by {@link ChainBreakTest}.
  */
 public class ChainLengthDecreaseTest extends AbstractNonKeyedOperatorRestoreTestBase {
 
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthIncreaseTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthIncreaseTest.java
index 6123603afaa..6239564975e 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthIncreaseTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthIncreaseTest.java
@@ -33,6 +33,8 @@ import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.c
 /**
  * Verifies that the state of all operator is restored if a topology change adds an operator to a
  * chain.
+ *
+ * <p>The test shares the snapshots generated by {@link ChainBreakTest}.
  */
 public class ChainLengthIncreaseTest extends AbstractNonKeyedOperatorRestoreTestBase {
 
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthStatelessDecreaseTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthStatelessDecreaseTest.java
index 52a238b1a88..771e3caa53b 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthStatelessDecreaseTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainLengthStatelessDecreaseTest.java
@@ -35,6 +35,8 @@ import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.c
  *
  * <p>This test specifically checks that stateless operators can be removed even if all states from
  * the previous job must be restored.
+ *
+ * <p>The test shares the snapshots generated by {@link ChainBreakTest}.
  */
 public class ChainLengthStatelessDecreaseTest extends AbstractNonKeyedOperatorRestoreTestBase {
 
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainOrderTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainOrderTest.java
index 35a51152078..f15b5217f4a 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainOrderTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainOrderTest.java
@@ -33,6 +33,8 @@ import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.c
 /**
  * Verifies that the state of all operators is restored if a topology change causes the ordering of
  * a chain to change.
+ *
+ * <p>The test shares the snapshots generated by {@link ChainBreakTest}.
  */
 public class ChainOrderTest extends AbstractNonKeyedOperatorRestoreTestBase {
 
diff --git a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainUnionTest.java b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainUnionTest.java
index 4e2b1e31f1a..769a07fc08c 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainUnionTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/state/operator/restore/unkeyed/ChainUnionTest.java
@@ -32,6 +32,8 @@ import static org.apache.flink.test.state.operator.restore.unkeyed.NonKeyedJob.c
 
 /**
  * Verifies that the state of all operators is restored if a topology change creates a new chain.
+ *
+ * <p>The test shares the snapshots generated by {@link ChainBreakTest}.
  */
 public class ChainUnionTest extends AbstractNonKeyedOperatorRestoreTestBase {
 
diff --git a/flink-tests/src/test/resources/log4j2-test.properties b/flink-tests/src/test/resources/log4j2-test.properties
index ae3d9bede98..c5d9b0f65be 100644
--- a/flink-tests/src/test/resources/log4j2-test.properties
+++ b/flink-tests/src/test/resources/log4j2-test.properties
@@ -29,3 +29,6 @@ appender.testlogger.type = CONSOLE
 appender.testlogger.target = SYSTEM_ERR
 appender.testlogger.layout.type = PatternLayout
 appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n
+
+logger.migration.name = org.apache.flink.test.migration
+logger.migration.level = INFO
diff --git a/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobSavepointMigrationITCase.scala b/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobSavepointMigrationITCase.scala
index c656fcb1382..b6a05ebed55 100644
--- a/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobSavepointMigrationITCase.scala
+++ b/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobSavepointMigrationITCase.scala
@@ -25,7 +25,6 @@ import org.apache.flink.api.java.functions.KeySelector
 import org.apache.flink.api.java.tuple.Tuple2
 import org.apache.flink.api.scala._
 import org.apache.flink.api.scala.migration.CustomEnum.CustomEnum
-import org.apache.flink.api.scala.migration.StatefulJobSavepointMigrationITCase.executionMode
 import org.apache.flink.configuration.Configuration
 import org.apache.flink.contrib.streaming.state.EmbeddedRocksDBStateBackend
 import org.apache.flink.runtime.state.{FunctionInitializationContext, FunctionSnapshotContext, StateBackendLoader}
@@ -39,29 +38,49 @@ import org.apache.flink.streaming.api.functions.source.SourceFunction
 import org.apache.flink.streaming.api.watermark.Watermark
 import org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase
 import org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase.{ExecutionMode, SnapshotSpec, SnapshotType}
+import org.apache.flink.test.util.MigrationTest
+import org.apache.flink.test.util.MigrationTest.ParameterizedSnapshotsGenerator
 import org.apache.flink.util.Collector
 
 import org.junit.Test
 import org.junit.runner.RunWith
 import org.junit.runners.Parameterized
 
+import javax.annotation.Nullable
+
 import java.util
+import java.util.function.BiFunction
 import java.util.stream.Collectors
 
 import scala.util.{Failure, Try}
 
 object StatefulJobSavepointMigrationITCase {
 
-  // TODO increase this to newer version to create and test snapshot migration for newer versions
-  val currentVersion = FlinkVersion.v1_17
-
-  // TODO change this to CREATE_SNAPSHOT to (re)create binary snapshots
-  // TODO Note: You should generate the snapshot based on the release branch instead of the
-  // master.
-  val executionMode = ExecutionMode.VERIFY_SNAPSHOT
-
   @Parameterized.Parameters(name = "Test snapshot: {0}")
-  def parameters: util.Collection[SnapshotSpec] = {
+  def createSpecsForTestRuns: util.Collection[SnapshotSpec] =
+    internalParameters(null)
+
+  def createSpecsForTestDataGeneration(version: FlinkVersion): util.Collection[SnapshotSpec] =
+    internalParameters(version)
+
+  private def internalParameters(
+      @Nullable targetGeneratingVersion: FlinkVersion): util.Collection[SnapshotSpec] = {
+    val getFlinkVersions =
+      new BiFunction[FlinkVersion, FlinkVersion, util.Collection[FlinkVersion]] {
+        override def apply(
+            minInclVersion: FlinkVersion,
+            maxInclVersion: FlinkVersion): util.Collection[FlinkVersion] = if (
+          targetGeneratingVersion != null
+        )
+          FlinkVersion
+            .rangeOf(minInclVersion, maxInclVersion)
+            .stream()
+            .filter(v => v.equals(targetGeneratingVersion))
+            .collect(Collectors.toList())
+        else
+          FlinkVersion.rangeOf(minInclVersion, maxInclVersion)
+      }
+
     // Note: It is not safe to restore savepoints created in a Scala applications with Flink
     // version 1.7 or below. The reason is that up to version 1.7 the underlying Scala serializer
     // used names of anonymous classes that depend on the relative position/order in code, e.g.,
@@ -69,48 +88,49 @@ object StatefulJobSavepointMigrationITCase {
     // change order in the code their names are switched.
     // As a consequence, changes in code may result in restore failures.
     // This was fixed in version 1.8, see: https://issues.apache.org/jira/browse/FLINK-10493
-    var parameters: util.List[SnapshotSpec] = new util.LinkedList[SnapshotSpec]()
+    val parameters: util.List[SnapshotSpec] = new util.LinkedList[SnapshotSpec]()
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.MEMORY_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_CANONICAL,
-        FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_13)))
+        getFlinkVersions.apply(FlinkVersion.v1_8, FlinkVersion.v1_13)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_CANONICAL,
-        FlinkVersion.rangeOf(FlinkVersion.v1_14, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_14, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_CANONICAL,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_NATIVE,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_NATIVE,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
         SnapshotType.CHECKPOINT,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
         SnapshotType.CHECKPOINT,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
-    if (executionMode == ExecutionMode.CREATE_SNAPSHOT) {
-      parameters = parameters
-        .stream()
-        .filter(x => x.getFlinkVersion().equals(currentVersion))
-        .collect(Collectors.toList())
-    }
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters
   }
 
@@ -137,10 +157,23 @@ object StatefulJobSavepointMigrationITCase {
 @RunWith(classOf[Parameterized])
 class StatefulJobSavepointMigrationITCase(snapshotSpec: SnapshotSpec)
   extends SnapshotMigrationTestBase
-  with Serializable {
+  with Serializable
+  with MigrationTest {
+
+  /** Generates all the required states. */
+  @ParameterizedSnapshotsGenerator("createSpecsForTestDataGeneration")
+  def generateSnapshots(snapshotSpec: SnapshotSpec): Unit = {
+    testOrCreateSavepoint(ExecutionMode.CREATE_SNAPSHOT, snapshotSpec)
+  }
 
   @Test
   def testSavepoint(): Unit = {
+    testOrCreateSavepoint(ExecutionMode.VERIFY_SNAPSHOT, snapshotSpec)
+  }
+
+  private def testOrCreateSavepoint(
+      executionMode: ExecutionMode,
+      snapshotSpec: SnapshotSpec): Unit = {
     val env = StreamExecutionEnvironment.getExecutionEnvironment
     env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)
 
@@ -176,7 +209,7 @@ class StatefulJobSavepointMigrationITCase(snapshotSpec: SnapshotSpec)
       .flatMap(new StatefulFlatMapper)
       .addSink(new AccumulatorCountingSink)
 
-    if (StatefulJobSavepointMigrationITCase.executionMode == ExecutionMode.CREATE_SNAPSHOT) {
+    if (executionMode == ExecutionMode.CREATE_SNAPSHOT) {
       executeAndSnapshot(
         env,
         s"src/test/resources/"
@@ -187,7 +220,7 @@ class StatefulJobSavepointMigrationITCase(snapshotSpec: SnapshotSpec)
           StatefulJobSavepointMigrationITCase.NUM_ELEMENTS
         )
       )
-    } else if (StatefulJobSavepointMigrationITCase.executionMode == ExecutionMode.VERIFY_SNAPSHOT) {
+    } else if (executionMode == ExecutionMode.VERIFY_SNAPSHOT) {
       restoreAndExecute(
         env,
         SnapshotMigrationTestBase.getResourceFilename(
@@ -345,5 +378,4 @@ class StatefulJobSavepointMigrationITCase(snapshotSpec: SnapshotSpec)
       collector.collect(in)
     }
   }
-
 }
diff --git a/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobWBroadcastStateMigrationITCase.scala b/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobWBroadcastStateMigrationITCase.scala
index 0bef7517f36..fcb7659846e 100644
--- a/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobWBroadcastStateMigrationITCase.scala
+++ b/flink-tests/src/test/scala/org/apache/flink/api/scala/migration/StatefulJobWBroadcastStateMigrationITCase.scala
@@ -26,7 +26,6 @@ import org.apache.flink.api.java.functions.KeySelector
 import org.apache.flink.api.java.tuple.Tuple2
 import org.apache.flink.api.scala.createTypeInformation
 import org.apache.flink.api.scala.migration.CustomEnum.CustomEnum
-import org.apache.flink.api.scala.migration.StatefulJobWBroadcastStateMigrationITCase.executionMode
 import org.apache.flink.configuration.Configuration
 import org.apache.flink.contrib.streaming.state.EmbeddedRocksDBStateBackend
 import org.apache.flink.runtime.state.{FunctionInitializationContext, FunctionSnapshotContext, StateBackendLoader}
@@ -41,29 +40,49 @@ import org.apache.flink.streaming.api.functions.source.SourceFunction
 import org.apache.flink.streaming.api.watermark.Watermark
 import org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase
 import org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase.{ExecutionMode, SnapshotSpec, SnapshotType}
+import org.apache.flink.test.util.MigrationTest
+import org.apache.flink.test.util.MigrationTest.ParameterizedSnapshotsGenerator
 import org.apache.flink.util.Collector
 
 import org.junit.{Assert, Test}
 import org.junit.runner.RunWith
 import org.junit.runners.Parameterized
 
+import javax.annotation.Nullable
+
 import java.util
+import java.util.function.BiFunction
 import java.util.stream.Collectors
 
 import scala.util.{Failure, Try}
 
 object StatefulJobWBroadcastStateMigrationITCase {
 
-  // TODO increase this to newer version to create and test snapshot migration for newer versions
-  val currentVersion = FlinkVersion.v1_17
-
-  // TODO change this to CREATE_SNAPSHOT to (re)create binary snapshots
-  // TODO Note: You should generate the snapshot based on the release branch instead of the
-  // master.
-  val executionMode = ExecutionMode.VERIFY_SNAPSHOT
-
   @Parameterized.Parameters(name = "Test snapshot: {0}")
-  def parameters: util.Collection[SnapshotSpec] = {
+  def createSpecsForTestRuns: util.Collection[SnapshotSpec] =
+    internalParameters(null)
+
+  def createSpecsForTestDataGeneration(version: FlinkVersion): util.Collection[SnapshotSpec] =
+    internalParameters(version)
+
+  def internalParameters(
+      @Nullable targetGeneratingVersion: FlinkVersion): util.Collection[SnapshotSpec] = {
+    val getFlinkVersions =
+      new BiFunction[FlinkVersion, FlinkVersion, util.Collection[FlinkVersion]] {
+        override def apply(
+            minInclVersion: FlinkVersion,
+            maxInclVersion: FlinkVersion): util.Collection[FlinkVersion] = if (
+          targetGeneratingVersion != null
+        )
+          FlinkVersion
+            .rangeOf(minInclVersion, maxInclVersion)
+            .stream()
+            .filter(v => v.equals(targetGeneratingVersion))
+            .collect(Collectors.toList())
+        else
+          FlinkVersion.rangeOf(minInclVersion, maxInclVersion)
+      }
+
     // Note: It is not safe to restore savepoints created in a Scala applications with Flink
     // version 1.7 or below. The reason is that up to version 1.7 the underlying Scala serializer
     // used names of anonymous classes that depend on the relative position/order in code, e.g.,
@@ -76,43 +95,44 @@ object StatefulJobWBroadcastStateMigrationITCase {
       SnapshotSpec.withVersions(
         StateBackendLoader.MEMORY_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_CANONICAL,
-        FlinkVersion.rangeOf(FlinkVersion.v1_8, FlinkVersion.v1_13)))
+        getFlinkVersions.apply(FlinkVersion.v1_8, FlinkVersion.v1_13)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_CANONICAL,
-        FlinkVersion.rangeOf(FlinkVersion.v1_14, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_14, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_CANONICAL,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_NATIVE,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
         SnapshotType.SAVEPOINT_NATIVE,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.HASHMAP_STATE_BACKEND_NAME,
         SnapshotType.CHECKPOINT,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters.addAll(
       SnapshotSpec.withVersions(
         StateBackendLoader.ROCKSDB_STATE_BACKEND_NAME,
         SnapshotType.CHECKPOINT,
-        FlinkVersion.rangeOf(FlinkVersion.v1_15, currentVersion)))
-    if (executionMode == ExecutionMode.CREATE_SNAPSHOT) {
-      parameters = parameters
-        .stream()
-        .filter(x => x.getFlinkVersion().equals(currentVersion))
-        .collect(Collectors.toList())
-    }
+        getFlinkVersions.apply(FlinkVersion.v1_15, MigrationTest.getMostRecentlyPublishedVersion)
+      ))
     parameters
   }
 
@@ -139,10 +159,23 @@ object StatefulJobWBroadcastStateMigrationITCase {
 @RunWith(classOf[Parameterized])
 class StatefulJobWBroadcastStateMigrationITCase(snapshotSpec: SnapshotSpec)
   extends SnapshotMigrationTestBase
-  with Serializable {
+  with Serializable
+  with MigrationTest {
+
+  /** Generates all the required states. */
+  @ParameterizedSnapshotsGenerator("createSpecsForTestDataGeneration")
+  def generateSnapshots(snapshotSpec: SnapshotSpec): Unit = {
+    testOrCreateSavepointWithBroadcast(ExecutionMode.CREATE_SNAPSHOT, snapshotSpec)
+  }
 
   @Test
   def testSavepointWithBroadcast(): Unit = {
+    testOrCreateSavepointWithBroadcast(ExecutionMode.VERIFY_SNAPSHOT, snapshotSpec)
+  }
+
+  def testOrCreateSavepointWithBroadcast(
+      executionMode: ExecutionMode,
+      snapshotSpec: SnapshotSpec): Unit = {
 
     val env = StreamExecutionEnvironment.getExecutionEnvironment
     env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)
@@ -198,7 +231,7 @@ class StatefulJobWBroadcastStateMigrationITCase(snapshotSpec: SnapshotSpec)
       .uid("checkpointedBroadcastSource")
       .broadcast(firstBroadcastStateDesc, secondBroadcastStateDesc)
 
-    if (StatefulJobWBroadcastStateMigrationITCase.executionMode == ExecutionMode.CREATE_SNAPSHOT) {
+    if (executionMode == ExecutionMode.CREATE_SNAPSHOT) {
       stream
         .connect(broadcastStream)
         .process(new TestBroadcastProcessFunction)
@@ -214,9 +247,7 @@ class StatefulJobWBroadcastStateMigrationITCase(snapshotSpec: SnapshotSpec)
           StatefulJobWBroadcastStateMigrationITCase.NUM_ELEMENTS
         )
       )
-    } else if (
-      StatefulJobWBroadcastStateMigrationITCase.executionMode == ExecutionMode.VERIFY_SNAPSHOT
-    ) {
+    } else if (executionMode == ExecutionMode.VERIFY_SNAPSHOT) {
       val expectedFirstState: Map[Long, Long] =
         Map(0L -> 0L, 1L -> 1L, 2L -> 2L, 3L -> 3L)
       val expectedSecondState: Map[String, String] =
@@ -460,8 +491,6 @@ class VerifyingBroadcastProcessFunction(
     Assert.assertEquals(firstExpectedBroadcastState, actualFirstState)
 
     var actualSecondState = Map[String, String]()
-
-    import scala.collection.JavaConversions._
     for (entry <- ctx.getBroadcastState(secondBroadcastStateDesc).immutableEntries()) {
       val v = secondExpectedBroadcastState.get(entry.getKey).get
       Assert.assertEquals(v, entry.getValue)
diff --git a/pom.xml b/pom.xml
index fb5f01dcb66..7e77b35570f 100644
--- a/pom.xml
+++ b/pom.xml
@@ -1593,6 +1593,9 @@ under the License.
 
 						<!-- AWS SDK config that does not support license headers -->
 						<exclude>**/awssdk/global/handlers/execution.interceptors</exclude>
+
+						<!-- The most recently published version configuration file -->
+						<exclude>flink-test-utils-parent/flink-migration-test-utils/src/main/resources/most_recently_published_version</exclude>
 					</excludes>
 				</configuration>
 			</plugin>
