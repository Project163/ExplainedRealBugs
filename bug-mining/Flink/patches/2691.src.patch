diff --git a/flink-libraries/flink-sql-client/pom.xml b/flink-libraries/flink-sql-client/pom.xml
index 68ec71857bb..b7b21f861f9 100644
--- a/flink-libraries/flink-sql-client/pom.xml
+++ b/flink-libraries/flink-sql-client/pom.xml
@@ -64,6 +64,12 @@ under the License.
 			<version>${project.version}</version>
 		</dependency>
 
+		<dependency>
+			<groupId>org.apache.flink</groupId>
+			<artifactId>flink-cep_2.11</artifactId>
+			<version>${project.version}</version>
+		</dependency>
+
 		<!-- logging utilities -->
 		<dependency>
 			<groupId>org.slf4j</groupId>
@@ -156,6 +162,7 @@ under the License.
 										<include>org/apache/calcite/**</include>
 										<include>org/apache/flink/calcite/shaded/**</include>
 										<include>org/apache/flink/table/**</include>
+										<include>org/apache/flink/cep/**</include>
 										<include>org.codehaus.commons.compiler.properties</include>
 										<include>org/codehaus/janino/**</include>
 										<include>org/codehaus/commons/**</include>
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/datastream/DataStreamMatchRule.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/datastream/DataStreamMatchRule.scala
index bbebc73b24d..5b0aa65362f 100644
--- a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/datastream/DataStreamMatchRule.scala
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/datastream/DataStreamMatchRule.scala
@@ -42,11 +42,13 @@ class DataStreamMatchRule
       RelOptRule.convert(logicalMatch.getInput, FlinkConventions.DATASTREAM)
 
     try {
-      Class.forName("org.apache.flink.cep.pattern.Pattern")
+      Class
+        .forName("org.apache.flink.cep.pattern.Pattern",
+          false,
+          Thread.currentThread().getContextClassLoader)
     } catch {
       case ex: ClassNotFoundException => throw new TableException(
-        "MATCH RECOGNIZE clause requires flink-cep dependency to be present on the classpath.",
-        ex)
+        "MATCH RECOGNIZE clause requires flink-cep dependency to be present on the classpath.", ex)
     }
 
     new DataStreamMatch(
