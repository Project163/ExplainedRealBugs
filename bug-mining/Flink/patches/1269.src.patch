diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/StreamOperatorSnapshotRestoreTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/StreamOperatorSnapshotRestoreTest.java
index 997ceb702ad..c02a7c320db 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/StreamOperatorSnapshotRestoreTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/operators/StreamOperatorSnapshotRestoreTest.java
@@ -68,7 +68,9 @@ public class StreamOperatorSnapshotRestoreTest {
 							}
 						},
 						TypeInformation.of(Integer.class),
-						MAX_PARALLELISM);
+						MAX_PARALLELISM,
+						1 /* num subtasks */,
+						0 /* subtask index */);
 
 		testHarness.open();
 
@@ -92,7 +94,9 @@ public class StreamOperatorSnapshotRestoreTest {
 					}
 				},
 				TypeInformation.of(Integer.class),
-				MAX_PARALLELISM);
+				MAX_PARALLELISM,
+				1 /* num subtasks */,
+				0 /* subtask index */);
 
 		testHarness.initializeState(handles);
 
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java
index 7189ce07f2f..dfc0af09c96 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java
@@ -66,8 +66,6 @@ import static org.mockito.Mockito.*;
  */
 public class AbstractStreamOperatorTestHarness<OUT> {
 
-	protected final static int DEFAULT_MAX_PARALLELISM = 1;
-
 	final protected StreamOperator<OUT> operator;
 
 	final protected ConcurrentLinkedQueue<Object> outputList;
@@ -80,6 +78,8 @@ public class AbstractStreamOperatorTestHarness<OUT> {
 
 	final protected StreamTask<?, ?> mockTask;
 
+	final Environment environment;
+
 	ClosableRegistry closableRegistry;
 
 	// use this as default for tests
@@ -97,7 +97,9 @@ public class AbstractStreamOperatorTestHarness<OUT> {
 
 	public AbstractStreamOperatorTestHarness(
 			StreamOperator<OUT> operator,
-			int maxParallelism) throws Exception {
+			int maxParallelism,
+			int numSubtasks,
+			int subtaskIndex) throws Exception {
 		this.operator = operator;
 		this.outputList = new ConcurrentLinkedQueue<>();
 		Configuration underlyingConfig = new Configuration();
@@ -107,7 +109,7 @@ public class AbstractStreamOperatorTestHarness<OUT> {
 		this.closableRegistry = new ClosableRegistry();
 		this.checkpointLock = new Object();
 
-		final Environment env = new MockEnvironment(
+		environment = new MockEnvironment(
 				"MockTask",
 				3 * 1024 * 1024,
 				new MockInputSplitProvider(),
@@ -115,7 +117,8 @@ public class AbstractStreamOperatorTestHarness<OUT> {
 				underlyingConfig,
 				executionConfig,
 				maxParallelism,
-				1, 0);
+				numSubtasks,
+				subtaskIndex);
 
 		mockTask = mock(StreamTask.class);
 		processingTimeService = new TestProcessingTimeService();
@@ -125,7 +128,7 @@ public class AbstractStreamOperatorTestHarness<OUT> {
 		when(mockTask.getCheckpointLock()).thenReturn(checkpointLock);
 		when(mockTask.getConfiguration()).thenReturn(config);
 		when(mockTask.getTaskConfiguration()).thenReturn(underlyingConfig);
-		when(mockTask.getEnvironment()).thenReturn(env);
+		when(mockTask.getEnvironment()).thenReturn(environment);
 		when(mockTask.getExecutionConfig()).thenReturn(executionConfig);
 		when(mockTask.getUserCodeClassLoader()).thenReturn(this.getClass().getClassLoader());
 		when(mockTask.getCancelables()).thenReturn(this.closableRegistry);
@@ -159,9 +162,9 @@ public class AbstractStreamOperatorTestHarness<OUT> {
 					final Collection<OperatorStateHandle> stateHandles = (Collection<OperatorStateHandle>) invocationOnMock.getArguments()[1];
 					OperatorStateBackend osb;
 					if (null == stateHandles) {
-						osb = stateBackend.createOperatorStateBackend(env, operator.getClass().getSimpleName());
+						osb = stateBackend.createOperatorStateBackend(environment, operator.getClass().getSimpleName());
 					} else {
-						osb = stateBackend.restoreOperatorStateBackend(env, operator.getClass().getSimpleName(), stateHandles);
+						osb = stateBackend.restoreOperatorStateBackend(environment, operator.getClass().getSimpleName(), stateHandles);
 					}
 					mockTask.getCancelables().registerClosable(osb);
 					return osb;
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedOneInputStreamOperatorTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedOneInputStreamOperatorTestHarness.java
index 25563a37899..7d87eb858b1 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedOneInputStreamOperatorTestHarness.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedOneInputStreamOperatorTestHarness.java
@@ -65,8 +65,10 @@ public class KeyedOneInputStreamOperatorTestHarness<K, IN, OUT>
 			OneInputStreamOperator<IN, OUT> operator,
 			final KeySelector<IN, K> keySelector,
 			TypeInformation<K> keyType,
-			int maxParallelism) throws Exception {
-		super(operator, maxParallelism);
+			int maxParallelism,
+			int numSubtasks,
+			int subtaskIndex) throws Exception {
+		super(operator, maxParallelism, numSubtasks, subtaskIndex);
 
 		ClosureCleaner.clean(keySelector, false);
 		config.setStatePartitioner(0, keySelector);
@@ -80,7 +82,7 @@ public class KeyedOneInputStreamOperatorTestHarness<K, IN, OUT>
 			OneInputStreamOperator<IN, OUT> operator,
 			final KeySelector<IN, K> keySelector,
 			TypeInformation<K> keyType) throws Exception {
-		this(operator, keySelector, keyType, DEFAULT_MAX_PARALLELISM);
+		this(operator, keySelector, keyType, 1, 1, 0);
 	}
 
 	private void setupMockTaskCreateKeyedBackend() {
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedTwoInputStreamOperatorTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedTwoInputStreamOperatorTestHarness.java
index 1a01ea3a658..0aa91d94452 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedTwoInputStreamOperatorTestHarness.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/KeyedTwoInputStreamOperatorTestHarness.java
@@ -57,8 +57,10 @@ public class KeyedTwoInputStreamOperatorTestHarness<K, IN1, IN2, OUT>
 			KeySelector<IN1, K> keySelector1,
 			KeySelector<IN2, K> keySelector2,
 			TypeInformation<K> keyType,
-			int maxParallelism) throws Exception {
-		super(operator, maxParallelism);
+			int maxParallelism,
+			int numSubtasks,
+			int subtaskIndex) throws Exception {
+		super(operator, maxParallelism, numSubtasks, subtaskIndex);
 
 		ClosureCleaner.clean(keySelector1, false);
 		ClosureCleaner.clean(keySelector2, false);
@@ -74,7 +76,7 @@ public class KeyedTwoInputStreamOperatorTestHarness<K, IN1, IN2, OUT>
 			final KeySelector<IN1, K> keySelector1,
 			final KeySelector<IN2, K> keySelector2,
 			TypeInformation<K> keyType) throws Exception {
-		this(operator, keySelector1, keySelector2, keyType, DEFAULT_MAX_PARALLELISM);
+		this(operator, keySelector1, keySelector2, keyType, 1, 1, 0);
 	}
 
 	private void setupMockTaskCreateKeyedBackend() {
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/OneInputStreamOperatorTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/OneInputStreamOperatorTestHarness.java
index 8be9c63e4b3..105922b1f0f 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/OneInputStreamOperatorTestHarness.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/OneInputStreamOperatorTestHarness.java
@@ -36,13 +36,15 @@ public class OneInputStreamOperatorTestHarness<IN, OUT>
 	private final OneInputStreamOperator<IN, OUT> oneInputOperator;
 
 	public OneInputStreamOperatorTestHarness(OneInputStreamOperator<IN, OUT> operator) throws Exception {
-		this(operator, DEFAULT_MAX_PARALLELISM);
+		this(operator, 1, 1, 0);
 	}
 
 	public OneInputStreamOperatorTestHarness(
 			OneInputStreamOperator<IN, OUT> operator,
-			int maxParallelism) throws Exception {
-		super(operator, maxParallelism);
+			int maxParallelism,
+			int numTubtasks,
+			int subtaskIndex) throws Exception {
+		super(operator, maxParallelism, numTubtasks, subtaskIndex);
 
 		this.oneInputOperator = operator;
 	}
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/TwoInputStreamOperatorTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/TwoInputStreamOperatorTestHarness.java
index c6f69181c4b..90bdcb2215b 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/TwoInputStreamOperatorTestHarness.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/TwoInputStreamOperatorTestHarness.java
@@ -35,13 +35,15 @@ public class TwoInputStreamOperatorTestHarness<IN1, IN2, OUT>extends AbstractStr
 	private final TwoInputStreamOperator<IN1, IN2, OUT> twoInputOperator;
 
 	public TwoInputStreamOperatorTestHarness(TwoInputStreamOperator<IN1, IN2, OUT> operator) throws Exception {
-		this(operator, DEFAULT_MAX_PARALLELISM);
+		this(operator, 1, 1, 0);
 	}
 		
 	public TwoInputStreamOperatorTestHarness(
 			TwoInputStreamOperator<IN1, IN2, OUT> operator,
-			int maxParallelism) throws Exception {
-		super(operator, maxParallelism);
+			int maxParallelism,
+			int numSubtasks,
+			int subtaskIndex) throws Exception {
+		super(operator, maxParallelism, numSubtasks, subtaskIndex);
 
 		this.twoInputOperator = operator;
 	}
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/WindowingTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/WindowingTestHarness.java
index db3a89c8015..25deb544af8 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/WindowingTestHarness.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/WindowingTestHarness.java
@@ -76,7 +76,7 @@ public class WindowingTestHarness<K, IN, W extends Window> {
 				trigger,
 				allowedLateness);
 
-		testHarness = new KeyedOneInputStreamOperatorTestHarness<>(operator, keySelector, keyType, 1);
+		testHarness = new KeyedOneInputStreamOperatorTestHarness<>(operator, keySelector, keyType);
 	}
 
 	/**
