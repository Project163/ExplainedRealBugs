diff --git a/flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/sharedbuffer/Lockable.java b/flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/sharedbuffer/Lockable.java
index ae1452bf672..ec992c894be 100644
--- a/flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/sharedbuffer/Lockable.java
+++ b/flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/sharedbuffer/Lockable.java
@@ -19,12 +19,11 @@
 package org.apache.flink.cep.nfa.sharedbuffer;
 
 import org.apache.flink.annotation.VisibleForTesting;
-import org.apache.flink.api.common.typeutils.CompatibilityResult;
-import org.apache.flink.api.common.typeutils.CompatibilityUtil;
+import org.apache.flink.api.common.typeutils.CompositeTypeSerializerUtil;
+import org.apache.flink.api.common.typeutils.LegacySerializerSnapshotTransformer;
 import org.apache.flink.api.common.typeutils.TypeSerializer;
 import org.apache.flink.api.common.typeutils.TypeSerializerConfigSnapshot;
 import org.apache.flink.api.common.typeutils.TypeSerializerSnapshot;
-import org.apache.flink.api.common.typeutils.UnloadableDummyTypeSerializer;
 import org.apache.flink.api.common.typeutils.base.IntSerializer;
 import org.apache.flink.core.memory.DataInputView;
 import org.apache.flink.core.memory.DataOutputView;
@@ -95,7 +94,9 @@ public final class Lockable<T> {
 	}
 
 	/** Serializer for {@link Lockable}. */
-	public static class LockableTypeSerializer<E> extends TypeSerializer<Lockable<E>> {
+	public static class LockableTypeSerializer<E> extends TypeSerializer<Lockable<E>>
+			implements LegacySerializerSnapshotTransformer<Lockable<E>> {
+
 		private static final long serialVersionUID = 3298801058463337340L;
 		private final TypeSerializer<E> elementSerializer;
 
@@ -190,26 +191,36 @@ public final class Lockable<T> {
 			return new LockableTypeSerializerSnapshot<>(this);
 		}
 
-		/**
-		 * This cannot be removed until {@link TypeSerializerConfigSnapshot} is no longer supported.
-		 */
+		@VisibleForTesting
+		TypeSerializer<E> getElementSerializer() {
+			return elementSerializer;
+		}
+
 		@Override
-		public CompatibilityResult<Lockable<E>> ensureCompatibility(TypeSerializerConfigSnapshot<?> configSnapshot) {
-			// backwards compatibility path
-			CompatibilityResult<E> inputCompatibilityResult = CompatibilityUtil.resolveCompatibilityResult(
-				configSnapshot.restoreSerializer(),
-				UnloadableDummyTypeSerializer.class,
-				configSnapshot,
-				elementSerializer);
+		@SuppressWarnings("unchecked")
+		public <U> TypeSerializerSnapshot<Lockable<E>> transformLegacySerializerSnapshot(TypeSerializerSnapshot<U> legacySnapshot) {
+			if (legacySnapshot instanceof LockableTypeSerializerSnapshot) {
+				return (TypeSerializerSnapshot<Lockable<E>>) legacySnapshot;
+			}
 
-			return (inputCompatibilityResult.isRequiresMigration())
-				? CompatibilityResult.requiresMigration()
-				: CompatibilityResult.compatible();
+			// In Flink 1.6, this serializer was directly returning the elementSerializer's snapshot
+			// instead of wrapping it in a LockableTypeSerializer(Config)Snapshot.
+			// This caused state information to be written as <LockableTypeSerializer, SomeArbitrarySerializerSnapshot>,
+			// Therefore we need to preform the following transformation:
+			// 	1. set the prior serializer on the legacySnapshot to be the elementSerializer
+			// 	2. return a LockableTypeSerializerSnapshot that has the legacySnapshot as a nested snapshot.
+			if (legacySnapshot instanceof TypeSerializerConfigSnapshot) {
+				setElementSerializerAsPriorSerializer(legacySnapshot, this.elementSerializer);
+			}
+			LockableTypeSerializerSnapshot<E> lockableSnapshot = new LockableTypeSerializerSnapshot<>();
+			CompositeTypeSerializerUtil.setNestedSerializersSnapshots(lockableSnapshot, legacySnapshot);
+			return lockableSnapshot;
 		}
 
-		@VisibleForTesting
-		TypeSerializer<E> getElementSerializer() {
-			return elementSerializer;
+		@SuppressWarnings("unchecked")
+		private static <U, E> void setElementSerializerAsPriorSerializer(TypeSerializerSnapshot<U> legacySnapshot, TypeSerializer<E> elementSerializer) {
+			TypeSerializerConfigSnapshot<E> elementLegacySnapshot = (TypeSerializerConfigSnapshot<E>) legacySnapshot;
+			elementLegacySnapshot.setPriorSerializer(elementSerializer);
 		}
 	}
 }
