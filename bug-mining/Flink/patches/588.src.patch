diff --git a/flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamingRuntimeContext.java b/flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamingRuntimeContext.java
index 2ca286260a9..b82888e35bd 100644
--- a/flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamingRuntimeContext.java
+++ b/flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamingRuntimeContext.java
@@ -104,8 +104,8 @@ public class StreamingRuntimeContext extends RuntimeUDFContext {
 			throw new RuntimeException("Cannot set default state to null.");
 		}
 		StreamOperatorState<S, C> state = (StreamOperatorState<S, C>) getState(name, partitioned);
-		state.setDefaultState(defaultState);
 		state.setCheckpointer(checkpointer);
+		state.setDefaultState(defaultState);
 
 		return (OperatorState<S>) state;
 	}
diff --git a/flink-staging/flink-streaming/flink-streaming-core/src/test/java/org/apache/flink/streaming/api/state/StatefulOperatorTest.java b/flink-staging/flink-streaming/flink-streaming-core/src/test/java/org/apache/flink/streaming/api/state/StatefulOperatorTest.java
index 48bb1f39a95..76d9e16aa85 100644
--- a/flink-staging/flink-streaming/flink-streaming-core/src/test/java/org/apache/flink/streaming/api/state/StatefulOperatorTest.java
+++ b/flink-staging/flink-streaming/flink-streaming-core/src/test/java/org/apache/flink/streaming/api/state/StatefulOperatorTest.java
@@ -37,6 +37,7 @@ import org.apache.flink.api.common.ExecutionConfig;
 import org.apache.flink.api.common.accumulators.Accumulator;
 import org.apache.flink.api.common.functions.RichMapFunction;
 import org.apache.flink.api.common.state.OperatorState;
+import org.apache.flink.api.common.state.StateCheckpointer;
 import org.apache.flink.api.java.functions.KeySelector;
 import org.apache.flink.api.java.tuple.Tuple2;
 import org.apache.flink.configuration.Configuration;
@@ -278,7 +279,19 @@ public class StatefulOperatorTest extends StreamingMultipleProgramsTestBase {
 
 		@Override
 		public void open(Configuration conf) throws IOException {
-			groupCounter = getRuntimeContext().getOperatorState("groupCounter", 0, true);
+			groupCounter = getRuntimeContext().getOperatorState("groupCounter", 0, true,
+					new StateCheckpointer<Integer, String>() {
+
+						@Override
+						public String snapshotState(Integer state, long checkpointId, long checkpointTimestamp) {
+							return state.toString();
+						}
+
+						@Override
+						public Integer restoreState(String stateSnapshot) {
+							return Integer.parseInt(stateSnapshot);
+						}
+					});
 		}
 
 		@SuppressWarnings("unchecked")
