diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/JobDispatcherFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/JobDispatcherFactory.java
index ab37e7ff803..784bb42710d 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/JobDispatcherFactory.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/JobDispatcherFactory.java
@@ -20,10 +20,11 @@ package org.apache.flink.runtime.dispatcher;
 
 import org.apache.flink.configuration.Configuration;
 import org.apache.flink.runtime.entrypoint.ClusterEntrypoint;
-import org.apache.flink.runtime.entrypoint.component.JobGraphRetriever;
 import org.apache.flink.runtime.jobgraph.JobGraph;
 import org.apache.flink.runtime.rpc.RpcService;
 
+import org.apache.flink.shaded.guava18.com.google.common.collect.Iterables;
+
 import javax.annotation.Nonnull;
 
 import java.util.Collection;
@@ -33,13 +34,8 @@ import static org.apache.flink.runtime.entrypoint.ClusterEntrypoint.EXECUTION_MO
 /**
  * {@link DispatcherFactory} which creates a {@link MiniDispatcher}.
  */
-public class JobDispatcherFactory implements DispatcherFactory {
-
-	private final JobGraphRetriever jobGraphRetriever;
-
-	public JobDispatcherFactory(JobGraphRetriever jobGraphRetriever) {
-		this.jobGraphRetriever = jobGraphRetriever;
-	}
+public enum JobDispatcherFactory implements DispatcherFactory {
+	INSTANCE;
 
 	@Override
 	public MiniDispatcher createDispatcher(
@@ -47,11 +43,10 @@ public class JobDispatcherFactory implements DispatcherFactory {
 			@Nonnull DispatcherId fencingToken,
 			@Nonnull Collection<JobGraph> recoveredJobs,
 			@Nonnull PartialDispatcherServicesWithJobGraphStore partialDispatcherServicesWithJobGraphStore) throws Exception {
-		final Configuration configuration = partialDispatcherServicesWithJobGraphStore.getConfiguration();
-		final JobGraph jobGraph = jobGraphRetriever.retrieveJobGraph(configuration);
+		final JobGraph jobGraph = Iterables.getOnlyElement(recoveredJobs);
 
+		final Configuration configuration = partialDispatcherServicesWithJobGraphStore.getConfiguration();
 		final String executionModeValue = configuration.getString(EXECUTION_MODE);
-
 		final ClusterEntrypoint.ExecutionMode executionMode = ClusterEntrypoint.ExecutionMode.valueOf(executionModeValue);
 
 		return new MiniDispatcher(
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherLeaderProcessFactoryFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherLeaderProcessFactoryFactory.java
new file mode 100644
index 00000000000..8bde2df7858
--- /dev/null
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherLeaderProcessFactoryFactory.java
@@ -0,0 +1,39 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.dispatcher.runner;
+
+import org.apache.flink.runtime.dispatcher.PartialDispatcherServices;
+import org.apache.flink.runtime.jobmanager.JobGraphStoreFactory;
+import org.apache.flink.runtime.rpc.FatalErrorHandler;
+import org.apache.flink.runtime.rpc.RpcService;
+
+import java.util.concurrent.Executor;
+
+/**
+ * Factory for {@link DispatcherLeaderProcessFactory}.
+ */
+public interface DispatcherLeaderProcessFactoryFactory {
+
+	DispatcherLeaderProcessFactory createFactory(
+		JobGraphStoreFactory jobGraphStoreFactory,
+		Executor ioExecutor,
+		RpcService rpcService,
+		PartialDispatcherServices partialDispatcherServices,
+		FatalErrorHandler fatalErrorHandler);
+}
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java
index 8e846d4b5bc..5ca79f0fcd0 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java
@@ -20,6 +20,7 @@ package org.apache.flink.runtime.dispatcher.runner;
 
 import org.apache.flink.runtime.dispatcher.DispatcherFactory;
 import org.apache.flink.runtime.dispatcher.PartialDispatcherServices;
+import org.apache.flink.runtime.entrypoint.component.JobGraphRetriever;
 import org.apache.flink.runtime.jobmanager.JobGraphStoreFactory;
 import org.apache.flink.runtime.leaderelection.LeaderElectionService;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;
@@ -32,10 +33,10 @@ import java.util.concurrent.Executor;
  * instances.
  */
 public class DispatcherRunnerImplNGFactory implements DispatcherRunnerFactory {
-	private final DispatcherFactory dispatcherFactory;
+	private final DispatcherLeaderProcessFactoryFactory dispatcherLeaderProcessFactoryFactory;
 
-	public DispatcherRunnerImplNGFactory(DispatcherFactory dispatcherFactory) {
-		this.dispatcherFactory = dispatcherFactory;
+	private DispatcherRunnerImplNGFactory(DispatcherLeaderProcessFactoryFactory dispatcherLeaderProcessFactoryFactory) {
+		this.dispatcherLeaderProcessFactoryFactory = dispatcherLeaderProcessFactoryFactory;
 	}
 
 	@Override
@@ -47,15 +48,11 @@ public class DispatcherRunnerImplNGFactory implements DispatcherRunnerFactory {
 			RpcService rpcService,
 			PartialDispatcherServices partialDispatcherServices) throws Exception {
 
-		final DispatcherLeaderProcessImpl.DispatcherServiceFactory dispatcherServiceFactory = new DispatcherServiceImplFactory(
-			dispatcherFactory,
-			rpcService,
-			partialDispatcherServices);
-
-		final DispatcherLeaderProcessFactory dispatcherLeaderProcessFactory = new DispatcherLeaderProcessImplFactory(
-			dispatcherServiceFactory,
+		final DispatcherLeaderProcessFactory dispatcherLeaderProcessFactory = dispatcherLeaderProcessFactoryFactory.createFactory(
 			jobGraphStoreFactory,
 			ioExecutor,
+			rpcService,
+			partialDispatcherServices,
 			fatalErrorHandler);
 
 		return new DispatcherRunnerImplNG(
@@ -63,4 +60,14 @@ public class DispatcherRunnerImplNGFactory implements DispatcherRunnerFactory {
 			fatalErrorHandler,
 			dispatcherLeaderProcessFactory);
 	}
+
+	public static DispatcherRunnerImplNGFactory createSessionRunner(DispatcherFactory dispatcherFactory) {
+		return new DispatcherRunnerImplNGFactory(
+			SessionDispatcherLeaderProcessFactoryFactory.create(dispatcherFactory));
+	}
+
+	public static DispatcherRunnerImplNGFactory createJobRunner(JobGraphRetriever jobGraphRetriever) {
+		return new DispatcherRunnerImplNGFactory(
+			JobDispatcherLeaderProcessFactoryFactory.create(jobGraphRetriever));
+	}
 }
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcess.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcess.java
new file mode 100644
index 00000000000..fb3f8aa282f
--- /dev/null
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcess.java
@@ -0,0 +1,70 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.dispatcher.runner;
+
+import org.apache.flink.runtime.concurrent.FutureUtils;
+import org.apache.flink.runtime.dispatcher.DispatcherId;
+import org.apache.flink.runtime.jobgraph.JobGraph;
+import org.apache.flink.runtime.jobmanager.ThrowingJobGraphWriter;
+import org.apache.flink.runtime.rpc.FatalErrorHandler;
+
+import java.util.Collections;
+import java.util.UUID;
+import java.util.concurrent.CompletableFuture;
+
+/**
+ * {@link DispatcherLeaderProcess} implementation for the per-job mode.
+ */
+public class JobDispatcherLeaderProcess extends AbstractDispatcherLeaderProcess {
+
+	private final DispatcherLeaderProcessImpl.DispatcherServiceFactory dispatcherServiceFactory;
+
+	private final JobGraph jobGraph;
+
+	private DispatcherLeaderProcessImpl.DispatcherService dispatcherService;
+
+	JobDispatcherLeaderProcess(
+			UUID leaderSessionId,
+			DispatcherLeaderProcessImpl.DispatcherServiceFactory dispatcherServiceFactory,
+			JobGraph jobGraph,
+			FatalErrorHandler fatalErrorHandler) {
+		super(leaderSessionId, fatalErrorHandler);
+		this.jobGraph = jobGraph;
+		this.dispatcherServiceFactory = dispatcherServiceFactory;
+	}
+
+	@Override
+	protected void onStart() {
+		dispatcherService = dispatcherServiceFactory.create(
+			DispatcherId.fromUuid(getLeaderSessionId()),
+			Collections.singleton(jobGraph),
+			ThrowingJobGraphWriter.INSTANCE);
+
+		completeDispatcherGatewayFuture(dispatcherService.getGateway());
+	}
+
+	@Override
+	protected CompletableFuture<Void> onClose() {
+		if (dispatcherService != null) {
+			return dispatcherService.closeAsync();
+		} else {
+			return FutureUtils.completedVoidFuture();
+		}
+	}
+}
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcessFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcessFactory.java
new file mode 100644
index 00000000000..db8f4e97c6f
--- /dev/null
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcessFactory.java
@@ -0,0 +1,49 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.dispatcher.runner;
+
+import org.apache.flink.runtime.jobgraph.JobGraph;
+import org.apache.flink.runtime.rpc.FatalErrorHandler;
+
+import java.util.UUID;
+
+/**
+ * Factory for the {@link JobDispatcherLeaderProcess}.
+ */
+public class JobDispatcherLeaderProcessFactory implements DispatcherLeaderProcessFactory {
+	private final DispatcherLeaderProcessImpl.DispatcherServiceFactory dispatcherServiceFactory;
+
+	private final JobGraph jobGraph;
+
+	private final FatalErrorHandler fatalErrorHandler;
+
+	JobDispatcherLeaderProcessFactory(
+			DispatcherLeaderProcessImpl.DispatcherServiceFactory dispatcherServiceFactory,
+			JobGraph jobGraph,
+			FatalErrorHandler fatalErrorHandler) {
+		this.dispatcherServiceFactory = dispatcherServiceFactory;
+		this.jobGraph = jobGraph;
+		this.fatalErrorHandler = fatalErrorHandler;
+	}
+
+	@Override
+	public DispatcherLeaderProcess create(UUID leaderSessionID) {
+		return new JobDispatcherLeaderProcess(leaderSessionID, dispatcherServiceFactory, jobGraph, fatalErrorHandler);
+	}
+}
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcessFactoryFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcessFactoryFactory.java
new file mode 100644
index 00000000000..137cf42846e
--- /dev/null
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/JobDispatcherLeaderProcessFactoryFactory.java
@@ -0,0 +1,74 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.dispatcher.runner;
+
+import org.apache.flink.runtime.dispatcher.JobDispatcherFactory;
+import org.apache.flink.runtime.dispatcher.PartialDispatcherServices;
+import org.apache.flink.runtime.entrypoint.component.JobGraphRetriever;
+import org.apache.flink.runtime.jobgraph.JobGraph;
+import org.apache.flink.runtime.jobmanager.JobGraphStoreFactory;
+import org.apache.flink.runtime.rpc.FatalErrorHandler;
+import org.apache.flink.runtime.rpc.RpcService;
+import org.apache.flink.util.FlinkException;
+import org.apache.flink.util.FlinkRuntimeException;
+
+import java.util.concurrent.Executor;
+
+/**
+ * Factory for the {@link JobDispatcherLeaderProcessFactory}.
+ */
+public class JobDispatcherLeaderProcessFactoryFactory implements DispatcherLeaderProcessFactoryFactory {
+
+	private final JobGraphRetriever jobGraphRetriever;
+
+	private JobDispatcherLeaderProcessFactoryFactory(JobGraphRetriever jobGraphRetriever) {
+		this.jobGraphRetriever = jobGraphRetriever;
+	}
+
+	@Override
+	public DispatcherLeaderProcessFactory createFactory(
+			JobGraphStoreFactory jobGraphStoreFactory,
+			Executor ioExecutor,
+			RpcService rpcService,
+			PartialDispatcherServices partialDispatcherServices,
+			FatalErrorHandler fatalErrorHandler) {
+
+		final JobGraph jobGraph;
+
+		try {
+			jobGraph = jobGraphRetriever.retrieveJobGraph(partialDispatcherServices.getConfiguration());
+		} catch (FlinkException e) {
+			throw new FlinkRuntimeException("Could not retrieve the JobGraph.", e);
+		}
+
+		final DispatcherServiceImplFactory dispatcherServiceImplFactory = new DispatcherServiceImplFactory(
+			JobDispatcherFactory.INSTANCE,
+			rpcService,
+			partialDispatcherServices);
+
+		return new JobDispatcherLeaderProcessFactory(
+			dispatcherServiceImplFactory,
+			jobGraph,
+			fatalErrorHandler);
+	}
+
+	public static JobDispatcherLeaderProcessFactoryFactory create(JobGraphRetriever jobGraphRetriever) {
+		return new JobDispatcherLeaderProcessFactoryFactory(jobGraphRetriever);
+	}
+}
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/SessionDispatcherLeaderProcessFactoryFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/SessionDispatcherLeaderProcessFactoryFactory.java
new file mode 100644
index 00000000000..975b6ff91e1
--- /dev/null
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/SessionDispatcherLeaderProcessFactoryFactory.java
@@ -0,0 +1,62 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.dispatcher.runner;
+
+import org.apache.flink.runtime.dispatcher.DispatcherFactory;
+import org.apache.flink.runtime.dispatcher.PartialDispatcherServices;
+import org.apache.flink.runtime.jobmanager.JobGraphStoreFactory;
+import org.apache.flink.runtime.rpc.FatalErrorHandler;
+import org.apache.flink.runtime.rpc.RpcService;
+
+import java.util.concurrent.Executor;
+
+/**
+ * Factory for the {@link DispatcherLeaderProcessImplFactory}.
+ */
+public class SessionDispatcherLeaderProcessFactoryFactory implements DispatcherLeaderProcessFactoryFactory {
+
+	private final DispatcherFactory dispatcherFactory;
+
+	private SessionDispatcherLeaderProcessFactoryFactory(DispatcherFactory dispatcherFactory) {
+		this.dispatcherFactory = dispatcherFactory;
+	}
+
+	@Override
+	public DispatcherLeaderProcessFactory createFactory(
+			JobGraphStoreFactory jobGraphStoreFactory,
+			Executor ioExecutor,
+			RpcService rpcService,
+			PartialDispatcherServices partialDispatcherServices,
+			FatalErrorHandler fatalErrorHandler) {
+		final DispatcherLeaderProcessImpl.DispatcherServiceFactory dispatcherServiceFactory = new DispatcherServiceImplFactory(
+			dispatcherFactory,
+			rpcService,
+			partialDispatcherServices);
+
+		return new DispatcherLeaderProcessImplFactory(
+			dispatcherServiceFactory,
+			jobGraphStoreFactory,
+			ioExecutor,
+			fatalErrorHandler);
+	}
+
+	public static SessionDispatcherLeaderProcessFactoryFactory create(DispatcherFactory dispatcherFactory) {
+		return new SessionDispatcherLeaderProcessFactoryFactory(dispatcherFactory);
+	}
+}
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/DefaultDispatcherResourceManagerComponentFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/DefaultDispatcherResourceManagerComponentFactory.java
index be9e7a1a8b1..0650a13f2d0 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/DefaultDispatcherResourceManagerComponentFactory.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/DefaultDispatcherResourceManagerComponentFactory.java
@@ -29,12 +29,10 @@ import org.apache.flink.runtime.dispatcher.ArchivedExecutionGraphStore;
 import org.apache.flink.runtime.dispatcher.DispatcherGateway;
 import org.apache.flink.runtime.dispatcher.DispatcherId;
 import org.apache.flink.runtime.dispatcher.HistoryServerArchivist;
-import org.apache.flink.runtime.dispatcher.JobDispatcherFactory;
 import org.apache.flink.runtime.dispatcher.PartialDispatcherServices;
 import org.apache.flink.runtime.dispatcher.SessionDispatcherFactory;
 import org.apache.flink.runtime.dispatcher.runner.DispatcherRunner;
 import org.apache.flink.runtime.dispatcher.runner.DispatcherRunnerFactory;
-import org.apache.flink.runtime.dispatcher.runner.DispatcherRunnerFactoryImpl;
 import org.apache.flink.runtime.dispatcher.runner.DispatcherRunnerImplNGFactory;
 import org.apache.flink.runtime.entrypoint.ClusterInformation;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;
@@ -267,7 +265,7 @@ public class DefaultDispatcherResourceManagerComponentFactory implements Dispatc
 	public static DefaultDispatcherResourceManagerComponentFactory createSessionComponentFactory(
 			ResourceManagerFactory<?> resourceManagerFactory) {
 		return new DefaultDispatcherResourceManagerComponentFactory(
-			new DispatcherRunnerImplNGFactory(SessionDispatcherFactory.INSTANCE),
+			DispatcherRunnerImplNGFactory.createSessionRunner(SessionDispatcherFactory.INSTANCE),
 			resourceManagerFactory,
 			SessionRestEndpointFactory.INSTANCE);
 	}
@@ -276,7 +274,7 @@ public class DefaultDispatcherResourceManagerComponentFactory implements Dispatc
 			ResourceManagerFactory<?> resourceManagerFactory,
 			JobGraphRetriever jobGraphRetriever) {
 		return new DefaultDispatcherResourceManagerComponentFactory(
-			new DispatcherRunnerImplNGFactory(new JobDispatcherFactory(jobGraphRetriever)),
+			DispatcherRunnerImplNGFactory.createJobRunner(jobGraphRetriever),
 			resourceManagerFactory,
 			JobRestEndpointFactory.INSTANCE);
 	}
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/jobmanager/ThrowingJobGraphWriter.java b/flink-runtime/src/main/java/org/apache/flink/runtime/jobmanager/ThrowingJobGraphWriter.java
new file mode 100644
index 00000000000..5ea03ba1f72
--- /dev/null
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/jobmanager/ThrowingJobGraphWriter.java
@@ -0,0 +1,41 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.jobmanager;
+
+import org.apache.flink.api.common.JobID;
+import org.apache.flink.runtime.jobgraph.JobGraph;
+
+/**
+ * {@link JobGraphWriter} implementation which does not allow to store
+ * {@link JobGraph}.
+ */
+public enum ThrowingJobGraphWriter implements JobGraphWriter {
+	INSTANCE;
+
+	@Override
+	public void putJobGraph(JobGraph jobGraph) {
+		throw new UnsupportedOperationException("Cannot store job graphs.");
+	}
+
+	@Override
+	public void removeJobGraph(JobID jobId) {}
+
+	@Override
+	public void releaseJobGraph(JobID jobId) {}
+}
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplTest.java
index 5afa743bcc9..3aa13d2917d 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplTest.java
@@ -124,7 +124,7 @@ public class DispatcherRunnerImplTest extends TestLogger {
 
 			final TestingJobManagerRunnerFactory jobManagerRunnerFactory = new TestingJobManagerRunnerFactory(1);
 
-			final DispatcherRunnerImplNGFactory dispatcherRunnerFactory = new DispatcherRunnerImplNGFactory(new TestingDispatcherFactory(jobManagerRunnerFactory));
+			final DispatcherRunnerImplNGFactory dispatcherRunnerFactory = DispatcherRunnerImplNGFactory.createSessionRunner(new TestingDispatcherFactory(jobManagerRunnerFactory));
 
 			try (final DispatcherRunner dispatcherRunner = createDispatcherRunner(
 					rpcService,
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java
index 6550decc73e..0c30b19a217 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java
@@ -156,7 +156,7 @@ public class ZooKeeperDispatcherRunnerImplTest extends TestLogger {
 
 			final JobGraph jobGraph = createJobGraphWithBlobs();
 
-			final DispatcherRunnerImplNGFactory dispatcherRunnerImplNGFactory = new DispatcherRunnerImplNGFactory(SessionDispatcherFactory.INSTANCE);
+			final DispatcherRunnerImplNGFactory dispatcherRunnerImplNGFactory = DispatcherRunnerImplNGFactory.createSessionRunner(SessionDispatcherFactory.INSTANCE);
 
 			try (final DispatcherRunner dispatcherRunner = createDispatcherRunner(
 				rpcService,
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/minicluster/TestingMiniCluster.java b/flink-runtime/src/test/java/org/apache/flink/runtime/minicluster/TestingMiniCluster.java
index 44e818db689..b0b4ffa40fc 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/minicluster/TestingMiniCluster.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/minicluster/TestingMiniCluster.java
@@ -131,7 +131,7 @@ public class TestingMiniCluster extends MiniCluster {
 
 	private DispatcherResourceManagerComponentFactory createTestingDispatcherResourceManagerComponentFactory() {
 		return TestingDefaultDispatcherResourceManagerComponentFactory.createSessionComponentFactory(
-			new DispatcherRunnerImplNGFactory(SessionDispatcherWithUUIDFactory.INSTANCE),
+			DispatcherRunnerImplNGFactory.createSessionRunner(SessionDispatcherWithUUIDFactory.INSTANCE),
 			StandaloneResourceManagerWithUUIDFactory.INSTANCE);
 	}
 }
