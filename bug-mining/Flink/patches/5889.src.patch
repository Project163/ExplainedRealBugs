diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java
index 36530b038fb..c6b99c35c85 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinatorTest.java
@@ -46,6 +46,7 @@ import org.apache.flink.runtime.messages.checkpoint.AcknowledgeCheckpoint;
 import org.apache.flink.runtime.messages.checkpoint.DeclineCheckpoint;
 import org.apache.flink.runtime.rpc.exceptions.RpcException;
 import org.apache.flink.runtime.state.CheckpointMetadataOutputStream;
+import org.apache.flink.runtime.state.CheckpointStorage;
 import org.apache.flink.runtime.state.CheckpointStorageAccess;
 import org.apache.flink.runtime.state.CheckpointStorageLocation;
 import org.apache.flink.runtime.state.IncrementalRemoteKeyedStateHandle;
@@ -62,6 +63,7 @@ import org.apache.flink.runtime.state.filesystem.FileStateHandle;
 import org.apache.flink.runtime.state.filesystem.FsStateBackend;
 import org.apache.flink.runtime.state.memory.ByteStreamStateHandle;
 import org.apache.flink.runtime.state.memory.MemoryBackendCheckpointStorageAccess;
+import org.apache.flink.runtime.state.memory.MemoryStateBackend;
 import org.apache.flink.runtime.state.memory.NonPersistentMetadataCheckpointStorageLocation;
 import org.apache.flink.runtime.state.storage.JobManagerCheckpointStorage;
 import org.apache.flink.runtime.state.testutils.TestCompletedCheckpointStorageLocation;
@@ -646,8 +648,7 @@ public class CheckpointCoordinatorTest extends TestLogger {
     @Test
     public void testIOExceptionForPeriodicSchedulingWithInactiveTasks() throws Exception {
         CheckpointCoordinator checkpointCoordinator =
-                setupCheckpointCoordinatorWithInactiveTasks(
-                        new TestingIOExceptionCheckpointIDCounter());
+                setupCheckpointCoordinatorWithInactiveTasks(new IOExceptionCheckpointStorage());
 
         final CompletableFuture<CompletedCheckpoint> onCompletionPromise =
                 checkpointCoordinator.triggerCheckpoint(
@@ -674,14 +675,18 @@ public class CheckpointCoordinatorTest extends TestLogger {
     /** Tests that do not trigger checkpoint when IOException occurred. */
     @Test
     public void testTriggerCheckpointAfterIOException() throws Exception {
-        testTriggerCheckpoint(new TestingIOExceptionCheckpointIDCounter(), IO_EXCEPTION);
+        // given: Checkpoint coordinator which fails on initializeLocationForCheckpoint.
+        CheckpointCoordinator checkpointCoordinator =
+                new CheckpointCoordinatorBuilder()
+                        .setCheckpointStorage(new IOExceptionCheckpointStorage())
+                        .setTimer(manuallyTriggeredScheduledExecutor)
+                        .build();
+        // when: The checkpoint is triggered.
+        testTriggerCheckpoint(checkpointCoordinator, IO_EXCEPTION);
     }
 
     @Test
     public void testCheckpointAbortsIfTriggerTasksAreFinishedAndIOException() throws Exception {
-        TestingIOExceptionCheckpointIDCounter idCounter =
-                new TestingIOExceptionCheckpointIDCounter();
-
         JobVertexID jobVertexID1 = new JobVertexID();
         JobVertexID jobVertexID2 = new JobVertexID();
 
@@ -695,10 +700,9 @@ public class CheckpointCoordinatorTest extends TestLogger {
         CheckpointCoordinator checkpointCoordinator =
                 new CheckpointCoordinatorBuilder()
                         .setExecutionGraph(graph)
-                        .setCheckpointIDCounter(idCounter)
+                        .setCheckpointStorage(new IOExceptionCheckpointStorage())
                         .setTimer(manuallyTriggeredScheduledExecutor)
                         .build();
-        idCounter.setOwner(checkpointCoordinator);
 
         Arrays.stream(graph.getJobVertex(jobVertexID1).getTaskVertices())
                 .forEach(task -> task.getCurrentExecutionAttempt().markFinished());
@@ -2332,7 +2336,7 @@ public class CheckpointCoordinatorTest extends TestLogger {
     @Test
     public void testPeriodicSchedulingWithInactiveTasks() throws Exception {
         CheckpointCoordinator checkpointCoordinator =
-                setupCheckpointCoordinatorWithInactiveTasks(new CheckpointIDCounterWithOwner());
+                setupCheckpointCoordinatorWithInactiveTasks(new MemoryStateBackend());
 
         // the coordinator should start checkpointing now
         manuallyTriggeredScheduledExecutor.triggerPeriodicScheduledTasks();
@@ -2342,7 +2346,7 @@ public class CheckpointCoordinatorTest extends TestLogger {
     }
 
     private CheckpointCoordinator setupCheckpointCoordinatorWithInactiveTasks(
-            CheckpointIDCounterWithOwner checkpointIDCounter) throws Exception {
+            CheckpointStorage checkpointStorage) throws Exception {
         JobVertexID jobVertexID1 = new JobVertexID();
 
         ExecutionGraph graph =
@@ -2360,11 +2364,13 @@ public class CheckpointCoordinatorTest extends TestLogger {
                         .setMinPauseBetweenCheckpoints(0) // no extra delay
                         .setMaxConcurrentCheckpoints(2) // max two concurrent checkpoints
                         .build();
+        CheckpointIDCounterWithOwner checkpointIDCounter = new CheckpointIDCounterWithOwner();
         CheckpointCoordinator checkpointCoordinator =
                 new CheckpointCoordinatorBuilder()
                         .setExecutionGraph(graph)
                         .setCheckpointCoordinatorConfiguration(chkConfig)
                         .setCompletedCheckpointStore(new StandaloneCompletedCheckpointStore(2))
+                        .setCheckpointStorage(checkpointStorage)
                         .setTimer(manuallyTriggeredScheduledExecutor)
                         .setCheckpointIDCounter(checkpointIDCounter)
                         .build();
@@ -3039,14 +3045,7 @@ public class CheckpointCoordinatorTest extends TestLogger {
     /** Tests that do not trigger checkpoint when stop the coordinator after the eager pre-check. */
     @Test
     public void testTriggerCheckpointAfterStopping() throws Exception {
-        testTriggerCheckpoint(new StoppingCheckpointIDCounter(), PERIODIC_SCHEDULER_SHUTDOWN);
-    }
-
-    private void testTriggerCheckpoint(
-            CheckpointIDCounterWithOwner testingCounter,
-            CheckpointFailureReason expectedFailureReason)
-            throws Exception {
-        // set up the coordinator
+        StoppingCheckpointIDCounter testingCounter = new StoppingCheckpointIDCounter();
         CheckpointCoordinator checkpointCoordinator =
                 new CheckpointCoordinatorBuilder()
                         .setCheckpointIDCounter(testingCounter)
@@ -3054,6 +3053,13 @@ public class CheckpointCoordinatorTest extends TestLogger {
                         .build();
         testingCounter.setOwner(checkpointCoordinator);
 
+        testTriggerCheckpoint(checkpointCoordinator, PERIODIC_SCHEDULER_SHUTDOWN);
+    }
+
+    private void testTriggerCheckpoint(
+            CheckpointCoordinator checkpointCoordinator,
+            CheckpointFailureReason expectedFailureReason)
+            throws Exception {
         try {
             // start the coordinator
             checkpointCoordinator.startCheckpointScheduler();
@@ -3784,12 +3790,16 @@ public class CheckpointCoordinatorTest extends TestLogger {
         }
     }
 
-    private static class TestingIOExceptionCheckpointIDCounter
-            extends CheckpointIDCounterWithOwner {
+    private static class IOExceptionCheckpointStorage extends JobManagerCheckpointStorage {
         @Override
-        public long getAndIncrement() throws Exception {
-            checkNotNull(owner);
-            throw new IOException("disk is error!");
+        public CheckpointStorageAccess createCheckpointStorage(JobID jobId) throws IOException {
+            return new MemoryBackendCheckpointStorageAccess(jobId, null, null, 100) {
+                @Override
+                public CheckpointStorageLocation initializeLocationForCheckpoint(long checkpointId)
+                        throws IOException {
+                    throw new IOException("disk is error!");
+                }
+            };
         }
     }
 
