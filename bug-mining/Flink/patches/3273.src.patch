diff --git a/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunction.java b/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunction.java
index 11820e0a262..5ed2c7b2644 100644
--- a/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunction.java
+++ b/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunction.java
@@ -117,6 +117,9 @@ public class RetractableTopNFunction extends AbstractTopNFunction {
 
 	@Override
 	public void processElement(BaseRow input, Context ctx, Collector<BaseRow> out) throws Exception {
+		long currentTime = ctx.timerService().currentProcessingTime();
+		// register state-cleanup timer
+		registerProcessingCleanupTimer(ctx, currentTime);
 		initRankEnd(input);
 		SortedMap<BaseRow, Long> sortedMap = treeMap.value();
 		if (sortedMap == null) {
@@ -171,6 +174,13 @@ public class RetractableTopNFunction extends AbstractTopNFunction {
 		treeMap.update(sortedMap);
 	}
 
+	@Override
+	public void onTimer(long timestamp, OnTimerContext ctx, Collector<BaseRow> out) throws Exception {
+		if (stateCleaningEnabled) {
+			cleanupState(dataState, treeMap);
+		}
+	}
+
 	// ------------- ROW_NUMBER-------------------------------
 
 	private void retractRecordWithRowNumber(
diff --git a/flink-table/flink-table-runtime-blink/src/test/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunctionTest.java b/flink-table/flink-table-runtime-blink/src/test/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunctionTest.java
index e404b4186b6..f852ca13843 100644
--- a/flink-table/flink-table-runtime-blink/src/test/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunctionTest.java
+++ b/flink-table/flink-table-runtime-blink/src/test/java/org/apache/flink/table/runtime/operators/rank/RetractableTopNFunctionTest.java
@@ -219,4 +219,38 @@ public class RetractableTopNFunctionTest extends TopNFunctionTestBase {
 				.assertOutputEqualsSorted("output wrong.", expectedOutput, testHarness.getOutput());
 	}
 
+	@Test
+	public void testCleanIdleState() throws Exception {
+		AbstractTopNFunction func = createFunction(RankType.ROW_NUMBER, new ConstantRankRange(1, 2), true,
+			true);
+		OneInputStreamOperatorTestHarness<BaseRow, BaseRow> testHarness = createTestHarness(func);
+		testHarness.open();
+		// register cleanup timer with 20L
+		testHarness.setProcessingTime(0L);
+		testHarness.processElement(record("book", 1L, 12));
+		testHarness.processElement(record("fruit", 5L, 22));
+
+		// register cleanup timer with 29L
+		testHarness.setProcessingTime(9L);
+		testHarness.processElement(retractRecord("book", 1L, 12));
+		testHarness.processElement(record("fruit", 4L, 11));
+
+		// trigger the first cleanup timer and register cleanup timer with 4000
+		testHarness.setProcessingTime(20L);
+		testHarness.processElement(record("fruit", 8L, 100));
+		testHarness.processElement(record("book", 1L, 12));
+		testHarness.close();
+
+		List<Object> expectedOutput = new ArrayList<>();
+		expectedOutput.add(record("book", 1L, 12, 1L));
+		expectedOutput.add(record("fruit", 5L, 22, 1L));
+		expectedOutput.add(deleteRecord("book", 1L, 12, 1L));
+		expectedOutput.add(deleteRecord("fruit", 5L, 22, 1L));
+		expectedOutput.add(record("fruit", 5L, 22, 2L));
+		expectedOutput.add(record("fruit", 4L, 11, 1L));
+		// after idle state expired
+		expectedOutput.add(record("fruit", 8L, 100, 1L));
+		expectedOutput.add(record("book", 1L, 12, 1L));
+		assertorWithRowNumber.assertOutputEqualsSorted("output wrong.", expectedOutput, testHarness.getOutput());
+	}
 }
