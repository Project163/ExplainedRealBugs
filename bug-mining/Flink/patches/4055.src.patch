diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java
index e84cd1475a7..00a38c9cd24 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/util/bash/BashJavaUtils.java
@@ -27,8 +27,11 @@ import org.apache.flink.runtime.clusterframework.TaskExecutorProcessUtils;
 import org.apache.flink.runtime.jobmanager.JobManagerProcessSpec;
 import org.apache.flink.runtime.jobmanager.JobManagerProcessUtils;
 import org.apache.flink.runtime.util.config.memory.ProcessMemoryUtils;
+import org.apache.flink.util.FlinkException;
 
 import java.util.Arrays;
+import java.util.Collections;
+import java.util.List;
 
 import static org.apache.flink.util.Preconditions.checkArgument;
 
@@ -40,18 +43,27 @@ public class BashJavaUtils {
 	@VisibleForTesting
 	public static final String EXECUTION_PREFIX = "BASH_JAVA_UTILS_EXEC_RESULT:";
 
-	public static void main(String[] args) throws Exception {
+	private BashJavaUtils() {
+	}
+
+	public static void main(String[] args) throws FlinkException {
 		checkArgument(args.length > 0, "Command not specified.");
 
+		Command command = Command.valueOf(args[0]);
 		String[] commandArgs = Arrays.copyOfRange(args, 1, args.length);
+		List<String> output = runCommand(command, commandArgs);
+		for (String outputLine : output) {
+			System.out.println(EXECUTION_PREFIX + outputLine);
+		}
+	}
 
-		switch (Command.valueOf(args[0])) {
+	private static List<String> runCommand(Command command, String[] commandArgs) throws FlinkException {
+		Configuration configuration = FlinkConfigLoader.loadConfiguration(commandArgs);
+		switch (command) {
 			case GET_TM_RESOURCE_PARAMS:
-				getTmResourceParams(commandArgs);
-				break;
+				return getTmResourceParams(configuration);
 			case GET_JM_RESOURCE_PARAMS:
-				getJmResourceParams(commandArgs);
-				break;
+				return getJmResourceParams(configuration);
 			default:
 				// unexpected, Command#valueOf should fail if a unknown command is passed in
 				throw new RuntimeException("Unexpected, something is wrong.");
@@ -62,24 +74,25 @@ public class BashJavaUtils {
 	 * Generate and print JVM parameters and dynamic configs of task executor resources. The last two lines of
 	 * the output should be JVM parameters and dynamic configs respectively.
 	 */
-	private static void getTmResourceParams(String[] args) throws Exception {
-		Configuration configuration = getConfigurationForStandaloneTaskManagers(args);
-		TaskExecutorProcessSpec taskExecutorProcessSpec = TaskExecutorProcessUtils.processSpecFromConfig(configuration);
-		System.out.println(EXECUTION_PREFIX + ProcessMemoryUtils.generateJvmParametersStr(taskExecutorProcessSpec));
-		System.out.println(EXECUTION_PREFIX + TaskExecutorProcessUtils.generateDynamicConfigsStr(taskExecutorProcessSpec));
+	private static List<String> getTmResourceParams(Configuration configuration) {
+		Configuration configurationWithFallback = TaskExecutorProcessUtils.getConfigurationMapLegacyTaskManagerHeapSizeToConfigOption(
+			configuration,
+			TaskManagerOptions.TOTAL_FLINK_MEMORY);
+		TaskExecutorProcessSpec taskExecutorProcessSpec = TaskExecutorProcessUtils.processSpecFromConfig(configurationWithFallback);
+		return Arrays.asList(
+			ProcessMemoryUtils.generateJvmParametersStr(taskExecutorProcessSpec),
+			TaskExecutorProcessUtils.generateDynamicConfigsStr(taskExecutorProcessSpec));
 	}
 
-	private static Configuration getConfigurationForStandaloneTaskManagers(String[] args) throws Exception {
-		Configuration configuration = FlinkConfigLoader.loadConfiguration(args);
-		return TaskExecutorProcessUtils.getConfigurationMapLegacyTaskManagerHeapSizeToConfigOption(
-			configuration, TaskManagerOptions.TOTAL_FLINK_MEMORY);
-	}
-
-	private static void getJmResourceParams(String[] args) throws Exception {
+	/**
+	 * Generate and print JVM parameters of Flink Master resources as one line.
+	 */
+	@VisibleForTesting
+	static List<String> getJmResourceParams(Configuration configuration) {
 		JobManagerProcessSpec jobManagerProcessSpec = JobManagerProcessUtils.processSpecFromConfigWithFallbackForLegacyHeap(
-			FlinkConfigLoader.loadConfiguration(args),
-			JobManagerOptions.TOTAL_FLINK_MEMORY);
-		System.out.println(EXECUTION_PREFIX + ProcessMemoryUtils.generateJvmParametersStr(jobManagerProcessSpec));
+			configuration,
+			JobManagerOptions.JVM_HEAP_MEMORY);
+		return Collections.singletonList(ProcessMemoryUtils.generateJvmParametersStr(jobManagerProcessSpec));
 	}
 
 	/**
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/util/bash/BashJavaUtilsTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/util/bash/BashJavaUtilsTest.java
new file mode 100644
index 00000000000..12f093265f6
--- /dev/null
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/util/bash/BashJavaUtilsTest.java
@@ -0,0 +1,49 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.runtime.util.bash;
+
+import org.apache.flink.configuration.Configuration;
+import org.apache.flink.configuration.ConfigurationUtils;
+import org.apache.flink.configuration.JobManagerOptions;
+import org.apache.flink.configuration.MemorySize;
+import org.apache.flink.util.TestLogger;
+
+import org.junit.Test;
+
+import java.util.Map;
+
+import static org.hamcrest.CoreMatchers.is;
+import static org.junit.Assert.assertThat;
+
+/**
+ * Tests for {@link BashJavaUtils}
+ */
+public class BashJavaUtilsTest extends TestLogger {
+	@Test
+	public void testJmLegacyHeapOptionSetsNewJvmHeap() {
+		Configuration configuration = new Configuration();
+		MemorySize heapSize = MemorySize.ofMebiBytes(10);
+		configuration.set(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, heapSize);
+		String jvmArgsLine = BashJavaUtils.getJmResourceParams(configuration).get(0);
+		Map<String, String> jvmArgs = ConfigurationUtils.parseJvmArgString(jvmArgsLine);
+		String heapSizeStr = Long.toString(heapSize.getBytes());
+		assertThat(jvmArgs.get("-Xmx"), is(heapSizeStr));
+		assertThat(jvmArgs.get("-Xms"), is(heapSizeStr));
+	}
+}
