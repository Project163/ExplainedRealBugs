diff --git a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/CachingLookupFunction.java b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/CachingLookupFunction.java
index 7d034c12f93..fe604eb606a 100644
--- a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/CachingLookupFunction.java
+++ b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/CachingLookupFunction.java
@@ -105,6 +105,8 @@ public class CachingLookupFunction extends LookupFunction {
             cacheMetricGroup.loadCounter(loadCounter);
             numLoadFailuresCounter = new SimpleCounter();
             cacheMetricGroup.numLoadFailuresCounter(numLoadFailuresCounter);
+        } else {
+            initializeFullCache(((LookupFullCache) cache), context);
         }
         // Initialize cache and the delegating function
         cache.open(cacheMetricGroup);
@@ -177,4 +179,8 @@ public class CachingLookupFunction extends LookupFunction {
         }
         latestLoadTime = loadTime;
     }
+
+    private void initializeFullCache(LookupFullCache lookupFullCache, FunctionContext context) {
+        lookupFullCache.setUserCodeClassLoader(context.getUserCodeClassLoader());
+    }
 }
diff --git a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/CacheLoader.java b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/CacheLoader.java
index d76d1ab6cb4..639c76f3ded 100644
--- a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/CacheLoader.java
+++ b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/CacheLoader.java
@@ -68,9 +68,16 @@ public abstract class CacheLoader implements AutoCloseable, Serializable {
     /** @return whether reload was successful and was not interrupted. */
     protected abstract boolean updateCache() throws Exception;
 
-    public void open(Configuration parameters) throws Exception {
+    public void open(Configuration parameters, ClassLoader userCodeClassLoader) throws Exception {
         firstLoadLatch = new CountDownLatch(1);
-        reloadExecutor = Executors.newSingleThreadExecutor();
+        reloadExecutor =
+                Executors.newSingleThreadExecutor(
+                        r -> {
+                            Thread thread = Executors.defaultThreadFactory().newThread(r);
+                            thread.setName("full-cache-loader-executor");
+                            thread.setContextClassLoader(userCodeClassLoader);
+                            return thread;
+                        });
     }
 
     public void initializeMetrics(CacheMetricGroup cacheMetricGroup) {
diff --git a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/LookupFullCache.java b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/LookupFullCache.java
index 87950b62e8e..9795ff82866 100644
--- a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/LookupFullCache.java
+++ b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/LookupFullCache.java
@@ -28,11 +28,12 @@ import org.apache.flink.table.connector.source.lookup.LookupOptions.LookupCacheT
 import org.apache.flink.table.connector.source.lookup.cache.LookupCache;
 import org.apache.flink.table.connector.source.lookup.cache.trigger.CacheReloadTrigger;
 import org.apache.flink.table.data.RowData;
-import org.apache.flink.util.Preconditions;
 
 import java.util.Collection;
 import java.util.Collections;
 
+import static org.apache.flink.util.Preconditions.checkNotNull;
+
 /** Internal implementation of {@link LookupCache} for {@link LookupCacheType#FULL}. */
 @Internal
 public class LookupFullCache implements LookupCache {
@@ -47,9 +48,15 @@ public class LookupFullCache implements LookupCache {
     // Cache metrics
     private transient Counter hitCounter; // equals to number of requests
 
+    private transient ClassLoader userCodeClassLoader;
+
     public LookupFullCache(CacheLoader cacheLoader, CacheReloadTrigger reloadTrigger) {
-        this.cacheLoader = Preconditions.checkNotNull(cacheLoader);
-        this.reloadTrigger = Preconditions.checkNotNull(reloadTrigger);
+        this.cacheLoader = checkNotNull(cacheLoader);
+        this.reloadTrigger = checkNotNull(reloadTrigger);
+    }
+
+    public void setUserCodeClassLoader(ClassLoader userCodeClassLoader) {
+        this.userCodeClassLoader = userCodeClassLoader;
     }
 
     @Override
@@ -64,7 +71,10 @@ public class LookupFullCache implements LookupCache {
         if (reloadTriggerContext == null) {
             try {
                 // TODO add Configuration into FunctionContext and pass in into LookupFullCache
-                cacheLoader.open(new Configuration());
+                checkNotNull(
+                        userCodeClassLoader,
+                        "User code classloader must be initialized before opening full cache");
+                cacheLoader.open(new Configuration(), userCodeClassLoader);
                 reloadTriggerContext =
                         new ReloadTriggerContext(
                                 cacheLoader::reloadAsync,
diff --git a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/inputformat/InputFormatCacheLoader.java b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/inputformat/InputFormatCacheLoader.java
index cbd06e0f028..2df2a798ccd 100644
--- a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/inputformat/InputFormatCacheLoader.java
+++ b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/functions/table/lookup/fullcache/inputformat/InputFormatCacheLoader.java
@@ -65,8 +65,8 @@ public class InputFormatCacheLoader extends CacheLoader {
     }
 
     @Override
-    public void open(Configuration parameters) throws Exception {
-        super.open(parameters);
+    public void open(Configuration parameters, ClassLoader userCodeClassLoader) throws Exception {
+        super.open(parameters, userCodeClassLoader);
         this.parameters = parameters;
         this.initialInputFormat.configure(parameters);
     }
diff --git a/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/LookupFullCacheTest.java b/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/LookupFullCacheTest.java
index bbda500889e..7466d82003a 100644
--- a/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/LookupFullCacheTest.java
+++ b/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/LookupFullCacheTest.java
@@ -162,6 +162,8 @@ public class LookupFullCacheTest {
                         runAsync(
                                 ThrowingRunnable.unchecked(
                                         () -> {
+                                            cache.setUserCodeClassLoader(
+                                                    Thread.currentThread().getContextClassLoader());
                                             cache.open(metricGroup);
                                         }),
                                 executor);
@@ -203,6 +205,7 @@ public class LookupFullCacheTest {
         LookupFullCache fullCache = new LookupFullCache(cacheLoader, reloadTrigger);
         assertThat(cacheLoader.isAwaitTriggered()).isFalse();
         assertThat(cacheLoader.getNumLoads()).isZero();
+        fullCache.setUserCodeClassLoader(Thread.currentThread().getContextClassLoader());
         fullCache.open(metricGroup);
         assertThat(cacheLoader.isAwaitTriggered()).isTrue();
         assertThat(cacheLoader.getNumLoads()).isEqualTo(1);
diff --git a/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/inputformat/InputFormatCacheLoaderTest.java b/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/inputformat/InputFormatCacheLoaderTest.java
index 954092bc34b..28eb0e7b1c6 100644
--- a/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/inputformat/InputFormatCacheLoaderTest.java
+++ b/flink-table/flink-table-runtime/src/test/java/org/apache/flink/table/runtime/functions/table/fullcache/inputformat/InputFormatCacheLoaderTest.java
@@ -241,7 +241,7 @@ class InputFormatCacheLoaderTest {
                         generatedProjection);
         InputFormatCacheLoader cacheLoader =
                 new InputFormatCacheLoader(inputFormat, keySelector, rightRowSerializer);
-        cacheLoader.open(new Configuration());
+        cacheLoader.open(new Configuration(), Thread.currentThread().getContextClassLoader());
         return cacheLoader;
     }
 }
