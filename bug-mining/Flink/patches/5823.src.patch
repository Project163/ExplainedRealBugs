diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointCompletedEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointCompletedEvent.java
index 35718bbb78c..88420909a8d 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointCompletedEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointCompletedEvent.java
@@ -30,8 +30,9 @@ import java.util.Objects;
 public class CheckpointCompletedEvent extends TestEvent {
     public final long checkpointID;
 
-    public CheckpointCompletedEvent(String operatorId, int subtaskIndex, long checkpointID) {
-        super(operatorId, subtaskIndex);
+    public CheckpointCompletedEvent(
+            String operatorId, int subtaskIndex, int attemptNumber, long checkpointID) {
+        super(operatorId, subtaskIndex, attemptNumber);
         this.checkpointID = checkpointID;
     }
 
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointStartedEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointStartedEvent.java
index 8d8b1463b95..d8bea669ce2 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointStartedEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/CheckpointStartedEvent.java
@@ -31,8 +31,9 @@ import java.util.Objects;
 public class CheckpointStartedEvent extends TestEvent {
     public final long checkpointID;
 
-    public CheckpointStartedEvent(String operatorId, int subtaskIndex, long checkpointID) {
-        super(operatorId, subtaskIndex);
+    public CheckpointStartedEvent(
+            String operatorId, int subtaskIndex, int attemptNumber, long checkpointID) {
+        super(operatorId, subtaskIndex, attemptNumber);
         this.checkpointID = checkpointID;
     }
 
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/InputEndedEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/InputEndedEvent.java
index 47a8115bb98..33e2b8031f9 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/InputEndedEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/InputEndedEvent.java
@@ -30,8 +30,8 @@ import java.util.Objects;
 public class InputEndedEvent extends TestEvent {
     public final int inputId;
 
-    public InputEndedEvent(String operatorId, int subtaskIndex, int inputId) {
-        super(operatorId, subtaskIndex);
+    public InputEndedEvent(String operatorId, int subtaskIndex, int attemptNumber, int inputId) {
+        super(operatorId, subtaskIndex, attemptNumber);
         this.inputId = inputId;
     }
 
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorFinishedEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorFinishedEvent.java
index 093ebb711a8..ce9bf0bfd8c 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorFinishedEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorFinishedEvent.java
@@ -38,9 +38,10 @@ public class OperatorFinishedEvent extends TestEvent {
     public OperatorFinishedEvent(
             String operatorId,
             int subtaskIndex,
+            int attemptNumber,
             long lastSent,
             LastReceivedVertexDataInfo receiveInfo) {
-        super(operatorId, subtaskIndex);
+        super(operatorId, subtaskIndex, attemptNumber);
         this.receiveInfo = receiveInfo;
         this.lastSent = lastSent;
     }
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorStartedEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorStartedEvent.java
index 10dcb7aee3b..2f839902b03 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorStartedEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/OperatorStartedEvent.java
@@ -22,7 +22,7 @@ public class OperatorStartedEvent extends TestEvent {
     private final int attemptNumber;
 
     public OperatorStartedEvent(String operatorId, int subtaskIndex, int attemptNumber) {
-        super(operatorId, subtaskIndex);
+        super(operatorId, subtaskIndex, attemptNumber);
         this.attemptNumber = attemptNumber;
     }
 
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestCommandAckEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestCommandAckEvent.java
index 049ff814326..bc21fdca9b2 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestCommandAckEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestCommandAckEvent.java
@@ -26,7 +26,7 @@ public class TestCommandAckEvent extends TestEvent {
 
     public TestCommandAckEvent(
             String operatorId, int subtaskIndex, int attemptNumber, TestCommand command) {
-        super(operatorId, subtaskIndex);
+        super(operatorId, subtaskIndex, attemptNumber);
         this.command = command;
         this.attemptNumber = attemptNumber;
     }
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestEvent.java
index 78e7da58f6b..4504789ba71 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/TestEvent.java
@@ -30,11 +30,13 @@ import java.util.Objects;
 public abstract class TestEvent implements Serializable {
     public final String operatorId;
     public final int subtaskIndex;
+    public final int attemptNumber;
     private static final long serialVersionUID = 1L;
 
-    TestEvent(String operatorId, int subtaskIndex) {
+    TestEvent(String operatorId, int subtaskIndex, int attemptNumber) {
         this.operatorId = operatorId;
         this.subtaskIndex = subtaskIndex;
+        this.attemptNumber = attemptNumber;
     }
 
     @Override
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/WatermarkReceivedEvent.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/WatermarkReceivedEvent.java
index 5d2613fe1a3..1c00657e953 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/WatermarkReceivedEvent.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/event/WatermarkReceivedEvent.java
@@ -32,8 +32,9 @@ public class WatermarkReceivedEvent extends TestEvent {
     public final long ts;
     public final int inputId;
 
-    public WatermarkReceivedEvent(String operatorId, int subtaskIndex, long ts, int inputId) {
-        super(operatorId, subtaskIndex);
+    public WatermarkReceivedEvent(
+            String operatorId, int subtaskIndex, int attemptNumber, long ts, int inputId) {
+        super(operatorId, subtaskIndex, attemptNumber);
         this.ts = ts;
         this.inputId = inputId;
     }
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/MultiInputTestOperator.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/MultiInputTestOperator.java
index 110ed301f4e..81a6758ab84 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/MultiInputTestOperator.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/MultiInputTestOperator.java
@@ -81,6 +81,7 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
                                                 output,
                                                 operatorId,
                                                 getRuntimeContext().getIndexOfThisSubtask(),
+                                                getRuntimeContext().getAttemptNumber(),
                                                 lastDataReceived,
                                                 lastDataSent))
                         .collect(Collectors.toList());
@@ -110,6 +111,7 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
                 new OperatorFinishedEvent(
                         operatorId,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         lastDataSent.get(),
                         new LastReceivedVertexDataInfo(lastDataReceived)));
         super.finish();
@@ -121,6 +123,7 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
                 new CheckpointStartedEvent(
                         operatorId,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         context.getCheckpointId()));
         super.snapshotState(context);
     }
@@ -129,7 +132,10 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
     public void notifyCheckpointComplete(long checkpointId) throws Exception {
         eventQueue.add(
                 new CheckpointCompletedEvent(
-                        operatorId, getRuntimeContext().getIndexOfThisSubtask(), checkpointId));
+                        operatorId,
+                        getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
+                        checkpointId));
         super.notifyCheckpointComplete(checkpointId);
     }
 
@@ -147,7 +153,10 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
     public void endInput(int inputId) throws Exception {
         eventQueue.add(
                 new InputEndedEvent(
-                        operatorId, getRuntimeContext().getIndexOfThisSubtask(), inputId));
+                        operatorId,
+                        getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
+                        inputId));
     }
 
     private static class TestEventInput implements Input<TestDataElement> {
@@ -158,6 +167,7 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
         private final int subtaskIndex;
         private final Map<String, OperatorFinishedEvent.LastVertexDataInfo> lastDataReceived;
         private final AtomicLong lastDataSent;
+        private final int attemptNumber;
 
         public TestEventInput(
                 int id,
@@ -165,6 +175,7 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
                 Output<StreamRecord<TestDataElement>> output,
                 String operatorId,
                 int subtaskIndex,
+                int attemptNumber,
                 Map<String, OperatorFinishedEvent.LastVertexDataInfo> lastDataReceived,
                 AtomicLong lastDataSent) {
             this.id = id;
@@ -174,6 +185,7 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
             this.subtaskIndex = subtaskIndex;
             this.lastDataReceived = lastDataReceived;
             this.lastDataSent = lastDataSent;
+            this.attemptNumber = attemptNumber;
         }
 
         @Override
@@ -193,7 +205,8 @@ class MultiInputTestOperator extends AbstractStreamOperatorV2<TestDataElement>
         @Override
         public void processWatermark(Watermark mark) throws Exception {
             eventQueue.add(
-                    new WatermarkReceivedEvent(operatorId, subtaskIndex, mark.getTimestamp(), id));
+                    new WatermarkReceivedEvent(
+                            operatorId, subtaskIndex, attemptNumber, mark.getTimestamp(), id));
             output.emitWatermark(mark);
         }
 
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/OneInputTestStreamOperator.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/OneInputTestStreamOperator.java
index 96d6239790d..e1b8d42d246 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/OneInputTestStreamOperator.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/OneInputTestStreamOperator.java
@@ -73,6 +73,7 @@ class OneInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new CheckpointStartedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         context.getCheckpointId()));
         super.snapshotState(context);
     }
@@ -81,7 +82,10 @@ class OneInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
     public void notifyCheckpointComplete(long checkpointId) throws Exception {
         eventQueue.add(
                 new CheckpointCompletedEvent(
-                        operatorID, getRuntimeContext().getIndexOfThisSubtask(), checkpointId));
+                        operatorID,
+                        getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
+                        checkpointId));
         super.notifyCheckpointComplete(checkpointId);
     }
 
@@ -91,6 +95,7 @@ class OneInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new OperatorFinishedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         lastDataSent,
                         new OperatorFinishedEvent.LastReceivedVertexDataInfo(lastDataReceived)));
         super.finish();
@@ -121,6 +126,7 @@ class OneInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new WatermarkReceivedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         mark.getTimestamp(),
                         1));
         super.processWatermark(mark);
@@ -129,7 +135,11 @@ class OneInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
     @Override
     public void endInput() throws Exception {
         eventQueue.add(
-                new InputEndedEvent(operatorID, getRuntimeContext().getIndexOfThisSubtask(), 1));
+                new InputEndedEvent(
+                        operatorID,
+                        getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
+                        1));
     }
 
     @Override
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TestEventSource.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TestEventSource.java
index c899e801ef4..0d32de9cff7 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TestEventSource.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TestEventSource.java
@@ -98,6 +98,7 @@ class TestEventSource extends RichSourceFunction<TestDataElement>
                     new OperatorFinishedEvent(
                             operatorID,
                             getRuntimeContext().getIndexOfThisSubtask(),
+                            getRuntimeContext().getAttemptNumber(),
                             lastSent,
                             new LastReceivedVertexDataInfo(emptyMap())));
         }
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TwoInputTestStreamOperator.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TwoInputTestStreamOperator.java
index 3d8a2892475..995f524a2d1 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TwoInputTestStreamOperator.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/graph/TwoInputTestStreamOperator.java
@@ -74,6 +74,7 @@ class TwoInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new CheckpointStartedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         context.getCheckpointId()));
         super.snapshotState(context);
     }
@@ -82,7 +83,10 @@ class TwoInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
     public void notifyCheckpointComplete(long checkpointId) throws Exception {
         collectEvent(
                 new CheckpointCompletedEvent(
-                        operatorID, getRuntimeContext().getIndexOfThisSubtask(), checkpointId));
+                        operatorID,
+                        getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
+                        checkpointId));
         super.notifyCheckpointComplete(checkpointId);
     }
 
@@ -92,6 +96,7 @@ class TwoInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new OperatorFinishedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         lastDataSent,
                         new LastReceivedVertexDataInfo(lastDataReceived)));
         super.finish();
@@ -122,6 +127,7 @@ class TwoInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new WatermarkReceivedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         mark.getTimestamp(),
                         1));
         super.processWatermark1(mark);
@@ -133,6 +139,7 @@ class TwoInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
                 new WatermarkReceivedEvent(
                         operatorID,
                         getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
                         mark.getTimestamp(),
                         2));
         super.processWatermark2(mark);
@@ -152,7 +159,10 @@ class TwoInputTestStreamOperator extends AbstractStreamOperator<TestDataElement>
     public void endInput(int inputId) throws Exception {
         collectEvent(
                 new InputEndedEvent(
-                        operatorID, getRuntimeContext().getIndexOfThisSubtask(), inputId));
+                        operatorID,
+                        getRuntimeContext().getIndexOfThisSubtask(),
+                        getRuntimeContext().getAttemptNumber(),
+                        inputId));
     }
 
     @Override
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/validation/DrainingValidator.java b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/validation/DrainingValidator.java
index c6e3f59520a..e36fe2022e3 100644
--- a/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/validation/DrainingValidator.java
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/operators/lifecycle/validation/DrainingValidator.java
@@ -21,14 +21,21 @@ import org.apache.flink.runtime.OperatorIDPair;
 import org.apache.flink.runtime.jobgraph.JobVertex;
 import org.apache.flink.runtime.jobgraph.OperatorID;
 import org.apache.flink.runtime.operators.lifecycle.TestJobWithDescription;
+import org.apache.flink.runtime.operators.lifecycle.command.TestCommand;
 import org.apache.flink.runtime.operators.lifecycle.event.InputEndedEvent;
+import org.apache.flink.runtime.operators.lifecycle.event.TestCommandAckEvent;
 import org.apache.flink.runtime.operators.lifecycle.event.TestEvent;
 import org.apache.flink.runtime.operators.lifecycle.event.WatermarkReceivedEvent;
 import org.apache.flink.streaming.api.watermark.Watermark;
 
+import java.util.ArrayList;
 import java.util.BitSet;
+import java.util.HashMap;
+import java.util.HashSet;
 import java.util.List;
+import java.util.Map;
 import java.util.NoSuchElementException;
+import java.util.Set;
 
 import static java.lang.String.format;
 import static org.junit.Assert.assertEquals;
@@ -47,21 +54,55 @@ public class DrainingValidator implements TestOperatorLifecycleValidator {
             String operatorId,
             int subtaskIndex,
             List<TestEvent> operatorEvents) {
+
+        Map<Integer, List<TestEvent>> byAttempt = new HashMap<>();
+        Set<Integer> normallyFinishedAttempts = new HashSet<>();
+        int lastAttempt = Integer.MIN_VALUE;
+        for (TestEvent e : operatorEvents) {
+            byAttempt.computeIfAbsent(e.attemptNumber, ign -> new ArrayList<>()).add(e);
+            if (isFinishAck(e)) {
+                normallyFinishedAttempts.add(e.attemptNumber);
+            }
+            lastAttempt = Math.max(lastAttempt, e.attemptNumber);
+        }
+
+        for (Map.Entry<Integer, List<TestEvent>> entry : byAttempt.entrySet()) {
+            // Validate if:
+            // - finished normally, last attempt
+            // - finished normally, recovered, finished - both attempts must emit MAX_WATERMARK and
+            // end input
+            // Skip if this or other task from this attempt failed.
+            if (lastAttempt == entry.getKey()
+                    || normallyFinishedAttempts.contains(entry.getKey())) {
+                validateSubtaskAttempt(job, operatorId, subtaskIndex, entry.getValue());
+            }
+        }
+    }
+
+    private void validateSubtaskAttempt(
+            TestJobWithDescription job,
+            String operatorId,
+            int subtaskIndex,
+            List<TestEvent> operatorEvents) {
         BitSet endedInputs = new BitSet();
         BitSet inputsWithMaxWatermark = new BitSet();
         for (TestEvent ev : operatorEvents) {
             if (ev instanceof WatermarkReceivedEvent) {
                 WatermarkReceivedEvent w = (WatermarkReceivedEvent) ev;
                 if (w.ts == Watermark.MAX_WATERMARK.getTimestamp()) {
-                    assertFalse(inputsWithMaxWatermark.get(w.inputId));
+                    assertFalse(
+                            String.format(
+                                    "Max Watermark received twice by %s/%d/%d",
+                                    w.operatorId, w.subtaskIndex, w.inputId),
+                            inputsWithMaxWatermark.get(w.inputId));
                     inputsWithMaxWatermark.set(w.inputId);
                 }
             } else if (ev instanceof InputEndedEvent) {
                 InputEndedEvent w = (InputEndedEvent) ev;
                 assertTrue(
                         format(
-                                "Input %d ended before receiving max watermark by %s[%d]",
-                                w.inputId, operatorId, subtaskIndex),
+                                "Input %d ended before receiving max watermark by %s[%d]#%d",
+                                w.inputId, operatorId, subtaskIndex, w.attemptNumber),
                         inputsWithMaxWatermark.get(w.inputId));
                 assertFalse(endedInputs.get(w.inputId));
                 endedInputs.set(w.inputId);
@@ -73,6 +114,11 @@ public class DrainingValidator implements TestOperatorLifecycleValidator {
                 endedInputs.cardinality());
     }
 
+    private boolean isFinishAck(TestEvent ev) {
+        return ev instanceof TestCommandAckEvent
+                && ((TestCommandAckEvent) ev).getCommand() == TestCommand.FINISH_SOURCES;
+    }
+
     private static int getNumInputs(TestJobWithDescription testJob, String operator) {
         Integer explicitNumInputs = testJob.operatorsNumberOfInputs.get(operator);
         if (explicitNumInputs != null) {
