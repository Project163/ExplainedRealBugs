diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamMultipleInputProcessorFactory.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamMultipleInputProcessorFactory.java
index 3b99c9ad9bf..a7b431db48c 100644
--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamMultipleInputProcessorFactory.java
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamMultipleInputProcessorFactory.java
@@ -137,7 +137,8 @@ public class StreamMultipleInputProcessorFactory {
 				executionConfig.isObjectReuseEnabled(),
 				streamConfig.getManagedMemoryFractionOperatorUseCaseOfSlot(
 					ManagedMemoryUseCase.BATCH_OP,
-					taskManagerConfig
+					taskManagerConfig,
+					userClassloader
 				),
 				jobConfig
 			);
diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamTwoInputProcessorFactory.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamTwoInputProcessorFactory.java
index 6063e7fb2cb..f4c588002e1 100644
--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamTwoInputProcessorFactory.java
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/io/StreamTwoInputProcessorFactory.java
@@ -108,7 +108,8 @@ public class StreamTwoInputProcessorFactory {
 				executionConfig.isObjectReuseEnabled(),
 				streamConfig.getManagedMemoryFractionOperatorUseCaseOfSlot(
 					ManagedMemoryUseCase.BATCH_OP,
-					taskManagerConfig
+					taskManagerConfig,
+					userClassloader
 				),
 				jobConfig
 			);
diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/OneInputStreamTask.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/OneInputStreamTask.java
index 6495fb7066a..a51e97240dd 100644
--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/OneInputStreamTask.java
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/OneInputStreamTask.java
@@ -123,7 +123,7 @@ public class OneInputStreamTask<IN, OUT> extends StreamTask<OUT, OneInputStreamO
 			configuration.getManagedMemoryFractionOperatorUseCaseOfSlot(
 				ManagedMemoryUseCase.BATCH_OP,
 				getTaskConfiguration(),
-				getEnvironment().getUserCodeClassLoader().asClassLoader()),
+				userCodeClassLoader),
 			getJobConfiguration(),
 			this
 		);
