diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java
index 9234c9f1c95..c37fef08618 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java
@@ -208,7 +208,7 @@ public class FsCheckpointStreamFactory implements CheckpointStreamFactory {
 
 		@Override
 		public void write(int b) throws IOException {
-			if (outStream != null || pos >= writeBuffer.length) {
+			if (pos >= writeBuffer.length) {
 				flushToFile();
 			}
 			writeBuffer[pos++] = (byte) b;
@@ -269,7 +269,7 @@ public class FsCheckpointStreamFactory implements CheckpointStreamFactory {
 		 */
 		@Override
 		public void flush() throws IOException {
-			if (pos > localStateThreshold) {
+			if (outStream != null || pos > localStateThreshold) {
 				flushToFile();
 			}
 		}
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactoryTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactoryTest.java
index 88fea13ad55..53d77464c6a 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactoryTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactoryTest.java
@@ -57,6 +57,22 @@ public class FsCheckpointStreamFactoryTest {
 	//  tests
 	// ------------------------------------------------------------------------
 
+	@Test
+	@SuppressWarnings("ConstantConditions")
+	public void testWriteFlushesIfAboveThreshold() throws IOException {
+		int fileSizeThreshold = 100;
+		final FsCheckpointStreamFactory factory = createFactory(FileSystem.getLocalFileSystem(), fileSizeThreshold, fileSizeThreshold);
+		final FsCheckpointStreamFactory.FsCheckpointStateOutputStream stream = factory.createCheckpointStateOutputStream(CheckpointedStateScope.EXCLUSIVE);
+		stream.write(new byte[fileSizeThreshold]);
+		File[] files = new File(exclusiveStateDir.toUri()).listFiles();
+		assertEquals(1, files.length);
+		File file = files[0];
+		assertEquals(fileSizeThreshold, file.length());
+		stream.write(new byte[fileSizeThreshold - 1]); // should buffer without flushing
+		stream.write(127); // should buffer without flushing
+		assertEquals(fileSizeThreshold, file.length());
+	}
+
 	@Test
 	public void testExclusiveStateHasRelativePathHandles() throws IOException {
 		final FsCheckpointStreamFactory factory = createFactory(FileSystem.getLocalFileSystem(), 0);
@@ -129,6 +145,10 @@ public class FsCheckpointStreamFactoryTest {
 	}
 
 	private FsCheckpointStreamFactory createFactory(FileSystem fs, int fileSizeThreshold) {
-		return new FsCheckpointStreamFactory(fs, exclusiveStateDir, sharedStateDir, fileSizeThreshold, 4096);
+		return createFactory(fs, fileSizeThreshold, 4096);
+	}
+
+	private FsCheckpointStreamFactory createFactory(FileSystem fs, int fileSizeThreshold, int bufferSize) {
+		return new FsCheckpointStreamFactory(fs, exclusiveStateDir, sharedStateDir, fileSizeThreshold, bufferSize);
 	}
 }
