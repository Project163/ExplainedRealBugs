diff --git a/flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivity.scala b/flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivity.scala
index ffcb6c9d27b..0768057f15d 100644
--- a/flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivity.scala
+++ b/flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivity.scala
@@ -19,6 +19,7 @@ package org.apache.flink.table.planner.plan.metadata
 
 import org.apache.flink.table.planner.{JArrayList, JDouble}
 import org.apache.flink.table.planner.plan.nodes.calcite.{Expand, Rank, WindowAggregate}
+import org.apache.flink.table.planner.plan.nodes.common.CommonPhysicalWindowTableFunction
 import org.apache.flink.table.planner.plan.nodes.physical.batch._
 import org.apache.flink.table.planner.plan.utils.FlinkRelMdUtil
 
@@ -256,6 +257,13 @@ class FlinkRelMdSelectivity private extends MetadataHandler[BuiltInMetadata.Sele
     }
   }
 
+  def getSelectivity(
+      rel: CommonPhysicalWindowTableFunction,
+      mq: RelMetadataQuery,
+      predicate: RexNode): JDouble = {
+    estimateSelectivity(rel, mq, predicate)
+  }
+
   def getSelectivity(subset: RelSubset, mq: RelMetadataQuery, predicate: RexNode): JDouble = {
     val rel = Util.first(subset.getBest, subset.getOriginal)
     mq.getSelectivity(rel, predicate)
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
index f51f83aadd8..c90100cd9d1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
@@ -1655,6 +1655,98 @@ Sink(table=[default_catalog.default_database.s1], fields=[window_start, window_e
          +- LocalWindowAggregate(window=[TUMBLE(time_col=[rowtime], size=[15 min])], select=[COUNT(*) AS count1$0, slice_end('w$) AS $slice_end])
             +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 1000:INTERVAL SECOND)])
                +- TableSourceScan(table=[[default_catalog, default_database, MyTable, project=[rowtime], metadata=[]]], fields=[rowtime])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProctimeWindowWithFilter[aggPhaseEnforcer=ONE_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+insert into sink
+    select
+        window_start,
+        window_end,
+        b,
+        COALESCE(sum(case
+            when a = 11
+            then 1
+        end), 0) c
+    from
+        TABLE(
+            TUMBLE(TABLE source, DESCRIPTOR(proctime), INTERVAL '10' SECONDS)
+        )
+    where
+        a in (1, 5, 7, 9, 11)
+    GROUP BY
+        window_start, window_end, b
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink], fields=[ws, we, b, c])
++- LogicalProject(ws=[CAST($0):TIMESTAMP(6)], we=[CAST($1):TIMESTAMP(6)], b=[$2], c=[CAST(COALESCE($3, 0)):BIGINT])
+   +- LogicalAggregate(group=[{0, 1, 2}], agg#0=[SUM($3)])
+      +- LogicalProject(window_start=[$5], window_end=[$6], b=[$1], $f3=[CASE(=($0, 11), 1, null:INTEGER)])
+         +- LogicalFilter(condition=[OR(=($0, 1), =($0, 5), =($0, 7), =($0, 9), =($0, 11))])
+            +- LogicalTableFunctionScan(invocation=[TUMBLE($4, DESCRIPTOR($4), 10000:INTERVAL SECOND)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, BIGINT d, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[$4])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, source]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink], fields=[ws, we, b, c])
++- Calc(select=[CAST(window_start AS TIMESTAMP(6)) AS ws, CAST(window_end AS TIMESTAMP(6)) AS we, b, CAST(COALESCE($f1, 0) AS BIGINT) AS c])
+   +- WindowAggregate(groupBy=[b], window=[TUMBLE(time_col=[proctime], size=[10 s])], select=[b, SUM($f3) AS $f1, start('w$) AS window_start, end('w$) AS window_end])
+      +- Exchange(distribution=[hash[b]])
+         +- Calc(select=[b, CASE((a = 11), 1, null:INTEGER) AS $f3, PROCTIME() AS proctime], where=[SEARCH(a, Sarg[1, 5, 7, 9, 11])])
+            +- TableSourceScan(table=[[default_catalog, default_database, source, project=[a, b], metadata=[]]], fields=[a, b])
+]]>
+    </Resource>
+  </TestCase>
+  <TestCase name="testProctimeWindowWithFilter[aggPhaseEnforcer=TWO_PHASE]">
+    <Resource name="sql">
+      <![CDATA[
+insert into sink
+    select
+        window_start,
+        window_end,
+        b,
+        COALESCE(sum(case
+            when a = 11
+            then 1
+        end), 0) c
+    from
+        TABLE(
+            TUMBLE(TABLE source, DESCRIPTOR(proctime), INTERVAL '10' SECONDS)
+        )
+    where
+        a in (1, 5, 7, 9, 11)
+    GROUP BY
+        window_start, window_end, b
+]]>
+    </Resource>
+    <Resource name="ast">
+      <![CDATA[
+LogicalSink(table=[default_catalog.default_database.sink], fields=[ws, we, b, c])
++- LogicalProject(ws=[CAST($0):TIMESTAMP(6)], we=[CAST($1):TIMESTAMP(6)], b=[$2], c=[CAST(COALESCE($3, 0)):BIGINT])
+   +- LogicalAggregate(group=[{0, 1, 2}], agg#0=[SUM($3)])
+      +- LogicalProject(window_start=[$5], window_end=[$6], b=[$1], $f3=[CASE(=($0, 11), 1, null:INTEGER)])
+         +- LogicalFilter(condition=[OR(=($0, 1), =($0, 5), =($0, 7), =($0, 9), =($0, 11))])
+            +- LogicalTableFunctionScan(invocation=[TUMBLE($4, DESCRIPTOR($4), 10000:INTERVAL SECOND)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, BIGINT d, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *PROCTIME* window_time)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[$4])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, source]])
+]]>
+    </Resource>
+    <Resource name="optimized exec plan">
+      <![CDATA[
+Sink(table=[default_catalog.default_database.sink], fields=[ws, we, b, c])
++- Calc(select=[CAST(window_start AS TIMESTAMP(6)) AS ws, CAST(window_end AS TIMESTAMP(6)) AS we, b, CAST(COALESCE($f1, 0) AS BIGINT) AS c])
+   +- WindowAggregate(groupBy=[b], window=[TUMBLE(time_col=[proctime], size=[10 s])], select=[b, SUM($f3) AS $f1, start('w$) AS window_start, end('w$) AS window_end])
+      +- Exchange(distribution=[hash[b]])
+         +- Calc(select=[b, CASE((a = 11), 1, null:INTEGER) AS $f3, PROCTIME() AS proctime], where=[SEARCH(a, Sarg[1, 5, 7, 9, 11])])
+            +- TableSourceScan(table=[[default_catalog, default_database, source, project=[a, b], metadata=[]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivityTest.scala b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivityTest.scala
index 9568e1243b6..b58329dd255 100644
--- a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivityTest.scala
+++ b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/metadata/FlinkRelMdSelectivityTest.scala
@@ -670,4 +670,23 @@ class FlinkRelMdSelectivityTest extends FlinkRelMdHandlerTestBase {
     assertEquals(0.5, mq.getSelectivity(testRel, pred))
   }
 
+  @Test
+  def testGetSelectivityOnWindowTableFunction(): Unit = {
+    // id in (1,3,5,7)
+    val predicate =
+      relBuilder
+        .push(windowTableFunctionScan)
+        .in(
+          relBuilder.field(0),
+          relBuilder.literal(1),
+          relBuilder.literal(3),
+          relBuilder.literal(5),
+          relBuilder.literal(7))
+    // unknown node, selectivity = 0.25 (unknown call type)
+    assertEquals(0.25, mq.getSelectivity(windowTableFunctionScan, predicate))
+    // known node, selectivity = 0.15 x 4 (4 literals)
+    Array(streamTumbleWindowTVFRel, batchTumbleWindowTVFRel).foreach {
+      tvf => assertEquals(0.6, mq.getSelectivity(tvf, predicate))
+    }
+  }
 }
diff --git a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.scala b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.scala
index efbb5756a49..5b2780bab8f 100644
--- a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.scala
+++ b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.scala
@@ -1009,6 +1009,54 @@ class WindowAggregateTest(aggPhaseEnforcer: AggregatePhaseStrategy) extends Tabl
       """.stripMargin
     util.verifyRelPlan(sql)
   }
+
+  @Test
+  def testProctimeWindowWithFilter(): Unit = {
+    util.tableEnv.executeSql(s"""
+                                |CREATE TEMPORARY TABLE source (
+                                |  a INT,
+                                |  b BIGINT,
+                                |  c STRING NOT NULL,
+                                |  d BIGINT,
+                                |  proctime as PROCTIME()
+                                |) with (
+                                |  'connector' = 'values'
+                                |)
+                                |""".stripMargin)
+
+    util.tableEnv.executeSql("""
+                               |CREATE TEMPORARY TABLE sink(
+                               |    ws TIMESTAMP,
+                               |    we TIMESTAMP,
+                               |    b bigint,
+                               |    c bigint
+                               |)
+                               |WITH (
+                               |    'connector' = 'values'
+                               |)
+                               |""".stripMargin)
+
+    util.verifyExecPlanInsert(
+      """
+        |insert into sink
+        |    select
+        |        window_start,
+        |        window_end,
+        |        b,
+        |        COALESCE(sum(case
+        |            when a = 11
+        |            then 1
+        |        end), 0) c
+        |    from
+        |        TABLE(
+        |            TUMBLE(TABLE source, DESCRIPTOR(proctime), INTERVAL '10' SECONDS)
+        |        )
+        |    where
+        |        a in (1, 5, 7, 9, 11)
+        |    GROUP BY
+        |        window_start, window_end, b
+        |""".stripMargin)
+  }
 }
 
 object WindowAggregateTest {
