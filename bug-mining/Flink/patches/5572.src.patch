diff --git a/flink-clients/src/main/java/org/apache/flink/client/program/DefaultPackagedProgramRetriever.java b/flink-clients/src/main/java/org/apache/flink/client/program/DefaultPackagedProgramRetriever.java
index bcc9f127b3a..ed7fc7943b7 100644
--- a/flink-clients/src/main/java/org/apache/flink/client/program/DefaultPackagedProgramRetriever.java
+++ b/flink-clients/src/main/java/org/apache/flink/client/program/DefaultPackagedProgramRetriever.java
@@ -22,6 +22,7 @@ import org.apache.flink.annotation.VisibleForTesting;
 import org.apache.flink.client.deployment.application.EntryClassInformationProvider;
 import org.apache.flink.client.deployment.application.FromClasspathEntryClassInformationProvider;
 import org.apache.flink.client.deployment.application.FromJarEntryClassInformationProvider;
+import org.apache.flink.configuration.Configuration;
 import org.apache.flink.util.FileUtils;
 import org.apache.flink.util.FlinkException;
 import org.apache.flink.util.Preconditions;
@@ -48,6 +49,7 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
     private final EntryClassInformationProvider entryClassInformationProvider;
     private final String[] programArguments;
     private final List<URL> userClasspath;
+    private final Configuration configuration;
 
     /**
      * Creates a {@code PackageProgramRetrieverImpl} with the given parameters.
@@ -57,6 +59,7 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
      * @param jobClassName The job class that will be used if specified. The classpath is used to
      *     detect any main class if not specified.
      * @param programArgs The program arguments.
+     * @param configuration The Flink configuration for the given job.
      * @return The {@code PackageProgramRetrieverImpl} that can be used to create a {@link
      *     PackagedProgram} instance.
      * @throws FlinkException If something goes wrong during instantiation.
@@ -64,9 +67,10 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
     public static DefaultPackagedProgramRetriever create(
             @Nullable File userLibDir,
             @Nullable String jobClassName,
-            String[] programArgs)
+            String[] programArgs,
+            Configuration configuration)
             throws FlinkException {
-        return create(userLibDir, null, jobClassName, programArgs);
+        return create(userLibDir, null, jobClassName, programArgs, configuration);
     }
 
     /**
@@ -79,6 +83,7 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
      * @param jobClassName The job class to use; if {@code null} the user classpath (or, if not set,
      *     the system classpath) will be scanned for possible main class.
      * @param programArgs The program arguments.
+     * @param configuration The Flink configuration for the given job.
      * @return The {@code PackageProgramRetrieverImpl} that can be used to create a {@link
      *     PackagedProgram} instance.
      * @throws FlinkException If something goes wrong during instantiation.
@@ -87,7 +92,8 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
             @Nullable File userLibDir,
             @Nullable File jarFile,
             @Nullable String jobClassName,
-            String[] programArgs)
+            String[] programArgs,
+            Configuration configuration)
             throws FlinkException {
         List<URL> userClasspath;
         try {
@@ -103,7 +109,7 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
                         jobClassName,
                         programArgs);
         return new DefaultPackagedProgramRetriever(
-                entryClassInformationProvider, programArgs, userClasspath);
+                entryClassInformationProvider, programArgs, userClasspath, configuration);
     }
 
     @VisibleForTesting
@@ -164,13 +170,16 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
     private DefaultPackagedProgramRetriever(
             EntryClassInformationProvider entryClassInformationProvider,
             String[] programArguments,
-            List<URL> userClasspath) {
+            List<URL> userClasspath,
+            Configuration configuration) {
         this.entryClassInformationProvider =
                 Preconditions.checkNotNull(
                         entryClassInformationProvider, "No EntryClassInformationProvider passed.");
         this.programArguments =
                 Preconditions.checkNotNull(programArguments, "No program parameter array passed.");
         this.userClasspath = Preconditions.checkNotNull(userClasspath, "No user classpath passed.");
+        this.configuration =
+                Preconditions.checkNotNull(configuration, "No Flink configuration was passed.");
     }
 
     @Override
@@ -179,7 +188,8 @@ public class DefaultPackagedProgramRetriever implements PackagedProgramRetriever
             final PackagedProgram.Builder packagedProgramBuilder =
                     PackagedProgram.newBuilder()
                             .setUserClassPaths(userClasspath)
-                            .setArguments(programArguments);
+                            .setArguments(programArguments)
+                            .setConfiguration(configuration);
 
             entryClassInformationProvider
                     .getJobClassName()
diff --git a/flink-clients/src/test/java/org/apache/flink/client/program/DefaultPackagedProgramRetrieverTest.java b/flink-clients/src/test/java/org/apache/flink/client/program/DefaultPackagedProgramRetrieverTest.java
index 8f1f2fd48d0..d35c3f6696b 100644
--- a/flink-clients/src/test/java/org/apache/flink/client/program/DefaultPackagedProgramRetrieverTest.java
+++ b/flink-clients/src/test/java/org/apache/flink/client/program/DefaultPackagedProgramRetrieverTest.java
@@ -29,14 +29,17 @@ import org.apache.flink.configuration.CoreOptions;
 import org.apache.flink.configuration.PipelineOptions;
 import org.apache.flink.configuration.PipelineOptionsInternal;
 import org.apache.flink.core.testutils.FlinkMatchers;
+import org.apache.flink.runtime.execution.librarycache.FlinkUserCodeClassLoaders;
 import org.apache.flink.runtime.jobgraph.JobGraph;
 import org.apache.flink.runtime.jobgraph.SavepointRestoreSettings;
+import org.apache.flink.util.ChildFirstClassLoader;
 import org.apache.flink.util.FileUtils;
 import org.apache.flink.util.FlinkException;
 import org.apache.flink.util.Preconditions;
 import org.apache.flink.util.TestLogger;
 
 import org.hamcrest.collection.IsIterableContainingInAnyOrder;
+import org.hamcrest.core.IsInstanceOf;
 import org.junit.Rule;
 import org.junit.Test;
 
@@ -52,6 +55,7 @@ import java.util.stream.Collectors;
 import static org.hamcrest.MatcherAssert.assertThat;
 import static org.hamcrest.Matchers.containsInAnyOrder;
 import static org.hamcrest.core.Is.is;
+import static org.hamcrest.core.IsNot.not;
 import static org.junit.Assert.fail;
 
 /** {@code PackagedProgramRetrieverImplTest} tests {@link DefaultPackagedProgramRetriever}. */
@@ -183,7 +187,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                         singleEntryClassClasspathProvider.getDirectory(),
                         null,
                         singleEntryClassClasspathProvider.getJobClassName(),
-                        new String[0]);
+                        new String[0],
+                        new Configuration());
 
         // the right information is picked up without any error
         assertThat(
@@ -206,7 +211,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         null,
                         testJobEntryClassClasspathProvider.getJobClassName(),
-                        ClasspathProvider.parametersForTestJob(expectedSuffix));
+                        ClasspathProvider.parametersForTestJob(expectedSuffix),
+                        new Configuration());
 
         final JobGraph jobGraph = retrieveJobGraph(retriever, configuration);
 
@@ -227,7 +233,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                         testJobEntryClassClasspathProvider.getDirectory(),
                         null,
                         null,
-                        ClasspathProvider.parametersForTestJob(expectedSuffix));
+                        ClasspathProvider.parametersForTestJob(expectedSuffix),
+                        new Configuration());
 
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, new Configuration());
 
@@ -246,7 +253,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         null,
                         testJobEntryClassClasspathProvider.getJobClassName(),
-                        ClasspathProvider.parametersForTestJob(expectedSuffix));
+                        ClasspathProvider.parametersForTestJob(expectedSuffix),
+                        new Configuration());
 
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, new Configuration());
 
@@ -271,7 +279,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         null,
                         testJobEntryClassClasspathProvider.getJobClassName(),
-                        ClasspathProvider.parametersForTestJob(expectedSuffix));
+                        ClasspathProvider.parametersForTestJob(expectedSuffix),
+                        new Configuration());
 
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, configuration);
 
@@ -285,7 +294,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
             DefaultPackagedProgramRetriever.create(
                     noEntryClassClasspathProvider.getDirectory(),
                     testJobEntryClassClasspathProvider.getJobClassName(),
-                    ClasspathProvider.parametersForTestJob("suffix"));
+                    ClasspathProvider.parametersForTestJob("suffix"),
+                    new Configuration());
             fail("This case should throw exception !");
         } catch (FlinkException e) {
             assertThat(
@@ -301,7 +311,7 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
     public void testEntryClassNotFoundOnSystemClasspath() throws FlinkException {
         final PackagedProgramRetriever testInstance =
                 DefaultPackagedProgramRetriever.create(
-                        null, "NotExistingClass", new String[0]);
+                        null, "NotExistingClass", new String[0], new Configuration());
         // the getPackagedProgram fails do to the missing class. We could make it fail earlier by
         // validating the existence of the passed Java class on the system classpath (analogously to
         // what we already do for the user classpath)
@@ -314,7 +324,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
         DefaultPackagedProgramRetriever.create(
                 noEntryClassClasspathProvider.getDirectory(),
                 "NotExistingClass",
-                new String[0]);
+                new String[0],
+                new Configuration());
     }
 
     @Test(expected = FlinkException.class)
@@ -324,13 +335,14 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
         DefaultPackagedProgramRetriever.create(
                 multipleEntryClassesClasspathProvider.getDirectory(),
                 null,
-                new String[0]);
+                new String[0],
+                new Configuration());
     }
 
     @Test(expected = FlinkException.class)
     public void testWithoutJobClassAndMultipleEntryClassesOnSystemClasspath()
             throws FlinkException {
-        DefaultPackagedProgramRetriever.create(null, null, new String[0]);
+        DefaultPackagedProgramRetriever.create(null, null, new String[0], new Configuration());
     }
 
     @Test
@@ -339,7 +351,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         multipleEntryClassesClasspathProvider.getDirectory(),
                         multipleEntryClassesClasspathProvider.getJobClassName(),
-                        new String[0]);
+                        new String[0],
+                        new Configuration());
         assertThat(
                 retriever.getPackagedProgram().getMainClassName(),
                 is(multipleEntryClassesClasspathProvider.getJobClassName()));
@@ -354,7 +367,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         null,
                         multipleEntryClassesClasspathProvider.getJobClassName(),
-                        new String[0]);
+                        new String[0],
+                        new Configuration());
         assertThat(
                 retriever.getPackagedProgram().getMainClassName(),
                 is(multipleEntryClassesClasspathProvider.getJobClassName()));
@@ -367,7 +381,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         singleEntryClassClasspathProvider.getDirectory(),
                         null,
-                        ClasspathProvider.parametersForTestJob("suffix"));
+                        ClasspathProvider.parametersForTestJob("suffix"),
+                        new Configuration());
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, new Configuration());
         final List<String> actualClasspath =
                 jobGraph.getClasspaths().stream().map(URL::toString).collect(Collectors.toList());
@@ -388,7 +403,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 DefaultPackagedProgramRetriever.create(
                         singleEntryClassClasspathProvider.getDirectory(),
                         singleEntryClassClasspathProvider.getJobClassName(),
-                        ClasspathProvider.parametersForTestJob("suffix"));
+                        ClasspathProvider.parametersForTestJob("suffix"),
+                        new Configuration());
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, new Configuration());
         final List<String> actualClasspath =
                 jobGraph.getClasspaths().stream().map(URL::toString).collect(Collectors.toList());
@@ -410,7 +426,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                         null,
                         testJobEntryClassClasspathProvider.getJobJar(),
                         null,
-                        ClasspathProvider.parametersForTestJob("suffix"));
+                        ClasspathProvider.parametersForTestJob("suffix"),
+                        new Configuration());
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, new Configuration());
 
         assertThat(
@@ -430,7 +447,8 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                         // the testJob jar is not on the user classpath
                         testJobEntryClassClasspathProvider.getJobJar(),
                         null,
-                        ClasspathProvider.parametersForTestJob("suffix"));
+                        ClasspathProvider.parametersForTestJob("suffix"),
+                        new Configuration());
         final JobGraph jobGraph = retrieveJobGraph(retrieverUnderTest, new Configuration());
 
         assertThat(
@@ -449,6 +467,54 @@ public class DefaultPackagedProgramRetrieverTest extends TestLogger {
                 IsIterableContainingInAnyOrder.containsInAnyOrder(expectedClasspath.toArray()));
     }
 
+    @Test
+    public void testChildFirstDefaultConfiguration() throws FlinkException {
+        // this is a sanity check to backup testConfigurationIsConsidered
+        final Configuration configuration = new Configuration();
+        // CHECK_LEAKED_CLASSLOADER has to be disabled to enable the instanceof check later on in
+        // this test. Otherwise, the actual instance would be hidden by a wrapper
+        configuration.set(CoreOptions.CHECK_LEAKED_CLASSLOADER, false);
+
+        final PackagedProgramRetriever retriever =
+                DefaultPackagedProgramRetriever.create(
+                        singleEntryClassClasspathProvider.getDirectory(),
+                        null,
+                        singleEntryClassClasspathProvider.getJobClassName(),
+                        new String[0],
+                        configuration);
+
+        assertThat(
+                retriever.getPackagedProgram().getUserCodeClassLoader(),
+                IsInstanceOf.instanceOf(ChildFirstClassLoader.class));
+    }
+
+    @Test
+    public void testConfigurationIsConsidered() throws FlinkException {
+        final String parentFirstConfigValue = "parent-first";
+        // we want to make sure that parent-first is not set as a default
+        assertThat(
+                CoreOptions.CLASSLOADER_RESOLVE_ORDER.defaultValue(),
+                not(is(parentFirstConfigValue)));
+
+        final Configuration configuration = new Configuration();
+        configuration.set(CoreOptions.CLASSLOADER_RESOLVE_ORDER, parentFirstConfigValue);
+        // CHECK_LEAKED_CLASSLOADER has to be disabled to enable the instanceof check later on in
+        // this test. Otherwise, the actual instance would be hidden by a wrapper
+        configuration.set(CoreOptions.CHECK_LEAKED_CLASSLOADER, false);
+
+        final PackagedProgramRetriever retriever =
+                DefaultPackagedProgramRetriever.create(
+                        singleEntryClassClasspathProvider.getDirectory(),
+                        null,
+                        singleEntryClassClasspathProvider.getJobClassName(),
+                        new String[0],
+                        configuration);
+
+        assertThat(
+                retriever.getPackagedProgram().getUserCodeClassLoader(),
+                IsInstanceOf.instanceOf(FlinkUserCodeClassLoaders.ParentFirstClassLoader.class));
+    }
+
     private JobGraph retrieveJobGraph(
             PackagedProgramRetriever retrieverUnderTest, Configuration configuration)
             throws FlinkException, ProgramInvocationException, MalformedURLException {
diff --git a/flink-container/src/main/java/org/apache/flink/container/entrypoint/StandaloneApplicationClusterEntryPoint.java b/flink-container/src/main/java/org/apache/flink/container/entrypoint/StandaloneApplicationClusterEntryPoint.java
index b1bb21147a4..967650bda86 100644
--- a/flink-container/src/main/java/org/apache/flink/container/entrypoint/StandaloneApplicationClusterEntryPoint.java
+++ b/flink-container/src/main/java/org/apache/flink/container/entrypoint/StandaloneApplicationClusterEntryPoint.java
@@ -60,15 +60,15 @@ public final class StandaloneApplicationClusterEntryPoint extends ApplicationClu
                         new StandaloneApplicationClusterConfigurationParserFactory(),
                         StandaloneApplicationClusterEntryPoint.class);
 
+        Configuration configuration = loadConfigurationFromClusterConfig(clusterConfiguration);
         PackagedProgram program = null;
         try {
-            program = getPackagedProgram(clusterConfiguration);
+            program = getPackagedProgram(clusterConfiguration, configuration);
         } catch (Exception e) {
             LOG.error("Could not create application program.", e);
             System.exit(1);
         }
 
-        Configuration configuration = loadConfigurationFromClusterConfig(clusterConfiguration);
         try {
             configureExecution(configuration, program);
         } catch (Exception e) {
@@ -98,14 +98,16 @@ public final class StandaloneApplicationClusterEntryPoint extends ApplicationClu
     }
 
     private static PackagedProgram getPackagedProgram(
-            final StandaloneApplicationClusterConfiguration clusterConfiguration)
+            final StandaloneApplicationClusterConfiguration clusterConfiguration,
+            Configuration flinkConfiguration)
             throws FlinkException {
         final File userLibDir = ClusterEntrypointUtils.tryFindUserLibDirectory().orElse(null);
         final PackagedProgramRetriever programRetriever =
                 DefaultPackagedProgramRetriever.create(
                         userLibDir,
                         clusterConfiguration.getJobClassName(),
-                        clusterConfiguration.getArgs());
+                        clusterConfiguration.getArgs(),
+                        flinkConfiguration);
         return programRetriever.getPackagedProgram();
     }
 
diff --git a/flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesApplicationClusterEntrypoint.java b/flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesApplicationClusterEntrypoint.java
index c2bd2734421..0dac989bfed 100644
--- a/flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesApplicationClusterEntrypoint.java
+++ b/flink-kubernetes/src/main/java/org/apache/flink/kubernetes/entrypoint/KubernetesApplicationClusterEntrypoint.java
@@ -115,10 +115,10 @@ public final class KubernetesApplicationClusterEntrypoint extends ApplicationClu
                     KubernetesUtils.checkJarFileForApplicationMode(configuration);
             Preconditions.checkArgument(pipelineJars.size() == 1, "Should only have one jar");
             return DefaultPackagedProgramRetriever.create(
-                    userLibDir, pipelineJars.get(0), jobClassName, programArguments);
+                    userLibDir, pipelineJars.get(0), jobClassName, programArguments, configuration);
         }
 
         return DefaultPackagedProgramRetriever.create(
-                userLibDir, jobClassName, programArguments);
+                userLibDir, jobClassName, programArguments, configuration);
     }
 }
diff --git a/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnApplicationClusterEntryPoint.java b/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnApplicationClusterEntryPoint.java
index 1d6c986d8d5..d38ebaeb666 100644
--- a/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnApplicationClusterEntryPoint.java
+++ b/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnApplicationClusterEntryPoint.java
@@ -134,7 +134,7 @@ public final class YarnApplicationClusterEntryPoint extends ApplicationClusterEn
         final File userLibDir = YarnEntrypointUtils.getUsrLibDir(configuration).orElse(null);
         final File userApplicationJar = getUserApplicationJar(userLibDir, configuration);
         return DefaultPackagedProgramRetriever.create(
-                userLibDir, userApplicationJar, jobClassName, programArguments);
+                userLibDir, userApplicationJar, jobClassName, programArguments, configuration);
     }
 
     private static File getUserApplicationJar(
