diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java
index e6831a09d2e..8e846d4b5bc 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/runner/DispatcherRunnerImplNGFactory.java
@@ -39,7 +39,7 @@ public class DispatcherRunnerImplNGFactory implements DispatcherRunnerFactory {
 	}
 
 	@Override
-	public DispatcherRunner createDispatcherRunner(
+	public DispatcherRunnerImplNG createDispatcherRunner(
 			LeaderElectionService leaderElectionService,
 			FatalErrorHandler fatalErrorHandler,
 			JobGraphStoreFactory jobGraphStoreFactory,
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java
index ba0059af9b0..6550decc73e 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/runner/ZooKeeperDispatcherRunnerImplTest.java
@@ -28,7 +28,7 @@ import org.apache.flink.runtime.blob.PermanentBlobKey;
 import org.apache.flink.runtime.clusterframework.ApplicationStatus;
 import org.apache.flink.runtime.dispatcher.DispatcherGateway;
 import org.apache.flink.runtime.dispatcher.MemoryArchivedExecutionGraphStore;
-import org.apache.flink.runtime.dispatcher.PartialDispatcherServicesWithJobGraphStore;
+import org.apache.flink.runtime.dispatcher.PartialDispatcherServices;
 import org.apache.flink.runtime.dispatcher.SessionDispatcherFactory;
 import org.apache.flink.runtime.dispatcher.VoidHistoryServerArchivist;
 import org.apache.flink.runtime.heartbeat.TestingHeartbeatServices;
@@ -38,6 +38,7 @@ import org.apache.flink.runtime.highavailability.TestingHighAvailabilityServices
 import org.apache.flink.runtime.highavailability.zookeeper.ZooKeeperRunningJobsRegistry;
 import org.apache.flink.runtime.jobgraph.JobGraph;
 import org.apache.flink.runtime.jobgraph.JobVertex;
+import org.apache.flink.runtime.jobmanager.JobGraphStoreFactory;
 import org.apache.flink.runtime.jobmanager.ZooKeeperJobGraphStore;
 import org.apache.flink.runtime.jobmaster.JobResult;
 import org.apache.flink.runtime.leaderelection.TestingLeaderElectionService;
@@ -45,18 +46,19 @@ import org.apache.flink.runtime.leaderretrieval.SettableLeaderRetrievalService;
 import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;
 import org.apache.flink.runtime.rpc.TestingRpcService;
 import org.apache.flink.runtime.rpc.TestingRpcServiceResource;
+import org.apache.flink.runtime.testingUtils.TestingUtils;
 import org.apache.flink.runtime.testtasks.NoOpInvokable;
 import org.apache.flink.runtime.testutils.CommonTestUtils;
 import org.apache.flink.runtime.util.TestingFatalErrorHandler;
 import org.apache.flink.runtime.util.ZooKeeperUtils;
 import org.apache.flink.runtime.zookeeper.ZooKeeperResource;
+import org.apache.flink.util.ExceptionUtils;
 import org.apache.flink.util.TestLogger;
 
 import org.apache.curator.framework.CuratorFramework;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.ClassRule;
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.rules.TemporaryFolder;
 import org.slf4j.Logger;
@@ -127,7 +129,6 @@ public class ZooKeeperDispatcherRunnerImplTest extends TestLogger {
 	 * See FLINK-11665.
 	 */
 	@Test
-	@Ignore
 	public void testResourceCleanupUnderLeadershipChange() throws Exception {
 		final TestingRpcService rpcService = testingRpcServiceResource.getTestingRpcService();
 		final TestingLeaderElectionService dispatcherLeaderElectionService = new TestingLeaderElectionService();
@@ -135,29 +136,35 @@ public class ZooKeeperDispatcherRunnerImplTest extends TestLogger {
 
 		final CuratorFramework client = ZooKeeperUtils.startCuratorFramework(configuration);
 		try (final TestingHighAvailabilityServices highAvailabilityServices = new TestingHighAvailabilityServicesBuilder()
-				.setJobGraphStore(ZooKeeperUtils.createJobGraphs(client, configuration))
 				.setRunningJobsRegistry(new ZooKeeperRunningJobsRegistry(client, configuration))
 				.setDispatcherLeaderElectionService(dispatcherLeaderElectionService)
 				.setDispatcherLeaderRetriever(dispatcherLeaderRetriever)
 				.setJobMasterLeaderRetrieverFunction(jobId -> ZooKeeperUtils.createLeaderRetrievalService(client, configuration))
 				.build()) {
 
-			final PartialDispatcherServicesWithJobGraphStore partialDispatcherServicesWithJobGraphStore = new PartialDispatcherServicesWithJobGraphStore(
+			final PartialDispatcherServices partialDispatcherServices = new PartialDispatcherServices(
 				configuration,
 				highAvailabilityServices,
-				() -> new CompletableFuture<>(),
+				CompletableFuture::new,
 				blobServer,
 				new TestingHeartbeatServices(),
 				UnregisteredMetricGroups::createUnregisteredJobManagerMetricGroup,
 				new MemoryArchivedExecutionGraphStore(),
 				fatalErrorHandler,
 				VoidHistoryServerArchivist.INSTANCE,
-				null,
-				highAvailabilityServices.getJobGraphStore());
+				null);
 
 			final JobGraph jobGraph = createJobGraphWithBlobs();
 
-			try (final DispatcherRunnerImpl dispatcherRunner = new DispatcherRunnerImpl(SessionDispatcherFactory.INSTANCE, rpcService, partialDispatcherServicesWithJobGraphStore)) {
+			final DispatcherRunnerImplNGFactory dispatcherRunnerImplNGFactory = new DispatcherRunnerImplNGFactory(SessionDispatcherFactory.INSTANCE);
+
+			try (final DispatcherRunner dispatcherRunner = createDispatcherRunner(
+				rpcService,
+				dispatcherLeaderElectionService,
+				() -> createZooKeeperJobGraphStore(client),
+				partialDispatcherServices,
+				dispatcherRunnerImplNGFactory)) {
+
 				// initial run
 				DispatcherGateway dispatcherGateway = grantLeadership(dispatcherLeaderElectionService, dispatcherLeaderRetriever, dispatcherRunner);
 
@@ -183,7 +190,7 @@ public class ZooKeeperDispatcherRunnerImplTest extends TestLogger {
 				dispatcherLeaderElectionService.notLeader();
 
 				// check that the job has been removed from ZooKeeper
-				final ZooKeeperJobGraphStore submittedJobGraphStore = ZooKeeperUtils.createJobGraphs(client, configuration);
+				final ZooKeeperJobGraphStore submittedJobGraphStore = createZooKeeperJobGraphStore(client);
 
 				CommonTestUtils.waitUntilCondition(() -> submittedJobGraphStore.getJobIds().isEmpty(), Deadline.fromNow(VERIFICATION_TIMEOUT), 20L);
 			}
@@ -193,7 +200,31 @@ public class ZooKeeperDispatcherRunnerImplTest extends TestLogger {
 		assertThat(clusterHaStorageDir.listFiles(), is(emptyArray()));
 	}
 
-	private DispatcherGateway grantLeadership(TestingLeaderElectionService dispatcherLeaderElectionService, SettableLeaderRetrievalService dispatcherLeaderRetriever, DispatcherRunnerImpl dispatcherRunner) throws InterruptedException, java.util.concurrent.ExecutionException {
+	private DispatcherRunner createDispatcherRunner(
+			TestingRpcService rpcService,
+			TestingLeaderElectionService dispatcherLeaderElectionService,
+			JobGraphStoreFactory jobGraphStoreFactory,
+			PartialDispatcherServices partialDispatcherServices,
+			DispatcherRunnerFactory dispatcherRunnerFactory) throws Exception {
+		return dispatcherRunnerFactory.createDispatcherRunner(
+				dispatcherLeaderElectionService,
+				fatalErrorHandler,
+				jobGraphStoreFactory,
+				TestingUtils.defaultExecutor(),
+				rpcService,
+				partialDispatcherServices);
+	}
+
+	private ZooKeeperJobGraphStore createZooKeeperJobGraphStore(CuratorFramework client) {
+		try {
+			return ZooKeeperUtils.createJobGraphs(client, configuration);
+		} catch (Exception e) {
+			ExceptionUtils.rethrow(e);
+			return null;
+		}
+	}
+
+	private DispatcherGateway grantLeadership(TestingLeaderElectionService dispatcherLeaderElectionService, SettableLeaderRetrievalService dispatcherLeaderRetriever, DispatcherRunner dispatcherRunner) throws InterruptedException, java.util.concurrent.ExecutionException {
 		final UUID leaderSessionId = UUID.randomUUID();
 		dispatcherLeaderElectionService.isLeader(leaderSessionId).get();
 		// TODO: Remove once runner properly works
