diff --git a/flink-python/src/main/java/org/apache/flink/client/python/PythonDriverEnvUtils.java b/flink-python/src/main/java/org/apache/flink/client/python/PythonDriverEnvUtils.java
index d7aba869e79..fbd63b5f91a 100644
--- a/flink-python/src/main/java/org/apache/flink/client/python/PythonDriverEnvUtils.java
+++ b/flink-python/src/main/java/org/apache/flink/client/python/PythonDriverEnvUtils.java
@@ -87,7 +87,8 @@ public final class PythonDriverEnvUtils {
 	 * @param pythonLibFiles The dependent Python files.
 	 * @return PythonEnvironment the Python environment which will be executed in Python process.
 	 */
-	public static PythonEnvironment preparePythonEnvironment(List<Path> pythonLibFiles) throws IOException {
+	public static PythonEnvironment preparePythonEnvironment(List<Path> pythonLibFiles)
+		throws IOException, InterruptedException {
 		PythonEnvironment env = new PythonEnvironment();
 
 		// 1. setup temporary local directory for the user files
@@ -109,7 +110,6 @@ public final class PythonDriverEnvUtils {
 
 		List<File> internalLibs = extractBasicDependenciesFromResource(
 			tmpDir,
-			PythonDriverEnvUtils.class.getClassLoader(),
 			UUID.randomUUID().toString(),
 			true);
 
diff --git a/flink-python/src/main/java/org/apache/flink/client/python/PythonResourceExtractor.java b/flink-python/src/main/java/org/apache/flink/client/python/PythonResourceExtractor.java
index 2667a25de34..054a488e766 100644
--- a/flink-python/src/main/java/org/apache/flink/client/python/PythonResourceExtractor.java
+++ b/flink-python/src/main/java/org/apache/flink/client/python/PythonResourceExtractor.java
@@ -32,12 +32,11 @@ import static org.apache.flink.python.util.ResourceUtil.extractBasicDependencies
  */
 public class PythonResourceExtractor {
 
-	public static void main(String[] args) throws IOException {
+	public static void main(String[] args) throws IOException, InterruptedException {
 		String tmpdir = System.getProperty("java.io.tmpdir");
 
 		List<File> files = extractBasicDependenciesFromResource(
 			tmpdir,
-			PythonResourceExtractor.class.getClassLoader(),
 			UUID.randomUUID().toString(),
 			true);
 
diff --git a/flink-python/src/main/java/org/apache/flink/python/AbstractPythonFunctionRunner.java b/flink-python/src/main/java/org/apache/flink/python/AbstractPythonFunctionRunner.java
index ec700eb50e0..859dceac349 100644
--- a/flink-python/src/main/java/org/apache/flink/python/AbstractPythonFunctionRunner.java
+++ b/flink-python/src/main/java/org/apache/flink/python/AbstractPythonFunctionRunner.java
@@ -323,10 +323,9 @@ public abstract class AbstractPythonFunctionRunner<IN, OUT> implements PythonFun
 			try {
 				pythonInternalLibs = ResourceUtil.extractBasicDependenciesFromResource(
 					tmpdir,
-					this.getClass().getClassLoader(),
 					prefix,
 					false);
-			} catch (IOException e) {
+			} catch (IOException | InterruptedException e) {
 				throw new RuntimeException(e);
 			}
 			String pythonWorkerCommand = null;
diff --git a/flink-python/src/main/java/org/apache/flink/python/util/ResourceUtil.java b/flink-python/src/main/java/org/apache/flink/python/util/ResourceUtil.java
index 025f49b40d6..c2619e47d3e 100644
--- a/flink-python/src/main/java/org/apache/flink/python/util/ResourceUtil.java
+++ b/flink-python/src/main/java/org/apache/flink/python/util/ResourceUtil.java
@@ -18,19 +18,16 @@
 
 package org.apache.flink.python.util;
 
-import java.io.BufferedOutputStream;
 import java.io.File;
-import java.io.FileOutputStream;
 import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
+import java.nio.file.Files;
+import java.nio.file.Paths;
 import java.util.ArrayList;
 import java.util.List;
 
 /**
- * Utils for building the most basic environment for running python udf workers.
- * The basic environment does not include python part of Apache Beam.
- * Users need to prepare it themselves.
+ * Utils for building the most basic environment for running python udf workers. The basic environment does not include
+ * python part of Apache Beam. Users need to prepare it themselves.
  */
 public class ResourceUtil {
 
@@ -41,37 +38,59 @@ public class ResourceUtil {
 		"pyflink-udf-runner.sh"
 	};
 
-	public static final int BUFF_SIZE = 4096;
-
 	public static List<File> extractBasicDependenciesFromResource(
 			String tmpdir,
-			ClassLoader classLoader,
 			String prefix,
-			boolean skipShellScript) throws IOException {
+			boolean skipShellScript) throws IOException, InterruptedException {
 		List<File> extractedFiles = new ArrayList<>();
 		for (String fileName : PYTHON_BASIC_DEPENDENCIES) {
 			if (skipShellScript && fileName.endsWith(".sh")) {
 				continue;
 			}
-			File file = new File(tmpdir, prefix + fileName);
 
-			try (OutputStream out = new BufferedOutputStream(new FileOutputStream(file));
-				InputStream in = classLoader.getResourceAsStream(fileName)) {
-				// This util will use in the extract program before launching pyflink shell,
-				// so it must do this itself to minimize the dependencies.
-				final byte[] buf = new byte[BUFF_SIZE];
-				int bytesRead = in.read(buf);
-				while (bytesRead >= 0) {
-					out.write(buf, 0, bytesRead);
-					bytesRead = in.read(buf);
-				}
-			}
-
-			if (file.getName().endsWith(".sh")) {
-				file.setExecutable(true);
+			File file = new File(tmpdir, prefix + fileName);
+			if (fileName.endsWith(".sh")) {
+				// TODO: This is a hacky solution to prevent subprocesses to hold the file descriptor of shell scripts,
+				// which will cause the execution of shell scripts failed with the exception "test file is busy"
+				// randomly. It's a bug of JDK, see https://bugs.openjdk.java.net/browse/JDK-8068370. After moving flink
+				// python jar to lib directory, we can solve this problem elegantly by extracting these files only once.
+				String javaExecutable = String.join(File.separator, System.getProperty("java.home"), "bin", "java");
+				String classPath = new File(
+					ResourceUtil.class.getProtectionDomain().getCodeSource().getLocation().getPath()).getAbsolutePath();
+				new ProcessBuilder(
+					javaExecutable,
+					"-cp",
+					classPath,
+					ResourceUtil.class.getName(),
+					tmpdir,
+					prefix,
+					fileName).inheritIO().start().waitFor();
+			} else {
+				Files.copy(
+					ResourceUtil.class.getClassLoader().getResourceAsStream(fileName),
+					Paths.get(file.getAbsolutePath()));
 			}
 			extractedFiles.add(file);
 		}
 		return extractedFiles;
 	}
+
+	/**
+	 * This main method is used to create the shell script in a subprocess, see the "TODO" hints in method
+	 * {@link ResourceUtil#extractBasicDependenciesFromResource}.
+	 * @param args First argument is the directory where shell script will be created. Second argument is the prefix of
+	 *             the shell script. Third argument is the fileName of the shell script.
+	 * @throws IOException
+	 */
+	public static void main(String[] args) throws IOException {
+		String tmpdir = args[0];
+		String prefix = args[1];
+		String fileName = args[2];
+		File file = new File(tmpdir, prefix + fileName);
+
+		Files.copy(
+			ResourceUtil.class.getClassLoader().getResourceAsStream(fileName), Paths.get(file.getAbsolutePath()));
+
+		file.setExecutable(true);
+	}
 }
diff --git a/flink-python/src/test/java/org/apache/flink/client/python/PythonDriverEnvUtilsTest.java b/flink-python/src/test/java/org/apache/flink/client/python/PythonDriverEnvUtilsTest.java
index e97b1d1866a..b2e4284ab74 100644
--- a/flink-python/src/test/java/org/apache/flink/client/python/PythonDriverEnvUtilsTest.java
+++ b/flink-python/src/test/java/org/apache/flink/client/python/PythonDriverEnvUtilsTest.java
@@ -67,7 +67,7 @@ public class PythonDriverEnvUtilsTest {
 	}
 
 	@Test
-	public void testPreparePythonEnvironment() throws IOException {
+	public void testPreparePythonEnvironment() throws IOException, InterruptedException {
 		// xxx/a.zip, xxx/subdir/b.py, xxx/subdir/c.zip
 		File a = new File(tmpDirPath.toString() + File.separator + "a.zip");
 		a.createNewFile();
diff --git a/flink-python/src/test/java/org/apache/flink/python/util/ResourceUtilTest.java b/flink-python/src/test/java/org/apache/flink/python/util/ResourceUtilTest.java
index 5003bc8fa9f..4f9ced137e3 100644
--- a/flink-python/src/test/java/org/apache/flink/python/util/ResourceUtilTest.java
+++ b/flink-python/src/test/java/org/apache/flink/python/util/ResourceUtilTest.java
@@ -36,7 +36,7 @@ import static org.junit.Assert.assertTrue;
 public class ResourceUtilTest {
 
 	@Test
-	public void testExtractBasicDependenciesFromResource() throws IOException {
+	public void testExtractBasicDependenciesFromResource() throws IOException, InterruptedException {
 		File tmpdir = File.createTempFile(UUID.randomUUID().toString(), null);
 		tmpdir.delete();
 		tmpdir.mkdirs();
@@ -49,11 +49,9 @@ public class ResourceUtilTest {
 		});
 		Runtime.getRuntime().addShutdownHook(hook);
 		try {
-			ClassLoader classLoader = ResourceUtil.class.getClassLoader();
 			String prefix = "tmp_";
 			List<File> files = ResourceUtil.extractBasicDependenciesFromResource(
 				tmpdir.getAbsolutePath(),
-				classLoader,
 				prefix,
 				true);
 			files.forEach(file -> assertTrue(file.exists()));
@@ -64,7 +62,6 @@ public class ResourceUtilTest {
 			files.forEach(File::delete);
 			files = ResourceUtil.extractBasicDependenciesFromResource(
 				tmpdir.getAbsolutePath(),
-				classLoader,
 				prefix,
 				false);
 			files.forEach(file -> assertTrue(file.exists()));
