diff --git a/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/LocalStreamEnvironment.java b/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/LocalStreamEnvironment.java
index 94e0891e482..5c0f5558b02 100755
--- a/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/LocalStreamEnvironment.java
+++ b/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/LocalStreamEnvironment.java
@@ -39,8 +39,14 @@ public class LocalStreamEnvironment extends StreamExecutionEnvironment {
 	 */
 	@Override
 	public void execute(String jobName) throws Exception {
-		ClusterUtil.runOnMiniCluster(this.jobGraphBuilder.getJobGraph(jobName),
-				getExecutionParallelism());
+		if (localExecutionIsAllowed()) {
+			ClusterUtil.runOnMiniCluster(this.jobGraphBuilder.getJobGraph(jobName),
+					getExecutionParallelism());
+		} else {
+			ClusterUtil.runOnLocalCluster(this.jobGraphBuilder.getJobGraph(jobName),
+					getExecutionParallelism());
+		}
+
 	}
 
 	public void executeTest(long memorySize) throws Exception {
diff --git a/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java b/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java
index 4b7afbbaf27..0d00db3c3e4 100644
--- a/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java
+++ b/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java
@@ -123,14 +123,15 @@ public abstract class StreamExecutionEnvironment {
 	 * <li>
 	 * 0 triggers flushing after every record thus minimizing latency</li>
 	 * <li>
-	 * -1 triggers flushing only when the output buffer is full thus maximizing throughput</li>
+	 * -1 triggers flushing only when the output buffer is full thus maximizing
+	 * throughput</li>
 	 * </ul>
 	 * 
 	 * @param timeoutMillis
 	 *            The maximum time between two output flushes.
 	 */
 	public StreamExecutionEnvironment setBufferTimeout(long timeoutMillis) {
-		if (timeoutMillis < -1 ) {
+		if (timeoutMillis < -1) {
 			throw new IllegalArgumentException("Timeout of buffer must be non-negative or -1");
 		}
 
@@ -350,7 +351,8 @@ public abstract class StreamExecutionEnvironment {
 	 *         executed.
 	 */
 	public static StreamExecutionEnvironment getExecutionEnvironment() {
-		return contextEnvironment == null ? createLocalEnvironment() : contextEnvironment;
+		allowLocalExecution = ExecutionEnvironment.localExecutionIsAllowed();
+		return createLocalEnvironment();
 	}
 
 	/**
diff --git a/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/util/ClusterUtil.java b/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/util/ClusterUtil.java
index f9c6b250dba..278cb5a6ea9 100755
--- a/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/util/ClusterUtil.java
+++ b/flink-addons/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/util/ClusterUtil.java
@@ -19,8 +19,10 @@ package org.apache.flink.streaming.util;
 
 import java.net.InetSocketAddress;
 
+import org.apache.flink.api.java.ExecutionEnvironment;
 import org.apache.flink.client.minicluster.NepheleMiniCluster;
 import org.apache.flink.client.program.Client;
+import org.apache.flink.client.program.ContextEnvironment;
 import org.apache.flink.client.program.ProgramInvocationException;
 import org.apache.flink.configuration.Configuration;
 import org.apache.flink.runtime.jobgraph.JobGraph;
@@ -42,7 +44,8 @@ public class ClusterUtil {
 	 * @param memorySize
 	 *            memorySize
 	 */
-	public static void runOnMiniCluster(JobGraph jobGraph, int degreeOfPrallelism, long memorySize) throws Exception  {
+	public static void runOnMiniCluster(JobGraph jobGraph, int degreeOfPrallelism, long memorySize)
+			throws Exception {
 
 		Configuration configuration = jobGraph.getJobConfiguration();
 
@@ -76,7 +79,36 @@ public class ClusterUtil {
 		}
 	}
 
-	public static void runOnMiniCluster(JobGraph jobGraph, int numberOfTaskTrackers) throws Exception {
+	public static void runOnLocalCluster(JobGraph jobGraph, int degreeOfPrallelism)
+			throws Exception {
+
+		if (LOG.isInfoEnabled()) {
+			LOG.info("Running on mini cluster");
+		}
+
+		try {
+
+			Client client = ((ContextEnvironment) ExecutionEnvironment.getExecutionEnvironment())
+					.getClient();
+
+			client.run(jobGraph, true);
+		} catch (ProgramInvocationException e) {
+			if (e.getMessage().contains("GraphConversionException")) {
+				throw new Exception(CANNOT_EXECUTE_EMPTY_JOB, e);
+			} else {
+				throw e;
+			}
+		} catch (Exception e) {
+			throw e;
+		} finally {
+			try {
+			} catch (Throwable t) {
+			}
+		}
+	}
+
+	public static void runOnMiniCluster(JobGraph jobGraph, int numberOfTaskTrackers)
+			throws Exception {
 		runOnMiniCluster(jobGraph, numberOfTaskTrackers, -1);
 	}
 
diff --git a/flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java b/flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java
index 393abc406ba..4f915149478 100644
--- a/flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java
+++ b/flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java
@@ -79,4 +79,8 @@ public class ContextEnvironment extends ExecutionEnvironment {
 	public static void disableLocalExecution() {
 		ExecutionEnvironment.disableLocalExecution();
 	}
+	
+	public Client getClient() {
+		return this.client;
+	}
 }
