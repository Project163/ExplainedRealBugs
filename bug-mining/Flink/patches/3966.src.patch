diff --git a/flink-clients/src/main/java/org/apache/flink/client/FlinkPipelineTranslationUtil.java b/flink-clients/src/main/java/org/apache/flink/client/FlinkPipelineTranslationUtil.java
index fe0941c78a9..55a0178cf9b 100644
--- a/flink-clients/src/main/java/org/apache/flink/client/FlinkPipelineTranslationUtil.java
+++ b/flink-clients/src/main/java/org/apache/flink/client/FlinkPipelineTranslationUtil.java
@@ -45,6 +45,23 @@ public final class FlinkPipelineTranslationUtil {
 				defaultParallelism);
 	}
 
+	/**
+	 * Transmogrifies the given {@link Pipeline} under the userClassloader to a {@link JobGraph}.
+	 */
+	public static JobGraph getJobGraphUnderUserClassLoader(
+		final ClassLoader userClassloader,
+		final Pipeline pipeline,
+		final Configuration configuration,
+		final int defaultParallelism) {
+		final ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();
+		try {
+			Thread.currentThread().setContextClassLoader(userClassloader);
+			return FlinkPipelineTranslationUtil.getJobGraph(pipeline, configuration, defaultParallelism);
+		} finally {
+			Thread.currentThread().setContextClassLoader(contextClassLoader);
+		}
+	}
+
 	/**
 	 * Extracts the execution plan (as JSON) from the given {@link Pipeline}.
 	 */
diff --git a/flink-clients/src/main/java/org/apache/flink/client/program/PackagedProgramUtils.java b/flink-clients/src/main/java/org/apache/flink/client/program/PackagedProgramUtils.java
index 6d2ff10f6dc..01e94dc2039 100644
--- a/flink-clients/src/main/java/org/apache/flink/client/program/PackagedProgramUtils.java
+++ b/flink-clients/src/main/java/org/apache/flink/client/program/PackagedProgramUtils.java
@@ -60,8 +60,11 @@ public enum PackagedProgramUtils {
 			@Nullable JobID jobID,
 			boolean suppressOutput) throws ProgramInvocationException {
 		final Pipeline pipeline = getPipelineFromProgram(packagedProgram, configuration,  defaultParallelism, suppressOutput);
-		final JobGraph jobGraph = FlinkPipelineTranslationUtil.getJobGraph(pipeline, configuration, defaultParallelism);
-
+		final JobGraph jobGraph = FlinkPipelineTranslationUtil.getJobGraphUnderUserClassLoader(
+				packagedProgram.getUserCodeClassLoader(),
+				pipeline,
+				configuration,
+				defaultParallelism);
 		if (jobID != null) {
 			jobGraph.setJobID(jobID);
 		}
