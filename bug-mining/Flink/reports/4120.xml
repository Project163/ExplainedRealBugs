<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:46:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17878] Transient watermark attribute should be initial at runtime in streaming file operators</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17878</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;StreamingFileWriter has a&#160;&lt;/p&gt;

&lt;p&gt;private&#160;transient long currentWatermark = Long.MIN_VALUE;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;in case developer wants to create a custom bucket assigner, it will receive a currentWatermark as 0, this might be conflict with the original flink approach to handle a min_long.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;should we remove the transient key word?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13306700">FLINK-17878</key>
            <summary>Transient watermark attribute should be initial at runtime in streaming file operators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhoujira86">xiaogang zhou</assignee>
                                    <reporter username="zhoujira86">xiaogang zhou</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 22 May 2020 07:37:57 +0000</created>
                <updated>Mon, 25 May 2020 02:28:48 +0000</updated>
                            <resolved>Mon, 25 May 2020 02:28:40 +0000</resolved>
                                    <version>1.11.0</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Connectors / FileSystem</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17113823" author="zhoujira86" created="Fri, 22 May 2020 07:38:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;please help review this comment&lt;/p&gt;</comment>
                            <comment id="17113839" author="gaoyunhaii" created="Fri, 22 May 2020 08:10:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhoujira86&quot; class=&quot;user-hover&quot; rel=&quot;zhoujira86&quot;&gt;zhoujira86&lt;/a&gt; Do you mean StreamingFileWriter#currentWatermark should be initialized to 0 instead of MIN_LONG ?&lt;/p&gt;</comment>
                            <comment id="17113841" author="zhoujira86" created="Fri, 22 May 2020 08:14:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;, No , if we use process time, the watermark will be MIN_LONG. so the&#160;currentWatermark should be initialized to MIN_LONG, but with the transient, the&#160;currentWatermark will be initialized to 0... As I am working on similar feature , i found this issue. not sure whether i made some mistake...&lt;/p&gt;</comment>
                            <comment id="17113857" author="zhoujira86" created="Fri, 22 May 2020 08:40:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;for my understanding, the operator is serialized then submit to the flink. and transient value will not be serialized, and then runtime value of the&#160;currentWatermark will be initialized to zero...&lt;/p&gt;</comment>
                            <comment id="17113882" author="gaoyunhaii" created="Fri, 22 May 2020 09:20:03 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhoujira86&quot; class=&quot;user-hover&quot; rel=&quot;zhoujira86&quot;&gt;zhoujira86&lt;/a&gt; I think you are right that the transient value will be set to 0 after deserialization and the behavior is different from StreamingFileSink (which inherits the currentWatermarkField from StreamSink) and it should make differences for the records before the first watermark. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; could double confirm on this issue. &lt;/p&gt;

&lt;p&gt;One more thing, this issue seems to be belong to Table SQL / API instead of API / DataStream (labeled in the component field of this issue) ?&lt;/p&gt;</comment>
                            <comment id="17113883" author="zhoujira86" created="Fri, 22 May 2020 09:22:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;corrected, may i submit a PR for this?&lt;/p&gt;</comment>
                            <comment id="17113885" author="gaoyunhaii" created="Fri, 22 May 2020 09:25:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhoujira86&quot; class=&quot;user-hover&quot; rel=&quot;zhoujira86&quot;&gt;zhoujira86&lt;/a&gt; I think it is ok from my side, but I think it might be better to also wait for Jingsong to confirm the issue. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17113946" author="zhoujira86" created="Fri, 22 May 2020 11:10:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;thx a lot, Can you please help assign the issue to me?&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;I can get some opinion from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;on how to modify code&lt;/p&gt;</comment>
                            <comment id="17114044" author="lzljs3620320" created="Fri, 22 May 2020 13:37:04 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhoujira86&quot; class=&quot;user-hover&quot; rel=&quot;zhoujira86&quot;&gt;zhoujira86&lt;/a&gt;&#160;for reporting this issue.&#160;Yes, there may be a problem when watermark is negative. We can remove transient or initial in runtime. Assigned to you.&lt;/p&gt;</comment>
                            <comment id="17114046" author="lzljs3620320" created="Fri, 22 May 2020 13:39:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhoujira86&quot; class=&quot;user-hover&quot; rel=&quot;zhoujira86&quot;&gt;zhoujira86&lt;/a&gt; Can you create a PR for release-1.11?&lt;/p&gt;</comment>
                            <comment id="17114074" author="jark" created="Fri, 22 May 2020 14:11:07 +0000"  >&lt;p&gt;I don&apos;t think removing &lt;tt&gt;transient&lt;/tt&gt; can help here. The serialized watermark doesn&apos;t help when job is restored, the value is still the initial value. If you want to restore the watermark to the previous one, you have to use &lt;tt&gt;State&lt;/tt&gt; in streaming. However, this is another big topic and make the logic complex and will involve some performance concern. Besides, we didn&apos;t find any problem with current design so far. The watermark will be adjust to a correct value once there is new records coming in. &lt;/p&gt;</comment>
                            <comment id="17114082" author="lzljs3620320" created="Fri, 22 May 2020 14:23:26 +0000"  >&lt;p&gt;IIUC, operators only be deserialized from &lt;tt&gt;JobGraph&lt;/tt&gt;&#160;which comes from user initialization. So I don&apos;t mean removing transient help watermark persistence.&lt;/p&gt;

&lt;p&gt;But it can work for initialization we want (Long.Min_value in runtime). If you take a look to &lt;tt&gt;SinkOperator&lt;/tt&gt; and others, the watermark field works like this.&lt;/p&gt;

&lt;p&gt;It is not a big problem. In this case, we don&apos;t want to make&#160;watermark field persistent.&lt;/p&gt;</comment>
                            <comment id="17114115" author="jark" created="Fri, 22 May 2020 14:46:08 +0000"  >&lt;p&gt;Oh! I got what you mean &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;. Thanks for the explanation. &lt;/p&gt;</comment>
                            <comment id="17114499" author="zhoujira86" created="Sat, 23 May 2020 02:53:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;Hi Jingsong, thx for the advice, I have created another PR for release-1.11&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;Hi Jark, thx for the advice, when we use the process time mode , the watermark will not be overwritten. And when I tried to work on this issue, I didnt remove the transient, I init the value in&#160;initializeState.&lt;/p&gt;</comment>
                            <comment id="17115633" author="lzljs3620320" created="Mon, 25 May 2020 02:28:40 +0000"  >&lt;p&gt;master:&#160;e345d99a9e55a91d96fc5fc0e575ab7823f6fb74&lt;/p&gt;

&lt;p&gt;release-1.11:&#160;ff3ea323c8d98e075a742afad6b08ec18a830046&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13306752">FLINK-17885</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f1hc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>