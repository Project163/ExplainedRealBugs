<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-29437] The partition of data before and after the Kafka Shuffle are not aligned</title>
                <link>https://issues.apache.org/jira/browse/FLINK-29437</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I notice that the key group range in consumer side of Kafka Shuffle is not aligned with the producer side, there are two problems:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The data partitioning of the sink(producer) is exactly the same way as a keyed stream that as the same maximum parallelism as the number of kafka partitions does, but in consumer side the number of partitions and key groups are not the same.&lt;/li&gt;
	&lt;li&gt;There is a distribution of assigning kafka partitions to consumer subtasks (See KafkaTopicPartitionAssigner#assign), but the producer of Kafka Shuffle simply assume the partition index equals the subtask index. e.g.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160; &#160; &#160;  &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049852/13049852_image-2022-09-28-14-32-28-116.png&quot; height=&quot;274&quot; width=&quot;1133&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;My proposed change:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Set the max parallelism of the key stream in consumer side as the number of kafka partitions.&#160;&lt;/li&gt;
	&lt;li&gt;Use the same method when assigning kafka partitions to consumer subtasks to maintain a map from subtasks to kafka partitions, which is used by the producer to insert into the right partition for data for a subtask. i.e.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160; &#160; &#160;  &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049851/13049851_image-2022-09-28-14-35-47-954.png&quot; height=&quot;283&quot; width=&quot;1030&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13483589">FLINK-29437</key>
            <summary>The partition of data before and after the Kafka Shuffle are not aligned</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zakelly">Zakelly Lan</assignee>
                                    <reporter username="zakelly">Zakelly Lan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 28 Sep 2022 06:52:19 +0000</created>
                <updated>Mon, 21 Nov 2022 12:55:49 +0000</updated>
                            <resolved>Mon, 21 Nov 2022 12:55:49 +0000</resolved>
                                    <version>1.15.3</version>
                                    <fixVersion>1.17.0</fixVersion>
                                    <component>API / DataStream</component>
                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17610411" author="martijnvisser" created="Wed, 28 Sep 2022 07:57:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renqs&quot; class=&quot;user-hover&quot; rel=&quot;renqs&quot;&gt;renqs&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="17610472" author="renqs" created="Wed, 28 Sep 2022 09:42:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; This feature was initially implemented by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuanmei&quot; class=&quot;user-hover&quot; rel=&quot;yuanmei&quot;&gt;yuanmei&lt;/a&gt;, so maybe she could make some comments on this.&#160;&lt;/p&gt;</comment>
                            <comment id="17611494" author="zakelly" created="Fri, 30 Sep 2022 10:26:10 +0000"  >&lt;p&gt;After offline sync with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ym&quot; class=&quot;user-hover&quot; rel=&quot;ym&quot;&gt;ym&lt;/a&gt; , we agree to fix this as I proposed.&lt;/p&gt;</comment>
                            <comment id="17636667" author="ym" created="Mon, 21 Nov 2022 12:55:49 +0000"  >&lt;p&gt;merged commit&#160;&lt;a href=&quot;https://github.com/apache/flink/commit/0b816680e51283d261eb7b7bce560dd1641691ce&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;0b81668&lt;/tt&gt;&lt;/a&gt;&#160;into&#160;apache:master&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13483373">FLINK-29430</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13357437">FLINK-21317</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13049852" name="image-2022-09-28-14-32-28-116.png" size="73299" author="zakelly" created="Wed, 28 Sep 2022 06:32:50 +0000"/>
                            <attachment id="13049851" name="image-2022-09-28-14-35-47-954.png" size="76427" author="zakelly" created="Wed, 28 Sep 2022 06:35:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18wo0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>