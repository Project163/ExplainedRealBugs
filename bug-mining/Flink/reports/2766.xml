<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:36:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10990] Enforce minimum timespan in MeterView</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10990</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In the metric tool MeterView. If user use the meterview with the timespan smaller than UPDATE_INTERVAL_SECONDS = 5 , the getRate will always return 0/0 = NAN. And this is not friendly , I think we should pre-check it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13200132">FLINK-10990</key>
            <summary>Enforce minimum timespan in MeterView</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aitozi">WenJun Min</assignee>
                                    <reporter username="aitozi">WenJun Min</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 22 Nov 2018 16:55:20 +0000</created>
                <updated>Tue, 27 Nov 2018 16:09:46 +0000</updated>
                            <resolved>Tue, 27 Nov 2018 16:09:46 +0000</resolved>
                                    <version>1.5.5</version>
                    <version>1.6.2</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16696341" author="githubbot" created="Fri, 23 Nov 2018 03:12:35 +0000"  >&lt;p&gt;Aitozi opened a new pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   In the metric tool MeterView. If user use the meterview with the timespan smaller than UPDATE_INTERVAL_SECONDS = 5 , the getRate will always return 0/0 = NAN. And this is not friendly , I think we should pre-check it.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Added a case to test the timespan lower than the update interval&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16696343" author="githubbot" created="Fri, 23 Nov 2018 03:13:18 +0000"  >&lt;p&gt;Aitozi commented on issue #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#issuecomment-441148480&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#issuecomment-441148480&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   cc @zentol &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697514" author="githubbot" created="Fri, 23 Nov 2018 21:25:16 +0000"  >&lt;p&gt;zentol commented on a change in pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#discussion_r236018806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#discussion_r236018806&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -44,12 +47,19 @@&lt;br/&gt;
 	/** The last rate we computed. */&lt;br/&gt;
 	private double currentRate = 0;&lt;/p&gt;

&lt;p&gt;+	private static Logger logger = LoggerFactory.getLogger(MeterView.class);&lt;br/&gt;
+&lt;br/&gt;
 	public MeterView(int timeSpanInSeconds) &lt;/p&gt;
{
 		this(new SimpleCounter(), timeSpanInSeconds);
 	}

&lt;p&gt; 	public MeterView(Counter counter, int timeSpanInSeconds) {&lt;br/&gt;
 		this.counter = counter;&lt;br/&gt;
+		// timeSpanInSeconds should at least bigger than update interval&lt;br/&gt;
+		if (timeSpanInSeconds &amp;lt; UPDATE_INTERVAL_SECONDS) {&lt;br/&gt;
+			logger.warn(&quot;TimeSpan in meterview should not lower than update interval: {} and is set to {} by default&quot;, UPDATE_INTERVAL_SECONDS, UPDATE_INTERVAL_SECONDS);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I don&apos;t think we need this message. It&apos;s not like there are repercussions or anything.&lt;/p&gt;

&lt;p&gt;   We can then simply do&lt;br/&gt;
   ```&lt;br/&gt;
   this.timeSpanInSeconds = Math.max(&lt;br/&gt;
   	timeSpanInSeconds - (timeSpanInSeconds % UPDATE_INTERVAL_SECONDS),&lt;br/&gt;
   	UPDATE_INTERVAL_SECONDS);&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697515" author="githubbot" created="Fri, 23 Nov 2018 21:25:16 +0000"  >&lt;p&gt;zentol commented on a change in pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#discussion_r236018552&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#discussion_r236018552&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -44,12 +47,19 @@&lt;br/&gt;
 	/** The last rate we computed. */&lt;br/&gt;
 	private double currentRate = 0;&lt;/p&gt;

&lt;p&gt;+	private static Logger logger = LoggerFactory.getLogger(MeterView.class);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   should be static and named `LOG`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697516" author="githubbot" created="Fri, 23 Nov 2018 21:25:16 +0000"  >&lt;p&gt;zentol commented on a change in pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#discussion_r236019059&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#discussion_r236019059&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -94,4 +95,12 @@ public void testGetRate() &lt;/p&gt;
{
 		assertEquals(0.0, m.getRate(), 0.1); // 480 - 480 / 60
 
 	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testTooSmallTimeSpan() {&lt;br/&gt;
+		MeterView m = new MeterView(1);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   add an assertion that 1 is lower than `UPDATE_INTERVAL_SECONDS` as otherwise the test is invalid&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697517" author="githubbot" created="Fri, 23 Nov 2018 21:25:16 +0000"  >&lt;p&gt;zentol commented on a change in pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#discussion_r236019092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#discussion_r236019092&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -94,4 +95,12 @@ public void testGetRate() &lt;/p&gt;
{
 		assertEquals(0.0, m.getRate(), 0.1); // 480 - 480 / 60
 
 	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testTooSmallTimeSpan() {&lt;br/&gt;
+		MeterView m = new MeterView(1);&lt;br/&gt;
+		m.markEvent();&lt;br/&gt;
+		m.update();&lt;br/&gt;
+		assertTrue(0.2 == m.getRate());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   use assertequals instead&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697518" author="githubbot" created="Fri, 23 Nov 2018 21:25:16 +0000"  >&lt;p&gt;zentol commented on a change in pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#discussion_r236019042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#discussion_r236019042&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -94,4 +95,12 @@ public void testGetRate() &lt;/p&gt;
{
 		assertEquals(0.0, m.getRate(), 0.1); // 480 - 480 / 60
 
 	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testTooSmallTimeSpan() {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   =&amp;gt; `testTimeSpanBelowUpdateRate`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697519" author="githubbot" created="Fri, 23 Nov 2018 21:25:16 +0000"  >&lt;p&gt;zentol commented on a change in pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#discussion_r236018604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#discussion_r236018604&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -44,12 +47,19 @@&lt;br/&gt;
 	/** The last rate we computed. */&lt;br/&gt;
 	private double currentRate = 0;&lt;/p&gt;

&lt;p&gt;+	private static Logger logger = LoggerFactory.getLogger(MeterView.class);&lt;br/&gt;
+&lt;br/&gt;
 	public MeterView(int timeSpanInSeconds) &lt;/p&gt;
{
 		this(new SimpleCounter(), timeSpanInSeconds);
 	}

&lt;p&gt; 	public MeterView(Counter counter, int timeSpanInSeconds) {&lt;br/&gt;
 		this.counter = counter;&lt;br/&gt;
+		// timeSpanInSeconds should at least bigger than update interval&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   this comment should explain &lt;em&gt;why&lt;/em&gt; this is the case&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16698517" author="githubbot" created="Mon, 26 Nov 2018 06:30:09 +0000"  >&lt;p&gt;Aitozi commented on issue #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165#issuecomment-441532392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165#issuecomment-441532392&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   have addressed according your comment @zentol &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16700626" author="githubbot" created="Tue, 27 Nov 2018 16:04:47 +0000"  >&lt;p&gt;zentol closed pull request #7165: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10990&quot; title=&quot;Enforce minimum timespan in MeterView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10990&quot;&gt;&lt;del&gt;FLINK-10990&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Metric&amp;#93;&lt;/span&gt;Pre-check timespan in meterview to avoid NAN&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7165&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java b/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java&lt;br/&gt;
index 8df0e868f8f..6d53325edaf 100644&lt;br/&gt;
&amp;#8212; a/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java&lt;br/&gt;
+++ b/flink-metrics/flink-metrics-core/src/main/java/org/apache/flink/metrics/MeterView.java&lt;br/&gt;
@@ -50,7 +50,11 @@ public MeterView(int timeSpanInSeconds) {&lt;/p&gt;

&lt;p&gt; 	public MeterView(Counter counter, int timeSpanInSeconds) &lt;/p&gt;
{
 		this.counter = counter;
-		this.timeSpanInSeconds = timeSpanInSeconds - (timeSpanInSeconds % UPDATE_INTERVAL_SECONDS);
+		// the time-span must be larger than the update-interval as otherwise the array has a size of 1,
+		// for which no rate can be computed as no distinct before/after measurement exists.
+		this.timeSpanInSeconds = Math.max(
+			timeSpanInSeconds - (timeSpanInSeconds % UPDATE_INTERVAL_SECONDS),
+			UPDATE_INTERVAL_SECONDS);
 		this.values = new long[this.timeSpanInSeconds / UPDATE_INTERVAL_SECONDS + 1];
 	}

&lt;p&gt;diff --git a/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java b/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java&lt;br/&gt;
index a7a63b09949..7752a6e80bb 100644&lt;br/&gt;
&amp;#8212; a/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java&lt;br/&gt;
+++ b/flink-metrics/flink-metrics-core/src/test/java/org/apache/flink/metrics/MeterViewTest.java&lt;br/&gt;
@@ -20,6 +20,7 @@&lt;/p&gt;

&lt;p&gt; import org.junit.Test;&lt;/p&gt;

&lt;p&gt;+import static org.apache.flink.metrics.View.UPDATE_INTERVAL_SECONDS;&lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
@@ -94,4 +95,14 @@ public void testGetRate() &lt;/p&gt;
{
 		assertEquals(0.0, m.getRate(), 0.1); // 480 - 480 / 60
 
 	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testTimeSpanBelowUpdateRate() &lt;/p&gt;
{
+		int timeSpanInSeconds = 1;
+		MeterView m = new MeterView(timeSpanInSeconds);
+		assert timeSpanInSeconds &amp;lt; UPDATE_INTERVAL_SECONDS;
+		m.markEvent();
+		m.update();
+		assertEquals(0.2, m.getRate(), 0.0);
+	}
&lt;p&gt; }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16700634" author="zentol" created="Tue, 27 Nov 2018 16:09:46 +0000"  >&lt;p&gt;master: 4cc9479805f422433ceeaa9ba6eb1ef8c5456aa1&lt;br/&gt;
1.7: a6dd16aef16b3afd5fa0cd100709629dcf88e2a5&lt;br/&gt;
1.6: 05d969e7b7bd0e54935eeda3f95d4a7711cef6e8&lt;br/&gt;
1.5: 0c7b230569deba5f38aa82b2248c217c8584ed72&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00sdc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>