<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3188] Deletes in Kafka source should be passed on to KeyedDeserializationSchema</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3188</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When keys are deleted in the kafka queue, they show up as keys with null payload. Currently in Flink 1.0-SNAPSHOT, these deletions are silently skipped, without increasing current offset.&lt;/p&gt;

&lt;p&gt;This leads to two problems:&lt;/p&gt;

&lt;p&gt;1. When a fetch window contains only deletions, LegacyFetcher gets stuck&lt;br/&gt;
2. For KeyedDeserializationSchemas, it would make sense to pass deletions to the deserializer, so that it can decide to wrap deleted keys as a deletion command. This is also more consistent with the semantics of keys in Kafka queues: When compaction is activated, only the latest message with the same key needs to be kept by Kafka.&lt;/p&gt;

&lt;p&gt;We propose the attached patch as a workaround for both issues.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12923081">FLINK-3188</key>
            <summary>Deletes in Kafka source should be passed on to KeyedDeserializationSchema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rmetzger">Robert Metzger</assignee>
                                    <reporter username="packet">Sebastian Klemke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Dec 2015 17:52:41 +0000</created>
                <updated>Tue, 5 Jan 2016 09:03:25 +0000</updated>
                            <resolved>Tue, 5 Jan 2016 09:03:24 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15064328" author="packet" created="Fri, 18 Dec 2015 17:54:50 +0000"  >&lt;p&gt;Patch to LegacyFetcher to pass deletions on to DeserializationSchema&lt;/p&gt;</comment>
                            <comment id="15066567" author="rmetzger" created="Mon, 21 Dec 2015 15:26:33 +0000"  >&lt;p&gt;Thank you for providing a patch for the issue.&lt;br/&gt;
Do you know how Kafka&apos;s own high level (and the new consumer API) are handling deleted messages? Are they also passing null values for those messages? I would like to make Flink&apos;s behavior similar to Kafka&apos;s.&lt;br/&gt;
I would also like to add a test case for this to ensure its always working &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;How urgent do you need this fixed? &lt;/p&gt;</comment>
                            <comment id="15066657" author="packet" created="Mon, 21 Dec 2015 16:29:14 +0000"  >&lt;p&gt;Unfortunately, we also didn&apos;t have the time to look into the new consumer API, yet.&lt;/p&gt;

&lt;p&gt;Regarding the time frame: We would be very much pleased if this bug was fixed until beginning of next year. Earlier is better &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15067760" author="sanjar" created="Tue, 22 Dec 2015 08:49:24 +0000"  >&lt;p&gt;Deletes(msg with key and null value) are consumed as normal messages. The only special thing about them is, kafka can be configured to clean up deletes to free up some space. Exposing deletes is part of the kafka contract:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;All delete markers for deleted records will be seen provided the reader reaches the head of the log in a time period less than the topic&apos;s delete.retention.ms setting (the default is 24 hours).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;All official consumer apis, including new one, expose null values to the client.&lt;/p&gt;</comment>
                            <comment id="15080929" author="packet" created="Mon, 4 Jan 2016 10:15:35 +0000"  >&lt;p&gt;Test case for the patch&lt;/p&gt;</comment>
                            <comment id="15081011" author="rmetzger" created="Mon, 4 Jan 2016 11:10:13 +0000"  >&lt;p&gt;Thank you for providing a test case. I&apos;ll open a pull request for the changes and merge them soon.&lt;/p&gt;</comment>
                            <comment id="15081171" author="githubbot" created="Mon, 4 Jan 2016 13:54:38 +0000"  >&lt;p&gt;GitHub user rmetzger opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3188&quot; title=&quot;Deletes in Kafka source should be passed on to KeyedDeserializationSchema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3188&quot;&gt;&lt;del&gt;FLINK-3188&lt;/del&gt;&lt;/a&gt; Pass deletes to KeyedDeserializationSchema&lt;/p&gt;

&lt;p&gt;    I&apos;ve converted the two patches from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-3188&lt;/a&gt; into this pull request.&lt;br/&gt;
    I removed the manual serializer creation from the patches and replaced them by a `TypeInformationKeyValueSerializationSchema`.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rmetzger/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rmetzger/flink&lt;/a&gt; flink3188&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1484.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1484.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1484&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4bd36b45ab53940e63dbbc98e21fe51ac4f7a3ad&lt;br/&gt;
Author: Sebastian Klemke &amp;lt;sebastian.klemke@researchgate.net&amp;gt;&lt;br/&gt;
Date:   2016-01-04T13:52:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3188&quot; title=&quot;Deletes in Kafka source should be passed on to KeyedDeserializationSchema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3188&quot;&gt;&lt;del&gt;FLINK-3188&lt;/del&gt;&lt;/a&gt; Pass deletes to KeyedDeserializationSchema&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15081172" author="rmetzger" created="Mon, 4 Jan 2016 13:55:30 +0000"  >&lt;p&gt;I&apos;ve now opened a pull request from your changes: &lt;a href=&quot;https://github.com/apache/flink/pull/1484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1484&lt;/a&gt; (I&apos;ve set you as the commit author).&lt;/p&gt;

&lt;p&gt;I removed your custom serialization schema with a generated one, let me know if this breaks anything.&lt;/p&gt;</comment>
                            <comment id="15081566" author="githubbot" created="Mon, 4 Jan 2016 18:51:04 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1484#issuecomment-168766653&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1484#issuecomment-168766653&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;d like to merge this change in the next 12 hours: its a rather small fix with a test and travis passed.&lt;/p&gt;</comment>
                            <comment id="15082663" author="githubbot" created="Tue, 5 Jan 2016 08:59:22 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1484#issuecomment-168938339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1484#issuecomment-168938339&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging ...&lt;/p&gt;</comment>
                            <comment id="15082668" author="githubbot" created="Tue, 5 Jan 2016 09:03:14 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1484&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15082669" author="rmetzger" created="Tue, 5 Jan 2016 09:03:25 +0000"  >&lt;p&gt;Resolved for 1.0.0 in &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/dcf86c27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/dcf86c27&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12778527" name="kafka-deletions.patch" size="1723" author="packet" created="Fri, 18 Dec 2015 17:54:50 +0000"/>
                            <attachment id="12780292" name="testcase.patch" size="11065" author="packet" created="Mon, 4 Jan 2016 10:15:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q3lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>