<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10655] RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10655</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;RemoteRpcInvocation&lt;/tt&gt; tries to give a more detailed &lt;tt&gt;ClassNotFoundException&lt;/tt&gt; if the method type/argument deserialization fails. However, it turns out, once &lt;tt&gt;ObjectInputStream&lt;/tt&gt; has received a &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;, it will not overwrite this anymore and we can therefore not provide a more detailed &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Instead, the least invasive solution would be to add a suppressed &lt;tt&gt;ClassNotFoundException&lt;/tt&gt; to the existing one. While at it, we could also add more details, i.e. the successfully deserialized types and arguments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13193617">FLINK-10655</key>
            <summary>RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 23 Oct 2018 16:36:39 +0000</created>
                <updated>Thu, 15 Nov 2018 08:53:32 +0000</updated>
                            <resolved>Thu, 15 Nov 2018 08:53:32 +0000</resolved>
                                    <version>1.5.4</version>
                    <version>1.6.1</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16662233" author="githubbot" created="Wed, 24 Oct 2018 12:44:00 +0000"  >&lt;p&gt;NicoK opened a new pull request #6920: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10655&quot; title=&quot;RemoteRpcInvocation not overwriting ObjectInputStream&amp;#39;s ClassNotFoundException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10655&quot;&gt;&lt;del&gt;FLINK-10655&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; fix RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6920&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   `RemoteRpcInvocation` tries to give a more detailed `ClassNotFoundException` if the method type/argument deserialization fails. However, it turns out, once `ObjectInputStream` has received a `ClassNotFoundException`, it will not overwrite this anymore and we can therefore not provide a more detailed `ClassNotFoundException`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add a suppressed `ClassNotFoundException` to the existing one which contains more details&lt;/li&gt;
	&lt;li&gt;add more details, i.e. all successfully deserialized types and parameters (in addition to the method name)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added `ClassLoaderTest#testMessageDecodingWithUnavailableClass`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;* (we only integrate into the deserialization of `RemoteRpcInvocation`)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;don&apos;t know&lt;/b&gt;* (not really - this only adds more debug infos in case of failures)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;JavaDocs&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16672921" author="githubbot" created="Fri, 2 Nov 2018 10:50:26 +0000"  >&lt;p&gt;tillrohrmann commented on issue #6920: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10655&quot; title=&quot;RemoteRpcInvocation not overwriting ObjectInputStream&amp;#39;s ClassNotFoundException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10655&quot;&gt;&lt;del&gt;FLINK-10655&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; fix RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6920#issuecomment-435341118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6920#issuecomment-435341118&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This PR is based against `release-1.6`. Please mark this PR as a backport and open a new one against the `master` branch. Thanks!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16672926" author="githubbot" created="Fri, 2 Nov 2018 10:54:19 +0000"  >&lt;p&gt;NicoK opened a new pull request #7005: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10655&quot; title=&quot;RemoteRpcInvocation not overwriting ObjectInputStream&amp;#39;s ClassNotFoundException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10655&quot;&gt;&lt;del&gt;FLINK-10655&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; fix RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7005&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   `RemoteRpcInvocation` tries to give a more detailed `ClassNotFoundException` if the method type/argument deserialization fails. However, it turns out, once `ObjectInputStream` has received a `ClassNotFoundException`, it will not overwrite this anymore and we can therefore not provide a more detailed `ClassNotFoundException`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add a suppressed `ClassNotFoundException` to the existing one which contains more details&lt;/li&gt;
	&lt;li&gt;add more details, i.e. all successfully deserialized types and parameters (in addition to the method name)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added `ClassLoaderTest#testMessageDecodingWithUnavailableClass`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;* (we only integrate into the deserialization of `RemoteRpcInvocation`)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;don&apos;t know&lt;/b&gt;* (not really - this only adds more debug infos in case of failures)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;JavaDocs&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675759" author="githubbot" created="Mon, 5 Nov 2018 21:01:35 +0000"  >&lt;p&gt;tillrohrmann closed pull request #6920: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10655&quot; title=&quot;RemoteRpcInvocation not overwriting ObjectInputStream&amp;#39;s ClassNotFoundException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10655&quot;&gt;&lt;del&gt;FLINK-10655&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; fix RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6920&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java&lt;br/&gt;
index 1f67acbab7d..2bcae452287 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java&lt;br/&gt;
@@ -23,21 +23,17 @@&lt;br/&gt;
 import org.apache.flink.api.common.typeutils.TypeSerializerSerializationUtil;&lt;br/&gt;
 import org.apache.flink.core.memory.DataInputViewStreamWrapper;&lt;br/&gt;
 import org.apache.flink.core.memory.DataOutputViewStreamWrapper;&lt;br/&gt;
+import org.apache.flink.testutils.ClassLoaderUtils;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;br/&gt;
+&lt;br/&gt;
 import org.junit.Assert;&lt;br/&gt;
 import org.junit.ClassRule;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt;-import javax.tools.JavaCompiler;&lt;br/&gt;
-import javax.tools.ToolProvider;&lt;br/&gt;
 import java.io.ByteArrayInputStream;&lt;br/&gt;
 import java.io.ByteArrayOutputStream;&lt;br/&gt;
-import java.io.File;&lt;br/&gt;
-import java.io.FileWriter;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
-import java.net.URL;&lt;br/&gt;
-import java.net.URLClassLoader;&lt;/p&gt;

&lt;p&gt; public class EnumSerializerUpgradeTest extends TestLogger {&lt;/p&gt;

&lt;p&gt;@@ -87,7 +83,7 @@ public void checkDifferentFieldOrder() throws Exception {&lt;br/&gt;
 	private static CompatibilityResult checkCompatibility(String enumSourceA, String enumSourceB)&lt;br/&gt;
 		throws IOException, ClassNotFoundException &lt;/p&gt;
{
 
-		ClassLoader classLoader = compileAndLoadEnum(
+		ClassLoader classLoader = ClassLoaderUtils.compileAndLoadJava(
 			temporaryFolder.newFolder(), ENUM_NAME + &quot;.java&quot;, enumSourceA);
 
 		EnumSerializer enumSerializer = new EnumSerializer(classLoader.loadClass(ENUM_NAME));
@@ -102,7 +98,7 @@ private static CompatibilityResult checkCompatibility(String enumSourceA, String
 			snapshotBytes = outBuffer.toByteArray();
 		}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ClassLoader classLoader2 = compileAndLoadEnum(&lt;br/&gt;
+		ClassLoader classLoader2 = ClassLoaderUtils.compileAndLoadJava(&lt;br/&gt;
 			temporaryFolder.newFolder(), ENUM_NAME + &quot;.java&quot;, enumSourceB);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		TypeSerializerConfigSnapshot restoredSnapshot;&lt;br/&gt;
@@ -116,29 +112,4 @@ private static CompatibilityResult checkCompatibility(String enumSourceA, String&lt;br/&gt;
 		EnumSerializer enumSerializer2 = new EnumSerializer(classLoader2.loadClass(ENUM_NAME));&lt;br/&gt;
 		return enumSerializer2.ensureCompatibility(restoredSnapshot);&lt;br/&gt;
 	}&lt;br/&gt;
-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static ClassLoader compileAndLoadEnum(File root, String filename, String source) throws IOException {&lt;/li&gt;
	&lt;li&gt;File file = writeSourceFile(root, filename, source);&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;compileClass(file);&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;return new URLClassLoader(&lt;/li&gt;
	&lt;li&gt;new URL[]
{root.toURI().toURL()},&lt;br/&gt;
-			Thread.currentThread().getContextClassLoader());&lt;br/&gt;
-	}&lt;br/&gt;
-&lt;br/&gt;
-	private static File writeSourceFile(File root, String filename, String source) throws IOException {
-		File file = new File(root, filename);
-		FileWriter fileWriter = new FileWriter(file);
-
-		fileWriter.write(source);
-		fileWriter.close();
-
-		return file;
-	}&lt;br/&gt;
-&lt;br/&gt;
-	private static int compileClass(File sourceFile) {
-		JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();
-		return compiler.run(null, null, null, &quot;-proc:none&quot;, sourceFile.getPath());
-	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-core/src/test/java/org/apache/flink/testutils/ClassLoaderUtils.java b/flink-core/src/test/java/org/apache/flink/testutils/ClassLoaderUtils.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..0688c1df156&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/testutils/ClassLoaderUtils.java&lt;br/&gt;
@@ -0,0 +1,59 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.testutils;&lt;br/&gt;
+&lt;br/&gt;
+import javax.tools.JavaCompiler;&lt;br/&gt;
+import javax.tools.ToolProvider;&lt;br/&gt;
+&lt;br/&gt;
+import java.io.File;&lt;br/&gt;
+import java.io.FileWriter;&lt;br/&gt;
+import java.io.IOException;&lt;br/&gt;
+import java.net.URL;&lt;br/&gt;
+import java.net.URLClassLoader;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Utilities to create class loaders.&lt;br/&gt;
+ */&lt;br/&gt;
+public class ClassLoaderUtils {&lt;br/&gt;
+	public static URLClassLoader compileAndLoadJava(File root, String filename, String source) throws&lt;br/&gt;
+		IOException {&lt;br/&gt;
+		File file = writeSourceFile(root, filename, source);&lt;br/&gt;
+&lt;br/&gt;
+		compileClass(file);&lt;br/&gt;
+&lt;br/&gt;
+		return new URLClassLoader(&lt;br/&gt;
+			new URL[]{root.toURI().toURL()}
&lt;p&gt;,&lt;br/&gt;
+			Thread.currentThread().getContextClassLoader());&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static File writeSourceFile(File root, String filename, String source) throws IOException &lt;/p&gt;
{
+		File file = new File(root, filename);
+		FileWriter fileWriter = new FileWriter(file);
+
+		fileWriter.write(source);
+		fileWriter.close();
+
+		return file;
+	}
&lt;p&gt;+&lt;br/&gt;
+	private static int compileClass(File sourceFile) &lt;/p&gt;
{
+		JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();
+		return compiler.run(null, null, null, &quot;-proc:none&quot;, sourceFile.getPath());
+	}
&lt;p&gt;+}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java&lt;br/&gt;
index 7b9fb887670..486816de8e8 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java&lt;br/&gt;
@@ -203,12 +203,18 @@ private void readObject(ObjectInputStream ois) throws IOException, ClassNotFound&lt;br/&gt;
 				try 
{
 					parameterTypes[i] = (Class&amp;lt;?&amp;gt;) ois.readObject();
 				}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
+					StringBuilder incompleteMethod = getIncompleteMethodString(i, 0);
 					throw new IOException(&quot;Could not deserialize &quot; + i + &quot;th parameter type of method &quot; +
-						methodName + &apos;.&apos;, e);
+						incompleteMethod + &apos;.&apos;, e);
 				}
&lt;p&gt; catch (ClassNotFoundException e) &lt;/p&gt;
{
-					throw new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
-						&quot;parameter type of method &quot; + methodName + &quot;. This indicates that the parameter &quot; +
-						&quot;type is not part of the system class loader.&quot;, e);
+					// note: wrapping this CNFE into another CNFE does not overwrite the Exception
+					//       stored in the ObjectInputStream (see ObjectInputStream#readSerialData)
+					// -&amp;gt; add a suppressed exception that adds a more specific message
+					StringBuilder incompleteMethod = getIncompleteMethodString(i, 0);
+					e.addSuppressed(new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
+						&quot;parameter type of method &quot; + incompleteMethod + &quot;. This indicates that the parameter &quot; +
+						&quot;type is not part of the system class loader.&quot;));
+					throw e;
 				}
&lt;p&gt; 			}&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -221,17 +227,37 @@ private void readObject(ObjectInputStream ois) throws IOException, ClassNotFound&lt;br/&gt;
 					try &lt;/p&gt;
{
 						args[i] = ois.readObject();
 					}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
+						StringBuilder incompleteMethod = getIncompleteMethodString(length, i);
 						throw new IOException(&quot;Could not deserialize &quot; + i + &quot;th argument of method &quot; +
-							methodName + &apos;.&apos;, e);
+							incompleteMethod + &apos;.&apos;, e);
 					}
&lt;p&gt; catch (ClassNotFoundException e) &lt;/p&gt;
{
-						throw new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
-							&quot;argument of method &quot; + methodName + &quot;. This indicates that the argument &quot; +
-							&quot;type is not part of the system class loader.&quot;, e);
+						// note: wrapping this CNFE into another CNFE does not overwrite the Exception
+						//       stored in the ObjectInputStream (see ObjectInputStream#readSerialData)
+						// -&amp;gt; add a suppressed exception that adds a more specific message
+						StringBuilder incompleteMethod = getIncompleteMethodString(length, i);
+						e.addSuppressed(new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
+							&quot;argument of method &quot; + incompleteMethod + &quot;. This indicates that the argument &quot; +
+							&quot;type is not part of the system class loader.&quot;));
+						throw e;
 					}
&lt;p&gt; 				}&lt;br/&gt;
 			} else &lt;/p&gt;
{
 				args = null;
 			}
&lt;p&gt; 		}&lt;br/&gt;
+&lt;br/&gt;
+		private StringBuilder getIncompleteMethodString(int lastMethodTypeIdx, int lastArgumentIdx) {&lt;br/&gt;
+			StringBuilder incompleteMethod = new StringBuilder();&lt;br/&gt;
+			incompleteMethod.append(methodName).append(&apos;(&apos;);&lt;br/&gt;
+			for (int i = 0; i &amp;lt; lastMethodTypeIdx; ++i) {&lt;br/&gt;
+				incompleteMethod.append(parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getCanonicalName());&lt;br/&gt;
+				if (i &amp;lt; lastArgumentIdx) &lt;/p&gt;
{
+					incompleteMethod.append(&quot;: &quot;).append(args[i]);
+				}
&lt;p&gt;+				incompleteMethod.append(&quot;, &quot;);&lt;br/&gt;
+			}&lt;br/&gt;
+			incompleteMethod.append(&quot;...)&quot;); // some parameters could not be deserialized&lt;br/&gt;
+			return incompleteMethod;&lt;br/&gt;
+		}&lt;br/&gt;
 	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java&lt;br/&gt;
index c02278c5088..7c664ce0b32 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java&lt;br/&gt;
@@ -19,21 +19,78 @@&lt;br/&gt;
 package org.apache.flink.runtime.classloading;&lt;/p&gt;

&lt;p&gt; import org.apache.flink.runtime.execution.librarycache.FlinkUserCodeClassLoaders;&lt;br/&gt;
+import org.apache.flink.runtime.rpc.messages.RemoteRpcInvocation;&lt;br/&gt;
+import org.apache.flink.testutils.ClassLoaderUtils;&lt;br/&gt;
+import org.apache.flink.util.SerializedValue;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;/p&gt;

&lt;p&gt;+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Rule;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
+import org.junit.rules.ExpectedException;&lt;br/&gt;
+import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt; import java.net.URL;&lt;br/&gt;
 import java.net.URLClassLoader;&lt;/p&gt;

&lt;p&gt;+import static org.hamcrest.CoreMatchers.allOf;&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.containsString;&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.isA;&lt;br/&gt;
+import static org.hamcrest.Matchers.hasItemInArray;&lt;br/&gt;
+import static org.hamcrest.Matchers.hasProperty;&lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertNotEquals;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Tests for classloading and class loder utilities.&lt;br/&gt;
+ * Tests for classloading and class loader utilities.&lt;br/&gt;
  */&lt;br/&gt;
 public class ClassLoaderTest extends TestLogger {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+	@ClassRule&lt;br/&gt;
+	public static TemporaryFolder temporaryFolder = new TemporaryFolder();&lt;br/&gt;
+&lt;br/&gt;
+	@Rule&lt;br/&gt;
+	public ExpectedException expectedException = ExpectedException.none();&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testMessageDecodingWithUnavailableClass() throws Exception {&lt;br/&gt;
+		final ClassLoader systemClassLoader = getClass().getClassLoader();&lt;br/&gt;
+&lt;br/&gt;
+		final String className = &quot;UserClass&quot;;&lt;br/&gt;
+		final URLClassLoader userClassLoader = ClassLoaderUtils.compileAndLoadJava(&lt;br/&gt;
+			temporaryFolder.newFolder(),&lt;br/&gt;
+			className + &quot;.java&quot;,&lt;br/&gt;
+			&quot;import java.io.Serializable;\n&quot;&lt;br/&gt;
+				+ &quot;public class &quot; + className + &quot; implements Serializable {}&quot;);&lt;br/&gt;
+&lt;br/&gt;
+		RemoteRpcInvocation method = new RemoteRpcInvocation(&lt;br/&gt;
+			&quot;test&quot;,&lt;br/&gt;
+			new Class&amp;lt;?&amp;gt;[] &lt;/p&gt;
{
+				int.class,
+				Class.forName(className, false, userClassLoader)}
&lt;p&gt;,&lt;br/&gt;
+			new Object[] &lt;/p&gt;
{
+				1,
+				Class.forName(className, false, userClassLoader).newInstance()}
&lt;p&gt;);&lt;br/&gt;
+&lt;br/&gt;
+		SerializedValue&amp;lt;RemoteRpcInvocation&amp;gt; serializedMethod = new SerializedValue&amp;lt;&amp;gt;(method);&lt;br/&gt;
+&lt;br/&gt;
+		expectedException.expect(ClassNotFoundException.class);&lt;br/&gt;
+		expectedException.expect(&lt;br/&gt;
+			allOf(&lt;br/&gt;
+				isA(ClassNotFoundException.class),&lt;br/&gt;
+				hasProperty(&quot;suppressed&quot;,&lt;br/&gt;
+					hasItemInArray(&lt;br/&gt;
+						allOf(&lt;br/&gt;
+							isA(ClassNotFoundException.class),&lt;br/&gt;
+							hasProperty(&quot;message&quot;,&lt;br/&gt;
+								containsString(&quot;Could not deserialize 1th parameter type of method test(int, ...).&quot;)))))));&lt;br/&gt;
+&lt;br/&gt;
+		RemoteRpcInvocation deserializedMethod = serializedMethod.deserializeValue(systemClassLoader);&lt;br/&gt;
+		deserializedMethod.getMethodName();&lt;br/&gt;
+&lt;br/&gt;
+		userClassLoader.close();&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testParentFirstClassLoading() throws Exception {&lt;br/&gt;
 		final ClassLoader parentClassLoader = getClass().getClassLoader();&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675760" author="githubbot" created="Mon, 5 Nov 2018 21:02:00 +0000"  >&lt;p&gt;tillrohrmann closed pull request #7005: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10655&quot; title=&quot;RemoteRpcInvocation not overwriting ObjectInputStream&amp;#39;s ClassNotFoundException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10655&quot;&gt;&lt;del&gt;FLINK-10655&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; fix RemoteRpcInvocation not overwriting ObjectInputStream&apos;s ClassNotFoundException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7005&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java&lt;br/&gt;
index e906f62f65b..fb119453057 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/base/EnumSerializerUpgradeTest.java&lt;br/&gt;
@@ -23,21 +23,17 @@&lt;br/&gt;
 import org.apache.flink.api.common.typeutils.TypeSerializerSnapshot;&lt;br/&gt;
 import org.apache.flink.core.memory.DataInputViewStreamWrapper;&lt;br/&gt;
 import org.apache.flink.core.memory.DataOutputViewStreamWrapper;&lt;br/&gt;
+import org.apache.flink.testutils.ClassLoaderUtils;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;br/&gt;
+&lt;br/&gt;
 import org.junit.Assert;&lt;br/&gt;
 import org.junit.ClassRule;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt;-import javax.tools.JavaCompiler;&lt;br/&gt;
-import javax.tools.ToolProvider;&lt;br/&gt;
 import java.io.ByteArrayInputStream;&lt;br/&gt;
 import java.io.ByteArrayOutputStream;&lt;br/&gt;
-import java.io.File;&lt;br/&gt;
-import java.io.FileWriter;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
-import java.net.URL;&lt;br/&gt;
-import java.net.URLClassLoader;&lt;/p&gt;

&lt;p&gt; public class EnumSerializerUpgradeTest extends TestLogger {&lt;/p&gt;

&lt;p&gt;@@ -87,7 +83,7 @@ public void checkDifferentFieldOrder() throws Exception {&lt;br/&gt;
 	private static TypeSerializerSchemaCompatibility checkCompatibility(String enumSourceA, String enumSourceB)&lt;br/&gt;
 		throws IOException, ClassNotFoundException &lt;/p&gt;
{
 
-		ClassLoader classLoader = compileAndLoadEnum(
+		ClassLoader classLoader = ClassLoaderUtils.compileAndLoadJava(
 			temporaryFolder.newFolder(), ENUM_NAME + &quot;.java&quot;, enumSourceA);
 
 		EnumSerializer enumSerializer = new EnumSerializer(classLoader.loadClass(ENUM_NAME));
@@ -103,7 +99,7 @@ private static TypeSerializerSchemaCompatibility checkCompatibility(String enumS
 			snapshotBytes = outBuffer.toByteArray();
 		}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ClassLoader classLoader2 = compileAndLoadEnum(&lt;br/&gt;
+		ClassLoader classLoader2 = ClassLoaderUtils.compileAndLoadJava(&lt;br/&gt;
 			temporaryFolder.newFolder(), ENUM_NAME + &quot;.java&quot;, enumSourceB);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		TypeSerializerSnapshot restoredSnapshot;&lt;br/&gt;
@@ -118,29 +114,4 @@ private static TypeSerializerSchemaCompatibility checkCompatibility(String enumS&lt;br/&gt;
 		EnumSerializer enumSerializer2 = new EnumSerializer(classLoader2.loadClass(ENUM_NAME));&lt;br/&gt;
 		return restoredSnapshot.resolveSchemaCompatibility(enumSerializer2);&lt;br/&gt;
 	}&lt;br/&gt;
-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static ClassLoader compileAndLoadEnum(File root, String filename, String source) throws IOException {&lt;/li&gt;
	&lt;li&gt;File file = writeSourceFile(root, filename, source);&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;compileClass(file);&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;return new URLClassLoader(&lt;/li&gt;
	&lt;li&gt;new URL[]
{root.toURI().toURL()},&lt;br/&gt;
-			Thread.currentThread().getContextClassLoader());&lt;br/&gt;
-	}&lt;br/&gt;
-&lt;br/&gt;
-	private static File writeSourceFile(File root, String filename, String source) throws IOException {
-		File file = new File(root, filename);
-		FileWriter fileWriter = new FileWriter(file);
-
-		fileWriter.write(source);
-		fileWriter.close();
-
-		return file;
-	}&lt;br/&gt;
-&lt;br/&gt;
-	private static int compileClass(File sourceFile) {
-		JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();
-		return compiler.run(null, null, null, &quot;-proc:none&quot;, sourceFile.getPath());
-	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-core/src/test/java/org/apache/flink/testutils/ClassLoaderUtils.java b/flink-core/src/test/java/org/apache/flink/testutils/ClassLoaderUtils.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..0688c1df156&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/testutils/ClassLoaderUtils.java&lt;br/&gt;
@@ -0,0 +1,59 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.testutils;&lt;br/&gt;
+&lt;br/&gt;
+import javax.tools.JavaCompiler;&lt;br/&gt;
+import javax.tools.ToolProvider;&lt;br/&gt;
+&lt;br/&gt;
+import java.io.File;&lt;br/&gt;
+import java.io.FileWriter;&lt;br/&gt;
+import java.io.IOException;&lt;br/&gt;
+import java.net.URL;&lt;br/&gt;
+import java.net.URLClassLoader;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Utilities to create class loaders.&lt;br/&gt;
+ */&lt;br/&gt;
+public class ClassLoaderUtils {&lt;br/&gt;
+	public static URLClassLoader compileAndLoadJava(File root, String filename, String source) throws&lt;br/&gt;
+		IOException {&lt;br/&gt;
+		File file = writeSourceFile(root, filename, source);&lt;br/&gt;
+&lt;br/&gt;
+		compileClass(file);&lt;br/&gt;
+&lt;br/&gt;
+		return new URLClassLoader(&lt;br/&gt;
+			new URL[]{root.toURI().toURL()}
&lt;p&gt;,&lt;br/&gt;
+			Thread.currentThread().getContextClassLoader());&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static File writeSourceFile(File root, String filename, String source) throws IOException &lt;/p&gt;
{
+		File file = new File(root, filename);
+		FileWriter fileWriter = new FileWriter(file);
+
+		fileWriter.write(source);
+		fileWriter.close();
+
+		return file;
+	}
&lt;p&gt;+&lt;br/&gt;
+	private static int compileClass(File sourceFile) &lt;/p&gt;
{
+		JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();
+		return compiler.run(null, null, null, &quot;-proc:none&quot;, sourceFile.getPath());
+	}
&lt;p&gt;+}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java&lt;br/&gt;
index 7b9fb887670..486816de8e8 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/messages/RemoteRpcInvocation.java&lt;br/&gt;
@@ -203,12 +203,18 @@ private void readObject(ObjectInputStream ois) throws IOException, ClassNotFound&lt;br/&gt;
 				try 
{
 					parameterTypes[i] = (Class&amp;lt;?&amp;gt;) ois.readObject();
 				}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
+					StringBuilder incompleteMethod = getIncompleteMethodString(i, 0);
 					throw new IOException(&quot;Could not deserialize &quot; + i + &quot;th parameter type of method &quot; +
-						methodName + &apos;.&apos;, e);
+						incompleteMethod + &apos;.&apos;, e);
 				}
&lt;p&gt; catch (ClassNotFoundException e) &lt;/p&gt;
{
-					throw new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
-						&quot;parameter type of method &quot; + methodName + &quot;. This indicates that the parameter &quot; +
-						&quot;type is not part of the system class loader.&quot;, e);
+					// note: wrapping this CNFE into another CNFE does not overwrite the Exception
+					//       stored in the ObjectInputStream (see ObjectInputStream#readSerialData)
+					// -&amp;gt; add a suppressed exception that adds a more specific message
+					StringBuilder incompleteMethod = getIncompleteMethodString(i, 0);
+					e.addSuppressed(new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
+						&quot;parameter type of method &quot; + incompleteMethod + &quot;. This indicates that the parameter &quot; +
+						&quot;type is not part of the system class loader.&quot;));
+					throw e;
 				}
&lt;p&gt; 			}&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -221,17 +227,37 @@ private void readObject(ObjectInputStream ois) throws IOException, ClassNotFound&lt;br/&gt;
 					try &lt;/p&gt;
{
 						args[i] = ois.readObject();
 					}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
+						StringBuilder incompleteMethod = getIncompleteMethodString(length, i);
 						throw new IOException(&quot;Could not deserialize &quot; + i + &quot;th argument of method &quot; +
-							methodName + &apos;.&apos;, e);
+							incompleteMethod + &apos;.&apos;, e);
 					}
&lt;p&gt; catch (ClassNotFoundException e) &lt;/p&gt;
{
-						throw new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
-							&quot;argument of method &quot; + methodName + &quot;. This indicates that the argument &quot; +
-							&quot;type is not part of the system class loader.&quot;, e);
+						// note: wrapping this CNFE into another CNFE does not overwrite the Exception
+						//       stored in the ObjectInputStream (see ObjectInputStream#readSerialData)
+						// -&amp;gt; add a suppressed exception that adds a more specific message
+						StringBuilder incompleteMethod = getIncompleteMethodString(length, i);
+						e.addSuppressed(new ClassNotFoundException(&quot;Could not deserialize &quot; + i + &quot;th &quot; +
+							&quot;argument of method &quot; + incompleteMethod + &quot;. This indicates that the argument &quot; +
+							&quot;type is not part of the system class loader.&quot;));
+						throw e;
 					}
&lt;p&gt; 				}&lt;br/&gt;
 			} else &lt;/p&gt;
{
 				args = null;
 			}
&lt;p&gt; 		}&lt;br/&gt;
+&lt;br/&gt;
+		private StringBuilder getIncompleteMethodString(int lastMethodTypeIdx, int lastArgumentIdx) {&lt;br/&gt;
+			StringBuilder incompleteMethod = new StringBuilder();&lt;br/&gt;
+			incompleteMethod.append(methodName).append(&apos;(&apos;);&lt;br/&gt;
+			for (int i = 0; i &amp;lt; lastMethodTypeIdx; ++i) {&lt;br/&gt;
+				incompleteMethod.append(parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getCanonicalName());&lt;br/&gt;
+				if (i &amp;lt; lastArgumentIdx) &lt;/p&gt;
{
+					incompleteMethod.append(&quot;: &quot;).append(args[i]);
+				}
&lt;p&gt;+				incompleteMethod.append(&quot;, &quot;);&lt;br/&gt;
+			}&lt;br/&gt;
+			incompleteMethod.append(&quot;...)&quot;); // some parameters could not be deserialized&lt;br/&gt;
+			return incompleteMethod;&lt;br/&gt;
+		}&lt;br/&gt;
 	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java&lt;br/&gt;
index c02278c5088..7c664ce0b32 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/classloading/ClassLoaderTest.java&lt;br/&gt;
@@ -19,21 +19,78 @@&lt;br/&gt;
 package org.apache.flink.runtime.classloading;&lt;/p&gt;

&lt;p&gt; import org.apache.flink.runtime.execution.librarycache.FlinkUserCodeClassLoaders;&lt;br/&gt;
+import org.apache.flink.runtime.rpc.messages.RemoteRpcInvocation;&lt;br/&gt;
+import org.apache.flink.testutils.ClassLoaderUtils;&lt;br/&gt;
+import org.apache.flink.util.SerializedValue;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;/p&gt;

&lt;p&gt;+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Rule;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
+import org.junit.rules.ExpectedException;&lt;br/&gt;
+import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt; import java.net.URL;&lt;br/&gt;
 import java.net.URLClassLoader;&lt;/p&gt;

&lt;p&gt;+import static org.hamcrest.CoreMatchers.allOf;&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.containsString;&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.isA;&lt;br/&gt;
+import static org.hamcrest.Matchers.hasItemInArray;&lt;br/&gt;
+import static org.hamcrest.Matchers.hasProperty;&lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertNotEquals;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Tests for classloading and class loder utilities.&lt;br/&gt;
+ * Tests for classloading and class loader utilities.&lt;br/&gt;
  */&lt;br/&gt;
 public class ClassLoaderTest extends TestLogger {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+	@ClassRule&lt;br/&gt;
+	public static TemporaryFolder temporaryFolder = new TemporaryFolder();&lt;br/&gt;
+&lt;br/&gt;
+	@Rule&lt;br/&gt;
+	public ExpectedException expectedException = ExpectedException.none();&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testMessageDecodingWithUnavailableClass() throws Exception {&lt;br/&gt;
+		final ClassLoader systemClassLoader = getClass().getClassLoader();&lt;br/&gt;
+&lt;br/&gt;
+		final String className = &quot;UserClass&quot;;&lt;br/&gt;
+		final URLClassLoader userClassLoader = ClassLoaderUtils.compileAndLoadJava(&lt;br/&gt;
+			temporaryFolder.newFolder(),&lt;br/&gt;
+			className + &quot;.java&quot;,&lt;br/&gt;
+			&quot;import java.io.Serializable;\n&quot;&lt;br/&gt;
+				+ &quot;public class &quot; + className + &quot; implements Serializable {}&quot;);&lt;br/&gt;
+&lt;br/&gt;
+		RemoteRpcInvocation method = new RemoteRpcInvocation(&lt;br/&gt;
+			&quot;test&quot;,&lt;br/&gt;
+			new Class&amp;lt;?&amp;gt;[] &lt;/p&gt;
{
+				int.class,
+				Class.forName(className, false, userClassLoader)}
&lt;p&gt;,&lt;br/&gt;
+			new Object[] &lt;/p&gt;
{
+				1,
+				Class.forName(className, false, userClassLoader).newInstance()}
&lt;p&gt;);&lt;br/&gt;
+&lt;br/&gt;
+		SerializedValue&amp;lt;RemoteRpcInvocation&amp;gt; serializedMethod = new SerializedValue&amp;lt;&amp;gt;(method);&lt;br/&gt;
+&lt;br/&gt;
+		expectedException.expect(ClassNotFoundException.class);&lt;br/&gt;
+		expectedException.expect(&lt;br/&gt;
+			allOf(&lt;br/&gt;
+				isA(ClassNotFoundException.class),&lt;br/&gt;
+				hasProperty(&quot;suppressed&quot;,&lt;br/&gt;
+					hasItemInArray(&lt;br/&gt;
+						allOf(&lt;br/&gt;
+							isA(ClassNotFoundException.class),&lt;br/&gt;
+							hasProperty(&quot;message&quot;,&lt;br/&gt;
+								containsString(&quot;Could not deserialize 1th parameter type of method test(int, ...).&quot;)))))));&lt;br/&gt;
+&lt;br/&gt;
+		RemoteRpcInvocation deserializedMethod = serializedMethod.deserializeValue(systemClassLoader);&lt;br/&gt;
+		deserializedMethod.getMethodName();&lt;br/&gt;
+&lt;br/&gt;
+		userClassLoader.close();&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testParentFirstClassLoading() throws Exception {&lt;br/&gt;
 		final ClassLoader parentClassLoader = getClass().getClassLoader();&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675761" author="till.rohrmann" created="Mon, 5 Nov 2018 21:02:17 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master: &lt;a href=&quot;https://github.com/apache/flink/commit/d375c0a5824629c701c15ea228ac1ce22e46dc3b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/d375c0a5824629c701c15ea228ac1ce22e46dc3b&lt;/a&gt;&lt;br/&gt;
1.7.0: &lt;a href=&quot;https://github.com/apache/flink/commit/82c52670a9d13b629b6af387fe0a6ca9b7bd5966&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/82c52670a9d13b629b6af387fe0a6ca9b7bd5966&lt;/a&gt;&lt;br/&gt;
1.6.3: &lt;a href=&quot;https://github.com/apache/flink/commit/c0c9cf28740ae1cc7dcd231e014844b204a964ca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/c0c9cf28740ae1cc7dcd231e014844b204a964ca&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16687662" author="dawidwys" created="Thu, 15 Nov 2018 08:53:32 +0000"  >&lt;p&gt;Fixed in 1.5 via: ca78ae75a1b1434109b2d91452dbaad7c3e88186&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zjmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>