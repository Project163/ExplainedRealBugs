<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:19:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-33694] GCS filesystem does not respect gs.storage.root.url config option</title>
                <link>https://issues.apache.org/jira/browse/FLINK-33694</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The GCS FileSystem&apos;s RecoverableWriter implementation uses the GCS SDK directly rather than going through Hadoop. While support has been added to configure credentials correctly based on the standard Hadoop implementation configuration, no other options are passed through to the underlying client.&lt;/p&gt;

&lt;p&gt;Because this only affects the RecoverableWriter-related codepaths, it can result in very surprising differing behavior whether the FileSystem is being used as a source or a sink&#8212;while a &lt;tt&gt;gs://&lt;/tt&gt;-URI FileSource may work fine, a &lt;tt&gt;gs://&lt;/tt&gt;-URI FileSink may not work at all.&lt;/p&gt;

&lt;p&gt;We use &lt;a href=&quot;https://github.com/fsouza/fake-gcs-server&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fake-gcs-server&lt;/a&gt; in testing, and so we override the Hadoop GCS FileSystem config option &lt;tt&gt;gs.storage.root.url&lt;/tt&gt;. However, because this option is not considered when creating the GCS client for the RecoverableWriter codepath, in a FileSink the GCS FileSystem attempts to write to the real GCS service rather than fake-gcs-server. At the same time, a FileSource works as expected, reading from fake-gcs-server.&lt;/p&gt;

&lt;p&gt;The fix should be fairly straightforward, reading the &lt;tt&gt;gs.storage.root.url&lt;/tt&gt; config option from the Hadoop FileSystem config in &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.18.0/flink-filesystems/flink-gs-fs-hadoop/src/main/java/org/apache/flink/fs/gs/GSFileSystemOptions.java#L30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;GSFileSystemOptions&lt;/tt&gt;&lt;/a&gt; and, if set, passing it to &lt;tt&gt;storageOptionsBuilder&lt;/tt&gt; in &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.18.0/flink-filesystems/flink-gs-fs-hadoop/src/main/java/org/apache/flink/fs/gs/GSFileSystemFactory.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;GSFileSystemFactory&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The only workaround for this is to build a custom flink-gs-fs-hadoop JAR with a patch and use it as a plugin.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13559938">FLINK-33694</key>
            <summary>GCS filesystem does not respect gs.storage.root.url config option</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="plucas">Patrick Lucas</assignee>
                                    <reporter username="plucas">Patrick Lucas</reporter>
                        <labels>
                            <label>gcs</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 29 Nov 2023 16:07:55 +0000</created>
                <updated>Thu, 18 Jan 2024 19:31:42 +0000</updated>
                            <resolved>Thu, 18 Jan 2024 17:23:06 +0000</resolved>
                                    <version>1.18.0</version>
                    <version>1.17.2</version>
                                    <fixVersion>1.19.0</fixVersion>
                    <fixVersion>1.17.3</fixVersion>
                    <fixVersion>1.18.2</fixVersion>
                                    <component>FileSystems</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17791171" author="martijnvisser" created="Wed, 29 Nov 2023 16:25:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=plucas&quot; class=&quot;user-hover&quot; rel=&quot;plucas&quot;&gt;plucas&lt;/a&gt; Do you want to take a stab at fixing it?&lt;/p&gt;</comment>
                            <comment id="17791670" author="plucas" created="Thu, 30 Nov 2023 15:04:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; aye, have a PR open but Azure needs a re-run because I missed a license header. I&apos;m not sure if flinkbot listens to me for commands.&lt;/p&gt;</comment>
                            <comment id="17791695" author="martijnvisser" created="Thu, 30 Nov 2023 15:55:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=plucas&quot; class=&quot;user-hover&quot; rel=&quot;plucas&quot;&gt;plucas&lt;/a&gt; Just a question, you state that &quot;The GCS FileSystem&apos;s RecoverableWriter implementation uses the GCS SDK directly rather than going through Hadoop. While support has been added to configure credentials correctly based on the standard Hadoop implementation configuration, no other options are passed through to the underlying client.&quot;&lt;/p&gt;

&lt;p&gt;But is that actually true, given the statement &quot;However, if you use any of those other options, the provided credentials will not be used by the google-cloud-storage library, which provides RecoverableWriter support, so Flink recoverable-write operations would be expected to fail.&quot; that&apos;s at the bottom of &lt;a href=&quot;https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/filesystems/gcs/#authentication-to-access-gcs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/filesystems/gcs/#authentication-to-access-gcs&lt;/a&gt; ? &lt;/p&gt;</comment>
                            <comment id="17792050" author="plucas" created="Fri, 1 Dec 2023 13:13:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; my comment is perhaps not precise, in that &quot;support has been added to configure credentials correctly&quot; should be qualified with the comment from the docs about which credentials mechanisms are supported. But it is still true that other potentially-interesting options are not proxied through, such as setting the root URL.&lt;/p&gt;

&lt;p&gt;This change as written doesn&apos;t affect any credentials handling, only adding support for this one additional option. However, I could see an argument for implementing the behavior in &lt;tt&gt;org.apache.flink.fs.gs.utils.ConfigUtils&lt;/tt&gt; as the credentials behavior is rather than in &lt;tt&gt;GSFileSystemOptions&lt;/tt&gt; as I did to start with.&lt;/p&gt;</comment>
                            <comment id="17792901" author="plucas" created="Mon, 4 Dec 2023 15:07:34 +0000"  >&lt;p&gt;I&apos;ve updated the PR to more explicitly look for the specific Hadoop connector config for this option instead of defining it as a Flink &lt;tt&gt;ConfigOption&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17808318" author="mapohl" created="Thu, 18 Jan 2024 17:23:06 +0000"  >&lt;p&gt;master: &lt;a href=&quot;https://github.com/apache/flink/commit/a41229b24d82e8c561350c42d8a98dfb865c3f69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a41229b24d82e8c561350c42d8a98dfb865c3f69&lt;/a&gt;&lt;br/&gt;
1.18: &lt;a href=&quot;https://github.com/apache/flink/commit/846ab49afd20ecf49fe76e18dd3e9b41143bf207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;846ab49afd20ecf49fe76e18dd3e9b41143bf207&lt;/a&gt;&lt;br/&gt;
1.17: &lt;a href=&quot;https://github.com/apache/flink/commit/257c526d6ae404f4598aeb2b9efa85674df2e6cd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;257c526d6ae404f4598aeb2b9efa85674df2e6cd&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lxpc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This fix resolves the issue where the `gs.storage.root.url` setting in the Hadoop configuration was not being acknowledged by the Sink. Warning: If you have been using this property to configure the GCS Source, please ensure that your tests or pipelines are not adversely affected by the GCS Sink now also correctly adhering to this configuration.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>