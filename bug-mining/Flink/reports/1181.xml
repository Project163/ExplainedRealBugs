<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4257] Handle delegating algorithm change of class</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4257</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A class created by &lt;tt&gt;ProxyFactory&lt;/tt&gt; can intercept and reinterpret method calls using its &lt;tt&gt;MethodHandler&lt;/tt&gt;, but is restricted in that&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the type of the proxy class cannot be changed&lt;/li&gt;
	&lt;li&gt;method return types must be honored&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We have algorithms such as &lt;tt&gt;VertexDegree&lt;/tt&gt; and &lt;tt&gt;TriangleListing&lt;/tt&gt; that change return type depending on configuration, even between single and dual input functions. This can be problematic, e.g. in &lt;tt&gt;OperatorTranslation&lt;/tt&gt; where we test &lt;tt&gt;dataSet instanceof SingleInputOperator&lt;/tt&gt; or &lt;tt&gt;dataSet instanceof TwoInputOperator&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Even simply changing operator can be problematic, e.g. &lt;tt&gt;MapOperator.translateToDataFlow&lt;/tt&gt; returns &lt;tt&gt;MapOperatorBase&lt;/tt&gt; whereas &lt;tt&gt;ReduceOperator.translateToDataFlow&lt;/tt&gt; returns &lt;tt&gt;SingleInputOperator&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I see two ways to solve these issues. By adding a simple &lt;tt&gt;NoOpOperator&lt;/tt&gt; that is skipped over during &lt;tt&gt;OperatorTranslation&lt;/tt&gt; we could wrap all algorithm output and always be proxying the same class.&lt;/p&gt;

&lt;p&gt;Alternatively, making changes only within Gelly we can append a &quot;no-op&quot; pass-through &lt;tt&gt;MapFunction&lt;/tt&gt; to any algorithm output which is not a &lt;tt&gt;SingleInputOperator&lt;/tt&gt;. And &lt;tt&gt;Delegate&lt;/tt&gt; can also walk the superclass hierarchy such we are always proxying &lt;tt&gt;SingleInputOperator&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;There is one additional issue. When we call &lt;tt&gt;DataSet.output&lt;/tt&gt; the delegate&apos;s &lt;tt&gt;MethodHandler&lt;/tt&gt; must reinterpret this call to add itself to the list of sinks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12991900">FLINK-4257</key>
            <summary>Handle delegating algorithm change of class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="greghogan">Greg Hogan</assignee>
                                    <reporter username="greghogan">Greg Hogan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jul 2016 17:27:49 +0000</created>
                <updated>Thu, 8 Sep 2016 21:15:14 +0000</updated>
                            <resolved>Thu, 8 Sep 2016 21:15:12 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Library / Graph Processing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15468397" author="githubbot" created="Tue, 6 Sep 2016 20:01:58 +0000"  >&lt;p&gt;GitHub user greghogan opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2474&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4257&quot; title=&quot;Handle delegating algorithm change of class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4257&quot;&gt;&lt;del&gt;FLINK-4257&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;gelly&amp;#93;&lt;/span&gt; Handle delegating algorithm change of class&lt;/p&gt;

&lt;p&gt;    Replaces Delegate with NoOpOperator.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/greghogan/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/greghogan/flink&lt;/a&gt; 4257_handle_delegating_algorithm_change_of_class&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2474.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2474.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2474&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f8d1aa966ba907b2e3a306f5fe498ed8ac886656&lt;br/&gt;
Author: Greg Hogan &amp;lt;code@greghogan.com&amp;gt;&lt;br/&gt;
Date:   2016-07-25T13:09:27Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-4257 to be squashed&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;gelly&amp;#93;&lt;/span&gt; Handle delegating algorithm change of class&lt;/p&gt;

&lt;p&gt;    A class created by ProxyFactory can intercept and reinterpret method&lt;br/&gt;
    calls using its MethodHandler, but is restricted in that&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;the type of the proxy class cannot be changed&lt;/li&gt;
	&lt;li&gt;method return types must be honored&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We have algorithms such as VertexDegree and TriangleListing that change&lt;br/&gt;
    return type depending on configuration, even between single and dual&lt;br/&gt;
    input functions. This can be problematic, e.g. in OperatorTranslation&lt;br/&gt;
    where we test dataSet instanceof SingleInputOperator or dataSet&lt;br/&gt;
    instanceof TwoInputOperator.&lt;/p&gt;

&lt;p&gt;    Even simply changing operator can be problematic, e.g.&lt;br/&gt;
    MapOperator.translateToDataFlow returns MapOperatorBase whereas&lt;br/&gt;
    ReduceOperator.translateToDataFlow returns SingleInputOperator.&lt;/p&gt;

&lt;p&gt;    Making changes only within Gelly we can append a &quot;no-op&quot; pass-through&lt;br/&gt;
    MapFunction to any algorithm output which is not a SingleInputOperator.&lt;br/&gt;
    And Delegate can also walk the superclass hierarchy such we are always&lt;br/&gt;
    proxying SingleInputOperator.&lt;/p&gt;

&lt;p&gt;    There is one additional issue. When we call DataSet.output the&lt;br/&gt;
    delegate&apos;s MethodHandler must reinterpret this call to add itself to the&lt;br/&gt;
    list of sinks.&lt;/p&gt;

&lt;p&gt;commit 3209b05ab5575aba08f9cd6284b720ef9dfc5a02&lt;br/&gt;
Author: Greg Hogan &amp;lt;code@greghogan.com&amp;gt;&lt;br/&gt;
Date:   2016-07-25T13:41:31Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4257&quot; title=&quot;Handle delegating algorithm change of class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4257&quot;&gt;&lt;del&gt;FLINK-4257&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;gelly&amp;#93;&lt;/span&gt; Handle delegating algorithm change of class&lt;/p&gt;

&lt;p&gt;    Replaces Delegate with NoOpOperator.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15475031" author="githubbot" created="Thu, 8 Sep 2016 21:13:42 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2474&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15475037" author="greghogan" created="Thu, 8 Sep 2016 21:15:14 +0000"  >&lt;p&gt;Fixed in 8210ff468d64fc50520011fc6fed9909d2a6b89a&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12992356">FLINK-4265</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31e7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>