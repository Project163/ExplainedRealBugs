<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10141] Reduce lock contention introduced with 1.5</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10141</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;With the changes around introducing credit-based flow control as well as the low latency changes, unfortunately, we also introduced some lock contention on &lt;tt&gt;RemoteInputChannel#bufferQueue&lt;/tt&gt; and &lt;tt&gt;RemoteInputChannel#receivedBuffers&lt;/tt&gt; as well as asking for queue sizes when the only thing we need is whether it is empty or not.&lt;/p&gt;

&lt;p&gt;This was observed as a high idle CPU load with no events in the stream but only watermarks (every 500ms) and many slots on a single machine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13178811">FLINK-10141</key>
            <summary>Reduce lock contention introduced with 1.5</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 14 Aug 2018 09:50:31 +0000</created>
                <updated>Thu, 30 Aug 2018 21:07:59 +0000</updated>
                            <resolved>Thu, 30 Aug 2018 21:07:59 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.5.1</version>
                    <version>1.5.2</version>
                    <version>1.5.3</version>
                    <version>1.6.0</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16579739" author="githubbot" created="Tue, 14 Aug 2018 12:34:19 +0000"  >&lt;p&gt;NicoK opened a new pull request #6553: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10141&quot; title=&quot;Reduce lock contention introduced with 1.5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10141&quot;&gt;&lt;del&gt;FLINK-10141&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; optimisations reducing lock contention&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6553&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   With the changes around introducing credit-based flow control as well as the low latency changes, unfortunately, we also introduced some lock contention on `RemoteInputChannel#bufferQueue` and `RemoteInputChannel#receivedBuffers`. Additionally, we were asking for queue sizes when the only thing we need is whether it is empty or not.&lt;/p&gt;

&lt;p&gt;   As a result, we saw high CPU load during &quot;idle&quot; stream processing jobs with no events in the stream but only watermarks (every 500ms) and many slots on a single machine.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;move `notifyCreditAvailable()` out of the lock around `RemoteInputChannel#bufferQueue`&lt;/li&gt;
	&lt;li&gt;move `notifyChannelNonEmpty()` out of the lock around `RemoteInputChannel#receivedBuffers`&lt;/li&gt;
	&lt;li&gt;replace `RemoteInputChannel#receivedBuffers.size()` with `receivedBuffers.isEmpty()` when this is the only thing needed&lt;/li&gt;
	&lt;li&gt;replace `SingleInputGate#inputChannelsWithData.size()` with `inputChannelsWithData.isEmpty()` when this is the only thing needed&lt;/li&gt;
	&lt;li&gt;minor code style improvement in `CreditBasedPartitionRequestClientHandler` to improve readability&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;This change is already covered by existing tests, such as `RemoteInputChannelTest`, `SingleInputGateTest`,..., and everything using the network stack.&lt;/li&gt;
	&lt;li&gt;Manually verified that less CPU is used with a `SocketWindowWordCount` with some added shuffles, no input elements, only watermarks every 500ms with 4 TMs, 10 slots each on a single (laptop) machine.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;* (per buffer)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;JavaDocs&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16587619" author="githubbot" created="Tue, 21 Aug 2018 15:48:22 +0000"  >&lt;p&gt;NicoK commented on issue #6553: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10141&quot; title=&quot;Reduce lock contention introduced with 1.5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10141&quot;&gt;&lt;del&gt;FLINK-10141&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; optimisations reducing lock contention&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6553#issuecomment-414723164&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6553#issuecomment-414723164&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @pnowojski I just pushed changes based on your review of #6555 which should be covered now&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16597170" author="githubbot" created="Thu, 30 Aug 2018 08:11:15 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6553: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10141&quot; title=&quot;Reduce lock contention introduced with 1.5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10141&quot;&gt;&lt;del&gt;FLINK-10141&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; optimisations reducing lock contention&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6553#discussion_r213938098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6553#discussion_r213938098&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/RemoteInputChannel.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -191,16 +191,16 @@ void retriggerSubpartitionRequest(int subpartitionIndex) throws IOException, Int&lt;br/&gt;
 		checkError();&lt;/p&gt;

&lt;p&gt; 		final Buffer next;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int remaining;&lt;br/&gt;
+		final boolean moreAvailable;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   nitty nit: replace in commit message &lt;/p&gt;

&lt;p&gt;   &amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; minor optimisations&lt;/p&gt;

&lt;p&gt;   with:&lt;/p&gt;

&lt;p&gt;   &amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; Simplify moreAvailable/wasEmpty logic &lt;/p&gt;

&lt;p&gt;   ?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16597923" author="githubbot" created="Thu, 30 Aug 2018 21:03:42 +0000"  >&lt;p&gt;NicoK closed pull request #6553: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10141&quot; title=&quot;Reduce lock contention introduced with 1.5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10141&quot;&gt;&lt;del&gt;FLINK-10141&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; optimisations reducing lock contention&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6553&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/RemoteInputChannel.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/RemoteInputChannel.java&lt;br/&gt;
index 28f30209892..c4954c0fb6d 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/RemoteInputChannel.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/RemoteInputChannel.java&lt;br/&gt;
@@ -191,16 +191,16 @@ void retriggerSubpartitionRequest(int subpartitionIndex) throws IOException, Int&lt;br/&gt;
 		checkError();&lt;/p&gt;

&lt;p&gt; 		final Buffer next;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int remaining;&lt;br/&gt;
+		final boolean moreAvailable;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		synchronized (receivedBuffers) &lt;/p&gt;
{
 			next = receivedBuffers.poll();
-			remaining = receivedBuffers.size();
+			moreAvailable = !receivedBuffers.isEmpty();
 		}

&lt;p&gt; 		numBytesIn.inc(next.getSizeUnsafe());&lt;br/&gt;
 		numBuffersIn.inc();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return Optional.of(new BufferAndAvailability(next, remaining &amp;gt; 0, getSenderBacklog()));&lt;br/&gt;
+		return Optional.of(new BufferAndAvailability(next, moreAvailable, getSenderBacklog()));&lt;br/&gt;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	// ------------------------------------------------------------------------&lt;br/&gt;
@@ -306,8 +306,8 @@ public void recycle(MemorySegment segment) {&lt;br/&gt;
 		int numAddedBuffers;&lt;/p&gt;

&lt;p&gt; 		synchronized (bufferQueue) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Important: check the isReleased state inside synchronized block, so there is no&lt;/li&gt;
	&lt;li&gt;// race condition when recycle and releaseAllResources running in parallel.&lt;br/&gt;
+			// Similar to notifyBufferAvailable(), make sure that we never add a buffer&lt;br/&gt;
+			// after releaseAllResources() released all buffers (see below for details).&lt;br/&gt;
 			if (isReleased.get()) {&lt;br/&gt;
 				try {&lt;br/&gt;
 					inputGate.returnExclusiveSegments(Collections.singletonList(segment));&lt;br/&gt;
@@ -368,8 +368,13 @@ public boolean notifyBufferAvailable(Buffer buffer) {&lt;br/&gt;
 				checkState(isWaitingForFloatingBuffers,&lt;br/&gt;
 					&quot;This channel should be waiting for floating buffers.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Important: double check the isReleased state inside synchronized block, so there is no&lt;/li&gt;
	&lt;li&gt;// race condition when notifyBufferAvailable and releaseAllResources running in parallel.&lt;br/&gt;
+				// Important: make sure that we never add a buffer after releaseAllResources()&lt;br/&gt;
+				// released all buffers. Following scenarios exist:&lt;br/&gt;
+				// 1) releaseAllResources() already released buffers inside bufferQueue&lt;br/&gt;
+				// -&amp;gt; then isReleased is set correctly&lt;br/&gt;
+				// 2) releaseAllResources() did not yet release buffers from bufferQueue&lt;br/&gt;
+				// -&amp;gt; we may or may not have set isReleased yet but will always wait for the&lt;br/&gt;
+				//    lock on bufferQueue to release buffers&lt;br/&gt;
 				if (isReleased.get() || bufferQueue.getAvailableBufferSize() &amp;gt;= numRequiredBuffers) {&lt;br/&gt;
 					isWaitingForFloatingBuffers = false;&lt;br/&gt;
 					recycleBuffer = false; // just in case&lt;br/&gt;
@@ -385,10 +390,10 @@ public boolean notifyBufferAvailable(Buffer buffer) {&lt;br/&gt;
 				} else 
{
 					needMoreBuffers = true;
 				}
&lt;p&gt;+			}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (unannouncedCredit.getAndAdd(1) == 0) 
{
-					notifyCreditAvailable();
-				}
&lt;p&gt;+			if (unannouncedCredit.getAndAdd(1) == 0) &lt;/p&gt;
{
+				notifyCreditAvailable();
 			}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			return needMoreBuffers;&lt;br/&gt;
@@ -484,8 +489,8 @@ void onSenderBacklog(int backlog) throws IOException {&lt;br/&gt;
 		int numRequestedBuffers = 0;&lt;/p&gt;

&lt;p&gt; 		synchronized (bufferQueue) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Important: check the isReleased state inside synchronized block, so there is no&lt;/li&gt;
	&lt;li&gt;// race condition when onSenderBacklog and releaseAllResources running in parallel.&lt;br/&gt;
+			// Similar to notifyBufferAvailable(), make sure that we never add a buffer&lt;br/&gt;
+			// after releaseAllResources() released all buffers (see above for details).&lt;br/&gt;
 			if (isReleased.get()) 
{
 				return;
 			}
&lt;p&gt;@@ -510,33 +515,40 @@ void onSenderBacklog(int backlog) throws IOException {&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	public void onBuffer(Buffer buffer, int sequenceNumber, int backlog) throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;boolean success = false;&lt;br/&gt;
+		boolean recycleBuffer = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		try {&lt;br/&gt;
+&lt;br/&gt;
+			final boolean wasEmpty;&lt;br/&gt;
 			synchronized (receivedBuffers) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!isReleased.get()) {&lt;/li&gt;
	&lt;li&gt;if (expectedSequenceNumber == sequenceNumber) {&lt;/li&gt;
	&lt;li&gt;int available = receivedBuffers.size();&lt;br/&gt;
+				// Similar to notifyBufferAvailable(), make sure that we never add a buffer&lt;br/&gt;
+				// after releaseAllResources() released all buffers from receivedBuffers&lt;br/&gt;
+				// (see above for details).&lt;br/&gt;
+				if (isReleased.get()) 
{
+					return;
+				}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;receivedBuffers.add(buffer);&lt;/li&gt;
	&lt;li&gt;expectedSequenceNumber++;&lt;br/&gt;
+				if (expectedSequenceNumber != sequenceNumber) 
{
+					onError(new BufferReorderingException(expectedSequenceNumber, sequenceNumber));
+					return;
+				}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (available == 0) 
{
-							notifyChannelNonEmpty();
-						}
&lt;p&gt;+				wasEmpty = receivedBuffers.isEmpty();&lt;br/&gt;
+				receivedBuffers.add(buffer);&lt;br/&gt;
+				recycleBuffer = false;&lt;br/&gt;
+			}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;success = true;&lt;/li&gt;
	&lt;li&gt;} else 
{
-						onError(new BufferReorderingException(expectedSequenceNumber, sequenceNumber));
-					}&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
+			++expectedSequenceNumber;&lt;br/&gt;
+&lt;br/&gt;
+			if (wasEmpty) 
{
+				notifyChannelNonEmpty();
 			}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (success &amp;amp;&amp;amp; backlog &amp;gt;= 0) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (backlog &amp;gt;= 0) {
 				onSenderBacklog(backlog);
 			} 		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; finally {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (!success) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (recycleBuffer) {
 				buffer.recycleBuffer();
 			} 		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/SingleInputGate.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/SingleInputGate.java&lt;br/&gt;
index 2e7d076f3f8..f51dc7417ab 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/SingleInputGate.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/consumer/SingleInputGate.java&lt;br/&gt;
@@ -545,7 +545,7 @@ public void requestPartitions() throws IOException, InterruptedException 
{
 
 				currentChannel = inputChannelsWithData.remove();
 				enqueuedInputChannelsWithData.clear(currentChannel.getChannelIndex());
-				moreAvailable = inputChannelsWithData.size() &amp;gt; 0;
+				moreAvailable = !inputChannelsWithData.isEmpty();
 			}&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			result = currentChannel.getNextBuffer();&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16597927" author="nicok" created="Thu, 30 Aug 2018 21:07:59 +0000"  >&lt;p&gt;Fixed via:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 6c7603724be6c146cfc8019b77b60236d1d3d582&lt;/li&gt;
	&lt;li&gt;release-1.6: b3dadd6fe3fa3e163ec9e25bff52c642e91f683f&lt;/li&gt;
	&lt;li&gt;release-1.5: 0d5f75e9a005a32dcff1b545f146064bd6ce66e9&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13178817">FLINK-10142</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x0uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>