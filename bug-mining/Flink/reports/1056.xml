<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3964] Job submission times out with recursive.file.enumeration</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3964</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When using &quot;recursive.file.enumeration&quot; with a big enough folder structure to list, flink batch job fails right at the beginning because of a timeout.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;Problemdetails&quot;&gt;&lt;/a&gt;Problem details&lt;/h2&gt;

&lt;p&gt;We get this error: &lt;tt&gt;Communication with JobManager failed: Job submission to the JobManager timed out&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The code we have is basically this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val env = ExecutionEnvironment.getExecutionEnvironment

val parameters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration

&lt;span class=&quot;code-comment&quot;&gt;// set the recursive enumeration parameter
&lt;/span&gt;parameters.setBoolean(&lt;span class=&quot;code-quote&quot;&gt;&quot;recursive.file.enumeration&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)

val parameter = ParameterTool.fromArgs(args)

val input_data_path : &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = parameter.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;input_data_path&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; )

val data : DataSet[(Text,Text)] = env.readSequenceFile(classOf[Text], classOf[Text], input_data_path)
.withParameters(parameters)

data.first(10).print
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we set &lt;tt&gt;input_data_path&lt;/tt&gt; parameter to &lt;tt&gt;s3n://bucket/path/date=*/&lt;/tt&gt; it times out. If we use a more restrictive pattern like &lt;tt&gt;s3n://bucket/path/date=20160523/&lt;/tt&gt;, it doesn&apos;t time out.&lt;/p&gt;

&lt;p&gt;To me it seems that time taken to list files shouldn&apos;t cause any timeouts on job submission level.&lt;/p&gt;

&lt;p&gt;For us this was &quot;fixed&quot; by adding &lt;tt&gt;akka.client.timeout: 600 s&lt;/tt&gt; in &lt;tt&gt;flink-conf.yaml&lt;/tt&gt;, but I wonder if the timeout would still occur if we have even more files to list?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;P.S. Is there any way to set &lt;tt&gt;akka.client.timeout&lt;/tt&gt; when calling &lt;tt&gt;bin/flink run&lt;/tt&gt; instead of editing &lt;tt&gt;flink-conf.yaml&lt;/tt&gt;. I tried to add it as a &lt;tt&gt;-yD&lt;/tt&gt; flag but couldn&apos;t get it working.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12972362">FLINK-3964</key>
            <summary>Job submission times out with recursive.file.enumeration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="juho.autio.r">Juho Autio</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 May 2016 11:04:03 +0000</created>
                <updated>Thu, 28 Feb 2019 13:46:10 +0000</updated>
                            <resolved>Wed, 27 Feb 2019 19:28:45 +0000</resolved>
                                    <version>1.0.0</version>
                                                    <component>API / DataSet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15339541" author="mxm" created="Mon, 20 Jun 2016 14:11:39 +0000"  >&lt;p&gt;Thanks for reporting! Have you tried &lt;tt&gt;bin/flink run -yDakka.ask.timeout=600s ...&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15341594" author="juho.autio.r" created="Tue, 21 Jun 2016 11:24:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, I&apos;m pretty sure I tried &lt;tt&gt;bin/flink run -yDakka.client.timeout=600s&lt;/tt&gt; and it didn&apos;t seem to have any effect. Did you intentionally suggest &lt;em&gt;ask&lt;/em&gt; timeout instead of &lt;em&gt;client&lt;/em&gt; timeout? Do those have different scopes somehow?&lt;/p&gt;

&lt;p&gt;And just in general, should there be any difference between providing a parameter with &lt;tt&gt;-yD&lt;/tt&gt; vs. setting it in &lt;tt&gt;flink-conf.yaml&lt;/tt&gt;? Does it make sense that a parameter would not be applied if given with &lt;tt&gt;-yD&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15341654" author="mxm" created="Tue, 21 Jun 2016 12:10:26 +0000"  >&lt;p&gt;You&apos;re right, Flink uses &lt;tt&gt;akka.client.timeout&lt;/tt&gt; as timeout for job submissions. The Yarn properties can only be used with the Yarn mode. Just checked that &lt;tt&gt;bin/flink run -m yarn-cluster -yn 1 -yDakka.ask.timeout=1ms&lt;/tt&gt; does set the client timeout to 1 millisecond (it times out).&lt;/p&gt;

&lt;p&gt;The actual cause of the issue is that the JobManager calls the &lt;tt&gt;configure()&lt;/tt&gt; on all Input/Output vertices of the job. That is where the files of the input format are loaded, causing a delay in the job submission which can lead to a timeout. IMHO the only fix is to increase the timeout.&lt;/p&gt;

&lt;p&gt;If you want, we can file an issue for changing config parameters via the CLI.&lt;/p&gt;</comment>
                            <comment id="15346263" author="juho.autio.r" created="Thu, 23 Jun 2016 10:55:01 +0000"  >&lt;p&gt;Sorry I didn&apos;t realize that &lt;tt&gt;-m yarn-cluster&lt;/tt&gt; was significant here &#8211; I also had that flag.&lt;/p&gt;

&lt;p&gt;I&apos;m a bit concerned that there won&apos;t be an easy way to find a good minimum value for the timeout. I would rather set a timeout for configuring a single vertice during submission, if that makes sense. This would mean that if configuring a single vertice takes too long, we get a timeout, but on the other hand if we have a job that spawns many vertices, it will be able to configure all of them without timing out (as long as configuring each vertice doesn&apos;t time out). What do you think about that?&lt;/p&gt;

&lt;p&gt;Also if this happens, the error message could give a hint to increase akka.client.timeout (or should it just suggest Dakka.ask.timeout?) and print the current value. It would make this much easier to fix if it happens.&lt;/p&gt;</comment>
                            <comment id="15350759" author="mxm" created="Mon, 27 Jun 2016 10:23:39 +0000"  >&lt;p&gt;I see where you&apos;re going. That&apos;s currently not possible and wouldn&apos;t help in your case. First, the client would still have to wait until all vertices have been configured. Second, it is actually a single vertex (we&apos;re at a &lt;tt&gt;JobGraph&lt;/tt&gt; level at submission time). Your Hadoop input format corresponds to one JobGraph vertex. Only later, the &lt;tt&gt;ExecutionGraph&lt;/tt&gt; is created where the single vertex will be split up in the number of parallelism vertices.&lt;/p&gt;

&lt;p&gt;+1 to add a notice in the timeout exception for increasing &lt;tt&gt;akka.client.timeout&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15350768" author="githubbot" created="Mon, 27 Jun 2016 10:30:38 +0000"  >&lt;p&gt;GitHub user mxm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3964&quot; title=&quot;Job submission times out with recursive.file.enumeration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3964&quot;&gt;&lt;del&gt;FLINK-3964&lt;/del&gt;&lt;/a&gt; add hint to job submission timeout exception message&lt;/p&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mxm/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3964&quot; title=&quot;Job submission times out with recursive.file.enumeration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3964&quot;&gt;&lt;del&gt;FLINK-3964&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2168.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2168.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2168&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5964b821f3ecb3a8a4f038a995850a2c3f646552&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-06-27T10:30:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3964&quot; title=&quot;Job submission times out with recursive.file.enumeration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3964&quot;&gt;&lt;del&gt;FLINK-3964&lt;/del&gt;&lt;/a&gt; add hint to job submission timeout exception message&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15350969" author="githubbot" created="Mon, 27 Jun 2016 13:15:06 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think it is often the case that the timeout is caused by some failure. For instance the savepoint restore failes due to something, then you get this timeout in the command line.&lt;/p&gt;

&lt;p&gt;    Maybe it&apos;s also good to add a note to check the JM log for any failures because increasing the timeout wont help.&lt;/p&gt;

&lt;p&gt;    Just a thought &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15352735" author="githubbot" created="Tue, 28 Jun 2016 10:12:29 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the feedback. Savepoint related errors should be forwarded to the client independently of timeouts (except maybe when the savepoint takes too long). So that should be fixed in a follow-up.&lt;/p&gt;</comment>
                            <comment id="15358953" author="githubbot" created="Fri, 1 Jul 2016 13:22:53 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2168&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16779682" author="rmetzger" created="Wed, 27 Feb 2019 19:28:46 +0000"  >&lt;p&gt;Closing as it seems to be merged&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yf4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>