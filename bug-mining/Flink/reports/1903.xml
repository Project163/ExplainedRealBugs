<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:29:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7309] NullPointerException in CodeGenUtils.timePointToInternalCode() generated code</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7309</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The code generated by CodeGenUtils.timePointToInternalCode() will cause a NullPointerException when SQL table field type is `TIMESTAMP` and the field value is `null`.&lt;/p&gt;

&lt;p&gt;Example for reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;object StreamSQLExample {
  def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]): Unit = {
    val env = StreamExecutionEnvironment.getExecutionEnvironment
    val tEnv = TableEnvironment.getTableEnvironment(env)

    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; field value
&lt;/span&gt;    val orderA: DataStream[Order] = env.fromCollection(Seq(
      Order(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;beer&quot;&lt;/span&gt;, 3)))
      
    tEnv.registerDataStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;OrderA&quot;&lt;/span&gt;, orderA, &lt;span class=&quot;code-quote&quot;&gt;&apos;ts, &apos;&lt;/span&gt;product, &apos;amount)
    val result = tEnv.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM OrderA&quot;&lt;/span&gt;)
    result.toAppendStream[Order].print()
    
    env.execute()
  }

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Order(ts: Timestamp, product: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, amount: Int)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the above example, timePointToInternalCode() will generated some statements like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
          &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; result$1 = org.apache.calcite.runtime.SqlFunctions.toLong((java.sql.Timestamp) in1.ts());
          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNull$2 = (java.sql.Timestamp) in1.ts() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so, the NPE will happen when in1.ts() is null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13091184">FLINK-7309</key>
            <summary>NullPointerException in CodeGenUtils.timePointToInternalCode() generated code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="llchen">Liangliang Chen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Jul 2017 13:16:58 +0000</created>
                <updated>Mon, 12 Mar 2018 15:29:26 +0000</updated>
                            <resolved>Mon, 12 Mar 2018 15:29:26 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Runtime / Task</component>
                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16112474" author="llchen" created="Thu, 3 Aug 2017 09:22:31 +0000"  >&lt;p&gt;hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;, Can you help to review this?&lt;/p&gt;

&lt;p&gt;I think we can fix it by added null check if confirm that it is a bug.&lt;/p&gt;</comment>
                            <comment id="16112480" author="fhueske" created="Thu, 3 Aug 2017 09:28:44 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=llchen&quot; class=&quot;user-hover&quot; rel=&quot;llchen&quot;&gt;llchen&lt;/a&gt;, thanks for reporting this issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; is more familiar with the type system and code generation of the Table API. Maybe he can have a look. &lt;br/&gt;
Otherwise, I&apos;ll be happy to help as well.&lt;/p&gt;

&lt;p&gt;It would be great if you could open a pull request with a fix.&lt;/p&gt;

&lt;p&gt;Best, Fabian&lt;/p&gt;</comment>
                            <comment id="16112499" author="twalthr" created="Thu, 3 Aug 2017 09:40:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=llchen&quot; class=&quot;user-hover&quot; rel=&quot;llchen&quot;&gt;llchen&lt;/a&gt; you are right, this is definitely a bug. &lt;tt&gt;timePointToInternalCode()&lt;/tt&gt; should check for null first.&lt;/p&gt;</comment>
                            <comment id="16112527" author="llchen" created="Thu, 3 Aug 2017 10:02:39 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;, thank you for the quick reply, and thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; to confirm it. I&apos;m glad to fix it and I will open a pull request later!&lt;/p&gt;</comment>
                            <comment id="16112544" author="twalthr" created="Thu, 3 Aug 2017 10:17:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=llchen&quot; class=&quot;user-hover&quot; rel=&quot;llchen&quot;&gt;llchen&lt;/a&gt; I thought about it again. Maybe it is not a bug. Would this exception also happen if you use a class instead of a case class? Case classes in Flink do not support null values. I think the case class serializer does not support it. Maybe this is why it is not checked here.&lt;/p&gt;</comment>
                            <comment id="16112834" author="llchen" created="Thu, 3 Aug 2017 14:35:42 +0000"  >&lt;p&gt;hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, I&apos;m not very familiar with Scala-Lang, so I write a test program in Java as below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestNullSQL {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

    &lt;span class=&quot;code-comment&quot;&gt;// set up execution environment
&lt;/span&gt;    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
    StreamTableEnvironment tEnv = StreamTableEnvironment.getTableEnvironment(env);

    TypeInformation&amp;lt;?&amp;gt;[] types = {BasicTypeInfo.INT_TYPE_INFO, SqlTimeTypeInfo.TIMESTAMP};
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; names[] = {&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ts&quot;&lt;/span&gt;};
    RowTypeInfo typeInfo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RowTypeInfo(types, names);

    &lt;span class=&quot;code-comment&quot;&gt;// we assign a &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value here!!
&lt;/span&gt;    DataStream&amp;lt;Row&amp;gt; input = env.fromElements(Row.of(1001, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)).returns(typeInfo);

    tEnv.registerDataStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;test_table&quot;&lt;/span&gt;, input);
    Table table = tEnv.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT id, ts FROM test_table&quot;&lt;/span&gt;);
    DataStream&amp;lt;Row&amp;gt; result = tEnv.toAppendStream(table, Row.class);
    result.print();

    env.execute();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I use a &lt;tt&gt;Row&lt;/tt&gt; type in this example and the exception occurs again.&lt;/p&gt;</comment>
                            <comment id="16114166" author="githubbot" created="Fri, 4 Aug 2017 09:34:04 +0000"  >&lt;p&gt;GitHub user yestinchen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7309&quot; title=&quot;NullPointerException in CodeGenUtils.timePointToInternalCode() generated code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7309&quot;&gt;&lt;del&gt;FLINK-7309&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; fix NullPointerException when selecting null fields&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This pull request addresses &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7309&quot; title=&quot;NullPointerException in CodeGenUtils.timePointToInternalCode() generated code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7309&quot;&gt;&lt;del&gt;FLINK-7309&lt;/del&gt;&lt;/a&gt;, adds null check before applying unboxing on input fields.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add null check before applying unboxing on input fields.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added test case: select null field from a Timestamp type field.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/yestinchen/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yestinchen/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7309&quot; title=&quot;NullPointerException in CodeGenUtils.timePointToInternalCode() generated code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7309&quot;&gt;&lt;del&gt;FLINK-7309&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4479&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7cbbd13b723df11e72ccb115b5266104b0b01183&lt;br/&gt;
Author: Yestin &amp;lt;873915231@qq.com&amp;gt;&lt;br/&gt;
Date:   2017-08-04T09:21:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7309&quot; title=&quot;NullPointerException in CodeGenUtils.timePointToInternalCode() generated code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7309&quot;&gt;&lt;del&gt;FLINK-7309&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; fix NullPointerException when selecting null fields.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16114191" author="llchen" created="Fri, 4 Aug 2017 09:55:52 +0000"  >&lt;p&gt;@yestinchen ???&lt;/p&gt;</comment>
                            <comment id="16114463" author="ychen" created="Fri, 4 Aug 2017 14:52:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=llchen&quot; class=&quot;user-hover&quot; rel=&quot;llchen&quot;&gt;llchen&lt;/a&gt;, I saw this JIRA today and I think you&apos;re right. So I opened a pull request to fix this issue. Feel free to review it!&lt;/p&gt;</comment>
                            <comment id="16123446" author="githubbot" created="Fri, 11 Aug 2017 14:50:38 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479#discussion_r132689501&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479#discussion_r132689501&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -1193,12 +1204,18 @@ abstract class CodeGenerator(&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&quot;&quot;&quot;.stripMargin&lt;br/&gt;
         } else if (nullCheck) {&lt;br/&gt;
           s&quot;&quot;&quot;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$resultTypeTerm $resultTerm = $unboxedFieldCode;&lt;br/&gt;
    +        &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$resultTypeTerm $resultTerm = $initValue;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;boolean $nullTerm = $fieldTerm == null;&lt;br/&gt;
    +        &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;if (!$nullTerm)
{
    +        |  $resultTerm = $unboxedFieldCode;
    +        |}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&quot;&quot;&quot;.stripMargin&lt;br/&gt;
         } else {&lt;br/&gt;
           s&quot;&quot;&quot;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$resultTypeTerm $resultTerm = $unboxedFieldCode;&lt;br/&gt;
    +        &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$resultTypeTerm $resultTerm = $initValue;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;    We should not need a null check in this branch. This code is only generated if `nullCheck == false`.&lt;/p&gt;</comment>
                            <comment id="16123447" author="githubbot" created="Fri, 11 Aug 2017 14:50:38 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479#discussion_r132691900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479#discussion_r132691900&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/sql/SqlITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -314,5 +314,34 @@ class SqlITCase extends StreamingWithStateTestBase &lt;/p&gt;
{
         assertEquals(expected.sorted, StreamITCase.testResults.sorted)
       }

&lt;p&gt;    +  @Test&lt;br/&gt;
    +  def testSelectWithNullTimestamp(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This bug should not be tested with an expensive ITCase. Please add one (or more) tests to `TemporalTypesTest` which is a unit test.&lt;/p&gt;</comment>
                            <comment id="16123448" author="githubbot" created="Fri, 11 Aug 2017 14:50:38 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479#discussion_r132703597&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479#discussion_r132703597&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -1181,8 +1188,12 @@ abstract class CodeGenerator(&lt;/p&gt;

&lt;p&gt;         val wrappedCode = if (nullCheck &amp;amp;&amp;amp; !isReference(fieldType)) {&lt;br/&gt;
           s&quot;&quot;&quot;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$tmpTypeTerm $tmpTerm = $unboxedFieldCode;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;boolean $nullTerm = $tmpTerm == null;&lt;br/&gt;
    +        &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$tmpTypeTerm $tmpTerm = $initValue;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Please fix this without `initValue`.&lt;/p&gt;</comment>
                            <comment id="16123449" author="githubbot" created="Fri, 11 Aug 2017 14:50:38 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479#discussion_r132703400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479#discussion_r132703400&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -1193,12 +1204,18 @@ abstract class CodeGenerator(&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&quot;&quot;&quot;.stripMargin&lt;br/&gt;
         } else if (nullCheck) {&lt;br/&gt;
           s&quot;&quot;&quot;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;$resultTypeTerm $resultTerm = $unboxedFieldCode;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;    I fixed this case in PR #4488 as well which will be merged soon.&lt;/p&gt;</comment>
                            <comment id="16123450" author="githubbot" created="Fri, 11 Aug 2017 14:50:38 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479#discussion_r132690201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479#discussion_r132690201&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -1172,6 +1172,13 @@ abstract class CodeGenerator(&lt;br/&gt;
         val resultTypeTerm = primitiveTypeTermForTypeInfo(fieldType)&lt;br/&gt;
         val defaultValue = primitiveDefaultValue(fieldType)&lt;/p&gt;

&lt;p&gt;    +    // the initial value for result.&lt;br/&gt;
    +    val initValue = fieldType match {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I had to fix the same issue for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7337&quot; title=&quot;Refactor handling of time indicator attributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7337&quot;&gt;&lt;del&gt;FLINK-7337&lt;/del&gt;&lt;/a&gt; in PR #4488: &lt;a href=&quot;https://github.com/apache/flink/pull/4488/files#diff-e05ff53adcc1407715fe09572ee092e0L1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4488/files#diff-e05ff53adcc1407715fe09572ee092e0L1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t think we need this `initValue`. Especially, we should not introduce a special case for `String`. The problem with `String` was a buggy implementation of `concat` that did not respect the `isNull` field but relied on `resultTerm == null`. I fix this issue in my PR so, we can avoid the special case for `String` here.&lt;/p&gt;
</comment>
                            <comment id="16145394" author="githubbot" created="Tue, 29 Aug 2017 14:39:47 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the PR @yestinchen.&lt;/p&gt;

&lt;p&gt;    Will merge this.&lt;/p&gt;</comment>
                            <comment id="16146025" author="githubbot" created="Tue, 29 Aug 2017 20:12:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4479&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16146042" author="fhueske" created="Tue, 29 Aug 2017 20:18:58 +0000"  >&lt;p&gt;Fixed for 1.3.3 with eec261e9287b7272f21106df931686a9b4ca828a&lt;br/&gt;
Fixed for 1.4.0 with 29e849b1bf9180a5aa5f2d500efb283a39839caa&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i7bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>