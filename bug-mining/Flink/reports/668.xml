<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:21:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2964] MutableHashTable fails when spilling partitions without overflow segments</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2964</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When one performs a join operation with many and large records then the join operation fails with the following exception when it tries to spill a &lt;tt&gt;HashPartition&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: Bug in Hybrid Hash Join: Request to spill a partition with less than two buffers.
	at org.apache.flink.runtime.operators.hash.HashPartition.spillPartition(HashPartition.java:302)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.spillPartition(MutableHashTable.java:1108)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.nextSegment(MutableHashTable.java:1277)
	at org.apache.flink.runtime.operators.hash.HashPartition$BuildSideBuffer.nextSegment(HashPartition.java:524)
	at org.apache.flink.runtime.memory.AbstractPagedOutputView.advance(AbstractPagedOutputView.java:140)
	at org.apache.flink.runtime.memory.AbstractPagedOutputView.write(AbstractPagedOutputView.java:201)
	at org.apache.flink.runtime.memory.AbstractPagedOutputView.write(AbstractPagedOutputView.java:178)
	at org.apache.flink.api.common.typeutils.base.array.BytePrimitiveArraySerializer.serialize(BytePrimitiveArraySerializer.java:74)
	at org.apache.flink.api.common.typeutils.base.array.BytePrimitiveArraySerializer.serialize(BytePrimitiveArraySerializer.java:30)
	at org.apache.flink.runtime.operators.hash.HashPartition.insertIntoBuildBuffer(HashPartition.java:257)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.insertIntoTable(MutableHashTable.java:856)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.buildInitialTable(MutableHashTable.java:685)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.open(MutableHashTable.java:443)
	at org.apache.flink.runtime.operators.hash.HashTableTest.testSpillingWhenBuildingTableWithoutOverflow(HashTableTest.java:234)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:160)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:78)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:212)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:68)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:140)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason is that the &lt;tt&gt;HashPartition&lt;/tt&gt; does not include the number of used memory segments by the &lt;tt&gt;BuildSideBuffer&lt;/tt&gt; when it counts the currently occupied memory segments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12910212">FLINK-2964</key>
            <summary>MutableHashTable fails when spilling partitions without overflow segments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Nov 2015 01:12:15 +0000</created>
                <updated>Wed, 4 Nov 2015 10:43:29 +0000</updated>
                            <resolved>Wed, 4 Nov 2015 10:34:09 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14988661" author="githubbot" created="Wed, 4 Nov 2015 01:20:27 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2964&quot; title=&quot;MutableHashTable fails when spilling partitions without overflow segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2964&quot;&gt;&lt;del&gt;FLINK-2964&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Fix broken spilling of MutableHashTable&lt;/p&gt;

&lt;p&gt;    The `HashPartition` did not count properly the number of occupied memory segments, because it excluded the memory segments of the `BuildSideBuffer`. That caused the `MutableHashTable` to fail when trying to spill a partition which did not have any overflow segments. This PR fixes the problem by also counting the memory segments of the `BuildSideBuffer`.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixMutableHashTable&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1324&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9db81acd4012cae2a2fc845bc762ab7082463ba2&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-11-04T01:17:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2964&quot; title=&quot;MutableHashTable fails when spilling partitions without overflow segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2964&quot;&gt;&lt;del&gt;FLINK-2964&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Fix broken spilling of MutableHashTable&lt;/p&gt;

&lt;p&gt;    The HashPartition did not count properly the number of occupied memory segments, because it excluded the memory segments of the BuildSideBuffer. That caused the MutableHashTable to fail when trying to spill a partition which did not have any overflow segments. This PR fixes the problem by also counting the memory segments of the BuildSideBuffer.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14989031" author="githubbot" created="Wed, 4 Nov 2015 06:57:59 +0000"  >&lt;p&gt;Github user fpompermaier commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324#issuecomment-153606566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324#issuecomment-153606566&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Do yiu think that this could fix also #2763?&lt;br/&gt;
    On 4 Nov 2015 02:20, &quot;Till Rohrmann&quot; &amp;lt;notifications@github.com&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;    &amp;gt; The HashPartition did not count properly the number of occupied memory&lt;br/&gt;
    &amp;gt; segments, because it excluded the memory segments of the BuildSideBuffer.&lt;br/&gt;
    &amp;gt; That caused the MutableHashTable to fail when trying to spill a partition&lt;br/&gt;
    &amp;gt; which did not have any overflow segments. This PR fixes the problem by also&lt;br/&gt;
    &amp;gt; counting the memory segments of the BuildSideBuffer.&lt;br/&gt;
    &amp;gt; ------------------------------&lt;br/&gt;
    &amp;gt; You can view, comment on, or merge this pull request online at:&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;   &lt;a href=&quot;https://github.com/apache/flink/pull/1324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324&lt;/a&gt;&lt;br/&gt;
    &amp;gt; Commit Summary&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;    - &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2964&quot; title=&quot;MutableHashTable fails when spilling partitions without overflow segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2964&quot;&gt;&lt;del&gt;FLINK-2964&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Fix broken spilling of MutableHashTable&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; File Changes&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;    - &lt;b&gt;M&lt;/b&gt;&lt;br/&gt;
    &amp;gt;    flink-runtime/src/main/java/org/apache/flink/runtime/operators/hash/HashPartition.java&lt;br/&gt;
    &amp;gt;    &amp;lt;&lt;a href=&quot;https://github.com/apache/flink/pull/1324/files#diff-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324/files#diff-0&lt;/a&gt;&amp;gt; (8)&lt;br/&gt;
    &amp;gt;    - &lt;b&gt;M&lt;/b&gt;&lt;br/&gt;
    &amp;gt;    flink-runtime/src/test/java/org/apache/flink/runtime/operators/hash/HashTableTest.java&lt;br/&gt;
    &amp;gt;    &amp;lt;&lt;a href=&quot;https://github.com/apache/flink/pull/1324/files#diff-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324/files#diff-1&lt;/a&gt;&amp;gt; (124)&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; Patch Links:&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;    - &lt;a href=&quot;https://github.com/apache/flink/pull/1324.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324.patch&lt;/a&gt;&lt;br/&gt;
    &amp;gt;    - &lt;a href=&quot;https://github.com/apache/flink/pull/1324.diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324.diff&lt;/a&gt;&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &#8212;&lt;br/&gt;
    &amp;gt; Reply to this email directly or view it on GitHub&lt;br/&gt;
    &amp;gt; &amp;lt;&lt;a href=&quot;https://github.com/apache/flink/pull/1324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324&lt;/a&gt;&amp;gt;.&lt;br/&gt;
    &amp;gt;&lt;/p&gt;
</comment>
                            <comment id="14989084" author="f.pompermaier" created="Wed, 4 Nov 2015 08:01:25 +0000"  >&lt;p&gt;I think this duplicate #2763&lt;/p&gt;</comment>
                            <comment id="14989144" author="till.rohrmann" created="Wed, 4 Nov 2015 08:52:37 +0000"  >&lt;p&gt;You&apos;re right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=f.pompermaier&quot; class=&quot;user-hover&quot; rel=&quot;f.pompermaier&quot;&gt;f.pompermaier&lt;/a&gt;. This seems to be the same bug. This should be fixed once we merge the PR.&lt;/p&gt;</comment>
                            <comment id="14989194" author="githubbot" created="Wed, 4 Nov 2015 09:25:23 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324#issuecomment-153652855&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324#issuecomment-153652855&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 very good fix. I would like to merge it for the next RC.&lt;/p&gt;</comment>
                            <comment id="14989242" author="githubbot" created="Wed, 4 Nov 2015 10:09:59 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324#issuecomment-153669167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324#issuecomment-153669167&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Important fix!&lt;br/&gt;
    +1 to merge and include in the next RC&lt;/p&gt;</comment>
                            <comment id="14989254" author="githubbot" created="Wed, 4 Nov 2015 10:16:41 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324#issuecomment-153671502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324#issuecomment-153671502&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging..&lt;/p&gt;</comment>
                            <comment id="14989281" author="githubbot" created="Wed, 4 Nov 2015 10:32:49 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1324&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12896384">FLINK-2763</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nx0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>