<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:45:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-16662] Blink Planner failed to generate JobGraph for POJO DataStream converting to Table (Cannot determine simple type name)</title>
                <link>https://issues.apache.org/jira/browse/FLINK-16662</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When using Blink Palnner to convert a POJO DataStream to a Table, Blink will generate and compile the SourceConversion$1 code. If the Jar task is submitted to Flink, since the UserCodeClassLoader is not used when generating the JobGraph, the ClassLoader(AppClassLoader) of the compiled code cannot load the POJO class in the Jar package, so the following error will be reported:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.codehaus.commons.compiler.CompileException: Line 27, Column 174: Cannot determine simple type name &lt;span class=&quot;code-quote&quot;&gt;&quot;net&quot;&lt;/span&gt;Caused by: org.codehaus.commons.compiler.CompileException: Line 27, Column 174: Cannot determine simple type name &lt;span class=&quot;code-quote&quot;&gt;&quot;net&quot;&lt;/span&gt; at org.codehaus.janino.UnitCompiler.compileError(UnitCompiler.java:12124) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6746) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6507) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6520) at org.codehaus.janino.UnitCompiler.getType2(UnitCompiler.java:6486) at org.codehaus.janino.UnitCompiler.access$13800(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$21$1.visitReferenceType(UnitCompiler.java:6394) at org.codehaus.janino.UnitCompiler$21$1.visitReferenceType(UnitCompiler.java:6389) at org.codehaus.janino.Java$ReferenceType.accept(Java.java:3917) at org.codehaus.janino.UnitCompiler$21.visitType(UnitCompiler.java:6389) at org.codehaus.janino.UnitCompiler$21.visitType(UnitCompiler.java:6382) at org.codehaus.janino.Java$ReferenceType.accept(Java.java:3916) at org.codehaus.janino.UnitCompiler.getType(UnitCompiler.java:6382) at org.codehaus.janino.UnitCompiler.getType2(UnitCompiler.java:7009) at org.codehaus.janino.UnitCompiler.access$15200(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$21$2.visitCast(UnitCompiler.java:6425) at org.codehaus.janino.UnitCompiler$21$2.visitCast(UnitCompiler.java:6403) at org.codehaus.janino.Java$Cast.accept(Java.java:4887) at org.codehaus.janino.UnitCompiler$21.visitRvalue(UnitCompiler.java:6403) at org.codehaus.janino.UnitCompiler$21.visitRvalue(UnitCompiler.java:6382) at org.codehaus.janino.Java$Rvalue.accept(Java.java:4105) at org.codehaus.janino.UnitCompiler.getType(UnitCompiler.java:6382) at org.codehaus.janino.UnitCompiler.findMostSpecificIInvocable(UnitCompiler.java:9150) at org.codehaus.janino.UnitCompiler.findIMethod(UnitCompiler.java:9036) at org.codehaus.janino.UnitCompiler.findIMethod(UnitCompiler.java:8938) at org.codehaus.janino.UnitCompiler.compileGet2(UnitCompiler.java:5060) at org.codehaus.janino.UnitCompiler.access$9100(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$16.visitMethodInvocation(UnitCompiler.java:4421) at org.codehaus.janino.UnitCompiler$16.visitMethodInvocation(UnitCompiler.java:4394) at org.codehaus.janino.Java$MethodInvocation.accept(Java.java:5062) at org.codehaus.janino.UnitCompiler.compileGet(UnitCompiler.java:4394) at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:5575) at org.codehaus.janino.UnitCompiler.compileGet2(UnitCompiler.java:5019) at org.codehaus.janino.UnitCompiler.access$8600(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$16.visitCast(UnitCompiler.java:4416) at org.codehaus.janino.UnitCompiler$16.visitCast(UnitCompiler.java:4394) at org.codehaus.janino.Java$Cast.accept(Java.java:4887) at org.codehaus.janino.UnitCompiler.compileGet(UnitCompiler.java:4394) at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:5575) at org.codehaus.janino.UnitCompiler.compileGet2(UnitCompiler.java:5019) at org.codehaus.janino.UnitCompiler.access$8600(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$16.visitCast(UnitCompiler.java:4416) at org.codehaus.janino.UnitCompiler$16.visitCast(UnitCompiler.java:4394) at org.codehaus.janino.Java$Cast.accept(Java.java:4887) at org.codehaus.janino.UnitCompiler.compileGet(UnitCompiler.java:4394) at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:5575) at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2580) at org.codehaus.janino.UnitCompiler.access$2700(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$6.visitLocalVariableDeclarationStatement(UnitCompiler.java:1503) at org.codehaus.janino.UnitCompiler$6.visitLocalVariableDeclarationStatement(UnitCompiler.java:1487) at org.codehaus.janino.Java$LocalVariableDeclarationStatement.accept(Java.java:3511) at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1487) at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1567) at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3388) at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1357) at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1330) at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:822) at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:432) at org.codehaus.janino.UnitCompiler.access$400(UnitCompiler.java:215) at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:411) at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:406) at org.codehaus.janino.Java$PackageMemberClassDeclaration.accept(Java.java:1414) at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:406) at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:378) at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:237) at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:465) at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:216) at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:207) at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:80) at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:75) at org.apache.flink.table.runtime.generated.CompileUtils.doCompile(CompileUtils.java:78) ... 20 more


&lt;span class=&quot;code-comment&quot;&gt;// generate class
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;/* 1 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 2 */&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SourceConversion$1 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; org.apache.flink.table.runtime.operators.AbstractProcessStreamOperator
&lt;span class=&quot;code-comment&quot;&gt;/* 3 */&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; org.apache.flink.streaming.api.operators.OneInputStreamOperator {
&lt;span class=&quot;code-comment&quot;&gt;/* 4 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 5 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] references;
&lt;span class=&quot;code-comment&quot;&gt;/* 6 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; org.apache.flink.table.dataformat.DataFormatConverters.PojoConverter converter$0;
&lt;span class=&quot;code-comment&quot;&gt;/* 7 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; org.apache.flink.streaming.runtime.streamrecord.StreamRecord outElement = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.flink.streaming.runtime.streamrecord.StreamRecord(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;span class=&quot;code-comment&quot;&gt;/* 8 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 9 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SourceConversion$1(
&lt;span class=&quot;code-comment&quot;&gt;/* 10 */&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] references,
&lt;span class=&quot;code-comment&quot;&gt;/* 11 */&lt;/span&gt;            org.apache.flink.streaming.runtime.tasks.StreamTask task,
&lt;span class=&quot;code-comment&quot;&gt;/* 12 */&lt;/span&gt;            org.apache.flink.streaming.api.graph.StreamConfig config,
&lt;span class=&quot;code-comment&quot;&gt;/* 13 */&lt;/span&gt;            org.apache.flink.streaming.api.operators.Output output) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;span class=&quot;code-comment&quot;&gt;/* 14 */&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.references = references;
&lt;span class=&quot;code-comment&quot;&gt;/* 15 */&lt;/span&gt;          converter$0 = (((org.apache.flink.table.dataformat.DataFormatConverters.PojoConverter) references[0]));
&lt;span class=&quot;code-comment&quot;&gt;/* 16 */&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.setup(task, config, output);
&lt;span class=&quot;code-comment&quot;&gt;/* 17 */&lt;/span&gt;        }
&lt;span class=&quot;code-comment&quot;&gt;/* 18 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 19 */&lt;/span&gt;        @Override
&lt;span class=&quot;code-comment&quot;&gt;/* 20 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void open() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;span class=&quot;code-comment&quot;&gt;/* 21 */&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.open();
&lt;span class=&quot;code-comment&quot;&gt;/* 22 */&lt;/span&gt;          
&lt;span class=&quot;code-comment&quot;&gt;/* 23 */&lt;/span&gt;        }
&lt;span class=&quot;code-comment&quot;&gt;/* 24 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 25 */&lt;/span&gt;        @Override
&lt;span class=&quot;code-comment&quot;&gt;/* 26 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void processElement(org.apache.flink.streaming.runtime.streamrecord.StreamRecord element) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;span class=&quot;code-comment&quot;&gt;/* 27 */&lt;/span&gt;          org.apache.flink.table.dataformat.BaseRow in1 = (org.apache.flink.table.dataformat.BaseRow) (org.apache.flink.table.dataformat.BaseRow) converter$0.toInternal((net.xxxxxxxxxx.Student) element.getValue());
&lt;span class=&quot;code-comment&quot;&gt;/* 28 */&lt;/span&gt;          
&lt;span class=&quot;code-comment&quot;&gt;/* 29 */&lt;/span&gt;          
&lt;span class=&quot;code-comment&quot;&gt;/* 30 */&lt;/span&gt;          
&lt;span class=&quot;code-comment&quot;&gt;/* 31 */&lt;/span&gt;          output.collect(outElement.replace(in1));
&lt;span class=&quot;code-comment&quot;&gt;/* 32 */&lt;/span&gt;        }
&lt;span class=&quot;code-comment&quot;&gt;/* 33 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 34 */&lt;/span&gt;        
&lt;span class=&quot;code-comment&quot;&gt;/* 35 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 36 */&lt;/span&gt;        @Override
&lt;span class=&quot;code-comment&quot;&gt;/* 37 */&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;span class=&quot;code-comment&quot;&gt;/* 38 */&lt;/span&gt;           &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
&lt;span class=&quot;code-comment&quot;&gt;/* 39 */&lt;/span&gt;          
&lt;span class=&quot;code-comment&quot;&gt;/* 40 */&lt;/span&gt;        }
&lt;span class=&quot;code-comment&quot;&gt;/* 41 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 42 */&lt;/span&gt;        
&lt;span class=&quot;code-comment&quot;&gt;/* 43 */&lt;/span&gt;      }
&lt;span class=&quot;code-comment&quot;&gt;/* 44 */&lt;/span&gt;    &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think like generating Pipeline (StreamGraph), UserCodeClassLoader should be used when generating JobGraph.&lt;br/&gt;
The test code is as follows:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;App {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
        EnvironmentSettings envSet = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build();
        StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env, envSet);

        env.enableCheckpointing(2 * 60 * 1000);

        TableConfig config = tableEnv.getConfig();
        config.setIdleStateRetentionTime(Time.hours(24),
                Time.hours(25));

        DataStreamSource&amp;lt;Student&amp;gt; source = env.addSource(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SourceFunction&amp;lt;Student&amp;gt;() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run(SourceContext&amp;lt;Student&amp;gt; ctx) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                ctx.collect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Student(1, &lt;span class=&quot;code-quote&quot;&gt;&quot;Tom&quot;&lt;/span&gt;));
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancel() {

            }
        });

        tableEnv.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;student&quot;&lt;/span&gt;, source, &lt;span class=&quot;code-quote&quot;&gt;&quot;id, name&quot;&lt;/span&gt;);
        Table table = tableEnv.sqlQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;select id, name from student&quot;&lt;/span&gt;);

        CsvTableSink sink = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CsvTableSink(&lt;span class=&quot;code-quote&quot;&gt;&quot;/data/student&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, 10, FileSystem.WriteMode.OVERWRITE);

        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] fieldNames = {&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;};
        TypeInformation[] fieldTypes = {Types.INT, Types.STRING};
        tableEnv.registerTableSink(&lt;span class=&quot;code-quote&quot;&gt;&quot;student_sink&quot;&lt;/span&gt;, fieldNames, fieldTypes, sink);
        table.insertInto(&lt;span class=&quot;code-quote&quot;&gt;&quot;student_sink&quot;&lt;/span&gt;);

        env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;Test_Jar&quot;&lt;/span&gt;);
    }

    @Getter
    @Setter
    @NoArgsConstructor
    @AllArgsConstructor
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Student {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; id;
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name;
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To reproduce this bug, the following conditions must be met:&lt;/p&gt;

&lt;p&gt;1. Convert POJO DataStream to Table&lt;br/&gt;
2. Enables Checkpoint, StreamingJobGraphGenerator#preValidate() will check whether Checkpoint is enabled&lt;br/&gt;
3. The program is packaged into a Jar and submitted to Flink, or invoke PackagedProgramUtils.createJobGraph to create JobGraph by the Jar Program directly&lt;/p&gt;</description>
                <environment></environment>
        <key id="13292496">FLINK-16662</key>
            <summary>Blink Planner failed to generate JobGraph for POJO DataStream converting to Table (Cannot determine simple type name)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhanglibing1990@126.com">LionelZ</assignee>
                                    <reporter username="chenxyz">chenxyz</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 18 Mar 2020 14:51:50 +0000</created>
                <updated>Thu, 19 Nov 2020 04:24:40 +0000</updated>
                            <resolved>Wed, 22 Apr 2020 16:56:11 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.1</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                                    <component>Client / Job Submission</component>
                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="17064756" author="zhanglibing1990@126.com" created="Mon, 23 Mar 2020 12:03:26 +0000"  >&lt;p&gt;Hi&#65292;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenxyz&quot; class=&quot;user-hover&quot; rel=&quot;chenxyz&quot;&gt;chenxyz&lt;/a&gt; I have also encountered this problem&#65292;I found when enable the checkpoint in&#160;blink plan mode&#65292;the StreamingJobGraphGenerator#preValidate() method will to check whether every operator in streamGraph doesn&apos;t implement the InputSelectable interface in the checkpointing opened state.&lt;/p&gt;

&lt;p&gt;I think you are right&#160; about&#160;UserCodeClassLoader should be used when generating JobGraph, because the OperatorFactory generate operatorClass&#160; instance use dynamic compile and it depends on the UserCodeClassLoader.&lt;/p&gt;

&lt;p&gt;I fixed this bug by expanding the scope of using UserCodeClassLoader in PackagedProgramUtils class as follows&#65306;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; JobGraph createJobGraph(
   PackagedProgram packagedProgram,
   Configuration configuration,
   &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; defaultParallelism,
   @Nullable JobID jobID,
   &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; suppressOutput) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ProgramInvocationException {
   &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; contextClassLoader = &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getContextClassLoader();
   &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JobGraph jobGraph;
   &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().setContextClassLoader(packagedProgram.getUserCodeClassLoader());
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Pipeline pipeline = getPipelineFromProgram(packagedProgram, defaultParallelism, suppressOutput);
      jobGraph = FlinkPipelineTranslationUtil.getJobGraph(pipeline, configuration, defaultParallelism);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (jobID != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
         jobGraph.setJobID(jobID);
      }
      jobGraph.addJars(packagedProgram.getJobJarAndDependencies());
      jobGraph.setClasspaths(packagedProgram.getClasspaths());
      jobGraph.setSavepointRestoreSettings(packagedProgram.getSavepointSettings());
   } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().setContextClassLoader(contextClassLoader);
   }
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; jobGraph;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and remove the the&#160;contextClassLoader logic in&#160;getPipelineFromProgram() method:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Pipeline getPipelineFromProgram(
   PackagedProgram prog,
   &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; parallelism,
   &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; suppressOutput) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CompilerException, ProgramInvocationException {
   &lt;span class=&quot;code-comment&quot;&gt;// temporary hack to support the optimizer plan preview
&lt;/span&gt;   OptimizerPlanEnvironment env = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OptimizerPlanEnvironment();
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parallelism &amp;gt; 0) {
      env.setParallelism(parallelism);
   }
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; env.getPipeline(prog, suppressOutput);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;@&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; please assign to me, and i will fix it. thanks&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17065296" author="csbliss" created="Tue, 24 Mar 2020 03:52:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;similar issue:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16585&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-16585&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, add some unit tests for this issue&lt;/p&gt;</comment>
                            <comment id="17084420" author="tliao" created="Wed, 15 Apr 2020 22:31:10 +0000"  >&lt;p&gt;Hey, any updates on this? I&apos;ve also hit this issue when trying to switch from the old planner to the blink planner on 1.10. As a data point, this is my setup:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;UDFs being shipped.&lt;/li&gt;
	&lt;li&gt;Checkpointing enabled.&lt;/li&gt;
	&lt;li&gt;Table is being created through a sql query that references a UDF.&lt;/li&gt;
	&lt;li&gt;The table is converted to a retract stream.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17084540" author="ykt836" created="Thu, 16 Apr 2020 05:06:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt;&#160;I&apos;ve assigned this to you.&#160;&lt;/p&gt;</comment>
                            <comment id="17084608" author="jark" created="Thu, 16 Apr 2020 07:13:08 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17084690" author="aljoscha" created="Thu, 16 Apr 2020 09:12:52 +0000"  >&lt;p&gt;What&apos;s the proposed fix?&lt;/p&gt;</comment>
                            <comment id="17084795" author="jark" created="Thu, 16 Apr 2020 11:48:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;, the proposed fix is in the first comment. Use the user classloader in PackagedProgram as the thread context classloader before &lt;tt&gt;getPipelineFromProgram&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="17084834" author="kkl0u" created="Thu, 16 Apr 2020 12:48:41 +0000"  >&lt;p&gt;Thanks for reporting and debugging all this. This existed also in the 1.10, right? &lt;br/&gt;
If this is the case, then apart from the bug itself, this also shows that our tests should be also extended &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Probably adding an end-to-end test?&lt;/p&gt;</comment>
                            <comment id="17084844" author="jark" created="Thu, 16 Apr 2020 13:00:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt;, do you have time to fix this? As we are going to create 1.10.1 RC and this is a blocker, we may need to have a fix soon. &lt;/p&gt;</comment>
                            <comment id="17084855" author="zhanglibing1990@126.com" created="Thu, 16 Apr 2020 13:08:36 +0000"  >&lt;p&gt;HI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;I will fix it as soon as possible.&lt;/p&gt;</comment>
                            <comment id="17085794" author="carp84" created="Fri, 17 Apr 2020 14:07:27 +0000"  >&lt;p&gt;No mean to push but any estimated time for the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt;? Thanks.&lt;/p&gt;</comment>
                            <comment id="17088047" author="kkl0u" created="Mon, 20 Apr 2020 20:06:44 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt;, and thanks for working on this. From the discussion, I was left with the impression that we are going to either add a test in the PRs for this issue, or, at least, create a new JIRA that will target adding a test for these cases.&lt;/p&gt;

&lt;p&gt;The PR has no test and there is also no other JIRA for this. Could you please create one so that we do not forget about it?&lt;/p&gt;</comment>
                            <comment id="17088051" author="kkl0u" created="Mon, 20 Apr 2020 20:16:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=NicoK&quot; class=&quot;user-hover&quot; rel=&quot;NicoK&quot;&gt;NicoK&lt;/a&gt; could you please verify that this PR solves the issue? Given that there is no test coverage, we need manual verification.&lt;/p&gt;</comment>
                            <comment id="17088932" author="zhanglibing1990@126.com" created="Tue, 21 Apr 2020 18:10:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;&#160;&#160;I did solve the problem with this method, and verified the issue in my standalone cluster. but unfortunately the issue will only recur when submit the job to the cluster, and I don&apos;t know whether it need a end-to-end test to verify it,or what&apos;s your opinion on this pr?&lt;/p&gt;

&lt;p&gt;In the meantime&#65292; I have created a Jira for this PR to add some tests in the future&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17310&quot; title=&quot;Test blink planner failed to generate JobGraph when the checkpoint mode enable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17310&quot;&gt;FLINK-17310&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;thanks&#160;&lt;/p&gt;</comment>
                            <comment id="17089858" author="kkl0u" created="Wed, 22 Apr 2020 16:56:11 +0000"  >&lt;p&gt;Merged on master with 19d9cee49bce02dd0cf232cfba003936b3b2f68e&lt;br/&gt;
and on release-1.10 with ae39868c850b5fbc08d5161b664b702e2a9f25ba&lt;/p&gt;</comment>
                            <comment id="17090816" author="chenxyz" created="Thu, 23 Apr 2020 18:10:27 +0000"  >&lt;p&gt;Hi,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt;, thx for fix. I&apos;m reporter of this issue.I think I can add a test. The root cause is current classloader (AppClassLoader, jvm default) cannot find user class, but find in UserCodeClassLoader. so we can generate job graph from a blink jar, which contains user code (udf, customer pojos,...).The test class execute in AppClassLoader (default), user class load in UserCodeClassLoader. It can be recured locally.&lt;br/&gt;
 I submited PR for the test[11889|&lt;a href=&quot;https://github.com/apache/flink/pull/11889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/11889&lt;/a&gt;],&#160;[11890|&lt;a href=&quot;https://github.com/apache/flink/pull/11890&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/11890&lt;/a&gt;]&lt;/p&gt;</comment>
                            <comment id="17091128" author="jark" created="Fri, 24 Apr 2020 03:22:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenxyz&quot; class=&quot;user-hover&quot; rel=&quot;chenxyz&quot;&gt;chenxyz&lt;/a&gt;, I think a better test is to add a real user case in end-to-end tests. A simple idea is that we can extend &lt;tt&gt;StreamSQLTestProgram&lt;/tt&gt; a bit, to register a UDF which uses user defined POJO class, and call the UDF in the SQL pipeline. I guess this can reproduce this problem. &lt;/p&gt;</comment>
                            <comment id="17091129" author="jark" created="Fri, 24 Apr 2020 03:23:40 +0000"  >&lt;p&gt;Btw, your approach is very similar to an end-to-end test. &lt;/p&gt;</comment>
                            <comment id="17091155" author="chenxyz" created="Fri, 24 Apr 2020 04:12:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; thx, you&apos;re right, end-to-end test is a better way for&#160;running in flink cluster and testing the whole lifecycle&lt;/p&gt;</comment>
                            <comment id="17105982" author="xiemeilong" created="Wed, 13 May 2020 05:18:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhanglibing1990%40126.com&quot; class=&quot;user-hover&quot; rel=&quot;zhanglibing1990@126.com&quot;&gt;zhanglibing1990@126.com&lt;/a&gt; After&#160;upgrade&#160;to 1.10.1,&#160;a similar&#160;issue occurred.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.flink.table.api.ValidationException: Given parameters of function &lt;span class=&quot;code-quote&quot;&gt;&apos;generateDecoder&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match any signature. 
Actual: (com.yunmo.iot.schema.RecordFormat, com.yunmo.iot.schema.Schema) 
Expected: (com.yunmo.iot.schema.RecordFormat, com.yunmo.iot.schema.Schema)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13291497">FLINK-16585</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13297956">FLINK-17108</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13303529">FLINK-17561</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13298620">FLINK-17171</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cnxs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>