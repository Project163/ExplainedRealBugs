<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:19:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-33981] File Descriptor References Not Released After Job Execution in MiniCluster Mode</title>
                <link>https://issues.apache.org/jira/browse/FLINK-33981</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When using MiniCluster mode, file descriptors like &lt;b&gt;&lt;tt&gt;/tmp/minicluster_6e62ab17ab058e0d5df56b97e9ccef71/tm_0/localState&lt;/tt&gt;&lt;/b&gt;&#160;are not released after a Job completes. Executing multiple Jobs in the same JVM might result in leftover file descriptors, potentially leading to problems.&lt;/p&gt;

&lt;p&gt;After executing the reproducing code provided below (after entering the sleep), running &lt;b&gt;lsof -p 18162&lt;/b&gt; reveals:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
java    18162 sa_cluster   30r   DIR              253,1         0    1311962 /tmp/minicluster_79186ba3856bb18fd21c20d9adbaa3da/tm_0/localState (deleted)
java    18162 sa_cluster   31r   DIR              253,1         0    1311962 /tmp/minicluster_79186ba3856bb18fd21c20d9adbaa3da/tm_0/localState (deleted)
java    18162 sa_cluster   32r   DIR              253,1         0    1310787 /tmp/minicluster_f3ac056ffa1c47010698fc02c5e6d4cf/tm_0/localState (deleted)
java    18162 sa_cluster   33r   DIR              253,1         0    1310787 /tmp/minicluster_f3ac056ffa1c47010698fc02c5e6d4cf/tm_0/localState (deleted)
java    18162 sa_cluster   34r   DIR              253,1         0    1311960 /tmp/minicluster_ef6177c97a2c9096758d0a8f132f9f02/tm_0/localState (deleted)
java    18162 sa_cluster   35r   DIR              253,1         0    1311960 /tmp/minicluster_ef6177c97a2c9096758d0a8f132f9f02/tm_0/localState (deleted)
java    18162 sa_cluster   36r   DIR              253,1         0    1311974 /tmp/minicluster_661a2967ea5c377265fa9f41c768db21/tm_0/localState (deleted)
java    18162 sa_cluster   37r   DIR              253,1         0    1311974 /tmp/minicluster_661a2967ea5c377265fa9f41c768db21/tm_0/localState (deleted)
java    18162 sa_cluster   38r   DIR              253,1         0    1311979 /tmp/minicluster_8413f476b77245203ed1ef759eb0d2de/tm_0/localState (deleted)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code used for reproduction is as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.common.JobExecutionResult;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.configuration.Configuration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.core.execution.JobClient;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.streaming.api.datastream.DataStreamSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.streaming.api.functions.sink.DiscardingSink;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.streaming.api.graph.StreamGraph;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.CompletableFuture;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.TimeUnit;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.TimeoutException;

/**
 * javac -cp &lt;span class=&quot;code-quote&quot;&gt;&apos;lib/*&apos;&lt;/span&gt; TestReleaseFd.java
 * java -Xmx600m -cp &lt;span class=&quot;code-quote&quot;&gt;&apos;.:lib/*&apos;&lt;/span&gt; TestReleaseFd
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestReleaseFd {

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 10; ++i) {
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; round = i;
      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; thread = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(() -&amp;gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          Configuration configuration = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration();
          &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(configuration);
          env.setParallelism(1);

          DataStreamSource&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; longDataStreamSource = env.fromSequence(1, 100000);
          longDataStreamSource.addSink(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DiscardingSink&amp;lt;&amp;gt;());

          StreamGraph streamGraph = env.getStreamGraph();
          streamGraph.setJobName(&lt;span class=&quot;code-quote&quot;&gt;&quot;test-&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime());
          JobClient jobClient = env.executeAsync(streamGraph);

          CompletableFuture&amp;lt;JobExecutionResult&amp;gt; jobExecutionResultCompletableFuture = jobClient.getJobExecutionResult();
          JobExecutionResult jobExecutionResult = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (jobExecutionResult == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
              jobExecutionResult = jobExecutionResultCompletableFuture.get(20, TimeUnit.SECONDS);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (TimeoutException timeoutException) {
              &lt;span class=&quot;code-comment&quot;&gt;// ignore
&lt;/span&gt;            }
          }
          &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;finished round: &quot;&lt;/span&gt; + round);
          env.close();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(e);
        }
      });

      thread.setDaemon(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      thread.start();
      thread.join();

      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;done ... &quot;&lt;/span&gt; + i);
    }
    
    &lt;span class=&quot;code-comment&quot;&gt;// ======================= lsof -p 18162
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(500_000_000);
  }
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above code can be consistently reproduced in Flink 1.18.0, but there is no issue in Flink 1.14.6.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13563527">FLINK-33981</key>
            <summary>File Descriptor References Not Released After Job Execution in MiniCluster Mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fengjiajie">Feng Jiajie</assignee>
                                    <reporter username="fengjiajie">Feng Jiajie</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 4 Jan 2024 05:22:03 +0000</created>
                <updated>Mon, 5 Feb 2024 07:11:43 +0000</updated>
                            <resolved>Mon, 5 Feb 2024 07:10:27 +0000</resolved>
                                    <version>1.18.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                    <fixVersion>1.17.3</fixVersion>
                    <fixVersion>1.18.2</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17802398" author="fengjiajie" created="Thu, 4 Jan 2024 05:25:49 +0000"  >&lt;p&gt;The above code can be consistently reproduced in Flink 1.18.0, but there is no issue in Flink 1.14.6.&lt;/p&gt;</comment>
                            <comment id="17811659" author="fengjiajie" created="Sun, 28 Jan 2024 13:49:17 +0000"  >&lt;p&gt;I found the issue and will submit a fix later. Please assign the Jira issue to me, thanks.&lt;/p&gt;</comment>
                            <comment id="17814046" author="fanrui" created="Sun, 4 Feb 2024 07:12:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fengjiajie&quot; class=&quot;user-hover&quot; rel=&quot;fengjiajie&quot;&gt;fengjiajie&lt;/a&gt; , would you mind backporting it to 1.17 and master branch as well? Thanks a lot.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Merged to :&lt;/p&gt;

&lt;p&gt;master(1.19) via: 360c1a0831b64bfb79699d81325c8f9783517be1&lt;/p&gt;

&lt;p&gt;1.18 via: fc54ffd0c3e77f7fa01ce04c41291bd80900288f&lt;/p&gt;

&lt;p&gt;1.17 via: 1419619b07122b5c734105311d8eff939a687596&lt;/p&gt;</comment>
                            <comment id="17814180" author="fengjiajie" created="Mon, 5 Feb 2024 06:40:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanrui&quot; class=&quot;user-hover&quot; rel=&quot;fanrui&quot;&gt;fanrui&lt;/a&gt; , thanks for the review, I have submitted the changes to 1.17 and master branch, the tests have been passed.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mju8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>