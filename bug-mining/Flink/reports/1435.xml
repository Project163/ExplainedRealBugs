<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5482] QueryableStateClient does not recover from a failed lookup due to a non-running job</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5482</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When the QueryableStateClient is used to issue a query but the job is not running yet, its internal lookup result is cached with an IllegalStateException that the job was not found. It does, however, never recover from that.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13034689">FLINK-5482</key>
            <summary>QueryableStateClient does not recover from a failed lookup due to a non-running job</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jan 2017 15:25:28 +0000</created>
                <updated>Fri, 20 Jan 2017 11:33:37 +0000</updated>
                            <resolved>Fri, 20 Jan 2017 11:29:08 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15821907" author="githubbot" created="Fri, 13 Jan 2017 15:29:36 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5482&quot; title=&quot;QueryableStateClient does not recover from a failed lookup due to a non-running job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5482&quot;&gt;&lt;del&gt;FLINK-5482&lt;/del&gt;&lt;/a&gt; QueryableStateClient does not recover from a failed lookup due to a non-running job&lt;/p&gt;

&lt;p&gt;    This PR checks each cached lookup query whether it is complete and removes any failed lookup from the cache in favour of a retry.&lt;/p&gt;

&lt;p&gt;    An appropriate unit test is added based on existing test code.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-5482&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3120.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3120.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3120&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 086aca06674618cb3be962a883efa62c77aa1c66&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-01-12T15:41:30Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5482&quot; title=&quot;QueryableStateClient does not recover from a failed lookup due to a non-running job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5482&quot;&gt;&lt;del&gt;FLINK-5482&lt;/del&gt;&lt;/a&gt; share more code in QueryableStateITCase&lt;/p&gt;

&lt;p&gt;commit a50e155cf2a1e7e04b160d5226f16f017509799e&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-01-12T15:48:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5482&quot; title=&quot;QueryableStateClient does not recover from a failed lookup due to a non-running job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5482&quot;&gt;&lt;del&gt;FLINK-5482&lt;/del&gt;&lt;/a&gt; fix QueryableStateClient not re-issuing a lookup upon failure&lt;/p&gt;

&lt;p&gt;    Any failing lookup, e.g. in case the job has not been started yet, previously&lt;br/&gt;
    remained in the lookup cache and thus future queries did not retry the lookup&lt;br/&gt;
    and failed. This commit changes the lookup caching code so that completed&lt;br/&gt;
    and failed futures are removed from the cache and replaced by new lookups.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15823989" author="githubbot" created="Mon, 16 Jan 2017 13:48:32 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3120#discussion_r96232469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3120#discussion_r96232469&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/query/QueryableStateClient.java &amp;#8212;&lt;br/&gt;
    @@ -341,7 +341,34 @@ public void shutDown() &lt;/p&gt;
{
     					return previous;
     				}
&lt;p&gt;     			} else {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return cachedFuture;&lt;br/&gt;
    +				// do not retain futures which failed as they will remain in&lt;br/&gt;
    +				// the cache even if the error cause is not present any more&lt;br/&gt;
    +				// and a new lookup may succeed&lt;br/&gt;
    +				boolean isFailedFuture = false;&lt;br/&gt;
    +				if (cachedFuture.isCompleted()) {&lt;br/&gt;
    +					// find out if the future failed&lt;br/&gt;
    +					try {&lt;br/&gt;
    +						cachedFuture.value().get().get();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think you can do `cachedFuture.value().get().isFailure()` instead of catching the Exception here. &lt;/p&gt;</comment>
                            <comment id="15823990" author="githubbot" created="Mon, 16 Jan 2017 13:48:53 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Very good catch! Thanks. The change looks good to me.&lt;/p&gt;</comment>
                            <comment id="15831561" author="githubbot" created="Fri, 20 Jan 2017 11:24:28 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Build failures are unrelated, merging this. Thanks!&lt;/p&gt;</comment>
                            <comment id="15831566" author="uce" created="Fri, 20 Jan 2017 11:29:08 +0000"  >&lt;p&gt;Fixed in 1db8102 (release-1.2), 7ff7f43 (master).&lt;/p&gt;</comment>
                            <comment id="15831576" author="githubbot" created="Fri, 20 Jan 2017 11:33:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3120&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38o7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>