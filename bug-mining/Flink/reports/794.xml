<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3328] Incorrectly shaded dependencies in flink-runtime</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3328</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;There are apparently some dependencies shaded into &lt;tt&gt;flink-runtime&lt;/tt&gt; fat jar that are not relocated. (the flink-runtime jar is now 70 MB)&lt;/p&gt;

&lt;p&gt;From the output of the shading in flink-dist, it looks as if this concerns at least&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Zookeeper&lt;/li&gt;
	&lt;li&gt;slf4j&lt;/li&gt;
	&lt;li&gt;jline&lt;/li&gt;
	&lt;li&gt;netty (3.x)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Possible more.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[WARNING] zookeeper-3.4.6.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 440 overlapping classes: 
[WARNING]   - org.apache.zookeeper.server.NettyServerCnxnFactory
[WARNING]   - org.apache.jute.compiler.JFile
[WARNING]   - org.apache.zookeeper.server.SessionTracker$Session
[WARNING]   - org.apache.zookeeper.server.quorum.AuthFastLeaderElection$1
[WARNING]   - org.apache.jute.compiler.JLong
[WARNING]   - org.apache.zookeeper.client.ZooKeeperSaslClient$SaslState
[WARNING]   - org.apache.zookeeper.server.auth.KerberosName$Rule
[WARNING]   - org.apache.jute.CsvOutputArchive
[WARNING]   - org.apache.zookeeper.server.quorum.QuorumPeer
[WARNING]   - org.apache.zookeeper.ZooKeeper$DataWatchRegistration
[WARNING]   - 430 more...
[WARNING] slf4j-api-1.7.7.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 24 overlapping classes: 
[WARNING]   - org.slf4j.spi.MarkerFactoryBinder
[WARNING]   - org.slf4j.helpers.SubstituteLogger
[WARNING]   - org.slf4j.helpers.BasicMarker
[WARNING]   - org.slf4j.helpers.Util
[WARNING]   - org.slf4j.LoggerFactory
[WARNING]   - org.slf4j.Marker
[WARNING]   - org.slf4j.helpers.NamedLoggerBase
[WARNING]   - org.slf4j.Logger
[WARNING]   - org.slf4j.spi.LocationAwareLogger
[WARNING]   - org.slf4j.ILoggerFactory
[WARNING]   - 14 more...
[WARNING] jansi-1.4.jar, jline-2.10.4.jar define 23 overlapping classes: 
[WARNING]   - org.fusesource.jansi.Ansi$Erase
[WARNING]   - org.fusesource.jansi.Ansi
[WARNING]   - org.fusesource.jansi.AnsiOutputStream
[WARNING]   - org.fusesource.jansi.internal.CLibrary
[WARNING]   - org.fusesource.jansi.Ansi$2
[WARNING]   - org.fusesource.jansi.WindowsAnsiOutputStream
[WARNING]   - org.fusesource.jansi.AnsiRenderer$Code
[WARNING]   - org.fusesource.jansi.AnsiConsole
[WARNING]   - org.fusesource.jansi.Ansi$Attribute
[WARNING]   - org.fusesource.jansi.internal.Kernel32
[WARNING]   - 13 more...
[WARNING] commons-beanutils-core-1.8.0.jar, commons-collections-3.2.2.jar, commons-beanutils-1.7.0.jar define 10 overlapping classes: 
[WARNING]   - org.apache.commons.collections.FastHashMap$EntrySet
[WARNING]   - org.apache.commons.collections.ArrayStack
[WARNING]   - org.apache.commons.collections.FastHashMap$1
[WARNING]   - org.apache.commons.collections.FastHashMap$KeySet
[WARNING]   - org.apache.commons.collections.FastHashMap$CollectionView
[WARNING]   - org.apache.commons.collections.BufferUnderflowException
[WARNING]   - org.apache.commons.collections.Buffer
[WARNING]   - org.apache.commons.collections.FastHashMap$CollectionView$CollectionViewIterator
[WARNING]   - org.apache.commons.collections.FastHashMap$Values
[WARNING]   - org.apache.commons.collections.FastHashMap
[WARNING] flink-streaming-scala_2.10-1.0-SNAPSHOT.jar, flink-core-1.0-SNAPSHOT.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar, flink-java-1.0-SNAPSHOT.jar, flink-streaming-java_2.10-1.0-SNAPSHOT.jar, flink-scala_2.10-1.0-SNAPSHOT.jar, flink-clients_2.10-1.0-SNAPSHOT.jar, flink-optimizer_2.10-1.0-SNAPSHOT.jar, flink-runtime-web_2.10-1.0-SNAPSHOT.jar define 1690 overlapping classes: 
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.LinkedListMultimap
[WARNING]   - org.apache.flink.shaded.com.google.common.io.ByteSource$AsCharSource
[WARNING]   - org.apache.flink.shaded.com.google.common.escape.Platform
[WARNING]   - org.apache.flink.shaded.com.google.common.util.concurrent.Futures$ImmediateFailedCheckedFuture
[WARNING]   - org.apache.flink.shaded.com.google.common.primitives.SignedBytes$LexicographicalComparator
[WARNING]   - org.apache.flink.shaded.com.google.common.cache.LocalCache$WriteQueue$2
[WARNING]   - org.apache.flink.shaded.com.google.common.escape.Escaper$1
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.MultimapBuilder$SetMultimapBuilder
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.Ordering$ArbitraryOrdering
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.Synchronized$SynchronizedAsMapEntries$1
[WARNING]   - 1680 more...
[WARNING] flink-scala_2.10-1.0-SNAPSHOT.jar, flink-java-1.0-SNAPSHOT.jar, flink-streaming-scala_2.10-1.0-SNAPSHOT.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 25 overlapping classes: 
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.Context
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.FieldWriter
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.TypePath
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.Handler
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.TypeReference
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.signature.SignatureVisitor
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.Frame
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.FieldVisitor
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.ByteVector
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.ClassVisitor
[WARNING]   - 15 more...
[WARNING] jline-0.9.94.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 35 overlapping classes: 
[WARNING]   - jline.ArgumentCompletor$ArgumentList
[WARNING]   - jline.UnsupportedTerminal
[WARNING]   - jline.Terminal
[WARNING]   - jline.WindowsTerminal$ReplayPrefixOneCharInputStream
[WARNING]   - jline.History
[WARNING]   - jline.WindowsTerminal$1
[WARNING]   - jline.ConsoleReader
[WARNING]   - jline.ClassNameCompletor
[WARNING]   - jline.SimpleCompletor$SimpleCompletorFilter
[WARNING]   - jline.CandidateCycleCompletionHandler
[WARNING]   - 25 more...
[WARNING] netty-3.8.0.Final.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 810 overlapping classes: 
[WARNING]   - org.jboss.netty.handler.codec.http.websocketx.WebSocketClientHandshaker
[WARNING]   - org.jboss.netty.handler.codec.base64.Base64Decoder
[WARNING]   - org.jboss.netty.channel.socket.nio.NioDatagramPipelineSink$1
[WARNING]   - org.jboss.netty.util.VirtualExecutorService
[WARNING]   - org.jboss.netty.util.DefaultObjectSizeEstimator
[WARNING]   - org.jboss.netty.util.internal.ConcurrentIdentityHashMap$HashEntry
[WARNING]   - org.jboss.netty.channel.socket.oio.OioDatagramChannel
[WARNING]   - org.jboss.netty.logging.InternalLoggerFactory
[WARNING]   - org.jboss.netty.handler.codec.spdy.DefaultSpdyDataFrame
[WARNING]   - org.jboss.netty.channel.LifeCycleAwareChannelHandler
[WARNING]   - 800 more...
[WARNING] flink-java-1.0-SNAPSHOT.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 141 overlapping classes: 
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.tree.ClassNode
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.commons.JSRInlinerAdapter$Instantiation
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.tree.analysis.BasicValue
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.Processor$SingleDocElement
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.tree.TypeAnnotationNode
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.commons.CodeSizeEvaluator
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.Processor$SAXWriter
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.util.TraceFieldVisitor
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.Processor$ContentHandlerFactory
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.ASMContentHandler$FrameTypeRule
[WARNING]   - 131 more...
[WARNING] commons-beanutils-core-1.8.0.jar, commons-beanutils-1.7.0.jar define 82 overlapping classes: 
[WARNING]   - org.apache.commons.beanutils.Converter
[WARNING]   - org.apache.commons.beanutils.WrapDynaBean
[WARNING]   - org.apache.commons.beanutils.converters.IntegerConverter
[WARNING]   - org.apache.commons.beanutils.locale.LocaleBeanUtilsBean
[WARNING]   - org.apache.commons.beanutils.locale.converters.DoubleLocaleConverter
[WARNING]   - org.apache.commons.beanutils.locale.converters.DecimalLocaleConverter
[WARNING]   - org.apache.commons.beanutils.converters.ShortConverter
[WARNING]   - org.apache.commons.beanutils.converters.StringArrayConverter
[WARNING]   - org.apache.commons.beanutils.locale.LocaleConvertUtilsBean
[WARNING]   - org.apache.commons.beanutils.LazyDynaClass
[WARNING]   - 72 more...
[WARNING] commons-lang3-3.3.2.jar, flink-runtime_2.10-1.0-SNAPSHOT.jar define 217 overlapping classes: 
[WARNING]   - org.apache.commons.lang3.builder.DiffResult
[WARNING]   - org.apache.commons.lang3.CharRange
[WARNING]   - org.apache.commons.lang3.builder.ToStringStyle$ShortPrefixToStringStyle
[WARNING]   - org.apache.commons.lang3.concurrent.ConcurrentException
[WARNING]   - org.apache.commons.lang3.builder.DiffBuilder$1
[WARNING]   - org.apache.commons.lang3.builder.DiffBuilder
[WARNING]   - org.apache.commons.lang3.builder.Diff
[WARNING]   - org.apache.commons.lang3.time.FastDatePrinter$TwoDigitYearField
[WARNING]   - org.apache.commons.lang3.ObjectUtils$Null
[WARNING]   - org.apache.commons.lang3.reflect.MemberUtils
[WARNING]   - 207 more...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12936464">FLINK-3328</key>
            <summary>Incorrectly shaded dependencies in flink-runtime</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rmetzger">Robert Metzger</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2016 20:05:59 +0000</created>
                <updated>Wed, 2 Oct 2019 17:44:58 +0000</updated>
                            <resolved>Thu, 4 Feb 2016 14:24:48 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Build System</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15132134" author="rmetzger" created="Thu, 4 Feb 2016 10:52:33 +0000"  >&lt;p&gt;I had an offline chat with Stephan. The file is only 7.6 MB.&lt;/p&gt;

&lt;p&gt;The netty, sfl4j, .. dependencies are coming from the &quot;flink-shaded-curator-recipes.jar&quot;&lt;/p&gt;

&lt;p&gt;.... Further investigating ....&lt;/p&gt;</comment>
                            <comment id="15132169" author="githubbot" created="Thu, 4 Feb 2016 11:20:57 +0000"  >&lt;p&gt;GitHub user rmetzger opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1584&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3328&quot; title=&quot;Incorrectly shaded dependencies in flink-runtime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3328&quot;&gt;&lt;del&gt;FLINK-3328&lt;/del&gt;&lt;/a&gt; Incorrectly shaded dependencies in flink-runtime&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rmetzger/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rmetzger/flink&lt;/a&gt; flink3328&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1584.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1584.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1584&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0b7c6d65eebf9883a7e9711f462a67ea12da4a1a&lt;br/&gt;
Author: Robert Metzger &amp;lt;rmetzger@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-02-04T11:20:20Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3328&quot; title=&quot;Incorrectly shaded dependencies in flink-runtime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3328&quot;&gt;&lt;del&gt;FLINK-3328&lt;/del&gt;&lt;/a&gt; Incorrectly shaded dependencies in flink-runtime&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15132269" author="githubbot" created="Thu, 4 Feb 2016 13:07:16 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1584#issuecomment-179823460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1584#issuecomment-179823460&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Till told me that we do all this curator shading because of Hadoop 2.6.0.&lt;/p&gt;

&lt;p&gt;    I&apos;ll verify if everything is working with 2.6 as well.&lt;/p&gt;</comment>
                            <comment id="15132372" author="githubbot" created="Thu, 4 Feb 2016 14:17:06 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1584#issuecomment-179861292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1584#issuecomment-179861292&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Cool, thanks for fixing this.&lt;br/&gt;
    Changes look good to me!&lt;/p&gt;</comment>
                            <comment id="15132378" author="githubbot" created="Thu, 4 Feb 2016 14:22:42 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1584#issuecomment-179866261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1584#issuecomment-179866261&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It works with CDH 5.4.2, which uses Hadoop 2.6.0.&lt;/p&gt;

&lt;p&gt;    I&apos;ll merge it.&lt;/p&gt;</comment>
                            <comment id="15132380" author="githubbot" created="Thu, 4 Feb 2016 14:24:27 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1584&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15132381" author="rmetzger" created="Thu, 4 Feb 2016 14:24:48 +0000"  >&lt;p&gt;Resolved in &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/7378f014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/7378f014&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15969820" author="lukehutch" created="Sat, 15 Apr 2017 05:28:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; I&apos;m still seeing this in Flink 1.2.0:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[WARNING] flink-core-1.2.0.jar, flink-java-1.2.0.jar, flink-runtime_2.10-1.2.0.jar define 166 overlapping classes: 
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.ASMContentHandler$LocalVarRule
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.tree.InvokeDynamicInsnNode
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.ASMContentHandler$ExceptionRule
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.Attribute
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.ASMContentHandler$LookupSwitchLabelRule
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.tree.LdcInsnNode
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.commons.JSRInlinerAdapter$Instantiation
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.xml.Processor$OutputSlicingHandler
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.tree.LocalVariableAnnotationNode
[WARNING]   - org.apache.flink.shaded.org.objectweb.asm.commons.StaticInitMerger
[WARNING]   - 156 more...
[WARNING] flink-runtime-web_2.10-1.2.0.jar, flink-runtime_2.10-1.2.0.jar, flink-optimizer_2.10-1.2.0.jar define 1690 overlapping classes: 
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.Synchronized$SynchronizedSortedSetMultimap
[WARNING]   - org.apache.flink.shaded.com.google.common.util.concurrent.FutureCallback
[WARNING]   - org.apache.flink.shaded.com.google.common.util.concurrent.Monitor$Guard
[WARNING]   - org.apache.flink.shaded.com.google.common.util.concurrent.Striped$2
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.ImmutableEnumSet$1
[WARNING]   - org.apache.flink.shaded.com.google.common.primitives.Bytes$ByteArrayAsList
[WARNING]   - org.apache.flink.shaded.com.google.common.math.IntMath$1
[WARNING]   - org.apache.flink.shaded.com.google.common.hash.Hashing$ConcatenatedHashFunction
[WARNING]   - org.apache.flink.shaded.com.google.common.hash.Funnels$UnencodedCharsFunnel
[WARNING]   - org.apache.flink.shaded.com.google.common.collect.DenseImmutableTable$ImmutableArrayMap$1$1
[WARNING]   - 1680 more...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15975227" author="stephanewen" created="Wed, 19 Apr 2017 18:22:15 +0000"  >&lt;p&gt;That is not a problem. Guava and asm must be in each artifact (&lt;tt&gt;flink-core&lt;/tt&gt;, &lt;tt&gt;flink-runtime&lt;/tt&gt;, etc) to make them self contained.&lt;br/&gt;
When assembling the final jar, they all have guava, so you have an overlap of the exact same classes.&lt;/p&gt;

&lt;p&gt;The alternative is to relocate it to a different namespace in each artifact, but then we get guava 10 times into the &lt;tt&gt;flink-dist&lt;/tt&gt;, and that is not very desirable.&lt;/p&gt;</comment>
                            <comment id="15975268" author="lukehutch" created="Wed, 19 Apr 2017 18:42:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; It&apos;s only not a problem if you know that in every case, the version of every single shared library will be the same between all Flink jars. And even if you know that will be the case, it&apos;s hardly ideal space-wise, because you end up pulling in the same dependencies multiple times for every Flink project, until a fat jar is built. In general, there is a good reason for that Maven warning, because if there&apos;s any way that multiple different versions of a dep can occur, you can trigger bugs that are maddeningly hard to trace.&lt;/p&gt;

&lt;p&gt;If every Flink jar (like &lt;tt&gt;flink-runtime&lt;/tt&gt;) depends on one of the core Flink jars (e.g. &lt;tt&gt;flink-core&lt;/tt&gt;), couldn&apos;t all the shared dependencies just be put in that one jar?&lt;/p&gt;</comment>
                            <comment id="15976371" author="stephanewen" created="Thu, 20 Apr 2017 09:34:41 +0000"  >&lt;p&gt;To do that, one would have to explicitly code against the shaded namespaces, meaning explicitly use &lt;tt&gt;org.apache.flink.shaded.com.google.common.collect.Lists&lt;/tt&gt; rather than &lt;tt&gt;com.google.common.collect.Lists&lt;/tt&gt;.&lt;br/&gt;
That&apos;s not ideal either.&lt;/p&gt;

&lt;p&gt;I think the best think is to actually avoid libraries that are used in many modules need shading. We started to do that with Guava. With ASM it will not be possible, I think.&lt;/p&gt;

&lt;p&gt;An alternative that I could see is to have a single &lt;tt&gt;flink-shaded-dependencies&lt;/tt&gt; project in which we have the libraries shaded once, and then we develop against the shaded namespaces directly.&lt;/p&gt;</comment>
                            <comment id="15976408" author="zentol" created="Thu, 20 Apr 2017 09:57:57 +0000"  >&lt;p&gt;Would IDE&apos;s work properly out-of-the-box when working against the shaded namespaces?&lt;/p&gt;</comment>
                            <comment id="15976621" author="stephanewen" created="Thu, 20 Apr 2017 12:39:10 +0000"  >&lt;p&gt;Yeah, I see your point. It would work more smooth if there is a separate project with separate release for the big shaded artifact.&lt;br/&gt;
Yet one more point for the way we have it currently...&lt;/p&gt;</comment>
                            <comment id="15976649" author="lukehutch" created="Thu, 20 Apr 2017 13:05:08 +0000"  >&lt;p&gt;What&apos;s the advantage to Flink of including all these shaded deps, rather than just relying on something like Maven or Gradle to pull in deps? There are numerous reasons why it is not usually a good idea to incorporate copies of external dependencies.&lt;/p&gt;</comment>
                            <comment id="15977106" author="stephanewen" created="Thu, 20 Apr 2017 17:17:56 +0000"  >&lt;p&gt;What you suggest (let Maven or Gradle to pull in deps) is exactly what we do currently. Shading hides a dependency from downstream dependencies, so they pull the dependency again, and again hide it in the shading process.&lt;/p&gt;</comment>
                            <comment id="15977155" author="lukehutch" created="Thu, 20 Apr 2017 18:00:47 +0000"  >&lt;p&gt;Right, but shading requires a complete copy of the deps to be shipped inside the jar. I understand the desire to reduce namespace clashes and to not allow users to depend upon Flink&apos;s deps (or to not expose users to Flink&apos;s deps). But I think it&apos;s actually worse to ship a complete copy of all deps (shaded) with a library, due to increased overall size, if a consumer of the library also uses the dep.&lt;/p&gt;

&lt;p&gt;(Also, in the general case, bundling is almost always a bad idea for security reasons &amp;#8211; if an urgent patch is needed to a shaded jar, users have to wait for the producer of the library to re-build with the fix, rather than just depending upon an ABI-compatible fixed version themselves &amp;#8211; although this is mitigated here by the fact that Flink is open source, so users can build their own Flink libraries if they need to. Bundling in general is generally frowned upon for this reason, e.g. in the situation outside the JVM world where a large number of programs statically link in OpenSSH and/or zlib, rather than using the systemwide version of it.)&lt;/p&gt;

&lt;p&gt;Apologies if I&apos;m still misunderstanding the issues here.&lt;/p&gt;</comment>
                            <comment id="15977227" author="stephanewen" created="Thu, 20 Apr 2017 18:33:51 +0000"  >&lt;p&gt;That&apos;s all right.&lt;/p&gt;

&lt;p&gt;We would not shade/bundle if we did not need to. The libraries we shade are simply frequently conflicting with different version used by users, that&apos;s why we need to make them disappear.&lt;br/&gt;
There is simply no good way in Java currently to allow different versions of a library to co-exist. For everyone to always use the newest one, libraries would have to be perfectly backwards compatible, which most are not.&lt;/p&gt;

&lt;p&gt;Hence the ugly shading business...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sdmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>