<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:03:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23960] StreamTaskTimerTest.checkScheduledTimestamps fails on azure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23960</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22770&amp;amp;view=logs&amp;amp;j=f0ac5c25-1168-55a5-07ff-0e88223afed9&amp;amp;t=50bf7a25-bdc4-5e56-5478-c7b4511dde53&amp;amp;l=10736&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22770&amp;amp;view=logs&amp;amp;j=f0ac5c25-1168-55a5-07ff-0e88223afed9&amp;amp;t=50bf7a25-bdc4-5e56-5478-c7b4511dde53&amp;amp;l=10736&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Aug 24 22:32:06 [ERROR] Tests run: 3, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 1.421 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.streaming.runtime.operators.StreamTaskTimerTest
Aug 24 22:32:06 [ERROR] checkScheduledTimestamps  Time elapsed: 1.372 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
Aug 24 22:32:06 java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
Aug 24 22:32:06 	at org.junit.Assert.fail(Assert.java:89)
Aug 24 22:32:06 	at org.apache.flink.streaming.runtime.operators.StreamTaskTimerTest.verifyNoException(StreamTaskTimerTest.java:166)
Aug 24 22:32:06 	at org.apache.flink.streaming.runtime.operators.StreamTaskTimerTest.checkScheduledTimestamps(StreamTaskTimerTest.java:129)
Aug 24 22:32:06 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
Aug 24 22:32:06 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
Aug 24 22:32:06 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
Aug 24 22:32:06 	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
Aug 24 22:32:06 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
Aug 24 22:32:06 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
Aug 24 22:32:06 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
Aug 24 22:32:06 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
Aug 24 22:32:06 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
Aug 24 22:32:06 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
Aug 24 22:32:06 	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:299)
Aug 24 22:32:06 	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:293)
Aug 24 22:32:06 	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
Aug 24 22:32:06 	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13397054">FLINK-23960</key>
            <summary>StreamTaskTimerTest.checkScheduledTimestamps fails on azure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="akalashnikov">Anton Kalashnikov</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 25 Aug 2021 03:28:55 +0000</created>
                <updated>Mon, 6 Sep 2021 07:54:39 +0000</updated>
                            <resolved>Mon, 6 Sep 2021 07:54:39 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.15.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17406533" author="xintongsong" created="Mon, 30 Aug 2021 03:47:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23008&amp;amp;view=logs&amp;amp;j=b0a398c0-685b-599c-eb57-c8c2a771138e&amp;amp;t=747432ad-a576-5911-1e2a-68c6bedc248a&amp;amp;l=9098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23008&amp;amp;view=logs&amp;amp;j=b0a398c0-685b-599c-eb57-c8c2a771138e&amp;amp;t=747432ad-a576-5911-1e2a-68c6bedc248a&amp;amp;l=9098&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17407526" author="akalashnikov" created="Tue, 31 Aug 2021 17:00:54 +0000"  >&lt;p&gt;The cause of this problem is &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23208&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-23208&lt;/a&gt;.&lt;br/&gt;
After these changes, if we have processingTime equal to currentTime the result time will be 1 ms, but if we have procesingTime less than currentTime the result will be 0. So if we have a sequence like that:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;registerTimer(currentTime, ...)
registerTimer(currentTime-1, ...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;According to the test, we should execute it in order of registration but in fact, we reorder it because of the reason which I described before.&lt;br/&gt;
I personally don&apos;t understand the semantic of ProcessingTimeServiceUtil#getProcessingTimeDelay and why we should increase processing time on 1 ms(especially why we should do it with `0`). So maybe, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wind_ljy&quot; class=&quot;user-hover&quot; rel=&quot;wind_ljy&quot;&gt;wind_ljy&lt;/a&gt; can you help with that? I mean it should be simple if we are sure about changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23208&quot; title=&quot;Late processing timers need to wait 1ms at least to be fired&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-23208&quot;&gt;&lt;del&gt;FLINK-23208&lt;/del&gt;&lt;/a&gt; then we should change the `checkScheduledTimestamps` test according to the new semantic.&lt;/p&gt;

&lt;p&gt;P.S. It will be nice if you explain or give me some link with an explanation about why `A watermark T says we won&apos;t see elements in the future with a timestamp smaller or equal to T` and why processing time service should following the same rule.&lt;/p&gt;</comment>
                            <comment id="17407855" author="xintongsong" created="Wed, 1 Sep 2021 06:22:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23250&amp;amp;view=logs&amp;amp;j=b0a398c0-685b-599c-eb57-c8c2a771138e&amp;amp;t=747432ad-a576-5911-1e2a-68c6bedc248a&amp;amp;l=9095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23250&amp;amp;view=logs&amp;amp;j=b0a398c0-685b-599c-eb57-c8c2a771138e&amp;amp;t=747432ad-a576-5911-1e2a-68c6bedc248a&amp;amp;l=9095&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17407986" author="pnowojski" created="Wed, 1 Sep 2021 09:03:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akalashnikov&quot; class=&quot;user-hover&quot; rel=&quot;akalashnikov&quot;&gt;akalashnikov&lt;/a&gt; for the reason behind the &lt;tt&gt;getProcessingTimeDelay&lt;/tt&gt; you can check &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9857&quot; title=&quot;Processing-time timers fire too early&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9857&quot;&gt;&lt;del&gt;FLINK-9857&lt;/del&gt;&lt;/a&gt; that introduced it. In short the issue is that we want timers for time &lt;tt&gt;t&lt;/tt&gt; to fire AFTER all records with &lt;tt&gt;timestamp &amp;lt;= t&lt;/tt&gt; have been already processed. Without this 1ms delay, if we had fired the timer for &lt;tt&gt;t&lt;/tt&gt;  at the timestamp &lt;tt&gt;t&lt;/tt&gt;, it would be possible that we would process another record for &lt;tt&gt;timestamp == t&lt;/tt&gt; in the same millisecond. More concrete example, we could fire a window timer, produce records for that window and then we would receive another record that should have belong to that already emitted window.&lt;/p&gt;

&lt;p&gt;As it was unclear to you, can you expand the comment &lt;tt&gt;getProcessingTimeDelay&lt;/tt&gt; to avoid future confusions?&lt;/p&gt;

&lt;p&gt;For adjust the tests, I think yes. We should adjust the expected sequence. &lt;/p&gt;</comment>
                            <comment id="17408182" author="akalashnikov" created="Wed, 1 Sep 2021 13:42:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;,&#160;thanks for explanation. But now I think that we have a problem with the design.&#160;SystemProcessingTimeService says nothing that it can process only records(in fact, it can process everything). So I was confused why in such based level service as&#160;SystemProcessingTimeService we have integrated logic for processing records. I believe it is better to have something like RecordProcessingTimeService which can do specific logic for record processing.&lt;/p&gt;

&lt;p&gt;Anyway, I don&apos;t think that it is a big problem. So I just will fix the test and try to improve java-doc.&lt;/p&gt;</comment>
                            <comment id="17408201" author="pnowojski" created="Wed, 1 Sep 2021 14:30:25 +0000"  >&lt;p&gt;I don&apos;t think that it&apos;s only record specific. Instead of records, think about any events. Some event happened and you are registering a timer for timestamp &lt;tt&gt;t&lt;/tt&gt; that you want to trigger after that timestamp &lt;tt&gt;t&lt;/tt&gt; has passed. We don&apos;t want the same event for the same timestamp &lt;tt&gt;t&lt;/tt&gt; to register a second timer 0.01ms after firing the previous one prematurely.  To do so, we are firing timer for &lt;tt&gt;t&lt;/tt&gt; at &lt;tt&gt;t+1&lt;/tt&gt; if &lt;tt&gt;t&lt;/tt&gt; is not in the past.&lt;/p&gt;</comment>
                            <comment id="17410450" author="pnowojski" created="Mon, 6 Sep 2021 07:54:39 +0000"  >&lt;p&gt;merged to master as 25b985de06b^^..25b985de06b&lt;br/&gt;
merged to release-1.14 as 5a68bb88d92^^..5a68bb88d92&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0u7ts:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>