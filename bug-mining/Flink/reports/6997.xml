<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31612] ClassNotFoundException when using GCS path as HA directory</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31612</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;When I am trying to run Flink job in HA mode with GCS path as a HA directory (eg: &lt;span class=&quot;error&quot;&gt;&amp;#91;gs://flame-poc/ha&amp;#93;&lt;/span&gt;) or while starting a job from checkpoints in GCS I am getting following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.RuntimeException: java.lang.ClassNotFoundException: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; org.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback not found
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.conf.Configuration.getClass(Configuration.java:2688) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.conf.Configuration.getClass(Configuration.java:2712) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.security.Groups.&amp;lt;init&amp;gt;(Groups.java:107) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.security.Groups.&amp;lt;init&amp;gt;(Groups.java:102) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.security.Groups.getUserToGroupsMappingService(Groups.java:451) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.security.UserGroupInformation.initialize(UserGroupInformation.java:338) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.security.UserGroupInformation.ensureInitialized(UserGroupInformation.java:300) ~[?:?]
	at org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop.security.UserGroupInformation.getCurrentUser(UserGroupInformation.java:575) ~[?:?]
	at com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemBase.getUgiUserName(GoogleHadoopFileSystemBase.java:1226) ~[?:?]
	at com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemBase.listStatus(GoogleHadoopFileSystemBase.java:858) ~[?:?]
	at org.apache.flink.fs.gs.org.apache.flink.runtime.fs.hdfs.HadoopFileSystem.listStatus(HadoopFileSystem.java:170) ~[?:?] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Observations&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;While using File system as a HA path and GCS as checkpointing directory the job is able to write checkpoints to GCS checkpoint path.&#160;&lt;/p&gt;

&lt;p&gt;After debugging what I found was all the&#160;&lt;b&gt;org.apache.hadoop&lt;/b&gt;&#160;paths are shaded to&#160;&lt;b&gt;org.apache.flink.fs.shaded.hadoop3.org&lt;/b&gt;&lt;b&gt;.apache.hadoop&lt;/b&gt;. Ideally the code should look for&#160;&#160;&lt;b&gt;org.apache.flink.fs.shaded.hadoop3.org&lt;/b&gt;&lt;b&gt;.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback&lt;/b&gt;&#160;instead of&#160;&#160;&lt;b&gt;org.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback.&lt;/b&gt;&lt;br/&gt;
I think it is not getting shaded over here due to reflection being used here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-3.3.4/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/Groups.java#L108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-3.3.4/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/Groups.java#L108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As a workaround I rebuilt &lt;b&gt;flink-gs-fs-hadoop&lt;/b&gt; plugin removing this relocation and it worked for me.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;relocation&amp;gt;
&amp;lt;pattern&amp;gt;org.apache.hadoop&amp;lt;/pattern&amp;gt;
&amp;lt;shadedPattern&amp;gt;org.apache.flink.fs.shaded.hadoop3.org.apache.hadoop&amp;lt;/shadedPattern&amp;gt;
&amp;lt;/relocation&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Flink Kuberenetes operator: 1.4&lt;/p&gt;

&lt;p&gt;Flink version: 1.17&lt;/p&gt;

&lt;p&gt;GKE Kubernetes cluster.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13530050">FLINK-31612</key>
            <summary>ClassNotFoundException when using GCS path as HA directory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="martijnvisser">Martijn Visser</assignee>
                                    <reporter username="mohit.aggarwal">Mohit Aggarwal</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 25 Mar 2023 08:13:37 +0000</created>
                <updated>Tue, 28 Mar 2023 14:32:41 +0000</updated>
                            <resolved>Tue, 28 Mar 2023 14:32:41 +0000</resolved>
                                    <version>1.17.0</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.17.1</fixVersion>
                                    <component>FileSystems</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17705148" author="czchen" created="Mon, 27 Mar 2023 01:30:23 +0000"  >&lt;p&gt;The following information are from slack:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;From Ta-Chun in slack, this is possible caused by &lt;a href=&quot;https://github.com/apache/flink/pull/21318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/21318&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;From Jessy, this issue alsp happens in Azure blob storage and ADLS.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17705235" author="martijnvisser" created="Mon, 27 Mar 2023 08:18:59 +0000"  >&lt;p&gt;I&apos;ll check with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; on this&lt;/p&gt;</comment>
                            <comment id="17705237" author="zentol" created="Mon, 27 Mar 2023 08:25:01 +0000"  >&lt;p&gt;The problem is that the azure/gs filesystems still relocated hadoop which isn&apos;t required anymore.&lt;/p&gt;</comment>
                            <comment id="17705301" author="martijnvisser" created="Mon, 27 Mar 2023 11:12:28 +0000"  >&lt;p&gt;Could those who are running into this problem validate that this is resolved when using &lt;a href=&quot;https://github.com/apache/flink/pull/22279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/22279&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17705738" author="czchen" created="Tue, 28 Mar 2023 01:05:18 +0000"  >&lt;p&gt;We have confirmed this PR can fix GCS backend problem.&lt;/p&gt;</comment>
                            <comment id="17705899" author="martijnvisser" created="Tue, 28 Mar 2023 09:14:24 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;

&lt;p&gt;master: 3924ba85e62f04a0a181007d573cb84e3c09a636&lt;br/&gt;
release-1.17: 52a2b98bb5af842633df0c051b5da95d437a6b2f&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1gui0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>