<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:46:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17386] Exception in HadoopSecurityContextFactory.createContext while no shaded-hadoop-lib provided.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17386</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;java.io.IOException: Process execution failed due error. Error output:java.lang.NoClassDefFoundError: Could not initialize class org.apache.hadoop.security.UserGroupInformation\n\tat org.apache.flink.runtime.security.contexts.HadoopSecurityContextFactory.createContext(HadoopSecurityContextFactory.java:59)\n\tat org.apache.flink.runtime.security.SecurityUtils.installContext(SecurityUtils.java:92)\n\tat org.apache.flink.runtime.security.SecurityUtils.install(SecurityUtils.java:60)\n\tat org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:964)\n\n\tat com.alibaba.flink.vvr.util.AutoClosableProcess$AutoClosableProcessBuilder.runBlocking(AutoClosableProcess.java:144)\n\tat com.alibaba.flink.vvr.util.AutoClosableProcess$AutoClosableProcessBuilder.runBlocking(AutoClosableProcess.java:126)\n\tat com.alibaba.flink.vvr.VVRCompileTest.runSingleJobCompileCheck(VVRCompileTest.java:173)\n\tat com.alibaba.flink.vvr.VVRCompileTest.lambda$runJobsCompileCheck$0(VVRCompileTest.java:101)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1147)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:622)\n\tat java.lang.Thread.run(Thread.java:834)&lt;/p&gt;

&lt;p&gt;I think it is because exception throw in the static code block of UserInformation, we should catch Throwable instead of Exception in HadoopSecurityContextFactory#createContext?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rongr&quot; class=&quot;user-hover&quot; rel=&quot;rongr&quot;&gt;rongr&lt;/a&gt; what do you think?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13301021">FLINK-17386</key>
            <summary>Exception in HadoopSecurityContextFactory.createContext while no shaded-hadoop-lib provided.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rongr">Rong Rong</assignee>
                                    <reporter username="wenlong.lwl">Wenlong Lyu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 26 Apr 2020 04:19:49 +0000</created>
                <updated>Fri, 16 Oct 2020 10:35:44 +0000</updated>
                            <resolved>Sun, 17 May 2020 23:33:54 +0000</resolved>
                                    <version>1.11.0</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17092732" author="rongr" created="Sun, 26 Apr 2020 14:28:52 +0000"  >&lt;p&gt;could you provide more information on how to reproduce this exception?&lt;/p&gt;

&lt;p&gt;From what I understand you do want to use shaded-hadoop-lib but somehow forgot to include in the classpath. and your intention is to allow graceful shutdown instead of a hard process exit. correct?&lt;/p&gt;</comment>
                            <comment id="17094097" author="wenlong.lwl" created="Tue, 28 Apr 2020 02:18:08 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rongr&quot; class=&quot;user-hover&quot; rel=&quot;rongr&quot;&gt;rongr&lt;/a&gt;, I don&apos;t want shaded-hadoop-lib in the lib, because I didn&apos;t want to submit job to yarn. I did more investigation on this issue, found that it is because there is a customized state backend in the lib which is designed to support write to hdfs and contains some of hadoop libs but not all. The root cause is that: the security loader only check whether Configuration and UserGroupInformation is in classpath or not, which may cause the exception above when no enough lib is in the lib dir.&lt;/p&gt;</comment>
                            <comment id="17094149" author="rongr" created="Tue, 28 Apr 2020 04:44:45 +0000"  >&lt;p&gt;hmm. interesting. &lt;br/&gt;
Just to understand more clearer, you are actually using some sort of hadoop functionality but not &lt;tt&gt;flink-shaded-hadoop-*&lt;/tt&gt; module. correct? that causes Flink to falsely think it should use HadoopSecurityContext but it shouldn&apos;t. &lt;/p&gt;

&lt;p&gt; however the exception said:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; execution failed due error. Error output:java.lang.NoClassDefFoundError: Could not initialize &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.hadoop.security.UserGroupInformation
org.apache.flink.runtime.security.contexts.HadoopSecurityContextFactory.createContext(HadoopSecurityContextFactory.java:59)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so this means you are somehow including hadoop but not the hadoop-common? &lt;/p&gt;</comment>
                            <comment id="17094152" author="rongr" created="Tue, 28 Apr 2020 04:46:48 +0000"  >&lt;p&gt;I might have some idea on why this is happening. but just to be sure: is this issue occurring only to the latest unreleased flink? or does it also affects previous version (I bet it does, but if you can verify that would be great).&lt;/p&gt;
</comment>
                            <comment id="17094218" author="wenlong.lwl" created="Tue, 28 Apr 2020 07:06:33 +0000"  >&lt;p&gt;yes, you are right about the use case. We are doing some testing based on the master branch, I can do a test on 1.10, and feed back later.&lt;/p&gt;</comment>
                            <comment id="17094235" author="wenlong.lwl" created="Tue, 28 Apr 2020 07:23:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rongr&quot; class=&quot;user-hover&quot; rel=&quot;rongr&quot;&gt;rongr&lt;/a&gt; I run a quick test by copy the statebackend to the lib of 1.10 and run a flink command, no error happen.&lt;/p&gt;</comment>
                            <comment id="17094595" author="rongr" created="Tue, 28 Apr 2020 15:17:25 +0000"  >&lt;p&gt;I just create a quick fix for this and attach a PR. If you could help testing the patch later that would be super great!. Thx&lt;/p&gt;</comment>
                            <comment id="17096232" author="wenlong.lwl" created="Thu, 30 Apr 2020 06:58:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rongr&quot; class=&quot;user-hover&quot; rel=&quot;rongr&quot;&gt;rongr&lt;/a&gt; I have verified the patch, it works.&lt;/p&gt;</comment>
                            <comment id="17109703" author="rongr" created="Sun, 17 May 2020 23:33:43 +0000"  >&lt;p&gt;closed via: 1892bedeea9fa118b6e3bcb572f63c2e7f6d83e3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0e2r4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>