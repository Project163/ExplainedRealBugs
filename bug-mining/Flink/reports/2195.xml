<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8242] ClassCastException in OrcTableSource.toOrcPredicate</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8242</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;OrcTableSource&lt;/tt&gt; tries to cast all predicate literals to &lt;tt&gt;Serializable&lt;/tt&gt; in its &lt;tt&gt;toOrcPredicate()&lt;/tt&gt; method. This fails with a &lt;tt&gt;ClassCastException&lt;/tt&gt; if a literal is not serializable.&lt;/p&gt;

&lt;p&gt;Instead of failing, we should ignore the predicate and log a WARN message.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13124337">FLINK-8242</key>
            <summary>ClassCastException in OrcTableSource.toOrcPredicate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fhueske">Fabian Hueske</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Dec 2017 11:00:07 +0000</created>
                <updated>Thu, 28 Feb 2019 13:45:59 +0000</updated>
                            <resolved>Mon, 5 Feb 2018 16:22:52 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>API / DataSet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16336382" author="githubbot" created="Tue, 23 Jan 2018 21:14:49 +0000"  >&lt;p&gt;GitHub user fhueske opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8242&quot; title=&quot;ClassCastException in OrcTableSource.toOrcPredicate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8242&quot;&gt;&lt;del&gt;FLINK-8242&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix predicate push-down of OrcTableSource&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;Fix `ClassClassException` in `OrcTableSource` caused by hard cast to `Serializable`&lt;/li&gt;
	&lt;li&gt;Fix translation of Calcite literals with `NlString`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;add check to `OrcTableSource` before casting to `Serializable`&lt;/li&gt;
	&lt;li&gt;add logging to `OrcTableSource` for predicate push-down&lt;/li&gt;
	&lt;li&gt;add fallback for Calcite literal translation for `NlString` literals&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;adds a test to `OrcTableSourceTest.testApplyPredicate()`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;n/a&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/fhueske/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fhueske/flink&lt;/a&gt; orcPushDown&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5345&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 796deed1fe6372ca2eafc1f3b08387b7f29d5841&lt;br/&gt;
Author: Fabian Hueske &amp;lt;fhueske@...&amp;gt;&lt;br/&gt;
Date:   2017-12-12T21:38:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8242&quot; title=&quot;ClassCastException in OrcTableSource.toOrcPredicate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8242&quot;&gt;&lt;del&gt;FLINK-8242&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;orc&amp;#93;&lt;/span&gt; Fix predicate translation if literal is not Serializable.&lt;/p&gt;

&lt;p&gt;commit 07b8fe1eaf68e175c963048980809a4ce4605643&lt;br/&gt;
Author: Fabian Hueske &amp;lt;fhueske@...&amp;gt;&lt;br/&gt;
Date:   2018-01-23T21:10:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8242&quot; title=&quot;ClassCastException in OrcTableSource.toOrcPredicate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8242&quot;&gt;&lt;del&gt;FLINK-8242&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; RexProgramExtractor convert NlsString literal always into String.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16337413" author="githubbot" created="Wed, 24 Jan 2018 11:12:05 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345#discussion_r163517596&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345#discussion_r163517596&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/util/RexProgramExtractor.scala &amp;#8212;&lt;br/&gt;
    @@ -214,6 +213,10 @@ class RexNodeToExpressionConverter(&lt;br/&gt;
             // convert to BigDecimal&lt;br/&gt;
             literal.getValueAs(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;java.math.BigDecimal&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;    +      case _ if literal.getValue.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;NlsString&amp;#93;&lt;/span&gt; =&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should not be necessary because it is already done line 204. All tests are still working if I remove this change.&lt;/p&gt;</comment>
                            <comment id="16340909" author="githubbot" created="Fri, 26 Jan 2018 11:02:10 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345#discussion_r164084612&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345#discussion_r164084612&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/util/RexProgramExtractor.scala &amp;#8212;&lt;br/&gt;
    @@ -214,6 +213,10 @@ class RexNodeToExpressionConverter(&lt;br/&gt;
             // convert to BigDecimal&lt;br/&gt;
             literal.getValueAs(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;java.math.BigDecimal&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;    +      case _ if literal.getValue.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;NlsString&amp;#93;&lt;/span&gt; =&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes, you are right. This case should not have happened but was reported by a user.&lt;/p&gt;

&lt;p&gt;    Since the Rex translation is only used for predicate push-down, we could play safe and drop the catch-all case at the end and write a debug statement that includes the value and type of the unsupported literal. Most TableSources with predicate push-down support will only support simple predicates anyway.&lt;/p&gt;</comment>
                            <comment id="16340914" author="githubbot" created="Fri, 26 Jan 2018 11:05:00 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @twalthr.&lt;br/&gt;
    I&apos;ve updated the PR.&lt;/p&gt;</comment>
                            <comment id="16348411" author="githubbot" created="Thu, 1 Feb 2018 11:09:50 +0000"  >&lt;p&gt;Github user twalthr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you @fhueske. The code looks good now. I will merge this...&lt;/p&gt;</comment>
                            <comment id="16352234" author="githubbot" created="Mon, 5 Feb 2018 10:50:49 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging&lt;/p&gt;</comment>
                            <comment id="16352601" author="githubbot" created="Mon, 5 Feb 2018 16:19:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5345&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16352609" author="fhueske" created="Mon, 5 Feb 2018 16:22:52 +0000"  >&lt;p&gt;Fixed for 1.4.1 with 19fcd5ebadabdebc4d56716920937f229f06f5d3&lt;br/&gt;
Fixed for 1.5.0 with 63a19e879bfb4c4981f151e7b50481df094dcb09&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nssn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>