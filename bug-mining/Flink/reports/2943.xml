<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:39:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11972] The classpath is missing the `flink-shaded-hadoop2-uber-2.8.3-1.8.0.jar` JAR during the end-to-end test.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11972</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Since the difference between 1.8.0 and 1.7.x is that 1.8.x does not put the `hadoop-shaded` JAR integrated into the dist.&#160; It will cause an error when the end-to-end test cannot be found with `Hadoop` Related classes,&#160; such as: `java.lang.NoClassDefFoundError: Lorg/apache/hadoop/fs/FileSystem`. So we need to improve the end-to-end test script, or explicitly stated in the README, i.e. end-to-end test need to add `flink-shaded-hadoop2-uber-XXXX.jar` to the classpath. So, we will get the exception something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] 3 instance(s) of taskexecutor are already running on jinchengsunjcs-iMac.local.

Starting taskexecutor daemon on host jinchengsunjcs-iMac.local.

java.lang.NoClassDefFoundError: Lorg/apache/hadoop/fs/FileSystem;

at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredFields0(Native Method)

at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.privateGetDeclaredFields(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2583)

at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredFields(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:1916)

at org.apache.flink.api.java.ClosureCleaner.clean(ClosureCleaner.java:72)

at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.clean(StreamExecutionEnvironment.java:1558)

at org.apache.flink.streaming.api.datastream.DataStream.clean(DataStream.java:185)

at org.apache.flink.streaming.api.datastream.DataStream.addSink(DataStream.java:1227)

at org.apache.flink.streaming.tests.BucketingSinkTestProgram.main(BucketingSinkTestProgram.java:80)

at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)

at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)

at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)

at java.lang.reflect.Method.invoke(Method.java:498)

at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:529)

at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:421)

at org.apache.flink.client.program.ClusterClient.run(ClusterClient.java:423)

at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:813)

at org.apache.flink.client.cli.CliFrontend.runProgram(CliFrontend.java:287)

at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:213)

at org.apache.flink.client.cli.CliFrontend.parseParameters(CliFrontend.java:1050)

at org.apache.flink.client.cli.CliFrontend.lambda$main$11(CliFrontend.java:1126)

at org.apache.flink.runtime.security.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:30)

at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1126)

Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.fs.FileSystem

at java.net.URLClassLoader.findClass(URLClassLoader.java:381)

at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:424)

at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)

... 22 more

Job () is running.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, I think we can import the test script or improve the README.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13222738">FLINK-11972</key>
            <summary>The classpath is missing the `flink-shaded-hadoop2-uber-2.8.3-1.8.0.jar` JAR during the end-to-end test.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyu">Yu Li</assignee>
                                    <reporter username="sunjincheng121">sunjincheng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 20 Mar 2019 06:02:33 +0000</created>
                <updated>Thu, 21 Mar 2019 12:23:10 +0000</updated>
                            <resolved>Thu, 21 Mar 2019 07:51:26 +0000</resolved>
                                    <version>1.8.0</version>
                    <version>1.9.0</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16796935" author="carp84" created="Wed, 20 Mar 2019 08:55:59 +0000"  >&lt;p&gt;+1 on improving. Encountered the same issue in local Mac environment when verifying 1.8.0 rc1.&lt;/p&gt;</comment>
                            <comment id="16797504" author="carp84" created="Wed, 20 Mar 2019 20:01:37 +0000"  >&lt;p&gt;There&apos;s another necessity to run the &lt;tt&gt;test_streaming_bucketing.sh&lt;/tt&gt; case, that we must make sure to run &lt;tt&gt;mvn install&lt;/tt&gt; in the flink-end-to-end-tests directory, below are more detailed reason:&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;test_streaming_bucketing.sh&lt;/tt&gt; the command to submit job and get job id is like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TEST_PROGRAM_JAR=${END_TO_END_DIR}/flink-bucketing-sink-test/target/BucketingSinkTestProgram.jar
...
JOB_ID=$($FLINK_DIR/bin/flink run -d -p 4 $TEST_PROGRAM_JAR -outputPath $TEST_DATA_DIR/out/result \
  | grep &quot;Job has been submitted with JobID&quot; | sed &apos;s/.* //g&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And the &lt;tt&gt;TEST_PROGRAM_JAR&lt;/tt&gt; need to be generated by install and won&apos;t be there by default. In this case, the result of the job submission command will be something like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Could not build the program from JAR file.

Use the help option (-h or --help) to get help on the command.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thus the grep will get nothing, so job id is empty and the script will hang at the &lt;tt&gt;wait_job_running&lt;/tt&gt; phase, with some log like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Job () is running.
Waiting for job () to have at least 5 completed checkpoints ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will add the notice to document, and also try to improve the script to do logging and fast fail if the target jar is missing.&lt;/p&gt;</comment>
                            <comment id="16797524" author="sunjincheng121" created="Wed, 20 Mar 2019 20:31:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;carp84&lt;/a&gt; Thanks for your feedback! and do the deep testing!  I appreciate if you want to take this ticket and fix all of them?&lt;/p&gt;</comment>
                            <comment id="16797528" author="carp84" created="Wed, 20 Mar 2019 20:36:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;I appreciate if you want to take this ticket and fix all of them?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure, let me take this one. Find one more possible issue and locating the root cause now, will submit a PR once done. Thanks. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16797561" author="sunjincheng121" created="Wed, 20 Mar 2019 20:53:42 +0000"  >&lt;p&gt;Sounds good!&lt;/p&gt;</comment>
                            <comment id="16797614" author="carp84" created="Wed, 20 Mar 2019 22:17:02 +0000"  >&lt;p&gt;I tried the streaming bucket case on two environments, Mac 10.14.3 and Linux 3.10.0, both failed. I&apos;m running the test with the shaded hadoop 2.8.3 bundle which could be downloaded &lt;a href=&quot;https://repository.apache.org/content/repositories/orgapacheflink-1213/org/apache/flink/flink-shaded-hadoop2-uber/2.8.3-1.8.0/flink-shaded-hadoop2-uber-2.8.3-1.8.0.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. It seems to me like a real issue instead of environment problem, and I think we need to further investigate into it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From the output of the test script, we could see below messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Starting taskexecutor daemon on host z05f06378.sqa.zth.
Waiting for job (905ae10bae4b99031e724b9c29f0ca7b) to reach terminal state FINISHED ...
Truncating buckets
Truncating  to
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And in standalonesession log, we could confirm the job is finished:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2019-03-21 05:59:59,512 INFO  org.apache.flink.runtime.dispatcher.StandaloneDispatcher      - Job 905ae10bae4b99031e724b9c29f0ca7b reached globally terminal state FINISHED.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Checking the &lt;tt&gt;test_streaming_bucketing.sh&lt;/tt&gt; script, we could see it runs to below lines:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;LOG_LINES=$(grep -rnw $FLINK_DIR/log -e &apos;Writing valid-length file&apos;)

# perform truncate on every line
echo &quot;Truncating buckets&quot;
while read -r LOG_LINE; do
  PART=$(echo &quot;$LOG_LINE&quot; | awk &apos;{ print $10 }&apos; FS=&quot; &quot;)
  LENGTH=$(echo &quot;$LOG_LINE&quot; | awk &apos;{ print $15 }&apos; FS=&quot; &quot;)

  echo &quot;Truncating $PART to $LENGTH&quot;

  dd if=$PART of=&quot;$PART.truncated&quot; bs=$LENGTH count=1
  rm $PART
  mv &quot;$PART.truncated&quot; $PART
done &amp;lt;&amp;lt;&amp;lt; &quot;$LOG_LINES&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, when trying to grep the &quot;Writing valid-length file&quot; message in log dir, &lt;b&gt;nothing appeared&lt;/b&gt;. Checking the task-executor log, observed something suspicious:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2019-03-21 05:59:59,486 DEBUG org.apache.flink.streaming.connectors.fs.bucketing.BucketingSink  - Moving in-progress bucket /home/jueding.ly/flink_rc_check/flink-1.8.0-src/flink-end-to-end-tests/test-scripts/temp-test-directory-53249980906/out/result4/_part-0-1.in-progress to pending file /home/jueding.ly/flink_rc_check/flink-1.8.0-src/flink-end-to-end-tests/test-scripts/temp-test-directory-53249980906/out/result4/_part-0-1.pending
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16797646" author="carp84" created="Wed, 20 Mar 2019 23:19:42 +0000"  >&lt;p&gt;Checked and confirmed with hadoop 2.6.5 the same test passed in both environment, either the &lt;a href=&quot;https://repository.apache.org/content/repositories/orgapacheflink-1213/org/apache/flink/flink-shaded-hadoop2-uber/2.6.5-1.8.0/flink-shaded-hadoop2-uber-2.6.5-1.8.0.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;shaded bundle &lt;/a&gt; or &lt;a href=&quot;http://archive.apache.org/dist/hadoop/core/hadoop-2.6.5/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hadoop dist&lt;/a&gt; way.&lt;/p&gt;

&lt;p&gt;Output of the script in the passing state:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Truncating /home/jueding.ly/flink_rc_check/flink-1.8.0-src/flink-end-to-end-tests/test-scripts/temp-test-directory-06210353709/out/result3/part-3-0 to 51250
1+0 records in
1+0 records out
51250 bytes (51 kB) copied, 0.000377998 s, 136 MB/s
Truncating /home/jueding.ly/flink_rc_check/flink-1.8.0-src/flink-end-to-end-tests/test-scripts/temp-test-directory-06210353709/out/result7/part-3-0 to 51250
1+0 records in
1+0 records out
51250 bytes (51 kB) copied, 0.00033118 s, 155 MB/s
pass Bucketing Sink
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16797896" author="sunjincheng121" created="Thu, 21 Mar 2019 07:51:27 +0000"  >&lt;p&gt;Fixed in master: 40fe63c5057a9388559c90b75e45ac24a1a387d0&lt;br/&gt;
Fixed in release-1.8: a1a864765bc95f8ae0e4e75b575820b3fcc9a6db&lt;/p&gt;</comment>
                            <comment id="16797899" author="sunjincheng121" created="Thu, 21 Mar 2019 07:53:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;carp84&lt;/a&gt; I have close this JIRA due to you already fix the current JIRA. So feel free to open new JIRA if you find some new bugs. &lt;/p&gt;</comment>
                            <comment id="16797915" author="carp84" created="Thu, 21 Mar 2019 08:21:14 +0000"  >&lt;p&gt;Sure, let me open a&#160;JIRA for the left over issue. Thanks. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12963185" name="image-2019-03-21-06-26-49-787.png" size="394204" author="sunjincheng121" created="Wed, 20 Mar 2019 22:27:02 +0000"/>
                            <attachment id="12963187" name="screenshot-1.png" size="340941" author="sunjincheng121" created="Wed, 20 Mar 2019 22:30:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z00w1k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Add necessary notes about running streaming bucketing end-to-end test in README</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>