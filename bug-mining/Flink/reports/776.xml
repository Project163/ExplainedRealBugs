<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3256] Invalid execution graph cleanup for jobs with colocation groups</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3256</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, upon restarting an execution graph, we clean-up the colocation constraints for each group present in an ExecutionJobVertex respectively.&lt;/p&gt;

&lt;p&gt;This can lead to invalid reconfiguration upon a restart or any other activity that relies on state cleanup of the execution graph. For example, upon restarting a DataStream job with iterations the following steps are executed:&lt;/p&gt;

&lt;p&gt;1) IterationSource colgroup constraints are reset&lt;br/&gt;
2) IterationSource execution vertices reset and create new colocation constraints&lt;br/&gt;
3) IterationSink colgroup constraints are reset&lt;br/&gt;
4) IterationSink execution vertices reset and create different colocation constraints.&lt;/p&gt;

&lt;p&gt;This can be trivially fixed by reseting colocation groups independently from ExecutionJobVertices, thus, updating them once per reconfiguration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12932213">FLINK-3256</key>
            <summary>Invalid execution graph cleanup for jobs with colocation groups</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="senorcarbone">Paris Carbone</assignee>
                                    <reporter username="senorcarbone">Paris Carbone</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jan 2016 18:51:40 +0000</created>
                <updated>Wed, 10 Feb 2016 10:00:13 +0000</updated>
                            <resolved>Mon, 25 Jan 2016 15:51:21 +0000</resolved>
                                                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15108548" author="githubbot" created="Wed, 20 Jan 2016 13:34:52 +0000"  >&lt;p&gt;GitHub user senorcarbone opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3256&quot; title=&quot;Invalid execution graph cleanup for jobs with colocation groups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3256&quot;&gt;&lt;del&gt;FLINK-3256&lt;/del&gt;&lt;/a&gt; Fix colocation group re-instantiation&lt;/p&gt;

&lt;p&gt;    This PR deals with the problem of inconsistent colocation groups upon reconfiguration. The problem was that we were removing shared constraints multiple times for each ExecutionJobVertex, thus, colocated vertices, in the same co-location group, ended up being scheduled with different constraints leading to wrong redeployment.&lt;/p&gt;

&lt;p&gt;    To deal with it we keep all distinct colocation groups in the execution graph and reset them once outside the individual ExecutionJobVertex re-instantiation. There is also a new test that is used to check whether certain properties are consistent after reconfiguration. We can potentially add more properties in the same test to ensure that they are also maintained upon reconfiguration.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/senorcarbone/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/senorcarbone/flink&lt;/a&gt; egfix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1526&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a8f24b5003885596f48eaa73b24b94dfbc5380e6&lt;br/&gt;
Author: Paris Carbone &amp;lt;parisc@kth.se&amp;gt;&lt;br/&gt;
Date:   2016-01-20T02:03:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3256&quot; title=&quot;Invalid execution graph cleanup for jobs with colocation groups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3256&quot;&gt;&lt;del&gt;FLINK-3256&lt;/del&gt;&lt;/a&gt; Fix colocation group re-instantiation&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15108743" author="githubbot" created="Wed, 20 Jan 2016 15:35:36 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526#issuecomment-173240931&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526#issuecomment-173240931&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for fixing this, looks like a good issue!&lt;/p&gt;

&lt;p&gt;    One suggestion for a change: Rather than collecting the CoLocationGroups in an extra set in the ExecutionGraph, can you iterate over the ExecutionJobvertices and simply reset them there?&lt;/p&gt;

&lt;p&gt;    I think each field less on the ExecutionGraph makes this simpler to maintain and more future-proof.&lt;/p&gt;</comment>
                            <comment id="15108834" author="githubbot" created="Wed, 20 Jan 2016 16:26:25 +0000"  >&lt;p&gt;Github user senorcarbone commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526#issuecomment-173260776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526#issuecomment-173260776&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sure, I will do it on the fly. Thanks for checking it!&lt;/p&gt;</comment>
                            <comment id="15110610" author="githubbot" created="Thu, 21 Jan 2016 13:52:32 +0000"  >&lt;p&gt;Github user senorcarbone commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526#issuecomment-173575376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526#issuecomment-173575376&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I removed the groups from the ExecutionGraph. Hope it&apos;s good now.&lt;/p&gt;</comment>
                            <comment id="15115097" author="githubbot" created="Mon, 25 Jan 2016 12:04:24 +0000"  >&lt;p&gt;Github user senorcarbone commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526#issuecomment-174486113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526#issuecomment-174486113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I guess this fix ok to merge. Any objections?&lt;/p&gt;</comment>
                            <comment id="15115260" author="githubbot" created="Mon, 25 Jan 2016 14:22:22 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526#issuecomment-174521559&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526#issuecomment-174521559&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good, +1 to merge!&lt;/p&gt;</comment>
                            <comment id="15115427" author="githubbot" created="Mon, 25 Jan 2016 15:48:21 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1526&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1526&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rngn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>