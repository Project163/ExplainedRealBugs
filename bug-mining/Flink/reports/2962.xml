<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:39:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10941] Slots prematurely released which still contain unconsumed data </title>
                <link>https://issues.apache.org/jira/browse/FLINK-10941</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Our case is: Flink 1.5 batch mode, 32 parallelism to read data source and 4&#160;parallelism to write data sink.&lt;br/&gt;
&#160;&lt;br/&gt;
The read task worked perfectly with 32 TMs. However when the job was executing the write task, since only 4 TMs were needed, other 28 TMs were released. This caused&#160;RemoteTransportException in the write task:&lt;br/&gt;
&#160;&lt;br/&gt;
org.apache.flink.runtime.io.network.netty.exception.RemoteTransportException: Connection unexpectedly closed by remote task manager &#8217;the_previous_TM_used_by_read_task&apos;. This might indicate that the remote task manager was lost.&lt;br/&gt;
	at org.apache.flink.runtime.io.network.netty.PartitionRequestClientHandler.channelInactive(PartitionRequestClientHandler.java:133)&lt;br/&gt;
	at org.apache.flink.shaded.netty4.io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:237)&lt;br/&gt;
	...&lt;br/&gt;
&#160;&lt;br/&gt;
After skimming YarnFlinkResourceManager related code, it seems to me that Flink is releasing TMs when they&#8217;re idle, regardless of whether working TMs need them.&lt;br/&gt;
&#160;&lt;br/&gt;
Put in another way,&#160;Flink seems to&#160;prematurely release slots which contain unconsumed data and, thus, eventually release a TM which then fails a consuming task.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13199510">FLINK-10941</key>
            <summary>Slots prematurely released which still contain unconsumed data </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="azagrebin">Andrey Zagrebin</assignee>
                                    <reporter username="QiLuo">Qi</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 20 Nov 2018 05:04:36 +0000</created>
                <updated>Thu, 4 Jul 2019 08:55:52 +0000</updated>
                            <resolved>Fri, 19 Apr 2019 08:52:46 +0000</resolved>
                                    <version>1.5.5</version>
                    <version>1.6.2</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.7.3</fixVersion>
                    <fixVersion>1.8.1</fixVersion>
                    <fixVersion>1.9.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16692744" author="aroch" created="Tue, 20 Nov 2018 06:59:38 +0000"  >&lt;p&gt;Saw same issue with Flink 1.5.4. Job fails with same symptoms.&#160;&lt;/p&gt;</comment>
                            <comment id="16692890" author="qiluo" created="Tue, 20 Nov 2018 09:10:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&#160;mentioned that&#160;increasing the slot idle timeout: `slot.idle.timeout: 1800000` can serve as a&#160;temporary workaround.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt;&#160;per your previous email&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, an external shuffle service may help resolve this issue. Could you share more updates on that? Or do you happen to know any other solution to this issue? Thank you!&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/flink-dev/201808.mbox/%3C7605d978-d22b-4f5d-a831-89d7d59c5fdd.wangzhijiang999@aliyun.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/flink-dev/201808.mbox/%3C7605d978-d22b-4f5d-a831-89d7d59c5fdd.wangzhijiang999@aliyun.com%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16692945" author="till.rohrmann" created="Tue, 20 Nov 2018 09:37:22 +0000"  >&lt;p&gt;I think the underlying problem is that the &lt;tt&gt;JobMaster&lt;/tt&gt; prematurely releases slots even though they still contain unconsumed data. The idea is that resources (e.g. produced data) are bound to the lifecycle of a slot. Once the slot is released, it is safe to use the slots resources for something else (or release the underlying TM).&lt;/p&gt;

&lt;p&gt;At the moment, the slot is considered being used as long as the deployed &lt;tt&gt;Task&lt;/tt&gt; has not finished. Once the &lt;tt&gt;Task&lt;/tt&gt; finishes, the slot is being freed and if not used for some time (idle timeout), it will be released. Thus, one solution to tackle this problem would be to let the &lt;tt&gt;Task&lt;/tt&gt; only go into a terminal state if its intermediate results have been persisted (e.g. committed to an external shuffle service) or if its ephemeral data has been consumed.&lt;/p&gt;</comment>
                            <comment id="16692996" author="zjwang" created="Tue, 20 Nov 2018 10:08:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=QiLuo&quot; class=&quot;user-hover&quot; rel=&quot;QiLuo&quot;&gt;QiLuo&lt;/a&gt;, thank you for remembering the external shuffle issue. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I agree with above comments from&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;Currently the lifecycle of task and its output consumption is not strictly consistent. We can establish the relationship accordingly.&lt;/p&gt;

&lt;p&gt;For internal shuffle, the &lt;tt&gt;TaskManager&lt;/tt&gt; should not be released if there are still output data under shuffle. To do so, one way is to wait all the memory output&#160;transported completely or persist output before task enters &lt;tt&gt;FINISHED&lt;/tt&gt; state.&lt;/p&gt;

&lt;p&gt;For external shuffle, the task can enters &lt;tt&gt;FINISHED&lt;/tt&gt; state as current way and &lt;tt&gt;TaskManager&lt;/tt&gt;&#160;can also exit as long as the persistent outputs already registers to the external shuffle service.&lt;/p&gt;</comment>
                            <comment id="16693026" author="qiluo" created="Tue, 20 Nov 2018 10:37:59 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; for following up on this!&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt; I&apos;ve looked into your&#160;Fine-grained Shuffle System design doc &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;and it looks good to me. Could you share its current progress, or is there an estimate timeline on the implementation? We may help on it since this issue is affecting our use cases.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;&lt;a href=&quot;https://docs.google.com/document/d/1Jb0Mf46ace-6cLRQxJzo6VNQQVxn3hwf9Zqmv5pcb34/edit#heading=h.c1pn7ttavhn3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.google.com/document/d/1Jb0Mf46ace-6cLRQxJzo6VNQQVxn3hwf9Zqmv5pcb34/edit#heading=h.c1pn7ttavhn3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16693079" author="zjwang" created="Tue, 20 Nov 2018 11:23:05 +0000"  >&lt;p&gt;Glad to hear you are also interested in it, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=QiLuo&quot; class=&quot;user-hover&quot; rel=&quot;QiLuo&quot;&gt;QiLuo&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We are now waiting for community&apos;s&#160;further feedbacks, then I will create sub-tasks for detail works. I think it will not delay too long, possible within this month to start.&lt;/p&gt;

&lt;p&gt;You can watch this umbrella Jira &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10653&quot; title=&quot;Introduce Pluggable Shuffle Service Architecture&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10653&quot;&gt;&lt;del&gt;FLINK-10653&lt;/del&gt;&lt;/a&gt;&#160;for the following updates. Welcome to contribute for this feature. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16694247" author="qiluo" created="Wed, 21 Nov 2018 05:13:44 +0000"  >&lt;p&gt;Thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt;! We will keep an eye on that.&lt;/p&gt;</comment>
                            <comment id="16701668" author="githubbot" created="Wed, 28 Nov 2018 10:28:16 +0000"  >&lt;p&gt;QiLuo-BD opened a new pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
   &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Contribution Checklist&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the pull request corresponds to a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/FLINK/issues&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/FLINK/issues&lt;/a&gt;). Exceptions are made for typos in JavaDoc or documentation files, which need no JIRA issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Name the pull request in the form &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXXX&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;component&amp;#93;&lt;/span&gt; Title of the pull request&quot;, where &lt;b&gt;FLINK-XXXX&lt;/b&gt; should be replaced by the actual issue number. Skip &lt;b&gt;component&lt;/b&gt; if you are unsure about which is the best component.&lt;br/&gt;
     Typo fixes that have no associated JIRA issue should be named following this pattern: `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Fix typo in event time introduction` or `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;javadocs&amp;#93;&lt;/span&gt; Expand JavaDoc for PuncuatedWatermarkGenerator`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fill out the template below to describe the changes contributed by the pull request. That will give reviewers the context they need to do the review.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the change passes the automated tests, i.e., `mvn clean verify` passes. You can set up Travis CI to do that following &lt;span class=&quot;error&quot;&gt;&amp;#91;this guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/contribute-code.html#best-practices&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/contribute-code.html#best-practices&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each pull request should address only one issue, not mix up code from multiple issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each commit in the pull request has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Once all items of the checklist are addressed, remove the above text and this checklist, leaving only the filled out template below.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;   *&lt;b&gt;(The sections below can be removed for hotfixes of typos)&lt;/b&gt;*&lt;br/&gt;
   --&amp;gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This PR fixes the issue described in &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; that slots will be prematurely released which still contain unconsumed data.&lt;/p&gt;

&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-10941&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add methods to determine whether tasks/slots/slot table can be released&lt;/li&gt;
	&lt;li&gt;Release reader in TM after confirming from writers&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change is already covered by existing tests, such as SlotManagerTest.&lt;/p&gt;

&lt;p&gt;   We load tested in 1000 TMs, and it worked as expected (TMs containing unconsumed RSs will not released. Once the RSs are consumed, TMs will be released after timeout.)&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: yes&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16701679" author="qiluo" created="Wed, 28 Nov 2018 10:33:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Before the external shuffle service is implemented, I want to fix this issue by checking whether Result Partitions in TMs are fully consumed before TM is releasing. I&apos;ve opened a PR and it works well in our Flink environment (tested&#160;in&#160;batch jobs with 1000 TMs).&lt;/p&gt;

&lt;p&gt;Could you kindly help review the PR to help fix this issue? Thank you!&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/flink/pull/7186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Qi&lt;/p&gt;</comment>
                            <comment id="16706846" author="githubbot" created="Mon, 3 Dec 2018 09:00:18 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238184515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238184515&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -869,6 +869,20 @@ else if (transitionState(current, ExecutionState.FAILED, t)) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * This task can only be safely released after all produced partitions are consumed.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean canBeReleased() {&lt;br/&gt;
+		for (ResultPartition producedPartition : producedPartitions) {&lt;br/&gt;
+			if (!producedPartition.isReleased()) {&lt;br/&gt;
+				LOG.debug(&quot;Task can NOT be released, execution ID {}&quot;, this.getExecutionId());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   remove this&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706847" author="githubbot" created="Mon, 3 Dec 2018 09:00:34 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238184584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238184584&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -869,6 +869,20 @@ else if (transitionState(current, ExecutionState.FAILED, t)) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * This task can only be safely released after all produced partitions are consumed.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean canBeReleased() {&lt;br/&gt;
+		for (ResultPartition producedPartition : producedPartitions) {&lt;br/&gt;
+			if (!producedPartition.isReleased()) {&lt;br/&gt;
+				LOG.debug(&quot;Task can NOT be released, execution ID {}&quot;, this.getExecutionId());&lt;br/&gt;
+				return false;&lt;br/&gt;
+			}&lt;br/&gt;
+		}&lt;br/&gt;
+		LOG.debug(&quot;Task can be released, execution ID {}&quot;, this.getExecutionId());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   remove this&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706852" author="githubbot" created="Mon, 3 Dec 2018 09:06:52 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238186331&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238186331&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -869,6 +869,20 @@ else if (transitionState(current, ExecutionState.FAILED, t)) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * This task can only be safely released after all produced partitions are consumed.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean canBeReleased() {&lt;br/&gt;
+		for (ResultPartition producedPartition : producedPartitions) {&lt;br/&gt;
+			if (!producedPartition.isReleased()) {&lt;br/&gt;
+				LOG.debug(&quot;Task can NOT be released, execution ID {}&quot;, this.getExecutionId());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Thanks Zhijiang. Why should this debug log be removed?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706863" author="githubbot" created="Mon, 3 Dec 2018 09:18:22 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238189903&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238189903&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/TaskExecutorGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -195,4 +195,10 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return Future which is completed with the 
{@link TransientBlobKey}
&lt;p&gt; of the uploaded file.&lt;br/&gt;
 	 */&lt;br/&gt;
 	CompletableFuture&amp;lt;TransientBlobKey&amp;gt; requestFileUpload(FileType fileType, @RpcTimeout Time timeout);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Checks whether this can be released. This cannot be released if there&apos;re unconsumed result partitions&lt;br/&gt;
+	 * @return whether this can be released&lt;br/&gt;
+	 */&lt;br/&gt;
+	boolean canBeReleased();&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I think it is better to take CompletableFuture as return type for handling timeout or failure properly.&lt;br/&gt;
   @tillrohrmann has the authority for this.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706866" author="githubbot" created="Mon, 3 Dec 2018 09:19:08 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238190172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238190172&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/TaskExecutor.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -254,6 +254,11 @@ public TaskExecutor(&lt;br/&gt;
 		this.currentRegistrationTimeoutId = null;&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	@Override&lt;br/&gt;
+	public boolean canBeReleased() {&lt;br/&gt;
+		return this.taskSlotTable.canBeReleased();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   remove this&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706871" author="githubbot" created="Mon, 3 Dec 2018 09:24:20 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238191840&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238191840&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/ResultPartition.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -377,6 +377,13 @@ public void releaseMemory(int toRelease) throws IOException {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * Whether this partition is released (all subpartitions are consumed).&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I think we do not need this comment because it is easy to understand or comment it in above variable `isReleased`?&lt;br/&gt;
   Canceling task can also enter released state and all subpartitions are not consumed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706874" author="githubbot" created="Mon, 3 Dec 2018 09:25:19 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238192176&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238192176&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/slot/TaskSlot.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -24,9 +24,13 @@&lt;br/&gt;
 import org.apache.flink.runtime.executiongraph.ExecutionAttemptID;&lt;br/&gt;
 import org.apache.flink.runtime.taskmanager.Task;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
+import org.slf4j.Logger;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   add whitespace line before this import, otherwise the travis would fail&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706876" author="githubbot" created="Mon, 3 Dec 2018 09:27:32 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238192891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238192891&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/slot/TaskSlotTable.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -275,6 +275,22 @@ public boolean markSlotInactive(AllocationID allocationId, Time slotTimeout) thr&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * This can be safely released if all slots can be released.&lt;br/&gt;
+	 * @return&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   remove @return?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706893" author="githubbot" created="Mon, 3 Dec 2018 09:40:01 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238197071&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238197071&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/PartitionRequestQueue.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -61,6 +62,9 @@&lt;br/&gt;
 	/** The readers which are already enqueued available for transferring data. */&lt;br/&gt;
 	private final ArrayDeque&amp;lt;NetworkSequenceViewReader&amp;gt; availableReaders = new ArrayDeque&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;p&gt;+	/** The readers are marked as to be closed, waiting for confirmation from writer side */&lt;br/&gt;
+	private final Set&amp;lt;NetworkSequenceViewReader&amp;gt; readersToClose = new HashSet&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This set should be cleared in failover cases such as channel inactive and exception caught. You can refer to the variable `availableReaders`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706921" author="githubbot" created="Mon, 3 Dec 2018 10:03:58 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238203555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238203555&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/PartitionRequestQueue.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -134,10 +138,17 @@ public void cancel(InputChannelID receiverId) &lt;/p&gt;
{
 		ctx.pipeline().fireUserEventTriggered(receiverId);
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void close() {&lt;br/&gt;
+	public void close() throws IOException {&lt;br/&gt;
 		if (ctx != null) 
{
 			ctx.channel().close();
 		}
&lt;p&gt;+&lt;br/&gt;
+		LOG.info(&quot;Close all {} readers pending for close.&quot;, readersToClose.size());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   If we rely on the close request for handling release logic, have you considered the scenarios of tcp channel shared by multiple tasks?&lt;br/&gt;
    In this case, if one downstream task have consumed all the upstream&apos;s data, but this tcp channel is also reused by other parallelism tasks, then the close request will not be sent until all the shared tasks are finished. Further in common sense, the sub partition can be released as along as network server has transported it completely, no need to wait all the inqueue buffers are processed completely by downstream side.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706924" author="githubbot" created="Mon, 3 Dec 2018 10:05:16 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238205948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238205948&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -869,6 +869,20 @@ else if (transitionState(current, ExecutionState.FAILED, t)) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * This task can only be safely released after all produced partitions are consumed.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean canBeReleased() {&lt;br/&gt;
+		for (ResultPartition producedPartition : producedPartitions) {&lt;br/&gt;
+			if (!producedPartition.isReleased()) {&lt;br/&gt;
+				LOG.debug(&quot;Task can NOT be released, execution ID {}&quot;, this.getExecutionId());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I mean removing `this` keyword. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;   this.getExecutionId() - &amp;gt; getExecutionId()&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706967" author="githubbot" created="Mon, 3 Dec 2018 10:39:40 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238217342&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238217342&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/PartitionRequestQueue.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -134,10 +138,17 @@ public void cancel(InputChannelID receiverId) &lt;/p&gt;
{
 		ctx.pipeline().fireUserEventTriggered(receiverId);
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void close() {&lt;br/&gt;
+	public void close() throws IOException {&lt;br/&gt;
 		if (ctx != null) 
{
 			ctx.channel().close();
 		}
&lt;p&gt;+&lt;br/&gt;
+		LOG.info(&quot;Close all {} readers pending for close.&quot;, readersToClose.size());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   If the partition is released once it&apos;s transported, then the TM containing the partition will be released. It will cause a RemoteTransportException &quot;Connection unexpectedly closed by remote task manager  ...&quot; in CreditBasedPartitionRequestClientHandler&apos;s channelInactive() method, as the Netty connection is shared between TMs.&lt;/p&gt;

&lt;p&gt;   So I changed this to let writer to close the readers when closing the Netty connection. This is the smallest possible change I can find. Do you have any suggestions how we can handle this case better?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16709805" author="githubbot" created="Wed, 5 Dec 2018 09:18:17 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238983295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238983295&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/PartitionRequestQueue.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -134,10 +138,17 @@ public void cancel(InputChannelID receiverId) &lt;/p&gt;
{
 		ctx.pipeline().fireUserEventTriggered(receiverId);
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void close() {&lt;br/&gt;
+	public void close() throws IOException {&lt;br/&gt;
 		if (ctx != null) 
{
 			ctx.channel().close();
 		}
&lt;p&gt;+&lt;br/&gt;
+		LOG.info(&quot;Close all {} readers pending for close.&quot;, readersToClose.size());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Sorry for late response because of a little busy these days.&lt;/p&gt;

&lt;p&gt;   I agree with your above comments. So whether the task executor can be released is based on whether there are active channels in this executor. The task executor can only exit after all the tcp connections are closed gracefully.&lt;/p&gt;

&lt;p&gt;   In theory as long as the downstream received all the data from the network, then the upstream side can be released normally, no need to wait all the received data are processed completely by downstream side. But we have on existing ack mechanism to notify upstream side of this, so it is easy to rely on close request currently.  Based on downstream&apos;s consumption to release upstream&apos;s resource, it may get extra benefits in failover scenarios in future for persistent output files in upstream side, because the upstream do not need to restart during consumption exception in downstream side.&lt;/p&gt;

&lt;p&gt;   But I just a little wonder it might bring potential effects in future via close request. For example, if there are 10 downstream tasks reuse the same tcp connection, and 9 tasks are finished earlier and only one tail task delay long to finish, then all the 10 partition views must be released together until the last downstream task finished. Although it might be no bad effects for delay releasing partition views currently.&lt;/p&gt;

&lt;p&gt;   I would continue reviewing other parts of this PR and it may take some days on my side. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16709820" author="githubbot" created="Wed, 5 Dec 2018 09:27:20 +0000"  >&lt;p&gt;zhijiangW commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r238986485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r238986485&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/slotmanager/SlotManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -902,6 +902,15 @@ private void checkTaskManagerTimeouts() {&lt;br/&gt;
 			// first retrieve the timed out TaskManagers&lt;br/&gt;
 			for (TaskManagerRegistration taskManagerRegistration : taskManagerRegistrations.values()) {&lt;br/&gt;
 				if (currentTime - taskManagerRegistration.getIdleSince() &amp;gt;= taskManagerTimeout.toMilliseconds()) {&lt;br/&gt;
+					// checking whether TaskManagers can be safely removed&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Maybe the task executor can bring the released information as payloads during heartbeat, then the task executor may be released earlier not waiting for next timeout period. For example the timeout is 5min, when 5.1 min all the partitions are released in executor, but it has to be released until 10min.&lt;/p&gt;

&lt;p&gt;   Certainly it could be a further improvement not covered in this PR.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16710920" author="githubbot" created="Thu, 6 Dec 2018 02:58:47 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r239314285&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r239314285&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/PartitionRequestQueue.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -134,10 +138,17 @@ public void cancel(InputChannelID receiverId) &lt;/p&gt;
{
 		ctx.pipeline().fireUserEventTriggered(receiverId);
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void close() {&lt;br/&gt;
+	public void close() throws IOException {&lt;br/&gt;
 		if (ctx != null) 
{
 			ctx.channel().close();
 		}
&lt;p&gt;+&lt;br/&gt;
+		LOG.info(&quot;Close all {} readers pending for close.&quot;, readersToClose.size());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Thanks Zhijiang. Agree with you that TM should only exit after all connections are closed. &lt;/p&gt;

&lt;p&gt;   Regarding the side effect that 1 tail tasks out of 10 tasks will delay releasing partitions, I think this may not be bad since the resource is managed at TM level. If a TM cannot be released, it doesn&apos;t make too much difference whether it has 1 partition or 10 partitions. Please correct me if anything wrong.&lt;/p&gt;

&lt;p&gt;   Considering all existing limitations, I think the resource management could be further improved via external shuffle service that you&apos;ve proposed. This PR may focus on solving current issue. Looking forward to your further comments. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16710927" author="githubbot" created="Thu, 6 Dec 2018 03:04:27 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r239314973&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r239314973&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/slotmanager/SlotManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -902,6 +902,15 @@ private void checkTaskManagerTimeouts() {&lt;br/&gt;
 			// first retrieve the timed out TaskManagers&lt;br/&gt;
 			for (TaskManagerRegistration taskManagerRegistration : taskManagerRegistrations.values()) {&lt;br/&gt;
 				if (currentTime - taskManagerRegistration.getIdleSince() &amp;gt;= taskManagerTimeout.toMilliseconds()) {&lt;br/&gt;
+					// checking whether TaskManagers can be safely removed&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Yes, your proposal will improve resource utilization. But considering that TM may be reused after all partitions are consumed (and before TM timeout), we may discuss this optimization in another issue. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16718670" author="githubbot" created="Wed, 12 Dec 2018 09:26:21 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r240935761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r240935761&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/ResultPartition.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -377,6 +377,13 @@ public void releaseMemory(int toRelease) throws IOException {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * Whether this partition is released (all subpartitions are consumed).&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   As this is a public method, I think comment may be needed. I will modify the comment content.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16718672" author="githubbot" created="Wed, 12 Dec 2018 09:27:48 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r240936283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r240936283&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/slot/TaskSlot.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -24,9 +24,13 @@&lt;br/&gt;
 import org.apache.flink.runtime.executiongraph.ExecutionAttemptID;&lt;br/&gt;
 import org.apache.flink.runtime.taskmanager.Task;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
+import org.slf4j.Logger;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Travis already passed. I will add the space line anyway.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16718676" author="githubbot" created="Wed, 12 Dec 2018 09:29:52 +0000"  >&lt;p&gt;QiLuo-BD commented on a change in pull request #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#discussion_r240937032&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#discussion_r240937032&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/PartitionRequestQueue.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -61,6 +62,9 @@&lt;br/&gt;
 	/** The readers which are already enqueued available for transferring data. */&lt;br/&gt;
 	private final ArrayDeque&amp;lt;NetworkSequenceViewReader&amp;gt; availableReaders = new ArrayDeque&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;p&gt;+	/** The readers are marked as to be closed, waiting for confirmation from writer side */&lt;br/&gt;
+	private final Set&amp;lt;NetworkSequenceViewReader&amp;gt; readersToClose = new HashSet&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Thanks, will do&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16718684" author="githubbot" created="Wed, 12 Dec 2018 09:36:21 +0000"  >&lt;p&gt;QiLuo-BD commented on issue #7186: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10941&quot; title=&quot;Slots prematurely released which still contain unconsumed data &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10941&quot;&gt;&lt;del&gt;FLINK-10941&lt;/del&gt;&lt;/a&gt; Keep slots which contain unconsumed result partitions&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7186#issuecomment-446522886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7186#issuecomment-446522886&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Hi Zhijiang, I&apos;ve updated the code according to your comments. Could you kindly help review this? &lt;/p&gt;

&lt;p&gt;   Thanks!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16741741" author="qiluo" created="Mon, 14 Jan 2019 03:34:23 +0000"  >&lt;p&gt;Hi Zhijiang/Till,&lt;/p&gt;

&lt;p&gt;Could you help to see any other issues on my PR? This not only applies to 1.5, but also to 1.6 &amp;amp; 1.7 as well. I&apos;d be glad to enhance my change if any issues are found.&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16816095" author="pnowojski" created="Fri, 12 Apr 2019 08:52:20 +0000"  >&lt;p&gt;merged commit 264a0c9 into apache:master&lt;/p&gt;</comment>
                            <comment id="16816107" author="till.rohrmann" created="Fri, 12 Apr 2019 09:05:19 +0000"  >&lt;p&gt;Backport for 1.8.1 and 1.7.x still pending&lt;/p&gt;</comment>
                            <comment id="16819902" author="pnowojski" created="Wed, 17 Apr 2019 09:52:37 +0000"  >&lt;p&gt;Merged to release-1.8 as 294e3a362b1a9efbc193c123467516631e1ed03f and 294e3a362b1a9efbc193c123467516631e1ed03f^.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; merging to 1.7 would require extra effort, since there are some merge conflicts, I&apos;m not sure if this is worth the effort, since it&apos;s a very old bug.&lt;/p&gt;</comment>
                            <comment id="16820087" author="till.rohrmann" created="Wed, 17 Apr 2019 13:29:02 +0000"  >&lt;p&gt;How much effort would it be? Technically we are still supporting &lt;tt&gt;1.7.x&lt;/tt&gt; and I know about users who run into this problem. If it&apos;s too much work and we swiftly release a &lt;tt&gt;1.8.1&lt;/tt&gt; we could ask these users whether they could upgrade to this version as a compromise.&lt;/p&gt;</comment>
                            <comment id="16820112" author="azagrebin" created="Wed, 17 Apr 2019 14:02:57 +0000"  >&lt;p&gt;I&apos;ll look into it, asap&lt;/p&gt;</comment>
                            <comment id="16821785" author="pnowojski" created="Fri, 19 Apr 2019 08:52:46 +0000"  >&lt;p&gt;merged commit 0ba7777 into apache:release-1.7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13225966">FLINK-12106</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13237676">FLINK-12736</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13228035">FLINK-12193</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13224863">FLINK-12069</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00om8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>