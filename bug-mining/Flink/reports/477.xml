<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:20:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2404] LongCounters should have an &quot;addValue()&quot; method for primitive longs</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2404</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Since the LongCounter is used heavily for internal statistics reporting, it must have very low overhead.&lt;/p&gt;

&lt;p&gt;The current &quot;addValue()&quot; method always boxes and unboxes the values, which is unnecessary overhead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12848835">FLINK-2404</key>
            <summary>LongCounters should have an &quot;addValue()&quot; method for primitive longs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sachingoel0101">Sachin Goel</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jul 2015 08:43:27 +0000</created>
                <updated>Thu, 28 Feb 2019 13:21:09 +0000</updated>
                            <resolved>Tue, 28 Jul 2015 15:25:44 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14642466" author="mxm" created="Mon, 27 Jul 2015 08:58:38 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I thought about adding a method like this as well.&lt;/p&gt;</comment>
                            <comment id="14642589" author="sachingoel0101" created="Mon, 27 Jul 2015 11:27:20 +0000"  >&lt;p&gt;I ran a dummy filter job to test any performance improvement that might happen because of using the primitive add methods.&lt;br/&gt;
Data: (1,1e+6), Local cluster with parallelism 1.&lt;br/&gt;
Time:&lt;br/&gt;
1. No call to add: 569.6 ms&lt;br/&gt;
2. Add Long: 601.2 ms&lt;br/&gt;
3. Add long: 598.1 ms&lt;/p&gt;

&lt;p&gt;There doesn&apos;t appear to be any significant improvement. Should I still open a PR?&lt;/p&gt;</comment>
                            <comment id="14642600" author="sachingoel0101" created="Mon, 27 Jul 2015 11:46:48 +0000"  >&lt;p&gt;In fact, here are some detailed timings under the JavaProgramTestBase cases:&lt;br/&gt;
                 No call to add     Add Long       Add long&lt;br/&gt;
without reuse:     131.6          122.8        95.8&lt;br/&gt;
with reuse:           49.15          43.0         44.35&lt;br/&gt;
collection:            78.5            84.9         80.75&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;These are timings averaged over 20 runs&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;I can&amp;#39;t this to render properly. The spaces are automatically trimmed.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14642602" author="mxm" created="Mon, 27 Jul 2015 11:47:59 +0000"  >&lt;p&gt;The performance impact might differ depending on the JDK. Which one did you use? Did you run the experiment multiple times to get an average or a median time measurement?&lt;/p&gt;

&lt;p&gt;There should definitely be an impact because a conversion has to be performed. However, the JIT compiler might be able to optimize simple cases.&lt;/p&gt;</comment>
                            <comment id="14642605" author="sachingoel0101" created="Mon, 27 Jul 2015 11:50:51 +0000"  >&lt;p&gt;I&apos;m using jdk8, specifically release 1.8.0_45 on windows 8.1&lt;/p&gt;</comment>
                            <comment id="14642619" author="mxm" created="Mon, 27 Jul 2015 11:58:45 +0000"  >&lt;p&gt;I think it makes more sense to benchmark this without Flink. Otherwise there are too many components in Flink which influence the run time of this experiment.&lt;/p&gt;</comment>
                            <comment id="14642622" author="mxm" created="Mon, 27 Jul 2015 12:01:01 +0000"  >&lt;p&gt;Although the performance impact might not be huge, it should definitely have some impact. You could try to run your benchmark isolated from Flink as this will give you more accurate run times. Also, feel free to open a pull request!&lt;/p&gt;</comment>
                            <comment id="14642658" author="githubbot" created="Mon, 27 Jul 2015 12:28:38 +0000"  >&lt;p&gt;GitHub user sachingoel0101 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2404&quot; title=&quot;LongCounters should have an &amp;quot;addValue()&amp;quot; method for primitive longs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2404&quot;&gt;&lt;del&gt;FLINK-2404&lt;/del&gt;&lt;/a&gt;Primitive add methods to Accumulators&lt;/p&gt;

&lt;p&gt;    Adds primitive add value methods to Double, Int and Long counter.&lt;/p&gt;

&lt;p&gt;    Benchmark: Run independently of Flink on the LongCounter accumulator.&lt;br/&gt;
    No Add | Long Add | long Add&lt;br/&gt;
    ------     | --------       | --------&lt;br/&gt;
    1458.9 | 2785.7 | 2169.7&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;Time for 1e+9 additions&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sachingoel0101/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sachingoel0101/flink&lt;/a&gt; flink-2404&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #942&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f70a261adcb50e557d75c810c2c95c224edf2cc8&lt;br/&gt;
Author: Sachin Goel &amp;lt;sachingoel0101@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-07-27T11:23:18Z&lt;/p&gt;

&lt;p&gt;    Added primitive add methods&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14644065" author="githubbot" created="Tue, 28 Jul 2015 08:36:04 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125504599&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125504599&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for repeating your experiment isolated without the whole Flink stack. Here we can clearly see the performance impact of the `Long` auto unboxing.&lt;/p&gt;

&lt;p&gt;    I will merge your changes later this day.&lt;/p&gt;</comment>
                            <comment id="14644333" author="githubbot" created="Tue, 28 Jul 2015 13:00:38 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125597443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125597443&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Should we add some kind of annotation to suggest the usage of the primitive functions? We can&apos;t deprecate the older ones probably.&lt;/p&gt;</comment>
                            <comment id="14644353" author="githubbot" created="Tue, 28 Jul 2015 13:15:13 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125603184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125603184&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    We can add a comment that the new ones are faster on primitives. It is not possible to deprecate the older ones because they are inherited from the Accumulator interface which uses Generics. It&apos;s just an optimization.&lt;/p&gt;</comment>
                            <comment id="14644358" author="githubbot" created="Tue, 28 Jul 2015 13:20:58 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125604252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125604252&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    No one will actually find out unless they specifically went through the documentation for these. Most people would only ever see the docs for Accumulator interface. &lt;br/&gt;
    I agree though. We can&apos;t deprecate them obviously. I&apos;ll add the suggestion in docs.&lt;/p&gt;</comment>
                            <comment id="14644523" author="githubbot" created="Tue, 28 Jul 2015 15:23:19 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125652591&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125652591&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    For the cases, where we add a primitive type on a Long/Int/DoubleCounter, the optimization will automatically be used.&lt;/p&gt;</comment>
                            <comment id="14644527" author="githubbot" created="Tue, 28 Jul 2015 15:24:48 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14644528" author="githubbot" created="Tue, 28 Jul 2015 15:25:01 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125653547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125653547&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the pull request!&lt;/p&gt;</comment>
                            <comment id="14644531" author="githubbot" created="Tue, 28 Jul 2015 15:30:52 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/942#issuecomment-125654972&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/942#issuecomment-125654972&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sure. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14645267" author="sachingoel0101" created="Wed, 29 Jul 2015 00:22:56 +0000"  >&lt;p&gt;Fixed via 571084152f81f984fa4cdfc2122c3edcf5b62abd&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hvwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>