<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5645] IOMetrics transfer through ExecGraph does not work for failed jobs</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5645</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;While a job is running the web-interface polls IO metrics using the MetricFetcher/MetricQueryService. For finished jobs these metrics are stored in the ExecutionGraph; each vertex has an IOMetrics object; basically a snapshot taken when the task was finished. &lt;/p&gt;

&lt;p&gt;For completed jobs this mechanism is working. However, for failed jobs it doesn&apos;t; in this case last fetched metrics are displayed.&lt;/p&gt;

&lt;p&gt;This isn&apos;t intended behavior and should be fixed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13037741">FLINK-5645</key>
            <summary>IOMetrics transfer through ExecGraph does not work for failed jobs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jan 2017 16:08:04 +0000</created>
                <updated>Tue, 7 Mar 2017 11:43:52 +0000</updated>
                            <resolved>Tue, 7 Mar 2017 11:43:46 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Metrics</component>
                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15876068" author="githubbot" created="Tue, 21 Feb 2017 14:39:00 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5645&quot; title=&quot;IOMetrics transfer through ExecGraph does not work for failed jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5645&quot;&gt;&lt;del&gt;FLINK-5645&lt;/del&gt;&lt;/a&gt; Store accumulators/metrics for canceled/failed tasks&lt;/p&gt;

&lt;p&gt;    This PR modified the Execution/ExecutionGraph to store transmitted io-metrics/accumulators for canceled/failed tasks. Previously these were only stored for finished tasks. For other tasks they were simply discarded.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 5645_metrics_failed&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3377&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1a68ee62a86de283a1a0210dc637ac65d3860bef&lt;br/&gt;
Author: zentol &amp;lt;chesnay@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-02-21T11:36:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5645&quot; title=&quot;IOMetrics transfer through ExecGraph does not work for failed jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5645&quot;&gt;&lt;del&gt;FLINK-5645&lt;/del&gt;&lt;/a&gt; Store accumulators/metrics for canceled/failed tasks&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15878262" author="githubbot" created="Wed, 22 Feb 2017 14:07:31 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377#discussion_r102464984&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377#discussion_r102464984&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java &amp;#8212;&lt;br/&gt;
    @@ -1292,10 +1292,28 @@ public boolean updateState(TaskExecutionState state) {&lt;br/&gt;
     					}&lt;br/&gt;
     					return true;&lt;br/&gt;
     				case CANCELED:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;attempt.cancelingComplete();&lt;br/&gt;
    +					AccumulatorSnapshot acc1 = state.getAccumulators();&lt;br/&gt;
    +					Map&amp;lt;String, Accumulator&amp;lt;?, ?&amp;gt;&amp;gt; userAcc1 = null;&lt;br/&gt;
    +					if (acc1 != null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +						try {
    +							userAcc1 = acc1.deserializeUserAccumulators(userClassLoader);
    +						} catch (Exception e) {
    +							LOG.error(&quot;Failed to deserialize final accumulator results.&quot;, e);
    +						}&lt;br/&gt;
    +					}&lt;br/&gt;
    +					attempt.cancelingComplete(userAcc1, state.getIOMetrics());&lt;br/&gt;
     					return true;&lt;br/&gt;
     				case FAILED:&lt;br/&gt;
    -					attempt.markFailed(state.getError(userClassLoader));&lt;br/&gt;
    +					AccumulatorSnapshot acc2 = state.getAccumulators();&lt;br/&gt;
    +					Map&amp;lt;String, Accumulator&amp;lt;?, ?&amp;gt;&amp;gt; userAcc2 = null;&lt;br/&gt;
    +					if (acc2 != null) {&lt;br/&gt;
    +						try {
    +							userAcc2 = acc2.deserializeUserAccumulators(userClassLoader);
    +						} catch (Exception e) {    +							LOG.error(&quot;Failed to deserialize final accumulator results.&quot;, e);    +						}    +					}&lt;/span&gt; &lt;/div&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can this deserialization logic be factored out into a method?&lt;/p&gt;</comment>
                            <comment id="15878263" author="githubbot" created="Wed, 22 Feb 2017 14:07:31 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377#discussion_r102465162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377#discussion_r102465162&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/IOMetrics.java &amp;#8212;&lt;br/&gt;
    @@ -53,6 +53,22 @@ public IOMetrics(Meter recordsIn, Meter recordsOut, Meter bytesLocalIn, Meter by&lt;br/&gt;
     		this.numBytesOutPerSecond = bytesOut.getRate();&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	public IOMetrics(&lt;br/&gt;
    +			int numBytesInLocal, int numBytesInRemote, int numBytesOut, int numRecordsIn, int numRecordsOut,&lt;br/&gt;
    +			double numBytesInLocalPerSecond, double numBytesInRemotePerSecond, double numBytesOutPerSecond,&lt;br/&gt;
    +			double numRecordsInPerSecond, double numRecordsOutPerSecond) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure whether this line breaking pattern is consistent.&lt;/p&gt;</comment>
                            <comment id="15878264" author="githubbot" created="Wed, 22 Feb 2017 14:07:31 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377#discussion_r102467283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377#discussion_r102467283&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/Execution.java &amp;#8212;&lt;br/&gt;
    @@ -855,14 +877,23 @@ private boolean processFail(Throwable t, boolean isCallback) {&lt;br/&gt;
     			}&lt;/p&gt;

&lt;p&gt;     			if (current == CANCELING) &lt;/p&gt;
{
    -				cancelingComplete();
    +				cancelingComplete(userAccumulators, metrics);
     				return false;
     			}

&lt;p&gt;     			if (transitionState(current, FAILED, t)) {&lt;br/&gt;
     				// success (in a manner of speaking)&lt;br/&gt;
     				this.failureCause = t;&lt;/p&gt;

&lt;p&gt;    +				if (userAccumulators != null) {&lt;br/&gt;
    +					synchronized (accumulatorLock) &lt;/p&gt;
{
    +						this.userAccumulators = userAccumulators;
    +					}
&lt;p&gt;    +				}&lt;br/&gt;
    +				if (metrics != null) &lt;/p&gt;
{
    +					this.ioMetrics = metrics;
    +				}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can this also be a separate method?&lt;/p&gt;</comment>
                            <comment id="15878282" author="githubbot" created="Wed, 22 Feb 2017 14:18:20 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377#discussion_r102471279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377#discussion_r102471279&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/IOMetrics.java &amp;#8212;&lt;br/&gt;
    @@ -53,6 +53,22 @@ public IOMetrics(Meter recordsIn, Meter recordsOut, Meter bytesLocalIn, Meter by&lt;br/&gt;
     		this.numBytesOutPerSecond = bytesOut.getRate();&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	public IOMetrics(&lt;br/&gt;
    +			int numBytesInLocal, int numBytesInRemote, int numBytesOut, int numRecordsIn, int numRecordsOut,&lt;br/&gt;
    +			double numBytesInLocalPerSecond, double numBytesInRemotePerSecond, double numBytesOutPerSecond,&lt;br/&gt;
    +			double numRecordsInPerSecond, double numRecordsOutPerSecond) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    well there &lt;b&gt;is&lt;/b&gt; a pattern: L1 are counts, L2 are byte rates, L3 are record rates.&lt;/p&gt;

&lt;p&gt;    Can change it though.&lt;/p&gt;</comment>
                            <comment id="15878284" author="githubbot" created="Wed, 22 Feb 2017 14:20:28 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann I&apos;ve addressed your comments.&lt;/p&gt;</comment>
                            <comment id="15897135" author="githubbot" created="Mon, 6 Mar 2017 11:32:29 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377#discussion_r104394092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377#discussion_r104394092&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java &amp;#8212;&lt;br/&gt;
    @@ -1311,6 +1311,19 @@ public boolean updateState(TaskExecutionState state) {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private Map&amp;lt;String, Accumulator&amp;lt;?, ?&amp;gt;&amp;gt; deserializeAccumulators(TaskExecutionState state) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I&apos;ve checked that returning `null` is the same behaviour as in `accumulators.deserializeUserAccumulators(userClassLoader)`. In general it would be good to add annotations for `@Nullable` return types or simply return empty collections, but that&apos;s an orthogonal change.&lt;/p&gt;</comment>
                            <comment id="15897138" author="githubbot" created="Mon, 6 Mar 2017 11:33:16 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for addressing Tills comments. I think this is good to merge now. Could you go ahead and do it?&lt;/p&gt;

</comment>
                            <comment id="15899309" author="zentol" created="Tue, 7 Mar 2017 11:43:46 +0000"  >&lt;p&gt;Fixed in 821da81fe6bee4c5a33be19c08064491fd6280de.&lt;/p&gt;</comment>
                            <comment id="15899310" author="githubbot" created="Tue, 7 Mar 2017 11:43:52 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3377&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3970n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>