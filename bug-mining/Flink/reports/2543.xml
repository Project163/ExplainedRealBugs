<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9815] YARNSessionCapacitySchedulerITCase flaky</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9815</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The test fails because of dangling yarn applications.&lt;/p&gt;

&lt;p&gt;Logs: &lt;a href=&quot;https://api.travis-ci.org/v3/job/402657694/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/402657694/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It was also reported previously in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8161&quot; title=&quot;Flakey YARNSessionCapacitySchedulerITCase on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8161&quot;&gt;&lt;del&gt;FLINK-8161&lt;/del&gt;&lt;/a&gt; : &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8161?focusedCommentId=16480216&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16480216&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-8161?focusedCommentId=16480216&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16480216&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13171476">FLINK-9815</key>
            <summary>YARNSessionCapacitySchedulerITCase flaky</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 11 Jul 2018 17:22:53 +0000</created>
                <updated>Thu, 8 Aug 2019 07:44:16 +0000</updated>
                            <resolved>Thu, 19 Jul 2018 06:44:44 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16545619" author="dawidwys" created="Mon, 16 Jul 2018 18:59:35 +0000"  >&lt;p&gt;Another failure: &lt;a href=&quot;https://api.travis-ci.org/v3/job/404478412/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/404478412/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16546440" author="zentol" created="Tue, 17 Jul 2018 11:27:15 +0000"  >&lt;p&gt;The &lt;tt&gt;YarnTestBase&lt;/tt&gt; has an &lt;tt&gt;@After&lt;/tt&gt; method in which it sleeps for 500ms to wait for jobs to terminate. I&apos;ll replace this with a more lenient and proper check that fails if any application is still running after several seconds.&lt;/p&gt;</comment>
                            <comment id="16546842" author="githubbot" created="Tue, 17 Jul 2018 16:22:29 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    the test failures may highlight tests that weren&apos;t shutting down the last application properly; previously this would&apos;ve succeeded since the check was done in `@Before`.&lt;/p&gt;</comment>
                            <comment id="16546843" author="githubbot" created="Tue, 17 Jul 2018 16:22:36 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    will look into them tomorrow&lt;/p&gt;</comment>
                            <comment id="16547545" author="githubbot" created="Wed, 18 Jul 2018 08:33:12 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352#discussion_r203293425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352#discussion_r203293425&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -186,39 +189,56 @@ public static void populateYarnSecureConfigurations(Configuration conf, String p&lt;br/&gt;
     		conf.set(&quot;hadoop.security.auth_to_local&quot;, &quot;RULE:&lt;span class=&quot;error&quot;&gt;&amp;#91;1:$1&amp;#93;&lt;/span&gt; RULE:&lt;span class=&quot;error&quot;&gt;&amp;#91;2:$1&amp;#93;&lt;/span&gt;&quot;);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Sleep a bit between the tests (we are re-using the YARN cluster for the tests).&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@After&lt;/li&gt;
	&lt;li&gt;public void sleep() {&lt;/li&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(500);
    -		}
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
    -			Assert.fail(&quot;Should not happen&quot;);
    -		}&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;br/&gt;
     	@Before&lt;/li&gt;
	&lt;li&gt;public void checkClusterEmpty() throws IOException, YarnException {&lt;br/&gt;
    +	public void checkClusterEmpty() {&lt;br/&gt;
     		if (yarnClient == null) 
{
     			yarnClient = YarnClient.createYarnClient();
     			yarnClient.init(getYarnConfiguration());
     			yarnClient.start();
     		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;ApplicationReport&amp;gt; apps = yarnClient.getApplications();&lt;/li&gt;
	&lt;li&gt;for (ApplicationReport app : apps) {&lt;/li&gt;
	&lt;li&gt;if (app.getYarnApplicationState() != YarnApplicationState.FINISHED&lt;/li&gt;
	&lt;li&gt;&amp;amp;&amp;amp; app.getYarnApplicationState() != YarnApplicationState.KILLED&lt;/li&gt;
	&lt;li&gt;&amp;amp;&amp;amp; app.getYarnApplicationState() != YarnApplicationState.FAILED) 
{
    -				Assert.fail(&quot;There is at least one application on the cluster is not finished.&quot; +
    -						&quot;App &quot; + app.getApplicationId() + &quot; is in state &quot; + app.getYarnApplicationState());
    +		flinkConfiguration = new org.apache.flink.configuration.Configuration(globalConfiguration);
    +
    +		isNewMode = Objects.equals(TestBaseUtils.CodebaseType.NEW, TestBaseUtils.getCodebaseType());
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Sleep a bit between the tests (we are re-using the YARN cluster for the tests).&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@After&lt;br/&gt;
    +	public void sleep() throws IOException, YarnException {&lt;br/&gt;
    +		Deadline deadline = Deadline.now().plus(Duration.ofSeconds(10));&lt;br/&gt;
    +&lt;br/&gt;
    +		boolean isAnyJobRunning = yarnClient.getApplications().stream()&lt;br/&gt;
    +			.anyMatch(YarnTestBase::isApplicationRunning);&lt;br/&gt;
    +&lt;br/&gt;
    +		while (deadline.hasTimeLeft() &amp;amp;&amp;amp; isAnyJobRunning) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			try {
    +				Thread.sleep(500);
    +			} catch (InterruptedException e) {
    +				Assert.fail(&quot;Should not happen&quot;);
     			}    +			isAnyJobRunning = yarnClient.getApplications().stream()    +				.anyMatch(YarnTestBase}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfiguration = new org.apache.flink.configuration.Configuration(globalConfiguration);&lt;br/&gt;
    +		if (isAnyJobRunning) {&lt;br/&gt;
    +			final Optional&amp;lt;ApplicationReport&amp;gt; runningApp = yarnClient.getApplications().stream()&lt;br/&gt;
    +				.filter(YarnTestBase::isApplicationRunning)&lt;br/&gt;
    +				.findAny();&lt;br/&gt;
    +			if (runningApp.isPresent()) {&lt;br/&gt;
    +				final ApplicationReport app = runningApp.get();&lt;br/&gt;
    +				Assert.fail(&quot;There is at least one application on the cluster that is not finished.&quot; +&lt;br/&gt;
    +					&quot;App &quot; + app.getApplicationId() + &quot; is in state &quot; + app.getYarnApplicationState());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Could we log all running applications instead of any?&lt;/p&gt;</comment>
                            <comment id="16547583" author="githubbot" created="Wed, 18 Jul 2018 09:13:53 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The failing test case seems to be caused by `YARNSessionFIFOITCase#testJavaAPI` not calling `yarnCluster.shutdownCluster`. I&apos;ve fixed this problem in master and the release branch. Rebasing onto the latest master should hopefully give a green Travis build.&lt;/p&gt;</comment>
                            <comment id="16547694" author="githubbot" created="Wed, 18 Jul 2018 11:12:49 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The `YARNHighAvailabilityITCase` still has the same problem.&lt;/p&gt;</comment>
                            <comment id="16547761" author="githubbot" created="Wed, 18 Jul 2018 12:40:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Interesting. I thought I would have executed `flink-yarn-tests` locally with all tests. But it looks as if `YARNHighAvailabilityITCase` suffers from the same problem as the `YARNSessionFIFOITcase#testJavaAPI` test.&lt;/p&gt;</comment>
                            <comment id="16547936" author="githubbot" created="Wed, 18 Jul 2018 15:00:57 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    yay travis is green.&lt;/p&gt;</comment>
                            <comment id="16548868" author="zentol" created="Thu, 19 Jul 2018 06:44:44 +0000"  >&lt;p&gt;master: 230f81753fb56cea39cdea4c763ad8667baa9dbe&lt;br/&gt;
1.6: 9ae2c3bacc4c25b813a897bd419226c5aaa21bd3&lt;/p&gt;</comment>
                            <comment id="16548870" author="githubbot" created="Thu, 19 Jul 2018 06:45:54 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6352&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13161796">FLINK-9434</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vs4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>