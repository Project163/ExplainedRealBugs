<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10581] YarnConfigurationITCase.testFlinkContainerMemory test instability</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10581</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Test appeared to fail (by a narrow margin) without a reason randomly:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Failed tests: 
  YarnConfigurationITCase.testFlinkContainerMemory:182 
Expected: is a numeric value within &amp;lt;0.1&amp;gt; of &amp;lt;1.0&amp;gt;
     but: &amp;lt;0.8913043478260869&amp;gt; differed by &amp;lt;0.008695652173913077&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://api.travis-ci.org/v3/job/442246057/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/442246057/log.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13192203">FLINK-10581</key>
            <summary>YarnConfigurationITCase.testFlinkContainerMemory test instability</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="pnowojski">Piotr Nowojski</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 17 Oct 2018 11:47:55 +0000</created>
                <updated>Fri, 2 Nov 2018 10:42:18 +0000</updated>
                            <resolved>Fri, 2 Nov 2018 10:42:18 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16670308" author="dawidwys" created="Wed, 31 Oct 2018 15:58:06 +0000"  >&lt;p&gt;I do suspect it is because of how &lt;tt&gt;Runtime.getRuntime().maxMemory()&lt;/tt&gt; is calculated, cause effectively we compare this value retrieved in &lt;tt&gt;TaskExecutor&lt;/tt&gt; container with what we assume should be set as &lt;tt&gt;-Xmx&lt;/tt&gt; while starting this container.&lt;br/&gt;
Thanks to this answer: &lt;a href=&quot;https://stackoverflow.com/questions/23701207/why-do-xmx-and-runtime-maxmemory-not-agree&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/23701207/why-do-xmx-and-runtime-maxmemory-not-agree&lt;/a&gt; depending on the jvm implementation it might happen that &lt;tt&gt;maxMemory&lt;/tt&gt; will return value decreased by the size of one Survivor space. Final values for each space are also aligned with page sizes, which makes the whole calculation even harder.&lt;/p&gt;

&lt;p&gt;Usually the value of 10% difference is enough but as it turned out not always. I would suggest to just increase the error threshold to e.g. 15%. Any other suggestions &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16671706" author="githubbot" created="Thu, 1 Nov 2018 14:54:40 +0000"  >&lt;p&gt;dawidwys opened a new pull request #6990: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10581&quot; title=&quot;YarnConfigurationITCase.testFlinkContainerMemory test instability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10581&quot;&gt;&lt;del&gt;FLINK-10581&lt;/del&gt;&lt;/a&gt; Increased the threshold for memory verification in YarnConfigurationITCase.testFlinkContainerMemory&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6990&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6990&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Improve YarnConfigurationITCase.testFlinkContainerMemory test stability&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Increased memory threshold&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16672897" author="githubbot" created="Fri, 2 Nov 2018 10:33:45 +0000"  >&lt;p&gt;dawidwys closed pull request #6990: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10581&quot; title=&quot;YarnConfigurationITCase.testFlinkContainerMemory test instability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10581&quot;&gt;&lt;del&gt;FLINK-10581&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; Increased the threshold for memory verification in YarnConfigurationITCase.testFlinkContainerMemory&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6990&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6990&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnConfigurationITCase.java b/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnConfigurationITCase.java&lt;br/&gt;
index 58710bc6962..571681aba82 100644&lt;br/&gt;
&amp;#8212; a/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnConfigurationITCase.java&lt;br/&gt;
+++ b/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnConfigurationITCase.java&lt;br/&gt;
@@ -179,7 +179,12 @@ public void testFlinkContainerMemory() throws Exception &lt;/p&gt;
{
 
 				final long expectedHeadSize = containeredTaskManagerParameters.taskManagerHeapSizeMB() &amp;lt;&amp;lt; 20L;
 
-				assertThat((double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize, is(closeTo(1.0, 0.1)));
+				// We compare here physical memory assigned to a container with the heap memory that we should pass to
+				// jvm as Xmx parameter. Those value might differ significantly due to sytem page size or jvm
+				// implementation therefore we use 15% threshold here.
+				assertThat(
+					(double) taskManagerInfo.getHardwareDescription().getSizeOfJvmHeap() / (double) expectedHeadSize,
+					is(closeTo(1.0, 0.15)));
 			}
&lt;p&gt; finally {&lt;br/&gt;
 				restClient.shutdown(TIMEOUT);&lt;br/&gt;
 				clusterClient.shutdown();&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16672904" author="dawidwys" created="Fri, 2 Nov 2018 10:42:05 +0000"  >&lt;p&gt;Fixed in master via: 341b62b887dde4c18fe85704c1af78f9b855dd75&lt;br/&gt;
Fixed in 1.6 via: 815581f14297e155f8aa63c6d68ebfdeb043e488&lt;br/&gt;
Fixed in 1.5 via: e260e57f0bc5c714af58c30e6138aaf35c3e5057&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zaxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>