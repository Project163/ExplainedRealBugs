<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8371] Buffers are not recycled in a non-spilled SpillableSubpartition upon release</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8371</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;SpillableSubpartition&lt;/tt&gt; only recycles buffers in its &lt;tt&gt;buffer&lt;/tt&gt; queue if there is no view attached to it yet. If there is a view, it delegates this task to the view, but &lt;tt&gt;SpillableSubpartitionView&lt;/tt&gt; only instructs the &lt;tt&gt;SpilledSubpartitionView&lt;/tt&gt; to clean up in its &lt;tt&gt;releaseAllResources()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Similarly to the &lt;tt&gt;PipelinesSubpartition&lt;/tt&gt; implementation, we should always clean up and recycle the buffers in &lt;tt&gt;SpillableSubpartition#release()&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13128778">FLINK-8371</key>
            <summary>Buffers are not recycled in a non-spilled SpillableSubpartition upon release</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jan 2018 11:15:30 +0000</created>
                <updated>Thu, 11 Jan 2018 14:16:43 +0000</updated>
                            <resolved>Thu, 11 Jan 2018 14:14:49 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                    <version>1.3.1</version>
                    <version>1.3.2</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16313058" author="stephanewen" created="Fri, 5 Jan 2018 13:01:25 +0000"  >&lt;p&gt;I think this is critical. It affects Flink batch session setups.&lt;/p&gt;</comment>
                            <comment id="16313498" author="nicok" created="Fri, 5 Jan 2018 17:33:32 +0000"  >&lt;p&gt;Working on it - also, while doing so, I noticed that similarly, &lt;tt&gt;SpillableSubpartitionView#nextBuffer&lt;/tt&gt; is also not cleaned up (if populated when the &lt;tt&gt;release()&lt;/tt&gt; is happening).&lt;/p&gt;</comment>
                            <comment id="16316450" author="githubbot" created="Mon, 8 Jan 2018 15:06:37 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5261&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8371&quot; title=&quot;Buffers are not recycled in a non-spilled SpillableSubpartition upon release&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8371&quot;&gt;&lt;del&gt;FLINK-8371&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; always recycle Buffers when releasing SpillableSubpartition&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    There were places where `Buffer` instances were not released upon `SpillableSubpartition#release()` with a view attached to a non-spilled subpartition:&lt;/p&gt;

&lt;p&gt;    1) `SpillableSubpartition#buffer`: `SpillableSubpartition#release()` delegates the recycling to the view, but `SpillableSubpartitionView` does not clean up the `buffers` queue (the recycling was only done by the subpartition if there was no view).&lt;br/&gt;
    2) `SpillableSubpartitionView#nextBuffer`: If this field is populated when the subpartition is released, it will neither be given out in subsequent `SpillableSubpartitionView#getNextBuffer()` calls (there was a short path returning `null` here), nor was it recycled&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Please refer to dataArtisans/flink#3.&lt;/li&gt;
	&lt;li&gt;This PR is based on #5260 .&lt;/li&gt;
	&lt;li&gt;It should probably be applied to Flink-1.4 as well.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;similarly to the `PipelinesSubpartition` implementation, make `SpillableSubpartition#release()` always clean up and recycle the buffers&lt;/li&gt;
	&lt;li&gt;recycle `SpillableSubpartitionView#nextBuffer` in `SpillableSubpartitionView#releaseAllResources()`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added tests for various scenarios releasing a spillable/spilled or pipelined subpartition&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;not applicable&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-8371&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5261.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5261.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5261&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit fada3022186670851a3956a961f490e6d86e2a53&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2017-12-13T14:28:08Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;checkstyle&amp;#93;&lt;/span&gt; only ignore checkstyle in existing packages under runtime.io.network&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ignore runtime.io.(async|disk)&lt;/li&gt;
	&lt;li&gt;ignore runtime.io.network.(api|buffer|netty|partition|serialization|util)&lt;br/&gt;
    -&amp;gt; everything else will be checked against the ruleset&lt;/li&gt;
	&lt;li&gt;fix checkstyle errors in classes directly under runtime.io.network&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;commit f8dff47a707c4e7572d02e072197927ec2ce2ef7&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2017-12-14T16:30:19Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8252&quot; title=&quot;Convert network benchmarks to streaming benchmarks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8252&quot;&gt;&lt;del&gt;FLINK-8252&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;benchmarks&amp;#93;&lt;/span&gt; convert network benchmarks to streaming benchmarks&lt;/p&gt;

&lt;p&gt;    This allows us to use the output flushing interval as a parameter to evaluate,&lt;br/&gt;
    too.&lt;/p&gt;

&lt;p&gt;commit a4980ae85bac1dca9f8939e0dc3c8839991ed5e8&lt;br/&gt;
Author: Zhijiang &amp;lt;wangzhijiang999@...&amp;gt;&lt;br/&gt;
Date:   2017-08-17T11:38:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7468&quot; title=&quot;Implement sender backlog logic for credit-based&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7468&quot;&gt;&lt;del&gt;FLINK-7468&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; Implement sender backlog logic for credit-based&lt;/p&gt;

&lt;p&gt;commit 0da032b3e7b90da2cbee5ca6f051667add104ac6&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-01-05T14:28:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8375&quot; title=&quot;Remove unnecessary synchronization in ResultPartition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8375&quot;&gt;&lt;del&gt;FLINK-8375&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; Remove unnecessary synchronization&lt;/p&gt;

&lt;p&gt;    Synchronized blocks in ResultPartition could affect only:&lt;br/&gt;
    1. totalNumberOfBuffers and totalNumberOfBytes counters&lt;br/&gt;
    2. subpartition add(), finish() and release() calls.&lt;/p&gt;

&lt;p&gt;    However:&lt;br/&gt;
    1. counters were not used anywhere - they are removed by this commit&lt;br/&gt;
    2a. add(), finish() and release() methods for PipelinedSubpartition were already threads safe&lt;br/&gt;
    2b. add(), finish() and release() methods for SpillableSubpartition were made thread safe in&lt;br/&gt;
    this commit, by basically pushing synchronized section down one level.&lt;/p&gt;

&lt;p&gt;commit 2938610f996361e68dedefed6c247c3547cea331&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-01-05T15:17:13Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; move assertions out of the finally block&lt;/p&gt;

&lt;p&gt;    There was a potential for them to mask exceptions.&lt;/p&gt;

&lt;p&gt;commit f2dcc6ed3d5b5c136e4d899375ae85c3fe1e0a3e&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-01-05T17:18:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8371&quot; title=&quot;Buffers are not recycled in a non-spilled SpillableSubpartition upon release&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8371&quot;&gt;&lt;del&gt;FLINK-8371&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; always recycle Buffers when releasing SpillableSubpartition&lt;/p&gt;

&lt;p&gt;    There were places where Buffer instances were not released upon&lt;br/&gt;
    SpillableSubpartition#release() with a view attached to a non-spilled&lt;br/&gt;
    subpartition:&lt;/p&gt;

&lt;p&gt;    1) SpillableSubpartition#buffer:&lt;br/&gt;
      SpillableSubpartition#release() delegates the recycling to the view, but&lt;br/&gt;
      SpillableSubpartitionView does not clean up the &apos;buffers&apos; queue (the&lt;br/&gt;
      recycling was only done by the subpartition if there was no view).&lt;br/&gt;
    2) SpillableSubpartitionView#nextBuffer:&lt;br/&gt;
      If this field is populated when the subpartition is released, it will neither&lt;br/&gt;
      be given out in subsequent SpillableSubpartitionView#getNextBuffer() calls&lt;br/&gt;
      (there was a short path returning &apos;null&apos; here), nor was it recycled&lt;/p&gt;

&lt;p&gt;    -&amp;gt; similarly to the PipelinesSubpartition implementation, make&lt;br/&gt;
       SpillableSubpartition#release() always clean up and recycle the buffers&lt;br/&gt;
    -&amp;gt; recycle SpillableSubpartitionView#nextBuffer in&lt;br/&gt;
       SpillableSubpartitionView#releaseAllResources()&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16316516" author="githubbot" created="Mon, 8 Jan 2018 15:51:53 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5261#discussion_r160178046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5261#discussion_r160178046&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java &amp;#8212;&lt;br/&gt;
    @@ -52,6 +55,10 @@&lt;br/&gt;
     	/** Flag indicating whether the subpartition has been released. */&lt;br/&gt;
     	private volatile boolean isReleased;&lt;/p&gt;

&lt;p&gt;    +	/** The number of non-event buffers currently in this subpartition */&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    nit: Should also end with a period.&lt;/p&gt;</comment>
                            <comment id="16318087" author="githubbot" created="Tue, 9 Jan 2018 09:07:28 +0000"  >&lt;p&gt;Github user NicoK commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5261#discussion_r160349800&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5261#discussion_r160349800&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/PipelinedSubpartition.java &amp;#8212;&lt;br/&gt;
    @@ -52,6 +55,10 @@&lt;br/&gt;
     	/** Flag indicating whether the subpartition has been released. */&lt;br/&gt;
     	private volatile boolean isReleased;&lt;/p&gt;

&lt;p&gt;    +	/** The number of non-event buffers currently in this subpartition */&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    alright - created a fixup for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7468&quot; title=&quot;Implement sender backlog logic for credit-based&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7468&quot;&gt;&lt;del&gt;FLINK-7468&lt;/del&gt;&lt;/a&gt; here&lt;/p&gt;</comment>
                            <comment id="16318573" author="githubbot" created="Tue, 9 Jan 2018 15:15:32 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5261&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16319999" author="githubbot" created="Wed, 10 Jan 2018 10:16:47 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8371&quot; title=&quot;Buffers are not recycled in a non-spilled SpillableSubpartition upon release&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8371&quot;&gt;&lt;del&gt;FLINK-8371&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; always recycle Buffers when releasing SpillableSubpartition&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This is a rebase of #5261 for the release-1.4 branch. Please refer to the original PR for details.&lt;/p&gt;

&lt;p&gt;    Please also note that this PR includes #5275.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-8371-1.4&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5276.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5276.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5276&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2c667dea8e711fc928a37838c9f6cd5f6a9f7685&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2017-11-23T12:09:37Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; only update buffer statistics in SpillableSubpartition#add() if successful&lt;/p&gt;

&lt;p&gt;commit 9398dafae6918488582bc89c1ab73e3e2bd5ea16&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2017-11-23T13:59:18Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; add some more buffer recycling checks in SpillableSubpartitionTest&lt;/p&gt;

&lt;p&gt;commit 074bfbb82c4c18acf9ba383473fdefa89e1bf095&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2017-11-23T13:58:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7499&quot; title=&quot;double buffer release in SpillableSubpartitionView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7499&quot;&gt;&lt;del&gt;FLINK-7499&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;io&amp;#93;&lt;/span&gt; also let AsynchronousBufferFileWriter#writeBlock() recycle the buffer in case of failures&lt;/p&gt;

&lt;p&gt;    This fixes a double-recycle in SpillableSubpartitionView and also makes sure&lt;br/&gt;
    that even if adding the (asynchronous) write operation fails, the buffer is&lt;br/&gt;
    properly freed in code that did not perform this cleanup. It avoids code&lt;br/&gt;
    duplication of this cleanup and it is also more consistent to take over&lt;br/&gt;
    responsibility of the given buffer even if an exception is thrown.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7499&quot; title=&quot;double buffer release in SpillableSubpartitionView&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7499&quot;&gt;&lt;del&gt;FLINK-7499&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;io&amp;#93;&lt;/span&gt; complete the idiom of ResultSubpartition#add() taking over ownership of the buffer&lt;/p&gt;

&lt;p&gt;    The buffer will now always be released once and at the right time and the caller&lt;br/&gt;
    must not worry about the buffer release if a called function threw an exception.&lt;/p&gt;

&lt;p&gt;commit be12c1a8169b9d4d3cfb6c39675273ffc953531a&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-01-05T17:18:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8371&quot; title=&quot;Buffers are not recycled in a non-spilled SpillableSubpartition upon release&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8371&quot;&gt;&lt;del&gt;FLINK-8371&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; always recycle Buffers when releasing SpillableSubpartition&lt;/p&gt;

&lt;p&gt;    There were places where Buffer instances were not released upon&lt;br/&gt;
    SpillableSubpartition#release() with a view attached to a non-spilled&lt;br/&gt;
    subpartition:&lt;/p&gt;

&lt;p&gt;    1) SpillableSubpartition#buffer:&lt;br/&gt;
      SpillableSubpartition#release() delegates the recycling to the view, but&lt;br/&gt;
      SpillableSubpartitionView does not clean up the &apos;buffers&apos; queue (the&lt;br/&gt;
      recycling was only done by the subpartition if there was no view).&lt;br/&gt;
    2) SpillableSubpartitionView#nextBuffer:&lt;br/&gt;
      If this field is populated when the subpartition is released, it will neither&lt;br/&gt;
      be given out in subsequent SpillableSubpartitionView#getNextBuffer() calls&lt;br/&gt;
      (there was a short path returning &apos;null&apos; here), nor was it recycled&lt;/p&gt;

&lt;p&gt;    -&amp;gt; similarly to the PipelinesSubpartition implementation, make&lt;br/&gt;
       SpillableSubpartition#release() always clean up and recycle the buffers&lt;br/&gt;
    -&amp;gt; recycle SpillableSubpartitionView#nextBuffer in&lt;br/&gt;
       SpillableSubpartitionView#releaseAllResources()&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16322263" author="nicok" created="Thu, 11 Jan 2018 14:14:49 +0000"  >&lt;p&gt;Merged.&lt;/p&gt;

&lt;p&gt;1.5.0: 4c3f6075bcad0e85db947d7db7817a678d21a85e&lt;br/&gt;
1.4.1: 71ede3992afe8f6907dd3c6c1e232c5b745048b4&lt;/p&gt;</comment>
                            <comment id="16322270" author="githubbot" created="Thu, 11 Jan 2018 14:16:43 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    closed via 71ede3992afe8f6907dd3c6c1e232c5b745048b4&lt;/p&gt;</comment>
                            <comment id="16322271" author="githubbot" created="Thu, 11 Jan 2018 14:16:43 +0000"  >&lt;p&gt;Github user NicoK closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5276&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ok2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>