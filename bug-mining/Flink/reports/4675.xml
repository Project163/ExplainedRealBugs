<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19629]  Fix NullPointException when deserializing map field with null value for Avro format</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19629</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;create table tableA (&lt;br/&gt;
  name  STRING,&lt;br/&gt;
  hobly MAP&amp;lt;STRING, STRING&amp;gt;,&lt;br/&gt;
  phone STRING&lt;br/&gt;
) with (&lt;br/&gt;
  &apos;connector&apos; = &apos;kafka-0.11&apos;,&lt;br/&gt;
  &apos;topic&apos; = &apos;ShizcTest&apos;,&lt;br/&gt;
  &apos;properties.bootstrap.servers&apos; = &apos;localhost:9092&apos;,&lt;br/&gt;
  &apos;properties.group.id&apos; = &apos;ShizcTest&apos;,&lt;br/&gt;
  &apos;scan.startup.mode&apos; = &apos;earliest-offset&apos;,&lt;br/&gt;
  &apos;format&apos; = &apos;avro&apos;&lt;br/&gt;
);&lt;br/&gt;
if hobly have an null value like this:&lt;/p&gt;

&lt;p&gt;{&quot;name&quot;: &quot;shizc&quot;, &quot;hobly&quot;: &lt;/p&gt;
{&quot;key1&quot;:null}
&lt;p&gt;, &quot;phone&quot;: &quot;1104564&quot;}&lt;/p&gt;

&lt;p&gt;cause an NullPointException:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Failed to deserialize Avro record.
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.deserialize(AvroRowDataDeserializationSchema.java:150)
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.deserialize(AvroRowDataDeserializationSchema.java:75)
	at org.apache.flink.api.common.serialization.DeserializationSchema.deserialize(DeserializationSchema.java:81)
	at org.apache.flink.streaming.connectors.kafka.internals.KafkaDeserializationSchemaWrapper.deserialize(KafkaDeserializationSchemaWrapper.java:56)
	at org.apache.flink.streaming.connectors.kafka.internal.Kafka010Fetcher.runFetchLoop(Kafka010Fetcher.java:147)
	at org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumerBase.run(FlinkKafkaConsumerBase.java:755)
	at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:100)
	at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:63)
	at org.apache.flink.streaming.runtime.tasks.SourceStreamTask$LegacySourceFunctionThread.run(SourceStreamTask.java:201)
Caused by: java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.lambda$createConverter$57e941b$5(AvroRowDataDeserializationSchema.java:252)
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.lambda$createMapConverter$7941d275$1(AvroRowDataDeserializationSchema.java:315)
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.lambda$createNullableConverter$c3bac5d8$1(AvroRowDataDeserializationSchema.java:221)
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.lambda$createRowConverter$80d8b6bd$1(AvroRowDataDeserializationSchema.java:206)
	at org.apache.flink.formats.avro.AvroRowDataDeserializationSchema.deserialize(AvroRowDataDeserializationSchema.java:148)
	... 8 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13335333">FLINK-19629</key>
            <summary> Fix NullPointException when deserializing map field with null value for Avro format</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tinny">shizhengchao</assignee>
                                    <reporter username="tinny">shizhengchao</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 14 Oct 2020 03:18:40 +0000</created>
                <updated>Thu, 22 Oct 2020 12:31:36 +0000</updated>
                            <resolved>Thu, 22 Oct 2020 12:31:29 +0000</resolved>
                                    <version>1.11.2</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17213561" author="tinny" created="Wed, 14 Oct 2020 03:22:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, i can complete this work, could you assign it to me ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17213565" author="jark" created="Wed, 14 Oct 2020 03:30:48 +0000"  >&lt;p&gt;What&apos;s wrong with the example? Do you mean changing &lt;tt&gt;behavior STRING&lt;/tt&gt; to &lt;tt&gt;behavior STRING NULL&lt;/tt&gt;? However, datatypes are nullable by default and we don&apos;t support &lt;tt&gt;NULL&lt;/tt&gt; AFAIK.&lt;/p&gt;</comment>
                            <comment id="17213633" author="tinny" created="Wed, 14 Oct 2020 05:59:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; Thank you for reminding me that found this bug code: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; AvroToRowDataConverter createMapConverter(LogicalType type) {
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AvroToRowDataConverter keyConverter = createConverter(DataTypes.STRING().getLogicalType());
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AvroToRowDataConverter valueConverter = createConverter(extractValueTypeToAvroMap(type));

		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; avroObject -&amp;gt; {
			&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;?, ?&amp;gt; map = (Map&amp;lt;?, ?&amp;gt;) avroObject;
			Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;?, ?&amp;gt; entry : map.entrySet()) {
				&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; key = keyConverter.convert(entry.getKey());
				&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value = valueConverter.convert(entry.getValue());
				result.put(key, value);
			}
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericMapData(result);
		};
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; if you don&#8217;t have time to fix it, I can fix it and submit the code after verification.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="17213667" author="tinny" created="Wed, 14 Oct 2020 06:58:06 +0000"  >&lt;p&gt;This is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19622&quot; title=&quot;Flinksql version 1.11 is for the NullPointerException of the Map type value value in the avro format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-19622&quot;&gt;&lt;del&gt;FLINK-19622&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17218199" author="tinny" created="Wed, 21 Oct 2020 09:30:37 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; Can you help me review the code, thank you very mutch.&lt;/p&gt;</comment>
                            <comment id="17218265" author="jark" created="Wed, 21 Oct 2020 12:30:47 +0000"  >&lt;p&gt;Thanks for the reminder. Will review it. &lt;/p&gt;</comment>
                            <comment id="17218707" author="jark" created="Thu, 22 Oct 2020 02:57:02 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 3c661074b2a597db312ebaf6734c58eb66464ba4&lt;/li&gt;
	&lt;li&gt;release-1.11: 61a0760ee28795c1214efbd0a97ef02edc54b739&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13335321">FLINK-19622</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jonc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>