<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:37:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10149] Fink Mesos allocates extra port when not configured to do so</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10149</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Internal testing has revealed&#160;a small bug in the way LaunchableMesosWorker handles the absense of the new &lt;b&gt;mesos.resourcemanager.tasks.port-assignments&lt;/b&gt; config option.&lt;br/&gt;
It allocates an extra mesos port even when the option is not set.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13179047">FLINK-10149</key>
            <summary>Fink Mesos allocates extra port when not configured to do so</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gjy">Gary Yao</assignee>
                                    <reporter username="runeskoularsen">Rune Skou Larsen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 15 Aug 2018 10:41:15 +0000</created>
                <updated>Fri, 15 Mar 2019 12:21:28 +0000</updated>
                            <resolved>Mon, 3 Dec 2018 07:13:01 +0000</resolved>
                                    <version>1.6.1</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.1</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>Deployment / Mesos</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16580917" author="githubbot" created="Wed, 15 Aug 2018 10:45:54 +0000"  >&lt;p&gt;rsltrifork opened a new pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Make sure Flink only allocates the necessary mesos ports.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;br/&gt;
   Remove default value for config option, and treat absence correctly.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added unit test&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582687" author="githubbot" created="Thu, 16 Aug 2018 15:21:02 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#discussion_r210638112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#discussion_r210638112&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -137,7 +137,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Config parameter to configure which configuration keys will dynamically get a port assigned through Mesos.&lt;br/&gt;
 	 */&lt;br/&gt;
 	public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS = key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   change : &lt;/p&gt;

&lt;p&gt;   ```java&lt;br/&gt;
   public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS = key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   to : &lt;/p&gt;

&lt;p&gt;   ```java&lt;br/&gt;
   public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS = &lt;br/&gt;
       key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   let it match other configuration item&apos;s style,  looks better to me.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16625811" author="githubbot" created="Mon, 24 Sep 2018 13:22:04 +0000"  >&lt;p&gt;rsltrifork commented on issue #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#issuecomment-423972275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#issuecomment-423972275&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @yanghua Thanks for reviewing and sorry for taking so long to corect the formatting. I hope everything is ok now.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655077" author="githubbot" created="Thu, 18 Oct 2018 11:34:31 +0000"  >&lt;p&gt;GJL commented on a change in pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#discussion_r226269500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#discussion_r226269500&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -346,10 +346,12 @@ public String toString() {&lt;/p&gt;

&lt;p&gt; 		final String portKeys = config.getString(PORT_ASSIGNMENTS);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arrays.stream(portKeys.split(&quot;,&quot;))&lt;/li&gt;
	&lt;li&gt;.map(String::trim)&lt;/li&gt;
	&lt;li&gt;.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
	&lt;li&gt;.forEach(tmPortKeys::add);&lt;br/&gt;
+		if (portKeys != null) {&lt;br/&gt;
+			Arrays.stream(portKeys.split(&quot;,&quot;))&lt;br/&gt;
+				.map(String::trim)&lt;br/&gt;
+				.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Slf4j placeholders should be preferred, i.e., `LOG.debug(&quot;Adding port key {} to mesos request&quot;, key)`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655078" author="githubbot" created="Thu, 18 Oct 2018 11:34:40 +0000"  >&lt;p&gt;GJL commented on a change in pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#discussion_r226269500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#discussion_r226269500&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -346,10 +346,12 @@ public String toString() {&lt;/p&gt;

&lt;p&gt; 		final String portKeys = config.getString(PORT_ASSIGNMENTS);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arrays.stream(portKeys.split(&quot;,&quot;))&lt;/li&gt;
	&lt;li&gt;.map(String::trim)&lt;/li&gt;
	&lt;li&gt;.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
	&lt;li&gt;.forEach(tmPortKeys::add);&lt;br/&gt;
+		if (portKeys != null) {&lt;br/&gt;
+			Arrays.stream(portKeys.split(&quot;,&quot;))&lt;br/&gt;
+				.map(String::trim)&lt;br/&gt;
+				.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Slf4j placeholders should be preferred, i.e., `LOG.debug(&quot;Adding port key {} to mesos request&quot;, key)`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655285" author="githubbot" created="Thu, 18 Oct 2018 14:17:13 +0000"  >&lt;p&gt;GJL commented on issue #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#issuecomment-431026453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#issuecomment-431026453&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I have a question about code that was not touched in this PR but in an earlier one. Below is an extract from `LaunchableMesosWorker#launch()`:&lt;br/&gt;
   ```&lt;br/&gt;
   Set&amp;lt;String&amp;gt; tmPortKeys = extractPortKeys(containerSpec.getDynamicConfiguration());&lt;br/&gt;
   List&amp;lt;Protos.Resource&amp;gt; portResources = allocation.takeRanges(&quot;ports&quot;, tmPortKeys.size(), roles);&lt;br/&gt;
   taskInfo.addAllResources(portResources);&lt;br/&gt;
   Iterator&amp;lt;String&amp;gt; portsToAssign = tmPortKeys.iterator();&lt;br/&gt;
   rangeValues(portResources).forEach(port -&amp;gt; dynamicProperties.setLong(portsToAssign.next(), port));&lt;br/&gt;
   if (portsToAssign.hasNext()) &lt;/p&gt;
{
   	throw new IllegalArgumentException(&quot;insufficient # of ports assigned&quot;);
   }
&lt;p&gt;   ```&lt;br/&gt;
   Judging by the code, I can only assume that port ranges are not allowed, i.e., it is illegal to receive a port `Resource` where `begin != end`. I am not a Mesos expert &#8211; can you tell me whether my assumption is correct? If yes, additional checks should be added to `rangeValues` because this function allows port ranges, which can cause confusion.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655343" author="githubbot" created="Thu, 18 Oct 2018 14:41:47 +0000"  >&lt;p&gt;GJL commented on a change in pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#discussion_r226332516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#discussion_r226332516&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -52,4 +52,19 @@ public void canGetPortKeys() &lt;/p&gt;
{
 		assertEquals(&quot;port key must be correct&quot;, &quot;anotherport&quot;, iterator.next());
 	}

&lt;p&gt;+	@Test&lt;br/&gt;
+	public void canGetNoPortKeys() {&lt;br/&gt;
+		// Setup&lt;br/&gt;
+		Configuration config = new Configuration();&lt;br/&gt;
+&lt;br/&gt;
+		// Act&lt;br/&gt;
+		Set&amp;lt;String&amp;gt; portKeys = LaunchableMesosWorker.extractPortKeys(config);&lt;br/&gt;
+&lt;br/&gt;
+		// Assert&lt;br/&gt;
+		assertEquals(&quot;Must get right number of port keys&quot;, 2, portKeys.size());&lt;br/&gt;
+		Iterator&amp;lt;String&amp;gt; iterator = portKeys.iterator();&lt;br/&gt;
+		assertEquals(&quot;port key must be correct&quot;, LaunchableMesosWorker.TM_PORT_KEYS&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, iterator.next());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I find this test, and the implementation of `extractPortKeys` not ideal.&lt;/p&gt;

&lt;p&gt;   1. From the signature of `extractPortKeys` it is not obvious that the elements will be ordered.&lt;br/&gt;
   1. Generally speaking there is no order imposed on the elements of a `Set` but the order of iteration should be deterministic for all collections &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, i.e., if you iterate twice over the same instance of the collection, you get the same order, which should be good enough for your use case.&lt;br/&gt;
   1. Considering all above, the assertions can be simplified as &lt;br/&gt;
   ```&lt;br/&gt;
   assertThat(portKeys, containsInAnyOrder(LaunchableMesosWorker.TM_PORT_KEYS&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, LaunchableMesosWorker.TM_PORT_KEYS&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;));&lt;br/&gt;
   ```&lt;br/&gt;
   Note that this also asserts that the size matches.&lt;/p&gt;

&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://stackoverflow.com/a/27210701/9203198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/a/27210701/9203198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655344" author="githubbot" created="Thu, 18 Oct 2018 14:41:47 +0000"  >&lt;p&gt;GJL commented on a change in pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#discussion_r226269544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#discussion_r226269544&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -346,10 +346,12 @@ public String toString() {&lt;/p&gt;

&lt;p&gt; 		final String portKeys = config.getString(PORT_ASSIGNMENTS);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arrays.stream(portKeys.split(&quot;,&quot;))&lt;/li&gt;
	&lt;li&gt;.map(String::trim)&lt;/li&gt;
	&lt;li&gt;.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
	&lt;li&gt;.forEach(tmPortKeys::add);&lt;br/&gt;
+		if (portKeys != null) {&lt;br/&gt;
+			Arrays.stream(portKeys.split(&quot;,&quot;))&lt;br/&gt;
+				.map(String::trim)&lt;br/&gt;
+				.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Slf4j placeholders should be preferred, i.e., `LOG.debug(&quot;Adding port key {} to mesos request&quot;, key)`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655345" author="githubbot" created="Thu, 18 Oct 2018 14:41:47 +0000"  >&lt;p&gt;GJL commented on a change in pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#discussion_r226332854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#discussion_r226332854&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -346,10 +346,12 @@ public String toString() {&lt;/p&gt;

&lt;p&gt; 		final String portKeys = config.getString(PORT_ASSIGNMENTS);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arrays.stream(portKeys.split(&quot;,&quot;))&lt;/li&gt;
	&lt;li&gt;.map(String::trim)&lt;/li&gt;
	&lt;li&gt;.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
	&lt;li&gt;.forEach(tmPortKeys::add);&lt;br/&gt;
+		if (portKeys != null) 
{
+			Arrays.stream(portKeys.split(&quot;,&quot;))
+				.map(String::trim)
+				.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))
+				.forEach(tmPortKeys::add);
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		return tmPortKeys;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I&apos;d wrap the return value in `Collections.unmodifiableSet`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16655346" author="githubbot" created="Thu, 18 Oct 2018 14:43:34 +0000"  >&lt;p&gt;GJL removed a comment on issue #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#issuecomment-431026453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#issuecomment-431026453&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I have a question about code that was not touched in this PR but in an earlier one. Below is an extract from `LaunchableMesosWorker#launch()`:&lt;br/&gt;
   ```&lt;br/&gt;
   Set&amp;lt;String&amp;gt; tmPortKeys = extractPortKeys(containerSpec.getDynamicConfiguration());&lt;br/&gt;
   List&amp;lt;Protos.Resource&amp;gt; portResources = allocation.takeRanges(&quot;ports&quot;, tmPortKeys.size(), roles);&lt;br/&gt;
   taskInfo.addAllResources(portResources);&lt;br/&gt;
   Iterator&amp;lt;String&amp;gt; portsToAssign = tmPortKeys.iterator();&lt;br/&gt;
   rangeValues(portResources).forEach(port -&amp;gt; dynamicProperties.setLong(portsToAssign.next(), port));&lt;br/&gt;
   if (portsToAssign.hasNext()) &lt;/p&gt;
{
   	throw new IllegalArgumentException(&quot;insufficient # of ports assigned&quot;);
   }
&lt;p&gt;   ```&lt;br/&gt;
   Judging by the code, I can only assume that port ranges are not allowed, i.e., it is illegal to receive a port `Resource` where `begin != end`. I am not a Mesos expert &#8211; can you tell me whether my assumption is correct? If yes, additional checks should be added to `rangeValues` because this function allows port ranges, which can cause confusion.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704570" author="githubbot" created="Fri, 30 Nov 2018 10:56:38 +0000"  >&lt;p&gt;GJL opened a new pull request #7203: [&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7203&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   &lt;b&gt;Make sure Flink only allocates the necessary mesos ports. This PR is based on #6557&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;   cc: @runesl &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Remove default value for config option, and treat absence correctly.&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;See commits&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Added unit test in `LaunchableMesosWorkerTest`&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (*&lt;b&gt;yes&lt;/b&gt;* / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704573" author="githubbot" created="Fri, 30 Nov 2018 10:58:37 +0000"  >&lt;p&gt;GJL commented on issue #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557#issuecomment-443168598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557#issuecomment-443168598&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Closing because subsumed by #7203&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704574" author="githubbot" created="Fri, 30 Nov 2018 10:58:37 +0000"  >&lt;p&gt;GJL closed pull request #6557: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6557&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6557&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java b/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
index 426a891e814..0c4e1f6bcba 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
@@ -136,8 +136,9 @@&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Config parameter to configure which configuration keys will dynamically get a port assigned through Mesos.&lt;br/&gt;
 	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS = key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;/li&gt;
	&lt;li&gt;.defaultValue(&quot;&quot;)&lt;br/&gt;
+	public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS =&lt;br/&gt;
+		key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;br/&gt;
+		.noDefaultValue()&lt;br/&gt;
 		.withDescription(Description.builder()&lt;br/&gt;
 			.text(&quot;Comma-separated list of configuration keys which represent a configurable port. &quot; +&lt;br/&gt;
 				&quot;All port keys will dynamically get a port assigned through Mesos.&quot;)&lt;br/&gt;
diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
index bb15aee0a7f..e906ade3a72 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
@@ -346,10 +346,12 @@ public String toString() {&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		final String portKeys = config.getString(PORT_ASSIGNMENTS);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arrays.stream(portKeys.split(&quot;,&quot;))&lt;/li&gt;
	&lt;li&gt;.map(String::trim)&lt;/li&gt;
	&lt;li&gt;.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
	&lt;li&gt;.forEach(tmPortKeys::add);&lt;br/&gt;
+		if (portKeys != null) 
{
+			Arrays.stream(portKeys.split(&quot;,&quot;))
+				.map(String::trim)
+				.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))
+				.forEach(tmPortKeys::add);
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		return tmPortKeys;&lt;br/&gt;
 	}&lt;br/&gt;
diff --git a/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java b/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
index 6784e427c1f..7fc99d28db3 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
+++ b/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
@@ -52,4 +52,19 @@ public void canGetPortKeys() &lt;/p&gt;
{
 		assertEquals(&quot;port key must be correct&quot;, &quot;anotherport&quot;, iterator.next());
 	}

&lt;p&gt;+	@Test&lt;br/&gt;
+	public void canGetNoPortKeys() &lt;/p&gt;
{
+		// Setup
+		Configuration config = new Configuration();
+
+		// Act
+		Set&amp;lt;String&amp;gt; portKeys = LaunchableMesosWorker.extractPortKeys(config);
+
+		// Assert
+		assertEquals(&quot;Must get right number of port keys&quot;, 2, portKeys.size());
+		Iterator&amp;lt;String&amp;gt; iterator = portKeys.iterator();
+		assertEquals(&quot;port key must be correct&quot;, LaunchableMesosWorker.TM_PORT_KEYS[0], iterator.next());
+		assertEquals(&quot;port key must be correct&quot;, LaunchableMesosWorker.TM_PORT_KEYS[1], iterator.next());
+	}
&lt;p&gt;+&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706765" author="githubbot" created="Mon, 3 Dec 2018 07:04:49 +0000"  >&lt;p&gt;asfgit closed pull request #7203: [&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10149&quot; title=&quot;Fink Mesos allocates extra port when not configured to do so&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10149&quot;&gt;&lt;del&gt;FLINK-10149&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;mesos&amp;#93;&lt;/span&gt; Don&apos;t allocate extra mesos port for TM unless configured to do so&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7203&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java b/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
index 426a891e814..0c4e1f6bcba 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/configuration/MesosOptions.java&lt;br/&gt;
@@ -136,8 +136,9 @@&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Config parameter to configure which configuration keys will dynamically get a port assigned through Mesos.&lt;br/&gt;
 	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS = key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;/li&gt;
	&lt;li&gt;.defaultValue(&quot;&quot;)&lt;br/&gt;
+	public static final ConfigOption&amp;lt;String&amp;gt; PORT_ASSIGNMENTS =&lt;br/&gt;
+		key(&quot;mesos.resourcemanager.tasks.port-assignments&quot;)&lt;br/&gt;
+		.noDefaultValue()&lt;br/&gt;
 		.withDescription(Description.builder()&lt;br/&gt;
 			.text(&quot;Comma-separated list of configuration keys which represent a configurable port. &quot; +&lt;br/&gt;
 				&quot;All port keys will dynamically get a port assigned through Mesos.&quot;)&lt;br/&gt;
diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
index 84ec2229a2a..637442c899d 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java&lt;br/&gt;
@@ -41,6 +41,7 @@&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
 import java.util.Arrays;&lt;br/&gt;
 import java.util.Collections;&lt;br/&gt;
+import java.util.HashSet;&lt;br/&gt;
 import java.util.Iterator;&lt;br/&gt;
 import java.util.LinkedHashSet;&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
@@ -64,12 +65,13 @@&lt;br/&gt;
 public class LaunchableMesosWorker implements LaunchableTask {&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	protected static final Logger LOG = LoggerFactory.getLogger(LaunchableMesosWorker.class);&lt;br/&gt;
+&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The set of configuration keys to be dynamically configured with a port allocated from Mesos.&lt;br/&gt;
 	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;static final String[] TM_PORT_KEYS = 
{
+	static final Set&amp;lt;String&amp;gt; TM_PORT_KEYS = Collections.unmodifiableSet(new HashSet&amp;lt;&amp;gt;(Arrays.asList(
 		&quot;taskmanager.rpc.port&quot;,
-		&quot;taskmanager.data.port&quot;}
&lt;p&gt;;&lt;br/&gt;
+		&quot;taskmanager.data.port&quot;)));&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final MesosArtifactResolver resolver;&lt;br/&gt;
 	private final ContainerSpecification containerSpec;&lt;br/&gt;
@@ -342,16 +344,18 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return A deterministically ordered Set of port keys to expose from the TM container&lt;br/&gt;
 	 */&lt;br/&gt;
 	static Set&amp;lt;String&amp;gt; extractPortKeys(Configuration config) {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final LinkedHashSet&amp;lt;String&amp;gt; tmPortKeys = new LinkedHashSet&amp;lt;&amp;gt;(Arrays.asList(TM_PORT_KEYS));&lt;br/&gt;
+		final LinkedHashSet&amp;lt;String&amp;gt; tmPortKeys = new LinkedHashSet&amp;lt;&amp;gt;(TM_PORT_KEYS);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		final String portKeys = config.getString(PORT_ASSIGNMENTS);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arrays.stream(portKeys.split(&quot;,&quot;))&lt;/li&gt;
	&lt;li&gt;.map(String::trim)&lt;/li&gt;
	&lt;li&gt;.peek(key -&amp;gt; LOG.debug(&quot;Adding port key &quot; + key + &quot; to mesos request&quot;))&lt;/li&gt;
	&lt;li&gt;.forEach(tmPortKeys::add);&lt;br/&gt;
+		if (portKeys != null) {&lt;br/&gt;
+			Arrays.stream(portKeys.split(&quot;,&quot;))&lt;br/&gt;
+				.map(String::trim)&lt;br/&gt;
+				.peek(key -&amp;gt; LOG.debug(&quot;Adding port key {} to mesos request&quot;))&lt;br/&gt;
+				.forEach(tmPortKeys::add);&lt;br/&gt;
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return tmPortKeys;&lt;br/&gt;
+		return Collections.unmodifiableSet(tmPortKeys);&lt;br/&gt;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
diff --git a/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java b/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
index 6784e427c1f..48a436cb995 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
+++ b/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorkerTest.java&lt;br/&gt;
@@ -23,11 +23,14 @@&lt;/p&gt;

&lt;p&gt; import org.junit.Test;&lt;/p&gt;

&lt;p&gt;-import java.util.Iterator;&lt;br/&gt;
+import java.util.Arrays;&lt;br/&gt;
+import java.util.HashSet;&lt;br/&gt;
 import java.util.Set;&lt;/p&gt;

&lt;p&gt; import static org.apache.flink.mesos.configuration.MesosOptions.PORT_ASSIGNMENTS;&lt;br/&gt;
-import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.equalTo;&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.is;&lt;br/&gt;
+import static org.junit.Assert.assertThat;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Test that mesos config are extracted correctly from the configuration.&lt;br/&gt;
@@ -36,20 +39,31 @@&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Test&lt;br/&gt;
 	public void canGetPortKeys() &lt;/p&gt;
{
+		// Setup
+		Set&amp;lt;String&amp;gt; additionalPorts = new HashSet&amp;lt;&amp;gt;(Arrays.asList(&quot;someport.here&quot;, &quot;anotherport&quot;));
+
+		Configuration config = new Configuration();
+		config.setString(PORT_ASSIGNMENTS, String.join(&quot;,&quot;, additionalPorts));
+
+		// Act
+		Set&amp;lt;String&amp;gt; portKeys = LaunchableMesosWorker.extractPortKeys(config);
+
+		// Assert
+		Set&amp;lt;String&amp;gt; expectedPorts = new HashSet&amp;lt;&amp;gt;(LaunchableMesosWorker.TM_PORT_KEYS);
+		expectedPorts.addAll(additionalPorts);
+		assertThat(portKeys, is(equalTo(expectedPorts)));
+	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void canGetNoPortKeys() &lt;/p&gt;
{
 		// Setup
 		Configuration config = new Configuration();
-		config.setString(PORT_ASSIGNMENTS, &quot;someport.here,anotherport&quot;);
 
 		// Act
 		Set&amp;lt;String&amp;gt; portKeys = LaunchableMesosWorker.extractPortKeys(config);
 
 		// Assert
-		assertEquals(&quot;Must get right number of port keys&quot;, 4, portKeys.size());
-		Iterator&amp;lt;String&amp;gt; iterator = portKeys.iterator();
-		assertEquals(&quot;port key must be correct&quot;, LaunchableMesosWorker.TM_PORT_KEYS[0], iterator.next());
-		assertEquals(&quot;port key must be correct&quot;, LaunchableMesosWorker.TM_PORT_KEYS[1], iterator.next());
-		assertEquals(&quot;port key must be correct&quot;, &quot;someport.here&quot;, iterator.next());
-		assertEquals(&quot;port key must be correct&quot;, &quot;anotherport&quot;, iterator.next());
+		assertThat(portKeys, is(equalTo(LaunchableMesosWorker.TM_PORT_KEYS)));
 	}

&lt;p&gt; }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16706771" author="gjy" created="Mon, 3 Dec 2018 07:13:01 +0000"  >&lt;p&gt;fixed via&lt;br/&gt;
1.8: &lt;br/&gt;
	529288dfac1fb82b3c15d5acaeec2e54676a930d&lt;br/&gt;
	ffa0a9e453b8f770a8fe8db08f8324de330db569&lt;br/&gt;
	419a3535e8aa1688828c03ef022c7aee3ba56700&lt;br/&gt;
	8ba8337941fd1f53f217d0fe1dfe749467db9a82&lt;/p&gt;

&lt;p&gt;1.7:&lt;br/&gt;
	e82df4f07f0a4e82410db0d30013b8df32e66720&lt;br/&gt;
	e3017db7a54edea22b546d5f427b3f82ade56b25&lt;br/&gt;
	3108567f886177cba7ae72ad1dd5124c57987860&lt;br/&gt;
	0ff5f86f78a71ae77ccbe0e9abf5a387e339f67a&lt;/p&gt;

&lt;p&gt;1.6:&lt;br/&gt;
	b909d4d5bd96e492fe88db7a954b307f99d5c81d&lt;br/&gt;
	9b7b6af5fc50cacc5c0b4ab11c78f1046d1e010d&lt;br/&gt;
	bec8d7f5c0255dbdcee25cc9a023bb4cf86048be&lt;br/&gt;
	dbba9b072c001d6ebc852d4bf36424f9353916bb&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13169517">FLINK-9703</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x2bb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>