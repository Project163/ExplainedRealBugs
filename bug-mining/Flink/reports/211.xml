<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:18:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-1455] ExternalSortLargeRecordsITCase.testSortWithShortMediumAndLargeRecords: Potential Memory leak</title>
                <link>https://issues.apache.org/jira/browse/FLINK-1455</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This error occurred in one of my Travis jobs: &lt;a href=&quot;https://travis-ci.org/rmetzger/flink/jobs/48343022&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/rmetzger/flink/jobs/48343022&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Would be cool if somebody who knows the sorter better could verify/invalidate the issue.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Running org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase
java.lang.RuntimeException: Error obtaining the sorted input: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;SortMerger spilling thread&apos;&lt;/span&gt; terminated due to an exception: Cannot allocate memory
	at org.apache.flink.runtime.operators.sort.UnilateralSortMerger.getIterator(UnilateralSortMerger.java:593)
	at org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase.testSortWithShortMediumAndLargeRecords(ExternalSortLargeRecordsITCase.java:285)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:264)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:153)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:124)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:200)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:153)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:103)
Caused by: java.io.IOException: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;SortMerger spilling thread&apos;&lt;/span&gt; terminated due to an exception: Cannot allocate memory
	at org.apache.flink.runtime.operators.sort.UnilateralSortMerger$ThreadBase.run(UnilateralSortMerger.java:770)
Caused by: java.io.IOException: Cannot allocate memory
	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
	at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:93)
	at sun.nio.ch.IOUtil.write(IOUtil.java:65)
	at sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:205)
	at org.apache.flink.runtime.io.disk.iomanager.SegmentWriteRequest.write(AsynchronousFileIOChannel.java:267)
	at org.apache.flink.runtime.io.disk.iomanager.IOManagerAsync$WriterThread.run(IOManagerAsync.java:440)
Tests run: 5, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 56.089 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase
testSortWithShortMediumAndLargeRecords(org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase)  Time elapsed: 25.84 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Error obtaining the sorted input: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;SortMerger spilling thread&apos;&lt;/span&gt; terminated due to an exception: Cannot allocate memory
	at org.junit.Assert.fail(Assert.java:88)
	at org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase.testSortWithShortMediumAndLargeRecords(ExternalSortLargeRecordsITCase.java:304)

testSortWithShortMediumAndLargeRecords(org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase)  Time elapsed: 25.84 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Memory leak: not all segments have been returned to the memory manager.
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.assertTrue(Assert.java:41)
	at org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase.afterTest(ExternalSortLargeRecordsITCase.java:78)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12770095">FLINK-1455</key>
            <summary>ExternalSortLargeRecordsITCase.testSortWithShortMediumAndLargeRecords: Potential Memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sewen">Stephan Ewen</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jan 2015 14:31:30 +0000</created>
                <updated>Wed, 11 Feb 2015 16:44:35 +0000</updated>
                            <resolved>Wed, 11 Feb 2015 16:44:35 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14303334" author="stephanewen" created="Tue, 3 Feb 2015 14:27:44 +0000"  >&lt;p&gt;Hmm, this seems a problem of the JVM setup on the test cluster.&lt;/p&gt;

&lt;p&gt;The memory that it cannot allocate is not Flink memory, it is Java direct memory, which the NIO code internally needs for I/O: Buffers are copied to pooled DirectByteBuffers before issuing the I/O request.&lt;/p&gt;

&lt;p&gt;Not sure what is happening there, this is a standalone test, no other NIO memory consumers in the test. Seems like an issue with the Travis VMs.&lt;/p&gt;</comment>
                            <comment id="14307732" author="stephanewen" created="Thu, 5 Feb 2015 18:41:10 +0000"  >&lt;p&gt;Not a memory leak. The error message comes only because the JVM I/O problem caused the test to abort pre-maturely.&lt;/p&gt;

&lt;p&gt;The root cause is a spurious JVM failure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.io.IOException: Cannot allocate memory
	at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
	at sun.nio.ch.FileDispatcherImpl.write(FileDispatcherImpl.java:60)
	at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:93)
	at sun.nio.ch.IOUtil.write(IOUtil.java:65)
	at sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:205)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14316190" author="fhueske" created="Wed, 11 Feb 2015 13:26:42 +0000"  >&lt;p&gt;One of my Travis build failed on the same test case with the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testSortWithLongAndShortRecordsMixed(org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase)  Time elapsed: 15.515 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.junit.Assert.fail(Assert.java:86)
	at org.junit.Assert.assertTrue(Assert.java:41)
	at org.junit.Assert.assertTrue(Assert.java:52)
	at org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase.testSortWithLongAndShortRecordsMixed(ExternalSortLargeRecordsITCase.java:215)
testSortWithLongAndShortRecordsMixed(org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase)  Time elapsed: 15.515 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Memory leak: not all segments have been returned to the memory manager.
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.assertTrue(Assert.java:41)
	at org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase.afterTest(ExternalSortLargeRecordsITCase.java:81)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Full build logs on &lt;a href=&quot;https://travis-ci.org/fhueske/flink/jobs/50315959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Travis&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14316231" author="stephanewen" created="Wed, 11 Feb 2015 14:13:36 +0000"  >&lt;p&gt;Again, this is not a memory leak. See explanation above. The issue here is an assertion failure at {{ org.apache.flink.runtime.operators.sort.ExternalSortLargeRecordsITCase.testSortWithLongAndShortRecordsMixed(ExternalSortLargeRecordsITCase.java:215)}}.&lt;/p&gt;</comment>
                            <comment id="14316504" author="stephanewen" created="Wed, 11 Feb 2015 16:44:17 +0000"  >&lt;p&gt;I improved the robustness for the tests by making sure that memory leak checks happen only on successful tests and fixed the cause of the spurious failure.&lt;/p&gt;</comment>
                            <comment id="14316506" author="stephanewen" created="Wed, 11 Feb 2015 16:44:35 +0000"  >&lt;p&gt;Fixed (again) in f577c9ef42899479231304a033c4784c413be112&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24suf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>