<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:04:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23614] The resulting scale of TRUNCATE(DECIMAL, ...) is not correct</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23614</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Run the following SQL&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;TRUNCATE&lt;/span&gt;(123.456, 2),
  &lt;span class=&quot;code-keyword&quot;&gt;TRUNCATE&lt;/span&gt;(123.456, 0),
  &lt;span class=&quot;code-keyword&quot;&gt;TRUNCATE&lt;/span&gt;(123.456, -2),
  &lt;span class=&quot;code-keyword&quot;&gt;TRUNCATE&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(123.456 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DOUBLE&lt;/span&gt;), 2),
  &lt;span class=&quot;code-keyword&quot;&gt;TRUNCATE&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(123.456 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DOUBLE&lt;/span&gt;), 0),
  &lt;span class=&quot;code-keyword&quot;&gt;TRUNCATE&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;CAST&lt;/span&gt;(123.456 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DOUBLE&lt;/span&gt;), -2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The result is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
123.450
123.000
100.000
123.45
123.0
100.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems that the resulting scale of &lt;tt&gt;TRUNCATE(DECIMAL, ...)&lt;/tt&gt; is the same as that of the input decimal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13393400">FLINK-23614</key>
            <summary>The resulting scale of TRUNCATE(DECIMAL, ...) is not correct</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paul8263">Yao Zhang</assignee>
                                    <reporter username="TsReaper">Caizhi Weng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>starter</label>
                    </labels>
                <created>Wed, 4 Aug 2021 07:08:12 +0000</created>
                <updated>Wed, 15 Dec 2021 01:44:16 +0000</updated>
                            <resolved>Tue, 7 Sep 2021 09:13:36 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17394468" author="tsreaper" created="Fri, 6 Aug 2021 03:10:23 +0000"  >&lt;p&gt;This is because &lt;tt&gt;FlinkSqlOperatorTable#TRUNCATE&lt;/tt&gt; is using the function definition from Calcite&apos;s &lt;tt&gt;SqlStdOperatorTable#TRUNCATE&lt;/tt&gt;. The return type inference of this function is &lt;tt&gt;ARG0_NULLABLE&lt;/tt&gt; which causes this issue.&lt;/p&gt;

&lt;p&gt;Flink already has a self-defined return type inference for this (&lt;tt&gt;FlinkReturnTypes#ROUND_FUNCTION_NULLABLE&lt;/tt&gt;). See its usage in &lt;tt&gt;FlinkSqlOperatorTable#ROUND&lt;/tt&gt;. We just need to define our own truncate function and add some more tests.&lt;/p&gt;</comment>
                            <comment id="17394539" author="paul8263" created="Fri, 6 Aug 2021 06:15:27 +0000"  >&lt;p&gt;I&apos;m recently working on Flink SQL and could you please assign this to me?&lt;/p&gt;</comment>
                            <comment id="17394549" author="tsreaper" created="Fri, 6 Aug 2021 06:32:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paul8263&quot; class=&quot;user-hover&quot; rel=&quot;paul8263&quot;&gt;paul8263&lt;/a&gt;! I&apos;m glad that you&apos;d like to fix this issue and I&apos;ll also help for the review. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; would you help assign this issue?&lt;/p&gt;</comment>
                            <comment id="17394567" author="lzljs3620320" created="Fri, 6 Aug 2021 06:54:58 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17394684" author="paul8263" created="Fri, 6 Aug 2021 10:27:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=TsReaper&quot; class=&quot;user-hover&quot; rel=&quot;TsReaper&quot;&gt;TsReaper&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;By the way I found another issue that some methods in SqlFunctionUtils.java are not needed by BuiltInMethods.scala. For example, a sround method in SqlFunctionUtils.java is defined as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sround(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; b0, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; b1) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; sround(BigDecimal.valueOf(b0), b1).intValue();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But in BuiltInMethods.scala as shown below, the sround method is loaded from SqlFunctions(in Calcite runtime), apparently not from SqlFunctionUtils in Flink.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; ROUND_INT = Types.lookupMethod(classOf[SqlFunctions], &lt;span class=&quot;code-quote&quot;&gt;&quot;sround&quot;&lt;/span&gt;, classOf[Int], classOf[Int])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do I need to create another ticket for cleaning up those &quot;unnecessary&quot; methods?&lt;/p&gt;</comment>
                            <comment id="17395699" author="tsreaper" created="Mon, 9 Aug 2021 02:37:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paul8263&quot; class=&quot;user-hover&quot; rel=&quot;paul8263&quot;&gt;paul8263&lt;/a&gt; I believe this class is copied from Calcite. However as it&apos;s not intended to replace the original class in Calcite I think removing unused methods are reasonable.&lt;/p&gt;

&lt;p&gt;To check if a method is really unused it is not enough to see if it is called in the Flink code base. Some code generation may use these method as a string literal and we should really check that thoroughly. I think this is a good point but it may take some effort. What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17411067" author="lzljs3620320" created="Tue, 7 Sep 2021 09:13:36 +0000"  >&lt;p&gt;master: e55e6649da41621872f3a847dcd1dad2d97b017a&lt;/p&gt;</comment>
                            <comment id="17435744" author="godfreyhe" created="Fri, 29 Oct 2021 02:35:17 +0000"  >&lt;p&gt;1.14.1: 8c7cbcd9744378dccb4b6ab0493c7d273c69dfef&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tl9s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>