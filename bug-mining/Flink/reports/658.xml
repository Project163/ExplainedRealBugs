<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:21:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2866] Potential resource leak due to unclosed ObjectInputStream in FileSerializableStateHandle</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2866</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Here is related code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; T getState(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; classLoader) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    FSDataInputStream inStream = getFileSystem().open(getFilePath());
    ObjectInputStream ois = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InstantiationUtil.ClassLoaderObjectInputStream(inStream, classLoader);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (T) ois.readObject();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ObjectInputStream should be closed upon exit from the method&lt;/p&gt;</description>
                <environment></environment>
        <key id="12905836">FLINK-2866</key>
            <summary>Potential resource leak due to unclosed ObjectInputStream in FileSerializableStateHandle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tedyu">Zhihong Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Oct 2015 04:05:23 +0000</created>
                <updated>Sun, 25 Oct 2015 22:12:53 +0000</updated>
                            <resolved>Sun, 25 Oct 2015 22:12:44 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14967514" author="stephanewen" created="Wed, 21 Oct 2015 17:34:38 +0000"  >&lt;p&gt;The ObjectInputStream is resource-less and needs no closing, but the FsDataInputStream should be closed.&lt;/p&gt;</comment>
                            <comment id="14967517" author="stephanewen" created="Wed, 21 Oct 2015 17:34:53 +0000"  >&lt;p&gt;Thanks for spotting this, this should be fixed...&lt;/p&gt;</comment>
                            <comment id="14968405" author="githubbot" created="Thu, 22 Oct 2015 02:41:16 +0000"  >&lt;p&gt;GitHub user tedyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1282&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2866&quot; title=&quot;Potential resource leak due to unclosed ObjectInputStream in FileSerializableStateHandle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2866&quot;&gt;&lt;del&gt;FLINK-2866&lt;/del&gt;&lt;/a&gt; Potential resource leak due to unclosed ObjectInputStream in FileSerializableStateHandle&lt;/p&gt;

&lt;p&gt;    Use try-with-resources to close FSDataInputStream&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tedyu/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tedyu/flink&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1282.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1282.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1282&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5e10e07d1649a672f79871b223b35fb5f86b6c31&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-22T02:40:21Z&lt;/p&gt;

&lt;p&gt;    Use try-with-resources to close FSDataInputStream&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14968853" author="githubbot" created="Thu, 22 Oct 2015 09:25:29 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1282#issuecomment-150159711&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1282#issuecomment-150159711&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good fix, will merge this...&lt;/p&gt;</comment>
                            <comment id="14969484" author="githubbot" created="Thu, 22 Oct 2015 17:14:14 +0000"  >&lt;p&gt;GitHub user StephanEwen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2866&quot; title=&quot;Potential resource leak due to unclosed ObjectInputStream in FileSerializableStateHandle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2866&quot;&gt;&lt;del&gt;FLINK-2866&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2888&quot; title=&quot;Default state not copied for AbstractHeapKvState&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2888&quot;&gt;&lt;del&gt;FLINK-2888&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2891&quot; title=&quot;Key for Keyed State is not set upon Window Evaluation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2891&quot;&gt;&lt;del&gt;FLINK-2891&lt;/del&gt;&lt;/a&gt; Fixes for various release blocking issues&lt;/p&gt;

&lt;p&gt;    Default state value is returned as copies in key value state. To circumvent this (if ever becomes a performance issue), one can use null as the default state and manually check/initialize to an immutable default value.&lt;/p&gt;

&lt;p&gt;    Window user functions have access to key/value state even window is evaluated (part 2 - pert 1 was committed by Aljoscha earlier). The main part here is a rework of the PreAggregatingWindow tests to make them more meaningful.&lt;/p&gt;

&lt;p&gt;    This also includes #1282 &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StephanEwen/incubator-flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StephanEwen/incubator-flink&lt;/a&gt; multiple_fixes&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1289&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0a14e9ff3c499ca339d275b5ca58bed545f71519&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-22T02:40:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2866&quot; title=&quot;Potential resource leak due to unclosed ObjectInputStream in FileSerializableStateHandle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2866&quot;&gt;&lt;del&gt;FLINK-2866&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Eagerly close FSDataInputStream in file state handle&lt;/p&gt;

&lt;p&gt;    This closes #1282&lt;/p&gt;

&lt;p&gt;commit acbcc98e9cb09554b879f60af390dbb1485f03d6&lt;br/&gt;
Author: Stephan Ewen &amp;lt;sewen@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-10-22T09:24:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2888&quot; title=&quot;Default state not copied for AbstractHeapKvState&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2888&quot;&gt;&lt;del&gt;FLINK-2888&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; State backends return copies of the default values&lt;/p&gt;

&lt;p&gt;commit fca433e1652840c0d8c8de1c57bd988428cc6218&lt;br/&gt;
Author: Stephan Ewen &amp;lt;sewen@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-10-22T16:58:29Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2891&quot; title=&quot;Key for Keyed State is not set upon Window Evaluation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2891&quot;&gt;&lt;del&gt;FLINK-2891&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Set keys for key/value state in window evaluation of fast-path windows.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14969515" author="githubbot" created="Thu, 22 Oct 2015 17:35:30 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150299847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150299847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1&lt;br/&gt;
    Code looks good, I actually solved it the same way but got stuck on the tests... :smile: &lt;/p&gt;</comment>
                            <comment id="14970698" author="githubbot" created="Fri, 23 Oct 2015 09:18:01 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150525193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150525193&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    We should not open PRs that reference multiple JIRA. PR comments are only mirrored to the first JIRA issue.&lt;/p&gt;</comment>
                            <comment id="14971467" author="githubbot" created="Fri, 23 Oct 2015 17:55:38 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150646872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150646872&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    A new test fails very often:&lt;br/&gt;
      AccumulatingAlignedProcessingTimeWindowOperatorTest.testKeyValueStateInWindowFunction:782 expected:&amp;lt;4&amp;gt; but was:&amp;lt;1&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="14972617" author="githubbot" created="Sat, 24 Oct 2015 14:07:30 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150815829&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150815829&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yeah, it is hard to make these tests deterministic, as they depend on processing time trigger. Thought I found a trick, but it is apparently not a rock solid test. I&apos;ll try and rework the test for more stability...&lt;/p&gt;</comment>
                            <comment id="14972776" author="githubbot" created="Sat, 24 Oct 2015 18:01:27 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150837902&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150837902&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay, figured out that the cause of the problem was: The test UDF calls (evaluated in the processing time timer) emits elements before updating the state. The test driver already received all elements and checks the state before it is updated. Switching the statements seems to fix the instability...&lt;/p&gt;</comment>
                            <comment id="14972897" author="githubbot" created="Sat, 24 Oct 2015 22:32:56 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150859562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150859562&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fix seems to work, three successive Travis runs (15 builds) do pass now...&lt;/p&gt;</comment>
                            <comment id="14973140" author="githubbot" created="Sun, 25 Oct 2015 08:48:17 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150900971&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150900971&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ok, then we should merge it since this is blocking the release. :smile: &lt;/p&gt;</comment>
                            <comment id="14973455" author="githubbot" created="Sun, 25 Oct 2015 22:03:28 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1282&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14973456" author="githubbot" created="Sun, 25 Oct 2015 22:05:58 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289#issuecomment-150979276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289#issuecomment-150979276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Manually merged into branches `master` and `release-0.10`&lt;/p&gt;</comment>
                            <comment id="14973457" author="githubbot" created="Sun, 25 Oct 2015 22:05:58 +0000"  >&lt;p&gt;Github user StephanEwen closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1289&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14973459" author="stephanewen" created="Sun, 25 Oct 2015 22:12:44 +0000"  >&lt;p&gt;Fixed via 2d647151c729f707681dd5e2d226e4bbe0329bba&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n667:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>