<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9900] Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9900</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://api.travis-ci.org/v3/job/405843617/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/405843617/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 124.598 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.test.checkpointing.ZooKeeperHighAvailabilityITCase&lt;br/&gt;
 testRestoreBehaviourWithFaultyStateHandles(org.apache.flink.test.checkpointing.ZooKeeperHighAvailabilityITCase) Time elapsed: 120.036 sec &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
 org.junit.runners.model.TestTimedOutException: test timed out after 120000 milliseconds&lt;br/&gt;
 at sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
 at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)&lt;br/&gt;
 at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1693)&lt;br/&gt;
 at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)&lt;br/&gt;
 at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1729)&lt;br/&gt;
 at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)&lt;br/&gt;
 at org.apache.flink.test.checkpointing.ZooKeeperHighAvailabilityITCase.testRestoreBehaviourWithFaultyStateHandles(ZooKeeperHighAvailabilityITCase.java:244)&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error: &lt;br/&gt;
 ZooKeeperHighAvailabilityITCase.testRestoreBehaviourWithFaultyStateHandles:244 &#194;&#187; TestTimedOut&lt;/p&gt;

&lt;p&gt;Tests run: 1453, Failures: 0, Errors: 1, Skipped: 29&lt;/p&gt;</description>
                <environment></environment>
        <key id="13173349">FLINK-9900</key>
            <summary>Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="mingleizhang">zhangminglei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 20 Jul 2018 01:34:04 +0000</created>
                <updated>Mon, 8 Jun 2020 09:00:40 +0000</updated>
                            <resolved>Mon, 8 Jun 2020 08:59:52 +0000</resolved>
                                    <version>1.5.1</version>
                    <version>1.6.0</version>
                    <version>1.9.0</version>
                                                    <component>Runtime / Coordination</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16552137" author="till.rohrmann" created="Sun, 22 Jul 2018 19:50:29 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.org/v3/job/406882682/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/406882682/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16552939" author="githubbot" created="Mon, 23 Jul 2018 14:38:52 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6395&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden ZooKeeperHighAvailabilityITCase&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR makes a few modifications to the `ZooKeeperHighAvailabilityITCase` to reduce the chances for intermittent test failures and timeouts.&lt;/p&gt;

&lt;p&gt;    Changes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;1)&lt;br/&gt;
    The test was moving files out of the HA storage directory with a simple loop using `File#renameTo`. The test enforced that the moving is successful, however since old checkpoints may be deleted asynchronously this may not always be the case.&lt;br/&gt;
    We now use a `FileVisitor` and ignore `IOExceptions` that occur while moving.&lt;br/&gt;
    If no checkpoint file could be moved the test will still fail.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;2)&lt;br/&gt;
    After the checkpoint files were moved out of the HA storage directory the job is thrown into a restart loop. To verify the restart behavior the test was polling the job state and checked for the `RESTARTING` and `FAILING` states.&lt;br/&gt;
    Due to the small size the job is in these states only for a short time, effectively adding a race condition. Thus this loop mayrun for longer than anticipated; the largest outlier i got locally was 50 seconds which isn&apos;t &lt;em&gt;that&lt;/em&gt; for off from the 2 minute timeout. I suspect this to be the failure cause raised in the JIRA, but I can&apos;t guarantee it.&lt;br/&gt;
    Instead we now access the `fullRestarts` metric using a custom reporter to check how many restarts have occurred. The actual &lt;em&gt;state transitions&lt;/em&gt; should be irrelevant to the test.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 9900&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6395.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6395.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6395&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b8827dc3723558c52ad567bf88f24ae34129ea08&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-07-23T14:21:32Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden ZooKeeperHighAvailabilityITCase&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16559495" author="githubbot" created="Fri, 27 Jul 2018 09:43:50 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6395: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden ZooKeeperHighAvailabilityITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6395#discussion_r205721646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6395#discussion_r205721646&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -107,6 +119,8 @@ public static void setup() throws Exception {&lt;br/&gt;
 		config.setString(HighAvailabilityOptions.HA_ZOOKEEPER_QUORUM, zkServer.getConnectString());&lt;br/&gt;
 		config.setString(HighAvailabilityOptions.HA_MODE, &quot;zookeeper&quot;);&lt;/p&gt;

&lt;p&gt;+		config.setString(ConfigConstants.METRICS_REPORTER_PREFIX + &quot;restarts.&quot; + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX, RestartReporter.class.getName());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Break down line in two.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16561643" author="githubbot" created="Mon, 30 Jul 2018 08:45:54 +0000"  >&lt;p&gt;zentol closed pull request #6395: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden ZooKeeperHighAvailabilityITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6395&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
index e02ed010242..b83f89e4ca5 100644&lt;br/&gt;
&amp;#8212; a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
+++ b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
@@ -31,7 +31,12 @@&lt;br/&gt;
 import org.apache.flink.configuration.HighAvailabilityOptions;&lt;br/&gt;
 import org.apache.flink.configuration.TaskManagerOptions;&lt;br/&gt;
 import org.apache.flink.core.testutils.OneShotLatch;&lt;br/&gt;
+import org.apache.flink.metrics.Metric;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.MetricGroup;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.MetricReporter;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.FutureUtils;&lt;br/&gt;
+import org.apache.flink.runtime.executiongraph.metrics.NumberOfFullRestartsGauge;&lt;br/&gt;
 import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
 import org.apache.flink.runtime.jobgraph.JobStatus;&lt;br/&gt;
 import org.apache.flink.runtime.state.FunctionInitializationContext;&lt;br/&gt;
@@ -56,6 +61,12 @@&lt;br/&gt;
 import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
+import java.io.IOException;&lt;br/&gt;
+import java.nio.file.FileVisitResult;&lt;br/&gt;
+import java.nio.file.Files;&lt;br/&gt;
+import java.nio.file.Path;&lt;br/&gt;
+import java.nio.file.SimpleFileVisitor;&lt;br/&gt;
+import java.nio.file.attribute.BasicFileAttributes;&lt;br/&gt;
 import java.time.Duration;&lt;br/&gt;
 import java.util.UUID;&lt;br/&gt;
 import java.util.concurrent.CompletableFuture;&lt;br/&gt;
@@ -63,6 +74,7 @@&lt;br/&gt;
 import java.util.concurrent.atomic.AtomicInteger;&lt;/p&gt;

&lt;p&gt; import static org.hamcrest.core.Is.is;&lt;br/&gt;
+import static org.hamcrest.number.OrderingComparison.greaterThan;&lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertNotNull;&lt;br/&gt;
 import static org.junit.Assert.assertThat;&lt;br/&gt;
@@ -107,6 +119,10 @@ public static void setup() throws Exception {&lt;br/&gt;
 		config.setString(HighAvailabilityOptions.HA_ZOOKEEPER_QUORUM, zkServer.getConnectString());&lt;br/&gt;
 		config.setString(HighAvailabilityOptions.HA_MODE, &quot;zookeeper&quot;);&lt;/p&gt;

&lt;p&gt;+		config.setString(&lt;br/&gt;
+			ConfigConstants.METRICS_REPORTER_PREFIX + &quot;restarts.&quot; + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX,&lt;br/&gt;
+			RestartReporter.class.getName());&lt;br/&gt;
+&lt;br/&gt;
 		// we have to manage this manually because we have to create the ZooKeeper server&lt;br/&gt;
 		// ahead of this&lt;br/&gt;
 		miniClusterResource = new MiniClusterResource(&lt;br/&gt;
@@ -184,58 +200,59 @@ public void testRestoreBehaviourWithFaultyStateHandles() throws Exception {&lt;br/&gt;
 		// wait until we did some checkpoints&lt;br/&gt;
 		waitForCheckpointLatch.await();&lt;/p&gt;

&lt;p&gt;+		log.debug(&quot;Messing with HA directory&quot;);&lt;br/&gt;
 		// mess with the HA directory so that the job cannot restore&lt;br/&gt;
 		File movedCheckpointLocation = TEMPORARY_FOLDER.newFolder();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numCheckpoints = 0;&lt;/li&gt;
	&lt;li&gt;File[] files = haStorageDir.listFiles();&lt;/li&gt;
	&lt;li&gt;assertNotNull(files);&lt;/li&gt;
	&lt;li&gt;for (File file : files) {&lt;/li&gt;
	&lt;li&gt;if (file.getName().startsWith(&quot;completedCheckpoint&quot;)) {&lt;/li&gt;
	&lt;li&gt;assertTrue(file.renameTo(new File(movedCheckpointLocation, file.getName())));&lt;/li&gt;
	&lt;li&gt;numCheckpoints++;&lt;br/&gt;
+		AtomicInteger numCheckpoints = new AtomicInteger();&lt;br/&gt;
+		Files.walkFileTree(haStorageDir.toPath(), new SimpleFileVisitor&amp;lt;Path&amp;gt;() {&lt;br/&gt;
+			@Override&lt;br/&gt;
+			public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {&lt;br/&gt;
+				if (file.getFileName().toString().startsWith(&quot;completedCheckpoint&quot;)) {&lt;br/&gt;
+					log.debug(&quot;Moving original checkpoint file {}.&quot;, file);&lt;br/&gt;
+					try 
{
+						Files.move(file, movedCheckpointLocation.toPath().resolve(file.getFileName()));
+						numCheckpoints.incrementAndGet();
+					}
&lt;p&gt; catch (IOException ioe) &lt;/p&gt;
{
+						// previous checkpoint files may be deleted asynchronously
+						log.debug(&quot;Exception while moving HA files.&quot;, ioe);
+					}
&lt;p&gt;+				}&lt;br/&gt;
+				return FileVisitResult.CONTINUE;&lt;br/&gt;
 			}&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
+		});&lt;br/&gt;
+&lt;br/&gt;
 		// Note to future developers: This will break when we change Flink to not put the&lt;br/&gt;
 		// checkpoint metadata into the HA directory but instead rely on the fact that the&lt;br/&gt;
 		// actual checkpoint directory on DFS contains the checkpoint metadata. In this case,&lt;br/&gt;
 		// ZooKeeper will only contain a &quot;handle&quot; (read: String) that points to the metadata&lt;br/&gt;
 		// in DFS. The likely solution will be that we have to go directly to ZooKeeper, find&lt;br/&gt;
 		// out where the checkpoint is stored and mess with that.&lt;/li&gt;
	&lt;li&gt;assertTrue(numCheckpoints &amp;gt; 0);&lt;br/&gt;
+		assertTrue(numCheckpoints.get() &amp;gt; 0);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+		log.debug(&quot;Resuming job&quot;);&lt;br/&gt;
 		failInCheckpointLatch.trigger();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Ensure that we see at least one cycle where the job tries to restart and fails.&lt;/li&gt;
	&lt;li&gt;CompletableFuture&amp;lt;JobStatus&amp;gt; jobStatusFuture = FutureUtils.retrySuccesfulWithDelay(&lt;/li&gt;
	&lt;li&gt;() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;/li&gt;
	&lt;li&gt;Time.milliseconds(1),&lt;/li&gt;
	&lt;li&gt;deadline,&lt;/li&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.RESTARTING,&lt;/li&gt;
	&lt;li&gt;TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.RESTARTING, jobStatusFuture.get());&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;jobStatusFuture = FutureUtils.retrySuccesfulWithDelay(&lt;/li&gt;
	&lt;li&gt;() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;/li&gt;
	&lt;li&gt;Time.milliseconds(1),&lt;/li&gt;
	&lt;li&gt;deadline,&lt;/li&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FAILING,&lt;/li&gt;
	&lt;li&gt;TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FAILING, jobStatusFuture.get());&lt;br/&gt;
+		assertNotNull(&quot;fullRestarts metric could not be accessed.&quot;, RestartReporter.numRestarts);&lt;br/&gt;
+		while (RestartReporter.numRestarts.getValue() &amp;lt; 5 &amp;amp;&amp;amp; deadline.hasTimeLeft()) 
{
+			Thread.sleep(50);
+		}
&lt;p&gt;+		assertThat(RestartReporter.numRestarts.getValue(), is(greaterThan(4L)));&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		// move back the HA directory so that the job can restore&lt;br/&gt;
 		CheckpointBlockingFunction.afterMessWithZooKeeper.set(true);&lt;br/&gt;
+		log.debug(&quot;Restored zookeeper&quot;);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;files = movedCheckpointLocation.listFiles();&lt;/li&gt;
	&lt;li&gt;assertNotNull(files);&lt;/li&gt;
	&lt;li&gt;for (File file : files) {&lt;/li&gt;
	&lt;li&gt;if (file.getName().startsWith(&quot;completedCheckpoint&quot;)) {&lt;/li&gt;
	&lt;li&gt;assertTrue(file.renameTo(new File(haStorageDir, file.getName())));&lt;br/&gt;
+		Files.walkFileTree(movedCheckpointLocation.toPath(), new SimpleFileVisitor&amp;lt;Path&amp;gt;() {&lt;br/&gt;
+			@Override&lt;br/&gt;
+			public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException 
{
+				Files.move(file, haStorageDir.toPath().resolve(file.getFileName()));
+				return FileVisitResult.CONTINUE;
 			}&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
+		});&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		// now the job should be able to go to RUNNING again and then eventually to FINISHED,&lt;br/&gt;
 		// which it only does if it could successfully restore&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jobStatusFuture = FutureUtils.retrySuccesfulWithDelay(&lt;br/&gt;
+		CompletableFuture&amp;lt;JobStatus&amp;gt; jobStatusFuture = FutureUtils.retrySuccesfulWithDelay(&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;br/&gt;
@@ -324,4 +341,30 @@ public void initializeState(FunctionInitializationContext context) {&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Reporter that exposes the 
{@link NumberOfFullRestartsGauge}
&lt;p&gt; metric.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static class RestartReporter implements MetricReporter {&lt;br/&gt;
+		static volatile NumberOfFullRestartsGauge numRestarts = null;&lt;br/&gt;
+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public void open(MetricConfig metricConfig) &lt;/p&gt;
{
+		}&lt;br/&gt;
+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public void close() {+		}
&lt;p&gt;+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public void notifyOfAddedMetric(Metric metric, String s, MetricGroup metricGroup) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (metric instanceof NumberOfFullRestartsGauge) {
+				numRestarts = (NumberOfFullRestartsGauge) metric;
+			}+		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public void notifyOfRemovedMetric(Metric metric, String s, MetricGroup metricGroup) &lt;/p&gt;
{
+		}
&lt;p&gt;+	}&lt;br/&gt;
 }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16561646" author="zentol" created="Mon, 30 Jul 2018 08:48:34 +0000"  >&lt;p&gt;master: a278d5930670bfb58bd06109f468aa7f75c6aee0&lt;br/&gt;
1.6: 53e747272a0b8841e763f56d70e223d7de03d7bb&lt;br/&gt;
1.5: 0d8498de5ff3f3ce7c860be3e18162edd8138b63&lt;/p&gt;</comment>
                            <comment id="16565000" author="zentol" created="Wed, 1 Aug 2018 08:53:47 +0000"  >&lt;p&gt;has occurred again&lt;/p&gt;</comment>
                            <comment id="16565083" author="githubbot" created="Wed, 1 Aug 2018 10:03:48 +0000"  >&lt;p&gt;zentol opened a new pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   With this PR we include more debugging information in the error message if the `ZookeeperHighAvailabilityITCase` times out.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;remove `Timeout` annotation to a) deduplicate timeout logics and b) allow addition of new logic&lt;/li&gt;
	&lt;li&gt;add utility method creating thread dump&lt;/li&gt;
	&lt;li&gt;on failure to retrieve job information or if the job isn&apos;t in `FINISHED` state, print more debug info&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16565539" author="githubbot" created="Wed, 1 Aug 2018 16:00:45 +0000"  >&lt;p&gt;yanghua commented on issue #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#issuecomment-409626058&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#issuecomment-409626058&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   +1&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16575789" author="githubbot" created="Fri, 10 Aug 2018 06:11:55 +0000"  >&lt;p&gt;yanghua commented on issue #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#issuecomment-411985618&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#issuecomment-411985618&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   hi @zentol , checkstyle error : &lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;312&amp;#93;&lt;/span&gt; (regexp) RegexpSingleline: Trailing whitespace&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16576188" author="githubbot" created="Fri, 10 Aug 2018 12:04:21 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#discussion_r209236626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#discussion_r209236626&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Could probably use `Throwable.printStackTrace(PrintWriter)` instead.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16579425" author="githubbot" created="Tue, 14 Aug 2018 08:21:39 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#discussion_r209865380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#discussion_r209865380&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   but doesn&apos;t that just print the exception stack trace, whereas this method prints a full thread dump?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16579432" author="githubbot" created="Tue, 14 Aug 2018 08:26:44 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#discussion_r209866827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#discussion_r209866827&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Sure, but you could use it in the loop that iterates all thread info objects to create the trace string per thread, which you can set via the `Throwable.setStackTrace` before printing?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16579434" author="githubbot" created="Tue, 14 Aug 2018 08:27:56 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#discussion_r209867134&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#discussion_r209867134&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   ah ok, that makes sense.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16579487" author="githubbot" created="Tue, 14 Aug 2018 09:09:05 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#discussion_r209879523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#discussion_r209879523&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   The output is nicer if we go with the original option:&lt;br/&gt;
   without Throwable (i.e. current PR revision):&lt;br/&gt;
   ```&lt;br/&gt;
   &quot;Monitor Ctrl-Break&quot;&lt;br/&gt;
      java.lang.Thread.State: RUNNABLE&lt;br/&gt;
           at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
           at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)&lt;br/&gt;
           at java.net.SocketInputStream.read(SocketInputStream.java:170)&lt;br/&gt;
           at java.net.SocketInputStream.read(SocketInputStream.java:141)&lt;br/&gt;
           at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)&lt;br/&gt;
           at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)&lt;br/&gt;
           at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)&lt;br/&gt;
           at java.io.InputStreamReader.read(InputStreamReader.java:184)&lt;br/&gt;
           at java.io.BufferedReader.fill(BufferedReader.java:161)&lt;br/&gt;
           at java.io.BufferedReader.readLine(BufferedReader.java:324)&lt;br/&gt;
           at java.io.BufferedReader.readLine(BufferedReader.java:389)&lt;br/&gt;
           at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:64)&lt;br/&gt;
   ```&lt;br/&gt;
   with throwable:&lt;br/&gt;
   ```&lt;br/&gt;
   &quot;Monitor Ctrl-Break&quot;&lt;br/&gt;
      java.lang.Thread.State: RUNNABLE&lt;br/&gt;
   java.lang.Throwable&lt;br/&gt;
   	at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
   	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)&lt;br/&gt;
   	at java.net.SocketInputStream.read(SocketInputStream.java:170)&lt;br/&gt;
   	at java.net.SocketInputStream.read(SocketInputStream.java:141)&lt;br/&gt;
   	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)&lt;br/&gt;
   	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)&lt;br/&gt;
   	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)&lt;br/&gt;
   	at java.io.InputStreamReader.read(InputStreamReader.java:184)&lt;br/&gt;
   	at java.io.BufferedReader.fill(BufferedReader.java:161)&lt;br/&gt;
   	at java.io.BufferedReader.readLine(BufferedReader.java:324)&lt;br/&gt;
   	at java.io.BufferedReader.readLine(BufferedReader.java:389)&lt;br/&gt;
   	at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:64)&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   The `java.lang.Throwable` pops up for every thread. It would be better if it looks as one would expect a thread dump to look like. WDYT?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16579495" author="githubbot" created="Tue, 14 Aug 2018 09:16:52 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468#discussion_r209881971&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468#discussion_r209881971&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Fine with me, especially when we consider that the code is probably not permanently there.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16586104" author="githubbot" created="Mon, 20 Aug 2018 15:40:50 +0000"  >&lt;p&gt;zentol closed pull request #6468: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9900&quot; title=&quot;Fix unstable test ZooKeeperHighAvailabilityITCase#testRestoreBehaviourWithFaultyStateHandles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9900&quot;&gt;&lt;del&gt;FLINK-9900&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Include more information on timeout in Zookeeper HA ITCase&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6468&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
index b83f89e4ca5..642af40aaf2 100644&lt;br/&gt;
&amp;#8212; a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
+++ b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/ZooKeeperHighAvailabilityITCase.java&lt;br/&gt;
@@ -50,6 +50,7 @@&lt;br/&gt;
 import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
 import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
 import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+import org.apache.flink.util.ExceptionUtils;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;/p&gt;

&lt;p&gt;@@ -62,6 +63,11 @@&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
+import java.io.PrintWriter;&lt;br/&gt;
+import java.io.StringWriter;&lt;br/&gt;
+import java.lang.management.ManagementFactory;&lt;br/&gt;
+import java.lang.management.ThreadInfo;&lt;br/&gt;
+import java.lang.management.ThreadMXBean;&lt;br/&gt;
 import java.nio.file.FileVisitResult;&lt;br/&gt;
 import java.nio.file.Files;&lt;br/&gt;
 import java.nio.file.Path;&lt;br/&gt;
@@ -163,7 +169,7 @@ public static void tearDown() throws Exception {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;restored successfully&lt;/li&gt;
	&lt;li&gt;&amp;lt;/ol&amp;gt;&lt;br/&gt;
 	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test(timeout = 120_000L)&lt;br/&gt;
+	@Test&lt;br/&gt;
 	public void testRestoreBehaviourWithFaultyStateHandles() throws Exception {&lt;br/&gt;
 		CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.set(1);&lt;br/&gt;
 		CheckpointBlockingFunction.successfulRestores.set(0);&lt;br/&gt;
@@ -256,13 +262,54 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IO&lt;br/&gt;
 			() -&amp;gt; clusterClient.getJobStatus(jobID),&lt;br/&gt;
 			Time.milliseconds(50),&lt;br/&gt;
 			deadline,&lt;/li&gt;
	&lt;li&gt;(jobStatus) -&amp;gt; jobStatus == JobStatus.FINISHED,&lt;br/&gt;
+			JobStatus::isGloballyTerminalState,&lt;br/&gt;
 			TestingUtils.defaultScheduledExecutor());&lt;/li&gt;
	&lt;li&gt;assertEquals(JobStatus.FINISHED, jobStatusFuture.get());&lt;br/&gt;
+		try 
{
+			assertEquals(JobStatus.FINISHED, jobStatusFuture.get());
+		}
&lt;p&gt; catch (Throwable e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			// include additional debugging information+			StringWriter error = new StringWriter();+			try (PrintWriter out = new PrintWriter(error)) {
+				out.println(&quot;The job did not finish in time.&quot;);
+				out.println(&quot;allowedInitializeCallsWithoutRestore= &quot; + CheckpointBlockingFunction.allowedInitializeCallsWithoutRestore.get());
+				out.println(&quot;illegalRestores= &quot; + CheckpointBlockingFunction.illegalRestores.get());
+				out.println(&quot;successfulRestores= &quot; + CheckpointBlockingFunction.successfulRestores.get());
+				out.println(&quot;afterMessWithZooKeeper= &quot; + CheckpointBlockingFunction.afterMessWithZooKeeper.get());
+				out.println(&quot;failedAlready= &quot; + CheckpointBlockingFunction.failedAlready.get());
+				out.println(&quot;currentJobStatus= &quot; + clusterClient.getJobStatus(jobID).get());
+				out.println(&quot;numRestarts= &quot; + RestartReporter.numRestarts.getValue());
+				out.println(&quot;threadDump= &quot; + generateThreadDump());
+			}+			throw new AssertionError(error.toString(), ExceptionUtils.stripCompletionException(e));+		}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		assertThat(&quot;We saw illegal restores.&quot;, CheckpointBlockingFunction.illegalRestores.get(), is(0));&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static String generateThreadDump() {&lt;br/&gt;
+		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
+		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
+		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
+		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			dump.append(threadInfo.getThreadName());&lt;br/&gt;
+			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
+			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(&quot;   java.lang.Thread.State: &quot;);&lt;br/&gt;
+			dump.append(state);&lt;br/&gt;
+			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
+			for (final StackTraceElement stackTraceElement : stackTraceElements) &lt;/p&gt;
{
+				dump.append(System.lineSeparator());
+				dump.append(&quot;        at &quot;);
+				dump.append(stackTraceElement);
+			}
&lt;p&gt;+			dump.append(System.lineSeparator());&lt;br/&gt;
+			dump.append(System.lineSeparator());&lt;br/&gt;
+		}&lt;br/&gt;
+		return dump.toString();&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
 	private static class UnboundedSource implements SourceFunction&amp;lt;String&amp;gt; {&lt;br/&gt;
 		private volatile boolean running = true;&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16766913" author="sunjincheng121" created="Wed, 13 Feb 2019 08:17:06 +0000"  >&lt;p&gt;Can we close the JIRA due to the PRs has been merged. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingleizhang&quot; class=&quot;user-hover&quot; rel=&quot;mingleizhang&quot;&gt;mingleizhang&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="16766966" author="zentol" created="Wed, 13 Feb 2019 09:22:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt; No, because these only added more debugging details and did not fix the underlying issue.&lt;/p&gt;</comment>
                            <comment id="16774231" author="srichter" created="Thu, 21 Feb 2019 16:08:18 +0000"  >&lt;p&gt;Saw another instance here: &lt;a href=&quot;https://api.travis-ci.org/v3/job/495933065/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/495933065/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16865394" author="dawidwys" created="Mon, 17 Jun 2019 07:20:49 +0000"  >&lt;p&gt;I saw this test failing also with 1.9 master: &lt;a href=&quot;https://api.travis-ci.org/v3/job/546443720/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/546443720/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The cause might be different though, as I got a different error.&lt;/p&gt;</comment>
                            <comment id="16869224" author="yunta" created="Fri, 21 Jun 2019 06:29:57 +0000"  >&lt;p&gt;Another instance which exceed 300 seconds &lt;a href=&quot;https://api.travis-ci.org/v3/job/548326670/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/548326670/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16880107" author="till.rohrmann" created="Mon, 8 Jul 2019 08:07:46 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.org/v3/job/555252049/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/555252049/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16880415" author="till.rohrmann" created="Mon, 8 Jul 2019 14:34:10 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.org/v3/job/554991848/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/554991848/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16889976" author="azagrebin" created="Mon, 22 Jul 2019 07:46:02 +0000"  >&lt;p&gt;Looks like one more:&#160;&lt;a href=&quot;https://api.travis-ci.com/v3/job/217584395/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/217584395/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16893912" author="till.rohrmann" created="Fri, 26 Jul 2019 15:34:19 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.org/v3/job/563889124/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/563889124/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16894711" author="klion26" created="Sun, 28 Jul 2019 14:24:19 +0000"  >&lt;p&gt;Another instance &lt;a href=&quot;https://travis-ci.com/flink-ci/flink/jobs/220237256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.com/flink-ci/flink/jobs/220237256&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16895150" author="stephanewen" created="Mon, 29 Jul 2019 11:22:48 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.org/v3/job/564847877/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/564847877/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16895155" author="till.rohrmann" created="Mon, 29 Jul 2019 11:30:13 +0000"  >&lt;p&gt;Made a blocker issue to understand what the cause is.&lt;/p&gt;</comment>
                            <comment id="16895793" author="sleepy" created="Tue, 30 Jul 2019 05:13:51 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, I have built a PR to fix this. The unstable scenario is a bit complicated. I described the details in PR, &lt;a href=&quot;https://github.com/apache/flink/pull/9269&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9269&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16895827" author="tzulitai" created="Tue, 30 Jul 2019 06:37:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SleePy&quot; class=&quot;user-hover&quot; rel=&quot;SleePy&quot;&gt;SleePy&lt;/a&gt; could you move this ticket to &quot;In Progress&quot;? That way we will be able to see that it is actively worked on in the 1.9 burndown chart.&lt;/p&gt;</comment>
                            <comment id="16895873" author="sleepy" created="Tue, 30 Jul 2019 07:50:42 +0000"  >&lt;p&gt;Hi Gordon, I think it&apos;s already under &quot;In progress&quot;. I am not in office currently. I updated the state through my phone. I&apos;ll make sure later when I&apos;m back to office.&lt;/p&gt;</comment>
                            <comment id="16896182" author="till.rohrmann" created="Tue, 30 Jul 2019 14:32:31 +0000"  >&lt;p&gt;I think this test instability actually points towards an inconsistency which we introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-12364&quot; title=&quot;Introduce a CheckpointFailureManager to centralized manage checkpoint failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-12364&quot;&gt;&lt;del&gt;FLINK-12364&lt;/del&gt;&lt;/a&gt;. It seems that it is now possible that we complete checkpoints after the &lt;tt&gt;CheckpointFailureManager&lt;/tt&gt; has decided that the job should fail. I think this is a somewhat unexpected behavior.&lt;/p&gt;</comment>
                            <comment id="16896376" author="till.rohrmann" created="Tue, 30 Jul 2019 18:21:39 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.com/v3/job/220853113/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/220853113/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16897844" author="sleepy" created="Thu, 1 Aug 2019 07:50:24 +0000"  >&lt;p&gt;Another instance, &lt;a href=&quot;https://travis-ci.com/flink-ci/flink/jobs/221451189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.com/flink-ci/flink/jobs/221451189&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16898169" author="till.rohrmann" created="Thu, 1 Aug 2019 15:53:02 +0000"  >&lt;p&gt;Hardened the test against failures introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497&quot; title=&quot;Checkpoints can complete after CheckpointFailureManager fails job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13497&quot;&gt;&lt;del&gt;FLINK-13497&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;1.10.0: 51582b6d837aeb646686a1497514f51cf5fa0702&lt;br/&gt;
1.9.0: 375a5a3fa299fc7abd7a84667eba5c16cc6220af&lt;/p&gt;</comment>
                            <comment id="16907280" author="till.rohrmann" created="Wed, 14 Aug 2019 13:51:19 +0000"  >&lt;p&gt;The test is still unstable: &lt;a href=&quot;https://api.travis-ci.com/v3/job/221539953/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/221539953/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SleePy&quot; class=&quot;user-hover&quot; rel=&quot;SleePy&quot;&gt;SleePy&lt;/a&gt; could you take another look at it?&lt;/p&gt;</comment>
                            <comment id="16907287" author="sleepy" created="Wed, 14 Aug 2019 14:03:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; I will check it later.&lt;/p&gt;</comment>
                            <comment id="16907343" author="sleepy" created="Wed, 14 Aug 2019 15:11:35 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, I have just checked the failed building. The PR (&lt;a href=&quot;https://github.com/apache/flink/pull/9317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9317&lt;/a&gt;) is a bit old. It does not include the fixing on this ticket. Could you rebase master branch and try it again?&lt;/p&gt;</comment>
                            <comment id="16907864" author="till.rohrmann" created="Thu, 15 Aug 2019 06:56:23 +0000"  >&lt;p&gt;You are right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SleePy&quot; class=&quot;user-hover&quot; rel=&quot;SleePy&quot;&gt;SleePy&lt;/a&gt;. However I found another instance from the latest master cron job where it failed: &lt;a href=&quot;https://api.travis-ci.org/v3/job/571776566/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/571776566/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16907873" author="sleepy" created="Thu, 15 Aug 2019 07:04:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, thanks for feedback.&lt;/p&gt;

&lt;p&gt;It seems to be a different scenario of this case. The stack is different with the prior one.&lt;/p&gt;

&lt;p&gt;I&apos;ll check it later. Let&apos;s keep the &quot;reopened&quot; status for now.&lt;/p&gt;</comment>
                            <comment id="16908843" author="sleepy" created="Fri, 16 Aug 2019 08:25:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, there is another race condition of this case. However the good news is that it&apos;s just about the case, not a bug.&lt;br/&gt;
I have started a PR to fix it.&lt;/p&gt;</comment>
                            <comment id="16909013" author="till.rohrmann" created="Fri, 16 Aug 2019 12:21:38 +0000"  >&lt;p&gt;Great to hear &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SleePy&quot; class=&quot;user-hover&quot; rel=&quot;SleePy&quot;&gt;SleePy&lt;/a&gt;. I&apos;ll take a look at your PR.&lt;/p&gt;</comment>
                            <comment id="16909028" author="till.rohrmann" created="Fri, 16 Aug 2019 12:46:58 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.10.0: 3e0e030b41ba7dfcc4d85b7c776ae9627a51f838&lt;br/&gt;
1.9.1: fc7aeffd83d390d9a9452e8fcc55aec0c9d23cac&lt;/p&gt;</comment>
                            <comment id="17099721" author="rmetzger" created="Tue, 5 May 2020 09:39:47 +0000"  >&lt;p&gt;Another instance on 1.11-SNAPSHOT: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=593&amp;amp;view=logs&amp;amp;j=16ccbdb7-2a3e-53da-36eb-fb718edc424a&amp;amp;t=cf61ce33-6fba-5fbe-2c0c-e41c4013e891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=593&amp;amp;view=logs&amp;amp;j=16ccbdb7-2a3e-53da-36eb-fb718edc424a&amp;amp;t=cf61ce33-6fba-5fbe-2c0c-e41c4013e891&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17100963" author="till.rohrmann" created="Wed, 6 May 2020 16:37:47 +0000"  >&lt;p&gt;The current fixes seem to not fully fix the problem &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SleePy&quot; class=&quot;user-hover&quot; rel=&quot;SleePy&quot;&gt;SleePy&lt;/a&gt;. Do you have time to take another look at the problem Robert reported?&lt;/p&gt;</comment>
                            <comment id="17101335" author="sleepy" created="Thu, 7 May 2020 03:04:15 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; for reporting.&lt;br/&gt;
This time, the case failed to submit job to cluster. The cluster didn&apos;t start the job within 10 seconds, so timeout happened. It&apos;s hard to say which step it got stuck in. The last log of &lt;tt&gt;JobMaster&lt;/tt&gt; is &quot;Configuring application-defined state backend with job/cluster config&quot;. I have attached the relevant log (mvn-2.log).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; do you have any idea?&lt;/p&gt;</comment>
                            <comment id="17123719" author="zentol" created="Tue, 2 Jun 2020 12:32:02 +0000"  >&lt;p&gt;I would ignore the recent failure for the time being since it occurred in the legacy scheduler. I could not reproduce the failure locally after ~1000 runs.&lt;/p&gt;</comment>
                            <comment id="17125709" author="carp84" created="Thu, 4 Jun 2020 08:59:26 +0000"  >&lt;p&gt;Update the fix versions since 1.9.1 and 1.10.0 are already released.&lt;/p&gt;</comment>
                            <comment id="17128038" author="till.rohrmann" created="Mon, 8 Jun 2020 08:58:43 +0000"  >&lt;p&gt;The latest test failure has been caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16866&quot; title=&quot;Make job submission non-blocking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16866&quot;&gt;&lt;del&gt;FLINK-16866&lt;/del&gt;&lt;/a&gt; because the job submission took longer than 10 seconds. I would be ok with closing this ticket for the moment. If the problem should re-occur, then I would suggest to increase the rpc timeouts for the &lt;tt&gt;MiniCluster&lt;/tt&gt; as a hotfix (similar to what we did in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16018&quot; title=&quot;Improve error reporting when submitting batch job (instead of AskTimeoutException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16018&quot;&gt;&lt;del&gt;FLINK-16018&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;The problem should be ultimately gone once &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16866&quot; title=&quot;Make job submission non-blocking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16866&quot;&gt;&lt;del&gt;FLINK-16866&lt;/del&gt;&lt;/a&gt; has been implemented.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13247868">FLINK-13497</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13002243" name="mvn-2.log" size="48813249" author="SleePy" created="Thu, 7 May 2020 03:03:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w3gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>