<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15248] FileUtils#compressDirectory behaves buggy when processing relative directory path</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15248</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;em&gt;FileUtils#compressDirectory&lt;/em&gt; behaves buggy when processing relative directory path. If the path of target directory is a relative path, the relative path inside the target zip file&#160;can not be constructed correctly:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Path compressDirectory(Path directory, Path target) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
   FileSystem sourceFs = directory.getFileSystem();
   FileSystem targetFs = target.getFileSystem();

   &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (ZipOutputStream out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipOutputStream(targetFs.create(target, FileSystem.WriteMode.NO_OVERWRITE))) {
      addToZip(directory, sourceFs, directory.getParent(), out);
   }
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; target;
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void addToZip(Path fileOrDirectory, FileSystem fs, Path rootDir, ZipOutputStream out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; relativePath = fileOrDirectory.getPath().replace(rootDir.getPath() + &lt;span class=&quot;code-quote&quot;&gt;&apos;/&apos;&lt;/span&gt;, &quot;&quot;);
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fs.getFileStatus(fileOrDirectory).isDir()) {
      out.putNextEntry(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipEntry(relativePath + &lt;span class=&quot;code-quote&quot;&gt;&apos;/&apos;&lt;/span&gt;));
      
      &lt;span class=&quot;code-comment&quot;&gt;// The containedFile.getPath() returns an absolute path but the rootDir
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// could be a relative path or an empty string (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; user only specify the 
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// directory name as the relative path). In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when calling &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; 
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// method recursively the string replacement at the beginning of it will
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; a wrong result.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus containedFile : fs.listStatus(fileOrDirectory)) {
         addToZip(containedFile.getPath(), fs, rootDir, out);
      }

   } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      ZipEntry entry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipEntry(relativePath);
      out.putNextEntry(entry);

      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (FSDataInputStream in = fs.open(fileOrDirectory)) {
         IOUtils.copyBytes(in, out, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      }
      out.closeEntry();
   }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Currently PyFlink allows users to upload python library directories and requirements cached directory, which will be compressed by&#160;&lt;em&gt;FileUtils#compressDirectory&lt;/em&gt; eventually. If users specify them via relative paths, this bug will be triggered and causes those features unavailable.&lt;/p&gt;

&lt;p&gt;we can fix this bug by converting the directory path to absolute path in&#160;&lt;em&gt;FileUtils#compressDirectory&lt;/em&gt; before calling&#160;&lt;em&gt;addToZip&lt;/em&gt; method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13274401">FLINK-15248</key>
            <summary>FileUtils#compressDirectory behaves buggy when processing relative directory path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="weizhong">Wei Zhong</assignee>
                                    <reporter username="zhongwei">Wei Zhong</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 13 Dec 2019 11:44:06 +0000</created>
                <updated>Tue, 24 Dec 2019 09:14:48 +0000</updated>
                            <resolved>Tue, 24 Dec 2019 09:14:48 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>FileSystems</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16995614" author="fly_in_gis" created="Fri, 13 Dec 2019 13:18:58 +0000"  >&lt;p&gt;How about add some java&#160;document description that the target should be an absolute path? The current caller in &lt;tt&gt;JobGraphGenerator#addUserArtifactEntries&lt;/tt&gt; has done like this.&lt;/p&gt;</comment>
                            <comment id="16997016" author="zhongwei" created="Mon, 16 Dec 2019 06:44:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; FileUtils#compressDirectory is used by StreamExecutionEnvironment#registerCachedFile and this means that users can specify relative file path&#160;in&#160;StreamExecutionEnvironment#registerCachedFile, while can not specify relative directory path if we don&apos;t fix this issue.&#160;I personally think that it would make more sense to fix this directly than to add Java documentation to tell users not to do this. What&apos;s your thought?&lt;/p&gt;</comment>
                            <comment id="16997019" author="fly_in_gis" created="Mon, 16 Dec 2019 06:51:02 +0000"  >&lt;p&gt;If flink support to register a relative directory as distributed cache, then `FileUtils#compressDirectory` should deal with relative path correctly.&#160;&lt;/p&gt;

&lt;p&gt;Make sense to me. Go ahead.&lt;/p&gt;</comment>
                            <comment id="17002742" author="hequn8128" created="Tue, 24 Dec 2019 09:13:50 +0000"  >&lt;p&gt;Resolved &lt;br/&gt;
in 1.10.0 via f002780091752b97a47e1866b653dbaf4eef802f&lt;br/&gt;
in 1.11.0 via 545534e43ed37f518fe59b6ddd8ed56ae82a234b&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09nm8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>