<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:19:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-34132] Batch WordCount job fails when run with AdaptiveBatch scheduler</title>
                <link>https://issues.apache.org/jira/browse/FLINK-34132</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Batch WordCount job fails when run with AdaptiveBatch scheduler.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Repro Steps&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
flink-yarn-session -Djobmanager.scheduler=adaptive -d

 flink run -d /usr/lib/flink/examples/batch/WordCount.jar --input s3:&lt;span class=&quot;code-comment&quot;&gt;//prabhuflinks3/INPUT --output s3://prabhuflinks3/OUT&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Error logs&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 The program finished with the following exception:

org.apache.flink.client.program.ProgramInvocationException: The main method caused an error: java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.flink.runtime.client.JobInitializationException: Could not start the JobMaster.
	at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:372)
	at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:222)
	at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:105)
	at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:851)
	at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:245)
	at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:1095)
	at org.apache.flink.client.cli.CliFrontend.lambda$mainInternal$9(CliFrontend.java:1189)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1899)
	at org.apache.flink.runtime.security.contexts.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)
	at org.apache.flink.client.cli.CliFrontend.mainInternal(CliFrontend.java:1189)
	at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1157)
Caused by: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.flink.runtime.client.JobInitializationException: Could not start the JobMaster.
	at org.apache.flink.util.ExceptionUtils.rethrow(ExceptionUtils.java:321)
	at org.apache.flink.api.java.ExecutionEnvironment.executeAsync(ExecutionEnvironment.java:1067)
	at org.apache.flink.client.program.ContextEnvironment.executeAsync(ContextEnvironment.java:144)
	at org.apache.flink.client.program.ContextEnvironment.execute(ContextEnvironment.java:73)
	at org.apache.flink.examples.java.wordcount.WordCount.main(WordCount.java:106)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:355)
	... 12 more
Caused by: java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.flink.runtime.client.JobInitializationException: Could not start the JobMaster.
	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
	at org.apache.flink.api.java.ExecutionEnvironment.executeAsync(ExecutionEnvironment.java:1062)
	... 20 more
Caused by: java.lang.RuntimeException: org.apache.flink.runtime.client.JobInitializationException: Could not start the JobMaster.
	at org.apache.flink.util.ExceptionUtils.rethrow(ExceptionUtils.java:321)
	at org.apache.flink.util.function.FunctionUtils.lambda$uncheckedFunction$2(FunctionUtils.java:75)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)
	at java.util.concurrent.CompletableFuture$Completion.exec(CompletableFuture.java:457)
	at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
	at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
	at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
	at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:175)
Caused by: org.apache.flink.runtime.client.JobInitializationException: Could not start the JobMaster.
	at org.apache.flink.runtime.jobmaster.DefaultJobMasterServiceProcess.lambda$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$0(DefaultJobMasterServiceProcess.java:97)
	at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)
	at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1609)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750)
Caused by: java.util.concurrent.CompletionException: java.lang.IllegalStateException: At the moment, adaptive batch scheduler requires batch workloads to be executed with types of all edges being BLOCKING or HYBRID_FULL/HYBRID_SELECTIVE. To &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; that, you need to configure &lt;span class=&quot;code-quote&quot;&gt;&apos;execution.batch-shuffle-mode&apos;&lt;/span&gt; to &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL_EXCHANGES_BLOCKING&apos;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL_EXCHANGES_HYBRID_FULL/ALL_EXCHANGES_HYBRID_SELECTIVE&apos;&lt;/span&gt;.
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1606)
	... 3 more
Caused by: java.lang.IllegalStateException: At the moment, adaptive batch scheduler requires batch workloads to be executed with types of all edges being BLOCKING or HYBRID_FULL/HYBRID_SELECTIVE. To &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; that, you need to configure &lt;span class=&quot;code-quote&quot;&gt;&apos;execution.batch-shuffle-mode&apos;&lt;/span&gt; to &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL_EXCHANGES_BLOCKING&apos;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL_EXCHANGES_HYBRID_FULL/ALL_EXCHANGES_HYBRID_SELECTIVE&apos;&lt;/span&gt;.
	at org.apache.flink.util.Preconditions.checkState(Preconditions.java:193)
	at org.apache.flink.runtime.scheduler.adaptivebatch.AdaptiveBatchSchedulerFactory.checkAllExchangesAreSupported(AdaptiveBatchSchedulerFactory.java:324)
	at org.apache.flink.runtime.scheduler.adaptivebatch.AdaptiveBatchSchedulerFactory.createInstance(AdaptiveBatchSchedulerFactory.java:127)
	at org.apache.flink.runtime.jobmaster.DefaultSlotPoolServiceSchedulerFactory.createScheduler(DefaultSlotPoolServiceSchedulerFactory.java:124)
	at org.apache.flink.runtime.jobmaster.JobMaster.createScheduler(JobMaster.java:393)
	at org.apache.flink.runtime.jobmaster.JobMaster.&amp;lt;init&amp;gt;(JobMaster.java:362)
	at org.apache.flink.runtime.jobmaster.factories.DefaultJobMasterServiceFactory.internalCreateJobMasterService(DefaultJobMasterServiceFactory.java:128)
	at org.apache.flink.runtime.jobmaster.factories.DefaultJobMasterServiceFactory.lambda$createJobMasterService$0(DefaultJobMasterServiceFactory.java:100)
	at org.apache.flink.util.function.FunctionUtils.lambda$uncheckedSupplier$4(FunctionUtils.java:112)
	at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1604)
	... 3 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Analysis&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I have configured the execution.batch-shuffle-mode to use either ALL_EXCHANGES_BLOCKING, ALL_EXCHANGES_HYBRID_FULL, or ALL_EXCHANGES_HYBRID_SELECTIVE, but all attempts resulted in the same error message.&lt;/p&gt;

&lt;p&gt;The Wordcount program runs fine when setting below in the code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
env.getConfig().setExecutionMode(ExecutionMode.BATCH_FORCED);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Need to investigate why the execution.batch-shuffle-mode is not being recognized and, if this behavior is intentional, correct the reported misleading error message. Additionally, we need to address the Wordcount job to ensure it runs seamlessly with both batch and adaptive scheduler.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13565058">FLINK-34132</key>
            <summary>Batch WordCount job fails when run with AdaptiveBatch scheduler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="JunRuiLi">Junrui Li</assignee>
                                    <reporter username="prabhujoseph">Prabhu Joseph</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 17 Jan 2024 09:59:44 +0000</created>
                <updated>Thu, 1 Feb 2024 15:36:17 +0000</updated>
                            <resolved>Thu, 1 Feb 2024 08:03:00 +0000</resolved>
                                    <version>1.17.1</version>
                    <version>1.18.1</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17807697" author="wanglijie95" created="Wed, 17 Jan 2024 11:25:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prabhujoseph&quot; class=&quot;user-hover&quot; rel=&quot;prabhujoseph&quot;&gt;prabhujoseph&lt;/a&gt; AFAIK, adaptive batch scheduler does not support dataset jobs, you can see details in &lt;a href=&quot;https://cwiki.apache.org/confluence/display/FLINK/FLIP-283%3A+Use+adaptive+batch+scheduler+as+default+scheduler+for+batch+jobs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FLIP-283&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But maybe we should make the exception message more friendly. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JunRuiLi&quot; class=&quot;user-hover&quot; rel=&quot;JunRuiLi&quot;&gt;JunRuiLi&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17807701" author="JIRAUSER293716" created="Wed, 17 Jan 2024 11:38:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prabhujoseph&quot; class=&quot;user-hover&quot; rel=&quot;prabhujoseph&quot;&gt;prabhujoseph&lt;/a&gt; The &lt;a href=&quot;https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/elastic_scaling/#limitations-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;limitation&lt;/a&gt; of adaptive batch scheduler requires that only supports jobs whose shuffle mode is&#160;&lt;tt&gt;ALL_EXCHANGES_BLOCKING / ALL_EXCHANGES_HYBRID_FULL / ALL_EXCHANGES_HYBRID_SELECTIVE&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;However, this config option execution.batch-shuffle-mode is applicable to DataStream jobs but not to DataSet jobs. For DataSet jobs, ExecutionMode.BATCH_FORCED could be considered a workaround (not very certain).&#160;&lt;/p&gt;

&lt;p&gt;But I think the doc on the website is not very clear on this limitation and could potentially confuse users. It&apos;s better to update the documentation to clarify this point.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wanglijie&quot; class=&quot;user-hover&quot; rel=&quot;wanglijie&quot;&gt;wanglijie&lt;/a&gt; , WDYT?&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17807709" author="JIRAUSER293716" created="Wed, 17 Jan 2024 12:18:15 +0000"  >&lt;p&gt;After discuss with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wanglijie&quot; class=&quot;user-hover&quot; rel=&quot;wanglijie&quot;&gt;wanglijie&lt;/a&gt; offline, I will prepare a fix to update the error message and documentation on the website.&lt;/p&gt;</comment>
                            <comment id="17813093" author="zhuzh" created="Thu, 1 Feb 2024 08:03:00 +0000"  >&lt;p&gt;The documentation is updated via dd3e60a4b1e473c167837b7c3bc4fb90c0a1f51a&lt;/p&gt;</comment>
                            <comment id="17813095" author="zhuzh" created="Thu, 1 Feb 2024 08:12:32 +0000"  >&lt;p&gt;We should also migrate the existing batch examples from DataSet to DataStream so that it can directly work with AdaptiveBatchScheduler. &lt;br/&gt;
This work needs to be done before removing the DataSet API in Flink 2.0.&lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Wencong+Liu&quot; class=&quot;user-hover&quot; rel=&quot;Wencong Liu&quot;&gt;Wencong Liu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17813316" author="JIRAUSER281639" created="Thu, 1 Feb 2024 15:36:17 +0000"  >&lt;p&gt;Thanks for the reminding. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhuzh&quot; class=&quot;user-hover&quot; rel=&quot;zhuzh&quot;&gt;zhuzh&lt;/a&gt; I will address these issues when I have some free time. &#128516;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mta8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>