<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4149] Fix Serialization of NFA in AbstractKeyedCEPPatternOperator</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4149</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A job that uses CEP fails upon restore with a &lt;tt&gt;NullPointerException&lt;/tt&gt; in &lt;tt&gt;NFA.process()&lt;/tt&gt;. The reason seems to be that field &lt;tt&gt;computationStates&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt;. This field is transient and read in a custom &lt;tt&gt;readObject()&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;AbstractKeyedCEPPatternOperator&lt;/tt&gt; this snipped is used to construct a &lt;tt&gt;StateDescriptor&lt;/tt&gt; for an &lt;tt&gt;NFA&lt;/tt&gt; state:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueStateDescriptor&amp;lt;NFA&amp;lt;IN&amp;gt;&amp;gt;(
    NFA_OPERATOR_STATE_NAME,
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KryoSerializer&amp;lt;NFA&amp;lt;IN&amp;gt;&amp;gt;((&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;NFA&amp;lt;IN&amp;gt;&amp;gt;) (&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt;) NFA.class, getExecutionConfig()),
    &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems Kryo does not invoke &lt;tt&gt;readObject&lt;/tt&gt;/&lt;tt&gt;writeObject&lt;/tt&gt;. We probably need a custom &lt;tt&gt;TypeSerializer&lt;/tt&gt; for &lt;tt&gt;NFA&lt;/tt&gt; to solve the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12986622">FLINK-4149</key>
            <summary>Fix Serialization of NFA in AbstractKeyedCEPPatternOperator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jul 2016 14:54:37 +0000</created>
                <updated>Tue, 18 Apr 2017 12:37:12 +0000</updated>
                            <resolved>Mon, 18 Jul 2016 12:08:54 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.0.1</version>
                    <version>1.0.2</version>
                    <version>1.0.3</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Library / CEP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15362717" author="githubbot" created="Tue, 5 Jul 2016 16:25:23 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4149&quot; title=&quot;Fix Serialization of NFA in AbstractKeyedCEPPatternOperator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4149&quot;&gt;&lt;del&gt;FLINK-4149&lt;/del&gt;&lt;/a&gt; Fix Serialization of NFA in AbstractKeyedCEPPatternOperator&lt;/p&gt;

&lt;p&gt;    NFA is Serializable and has readObject()/writeObject() methods. In&lt;br/&gt;
    AbstractKeyedCEPPatternOperator a KryoSerializer was used as the&lt;br/&gt;
    TypeSerializer for the ValueState that holds NFA instances. Kryo does&lt;br/&gt;
    not call readObject()/writeObject() therefore the state of the NFA was&lt;br/&gt;
    invalid after deserialization.&lt;/p&gt;

&lt;p&gt;    This change adds a new TypeSerializer for NFA that uses&lt;br/&gt;
    Java Serialization. In the long run it will be better to get rid of the&lt;br/&gt;
    readObject()/writeObject() methods and instead efficiently serialize&lt;br/&gt;
    using a specialized TypeSerializer.&lt;/p&gt;

&lt;p&gt;    This also adds a test that verifies that checkpoint/restore work as expected.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; cep/fix-serialization&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2202&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ba1deb8cae7223f3ca9def1b09b311e7d7889a8a&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-05T15:56:49Z&lt;/p&gt;

&lt;p&gt;    Replace StreamEvent by StreamRecord in CEP Tests&lt;/p&gt;

&lt;p&gt;commit 19aaa005e0389b512a563cf28e82d8ad07c4a194&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-05T15:58:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4149&quot; title=&quot;Fix Serialization of NFA in AbstractKeyedCEPPatternOperator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4149&quot;&gt;&lt;del&gt;FLINK-4149&lt;/del&gt;&lt;/a&gt; Fix Serialization of NFA in AbstractKeyedCEPPatternOperator&lt;/p&gt;

&lt;p&gt;    NFA is Serializable and has readObject()/writeObject() methods. In&lt;br/&gt;
    AbstractKeyedCEPPatternOperator a KryoSerializer was used as the&lt;br/&gt;
    TypeSerializer for the ValueState that holds NFA instances. Kryo does&lt;br/&gt;
    not call readObject()/writeObject() therefore the state of the NFA was&lt;br/&gt;
    invalid after deserialization.&lt;/p&gt;

&lt;p&gt;    This change adds a new TypeSerializer for NFA that uses&lt;br/&gt;
    Java Serialization. In the long run it will be better to get rid of the&lt;br/&gt;
    readObject()/writeObject() methods and instead efficiently serialize&lt;br/&gt;
    using a specialized TypeSerializer.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15364001" author="githubbot" created="Wed, 6 Jul 2016 08:42:00 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    R: @tillrohrmann for review&lt;/p&gt;</comment>
                            <comment id="15372952" author="githubbot" created="Tue, 12 Jul 2016 14:25:01 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202#discussion_r70448543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202#discussion_r70448543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/NFA.java &amp;#8212;&lt;br/&gt;
    @@ -19,12 +19,16 @@&lt;br/&gt;
     package org.apache.flink.cep.nfa;&lt;/p&gt;

&lt;p&gt;     import com.google.common.collect.LinkedHashMultimap;&lt;br/&gt;
    +import org.apache.commons.io.output.ByteArrayOutputStream;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Why do we use once the `org.apache.commons.io.output.BAOS` and then the `java.io.BAIS`?&lt;/p&gt;</comment>
                            <comment id="15372959" author="githubbot" created="Tue, 12 Jul 2016 14:30:25 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202#discussion_r70449634&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202#discussion_r70449634&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/NFA.java &amp;#8212;&lt;br/&gt;
    @@ -454,4 +458,126 @@ static String generateStateName(final String name, final int index) &lt;/p&gt;
{
     			return name + &quot;_&quot; + index;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for &lt;/p&gt;
{@link NFA}
&lt;p&gt; that uses Java Serialization.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class Serializer&amp;lt;T&amp;gt; extends TypeSerializer&amp;lt;NFA&amp;lt;T&amp;gt;&amp;gt; {&lt;br/&gt;
    +		private static final long serialVersionUID = 1L;&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return false;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public TypeSerializer&amp;lt;NFA&amp;lt;T&amp;gt;&amp;gt; duplicate() &lt;/p&gt;
{
    +			return this;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; copy(NFA&amp;lt;T&amp;gt; from) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				ByteArrayOutputStream baos = new ByteArrayOutputStream();
    +				ObjectOutputStream oos = new ObjectOutputStream(baos);
    +
    +				oos.writeObject(from);
    +
    +				oos.close();
    +				baos.close();
    +
    +				byte[] data = baos.toByteArray();
    +
    +				ByteArrayInputStream bais = new ByteArrayInputStream(data);
    +				ObjectInputStream ois = new ObjectInputStream(bais);
    +
    +				@SuppressWarnings(&quot;unchecked&quot;)
    +				NFA&amp;lt;T&amp;gt; copy = (NFA&amp;lt;T&amp;gt;) ois.readObject();
    +				return copy;
    +			}
&lt;p&gt; catch (IOException|ClassNotFoundException e) &lt;/p&gt;
{
    +				throw new RuntimeException(&quot;Could not copy NFA.&quot;, e);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; copy(NFA&amp;lt;T&amp;gt; from, NFA&amp;lt;T&amp;gt; reuse) &lt;/p&gt;
{
    +			return copy(from);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return 0;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(NFA&amp;lt;T&amp;gt; record, DataOutputView target) throws IOException {&lt;br/&gt;
    +			try {&lt;br/&gt;
    +				ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
    +				ObjectOutputStream oos = new ObjectOutputStream(baos);&lt;br/&gt;
    +&lt;br/&gt;
    +				oos.writeObject(record);&lt;br/&gt;
    +&lt;br/&gt;
    +				oos.close();&lt;br/&gt;
    +				baos.close();&lt;br/&gt;
    +&lt;br/&gt;
    +				byte[] data = baos.toByteArray();&lt;br/&gt;
    +&lt;br/&gt;
    +				target.writeInt(data.length);&lt;br/&gt;
    +				target.write(data);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can&apos;t we use the `DataOutputViewStream`?&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    ObjectOutputStream oos = new ObjectOutputStream(new DataOutputViewStream(target));&lt;br/&gt;
    oos.writeObject(record);&lt;br/&gt;
    oos.close();&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="15372960" author="githubbot" created="Tue, 12 Jul 2016 14:30:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202#discussion_r70449753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202#discussion_r70449753&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/NFA.java &amp;#8212;&lt;br/&gt;
    @@ -454,4 +458,126 @@ static String generateStateName(final String name, final int index) &lt;/p&gt;
{
     			return name + &quot;_&quot; + index;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for &lt;/p&gt;
{@link NFA}
&lt;p&gt; that uses Java Serialization.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class Serializer&amp;lt;T&amp;gt; extends TypeSerializer&amp;lt;NFA&amp;lt;T&amp;gt;&amp;gt; {&lt;br/&gt;
    +		private static final long serialVersionUID = 1L;&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return false;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public TypeSerializer&amp;lt;NFA&amp;lt;T&amp;gt;&amp;gt; duplicate() &lt;/p&gt;
{
    +			return this;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; copy(NFA&amp;lt;T&amp;gt; from) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				ByteArrayOutputStream baos = new ByteArrayOutputStream();
    +				ObjectOutputStream oos = new ObjectOutputStream(baos);
    +
    +				oos.writeObject(from);
    +
    +				oos.close();
    +				baos.close();
    +
    +				byte[] data = baos.toByteArray();
    +
    +				ByteArrayInputStream bais = new ByteArrayInputStream(data);
    +				ObjectInputStream ois = new ObjectInputStream(bais);
    +
    +				@SuppressWarnings(&quot;unchecked&quot;)
    +				NFA&amp;lt;T&amp;gt; copy = (NFA&amp;lt;T&amp;gt;) ois.readObject();
    +				return copy;
    +			}
&lt;p&gt; catch (IOException|ClassNotFoundException e) &lt;/p&gt;
{
    +				throw new RuntimeException(&quot;Could not copy NFA.&quot;, e);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; copy(NFA&amp;lt;T&amp;gt; from, NFA&amp;lt;T&amp;gt; reuse) &lt;/p&gt;
{
    +			return copy(from);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return 0;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(NFA&amp;lt;T&amp;gt; record, DataOutputView target) throws IOException {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				ByteArrayOutputStream baos = new ByteArrayOutputStream();
    +				ObjectOutputStream oos = new ObjectOutputStream(baos);
    +
    +				oos.writeObject(record);
    +
    +				oos.close();
    +				baos.close();
    +
    +				byte[] data = baos.toByteArray();
    +
    +				target.writeInt(data.length);
    +				target.write(data);
    +			}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    +				throw new RuntimeException(&quot;Could not serialize NFA.&quot;, e);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			try {&lt;br/&gt;
    +				int size = source.readInt();&lt;br/&gt;
    +&lt;br/&gt;
    +				byte[] data = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;size&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +				source.readFully(data);&lt;br/&gt;
    +&lt;br/&gt;
    +				ByteArrayInputStream bais = new ByteArrayInputStream(data);&lt;br/&gt;
    +				ObjectInputStream ois = new ObjectInputStream(bais);&lt;br/&gt;
    +&lt;br/&gt;
    +				@SuppressWarnings(&quot;unchecked&quot;)&lt;br/&gt;
    +				NFA&amp;lt;T&amp;gt; copy = (NFA&amp;lt;T&amp;gt;) ois.readObject();&lt;br/&gt;
    +				return copy;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Same here with the `DataInputViewStream`.&lt;/p&gt;</comment>
                            <comment id="15372963" author="githubbot" created="Tue, 12 Jul 2016 14:33:19 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202#discussion_r70450213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202#discussion_r70450213&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/NFA.java &amp;#8212;&lt;br/&gt;
    @@ -454,4 +458,126 @@ static String generateStateName(final String name, final int index) &lt;/p&gt;
{
     			return name + &quot;_&quot; + index;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for &lt;/p&gt;
{@link NFA}
&lt;p&gt; that uses Java Serialization.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class Serializer&amp;lt;T&amp;gt; extends TypeSerializer&amp;lt;NFA&amp;lt;T&amp;gt;&amp;gt; {&lt;br/&gt;
    +		private static final long serialVersionUID = 1L;&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return false;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public TypeSerializer&amp;lt;NFA&amp;lt;T&amp;gt;&amp;gt; duplicate() &lt;/p&gt;
{
    +			return this;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; copy(NFA&amp;lt;T&amp;gt; from) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				ByteArrayOutputStream baos = new ByteArrayOutputStream();
    +				ObjectOutputStream oos = new ObjectOutputStream(baos);
    +
    +				oos.writeObject(from);
    +
    +				oos.close();
    +				baos.close();
    +
    +				byte[] data = baos.toByteArray();
    +
    +				ByteArrayInputStream bais = new ByteArrayInputStream(data);
    +				ObjectInputStream ois = new ObjectInputStream(bais);
    +
    +				@SuppressWarnings(&quot;unchecked&quot;)
    +				NFA&amp;lt;T&amp;gt; copy = (NFA&amp;lt;T&amp;gt;) ois.readObject();
    +				return copy;
    +			}
&lt;p&gt; catch (IOException|ClassNotFoundException e) &lt;/p&gt;
{
    +				throw new RuntimeException(&quot;Could not copy NFA.&quot;, e);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; copy(NFA&amp;lt;T&amp;gt; from, NFA&amp;lt;T&amp;gt; reuse) &lt;/p&gt;
{
    +			return copy(from);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return 0;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(NFA&amp;lt;T&amp;gt; record, DataOutputView target) throws IOException {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				ByteArrayOutputStream baos = new ByteArrayOutputStream();
    +				ObjectOutputStream oos = new ObjectOutputStream(baos);
    +
    +				oos.writeObject(record);
    +
    +				oos.close();
    +				baos.close();
    +
    +				byte[] data = baos.toByteArray();
    +
    +				target.writeInt(data.length);
    +				target.write(data);
    +			}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    +				throw new RuntimeException(&quot;Could not serialize NFA.&quot;, e);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				int size = source.readInt();
    +
    +				byte[] data = new byte[size];
    +
    +				source.readFully(data);
    +
    +				ByteArrayInputStream bais = new ByteArrayInputStream(data);
    +				ObjectInputStream ois = new ObjectInputStream(bais);
    +
    +				@SuppressWarnings(&quot;unchecked&quot;)
    +				NFA&amp;lt;T&amp;gt; copy = (NFA&amp;lt;T&amp;gt;) ois.readObject();
    +				return copy;
    +			}
&lt;p&gt; catch (IOException|ClassNotFoundException e) &lt;/p&gt;
{
    +				throw new RuntimeException(&quot;Could not deserialize NFA.&quot;, e);
    +			}
&lt;p&gt;		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public NFA&amp;lt;T&amp;gt; deserialize(NFA&amp;lt;T&amp;gt; reuse, DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(DataInputView source, DataOutputView target) throws IOException &lt;/p&gt;
{
    +			int size = source.readInt();
    +			target.writeInt(size);
    +			target.write(source, size);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean equals(Object obj) {&lt;br/&gt;
    +			return obj instanceof Serializer;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    In order to make the equals relation symmetric, we should `return obj instanceof Serializer &amp;amp;&amp;amp; ((Serializer) obj).canEqual(this);`.&lt;/p&gt;</comment>
                            <comment id="15373006" author="githubbot" created="Tue, 12 Jul 2016 14:57:32 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Changes look good to me. Thanks for fixing the CEP issues @aljoscha &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I had some minor comments concerning the NFA serializer.&lt;/p&gt;

&lt;p&gt;    Before merging it would be good to rebase on the latest master and rerun Travis, because many builds failed due to a problem with the Kinesis connector. Thus, there might be some problems shadowed by the failing Kinesis tests (not really expecting this).&lt;/p&gt;</comment>
                            <comment id="15375195" author="githubbot" created="Wed, 13 Jul 2016 15:19:14 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @tillrohrmann! The `commons.io` was just an IDE mess-up. The `equals` I will fix.&lt;/p&gt;</comment>
                            <comment id="15382159" author="githubbot" created="Mon, 18 Jul 2016 12:02:11 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15382168" author="aljoscha" created="Mon, 18 Jul 2016 12:08:54 +0000"  >&lt;p&gt;Done in &lt;a href=&quot;https://github.com/apache/flink/commit/ac06146719e1061aecdc7f18c95913ac9009a711&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/ac06146719e1061aecdc7f18c95913ac9009a711&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15966249" author="githubbot" created="Wed, 12 Apr 2017 17:27:57 +0000"  >&lt;p&gt;Github user shashank734 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Again getting this error. After changing state backend from Rocksdb it&apos;s working fine.&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    04/12/2017 10:05:04	Job execution switched to status FAILING.&lt;br/&gt;
    java.lang.RuntimeException: Could not deserialize NFA.&lt;br/&gt;
    	at org.apache.flink.cep.nfa.NFA$Serializer.deserialize(NFA.java:538)&lt;br/&gt;
    	at org.apache.flink.cep.nfa.NFA$Serializer.deserialize(NFA.java:469)&lt;br/&gt;
    	at org.apache.flink.contrib.streaming.state.RocksDBValueState.value(RocksDBValueState.java:81)&lt;br/&gt;
    	at org.apache.flink.cep.operator.AbstractKeyedCEPPatternOperator.getNFA(AbstractKeyedCEPPatternOperator.java:124)&lt;br/&gt;
    	at org.apache.flink.cep.operator.AbstractCEPBasePatternOperator.processElement(AbstractCEPBasePatternOperator.java:72)&lt;br/&gt;
    	at org.apache.flink.cep.operator.AbstractKeyedCEPPatternOperator.processElement(AbstractKeyedCEPPatternOperator.java:162)&lt;br/&gt;
    	at org.apache.flink.streaming.runtime.io.StreamInputProcessor.processInput(StreamInputProcessor.java:185)&lt;br/&gt;
    	at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.run(OneInputStreamTask.java:63)&lt;br/&gt;
    	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:272)&lt;br/&gt;
    	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:655)&lt;br/&gt;
    	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
    Caused by: java.lang.ClassNotFoundException: co.ronak.nto.Job$$anon$18$$anon$21$$anon$3&lt;br/&gt;
    	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)&lt;br/&gt;
    	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)&lt;br/&gt;
    	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)&lt;br/&gt;
    	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)&lt;br/&gt;
    	at java.lang.Class.forName0(Native Method)&lt;br/&gt;
    	at java.lang.Class.forName(Class.java:348)&lt;br/&gt;
    	at java.io.ObjectInputStream.resolveClass(ObjectInputStream.java:626)&lt;br/&gt;
    	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1613)&lt;br/&gt;
    	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1518)&lt;br/&gt;
    	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1774)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:501)&lt;br/&gt;
    	at org.apache.flink.api.scala.typeutils.TraversableSerializer.readObject(TraversableSerializer.scala:53)&lt;br/&gt;
    	at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)&lt;br/&gt;
    	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
    	at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
    	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1017)&lt;br/&gt;
    	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)&lt;br/&gt;
    	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)&lt;br/&gt;
    	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)&lt;br/&gt;
    	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)&lt;br/&gt;
    	at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1707)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1345)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)&lt;br/&gt;
    	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1924)&lt;br/&gt;
    	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:501)&lt;br/&gt;
    	at org.apache.flink.cep.NonDuplicatingTypeSerializer.readObject(NonDuplicatingTypeSerializer.java:190)&lt;br/&gt;
    	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
    	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
    	at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
    	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1017)&lt;br/&gt;
    	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)&lt;br/&gt;
    	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2000)&lt;br/&gt;
    	at java.io.ObjectInputStream.defaultReadObject(ObjectInputStream.java:501)&lt;br/&gt;
    	at org.apache.flink.cep.nfa.NFA.readObject(NFA.java:394)&lt;br/&gt;
    	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
    	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
    	at java.lang.reflect.Method.invoke(Method.java:497)&lt;br/&gt;
    	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1017)&lt;br/&gt;
    	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1900)&lt;br/&gt;
    	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1801)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)&lt;br/&gt;
    	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)&lt;br/&gt;
    	at org.apache.flink.cep.nfa.NFA$Serializer.deserialize(NFA.java:535)&lt;br/&gt;
    	... 10 more&lt;br/&gt;
    ```&lt;/p&gt;
</comment>
                            <comment id="15972586" author="githubbot" created="Tue, 18 Apr 2017 12:37:12 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @shashank734 I created another issue since this is a different (but somewhat related) problem: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6318&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-6318&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30i6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>