<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-33360] HybridSource fails to clear the previous round&apos;s state when switching sources, leading to data loss</title>
                <link>https://issues.apache.org/jira/browse/FLINK-33360</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;org.apache.flink.connector.base.source.hybrid.HybridSourceSplitEnumerator:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// track readers that have finished processing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; current enumerator
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; finishedReaders.add(subtaskId);
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (finishedReaders.size() == context.currentParallelism()) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;All readers finished, ready to &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; enumerator!&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currentSourceIndex + 1 &amp;lt; sources.size()) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; switchEnumerator();
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; all readers prior to sending split assignments
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; context.currentParallelism(); i++) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; sendSwitchSourceEvent(i, currentSourceIndex);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think that &lt;b&gt;finishedReaders&lt;/b&gt; is used to keep track of all the subTaskIds that have finished reading the current round of the source. Therefore, in the &lt;b&gt;switchEnumerator&lt;/b&gt; function, &lt;b&gt;finishedReaders&lt;/b&gt; should be cleared:&lt;/p&gt;

&lt;p&gt;If it&apos;s not cleared, then in the next source reading, whenever any SourceReader reports a &lt;b&gt;SourceReaderFinishedEvent&lt;/b&gt; (while other SourceReaders may not have finished processing in parallel), the condition &lt;b&gt;finishedReaders.size() == context.currentParallelism()&lt;/b&gt; will be satisfied and it will trigger &lt;b&gt;sendSwitchSourceEvent&lt;/b&gt;(i, currentSourceIndex), sending a &lt;b&gt;SwitchSourceEvent&lt;/b&gt; to all SourceReaders.&lt;br/&gt;
If a SourceReader receives a SwitchSourceEvent before it finishes reading the previous source, it will execute &lt;b&gt;currentReader.close()&lt;/b&gt;, and some data may not be fully read, resulting in a partial data loss in the source.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13555492">FLINK-33360</key>
            <summary>HybridSource fails to clear the previous round&apos;s state when switching sources, leading to data loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fengjiajie">Feng Jiajie</assignee>
                                    <reporter username="fengjiajie">Feng Jiajie</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 25 Oct 2023 13:01:10 +0000</created>
                <updated>Tue, 31 Oct 2023 07:24:14 +0000</updated>
                            <resolved>Tue, 31 Oct 2023 07:24:14 +0000</resolved>
                                    <version>1.16.2</version>
                    <version>1.18.0</version>
                    <version>1.17.1</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Connectors / HybridSource</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17779507" author="fengjiajie" created="Wed, 25 Oct 2023 13:12:31 +0000"  >&lt;p&gt;pr: &lt;a href=&quot;https://github.com/apache/flink/pull/23593&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/23593&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17779998" author="leonard xu" created="Thu, 26 Oct 2023 16:39:18 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fengjiajie&quot; class=&quot;user-hover&quot; rel=&quot;fengjiajie&quot;&gt;fengjiajie&lt;/a&gt; for report this issue, I assigned this ticket to you as you have raised a PR.&lt;/p&gt;</comment>
                            <comment id="17780899" author="leonard xu" created="Mon, 30 Oct 2023 08:25:24 +0000"  >&lt;p&gt;Fixed in master(1.19): 8d21c321dda18ad20022532c861d57ee38b70fda&lt;br/&gt;
1.18&#65306;013b337329ff4732e62d631cac8429cb68dd4776&lt;br/&gt;
1.17&#65306;19637741e9e56ab231fdcafd1dec4be4087e738e&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l6m8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>