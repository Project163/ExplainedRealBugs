<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18050] Fix the bug of recycling buffer twice once exception in ChannelStateWriteRequestDispatcher#dispatch</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18050</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When task finishes, the `CheckpointBarrierUnaligner` will decline the current checkpoint, which would write abort request into `ChannelStateWriter`.&lt;/p&gt;

&lt;p&gt;The abort request will be executed before other write output request in the queue, and close the underlying `CheckpointStateOutputStream`. Then when the dispatcher executes the next write output request to access the stream, it will throw&#160;ClosedByInterruptException to make dispatcher thread exit.&lt;/p&gt;

&lt;p&gt;In this process, the underlying buffers for current write output request will be recycled twice.&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ChannelStateCheckpointWriter#write will recycle all the buffers in finally part, which can cover both exception and normal cases.&lt;/li&gt;
	&lt;li&gt;ChannelStateWriteRequestDispatcherImpl#dispatch will call&#160;`request.cancel(e)`&#160; to recycle the underlying buffers again in the case of exception.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The effect of this bug can cause further exception in the network shuffle process, which references the same buffer as above, then this exception will send to the downstream side to make it failure.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This bug can be reproduced easily via running&#160;UnalignedCheckpointITCase#shouldPerformUnalignedCheckpointOnParallelRemoteChannel.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13308737">FLINK-18050</key>
            <summary>Fix the bug of recycling buffer twice once exception in ChannelStateWriteRequestDispatcher#dispatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="zjwang">Zhijiang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 1 Jun 2020 14:43:16 +0000</created>
                <updated>Tue, 9 Jun 2020 16:35:54 +0000</updated>
                            <resolved>Tue, 9 Jun 2020 07:35:45 +0000</resolved>
                                    <version>1.11.0</version>
                                    <fixVersion>1.11.0</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17128958" author="zjwang" created="Tue, 9 Jun 2020 07:35:45 +0000"  >&lt;p&gt;Merged in master:&#160;&lt;/p&gt;

&lt;p&gt;ed7b0b1bea84a10ee45d10343f239cd183659a74,&#160;&lt;/p&gt;

&lt;p&gt;f2dd4b8500a82532dae17087c227ce34e1aeac9b&lt;/p&gt;

&lt;p&gt;Merged in release-1.11:&#160;&lt;/p&gt;

&lt;p&gt;a233c0ff82273ca59bb1decdb1ffb6020d27ccfd,&#160;&#160;&lt;/p&gt;

&lt;p&gt;822e01b613b0b6821383f3cd5b0357054242b6a9&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fdz4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>