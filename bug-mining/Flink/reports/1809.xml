<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:29:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6655] Misleading error message when HistoryServer path is empty</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6655</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If the HistoryServer &lt;tt&gt;jobmanager.archive.fs.dir&lt;/tt&gt; if e.g. &lt;tt&gt;&lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt;&lt;/tt&gt;. The following exception mentions checkpoints, which is misleading.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalArgumentException: Cannot use the root directory &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoints.
	at org.apache.flink.runtime.state.filesystem.FsStateBackend.validateAndNormalizeUri(FsStateBackend.java:358)
	at org.apache.flink.runtime.jobmanager.MemoryArchivist.org$apache$flink$runtime$jobmanager$MemoryArchivist$$archiveJsonFiles(MemoryArchivist.scala:201)
	at org.apache.flink.runtime.jobmanager.MemoryArchivist$$anonfun$handleMessage$1.applyOrElse(MemoryArchivist.scala:107)
	at scala.runtime.AbstractPartialFunction$mcVL$sp.apply$mcVL$sp(AbstractPartialFunction.scala:33)
	at scala.runtime.AbstractPartialFunction$mcVL$sp.apply(AbstractPartialFunction.scala:33)
	at scala.runtime.AbstractPartialFunction$mcVL$sp.apply(AbstractPartialFunction.scala:25)
	at org.apache.flink.runtime.LogMessages$$anon$1.apply(LogMessages.scala:33)
	at org.apache.flink.runtime.LogMessages$$anon$1.apply(LogMessages.scala:28)
	at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:118)
	at org.apache.flink.runtime.LogMessages$$anon$1.applyOrElse(LogMessages.scala:28)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:467)
	at org.apache.flink.runtime.jobmanager.MemoryArchivist.aroundReceive(MemoryArchivist.scala:65)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:238)
	at akka.dispatch.Mailbox.run(Mailbox.scala:220)
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13073808">FLINK-6655</key>
            <summary>Misleading error message when HistoryServer path is empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mingleizhang">zhangminglei</assignee>
                                    <reporter username="twalthr">Timo Walther</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 May 2017 10:17:39 +0000</created>
                <updated>Thu, 28 Feb 2019 14:10:17 +0000</updated>
                            <resolved>Sat, 1 Jul 2017 10:10:39 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.2</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16056912" author="mingleizhang" created="Wed, 21 Jun 2017 03:22:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; It would be better if you can post more stacktrace messages or other information. e.g. stacktrace refers to HistoryServer message. Just look at the following code. I dont think it is suitable fix code in &lt;tt&gt;FsStateBackend&lt;/tt&gt; class. So, I need more stracetrace messages if you can support.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.length() == 0 || path.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
	&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot use the root directory &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoints.&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="16057097" author="zentol" created="Wed, 21 Jun 2017 07:40:01 +0000"  >&lt;p&gt;The stack trace is sufficient. The basic problem is that HistoryServer code (which the MemoryArchivist partly belongs to) re-uses some utility methods from the FsStateBackend for verifying the validity of paths. The problem is simply that the error messages were written with the FsStatebackend in mind, and aren&apos;t suited for general-purpose usages.&lt;/p&gt;

&lt;p&gt;As such we either have to replace the call (i.e by copying the method somewhere else) or modifying the method to provide more general error messages. I would probably prefer the first option, even if it results in code duplication, for the sake of keeping the more specific error messages for the FsStatebackend.&lt;/p&gt;</comment>
                            <comment id="16057337" author="mingleizhang" created="Wed, 21 Jun 2017 11:18:38 +0000"  >&lt;p&gt;Exactly. That is why I said it is not suitable fix in FsStateBackend. I would either copy the the method to &lt;tt&gt;MemoryArchivist&lt;/tt&gt; and convert it to scala code or create a new class including the method which under &lt;tt&gt;org.apache.flink.runtime.util&lt;/tt&gt; package. I would prefer the first one.&lt;/p&gt;</comment>
                            <comment id="16057411" author="githubbot" created="Wed, 21 Jun 2017 12:47:33 +0000"  >&lt;p&gt;GitHub user zhangminglei opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6655&quot; title=&quot;Misleading error message when HistoryServer path is empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6655&quot;&gt;&lt;del&gt;FLINK-6655&lt;/del&gt;&lt;/a&gt; Add validateAndNormalizeUri method to MemoryArchivist&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zhangminglei/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zhangminglei/flink&lt;/a&gt; flink-6655&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4156&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 700453627f8d922b9733d14f4953c9827979d79b&lt;br/&gt;
Author: zhangminglei &amp;lt;zml13856086071@163.com&amp;gt;&lt;br/&gt;
Date:   2017-06-21T12:45:55Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6655&quot; title=&quot;Misleading error message when HistoryServer path is empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6655&quot;&gt;&lt;del&gt;FLINK-6655&lt;/del&gt;&lt;/a&gt; Add validateAndNormalizeUri method to MemoryArchivist&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16057414" author="githubbot" created="Wed, 21 Jun 2017 12:49:17 +0000"  >&lt;p&gt;Github user zhangminglei commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @twalthr @zentol Please helps to review, Thank you very much.&lt;/p&gt;</comment>
                            <comment id="16062917" author="githubbot" created="Mon, 26 Jun 2017 10:54:08 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r123980821&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r123980821&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) {&lt;br/&gt;
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +&lt;br/&gt;
    +        &quot;Please specify a directory path for archive.&quot;)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    -&amp;gt; &quot;for storing job archives.&quot;&lt;/p&gt;</comment>
                            <comment id="16062918" author="githubbot" created="Mon, 26 Jun 2017 10:54:08 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r123980754&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r123980754&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) {&lt;br/&gt;
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    again, config option key. Also, it should say &quot;to store the job archives is null,&quot;&lt;/p&gt;</comment>
                            <comment id="16062919" author="githubbot" created="Mon, 26 Jun 2017 10:54:08 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r123980868&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r123980868&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) {&lt;br/&gt;
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    -&amp;gt; &quot;for storing job archives.&quot;&lt;/p&gt;</comment>
                            <comment id="16062920" author="githubbot" created="Mon, 26 Jun 2017 10:54:08 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r123980977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r123980977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    we don&apos;t need this branch, as we only access the path from the jobmanager.&lt;/p&gt;</comment>
                            <comment id="16062921" author="githubbot" created="Mon, 26 Jun 2017 10:54:08 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r123980694&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r123980694&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) {&lt;br/&gt;
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt;, etc) is null. &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Let&apos;s include the config option key in the error message.&lt;/p&gt;</comment>
                            <comment id="16064519" author="githubbot" created="Tue, 27 Jun 2017 09:15:52 +0000"  >&lt;p&gt;Github user zhangminglei commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124221227&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124221227&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Thanks, That&apos;s true. Only FsStateBackend needs this branch access the path from the file system.&lt;/p&gt;</comment>
                            <comment id="16064546" author="githubbot" created="Tue, 27 Jun 2017 09:29:38 +0000"  >&lt;p&gt;Github user zhangminglei commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124224512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124224512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think if and else branch both can delete. If I am wrong, please let me know.&lt;/p&gt;</comment>
                            <comment id="16064568" author="githubbot" created="Tue, 27 Jun 2017 09:51:20 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124229611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124229611&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It should throw an exception if the scheme isn&apos;t supported.&lt;/p&gt;</comment>
                            <comment id="16064694" author="githubbot" created="Tue, 27 Jun 2017 11:50:47 +0000"  >&lt;p&gt;Github user zhangminglei commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124251147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124251147&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I am not very sure what kind of scheme that flink support. For example, I just know existing scheme from what those codes say ```hdfs``` or ```file```. If I know what kinda scheme that flink support, I probably fix the code like ```if (scheme.startsWith(&quot;hdfs&quot;) or scheme.startsWith(&quot;file&quot;))``` or something like that. Please helps check the newest code again and give some advices.  :XD&lt;/p&gt;</comment>
                            <comment id="16064710" author="githubbot" created="Tue, 27 Jun 2017 12:02:23 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124253131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124253131&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    you also just use `FileSystem.isFlinkSupportedScheme` which was used in the original method,&lt;/p&gt;</comment>
                            <comment id="16064759" author="githubbot" created="Tue, 27 Jun 2017 12:36:16 +0000"  >&lt;p&gt;Github user zhangminglei commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124259876&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124259876&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,75 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the archive job is null. &quot; +
    +        &quot;Please specify a directory path for archive.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for archive.&quot;)
    +    }
&lt;p&gt;    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) &lt;/p&gt;
{
    +      // skip verification checks for non-flink supported filesystem
    +      // this is because the required filesystem classes may not be available to the flink client
    +      new Path(archivePathUri)
    +    }
&lt;p&gt;    +    else {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Ohhh, yeah. What a silly mistake I was making. I can get what kinda scheme from ```FileSystem.isFlinkSupportedScheme```. I have updated the code, please check again. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16064802" author="githubbot" created="Tue, 27 Jun 2017 13:07:09 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124266875&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124266875&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,47 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI: &quot; + archivePathUri)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the job archives is null. &quot; +
    +        &quot;Please specify a directory path for storing job archives. and the URI is: &quot; + archivePathUri)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for storing job archives.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) {&lt;br/&gt;
    +      // skip verification checks for non-flink supported filesystem&lt;br/&gt;
    +      // this is because the required filesystem classes may not be available to the flink client&lt;br/&gt;
    +      throw new IllegalArgumentException(&quot;Cannot use the &quot; + archivePathUri.getScheme + &quot; scheme, only hdfs, &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This is bound to be outdated at some point, so tet&apos;s re-use an exception from the FileSystem class:&lt;br/&gt;
    ```&lt;br/&gt;
    &quot;No file system found with scheme &quot; + scheme + &quot;, referenced in file URI &apos;&quot; + archivePathUri.toString() + &quot;&apos;.&quot;&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16064828" author="githubbot" created="Tue, 27 Jun 2017 13:29:25 +0000"  >&lt;p&gt;Github user zhangminglei commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156#discussion_r124272868&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156#discussion_r124272868&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/MemoryArchivist.scala &amp;#8212;&lt;br/&gt;
    @@ -255,4 +255,47 @@ class MemoryArchivist(&lt;br/&gt;
           graphs.remove(jobID)&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Checks and normalizes the archive path URI. This method first checks the validity of the&lt;br/&gt;
    +    * URI (scheme, path, availability of a matching file system) and then normalizes the URL&lt;br/&gt;
    +    * to a path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * If the URI does not include an authority, but the file system configured for the URI has an&lt;br/&gt;
    +    * authority, then the normalized path will include this authority.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @param archivePathUri The URI to check and normalize.&lt;br/&gt;
    +    * @return a normalized URI as a Path.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * @throws IllegalArgumentException Thrown, if the URI misses schema or path.&lt;br/&gt;
    +    * @throws IOException Thrown, if no file system can be found for the URI&apos;s scheme.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @throws&lt;span class=&quot;error&quot;&gt;&amp;#91;IOException&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +  private def validateAndNormalizeUri(archivePathUri: URI): Path = {&lt;br/&gt;
    +    val scheme = archivePathUri.getScheme&lt;br/&gt;
    +    val path = archivePathUri.getPath&lt;br/&gt;
    +&lt;br/&gt;
    +    // some validity checks&lt;br/&gt;
    +    if (scheme == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The scheme (hdfs://, file://, etc) is null. &quot; +
    +        &quot;Please specify the file system scheme explicitly in the URI: &quot; + archivePathUri)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path == null) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;The path to store the job archives is null. &quot; +
    +        &quot;Please specify a directory path for storing job archives. and the URI is: &quot; + archivePathUri)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (path.length == 0 || path == &quot;/&quot;) &lt;/p&gt;
{
    +      throw new IllegalArgumentException(&quot;Cannot use the root directory for storing job archives.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    if (!FileSystem.isFlinkSupportedScheme(archivePathUri.getScheme)) {&lt;br/&gt;
    +      // skip verification checks for non-flink supported filesystem&lt;br/&gt;
    +      // this is because the required filesystem classes may not be available to the flink client&lt;br/&gt;
    +      throw new IllegalArgumentException(&quot;Cannot use the &quot; + archivePathUri.getScheme + &quot; scheme, only hdfs, &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I have updated the code. Thanks @zentol VERY careful review. I am very appreciate it!&lt;/p&gt;</comment>
                            <comment id="16064834" author="githubbot" created="Tue, 27 Jun 2017 13:32:48 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    will try this out and merge it afterwards.&lt;/p&gt;</comment>
                            <comment id="16064836" author="githubbot" created="Tue, 27 Jun 2017 13:33:37 +0000"  >&lt;p&gt;Github user zhangminglei commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Nice ~&lt;/p&gt;</comment>
                            <comment id="16064845" author="githubbot" created="Tue, 27 Jun 2017 13:37:30 +0000"  >&lt;p&gt;Github user zhangminglei commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol If you dont mind, you can give me your sample test code via my personal email ```18717838093@163.com```, next time, I can test it by myself.&lt;/p&gt;</comment>
                            <comment id="16064853" author="githubbot" created="Tue, 27 Jun 2017 13:43:52 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    For the local test i wouldn&apos;t use test code.&lt;/p&gt;

&lt;p&gt;    build Flink -&amp;gt; mess with HistoryServer config -&amp;gt; start HistoryServer -&amp;gt; see what happens&lt;/p&gt;</comment>
                            <comment id="16064856" author="githubbot" created="Tue, 27 Jun 2017 13:46:21 +0000"  >&lt;p&gt;Github user zhangminglei commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay, Let me try.&lt;/p&gt;</comment>
                            <comment id="16064893" author="githubbot" created="Tue, 27 Jun 2017 14:10:03 +0000"  >&lt;p&gt;Github user zhangminglei commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    BTW, What is your Program arguments ? start with --configDir ...&lt;/p&gt;</comment>
                            <comment id="16071143" author="githubbot" created="Sat, 1 Jul 2017 10:07:41 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16071158" author="zentol" created="Sat, 1 Jul 2017 10:10:39 +0000"  >&lt;p&gt;1.3: d02e688e72c3d7a9a91a85f5816209a5d8d9aa60&lt;br/&gt;
1.4: 39562691b160e3061794ac6605b5a9c1f031b548&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3facn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>