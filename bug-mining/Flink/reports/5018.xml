<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17868] Proctime in DDL can not work in batch mode</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17868</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The data of this proctime column will be all null. Should same to current timestamp.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13306497">FLINK-17868</key>
            <summary>Proctime in DDL can not work in batch mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="qingyue">Jane Chan</assignee>
                                    <reporter username="lzljs3620320">Jingsong Lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>sprint</label>
                    </labels>
                <created>Thu, 21 May 2020 13:10:52 +0000</created>
                <updated>Fri, 28 May 2021 07:13:02 +0000</updated>
                            <resolved>Fri, 22 Jan 2021 11:46:47 +0000</resolved>
                                                    <fixVersion>1.13.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="17258187" author="qingyue" created="Mon, 4 Jan 2021 12:47:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;, I&apos;m interested in this issue and want to have a try.&lt;/p&gt;

&lt;p&gt;I came up with three possible solutions and listed the proposed and rejected alternatives and want to hear your opinions. Please correct me if I&apos;m wrong.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Proposedplan&quot;&gt;&lt;/a&gt;Proposed plan&lt;/h3&gt;

&lt;p&gt;Introduce a new rule and program to `FlinkBatchProgram` to rewrite `PROCTIME()` to `CURRENT_TIMESTAMP()` at planning phase.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Alternativeplans&quot;&gt;&lt;/a&gt;Alternative plans&lt;/h3&gt;

&lt;p&gt;1. Introduce `FlinkRelTimeIndicatorProgram` to `FlinkBatchProgram` (i.e. reuse `RelTimeIndicatorConveter`) and rewrite `PROCTIME ` to `PROCTIME_MATERIALIZE ` during planning phase.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Pro: translated batch plan is same as stream plan `Calc(select=&lt;span class=&quot;error&quot;&gt;&amp;#91;a, c, PROCTIME_MATERIALIZE(PROCTIME()) AS EXPR$2&amp;#93;&lt;/span&gt;)`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Con: `PROCTIME_MATERIALIZE ` is transformed to process function of`AbstractProcessStreamOperator`, which introduces `ctx.timerService()`. While `BatchExecCalc` uses `TableStreamOperator` as operator base class, it causes the generated code to fail to compile. To solve this, either modify the codegen logic to avoid using `timerService` for batch or move `ctx` from `AbstractProcessStreamOperator` to its parent `TableStreamOperator`.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2. We don&apos;t change the current plan(i.e., `Calc(select=&lt;span class=&quot;error&quot;&gt;&amp;#91;a, c, PROCTIME() AS EXPR$2&amp;#93;&lt;/span&gt;` remains unchanged). Instead, we modify the codegen logic at the transformation phase. We add a check on `PROCTIME` when `ExprCodeGenerator#generateCallExpression` is called, and if it&apos;s a batch transformation, we generate `currentTimestamp` directly.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Pro: the modified scope is limited to a minimum.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Con: It may not be proper to distinguish stream vs. batch during the transformation phase.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks, Jane.&lt;/p&gt;</comment>
                            <comment id="17258680" author="jark" created="Tue, 5 Jan 2021 05:41:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt;, I&apos;m perfer the Alternative#1, because we should keep the semantic/behavior consistent between streaming and batch. &lt;tt&gt;CURRENT_TIMESTAMP()&lt;/tt&gt; is not a synonyms for &lt;tt&gt;PROCTIME()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Regarding to the implementation, I think we can try to merge &lt;tt&gt;AbstractProcessStreamOperator&lt;/tt&gt; into &lt;tt&gt;TableStreamOperator&lt;/tt&gt;, then streaming and batch operators can share the same base class. &lt;/p&gt;

&lt;p&gt;I assigned this issue to you. &lt;/p&gt;</comment>
                            <comment id="17270082" author="jark" created="Fri, 22 Jan 2021 11:46:47 +0000"  >&lt;p&gt;Fixed in master: c5bb49039434834b7543bdc58b1e36bf80383e5b&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13298802">FLINK-17189</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f088:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>