<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6007] ConcurrentModificationException in WatermarkCallbackService</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6007</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, if an attempt is made to call &lt;tt&gt;InternalWatermarkCallbackService.unregisterKeyFromWatermarkCallback()&lt;/tt&gt; from within the &lt;tt&gt;OnWatermarkCallback&lt;/tt&gt;, a &lt;tt&gt;ConcurrentModificationException&lt;/tt&gt; is thrown. The reason is that the &lt;tt&gt;invokeOnWatermarkCallback&lt;/tt&gt; iterates over the list of keys and calls the callback for each one of them.&lt;/p&gt;

&lt;p&gt;To fix this, the deleted keys are put into a separate list, and the deletion happens after the iteration over all keys has finished.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13049641">FLINK-6007</key>
            <summary>ConcurrentModificationException in WatermarkCallbackService</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkl0u">Kostas Kloudas</assignee>
                                    <reporter username="kkl0u">Kostas Kloudas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Mar 2017 15:39:21 +0000</created>
                <updated>Mon, 13 Mar 2017 19:11:53 +0000</updated>
                            <resolved>Mon, 13 Mar 2017 19:11:53 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15903254" author="aljoscha" created="Thu, 9 Mar 2017 15:54:31 +0000"  >&lt;p&gt;Or we could duplicate the set of keys before iterating. This way, removal from the original set will be possible while iterating over the copy.&lt;/p&gt;</comment>
                            <comment id="15903269" author="kkl0u" created="Thu, 9 Mar 2017 16:02:26 +0000"  >&lt;p&gt;True. This way we do not have to checkpoint the &lt;tt&gt;deletionSet&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Just as a &quot;future&quot; note. This introduces random accesses to the key set. So if we make the set of keys spillable to disk, then this can be a problem (as with the timers). Having an extra set that potentially fits in memory could be a good solution. But again, this is for the future.&lt;/p&gt;</comment>
                            <comment id="15903293" author="kkl0u" created="Thu, 9 Mar 2017 16:12:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; Now that I come to think about it, this solution assumes that 2 x noOfKeys fit in memory. &lt;br/&gt;
The size of the deletion set is at most equal to the set of the registered keys. &lt;br/&gt;
Given this, I am not sure if the second solution is the best&lt;/p&gt;</comment>
                            <comment id="15905848" author="githubbot" created="Fri, 10 Mar 2017 23:10:06 +0000"  >&lt;p&gt;GitHub user kl0u opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6007&quot; title=&quot;ConcurrentModificationException in WatermarkCallbackService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6007&quot;&gt;&lt;del&gt;FLINK-6007&lt;/del&gt;&lt;/a&gt; Allow key removal from within the watermark callback.&lt;/p&gt;

&lt;p&gt;    When deleting a key from the InternalWatermarkCallbackService, the&lt;br/&gt;
    deleted key is put into a separate set, and the actual deletion&lt;br/&gt;
    happens after the iteration over all keys has finished. To avoid&lt;br/&gt;
    checkpointing the deletion set, the actual cleanup also happens&lt;br/&gt;
    upon checkpointing.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kl0u/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kl0u/flink&lt;/a&gt; watermark-callback-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3514&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d3a1b6e72eb56db40638c0b0889f5277c4671b61&lt;br/&gt;
Author: kl0u &amp;lt;kkloudas@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-03-08T19:18:18Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6007&quot; title=&quot;ConcurrentModificationException in WatermarkCallbackService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6007&quot;&gt;&lt;del&gt;FLINK-6007&lt;/del&gt;&lt;/a&gt; Allow key removal from within the watermark callback.&lt;/p&gt;

&lt;p&gt;    When deleting a key from the InternalWatermarkCallbackService, the&lt;br/&gt;
    deleted key is put into a separate set, and the actual deletion&lt;br/&gt;
    happens after the iteration over all keys has finished. To avoid&lt;br/&gt;
    checkpointing the deletion set, the actual cleanup also happens&lt;br/&gt;
    upon checkpointing.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15907367" author="githubbot" created="Mon, 13 Mar 2017 12:33:05 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514#discussion_r105648422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514#discussion_r105648422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/InternalWatermarkCallbackService.java &amp;#8212;&lt;br/&gt;
    @@ -58,7 +59,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;An array of sets of keys keeping the registered keys split&lt;/li&gt;
	&lt;li&gt;by the key-group they belong to. Each key-group has one set.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final Set&amp;lt;K&amp;gt;[] keysByKeygroup;&lt;br/&gt;
    +	private final Set&amp;lt;K&amp;gt;[] registeredKeysByKeyGroup;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * An array of sets of keys keeping the keys &quot;to delete&quot; split&lt;br/&gt;
    +	 * by the key-group they belong to. Each key-group has one set.&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    IMHO, the formatting on paragraphs should be:&lt;br/&gt;
    ```&lt;br/&gt;
    Some text bla bla black&lt;/p&gt;

&lt;p&gt;    &amp;lt;p&amp;gt;Other Text sdfasfaf&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    on the other hand, we don&apos;t have a style guide on that and no checkstyle for checking it .... &#128521; &lt;/p&gt;</comment>
                            <comment id="15907372" author="githubbot" created="Mon, 13 Mar 2017 12:37:41 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514#discussion_r105649773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514#discussion_r105649773&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/InternalWatermarkCallbackService.java &amp;#8212;&lt;br/&gt;
    @@ -58,7 +59,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;An array of sets of keys keeping the registered keys split&lt;/li&gt;
	&lt;li&gt;by the key-group they belong to. Each key-group has one set.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final Set&amp;lt;K&amp;gt;[] keysByKeygroup;&lt;br/&gt;
    +	private final Set&amp;lt;K&amp;gt;[] registeredKeysByKeyGroup;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * An array of sets of keys keeping the keys &quot;to delete&quot; split&lt;br/&gt;
    +	 * by the key-group they belong to. Each key-group has one set.&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Fixed this.&lt;/p&gt;</comment>
                            <comment id="15907374" author="githubbot" created="Mon, 13 Mar 2017 12:38:08 +0000"  >&lt;p&gt;Github user kl0u commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @aljoscha . Waiting for travis and then merging.&lt;/p&gt;</comment>
                            <comment id="15922763" author="kkl0u" created="Mon, 13 Mar 2017 19:09:30 +0000"  >&lt;p&gt;Merged at 14c1941d8eaa583eb8f7eeb5478e605850c0d355&lt;/p&gt;</comment>
                            <comment id="15922766" author="githubbot" created="Mon, 13 Mar 2017 19:10:09 +0000"  >&lt;p&gt;Github user kl0u commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merged at 14c1941d8eaa583eb8f7eeb5478e605850c0d355&lt;/p&gt;</comment>
                            <comment id="15922767" author="githubbot" created="Mon, 13 Mar 2017 19:10:10 +0000"  >&lt;p&gt;Github user kl0u closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3514&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b6mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>