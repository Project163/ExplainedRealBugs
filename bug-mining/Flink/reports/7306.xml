<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:19:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-33523] DataType ARRAY&lt;INT NOT NULL&gt; fails to cast into Object[]</title>
                <link>https://issues.apache.org/jira/browse/FLINK-33523</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When upgrading Iceberg&apos;s Flink version to 1.18, we found the Flink-related unit test case broken due to this issue. The below code used to work fine in Flink 1.17 but failed after upgrading to 1.18. DataType ARRAY&amp;lt;INT NOT NULL&amp;gt; fails to cast into Object[].&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Error:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ClassCastException: [I cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to [Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;
at FlinkArrayIntNotNullTest.main(FlinkArrayIntNotNullTest.java:18)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Repro:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.data.ArrayData;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.data.GenericArrayData;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.api.EnvironmentSettings;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.api.TableEnvironment;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.api.TableResult;

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FlinkArrayIntNotNullTest {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

      EnvironmentSettings settings = EnvironmentSettings.newInstance().inBatchMode().build();
      TableEnvironment env = TableEnvironment.create(settings);

      env.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE filesystemtable2 (id INT, data ARRAY&amp;lt;INT NOT NULL&amp;gt;) WITH (&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;filesystem&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/FLINK/filesystemtable2&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;)&quot;&lt;/span&gt;);
      env.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO filesystemtable2 VALUES (4,ARRAY [1,2,3])&quot;&lt;/span&gt;);
      TableResult tableResult = env.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * from filesystemtable2&quot;&lt;/span&gt;);

      ArrayData actualArrayData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericArrayData((&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]) tableResult.collect().next().getField(1));
    }
  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Analysis:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. The code works fine with ARRAY&amp;lt;INT&amp;gt; datatype. The issue happens when using ARRAY&amp;lt;INT NOT NULL&amp;gt;.&lt;br/&gt;
2. The code works fine when casting into int[] instead of Object[].&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13557554">FLINK-33523</key>
            <summary>DataType ARRAY&lt;INT NOT NULL&gt; fails to cast into Object[]</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="martijnvisser">Martijn Visser</assignee>
                                    <reporter username="prabhujoseph">Prabhu Joseph</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 11 Nov 2023 03:45:08 +0000</created>
                <updated>Thu, 1 Feb 2024 09:41:01 +0000</updated>
                            <resolved>Fri, 8 Dec 2023 08:18:45 +0000</resolved>
                                    <version>1.18.0</version>
                                    <fixVersion>1.18.1</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="17789113" author="jeyhunkarimov" created="Thu, 23 Nov 2023 12:43:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prabhujoseph&quot; class=&quot;user-hover&quot; rel=&quot;prabhujoseph&quot;&gt;prabhujoseph&lt;/a&gt; thanks for reporting the issue. &lt;br/&gt;
The idea is that the type of array (ARRAY&amp;lt;INT NOT NULL&amp;gt;) enforces its elements to be NOT NULL.&lt;br/&gt;
Flink maps converts this to primitive types ( and not Object types) because primitive types cannot be null. &lt;/p&gt;

&lt;p&gt;That is why, when you eliminate NOT NULL condition this code snippet works (Flink converts this to the Object types - they can be null).&lt;/p&gt;
</comment>
                            <comment id="17789316" author="prabhu joseph" created="Fri, 24 Nov 2023 04:08:55 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeyhun&quot; class=&quot;user-hover&quot; rel=&quot;jeyhun&quot;&gt;jeyhun&lt;/a&gt;. Flink 1.17 does not have this enforcement. Flink 1.18 &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-31835&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;FLINK-31835&lt;/a&gt; has added the enforcement and has broken multiple places like &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-33547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;FLINK-33547 &lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/iceberg/issues/8930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Iceberg test cases&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="17794128" author="pvary" created="Thu, 7 Dec 2023 10:54:47 +0000"  >&lt;p&gt;Created a thread about this topic on the mailing list: &lt;a href=&quot;https://lists.apache.org/thread/m4c879y8mb7hbn2kkjh9h3d8g1jphh3j&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/m4c879y8mb7hbn2kkjh9h3d8g1jphh3j&lt;/a&gt;&lt;br/&gt;
I would appreciate if you can share your thoughts there &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prabhujoseph&quot; class=&quot;user-hover&quot; rel=&quot;prabhujoseph&quot;&gt;prabhujoseph&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeyhun&quot; class=&quot;user-hover&quot; rel=&quot;jeyhun&quot;&gt;jeyhun&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aitozi&quot; class=&quot;user-hover&quot; rel=&quot;aitozi&quot;&gt;aitozi&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xccui&quot; class=&quot;user-hover&quot; rel=&quot;xccui&quot;&gt;xccui&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17794170" author="twalthr" created="Thu, 7 Dec 2023 12:46:30 +0000"  >&lt;p&gt;Thanks for reporting this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prabhujoseph&quot; class=&quot;user-hover&quot; rel=&quot;prabhujoseph&quot;&gt;prabhujoseph&lt;/a&gt;. I replied already on the mailing list but I will repeat my opinion here. This is a heavily breaking changes and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-31835&quot; title=&quot;DataTypeHint don&amp;#39;t support Row&amp;lt;i Array&amp;lt;int&amp;gt;&amp;gt;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-31835&quot;&gt;&lt;del&gt;FLINK-31835&lt;/del&gt;&lt;/a&gt; should be reverted. It was a well-chosen decision that a NOT NULL constraint should not have an effect on the default conversion class.&lt;/p&gt;</comment>
                            <comment id="17794582" author="martijnvisser" created="Fri, 8 Dec 2023 08:18:45 +0000"  >&lt;p&gt;Fixed in apache/flink&lt;/p&gt;

&lt;p&gt;master: fcc7bc2e5e529b135aee28d732b8c5a6769afdae&lt;br/&gt;
release-1.18: 674d3a746417ceb36f74ccebb6a713549af59033&lt;/p&gt;</comment>
                            <comment id="17794588" author="jingge" created="Fri, 8 Dec 2023 08:41:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; thanks for driving it!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13557993">FLINK-33547</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13533004">FLINK-31835</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ljc0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>