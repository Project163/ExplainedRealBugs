<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-16068] table with keyword-escaped columns and computed_column_expression columns</title>
                <link>https://issues.apache.org/jira/browse/FLINK-16068</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I use sql-client to create a table with keyword-escaped column and computed_column_expression column, like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE source_kafka (
    log STRING,
    `time` BIGINT,
    pt as proctime()
) WITH (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,       
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.version&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;universal&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;k8s-logs&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.startup-mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;latest-offset&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.properties.zookeeper.connect&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;zk-1.zk:2181,zk-2.zk:2181,zk-3.zk:2181/kafka&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:9092&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;testGroup&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format.type&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format.fail-on-missing-field&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;update-mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;append&apos;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then I simply used it :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT * from source_kafka limit 10;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;got an exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Fail to run stream sql job
	at org.apache.zeppelin.flink.sql.AbstractStreamSqlJob.run(AbstractStreamSqlJob.java:164)
	at org.apache.zeppelin.flink.FlinkStreamSqlInterpreter.callSelect(FlinkStreamSqlInterpreter.java:108)
	at org.apache.zeppelin.flink.FlinkSqlInterrpeter.callCommand(FlinkSqlInterrpeter.java:203)
	at org.apache.zeppelin.flink.FlinkSqlInterrpeter.runSqlList(FlinkSqlInterrpeter.java:151)
	at org.apache.zeppelin.flink.FlinkSqlInterrpeter.interpret(FlinkSqlInterrpeter.java:104)
	at org.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:103)
	at org.apache.zeppelin.interpreter.remote.RemoteInterpreterServer$InterpretJob.jobRun(RemoteInterpreterServer.java:676)
	at org.apache.zeppelin.interpreter.remote.RemoteInterpreterServer$InterpretJob.jobRun(RemoteInterpreterServer.java:569)
	at org.apache.zeppelin.scheduler.Job.run(Job.java:172)
	at org.apache.zeppelin.scheduler.AbstractScheduler.runJob(AbstractScheduler.java:121)
	at org.apache.zeppelin.scheduler.ParallelScheduler.lambda$runJobInScheduler$0(ParallelScheduler.java:39)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.apache.flink.table.api.SqlParserException: SQL parse failed. Encountered &lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt; at line 1, column 12.
Was expecting one of:
    &lt;span class=&quot;code-quote&quot;&gt;&quot;ABS&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;ARRAY&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;AVG&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CARDINALITY&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CASE&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CAST&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CEIL&quot;&lt;/span&gt; ...
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CEILING&quot;&lt;/span&gt; ...
    ......
    
	at org.apache.flink.table.planner.calcite.CalciteParser.parse(CalciteParser.java:50)
	at org.apache.flink.table.planner.calcite.SqlExprToRexConverterImpl.convertToRexNodes(SqlExprToRexConverterImpl.java:79)
	at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.toRel(CatalogSourceTable.scala:111)
	at org.apache.calcite.sql2rel.SqlToRelConverter.toRel(SqlToRelConverter.java:3328)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertIdentifier(SqlToRelConverter.java:2357)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertFrom(SqlToRelConverter.java:2051)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertFrom(SqlToRelConverter.java:2005)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertSelectImpl(SqlToRelConverter.java:646)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertSelect(SqlToRelConverter.java:627)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertQueryRecursive(SqlToRelConverter.java:3181)
	at org.apache.calcite.sql2rel.SqlToRelConverter.convertQuery(SqlToRelConverter.java:563)
	at org.apache.flink.table.planner.calcite.FlinkPlannerImpl.org$apache$flink$table$planner$calcite$FlinkPlannerImpl$$rel(FlinkPlannerImpl.scala:148)
	at org.apache.flink.table.planner.calcite.FlinkPlannerImpl.rel(FlinkPlannerImpl.scala:135)
	at org.apache.flink.table.planner.operations.SqlToOperationConverter.toQueryOperation(SqlToOperationConverter.java:522)
	at org.apache.flink.table.planner.operations.SqlToOperationConverter.convertSqlQuery(SqlToOperationConverter.java:436)
	at org.apache.flink.table.planner.operations.SqlToOperationConverter.convert(SqlToOperationConverter.java:154)
	at org.apache.flink.table.planner.delegation.ParserImpl.parse(ParserImpl.java:66)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.sqlQuery(TableEnvironmentImpl.java:464)
	at org.apache.zeppelin.flink.sql.AbstractStreamSqlJob.run(AbstractStreamSqlJob.java:104)
	... 13 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I also did some tests, the following can run:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE source_kafka (
    log STRING,
    `aaaaa` BIGINT,
    pt as proctime()
)

CREATE TABLE source_kafka (
    log STRING,
    `time` BIGINT
)

CREATE TABLE source_kafka (
    log STRING,
    pt as proctime()
)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;can not run:&lt;/p&gt;

&lt;p&gt;`time` , `select`, `string`&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13285472">FLINK-16068</key>
            <summary>table with keyword-escaped columns and computed_column_expression columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="libenchao">Benchao Li</assignee>
                                    <reporter username="pangliang">pangliang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 15 Feb 2020 03:54:26 +0000</created>
                <updated>Mon, 2 Mar 2020 06:21:56 +0000</updated>
                            <resolved>Tue, 18 Feb 2020 07:11:34 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.1</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17037445" author="jark" created="Sat, 15 Feb 2020 07:45:49 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt;, could you help to take a look at this? It seems there is a bug in the SQL parser when the column name is a keyword and a computed column in the definition.  &lt;/p&gt;</comment>
                            <comment id="17037541" author="libenchao" created="Sat, 15 Feb 2020 16:35:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pangliang&quot; class=&quot;user-hover&quot; rel=&quot;pangliang&quot;&gt;pangliang&lt;/a&gt;&#160;Thanks for reporting this, and your nice example sql which can be easily reproduced.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; After looking into the stack trace and source code, I found it&apos;s because in &lt;tt&gt;CatalogSourceTable&lt;/tt&gt;:L103, we use field names and computed column expressions to construct a new expr list, and we simply use field name as the expression for non computed column.&lt;/p&gt;

&lt;p&gt;IMO, a simple fix here is we can add&#160;escape character around the field name. (actually, in our internal computed column implementation, we encountered this problem as well, and resolved it this way).&lt;/p&gt;</comment>
                            <comment id="17037722" author="jark" created="Sun, 16 Feb 2020 07:19:28 +0000"  >&lt;p&gt;Thanks for looking into this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;. I think the bug is in &lt;tt&gt;org.apache.flink.table.planner.calcite.SqlExprToRexConverterImpl#convertToRexNodes&lt;/tt&gt; where we should escape all field names and functions for the constructed query. &lt;/p&gt;

&lt;p&gt;If you are interested in it, I can assign it to you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="17037741" author="libenchao" created="Sun, 16 Feb 2020 07:55:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;I&apos;m interested in this issue, thanks for assigning this to me.&lt;/p&gt;</comment>
                            <comment id="17037766" author="libenchao" created="Sun, 16 Feb 2020 10:09:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;I looked into this again, and found that exprs in &lt;tt&gt;TableColumn&lt;/tt&gt; has been escaped correctly, and it should be guaranteed by &lt;tt&gt;TableSchema.field(String name, DataType dataType, String expression)&lt;/tt&gt;.&#160;&lt;/p&gt;

&lt;p&gt;Even not for that, escaping an expr from &lt;tt&gt;String&lt;/tt&gt; type is a hard work, for example &quot;udf_1(col1, col2)&quot; should be escaped like &quot;`udf1`(`col1`, `col2`)&quot; which is a very hard work. So it&apos;s easy and natural to generate escaped expr from Calcite&apos;s &lt;tt&gt;SqlNode&lt;/tt&gt; in early phase.&lt;/p&gt;

&lt;p&gt;Then, we only need to escape column name, instead of column name and exprs.&lt;/p&gt;

&lt;p&gt;If you are fine with this way of fixing, I&apos;ll open the pr later.&lt;/p&gt;</comment>
                            <comment id="17037786" author="jark" created="Sun, 16 Feb 2020 11:36:57 +0000"  >&lt;p&gt;You are right &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;. We have added a long description for the expression parameter of &lt;tt&gt;TableSchema#field(name, type, expression)&lt;/tt&gt; that the expression should be escaped. &lt;/p&gt;</comment>
                            <comment id="17038837" author="jark" created="Tue, 18 Feb 2020 07:11:34 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master(1.11.0): 00649491e2b05bb1ade46355b3002a5dad75c7eb&lt;/li&gt;
	&lt;li&gt;1.10.1: b3c035da1f0f7ef88233f4957bcf9c2c1f06310f&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13288595">FLINK-16358</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bix4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>