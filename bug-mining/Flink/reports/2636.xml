<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10376] BlobCacheCleanupTest.testPermanentBlobCleanup failed on Travis</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10376</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;BlobCacheCleanupTest.testPermanentBlobCleanup&lt;/tt&gt; failed on Travis with the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testPermanentBlobCleanup(org.apache.flink.runtime.blob.BlobCacheCleanupTest)  Time elapsed: 1.021 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.io.IOException: Cannot create directory &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/junit6933344779576098111/junit6230481778643276963/blobStore-77f235ff-1721-4c30-9bec-db4004fe8859/job_9ca4b9530b367af6f554dad6458ca3ad&apos;&lt;/span&gt;.
	at org.apache.flink.runtime.blob.BlobUtils.mkdirTolerateExisting(BlobUtils.java:214)
	at org.apache.flink.runtime.blob.BlobUtils.getStorageLocation(BlobUtils.java:237)
	at org.apache.flink.runtime.blob.PermanentBlobCache.getStorageLocation(PermanentBlobCache.java:222)
	at org.apache.flink.runtime.blob.BlobServerCleanupTest.checkFilesExist(BlobServerCleanupTest.java:213)
	at org.apache.flink.runtime.blob.BlobCacheCleanupTest.verifyJobCleanup(BlobCacheCleanupTest.java:432)
	at org.apache.flink.runtime.blob.BlobCacheCleanupTest.testPermanentBlobCleanup(BlobCacheCleanupTest.java:133)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://api.travis-ci.org/v3/job/430910115/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/430910115/log.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13186334">FLINK-10376</key>
            <summary>BlobCacheCleanupTest.testPermanentBlobCleanup failed on Travis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tison">Zili Chen</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Thu, 20 Sep 2018 12:51:11 +0000</created>
                <updated>Mon, 24 Sep 2018 11:14:26 +0000</updated>
                            <resolved>Mon, 24 Sep 2018 11:14:25 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16622029" author="tison" created="Thu, 20 Sep 2018 13:21:43 +0000"  >&lt;p&gt;Highly suspect this is caused by a thread unsafe method&#160;BlobUtils#mkdirTolerateExisting&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;dir.mkdirs() by Thread#1 concurrency to dir.mkdirs() by Thread#2&lt;/li&gt;
	&lt;li&gt;Thread#1 mkdir but not finished, Thread#2 detect it and return false from mkdir and test exist&lt;/li&gt;
	&lt;li&gt;Because Thread#1&apos;s mkdir not finished, Thread#2&apos;s test fail&lt;/li&gt;
	&lt;li&gt;throw the exception&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;To solve it, I suggest replace this method by Files#createDirectories, which promise atomic.&lt;/p&gt;</comment>
                            <comment id="16622041" author="githubbot" created="Thu, 20 Sep 2018 13:30:55 +0000"  >&lt;p&gt;TisonKun opened a new pull request #6721: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10376&quot; title=&quot;BlobCacheCleanupTest.testPermanentBlobCleanup failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10376&quot;&gt;&lt;del&gt;FLINK-10376&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Replace mkdirTolerateExisting by thread safe Files#createDirectories&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6721&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Mainly to resolve the unstable test `BlobCacheCleanupTest#testPermanentBlobCleanup`. By replace `BlobUtils#mkdirTolerateExisting` with the same functional&#65288;but thread-safe) method `java.nio.file.Files#createDirectories`.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Verified by passing existing tests, since it is a reinforce.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16622101" author="githubbot" created="Thu, 20 Sep 2018 14:03:26 +0000"  >&lt;p&gt;TisonKun commented on issue #6721: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10376&quot; title=&quot;BlobCacheCleanupTest.testPermanentBlobCleanup failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10376&quot;&gt;&lt;del&gt;FLINK-10376&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Replace mkdirTolerateExisting by thread safe Files#createDirectories&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6721#issuecomment-423195382&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6721#issuecomment-423195382&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   cc @tillrohrmann @GJL &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16623265" author="githubbot" created="Fri, 21 Sep 2018 08:29:35 +0000"  >&lt;p&gt;TisonKun commented on issue #6721: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10376&quot; title=&quot;BlobCacheCleanupTest.testPermanentBlobCleanup failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10376&quot;&gt;&lt;del&gt;FLINK-10376&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Replace mkdirTolerateExisting by thread safe Files#createDirectories&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6721#issuecomment-423456515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6721#issuecomment-423456515&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   travis gives green and the unstable one is theoretically hardened. @tillrohrmann  &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16625657" author="githubbot" created="Mon, 24 Sep 2018 11:14:09 +0000"  >&lt;p&gt;zentol closed pull request #6721: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10376&quot; title=&quot;BlobCacheCleanupTest.testPermanentBlobCleanup failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10376&quot;&gt;&lt;del&gt;FLINK-10376&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Replace mkdirTolerateExisting by thread safe Files#createDirectories&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6721&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobUtils.java&lt;br/&gt;
index a61d679a156..7610817d7c1 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobUtils.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobUtils.java&lt;br/&gt;
@@ -192,29 +192,11 @@ static File initLocalStorageDirectory(Configuration config) throws IOException {&lt;br/&gt;
 	static File getIncomingDirectory(File storageDir) throws IOException &lt;/p&gt;
{
 		final File incomingDir = new File(storageDir, &quot;incoming&quot;);
 
-		mkdirTolerateExisting(incomingDir);
+		Files.createDirectories(incomingDir.toPath());
 
 		return incomingDir;
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Makes sure a given directory exists by creating it if necessary.&lt;/li&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @param dir&lt;/li&gt;
	&lt;li&gt;* 		directory to create&lt;/li&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @throws IOException&lt;/li&gt;
	&lt;li&gt;* 		if creating the directory fails&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;private static void mkdirTolerateExisting(final File dir) throws IOException {&lt;/li&gt;
	&lt;li&gt;// note: thread-safe create should try to mkdir first and then ignore the case that the&lt;/li&gt;
	&lt;li&gt;//       directory already existed&lt;/li&gt;
	&lt;li&gt;if (!dir.mkdirs() &amp;amp;&amp;amp; !dir.exists()) 
{
-			throw new IOException(
-				&quot;Cannot create directory &apos;&quot; + dir.getAbsolutePath() + &quot;&apos;.&quot;);
-		}&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
-&lt;br/&gt;
 	/**&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;Returns the (designated) physical storage location of the BLOB with the given key.&lt;br/&gt;
 	 *&lt;br/&gt;
@@ -234,7 +216,7 @@ static File getStorageLocation(&lt;br/&gt;
 			File storageDir, @Nullable JobID jobId, BlobKey key) throws IOException 
{
 		File file = new File(getStorageLocationPath(storageDir.getAbsolutePath(), jobId, key));
 
-		mkdirTolerateExisting(file.getParentFile());
+		Files.createDirectories(file.getParentFile().toPath());
 
 		return file;
 	}
&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/blob/BlobServerPutTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/blob/BlobServerPutTest.java&lt;br/&gt;
index 202d87e0c63..db368aa02e7 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/test/java/org/apache/flink/runtime/blob/BlobServerPutTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/blob/BlobServerPutTest.java&lt;br/&gt;
@@ -492,8 +492,7 @@ private void testPutBufferFails(@Nullable final JobID jobId, BlobKey.BlobType bl&lt;br/&gt;
 			rnd.nextBytes(data);&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			// upload the file to the server directly&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;exception.expect(IOException.class);&lt;/li&gt;
	&lt;li&gt;exception.expectMessage(&quot;Cannot create directory &quot;);&lt;br/&gt;
+			exception.expect(AccessDeniedException.class);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			put(server, jobId, data, blobType);&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16625658" author="zentol" created="Mon, 24 Sep 2018 11:14:26 +0000"  >&lt;p&gt;master: 8bd9436aaac3e222cac0668820f15245deb4fc49&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yawn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>