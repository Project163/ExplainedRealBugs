<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24691] FLINK SQL SUM() causes a precision error</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24691</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;code:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tableEnv.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select sum(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;( 1.03520274 as decimal(32, 8))) as num &quot;&lt;/span&gt;).print();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;expected:&lt;/p&gt;

&lt;p&gt;1.03520274&lt;/p&gt;

&lt;p&gt;actual:&lt;/p&gt;

&lt;p&gt;1.03520270&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This function is normal in version 1.13.x.&lt;/p&gt;

&lt;p&gt;I found the code that caused the inconsistency&#65306;&lt;/p&gt;

&lt;p&gt;org.apache.flink.table.types.logical.utils.LogicalTypeMerging#adjustPrecisionScale method was added in 1.14. Because sum() generates max precision(38) by default, it leads to special circumstances, which reduces the scale by 1.&lt;/p&gt;

&lt;p&gt;&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13035462/13035462_image-2021-10-29-15-49-14-419.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13409048">FLINK-24691</key>
            <summary>FLINK SQL SUM() causes a precision error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matriv">Marios Trivyzas</assignee>
                                    <reporter username="Ashulin">Zongwen Li</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 29 Oct 2021 06:41:57 +0000</created>
                <updated>Wed, 15 Dec 2021 01:44:04 +0000</updated>
                            <resolved>Tue, 9 Nov 2021 08:05:52 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17435808" author="martijnvisser" created="Fri, 29 Oct 2021 07:02:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matriv&quot; class=&quot;user-hover&quot; rel=&quot;matriv&quot;&gt;matriv&lt;/a&gt; Do you have any thoughts on this one?&lt;/p&gt;</comment>
                            <comment id="17435830" author="ashulin" created="Fri, 29 Oct 2021 07:45:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matriv&quot; class=&quot;user-hover&quot; rel=&quot;matriv&quot;&gt;matriv&lt;/a&gt;&#160;org.apache.flink.table.types.logical.utils.LogicalTypeMerging#adjustPrecisionScale method was added in 1.14. Because sum() generates&#160;max precision(38)&#160;by default, it leads to special circumstances, which reduces the scale by 1.&lt;/p&gt;</comment>
                            <comment id="17436868" author="matriv" created="Mon, 1 Nov 2021 14:42:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ashulin&quot; class=&quot;user-hover&quot; rel=&quot;Ashulin&quot;&gt;Ashulin&lt;/a&gt;&#160;Thank you! I missed your comment, but I found it myself, working on fixing the issue and adding tests.&lt;/p&gt;</comment>
                            <comment id="17438679" author="matriv" created="Thu, 4 Nov 2021 12:20:55 +0000"  >&lt;p&gt;Decided to keep the &lt;b&gt;adjustPrecisionScale&lt;/b&gt;&#160;as is (follow Hive/Spark approach and not 100% SQL Server approach) and instead use an explicit&#160;&lt;b&gt;cast&lt;/b&gt; to wrap the&#160;&lt;b&gt;plus&lt;/b&gt; operator implementing sum to prevent overriding the precision/scale calculated specifically for&#160;&lt;b&gt;SUM&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="17440962" author="twalthr" created="Tue, 9 Nov 2021 08:05:52 +0000"  >&lt;p&gt;Fixed in master: 09b3061345e10ac043346dedf5e5ffe5cb45d091&lt;/p&gt;

&lt;p&gt;Fixed in 1.14: bafb0b4c2377d6d502ed9dba8853631ebf16cfb7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13410379">FLINK-24809</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13035462" name="image-2021-10-29-15-49-14-419.png" size="210632" author="Ashulin" created="Fri, 29 Oct 2021 07:49:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w9sg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This changes the result of a decimal SUM() between 1.14.0 and 1.14.1. It restores the behavior of 1.13 to be consistent with Hive/Spark.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>