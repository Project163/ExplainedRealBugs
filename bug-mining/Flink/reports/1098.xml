<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3713] DisposeSavepoint message uses system classloader to discard state</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3713</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;DisposeSavepoint&lt;/tt&gt; message in the JobManager is using the system classloader to discard the state:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val savepoint = savepointStore.getState(savepointPath)

log.debug(s&lt;span class=&quot;code-quote&quot;&gt;&quot;$savepoint&quot;&lt;/span&gt;)

&lt;span class=&quot;code-comment&quot;&gt;// Discard the associated checkpoint
&lt;/span&gt;savepoint.discard(getClass.getClassLoader)

&lt;span class=&quot;code-comment&quot;&gt;// Dispose the savepoint
&lt;/span&gt;savepointStore.disposeState(savepointPath)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which leads to issues when the state contains user classes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-04-07 03:02:12,225 INFO  org.apache.flink.yarn.YarnJobManager                          - Disposing savepoint at &lt;span class=&quot;code-quote&quot;&gt;&apos;hdfs:/bigdata/flink/savepoints/savepoint-7610540d089f&apos;&lt;/span&gt;.
2016-04-07 03:02:12,233 WARN  org.apache.flink.runtime.checkpoint.StateForTask              - Failed to discard checkpoint state: StateForTask eed5cc5a12dc2e0672848ba81bd8fa6d-0 : SerializedValue
java.lang.ClassNotFoundException: &amp;lt;some_package&amp;gt;.MetricsProcessor$CombinedKeysFoldFunction
	at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:425)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:358)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:270)
	at org.apache.flink.util.InstantiationUtil$ClassLoaderObjectInputStream.resolveClass(InstantiationUtil.java:64)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1612)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1517)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1771)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)
	at java.util.HashMap.readObject(HashMap.java:1184)
	at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1017)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1893)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1706)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1344)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)
	at org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:290)
	at org.apache.flink.util.SerializedValue.deserializeValue(SerializedValue.java:58)
	at org.apache.flink.runtime.checkpoint.StateForTask.discard(StateForTask.java:109)
	at org.apache.flink.runtime.checkpoint.CompletedCheckpoint.discard(CompletedCheckpoint.java:85)
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$6.apply$mcV$sp(JobManager.scala:635)
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$6.apply(JobManager.scala:627)
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$6.apply(JobManager.scala:627)
	at scala.concurrent.impl.Future$PromiseCompletingRunnable.liftedTree1$1(Future.scala:24)
	at scala.concurrent.impl.Future$PromiseCompletingRunnable.run(Future.scala:24)
	at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:41)
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:401)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue was reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knaufk&quot; class=&quot;user-hover&quot; rel=&quot;knaufk&quot;&gt;knaufk&lt;/a&gt; and analyzed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12956813">FLINK-3713</key>
            <summary>DisposeSavepoint message uses system classloader to discard state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uce">Ufuk Celebi</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Apr 2016 09:46:25 +0000</created>
                <updated>Thu, 28 Feb 2019 14:01:19 +0000</updated>
                            <resolved>Mon, 18 Jul 2016 15:06:05 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15230043" author="uce" created="Thu, 7 Apr 2016 10:14:13 +0000"  >&lt;p&gt;This is unfortunately a known limitation (&lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.0/apis/streaming/savepoints.html#current-limitations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci.apache.org/projects/flink/flink-docs-release-1.0/apis/streaming/savepoints.html#current-limitations&lt;/a&gt;), which I only thought of after I was &quot;done&quot; with the initial pull request preparations.&lt;/p&gt;

&lt;p&gt;How much of an headache is this for you right now?&lt;/p&gt;</comment>
                            <comment id="15230050" author="rmetzger" created="Thu, 7 Apr 2016 10:21:22 +0000"  >&lt;p&gt;One possible workaround for the issue is the following: You can put the job jar into the lib/ folder of flink. Then, the user code is available through the system classloader and Flink can find the class when discarding the state.&lt;/p&gt;</comment>
                            <comment id="15230058" author="knaufk" created="Thu, 7 Apr 2016 10:30:02 +0000"  >&lt;p&gt;Just for my understanding: &lt;br/&gt;
It says there&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Disposing custom state handles: Disposing an old savepoint does not work with custom state handles (if you are using a custom state backend), because the user code class loader is not available during disposal.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We are using FsStateBackend, not a custome state backend. Or does &quot;custom state backend&quot; always mean user classes?&lt;/p&gt;

&lt;p&gt;Let me give you some context, maybe we can come up with a different solution: &lt;/p&gt;

&lt;p&gt;We have a streaming job, which should always be running. Normally, flink should handle failures, but we can not solely rely on it (max restart attempts, some bug,..). So we have a script, which runs regularly and checks if the job is still running. If it is not running over a period of x minutes (to take account for automatic recovery by flink) the job is restarted again from a savepoint. Everytime this script runs a new savepoint is triggered, and the old one is discarded. So we need this regular savepoint to be able to do this &quot;manual&quot; recovery. So we are triggering quite a lot of savepoints and need some way of cleaning up the old ones. Do you have a different idea how to do this cleanup? Just deleting the directory in HDFS? If you have a complete different idea how to handle this supervision, I am also happy about suggestions. &lt;/p&gt;</comment>
                            <comment id="15230103" author="uce" created="Thu, 7 Apr 2016 11:21:15 +0000"  >&lt;p&gt;It applies for any custom state (I don&apos;t know for sure whether it did only apply to custom state backends when savepoints were introduced).&lt;/p&gt;

&lt;p&gt;Robert suggested as a work around to add the user jar to the classpath of Flink (e.g. by adding it to the lib folder of your installation). Can you try this as a work around?&lt;/p&gt;

&lt;p&gt;The easiest fix will be to require the user JAR when discarding savepoints. Sounds like something we need to add to 1.0.2 soon.&lt;/p&gt;</comment>
                            <comment id="15230124" author="knaufk" created="Thu, 7 Apr 2016 11:46:51 +0000"  >&lt;p&gt;I will give that a try and report.&lt;/p&gt;</comment>
                            <comment id="15232116" author="knaufk" created="Fri, 8 Apr 2016 12:24:00 +0000"  >&lt;p&gt;Works as expected.&lt;/p&gt;</comment>
                            <comment id="15233497" author="uce" created="Sat, 9 Apr 2016 11:03:03 +0000"  >&lt;p&gt;OK, sorry for this inconvenience. I hope to fix this soon. I think I&apos;ll go with asking for the JAR during disposal.&lt;/p&gt;</comment>
                            <comment id="15277761" author="knaufk" created="Tue, 10 May 2016 07:46:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uce&quot; class=&quot;user-hover&quot; rel=&quot;uce&quot;&gt;uce&lt;/a&gt; Any progress on this? The workaround starts to get really annoying because of conflicting dependencies in different jobs...&lt;/p&gt;</comment>
                            <comment id="15277835" author="uce" created="Tue, 10 May 2016 09:06:39 +0000"  >&lt;p&gt;Not yet, but I will assign this to myself and look into it until next week.&lt;/p&gt;</comment>
                            <comment id="15277969" author="knaufk" created="Tue, 10 May 2016 11:38:25 +0000"  >&lt;p&gt;Great, thank you!&lt;/p&gt;</comment>
                            <comment id="15306429" author="uce" created="Mon, 30 May 2016 09:24:06 +0000"  >&lt;p&gt;Sorry, I didn&apos;t yet have time to work on this. I hope to do it before the next release though.&lt;/p&gt;</comment>
                            <comment id="15320670" author="githubbot" created="Wed, 8 Jun 2016 14:45:12 +0000"  >&lt;p&gt;GitHub user uce opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3713&quot; title=&quot;DisposeSavepoint message uses system classloader to discard state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3713&quot;&gt;&lt;del&gt;FLINK-3713&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;clients, runtime&amp;#93;&lt;/span&gt; Use user code class loader when disposing savepoints&lt;/p&gt;

&lt;p&gt;    Disposing savepoints via the JobManager fails for state handles or descriptors, which contain user classes (for example custom folding state or RocksDB handles).&lt;/p&gt;

&lt;p&gt;    With this change, the user has to provide the job ID of a running job when disposing a savepoint in order to use the user code class loader of that job or provide the job JARs.&lt;/p&gt;

&lt;p&gt;    This version breaks the API as the CLI now requires either a JobID or a JAR. I think this is reasonable, because the current approach only works for a subset of the available state variants.&lt;/p&gt;

&lt;p&gt;    We can port this back for 1.0.4 and make the JobID or JAR arguments optional. What do you think?&lt;/p&gt;

&lt;p&gt;    I&apos;ve tested this with a job running on RocksDB state both while the job was running and after it terminated. This was not working with the current 1.0.3 version.&lt;/p&gt;

&lt;p&gt;    Ideally, we will get rid of the whole disposal business when we make savepoints properly self-contained. I&apos;m going to open a JIRA issue with a proposal to do so soon.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/uce/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uce/flink&lt;/a&gt; 3713-dispose_savepoint&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2083&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1cdfe9b4df3584b3c3c48168cd3f17100dbebf4c&lt;br/&gt;
Author: Ufuk Celebi &amp;lt;uce@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-06-08T08:59:24Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3713&quot; title=&quot;DisposeSavepoint message uses system classloader to discard state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3713&quot;&gt;&lt;del&gt;FLINK-3713&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;clients, runtime&amp;#93;&lt;/span&gt; Use user code class loader when disposing savepoint&lt;/p&gt;

&lt;p&gt;    Disposing savepoints via the JobManager fails for state handles or descriptors,&lt;br/&gt;
    which contain user classes (for example custom folding state or RocksDB handles).&lt;/p&gt;

&lt;p&gt;    With this change, the user has to provide the job ID of a running job when disposing&lt;br/&gt;
    a savepoint in order to use the user code class loader of that job or provide the&lt;br/&gt;
    job JARs.&lt;/p&gt;

&lt;p&gt;    This version breaks the API as the CLI now requires either a JobID or a JAR. I think&lt;br/&gt;
    this is reasonable, because the current approach only works for a subset of the&lt;br/&gt;
    available state variants.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15325398" author="githubbot" created="Fri, 10 Jun 2016 22:26:48 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It seems very clumsy to dispose savepoints like that. If that is needed for a fix currently, then I guess we have to live with that.&lt;/p&gt;

&lt;p&gt;    Would make sense to make the jar and jobid optional, so that non-custom cases can dispose the savepoints in the simple way.&lt;br/&gt;
    Then, we could ad the RocksDB state backend to the jar in the flink distribution lib folder, so that it is always available and would not need jar or jobid for disposal. That would give the least user friction...&lt;/p&gt;</comment>
                            <comment id="15325771" author="githubbot" created="Sat, 11 Jun 2016 08:04:30 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Full ack, but the problem is not just RocksDB, but also savepoints, which reference a user class in the state descriptor, including FS snapshots. So if you configure a file backend and use folding or reducing state, you run into the issue as well.&lt;/p&gt;

&lt;p&gt;    What about the following: make it optional and fail with a proper error message in case of a missing user code class. SubtaskState (previously StateForTask), which fails to dispose the state snapshots currently only logs the Exception. We can change this to rethrow and then we give a proper error message on failed savepoint disposal.&lt;/p&gt;</comment>
                            <comment id="15350947" author="githubbot" created="Mon, 27 Jun 2016 12:59:57 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68571489&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68571489&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/apis/cli.md &amp;#8212;&lt;br/&gt;
    @@ -279,13 +289,27 @@ guarantees for a stop request.&lt;/p&gt;

&lt;p&gt;     Action &quot;savepoint&quot; triggers savepoints for a running job or disposes existing ones.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Syntax: savepoint &lt;span class=&quot;error&quot;&gt;&amp;#91;OPTIONS&amp;#93;&lt;/span&gt; &amp;lt;Job ID&amp;gt;&lt;/li&gt;
	&lt;li&gt;&quot;savepoint&quot; action options:&lt;/li&gt;
	&lt;li&gt;&lt;del&gt;d,&lt;/del&gt;-dispose &amp;lt;savepointPath&amp;gt;   Disposes an existing savepoint.&lt;/li&gt;
	&lt;li&gt;&lt;del&gt;m,&lt;/del&gt;-jobmanager &amp;lt;host:port&amp;gt;    Address of the JobManager (master) to which
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What happened to the jobmanager option?&lt;/p&gt;</comment>
                            <comment id="15350959" author="githubbot" created="Mon, 27 Jun 2016 13:10:45 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68572931&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68572931&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/cli/CliFrontendParser.java &amp;#8212;&lt;br/&gt;
    @@ -305,6 +307,11 @@ public static void printHelpForSavepoint() {&lt;br/&gt;
     		formatter.setSyntaxPrefix(&quot;  \&quot;savepoint\&quot; action options:&quot;);&lt;br/&gt;
     		formatter.printHelp(&quot; &quot;, getSavepointOptions(new Options()));&lt;br/&gt;
     		System.out.println();&lt;br/&gt;
    +		System.out.println(&quot;\n  Examples:&quot;);&lt;br/&gt;
    +		System.out.println(&quot;  - Trigger savepoint: bin/flink savepoint &amp;lt;Job ID&amp;gt;&quot;);&lt;br/&gt;
    +		System.out.println(&quot;  - Dispose savepoint:&quot;);&lt;br/&gt;
    +		System.out.println(&quot;    * For a running job: bin/flink savepoint -d &amp;lt;Path&amp;gt; &amp;lt;Job ID&amp;gt;&quot;);&lt;br/&gt;
    +		System.out.println(&quot;    * For a terminated job: bin/flink savepoint -d &amp;lt;Path&amp;gt; -j &amp;lt;Jar&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;-c &amp;lt;mainClass&amp;gt; -C &amp;lt;classPath&amp;gt;&amp;#93;&lt;/span&gt;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Is it consistent that we specify the job id without an option whereas we specify the jar with `-j`? Shouldn&apos;t only those parameters which are used everywhere be used without an option flag?&lt;/p&gt;</comment>
                            <comment id="15351039" author="githubbot" created="Mon, 27 Jun 2016 13:55:20 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68579929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68579929&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -790,39 +767,95 @@ else if (result instanceof TriggerSavepointFailure) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Sends a 
{@link org.apache.flink.runtime.messages.JobManagerMessages.DisposeSavepoint}&lt;/li&gt;
	&lt;li&gt;* message to the job manager.&lt;br/&gt;
    +	 * Asks the JobManager to dispose a savepoint.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;There are two options for this:&lt;br/&gt;
    +	 * &amp;lt;ul&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Either the job the savepoint belongs to is still running, in which&lt;br/&gt;
    +	 * case the user code class loader of the job is used.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Or the job terminated, in which case the user JARs have to be&lt;br/&gt;
    +	 * uploaded before disposing the savepoint.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ul&amp;gt;&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;private int disposeSavepoint(SavepointOptions options, String savepointPath) {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;ActorGateway jobManager = getJobManagerGateway(options);&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Disposing savepoint &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;/li&gt;
	&lt;li&gt;Future&amp;lt;Object&amp;gt; response = jobManager.ask(new DisposeSavepoint(savepointPath), clientTimeout);&lt;br/&gt;
    +	private int disposeSavepoint(SavepointOptions options) throws Throwable {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Have we actually tested somewhere that the jars we&apos;re uploading to the JobManager allow us to dispose the given savepoint with user code?&lt;/p&gt;</comment>
                            <comment id="15351043" author="githubbot" created="Mon, 27 Jun 2016 13:57:03 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68580226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68580226&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -790,39 +767,95 @@ else if (result instanceof TriggerSavepointFailure) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Sends a 
{@link org.apache.flink.runtime.messages.JobManagerMessages.DisposeSavepoint}&lt;/li&gt;
	&lt;li&gt;* message to the job manager.&lt;br/&gt;
    +	 * Asks the JobManager to dispose a savepoint.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;There are two options for this:&lt;br/&gt;
    +	 * &amp;lt;ul&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Either the job the savepoint belongs to is still running, in which&lt;br/&gt;
    +	 * case the user code class loader of the job is used.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Or the job terminated, in which case the user JARs have to be&lt;br/&gt;
    +	 * uploaded before disposing the savepoint.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ul&amp;gt;&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;private int disposeSavepoint(SavepointOptions options, String savepointPath) {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;ActorGateway jobManager = getJobManagerGateway(options);&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Disposing savepoint &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;/li&gt;
	&lt;li&gt;Future&amp;lt;Object&amp;gt; response = jobManager.ask(new DisposeSavepoint(savepointPath), clientTimeout);&lt;br/&gt;
    +	private int disposeSavepoint(SavepointOptions options) throws Throwable {&lt;br/&gt;
    +		String savepointPath = Preconditions.checkNotNull(options.getSavepointPath(), &quot;Savepoint path&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object result;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Waiting for response...&quot;);&lt;/li&gt;
	&lt;li&gt;result = Await.result(response, clientTimeout);&lt;br/&gt;
    +		JobID jobId = options.getJobId();&lt;br/&gt;
    +		String jarFile = options.getJarFilePath();&lt;br/&gt;
    +&lt;br/&gt;
    +		if (jobId != null &amp;amp;&amp;amp; jarFile != null) 
{
    +			throw new IllegalArgumentException(&quot;Cannot dispose savepoint without Job ID or JAR.&quot;);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		ActorGateway jobManager = getJobManagerGateway(options);&lt;br/&gt;
    +&lt;br/&gt;
    +		final Future&amp;lt;Object&amp;gt; response;&lt;br/&gt;
    +		if (jobId != null) &lt;/p&gt;
{
    +			// Dispose with class loader of running job
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos; of job &quot; + jobId + &quot; .&quot;);
    +
    +			response = jobManager.ask(
    +					new JobManagerMessages.DisposeSavepoint(savepointPath, jobId),
    +					clientTimeout);
    +		}
&lt;p&gt; else if (jarFile != null) {&lt;br/&gt;
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +			// Dispose with uploaded user code loader&lt;br/&gt;
    +			Optimizer compiler = new Optimizer(new DataStatistics(), new DefaultCostEstimator(), config);&lt;br/&gt;
    +			PackagedProgram program = new PackagedProgram(&lt;br/&gt;
    +					new File(jarFile),&lt;br/&gt;
    +					options.getClasspaths(),&lt;br/&gt;
    +					options.getEntryPointClass(),&lt;br/&gt;
    +					options.getProgramArgs());&lt;br/&gt;
    +			FlinkPlan flinkPlan = Client.getOptimizedPlan(compiler, program, 1);&lt;br/&gt;
    +&lt;br/&gt;
    +			JobGraph jobGraph;&lt;br/&gt;
    +			if (flinkPlan instanceof StreamingPlan) &lt;/p&gt;
{
    +				jobGraph = ((StreamingPlan) flinkPlan).getJobGraph();
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				JobGraphGenerator gen = new JobGraphGenerator(this.config);
    +				jobGraph = gen.compileJobGraph((OptimizedPlan) flinkPlan);
     			}&lt;/li&gt;
	&lt;li&gt;catch (Exception e) {&lt;/li&gt;
	&lt;li&gt;throw new Exception(&quot;Disposing the savepoint with path&quot; + savepointPath + &quot; failed.&quot;, e);&lt;br/&gt;
    +&lt;br/&gt;
    +			for (URL jar : program.getAllLibraries()) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				try {
    +					jobGraph.addJar(new Path(jar.toURI()));
    +				} catch (URISyntaxException e) {
    +					throw new RuntimeException(&quot;URL is invalid. This should not happen.&quot;, e);
    +				}     			}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +			jobGraph.setClasspaths(program.getClasspaths());&lt;br/&gt;
    +&lt;br/&gt;
    +			logAndSysout(&quot;Uploading JAR files for savepoint disposal.&quot;);&lt;br/&gt;
    +			JobClient.uploadJarFiles(jobGraph, jobManager, clientTimeout);&lt;br/&gt;
    +&lt;br/&gt;
    +			response = jobManager.ask(&lt;br/&gt;
    +					new JobManagerMessages.DisposeSavepointWithClassLoader(&lt;br/&gt;
    +							savepointPath,&lt;br/&gt;
    +							jobGraph.getUserJarBlobKeys(),&lt;br/&gt;
    +							jobGraph.getClasspaths()),&lt;br/&gt;
    +					clientTimeout);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Do we really have to go through all this to extract the jar file paths? Wouldn&apos;t it be sufficient to do something like this:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    // Dispose with uploaded user code loader&lt;br/&gt;
    JobGraph jobGraph = new JobGraph(&quot;foobar&quot;);&lt;/p&gt;

&lt;p&gt;    jobGraph.addJar(new Path(new File(jarFile).getAbsoluteFile().toURI()));&lt;/p&gt;

&lt;p&gt;    // extract libraries&lt;br/&gt;
    List&amp;lt;File&amp;gt; libraries = PackagedProgram.extractContainedLibaries(new File(jarFile).getAbsoluteFile().toURI().toURL());&lt;/p&gt;

&lt;p&gt;    for (File jar : libraries) &lt;/p&gt;
{
    	jobGraph.addJar(new Path(jar.toURI()));
    }

&lt;p&gt;    logAndSysout(&quot;Uploading JAR files for savepoint disposal.&quot;);&lt;br/&gt;
    JobClient.uploadJarFiles(jobGraph, jobManager, clientTimeout);&lt;/p&gt;

&lt;p&gt;    response = jobManager.ask(&lt;br/&gt;
    		new JobManagerMessages.DisposeSavepointWithClassLoader(&lt;br/&gt;
    				savepointPath,&lt;br/&gt;
    				jobGraph.getUserJarBlobKeys(),&lt;br/&gt;
    				options.getClasspaths()),&lt;br/&gt;
    		clientTimeout);&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="15351046" author="githubbot" created="Mon, 27 Jun 2016 13:58:20 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68580451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68580451&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -790,39 +767,95 @@ else if (result instanceof TriggerSavepointFailure) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Sends a 
{@link org.apache.flink.runtime.messages.JobManagerMessages.DisposeSavepoint}&lt;/li&gt;
	&lt;li&gt;* message to the job manager.&lt;br/&gt;
    +	 * Asks the JobManager to dispose a savepoint.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;There are two options for this:&lt;br/&gt;
    +	 * &amp;lt;ul&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Either the job the savepoint belongs to is still running, in which&lt;br/&gt;
    +	 * case the user code class loader of the job is used.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Or the job terminated, in which case the user JARs have to be&lt;br/&gt;
    +	 * uploaded before disposing the savepoint.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ul&amp;gt;&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;private int disposeSavepoint(SavepointOptions options, String savepointPath) {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;ActorGateway jobManager = getJobManagerGateway(options);&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Disposing savepoint &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;/li&gt;
	&lt;li&gt;Future&amp;lt;Object&amp;gt; response = jobManager.ask(new DisposeSavepoint(savepointPath), clientTimeout);&lt;br/&gt;
    +	private int disposeSavepoint(SavepointOptions options) throws Throwable {&lt;br/&gt;
    +		String savepointPath = Preconditions.checkNotNull(options.getSavepointPath(), &quot;Savepoint path&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object result;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Waiting for response...&quot;);&lt;/li&gt;
	&lt;li&gt;result = Await.result(response, clientTimeout);&lt;br/&gt;
    +		JobID jobId = options.getJobId();&lt;br/&gt;
    +		String jarFile = options.getJarFilePath();&lt;br/&gt;
    +&lt;br/&gt;
    +		if (jobId != null &amp;amp;&amp;amp; jarFile != null) 
{
    +			throw new IllegalArgumentException(&quot;Cannot dispose savepoint without Job ID or JAR.&quot;);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		ActorGateway jobManager = getJobManagerGateway(options);&lt;br/&gt;
    +&lt;br/&gt;
    +		final Future&amp;lt;Object&amp;gt; response;&lt;br/&gt;
    +		if (jobId != null) &lt;/p&gt;
{
    +			// Dispose with class loader of running job
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos; of job &quot; + jobId + &quot; .&quot;);
    +
    +			response = jobManager.ask(
    +					new JobManagerMessages.DisposeSavepoint(savepointPath, jobId),
    +					clientTimeout);
    +		}
&lt;p&gt; else if (jarFile != null) {&lt;br/&gt;
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +			// Dispose with uploaded user code loader&lt;br/&gt;
    +			Optimizer compiler = new Optimizer(new DataStatistics(), new DefaultCostEstimator(), config);&lt;br/&gt;
    +			PackagedProgram program = new PackagedProgram(&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we have to call `program.deleteExtractedLibraries()` at the end so that we clean up possibly extracted libraries.&lt;/p&gt;</comment>
                            <comment id="15351062" author="githubbot" created="Mon, 27 Jun 2016 14:05:27 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68581644&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68581644&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -790,39 +767,95 @@ else if (result instanceof TriggerSavepointFailure) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Sends a 
{@link org.apache.flink.runtime.messages.JobManagerMessages.DisposeSavepoint}&lt;/li&gt;
	&lt;li&gt;* message to the job manager.&lt;br/&gt;
    +	 * Asks the JobManager to dispose a savepoint.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;There are two options for this:&lt;br/&gt;
    +	 * &amp;lt;ul&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Either the job the savepoint belongs to is still running, in which&lt;br/&gt;
    +	 * case the user code class loader of the job is used.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Or the job terminated, in which case the user JARs have to be&lt;br/&gt;
    +	 * uploaded before disposing the savepoint.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ul&amp;gt;&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;private int disposeSavepoint(SavepointOptions options, String savepointPath) {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;ActorGateway jobManager = getJobManagerGateway(options);&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Disposing savepoint &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;/li&gt;
	&lt;li&gt;Future&amp;lt;Object&amp;gt; response = jobManager.ask(new DisposeSavepoint(savepointPath), clientTimeout);&lt;br/&gt;
    +	private int disposeSavepoint(SavepointOptions options) throws Throwable {&lt;br/&gt;
    +		String savepointPath = Preconditions.checkNotNull(options.getSavepointPath(), &quot;Savepoint path&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object result;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Waiting for response...&quot;);&lt;/li&gt;
	&lt;li&gt;result = Await.result(response, clientTimeout);&lt;br/&gt;
    +		JobID jobId = options.getJobId();&lt;br/&gt;
    +		String jarFile = options.getJarFilePath();&lt;br/&gt;
    +&lt;br/&gt;
    +		if (jobId != null &amp;amp;&amp;amp; jarFile != null) 
{
    +			throw new IllegalArgumentException(&quot;Cannot dispose savepoint without Job ID or JAR.&quot;);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		ActorGateway jobManager = getJobManagerGateway(options);&lt;br/&gt;
    +&lt;br/&gt;
    +		final Future&amp;lt;Object&amp;gt; response;&lt;br/&gt;
    +		if (jobId != null) &lt;/p&gt;
{
    +			// Dispose with class loader of running job
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos; of job &quot; + jobId + &quot; .&quot;);
    +
    +			response = jobManager.ask(
    +					new JobManagerMessages.DisposeSavepoint(savepointPath, jobId),
    +					clientTimeout);
    +		}
&lt;p&gt; else if (jarFile != null) {&lt;br/&gt;
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +			// Dispose with uploaded user code loader&lt;br/&gt;
    +			Optimizer compiler = new Optimizer(new DataStatistics(), new DefaultCostEstimator(), config);&lt;br/&gt;
    +			PackagedProgram program = new PackagedProgram(&lt;br/&gt;
    +					new File(jarFile),&lt;br/&gt;
    +					options.getClasspaths(),&lt;br/&gt;
    +					options.getEntryPointClass(),&lt;br/&gt;
    +					options.getProgramArgs());&lt;br/&gt;
    +			FlinkPlan flinkPlan = Client.getOptimizedPlan(compiler, program, 1);&lt;br/&gt;
    +&lt;br/&gt;
    +			JobGraph jobGraph;&lt;br/&gt;
    +			if (flinkPlan instanceof StreamingPlan) &lt;/p&gt;
{
    +				jobGraph = ((StreamingPlan) flinkPlan).getJobGraph();
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				JobGraphGenerator gen = new JobGraphGenerator(this.config);
    +				jobGraph = gen.compileJobGraph((OptimizedPlan) flinkPlan);
     			}&lt;/li&gt;
	&lt;li&gt;catch (Exception e) {&lt;/li&gt;
	&lt;li&gt;throw new Exception(&quot;Disposing the savepoint with path&quot; + savepointPath + &quot; failed.&quot;, e);&lt;br/&gt;
    +&lt;br/&gt;
    +			for (URL jar : program.getAllLibraries()) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				try {
    +					jobGraph.addJar(new Path(jar.toURI()));
    +				} catch (URISyntaxException e) {
    +					throw new RuntimeException(&quot;URL is invalid. This should not happen.&quot;, e);
    +				}     			}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +			jobGraph.setClasspaths(program.getClasspaths());&lt;br/&gt;
    +&lt;br/&gt;
    +			logAndSysout(&quot;Uploading JAR files for savepoint disposal.&quot;);&lt;br/&gt;
    +			JobClient.uploadJarFiles(jobGraph, jobManager, clientTimeout);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Maybe we could also refactor the current code so that the `JobGraph` no longer does the uploading of the jars to the blob server. Then we wouldn&apos;t have to construct a `JobGraph` at all. I also think that it shouldn&apos;t be the responsibility of the `JobGraph` to upload the user code jars but simply to store the file names.&lt;/p&gt;</comment>
                            <comment id="15351075" author="githubbot" created="Mon, 27 Jun 2016 14:11:26 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good work @uce &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    I agree that it currently it is a bit clumsy to discard savepoints of jobs which are no longer running. From the user perspective it should be as easy as possible. &lt;/p&gt;

&lt;p&gt;    I also think that it would be a good idea to add the RocksDB jar to the flink-dist.jar since all serious user are using it. Furthermore, I think it would be a good idea to not only log possible exceptions in `SubtaskState` but to communicate it back to the user. Thus, letting them bubble up and handling them on the `JobManager` level would be the right way to go.&lt;/p&gt;

&lt;p&gt;    I had some minor comments concerning test coverage and the way the job jars are constructed.&lt;/p&gt;</comment>
                            <comment id="15351157" author="githubbot" created="Mon, 27 Jun 2016 14:39:46 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68587921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68587921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/cli/CliFrontendParser.java &amp;#8212;&lt;br/&gt;
    @@ -305,6 +307,11 @@ public static void printHelpForSavepoint() {&lt;br/&gt;
     		formatter.setSyntaxPrefix(&quot;  \&quot;savepoint\&quot; action options:&quot;);&lt;br/&gt;
     		formatter.printHelp(&quot; &quot;, getSavepointOptions(new Options()));&lt;br/&gt;
     		System.out.println();&lt;br/&gt;
    +		System.out.println(&quot;\n  Examples:&quot;);&lt;br/&gt;
    +		System.out.println(&quot;  - Trigger savepoint: bin/flink savepoint &amp;lt;Job ID&amp;gt;&quot;);&lt;br/&gt;
    +		System.out.println(&quot;  - Dispose savepoint:&quot;);&lt;br/&gt;
    +		System.out.println(&quot;    * For a running job: bin/flink savepoint -d &amp;lt;Path&amp;gt; &amp;lt;Job ID&amp;gt;&quot;);&lt;br/&gt;
    +		System.out.println(&quot;    * For a terminated job: bin/flink savepoint -d &amp;lt;Path&amp;gt; -j &amp;lt;Jar&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;-c &amp;lt;mainClass&amp;gt; -C &amp;lt;classPath&amp;gt;&amp;#93;&lt;/span&gt;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    True, that&apos;s inconsistent.&lt;/p&gt;</comment>
                            <comment id="15351161" author="githubbot" created="Mon, 27 Jun 2016 14:40:35 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68588080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68588080&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/apis/cli.md &amp;#8212;&lt;br/&gt;
    @@ -279,13 +289,27 @@ guarantees for a stop request.&lt;/p&gt;

&lt;p&gt;     Action &quot;savepoint&quot; triggers savepoints for a running job or disposes existing ones.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Syntax: savepoint &lt;span class=&quot;error&quot;&gt;&amp;#91;OPTIONS&amp;#93;&lt;/span&gt; &amp;lt;Job ID&amp;gt;&lt;/li&gt;
	&lt;li&gt;&quot;savepoint&quot; action options:&lt;/li&gt;
	&lt;li&gt;&lt;del&gt;d,&lt;/del&gt;-dispose &amp;lt;savepointPath&amp;gt;   Disposes an existing savepoint.&lt;/li&gt;
	&lt;li&gt;&lt;del&gt;m,&lt;/del&gt;-jobmanager &amp;lt;host:port&amp;gt;    Address of the JobManager (master) to which
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think it should be still there but let me check again.&lt;/p&gt;</comment>
                            <comment id="15351166" author="githubbot" created="Mon, 27 Jun 2016 14:43:33 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68588625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68588625&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -790,39 +767,95 @@ else if (result instanceof TriggerSavepointFailure) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Sends a 
{@link org.apache.flink.runtime.messages.JobManagerMessages.DisposeSavepoint}&lt;/li&gt;
	&lt;li&gt;* message to the job manager.&lt;br/&gt;
    +	 * Asks the JobManager to dispose a savepoint.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;There are two options for this:&lt;br/&gt;
    +	 * &amp;lt;ul&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Either the job the savepoint belongs to is still running, in which&lt;br/&gt;
    +	 * case the user code class loader of the job is used.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Or the job terminated, in which case the user JARs have to be&lt;br/&gt;
    +	 * uploaded before disposing the savepoint.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ul&amp;gt;&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;private int disposeSavepoint(SavepointOptions options, String savepointPath) {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;ActorGateway jobManager = getJobManagerGateway(options);&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Disposing savepoint &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;/li&gt;
	&lt;li&gt;Future&amp;lt;Object&amp;gt; response = jobManager.ask(new DisposeSavepoint(savepointPath), clientTimeout);&lt;br/&gt;
    +	private int disposeSavepoint(SavepointOptions options) throws Throwable {&lt;br/&gt;
    +		String savepointPath = Preconditions.checkNotNull(options.getSavepointPath(), &quot;Savepoint path&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object result;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Waiting for response...&quot;);&lt;/li&gt;
	&lt;li&gt;result = Await.result(response, clientTimeout);&lt;br/&gt;
    +		JobID jobId = options.getJobId();&lt;br/&gt;
    +		String jarFile = options.getJarFilePath();&lt;br/&gt;
    +&lt;br/&gt;
    +		if (jobId != null &amp;amp;&amp;amp; jarFile != null) 
{
    +			throw new IllegalArgumentException(&quot;Cannot dispose savepoint without Job ID or JAR.&quot;);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		ActorGateway jobManager = getJobManagerGateway(options);&lt;br/&gt;
    +&lt;br/&gt;
    +		final Future&amp;lt;Object&amp;gt; response;&lt;br/&gt;
    +		if (jobId != null) &lt;/p&gt;
{
    +			// Dispose with class loader of running job
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos; of job &quot; + jobId + &quot; .&quot;);
    +
    +			response = jobManager.ask(
    +					new JobManagerMessages.DisposeSavepoint(savepointPath, jobId),
    +					clientTimeout);
    +		}
&lt;p&gt; else if (jarFile != null) {&lt;br/&gt;
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +			// Dispose with uploaded user code loader&lt;br/&gt;
    +			Optimizer compiler = new Optimizer(new DataStatistics(), new DefaultCostEstimator(), config);&lt;br/&gt;
    +			PackagedProgram program = new PackagedProgram(&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Oh, good catch!&lt;/p&gt;</comment>
                            <comment id="15351180" author="githubbot" created="Mon, 27 Jun 2016 14:51:02 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083#discussion_r68590084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083#discussion_r68590084&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -790,39 +767,95 @@ else if (result instanceof TriggerSavepointFailure) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Sends a 
{@link org.apache.flink.runtime.messages.JobManagerMessages.DisposeSavepoint}&lt;/li&gt;
	&lt;li&gt;* message to the job manager.&lt;br/&gt;
    +	 * Asks the JobManager to dispose a savepoint.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;There are two options for this:&lt;br/&gt;
    +	 * &amp;lt;ul&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Either the job the savepoint belongs to is still running, in which&lt;br/&gt;
    +	 * case the user code class loader of the job is used.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Or the job terminated, in which case the user JARs have to be&lt;br/&gt;
    +	 * uploaded before disposing the savepoint.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ul&amp;gt;&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;private int disposeSavepoint(SavepointOptions options, String savepointPath) {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;ActorGateway jobManager = getJobManagerGateway(options);&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Disposing savepoint &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;/li&gt;
	&lt;li&gt;Future&amp;lt;Object&amp;gt; response = jobManager.ask(new DisposeSavepoint(savepointPath), clientTimeout);&lt;br/&gt;
    +	private int disposeSavepoint(SavepointOptions options) throws Throwable {&lt;br/&gt;
    +		String savepointPath = Preconditions.checkNotNull(options.getSavepointPath(), &quot;Savepoint path&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object result;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;logAndSysout(&quot;Waiting for response...&quot;);&lt;/li&gt;
	&lt;li&gt;result = Await.result(response, clientTimeout);&lt;br/&gt;
    +		JobID jobId = options.getJobId();&lt;br/&gt;
    +		String jarFile = options.getJarFilePath();&lt;br/&gt;
    +&lt;br/&gt;
    +		if (jobId != null &amp;amp;&amp;amp; jarFile != null) 
{
    +			throw new IllegalArgumentException(&quot;Cannot dispose savepoint without Job ID or JAR.&quot;);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		ActorGateway jobManager = getJobManagerGateway(options);&lt;br/&gt;
    +&lt;br/&gt;
    +		final Future&amp;lt;Object&amp;gt; response;&lt;br/&gt;
    +		if (jobId != null) &lt;/p&gt;
{
    +			// Dispose with class loader of running job
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos; of job &quot; + jobId + &quot; .&quot;);
    +
    +			response = jobManager.ask(
    +					new JobManagerMessages.DisposeSavepoint(savepointPath, jobId),
    +					clientTimeout);
    +		}
&lt;p&gt; else if (jarFile != null) {&lt;br/&gt;
    +			logAndSysout(&quot;Disposing savepoint at &apos;&quot; + savepointPath + &quot;&apos;.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +			// Dispose with uploaded user code loader&lt;br/&gt;
    +			Optimizer compiler = new Optimizer(new DataStatistics(), new DefaultCostEstimator(), config);&lt;br/&gt;
    +			PackagedProgram program = new PackagedProgram(&lt;br/&gt;
    +					new File(jarFile),&lt;br/&gt;
    +					options.getClasspaths(),&lt;br/&gt;
    +					options.getEntryPointClass(),&lt;br/&gt;
    +					options.getProgramArgs());&lt;br/&gt;
    +			FlinkPlan flinkPlan = Client.getOptimizedPlan(compiler, program, 1);&lt;br/&gt;
    +&lt;br/&gt;
    +			JobGraph jobGraph;&lt;br/&gt;
    +			if (flinkPlan instanceof StreamingPlan) &lt;/p&gt;
{
    +				jobGraph = ((StreamingPlan) flinkPlan).getJobGraph();
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				JobGraphGenerator gen = new JobGraphGenerator(this.config);
    +				jobGraph = gen.compileJobGraph((OptimizedPlan) flinkPlan);
     			}&lt;/li&gt;
	&lt;li&gt;catch (Exception e) {&lt;/li&gt;
	&lt;li&gt;throw new Exception(&quot;Disposing the savepoint with path&quot; + savepointPath + &quot; failed.&quot;, e);&lt;br/&gt;
    +&lt;br/&gt;
    +			for (URL jar : program.getAllLibraries()) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				try {
    +					jobGraph.addJar(new Path(jar.toURI()));
    +				} catch (URISyntaxException e) {
    +					throw new RuntimeException(&quot;URL is invalid. This should not happen.&quot;, e);
    +				}     			}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +			jobGraph.setClasspaths(program.getClasspaths());&lt;br/&gt;
    +&lt;br/&gt;
    +			logAndSysout(&quot;Uploading JAR files for savepoint disposal.&quot;);&lt;br/&gt;
    +			JobClient.uploadJarFiles(jobGraph, jobManager, clientTimeout);&lt;br/&gt;
    +&lt;br/&gt;
    +			response = jobManager.ask(&lt;br/&gt;
    +					new JobManagerMessages.DisposeSavepointWithClassLoader(&lt;br/&gt;
    +							savepointPath,&lt;br/&gt;
    +							jobGraph.getUserJarBlobKeys(),&lt;br/&gt;
    +							jobGraph.getClasspaths()),&lt;br/&gt;
    +					clientTimeout);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Let me check if it is sufficient, but the `PackagedProgram.extractContainedLibaries` calls looks good. &lt;/p&gt;</comment>
                            <comment id="15351186" author="githubbot" created="Mon, 27 Jun 2016 14:53:59 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for review. I will propagate the errors, make the job ID/JAR arguments optional, and try to simplify parts of the CLI as you suggested.&lt;/p&gt;

&lt;p&gt;    Regarding including the RocksDB jar in dist, I think that should be handled as a separate issue.&lt;/p&gt;</comment>
                            <comment id="15364246" author="githubbot" created="Wed, 6 Jul 2016 12:40:47 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve addressed the comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Moved the JAR uploading to a helper:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        ```java&lt;br/&gt;
    // Retrieve blob server address and upload JARs to server&lt;br/&gt;
    uploadJarFiles(ActorGateway, FiniteDuration, List&amp;lt;Path&amp;gt;);&lt;br/&gt;
    // Upload JARs to server &lt;br/&gt;
    uploadJarFiles(InetSocketAddress, List&amp;lt;Path&amp;gt;);&lt;br/&gt;
        ```&lt;br/&gt;
        I did not remove the `JobGraph` upload JARs method, but it now calls these helpers. I decided against removing it, because it&apos;s called in multiple places with the same pattern (upload, get BLOB keys, set BLOB keys).&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I extract the libraries as you suggested (no need for the job graph now)&lt;/li&gt;
	&lt;li&gt;Removed the job ID variant as it was overloading disposal too much and just stuck to the JAR variant, which is now optional (no script API break)&lt;/li&gt;
	&lt;li&gt;State disposal errors are now propagated and the a failed disposal with `ClassNotFoundException` gives a hint to provide the JAR file&lt;/li&gt;
	&lt;li&gt;I&apos;ve added an automated test with custom KV state in `ClassLoaderITCase`&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="15372973" author="githubbot" created="Tue, 12 Jul 2016 14:38:16 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If there are no objections, I would like to merge this.&lt;/p&gt;</comment>
                            <comment id="15382417" author="uce" created="Mon, 18 Jul 2016 15:06:05 +0000"  >&lt;p&gt;Fixed in b67e508 (master).&lt;/p&gt;</comment>
                            <comment id="15382418" author="githubbot" created="Mon, 18 Jul 2016 15:06:28 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2083&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vrxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>