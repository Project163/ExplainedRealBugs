<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9923] OneInputStreamTaskTest.testWatermarkMetrics fails on Travis</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9923</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;OneInputStreamTaskTest.testWatermarkMetrics&lt;/tt&gt; fails on Travis with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;-9223372036854775808&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:834)
	at org.junit.Assert.assertEquals(Assert.java:645)
	at org.junit.Assert.assertEquals(Assert.java:631)
	at org.apache.flink.streaming.runtime.tasks.OneInputStreamTaskTest.testWatermarkMetrics(OneInputStreamTaskTest.java:731)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://api.travis-ci.org/v3/job/407196285/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/407196285/log.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13173910">FLINK-9923</key>
            <summary>OneInputStreamTaskTest.testWatermarkMetrics fails on Travis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 23 Jul 2018 20:09:16 +0000</created>
                <updated>Tue, 31 Jul 2018 11:48:04 +0000</updated>
                            <resolved>Tue, 31 Jul 2018 11:48:04 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16553358" author="till.rohrmann" created="Mon, 23 Jul 2018 20:23:17 +0000"  >&lt;p&gt;I think the problem is that &lt;tt&gt;WatermarkGauge&apos;s&lt;/tt&gt; &lt;tt&gt;currentWatermark&lt;/tt&gt; field is not volatile but can be accessed by multiple threads.&lt;/p&gt;</comment>
                            <comment id="16553365" author="githubbot" created="Mon, 23 Jul 2018 20:27:57 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9923&quot; title=&quot;OneInputStreamTaskTest.testWatermarkMetrics fails on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9923&quot;&gt;&lt;del&gt;FLINK-9923&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden OneInputStreamTaskTest#testWatermarkMetrics&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Convert the WatermarkGauge&apos;s field currentWatermark from long to AtomicLong because&lt;br/&gt;
    writes and reads can happen from different threads. Unfortunately, we cannot simply&lt;br/&gt;
    make it volatile because not all JVM support atomic writes to longs.&lt;/p&gt;

&lt;p&gt;    cc @zentol.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixOneInpuStreamTaskTest&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6398&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d46dd6f2ddf76d5dfcb1bed983f31542ddc771a3&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-07-23T20:25:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9923&quot; title=&quot;OneInputStreamTaskTest.testWatermarkMetrics fails on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9923&quot;&gt;&lt;del&gt;FLINK-9923&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden OneInputStreamTaskTest#testWatermarkMetrics&lt;/p&gt;

&lt;p&gt;    Convert the WatermarkGauge&apos;s field currentWatermark from long to AtomicLong because&lt;br/&gt;
    writes and reads can happen from different threads. Unfortunately, we cannot simply&lt;br/&gt;
    make it volatile because not all JVM support atomic writes to longs.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16553393" author="githubbot" created="Mon, 23 Jul 2018 20:51:09 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Do you have a source for volatile longs not being supported in all JVM implementations? I&apos;m asking since the (expected) behavior is defined in the &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Language Specification&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.7&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="16553877" author="githubbot" created="Tue, 24 Jul 2018 06:39:45 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I got this from an IntelliJ inspection warning which says&lt;br/&gt;
    &amp;gt;Reports fields of type long or double which are declared as volatile. While Java specifies that reads and writes from such fields are atomic, many JVM&apos;s have violated this specification. Unless you are certain of your JVM, it is better to synchronized access to such fields rather than declare them volatile.&lt;/p&gt;

</comment>
                            <comment id="16553927" author="githubbot" created="Tue, 24 Jul 2018 07:46:51 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    well, that&apos;s a fairly general statement isn&apos;t it :/ &lt;/p&gt;

&lt;p&gt;    Unless we find any mention anywhere of a major JVM not adhering to the JLS in this regard, that is suited for Flink applications, I would go with a volatile long.&lt;/p&gt;

&lt;p&gt;    Personally i never follow inspections at face value; we don&apos;t know how up-to-date this inspections or what information it is based on, which JVMs it applies to as it doesn&apos;t mention even a single example, and as with all JVM-/environment-specific inspections the applicability is questionable.&lt;/p&gt;</comment>
                            <comment id="16553957" author="githubbot" created="Tue, 24 Jul 2018 08:27:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Given that the `WatermarkGauge` is not super critical, I&apos;m ok with changing it to a `volatile long`. If the `OneInputStreamTask` should fail again with a similar problem, then we know that the used JVM is affected. I&apos;ll update the PR accordingly.&lt;/p&gt;</comment>
                            <comment id="16554265" author="githubbot" created="Tue, 24 Jul 2018 13:57:20 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @zentol. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="16554266" author="till.rohrmann" created="Tue, 24 Jul 2018 13:59:10 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master: 3f223266826454ffe1ba615c2f9c24ef8073e143&lt;br/&gt;
1.6.0: d180d599a94456ef286c74dd97425b5495a69a3f&lt;/p&gt;</comment>
                            <comment id="16554267" author="githubbot" created="Tue, 24 Jul 2018 13:59:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6398&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16563524" author="zentol" created="Tue, 31 Jul 2018 11:46:59 +0000"  >&lt;p&gt;the fix should also be merged to the 1.5 branch&lt;/p&gt;</comment>
                            <comment id="16563525" author="zentol" created="Tue, 31 Jul 2018 11:48:04 +0000"  >&lt;p&gt;1.5: 9f1f0a87bddead122f0aabdc266f44efb7ed6fc4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13175812">FLINK-10004</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13173909">FLINK-9922</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w6x3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>