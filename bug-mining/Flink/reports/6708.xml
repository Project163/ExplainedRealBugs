<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:14:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-28474] ChannelStateWriteResult may not fail after checkpoint abort</title>
                <link>https://issues.apache.org/jira/browse/FLINK-28474</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;After Checkpoint abort, ChannelStateWriteResult should fail.&lt;/p&gt;

&lt;p&gt;But if &lt;em&gt;channelStateWriter.start(id, checkpointOptions);&lt;/em&gt; is executed after Checkpoint abort, ChannelStateWriteResult will not fail.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;CauseAnalysis%3A&quot;&gt;&lt;/a&gt;Cause Analysis:&lt;/h2&gt;

&lt;p&gt;When abort checkpoint, channelStateWriter.start(id, checkpointOptions); may not be executed yet. These checkpointIds will be stored in the abortedCheckpointIds of SubtaskCheckpointCoordinatorImpl, and when checkpointState is called, it will check if the checkpointId should be aborted.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;ChannelStateWriter.abort(checkpointId, exception, true) should also be executed here.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The unit test can reproduce this bug.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13046501/13046501_image-2022-07-09-22-21-24-417.png&quot; height=&quot;307&quot; width=&quot;803&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Note: channelStateWriter.abort is only called in notifyCheckpointAborted, it doesn&apos;t account for channelStateWriter.start after notifyCheckpointAborted.&lt;/p&gt;

&lt;p&gt;JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17869&quot; title=&quot;Fix the race condition of aborting unaligned checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17869&quot;&gt;&lt;del&gt;FLINK-17869&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;commit: &lt;a href=&quot;https://github.com/apache/flink/pull/12478/commits/22c99845ef4f863f1753d17b109fd2faecc8201e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/12478/commits/22c99845ef4f863f1753d17b109fd2faecc8201e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The bug will affect the new feature &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26803&quot; title=&quot;Merge small ChannelState file for Unaligned Checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26803&quot;&gt;&lt;del&gt;FLINK-26803&lt;/del&gt;&lt;/a&gt;, because the channel state file can be closed only after the Checkpoints of all tasks of the shared file are complete or abort. So when the checkpoint of some tasks fails, if abort is not called, the file cannot be closed and all tasks sharing the file cannot execute inputChannelStateHandles.completeExceptionally(e); and resultSubpartitionStateHandles.completeExceptionally(e); , AsyncCheckpointRunnable will wait forever.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13470809">FLINK-28474</key>
            <summary>ChannelStateWriteResult may not fail after checkpoint abort</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fanrui">Rui Fan</assignee>
                                    <reporter username="fanrui">Rui Fan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 9 Jul 2022 14:23:41 +0000</created>
                <updated>Fri, 7 Oct 2022 08:39:01 +0000</updated>
                            <resolved>Fri, 7 Oct 2022 07:02:28 +0000</resolved>
                                    <version>1.14.5</version>
                    <version>1.15.1</version>
                                    <fixVersion>1.17.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17564809" author="fanrui" created="Mon, 11 Jul 2022 07:01:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; , I have submitted this PR, could you help take a look in your free time ? This bug sometimes cause the CI of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26803&quot; title=&quot;Merge small ChannelState file for Unaligned Checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26803&quot;&gt;&lt;del&gt;FLINK-26803&lt;/del&gt;&lt;/a&gt; failed.&lt;/p&gt;</comment>
                            <comment id="17613907" author="pnowojski" created="Fri, 7 Oct 2022 07:02:28 +0000"  >&lt;p&gt;Merged to master as a6119121164^..a6119121164&lt;/p&gt;

&lt;p&gt;Thanks for the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanrui&quot; class=&quot;user-hover&quot; rel=&quot;fanrui&quot;&gt;fanrui&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think there is no need to back port it to the previous releases, as this bug doesn&apos;t cause any symptoms without &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26803&quot; title=&quot;Merge small ChannelState file for Unaligned Checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26803&quot;&gt;&lt;del&gt;FLINK-26803&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17613959" author="fanrui" created="Fri, 7 Oct 2022 08:39:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;&#160; thanks for your help and review~&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13435098">FLINK-26803</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13046501" name="image-2022-07-09-22-21-24-417.png" size="156878" author="fanrui" created="Sat, 9 Jul 2022 14:21:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16qbk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>