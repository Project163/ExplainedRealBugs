<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-27848] ZooKeeperLeaderElectionDriver keeps writing leader information, using up zxid</title>
                <link>https://issues.apache.org/jira/browse/FLINK-27848</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;After a leadership change, the new leader may keeps writing its information (which is identical) to ZK, causing the zxid on ZK quickly used up.&lt;/p&gt;

&lt;p&gt;The problem is that, in &lt;tt&gt;ZooKeeperLeaderElectionDriver#retrieveLeaderInformationFromZooKeeper&lt;/tt&gt;, &lt;tt&gt;leaderElectionEventHandler.onLeaderInformationChange(LeaderInformation.empty())&lt;/tt&gt; is called no matter &lt;tt&gt;childData&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt; or not. In case of non-null, this will cause the driver keeps re-writing the leader information to ZK.&lt;/p&gt;

&lt;p&gt;The problem was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-24038&quot; title=&quot;DispatcherResourceManagerComponent fails to deregister application if no leading ResourceManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-24038&quot;&gt;&lt;del&gt;FLINK-24038&lt;/del&gt;&lt;/a&gt;, and only affects the legacy &lt;tt&gt;ZooKeeperHaServices&lt;/tt&gt;. Thus, only 1.15 are affected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13447626">FLINK-27848</key>
            <summary>ZooKeeperLeaderElectionDriver keeps writing leader information, using up zxid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mapohl">Matthias Pohl</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 31 May 2022 06:46:31 +0000</created>
                <updated>Fri, 3 Feb 2023 08:29:01 +0000</updated>
                            <resolved>Fri, 3 Feb 2023 08:29:00 +0000</resolved>
                                    <version>1.15.0</version>
                    <version>1.17.0</version>
                    <version>1.16.1</version>
                                    <fixVersion>1.15.1</fixVersion>
                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.16.2</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17544668" author="reswqa" created="Wed, 1 Jun 2022 02:23:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xtsong&quot; class=&quot;user-hover&quot; rel=&quot;xtsong&quot;&gt;xtsong&lt;/a&gt; , I have prepared a pull request for this ticket, can you help to review it?&lt;/p&gt;</comment>
                            <comment id="17545248" author="xintongsong" created="Thu, 2 Jun 2022 03:00:59 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;release-1.15: 73a33ab5f25dd5ac7e8adb1521c092a8aedcc736&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17683099" author="mapohl" created="Wed, 1 Feb 2023 17:04:08 +0000"  >&lt;p&gt;I&apos;m reopening this issue to provide forward(?)ports for 1.16 and 1.17.&lt;/p&gt;

&lt;p&gt;Refactoring the leader election for FLIP-285/&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26522&quot; title=&quot;FLIP-285: Refactoring code for multiple component leader election&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26522&quot;&gt;&lt;del&gt;FLINK-26522&lt;/del&gt;&lt;/a&gt; is kind of tricky. I&apos;m trying to slice the code changes into meaningful commits (and ideally dedicated PRs) to make the review process easier.&lt;/p&gt;

&lt;p&gt;I ran into this issue when refactoring the code and merging classes into one which also required adapting tests. This revealed the inconsistency/bug in the ZooKeeperLeaderElectionDriver implementation. Merging the bugfixes into 1.17 and 1.16 makes the other changes more reasonable/consistent.&lt;/p&gt;

&lt;p&gt;More specifically, this bug was revealed in &lt;tt&gt;ZooKeeperLeaderElectionTest.testLeaderShouldBeCorrectedWhenOverwritten&lt;/tt&gt; when changing from the deprecated &lt;tt&gt;NodeCache&lt;/tt&gt; to &lt;tt&gt;CuratorCache&lt;/tt&gt;. The new &lt;tt&gt;CuratorCacheListener&lt;/tt&gt; allows to be more selective on whether we expect a node creation or change which causes a test failure. The previous test implementation worked because we sent the 2nd write operation after writing the leaderinformation which caused a node-change event and, after all, made the test pass.&lt;/p&gt;</comment>
                            <comment id="17683743" author="mapohl" created="Fri, 3 Feb 2023 08:29:01 +0000"  >&lt;p&gt;master: d76214de330fea485f2971b51c172420dfdf500b&lt;br/&gt;
1.16: 5441cef7b0310965822f4bca0f12bf63790c4d69&lt;br/&gt;
1.15: 73a33ab5f25dd5ac7e8adb1521c092a8aedcc736 (copied over from Xintong&apos;s comment above)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z12tgw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>