<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:18:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-1604] Livelock in PartitionRequestClientFactory</title>
                <link>https://issues.apache.org/jira/browse/FLINK-1604</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In case of a job restart, we observed a livelock in &lt;tt&gt;PartitionRequestClientFactory.createPartitionRequestClient&lt;/tt&gt;. We suspect that this might have the following reason:&lt;/p&gt;

&lt;p&gt;In order to obtain a new &lt;tt&gt;PartitionRequestClient&lt;/tt&gt; a new &lt;tt&gt;ConnectingChannel&lt;/tt&gt; is created. This channel acts as a future for the client. The channel is inserted into a &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt; so that other &lt;tt&gt;Threads&lt;/tt&gt; trying to create a client for the same address wait on the future. Once the client is obtained by the initially requesting &lt;tt&gt;Thread&lt;/tt&gt;, it is inserted into the &lt;tt&gt;HashMap&lt;/tt&gt; instead of the &lt;tt&gt;ConnectionChannel&lt;/tt&gt;. When the client is disposed, then it will be removed from the &lt;tt&gt;HashMap&lt;/tt&gt;, but only if the client is still stored in the map. &lt;/p&gt;

&lt;p&gt;And here is where things can go wrong. If the requesting thread is interrupted after it created the &lt;tt&gt;ConnectingChannel&lt;/tt&gt; and inserted it into the &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt; but before inserting the &lt;tt&gt;PartitionRequestClient&lt;/tt&gt; into the same map, then a the map entry for a given &lt;tt&gt;RemoteAddress&lt;/tt&gt; is the &lt;tt&gt;ConnectingChannel&lt;/tt&gt;. Assume now that another thread waited at this channel and eventually obtained the client from this future. In the wake of cancelling the job, the client would be disposed by the corresponding &lt;tt&gt;RemoteInputChannel&lt;/tt&gt;. Once the job has been restarted, new threads want to connect to the &lt;tt&gt;RemoteAddress&lt;/tt&gt; and they find the &lt;tt&gt;ConnectingChannel&lt;/tt&gt; with the disposed &lt;tt&gt;PartitionRequestClient&lt;/tt&gt; as future result in the hash map. They retrieve the channel and see that the client has already been disposed. Now they try to delete the client from the &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt; to make room for a new one. However, this deletion fails, because the map still contains the &lt;tt&gt;ConnectingChannel&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;To make a long story short, we believe that the network state is not left in a valid state after cancelling a job.&lt;/p&gt;

&lt;p&gt;That is currently our best theory for the livelock we observed on Travis.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12777143">FLINK-1604</key>
            <summary>Livelock in PartitionRequestClientFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Feb 2015 09:46:47 +0000</created>
                <updated>Wed, 25 Feb 2015 10:17:25 +0000</updated>
                            <resolved>Wed, 25 Feb 2015 10:17:25 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14336324" author="uce" created="Wed, 25 Feb 2015 10:17:25 +0000"  >&lt;p&gt;Fixed in 859a839 and 2f1987a.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25yvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>