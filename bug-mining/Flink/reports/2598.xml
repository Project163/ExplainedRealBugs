<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10116] createComparator fails on case class with Unit type fields prior to the join-key</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10116</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Overview&quot;&gt;&lt;/a&gt;Overview&lt;/h1&gt;

&lt;p&gt;When joining between case classes, if the&#160;attribute representing the join-key comes after Unit definition of fields (that are not being used) the join will fail with the error&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Could not add a comparator for the logicalkey field index 0.&lt;/tt&gt;&lt;br/&gt;
 {{ at org.apache.flink.api.common.typeutils.CompositeType.createComparator(CompositeType.java:162)}}&lt;br/&gt;
 {{ at org.apache.flink.optimizer.postpass.JavaApiPostPass.createComparator(JavaApiPostPass.java:293)}}&lt;br/&gt;
 {{ at org.apache.flink.optimizer.postpass.JavaApiPostPass.traverse(JavaApiPostPass.java:193)}}&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Using TypeInformation keys does not exhibit the same issue. Initial debugging suggests that when calculating&#160;the index of the key for strings, Flink doesn&apos;t count Unit elements, however they are included during iteration in CompositeType.createComparator which leads to the search failing on the key appearing to be a Unit type.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Code%C2%A0ExamplestoReproduce&quot;&gt;&lt;/a&gt;Code&#160;Examples to Reproduce&lt;/h1&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12935014/12935014_JobFail.scala&quot; title=&quot;JobFail.scala attached to FLINK-10116&quot;&gt;JobFail.scala&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12935015/12935015_JobPass.scala&quot; title=&quot;JobPass.scala attached to FLINK-10116&quot;&gt;JobPass.scala&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;InlineCode&quot;&gt;&lt;/a&gt;&lt;sup&gt;Inline Code&lt;/sup&gt;&lt;/h1&gt;
&lt;h2&gt;&lt;a name=&quot;Fail&quot;&gt;&lt;/a&gt;&lt;sup&gt;Fail&lt;/sup&gt;&lt;/h2&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.demo

/**
  * Licensed to the Apache Software Foundation (ASF) under one
  * or more contributor license agreements.  See the NOTICE file
  * distributed with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; work &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; additional information
  * regarding copyright ownership.  The ASF licenses &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file
  * to you under the Apache License, Version 2.0 (the
  * &lt;span class=&quot;code-quote&quot;&gt;&quot;License&quot;&lt;/span&gt;); you may not use &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file except in compliance
  * with the License.  You may obtain a copy of the License at
  *
  *     http:&lt;span class=&quot;code-comment&quot;&gt;//www.apache.org/licenses/LICENSE-2.0
&lt;/span&gt;  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an &lt;span class=&quot;code-quote&quot;&gt;&quot;AS IS&quot;&lt;/span&gt; BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the specific language governing permissions and
  * limitations under the License.
  */

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.common.functions.RichJoinFunction
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.java.DataSet
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.scala._


object JobFail {

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LeftJoin (
                        FieldA: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                        FieldB: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                        FieldC: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                        JoinIndex: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;
                      )

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RightJoin (
                         FieldD: Unit = Unit,
                         FieldE: Unit = Unit,
                         FieldF: Unit = Unit,
                         JoinIndex: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;
                       )

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Merged (
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldA: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldB: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldC: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldD: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldE: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldF: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; JoinIndex: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;
                    )

  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JoinHelper() &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RichJoinFunction[LeftJoin, RightJoin, Merged]{
    override def join(first: LeftJoin, second: RightJoin): Merged = {
      val out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Merged()
      out.FieldA = first.FieldA
      out.FieldB = first.FieldB
      out.FieldC = first.FieldC
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (second != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
        /*out.FieldD = second.FieldD
        out.FieldE = second.FieldE
        out.FieldF = second.FieldF*/
      }

      out
    }
  }

  def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]) {
    &lt;span class=&quot;code-comment&quot;&gt;// set up the execution environment
&lt;/span&gt;    val env = ExecutionEnvironment.getExecutionEnvironment
    val leftOne = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LeftJoin(&lt;span class=&quot;code-quote&quot;&gt;&quot;FieldA1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldB1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldC1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;)
    val rightOne = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RightJoin(&lt;span class=&quot;code-quote&quot;&gt;&quot;FieldD1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldE1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldF1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;)

    val left = env.fromElements(leftOne)
    val right = env.fromElements(rightOne)

    &lt;span class=&quot;code-comment&quot;&gt;// TODO: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key fails
&lt;/span&gt;    val joined = left.leftOuterJoin(right).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;JoinIndex&quot;&lt;/span&gt;).equalTo(&lt;span class=&quot;code-quote&quot;&gt;&quot;JoinIndex&quot;&lt;/span&gt;).apply(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JoinHelper())
    joined.print()


  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;&lt;a name=&quot;Pass&quot;&gt;&lt;/a&gt;&lt;sup&gt;Pass&lt;/sup&gt;&lt;/h2&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.demo

/**
  * Licensed to the Apache Software Foundation (ASF) under one
  * or more contributor license agreements.  See the NOTICE file
  * distributed with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; work &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; additional information
  * regarding copyright ownership.  The ASF licenses &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file
  * to you under the Apache License, Version 2.0 (the
  * &lt;span class=&quot;code-quote&quot;&gt;&quot;License&quot;&lt;/span&gt;); you may not use &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file except in compliance
  * with the License.  You may obtain a copy of the License at
  *
  *     http:&lt;span class=&quot;code-comment&quot;&gt;//www.apache.org/licenses/LICENSE-2.0
&lt;/span&gt;  *
  * Unless required by applicable law or agreed to in writing, software
  * distributed under the License is distributed on an &lt;span class=&quot;code-quote&quot;&gt;&quot;AS IS&quot;&lt;/span&gt; BASIS,
  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  * See the License &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the specific language governing permissions and
  * limitations under the License.
  */

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.common.functions.RichJoinFunction
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.java.DataSet
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.api.scala._

object JobPass {

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LeftJoin (
                        FieldA: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                        FieldB: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                        FieldC: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                        JoinIndex: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;
                      )

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RightJoin (
                         FieldD: Unit = Unit,
                         FieldE: Unit = Unit,
                         FieldF: Unit = Unit,
                         JoinIndex: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;
                       )

  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Merged (
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldA: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldB: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldC: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldD: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldE: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; FieldF: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;,
                      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; JoinIndex: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = &quot;&quot;
                    )

  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JoinHelper() &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RichJoinFunction[LeftJoin, RightJoin, Merged]{
    override def join(first: LeftJoin, second: RightJoin): Merged = {
      val out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Merged()
      out.FieldA = first.FieldA
      out.FieldB = first.FieldB
      out.FieldC = first.FieldC
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (second != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
        /*out.FieldD = second.FieldD
        out.FieldE = second.FieldE
        out.FieldF = second.FieldF*/
      }

      out
    }
  }

  def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]) {
    &lt;span class=&quot;code-comment&quot;&gt;// set up the execution environment
&lt;/span&gt;    val env = ExecutionEnvironment.getExecutionEnvironment
    val leftOne = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LeftJoin(&lt;span class=&quot;code-quote&quot;&gt;&quot;FieldA1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldB1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldC1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;)
    val rightOne = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RightJoin(&lt;span class=&quot;code-quote&quot;&gt;&quot;FieldD1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldE1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FieldF1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;index&quot;&lt;/span&gt;)

    val left = env.fromElements(leftOne)
    val right = env.fromElements(rightOne)

    &lt;span class=&quot;code-comment&quot;&gt;// TODO: TypeInformation key passes
&lt;/span&gt;    val joined = left.leftOuterJoin(right).where(_.JoinIndex).equalTo(_.JoinIndex).apply(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JoinHelper())
    joined.print()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13178082">FLINK-10116</key>
            <summary>createComparator fails on case class with Unit type fields prior to the join-key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fhueske">Fabian Hueske</assignee>
                                    <reporter username="WillB">Will</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 9 Aug 2018 17:48:37 +0000</created>
                <updated>Thu, 16 Aug 2018 20:58:27 +0000</updated>
                            <resolved>Thu, 16 Aug 2018 20:58:27 +0000</resolved>
                                    <version>1.3.3</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.4.3</fixVersion>
                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>API / DataSet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16576080" author="fhueske" created="Fri, 10 Aug 2018 10:34:02 +0000"  >&lt;p&gt;Hi Will,&lt;/p&gt;

&lt;p&gt;Thanks for reporting the problem. I could reproduce it with a simpler program&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyCC(a: Unit, b: Unit, c: String)

&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; cc = MyCC(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; set = env.fromElements(cc)
set.groupBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;).first(1).print()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Your analysis is correct. This is a problem with the key extraction from case class types and seems to be located in &lt;tt&gt;CaseClassTypeInfo.getFlatFields()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16576166" author="fhueske" created="Fri, 10 Aug 2018 11:55:25 +0000"  >&lt;p&gt;OK, I found the issue. &lt;br/&gt;
The problem is that&#160;&lt;tt&gt;UnitTypeInformation.getTotalFields()&lt;/tt&gt; returns 0 instead of 1.&lt;/p&gt;</comment>
                            <comment id="16582705" author="githubbot" created="Thu, 16 Aug 2018 15:32:52 +0000"  >&lt;p&gt;fhueske opened a new pull request #6569: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10116&quot; title=&quot;createComparator fails on case class with Unit type fields prior to the join-key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10116&quot;&gt;&lt;del&gt;FLINK-10116&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;types&amp;#93;&lt;/span&gt; Fix getTotalFields() implementation of multiple TypeInformation.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6569&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Fixes the implementation of `TypeInformation.getTotalFields()` of several type informations. The method is used to determine the number of flattened fields to skip when determining key positions. Since a type info needs to be skipped even if it does not have nested fields, the method must return at least `1`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;fixed all incorrect `TypeInformation` implementations&lt;/li&gt;
	&lt;li&gt;extended the JavaDoc of `TypeInformation.getTotalFields()`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;added a new method to `TypeInformationTestBase` validating that the number of fields is at least 1.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;yes&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? n/a&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582748" author="githubbot" created="Thu, 16 Aug 2018 16:04:59 +0000"  >&lt;p&gt;StefanRRichter commented on issue #6569: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10116&quot; title=&quot;createComparator fails on case class with Unit type fields prior to the join-key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10116&quot;&gt;&lt;del&gt;FLINK-10116&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;types&amp;#93;&lt;/span&gt; Fix getTotalFields() implementation of multiple TypeInformation.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6569#issuecomment-413598085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6569#issuecomment-413598085&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   LGTM &#128077; &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16583044" author="githubbot" created="Thu, 16 Aug 2018 20:46:06 +0000"  >&lt;p&gt;fhueske commented on issue #6569: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10116&quot; title=&quot;createComparator fails on case class with Unit type fields prior to the join-key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10116&quot;&gt;&lt;del&gt;FLINK-10116&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;types&amp;#93;&lt;/span&gt; Fix getTotalFields() implementation of multiple TypeInformation.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6569#issuecomment-413679199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6569#issuecomment-413679199&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the review @StefanRRichter.&lt;/p&gt;

&lt;p&gt;   Merging&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16583048" author="githubbot" created="Thu, 16 Aug 2018 20:48:15 +0000"  >&lt;p&gt;asfgit closed pull request #6569: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10116&quot; title=&quot;createComparator fails on case class with Unit type fields prior to the join-key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10116&quot;&gt;&lt;del&gt;FLINK-10116&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;types&amp;#93;&lt;/span&gt; Fix getTotalFields() implementation of multiple TypeInformation.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6569&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/NothingTypeInfo.java b/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/NothingTypeInfo.java&lt;br/&gt;
index 73b916fe948..307dfa0941b 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/NothingTypeInfo.java&lt;br/&gt;
+++ b/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/NothingTypeInfo.java&lt;br/&gt;
@@ -53,7 +53,7 @@ public int getArity() {&lt;br/&gt;
 	@Override&lt;br/&gt;
 	@PublicEvolving&lt;br/&gt;
 	public int getTotalFields() &lt;/p&gt;
{
-		return 0;
+		return 1;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	@Override&lt;br/&gt;
diff --git a/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/TypeInformation.java b/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/TypeInformation.java&lt;br/&gt;
index c5c077fc2ca..e04a494675c 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/TypeInformation.java&lt;br/&gt;
+++ b/flink-core/src/main/java/org/apache/flink/api/common/typeinfo/TypeInformation.java&lt;br/&gt;
@@ -111,6 +111,7 @@&lt;br/&gt;
 	 * fields, in the case of composite types. In the example below, the OuterType type has three&lt;br/&gt;
 	 * fields in total.&lt;br/&gt;
 	 *&lt;br/&gt;
+	 * &amp;lt;p&amp;gt;The total number of fields must be at least 1.&lt;br/&gt;
 	 *&lt;br/&gt;
 	 * @return The number of fields in this type, including its sub-fields (for composite types)&lt;br/&gt;
 	 */&lt;br/&gt;
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeInformationTestBase.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeInformationTestBase.java&lt;br/&gt;
index bd35070a0d5..164fc9518e6 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeInformationTestBase.java&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeInformationTestBase.java&lt;br/&gt;
@@ -95,6 +95,16 @@ public void testSerialization() {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testGetTotalFields() {&lt;br/&gt;
+		final T[] testData = getTestData();&lt;br/&gt;
+		for (T typeInfo : testData) {
+			assertTrue(
+				&quot;Number of total fields must be at least 1&quot;,
+				typeInfo.getTotalFields() &amp;gt; 0);
+		}&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
 	private static class UnrelatedTypeInfo extends TypeInformation&amp;lt;Object&amp;gt; {&lt;br/&gt;
 &lt;br/&gt;
 		@Override&lt;br/&gt;
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/MissingTypeInfoTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/MissingTypeInfoTest.java&lt;br/&gt;
index cccc14df513..93ae552af2d 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/MissingTypeInfoTest.java&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/MissingTypeInfoTest.java&lt;br/&gt;
@@ -41,4 +41,9 @@&lt;br/&gt;
 	public void testSerialization() {
 		// this class is not intended to be serialized
 	}&lt;br/&gt;
+&lt;br/&gt;
+	@Override&lt;br/&gt;
+	public void testGetTotalFields() {
+		// getTotalFields is not meant to be called
+	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/TypeInfoFactoryTest.java b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/TypeInfoFactoryTest.java&lt;br/&gt;
index f0558790037..bae4d6c48d2 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/test/java/org/apache/flink/api/java/typeutils/TypeInfoFactoryTest.java&lt;br/&gt;
+++ b/flink-core/src/test/java/org/apache/flink/api/java/typeutils/TypeInfoFactoryTest.java&lt;br/&gt;
@@ -387,7 +387,7 @@ public int getArity() {&lt;br/&gt;
 &lt;br/&gt;
 		@Override&lt;br/&gt;
 		public int getTotalFields() {
-			return 0;
+			return 1;
 		}&lt;br/&gt;
 &lt;br/&gt;
 		@Override&lt;br/&gt;
diff --git a/flink-queryable-state/flink-queryable-state-client-java/src/main/java/org/apache/flink/queryablestate/client/VoidNamespaceTypeInfo.java b/flink-queryable-state/flink-queryable-state-client-java/src/main/java/org/apache/flink/queryablestate/client/VoidNamespaceTypeInfo.java&lt;br/&gt;
index 2efb87bd667..f5a5c01b273 100644&lt;br/&gt;
&amp;#8212; a/flink-queryable-state/flink-queryable-state-client-java/src/main/java/org/apache/flink/queryablestate/client/VoidNamespaceTypeInfo.java&lt;br/&gt;
+++ b/flink-queryable-state/flink-queryable-state-client-java/src/main/java/org/apache/flink/queryablestate/client/VoidNamespaceTypeInfo.java&lt;br/&gt;
@@ -52,7 +52,7 @@ public int getArity() {&lt;br/&gt;
 &lt;br/&gt;
 	@Override&lt;br/&gt;
 	public int getTotalFields() {-		return 0;+		return 1; 	}

&lt;p&gt; 	@Override&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/state/VoidNamespaceTypeInfo.java b/flink-runtime/src/main/java/org/apache/flink/runtime/state/VoidNamespaceTypeInfo.java&lt;br/&gt;
index 9917410a51b..4bae5e4c1ae 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/state/VoidNamespaceTypeInfo.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/state/VoidNamespaceTypeInfo.java&lt;br/&gt;
@@ -55,7 +55,7 @@ public int getArity() {&lt;br/&gt;
 	@Override&lt;br/&gt;
 	@PublicEvolving&lt;br/&gt;
 	public int getTotalFields() &lt;/p&gt;
{
-		return 0;
+		return 1;
 	}

&lt;p&gt; 	@Override&lt;br/&gt;
diff --git a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/ScalaNothingTypeInfo.scala b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/ScalaNothingTypeInfo.scala&lt;br/&gt;
index bc2aabfffc2..bc5a4ebe318 100644&lt;br/&gt;
&amp;#8212; a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/ScalaNothingTypeInfo.scala&lt;br/&gt;
+++ b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/ScalaNothingTypeInfo.scala&lt;br/&gt;
@@ -32,7 +32,7 @@ class ScalaNothingTypeInfo extends TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;Nothing&amp;#93;&lt;/span&gt; {&lt;br/&gt;
   @PublicEvolving&lt;br/&gt;
   override def getArity: Int = 0&lt;br/&gt;
   @PublicEvolving&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def getTotalFields: Int = 0&lt;br/&gt;
+  override def getTotalFields: Int = 1&lt;br/&gt;
   @PublicEvolving&lt;br/&gt;
   override def getTypeClass: Class&lt;span class=&quot;error&quot;&gt;&amp;#91;Nothing&amp;#93;&lt;/span&gt; = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Nothing&amp;#93;&lt;/span&gt;&lt;br/&gt;
   @PublicEvolving&lt;br/&gt;
diff --git a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/UnitTypeInfo.scala b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/UnitTypeInfo.scala&lt;br/&gt;
index 5d4a44384e0..1e56794baae 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/UnitTypeInfo.scala&lt;br/&gt;
+++ b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/UnitTypeInfo.scala&lt;br/&gt;
@@ -31,7 +31,7 @@ class UnitTypeInfo extends TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;Unit&amp;#93;&lt;/span&gt; {&lt;br/&gt;
   @PublicEvolving&lt;br/&gt;
   override def getArity(): Int = 0&lt;br/&gt;
   @PublicEvolving&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;override def getTotalFields(): Int = 0&lt;br/&gt;
+  override def getTotalFields(): Int = 1&lt;br/&gt;
   @PublicEvolving&lt;br/&gt;
   override def getTypeClass(): Class&lt;span class=&quot;error&quot;&gt;&amp;#91;Unit&amp;#93;&lt;/span&gt; = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Unit&amp;#93;&lt;/span&gt;&lt;br/&gt;
   @PublicEvolving&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16583055" author="fhueske" created="Thu, 16 Aug 2018 20:58:27 +0000"  >&lt;p&gt;Fixed for 1.7.0 with 339016495ff2fdec6d00118971932b80a2f92ad4&lt;br/&gt;
Fixed for 1.6.1 with 3f3736f0901ec10a998eb573b1da2bd7d743c0b7&lt;br/&gt;
Fixed for 1.5.4 with baa4cf063db2abd2b34af8ab851186761326e752&lt;br/&gt;
Fixed for 1.4.3 with a8aae336fe0b4ffd1b1edefbfc3b1dedb6343d7e&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12935014" name="JobFail.scala" size="2813" author="WillB" created="Thu, 9 Aug 2018 17:46:23 +0000"/>
                            <attachment id="12935015" name="JobPass.scala" size="2820" author="WillB" created="Thu, 9 Aug 2018 17:46:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wwd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>