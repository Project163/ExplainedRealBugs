<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9636] Network buffer leaks in requesting a batch of segments during canceling</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9636</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In &lt;tt&gt;NetworkBufferPool#requestMemorySegments&lt;/tt&gt;,&#160;&lt;tt&gt;numTotalRequiredBuffers&lt;/tt&gt; is increased by &lt;tt&gt;numRequiredBuffers&lt;/tt&gt; first.&lt;/p&gt;

&lt;p&gt;If&#160;&lt;tt&gt;InterruptedException&lt;/tt&gt;&#160;is thrown during polling segments from the available queue, the requested segments will be recycled back to &lt;tt&gt;NetworkBufferPool&lt;/tt&gt;,&#160;&lt;tt&gt;numTotalRequiredBuffers&lt;/tt&gt; is decreased by the number&#160;of polled segments which is now inconsistent with &lt;tt&gt;numRequiredBuffers&lt;/tt&gt;. So &lt;tt&gt;numTotalRequiredBuffers&lt;/tt&gt;&#160;in &lt;tt&gt;NetworkBufferPool&lt;/tt&gt;&#160;leaks in this case, and we can also decrease &lt;tt&gt;numRequiredBuffers&lt;/tt&gt; to&#160;fix this bug.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13167362">FLINK-9636</key>
            <summary>Network buffer leaks in requesting a batch of segments during canceling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="zjwang">Zhijiang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 21 Jun 2018 10:27:28 +0000</created>
                <updated>Wed, 4 Jul 2018 05:55:24 +0000</updated>
                            <resolved>Wed, 4 Jul 2018 05:55:24 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16519204" author="zjwang" created="Thu, 21 Jun 2018 10:29:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=NicoK&quot; class=&quot;user-hover&quot; rel=&quot;NicoK&quot;&gt;NicoK&lt;/a&gt;, I think this is a bug during&#160;implementing credit-based flow control.&lt;/p&gt;</comment>
                            <comment id="16529613" author="nicok" created="Mon, 2 Jul 2018 09:44:04 +0000"  >&lt;p&gt;Actually, &lt;tt&gt;numRequiredBuffers&lt;/tt&gt; is only a local variable in this method - why should we bother changing it?&lt;/p&gt;

&lt;p&gt;Also, if there is an &lt;tt&gt;InterruptedException&lt;/tt&gt; when polling memory segments from the &lt;tt&gt;availableMemorySegments&lt;/tt&gt; queue, this will be re-thrown and the request will fail - &lt;tt&gt;NetworkBufferPool&lt;/tt&gt; should then be restored to the state it was before which it is, isn&apos;t it?&lt;/p&gt;

&lt;p&gt;I see only one point where the accounting for &lt;tt&gt;numTotalRequiredBuffers&lt;/tt&gt; can be wrong: if an exception is thrown in the first of the &lt;tt&gt;redistributeBuffers()&lt;/tt&gt; calls. Tracing it further down, this can only happen if &lt;tt&gt;SpillableSubpartition#releaseMemory()&lt;/tt&gt; throws, e.g. due to a failure in creating a &lt;tt&gt;spillWriter&lt;/tt&gt;. I&apos;m working on a patch...&lt;/p&gt;</comment>
                            <comment id="16529727" author="githubbot" created="Mon, 2 Jul 2018 11:22:31 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9636&quot; title=&quot;Network buffer leaks in requesting a batch of segments during canceling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9636&quot;&gt;&lt;del&gt;FLINK-9636&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; fix inconsistency with failed buffer redistribution&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    If an exception is thrown in `NetworkBufferPool#requestMemorySegments()`&apos;s first call to `redistributeBuffers()`, the accounting for `numTotalRequiredBuffers` is wrong for future uses of this buffer pool.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix accounting of `NetworkBufferPool#numTotalRequiredBuffers` during failures in `NetworkBufferPool#requestMemorySegments()`&lt;/li&gt;
	&lt;li&gt;fix some checkstyle warnings&lt;/li&gt;
	&lt;li&gt;add a few more checks around buffer/memory segment recycling&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added `NetworkBufferPoolTest#testRequestMemorySegmentsExceptionDuringBufferRedistribution()`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;JavaDocs&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-9636&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6238&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b3e03fc93f8daa34d81b822a7cd56c353e88c4f7&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-07-02T09:50:47Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; checkstyle&lt;/p&gt;

&lt;p&gt;commit abc724d2ea3acc8ff1e5bf4137ed1fccb6d61372&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-07-02T09:51:09Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9636&quot; title=&quot;Network buffer leaks in requesting a batch of segments during canceling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9636&quot;&gt;&lt;del&gt;FLINK-9636&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; fix inconsistency with failed buffer redistribution&lt;/p&gt;

&lt;p&gt;commit 702b664d1b5b7525a620fbc0ef8121f4df882279&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-07-02T10:42:40Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt; add a few more checks and tags&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16530782" author="githubbot" created="Tue, 3 Jul 2018 03:48:35 +0000"  >&lt;p&gt;Github user zhijiangW commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for fixing this bug. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
    I think there is another potential bug in polling segments from queue during task canceling process, and I pointed out it in the above codes.&lt;/p&gt;</comment>
                            <comment id="16530783" author="githubbot" created="Tue, 3 Jul 2018 03:49:20 +0000"  >&lt;p&gt;Github user zhijiangW commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238#discussion_r199676237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238#discussion_r199676237&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/buffer/NetworkBufferPool.java &amp;#8212;&lt;br/&gt;
    @@ -147,7 +151,12 @@ public void recycle(MemorySegment segment) {&lt;/p&gt;

&lt;p&gt;     			this.numTotalRequiredBuffers += numRequiredBuffers;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;redistributeBuffers();&lt;br/&gt;
    +			try 
{
    +				redistributeBuffers();
    +			}
&lt;p&gt; catch (Throwable t) &lt;/p&gt;
{
    +				this.numTotalRequiredBuffers -= numRequiredBuffers;
    +				ExceptionUtils.rethrowIOException(t);
    +			}
&lt;p&gt;     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		final List&amp;lt;MemorySegment&amp;gt; segments = new ArrayList&amp;lt;&amp;gt;(numRequiredBuffers);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The following `availableMemorySegments.poll(2, TimeUnit.SECONDS) ` may cause `InterruptedException`, and in the catch part `recycleMemorySegments(segments)`  it will do `numTotalRequiredBuffers -= segments.size();`.&lt;/p&gt;

&lt;p&gt;    I think we should do `recycleMemorySegments(numRequiredBuffers ,segments)`, and then call `numTotalRequiredBuffers -= numRequiredBuffers;` inside it, otherwise the  `numTotalRequiredBuffers` is leaked.&lt;/p&gt;</comment>
                            <comment id="16530927" author="githubbot" created="Tue, 3 Jul 2018 07:06:28 +0000"  >&lt;p&gt;Github user NicoK commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238#discussion_r199702444&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238#discussion_r199702444&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/buffer/NetworkBufferPool.java &amp;#8212;&lt;br/&gt;
    @@ -147,7 +151,12 @@ public void recycle(MemorySegment segment) {&lt;/p&gt;

&lt;p&gt;     			this.numTotalRequiredBuffers += numRequiredBuffers;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;redistributeBuffers();&lt;br/&gt;
    +			try 
{
    +				redistributeBuffers();
    +			}
&lt;p&gt; catch (Throwable t) &lt;/p&gt;
{
    +				this.numTotalRequiredBuffers -= numRequiredBuffers;
    +				ExceptionUtils.rethrowIOException(t);
    +			}
&lt;p&gt;     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		final List&amp;lt;MemorySegment&amp;gt; segments = new ArrayList&amp;lt;&amp;gt;(numRequiredBuffers);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    ah, true, thanks for pointing this out, I must have been blind on one eye yesterday&lt;/p&gt;

&lt;p&gt;    I&apos;ll integrate this change as well&lt;/p&gt;</comment>
                            <comment id="16530944" author="githubbot" created="Tue, 3 Jul 2018 07:31:26 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    actually, it was quite easy to reproduce and the fix was also just as you proposed - please see the new commits (the old one was only renamed since I created a separate issue for that now)&lt;/p&gt;</comment>
                            <comment id="16531418" author="githubbot" created="Tue, 3 Jul 2018 13:45:17 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238#discussion_r199811207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238#discussion_r199811207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/buffer/NetworkBufferPool.java &amp;#8212;&lt;br/&gt;
    @@ -151,7 +151,12 @@ public void recycle(MemorySegment segment) {&lt;/p&gt;

&lt;p&gt;     			this.numTotalRequiredBuffers += numRequiredBuffers;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;redistributeBuffers();&lt;br/&gt;
    +			try 
{
    +				redistributeBuffers();
    +			}
&lt;p&gt; catch (Throwable t) {&lt;br/&gt;
    +				this.numTotalRequiredBuffers -= numRequiredBuffers;&lt;br/&gt;
    +				ExceptionUtils.rethrowIOException(t);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Shouldn&apos;t we also do a clean up of the `LocalBufferPool` in `createBufferPool` if the `redistributeBuffers` fails there? &lt;br/&gt;
    ```&lt;br/&gt;
    try &lt;/p&gt;
{
        redistributeBuffers();
    }
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
        destroyBufferPool(localBufferPool);
        ExceptionUtils.rethrowIOException(e);
    }

&lt;p&gt;    return localBufferPool;&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16531421" author="githubbot" created="Tue, 3 Jul 2018 13:47:32 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238#discussion_r199813070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238#discussion_r199813070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/buffer/NetworkBufferPoolTest.java &amp;#8212;&lt;br/&gt;
    @@ -396,4 +398,48 @@ public void go() throws Exception &lt;/p&gt;
{
     			globalPool.destroy();
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Tests &lt;/p&gt;
{@link NetworkBufferPool#requestMemorySegments(int)}
&lt;p&gt;, verifying it may be aborted and&lt;br/&gt;
    +	 * remains in a defined state even if the waiting is interrupted.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testRequestMemorySegmentsInterruptable2() throws Exception {&lt;br/&gt;
    +		final int numBuffers = 10;&lt;br/&gt;
    +&lt;br/&gt;
    +		NetworkBufferPool globalPool = new NetworkBufferPool(numBuffers, 128);&lt;br/&gt;
    +		MemorySegment segment = globalPool.requestMemorySegment();&lt;br/&gt;
    +		assertNotNull(segment);&lt;br/&gt;
    +&lt;br/&gt;
    +		final OneShotLatch isRunning = new OneShotLatch();&lt;br/&gt;
    +		CheckedThread asyncRequest = new CheckedThread() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public void go() throws Exception &lt;/p&gt;
{
    +				isRunning.trigger();
    +				globalPool.requestMemorySegments(10);
    +			}
&lt;p&gt;    +		};&lt;br/&gt;
    +		asyncRequest.start();&lt;br/&gt;
    +&lt;br/&gt;
    +		// We want the destroy call inside the blocking part of the globalPool.requestMemorySegments()&lt;br/&gt;
    +		// call above. We cannot guarantee this though but make it highly probable:&lt;br/&gt;
    +		isRunning.await();&lt;br/&gt;
    +		Thread.sleep(10);&lt;br/&gt;
    +		asyncRequest.interrupt();&lt;br/&gt;
    +&lt;br/&gt;
    +		globalPool.recycle(segment);&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			asyncRequest.sync();
    +		}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    +			assertThat(e, hasProperty(&quot;cause&quot;, instanceOf(InterruptedException.class)));
    +
    +			// test indirectly for NetworkBufferPool#numTotalRequiredBuffers being correct:
    +			// -&amp;gt; creating a new buffer pool should not fail
    +			globalPool.createBufferPool(10, 10);
    +		}
&lt;p&gt; finally {&lt;br/&gt;
    +			globalPool.destroy();&lt;br/&gt;
    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Remove line break.&lt;/p&gt;</comment>
                            <comment id="16531492" author="githubbot" created="Tue, 3 Jul 2018 14:39:46 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238#discussion_r199832400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238#discussion_r199832400&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/buffer/NetworkBufferPool.java &amp;#8212;&lt;br/&gt;
    @@ -151,7 +151,12 @@ public void recycle(MemorySegment segment) {&lt;/p&gt;

&lt;p&gt;     			this.numTotalRequiredBuffers += numRequiredBuffers;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;redistributeBuffers();&lt;br/&gt;
    +			try 
{
    +				redistributeBuffers();
    +			}
&lt;p&gt; catch (Throwable t) {&lt;br/&gt;
    +				this.numTotalRequiredBuffers -= numRequiredBuffers;&lt;br/&gt;
    +				ExceptionUtils.rethrowIOException(t);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    After an offline discussion with Nico, we agreed that we should add this bit and additionally also call `redistributeBuffers` in the failure case in `requestMemorySegments`.&lt;/p&gt;</comment>
                            <comment id="16532207" author="githubbot" created="Wed, 4 Jul 2018 03:44:53 +0000"  >&lt;p&gt;Github user zhijiangW commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &#128077;&lt;/p&gt;</comment>
                            <comment id="16532283" author="githubbot" created="Wed, 4 Jul 2018 05:53:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6238&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16532285" author="till.rohrmann" created="Wed, 4 Jul 2018 05:55:24 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
1.6.0: efc87083e371eb00e801ef29c65ff49dfb170a4d&lt;br/&gt;
1.5.1: e58a8e4a0946c636652428a898ad53f30d4d4583&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13169714">FLINK-9708</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3v333:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>