<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6615] tmp directory not cleaned up on shutdown</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6615</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Steps to reproduce:&lt;br/&gt;
1) Stop task manager gracefully (kill -6 )&lt;br/&gt;
2) In the logs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2017-05-17 13:35:50,147 INFO  org.apache.zookeeper.ClientCnxn                               - EventThread shut down [main-EventThread]
2017-05-17 13:35:50,200 ERROR org.apache.flink.runtime.io.disk.iomanager.IOManager          - IOManager failed to properly clean up temp file directory: /mnt/flink/tmp/flink-io-66f1d0ec-8976-41bf-9575-f80b181b0e47 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2]
java.nio.file.DirectoryNotEmptyException: /mnt/flink/tmp/flink-io-66f1d0ec-8976-41bf-9575-f80b181b0e47
	at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:242)
	at sun.nio.fs.AbstractFileSystemProvider.delete(AbstractFileSystemProvider.java:103)
	at java.nio.file.Files.delete(Files.java:1126)
	at org.apache.flink.util.FileUtils.deleteDirectory(FileUtils.java:154)
	at org.apache.flink.runtime.io.disk.iomanager.IOManager.shutdown(IOManager.java:109)
	at org.apache.flink.runtime.io.disk.iomanager.IOManagerAsync.shutdown(IOManagerAsync.java:185)
	at org.apache.flink.runtime.taskmanager.TaskManager.postStop(TaskManager.scala:241)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundPostStop(Actor.scala:477)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;on shutdown delete non-empty directory anyway.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Notes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;after process terminated, I&apos;ve checked &quot;/mnt/flink/tmp/flink-io-66f1d0ec-8976-41bf-9575-f80b181b0e47&quot; directory and didn&apos;t find anything there. So it looks like timing issue.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13072802">FLINK-6615</key>
            <summary>tmp directory not cleaned up on shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dernasherbrezon">Andrey</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 May 2017 13:47:57 +0000</created>
                <updated>Mon, 19 Feb 2018 05:03:57 +0000</updated>
                            <resolved>Mon, 19 Feb 2018 05:03:07 +0000</resolved>
                                    <version>1.2.0</version>
                                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16196502" author="githubbot" created="Mon, 9 Oct 2017 04:59:26 +0000"  >&lt;p&gt;GitHub user bowenli86 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6615&quot; title=&quot;tmp directory not cleaned up on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6615&quot;&gt;&lt;del&gt;FLINK-6615&lt;/del&gt;&lt;/a&gt; simplify FileUtils&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    simplify FileUtils&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    simplify FileUtils&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is already covered by existing tests&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    none&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    no&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bowenli86/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bowenli86/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6615&quot; title=&quot;tmp directory not cleaned up on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6615&quot;&gt;&lt;del&gt;FLINK-6615&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4787&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 050e0b724d7d951d3310942c763c261a2691f843&lt;br/&gt;
Author: Bowen Li &amp;lt;bowenli86@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-09T04:57:46Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6615&quot; title=&quot;tmp directory not cleaned up on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6615&quot;&gt;&lt;del&gt;FLINK-6615&lt;/del&gt;&lt;/a&gt; simplify FileUtils&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16197009" author="githubbot" created="Mon, 9 Oct 2017 13:56:59 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Is there any problem with the current implementation?&lt;br/&gt;
    The current implementation was carefully done to gracefully handle concurrent removals and allow to pick whether to clean directories with or without files.&lt;/p&gt;</comment>
                            <comment id="16197240" author="githubbot" created="Mon, 9 Oct 2017 16:28:39 +0000"  >&lt;p&gt;Github user bowenli86 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I was looking into &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6615&quot; title=&quot;tmp directory not cleaned up on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6615&quot;&gt;&lt;del&gt;FLINK-6615&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6615&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-6615&lt;/a&gt;), and I think 6615 is not a problem due to files may be created concurrently. But I found the current impl of `deleteDirectory()` to be cumbersome.&lt;/p&gt;

&lt;p&gt;    The new code also handles concurrent removals well, and I can add back `cleanDirectory()` though it&apos;s not used anywhere yet. I&apos;m happy to keep the original impl if you prefer it. Which version do you like better?&lt;/p&gt;</comment>
                            <comment id="16203341" author="githubbot" created="Fri, 13 Oct 2017 10:11:59 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fair enough. Seems there are tests for the behavior already, so +1 to merge this&lt;/p&gt;

&lt;p&gt;    Merging...&lt;/p&gt;</comment>
                            <comment id="16203514" author="githubbot" created="Fri, 13 Oct 2017 12:47:59 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Actually, going back here. I would like to not merge this after all. The reason being that in my test run, I found that this does not handle concurrent deletes correctly after all:&lt;br/&gt;
    &lt;a href=&quot;https://travis-ci.org/StephanEwen/incubator-flink/jobs/287502995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/StephanEwen/incubator-flink/jobs/287502995&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16203518" author="githubbot" created="Fri, 13 Oct 2017 12:52:00 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think here is an interesting example of why I am often hesitant with cleanup refactorings, unless there is a pressing need to clean up.&lt;/p&gt;

&lt;p&gt;    It is very hard to judge if the cleaned up version is really as robust as the original code. This change looked correct at a first glance, but the concurrency tests caught a subtle difference in some runs.&lt;/p&gt;</comment>
                            <comment id="16205092" author="githubbot" created="Sun, 15 Oct 2017 11:13:58 +0000"  >&lt;p&gt;Github user bowenli86 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen Thanks for letting me know. I&apos;ll close this PR&lt;/p&gt;</comment>
                            <comment id="16205093" author="githubbot" created="Sun, 15 Oct 2017 11:13:58 +0000"  >&lt;p&gt;Github user bowenli86 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16205123" author="githubbot" created="Sun, 15 Oct 2017 13:54:41 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @bowenli86 I hope you don&apos;t mind that I pushed back a bit. It&apos;s my job to be careful about such things...&lt;/p&gt;</comment>
                            <comment id="16222978" author="phoenixjiangnan" created="Fri, 27 Oct 2017 22:39:37 +0000"  >&lt;p&gt;I would recommend closing this ticket as &apos;Not a problem&apos;, if there&apos;s no objection&lt;/p&gt;</comment>
                            <comment id="16224748" author="aljoscha" created="Mon, 30 Oct 2017 11:30:51 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16224757" author="dernasherbrezon" created="Mon, 30 Oct 2017 11:39:29 +0000"  >&lt;p&gt;I would object, as this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;generates false alerts in our monitoring.&lt;/li&gt;
	&lt;li&gt;may generate garbage, which won&apos;t be cleaned up. Causing &quot;No disk space&quot; at some point.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Pull request was closed due to different cause.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f453:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>