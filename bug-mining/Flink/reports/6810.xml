<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-29298] LocalBufferPool request buffer from NetworkBufferPool hanging</title>
                <link>https://issues.apache.org/jira/browse/FLINK-29298</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In the scenario where the buffer contention is fierce, sometimes the task hang can be observed. Through the thread dump information, we can found that the task thread is blocked by requestMemorySegmentBlocking forever. After investigating the dumped heap information, I found that the NetworkBufferPool actually has many buffers, but the LocalBufferPool is still unavailable and no buffer has been obtained.&lt;/p&gt;

&lt;p&gt;By looking at the code, I am sure that this is a bug in thread race: when the task thread polled out the last buffer in LocalBufferPool and triggered the onGlobalPoolAvailable callback itself, it will skip this notification&#160; (as currently the LocalBufferPool is available), which will cause the BufferPool to eventually become unavailable and will never register a callback to the NetworkBufferPool.&lt;/p&gt;

&lt;p&gt;The conditions for triggering the problem are relatively strict, but I have found a stable way to reproduce it, I will try to fix and verify this problem.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049258/13049258_image-2022-09-14-10-52-15-259.png&quot; height=&quot;219&quot; width=&quot;1021&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049257/13049257_image-2022-09-14-10-58-45-987.png&quot; height=&quot;315&quot; width=&quot;997&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049256/13049256_image-2022-09-14-11-00-47-309.png&quot; height=&quot;121&quot; width=&quot;453&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13481422">FLINK-29298</key>
            <summary>LocalBufferPool request buffer from NetworkBufferPool hanging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Weijie Guo">Weijie Guo</assignee>
                                    <reporter username="Weijie Guo">Weijie Guo</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 14 Sep 2022 03:15:36 +0000</created>
                <updated>Sat, 18 Mar 2023 03:27:54 +0000</updated>
                            <resolved>Tue, 13 Dec 2022 04:30:25 +0000</resolved>
                                    <version>1.16.0</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.16.1</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17620848" author="kevin.cyj" created="Thu, 20 Oct 2022 07:34:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Weijie+Guo&quot; class=&quot;user-hover&quot; rel=&quot;Weijie Guo&quot;&gt;Weijie Guo&lt;/a&gt; Thanks for reporting this.&lt;/p&gt;</comment>
                            <comment id="17634128" author="JIRAUSER291799" created="Tue, 15 Nov 2022 03:03:53 +0000"  >&lt;p&gt;I tested the new github commit, but it still exists the same problem. If I change the first for() to 1024 times, this bug will be trigged everytimes.&lt;/p&gt;</comment>
                            <comment id="17634138" author="weijie guo" created="Tue, 15 Nov 2022 03:32:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AlexXXX&quot; class=&quot;user-hover&quot; rel=&quot;AlexXXX&quot;&gt;AlexXXX&lt;/a&gt; This pr has not been reviewed, so it may not be the final solution. In addition, I&apos;m a little suspicious that this problem may not be the only one in the LocalBufferPool, I need to confirm after the problem is fixed. As for the change of the first for() statement to 1024, this is expected, because there are only 1024 buffers in the networkBufferPool in the test class, and one buffer will be taken from the @Before method, so the maximum number of buffers can be requested in line 259 is 1023.&lt;/p&gt;</comment>
                            <comment id="17646419" author="xintongsong" created="Tue, 13 Dec 2022 04:30:25 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master (1.17): 875f27ef38af20d2548d225c0583ebffe0f700fa&lt;/li&gt;
	&lt;li&gt;release-1.16: 40fbea33c35bf9d04bff35f01554bb91c874b975&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17702031" author="lichen1109" created="Sat, 18 Mar 2023 01:00:02 +0000"  >&lt;p&gt;We  alse faced to this problem, how to reproduce this problem with a stable way, Thank you sir&lt;/p&gt;</comment>
                            <comment id="17702051" author="weijie guo" created="Sat, 18 Mar 2023 03:27:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lichen1109&quot; class=&quot;user-hover&quot; rel=&quot;lichen1109&quot;&gt;lichen1109&lt;/a&gt;. Unfortunately, this bug is only possible to reproduce in the case of strong buffer competition. However, I wrote a unit test for this PR, which can reproduce the problem with a high probability. &lt;br/&gt;
In addition, there is another bug (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-31293&quot; title=&quot;Request memory segment from LocalBufferPool may hanging forever.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-31293&quot;&gt;&lt;del&gt;FLINK-31293&lt;/del&gt;&lt;/a&gt;) that can also cause a similar phenomenon. Whether your job is a batch job or a stream job, there should be no similar problems with batch jobs in the latest release-1.17 and master branches.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13483201">FLINK-29419</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13499310">FLINK-29923</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13049258" name="image-2022-09-14-10-52-15-259.png" size="2322901" author="Weijie Guo" created="Wed, 14 Sep 2022 02:52:18 +0000"/>
                            <attachment id="13049257" name="image-2022-09-14-10-58-45-987.png" size="1279141" author="Weijie Guo" created="Wed, 14 Sep 2022 02:58:49 +0000"/>
                            <attachment id="13049256" name="image-2022-09-14-11-00-47-309.png" size="149037" author="Weijie Guo" created="Wed, 14 Sep 2022 03:00:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18jg8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>