<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30863] Register local recovery files of changelog before notifyCheckpointComplete()</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30863</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If TM is materialized before receiving confirm(), the previously uploaded queue in `FsStateChangelogWriter` will be cleared, so the local files of the completed checkpoint will not be registered again, while the JM owned files are registered before confirm(), and do not depend on the uploaded queue, so the local files are deleted, and the DFS files are still there.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We have encountered the following situation, the job cannot find the local recovery files, but can restore from the DFS files:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-01-18 17:21:13,412 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.runtime.taskmanager.Task &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;[] - SlidingProcessingTimeWindows (37/48)#1 #1 (fa12cfa3b811a351e031b036b0e85d91) switched from DEPLOYING to INITIALIZING.
2023-01-18 17:21:13,440 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.runtime.state.TaskLocalStateStoreImpl &#160; &#160; &#160; [] - Found registered local state &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint 11599 in subtask (2daf1d9bc9ed40ecb191303db813b0de - 0a448493b4782967b150582570326227 - 36) : TaskOperatorSubtaskStates{subtaskStatesByOperatorID={0a448493b4782967b150582570326227=SubtaskState{operatorStateFromBackend=StateObjectCollection{[]}, operatorStateFromStream=StateObjectCollection{[]}, keyedStateFromBackend=StateObjectCollection{[org.apache.flink.runtime.state.changelog.ChangelogStateBackendLocalHandle@38aa46db]}, keyedStateFromStream=StateObjectCollection{[]}, inputChannelState=StateObjectCollection{[]}, resultSubpartitionState=StateObjectCollection{[]}, stateSize=1764644202, checkpointedSize=1997682}}, isTaskDeployedAsFinished=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, isTaskFinished=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
2023-01-18 17:21:13,442 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.EmbeddedRocksDBStateBackend [] - Getting managed memory shared cache &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; RocksDB.
2023-01-18 17:21:13,446 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.EmbeddedRocksDBStateBackend [] - Obtained shared RocksDB cache of size 1438814063 bytes
2023-01-18 17:21:13,447 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.restore.RocksDBIncrementalRestoreOperation [] - Starting to restore from state handle: IncrementalLocalKeyedStateHandle{metaDataState=File State: file:/opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/localState/aid_45af7e6b612dad10b60554d81323d5f3/jid_2daf1d9bc9ed40ecb191303db813b0de/vtx_0a448493b4782967b150582570326227_sti_36/chk_125/0d082666-bd31-4ebe-9977-545c0d9b18a5 [1187 bytes]} DirectoryKeyedStateHandle{directoryStateHandle=DirectoryStateHandle{directory=/opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/localState/aid_45af7e6b612dad10b60554d81323d5f3/jid_2daf1d9bc9ed40ecb191303db813b0de/vtx_0a448493b4782967b150582570326227_sti_36/chk_125/b3e1d20f164d4c5baed291f5d1224183}, keyGroupRange=KeyGroupRange{startKeyGroup=96, endKeyGroup=98}} without rescaling.
2023-01-18 17:21:13,495 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.restore.RocksDBIncrementalRestoreOperation [] - Finished restoring from state handle: IncrementalLocalKeyedStateHandle{metaDataState=File State: file:/opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/localState/aid_45af7e6b612dad10b60554d81323d5f3/jid_2daf1d9bc9ed40ecb191303db813b0de/vtx_0a448493b4782967b150582570326227_sti_36/chk_125/0d082666-bd31-4ebe-9977-545c0d9b18a5 [1187 bytes]} DirectoryKeyedStateHandle{directoryStateHandle=DirectoryStateHandle{directory=/opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/localState/aid_45af7e6b612dad10b60554d81323d5f3/jid_2daf1d9bc9ed40ecb191303db813b0de/vtx_0a448493b4782967b150582570326227_sti_36/chk_125/b3e1d20f164d4c5baed291f5d1224183}, keyGroupRange=KeyGroupRange{startKeyGroup=96, endKeyGroup=98}} without rescaling.
2023-01-18 17:21:13,495 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.restore.RocksDBIncrementalRestoreOperation [] - restore rocksdb cost 48 ms.
2023-01-18 17:21:13,495 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackendBuilder [] - Finished building RocksDB keyed state-backend at /opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/tmp/job_2daf1d9bc9ed40ecb191303db813b0de_op_WindowOperator_0a448493b4782967b150582570326227__37_48__uuid_2cbcf5ff-4451-4788-8762-158077c8368e.
2023-01-18 17:21:13,501 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.changelog.fs.FsStateChangelogStorage &#160; &#160; &#160; &#160;[] - createWriter &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; WindowOperator_0a448493b4782967b150582570326227_(37/48)/KeyGroupRange{startKeyGroup=96, endKeyGroup=98}: 00000000-0000-0000-0000-000000000001
2023-01-18 17:21:13,502 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.restore.ChangelogBackendRestoreOperation [] - read changelog handle start, total state size=190851072 .
2023-01-18 17:21:13,502 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.runtime.state.changelog.StateChangelogStorageLoader [] - Creating a changelog storage with name &lt;span class=&quot;code-quote&quot;&gt;&apos;filesystem&apos;&lt;/span&gt; to restore from &lt;span class=&quot;code-quote&quot;&gt;&apos;ChangelogStateHandleStreamImpl&apos;&lt;/span&gt;.
2023-01-18 17:21:13,529 [Source Data Fetcher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: KafkaWindowSource (37/48)#1] INFO &#160;org.apache.kafka.clients.Metadata &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;[] - [Consumer clientId=xr_cl_1-36, groupId=xr_cl_1] Cluster ID: 56sVc6RESJ63Jh6BnsMjkA
2023-01-18 17:21:13,515 [SlidingProcessingTimeWindows (37/48)#1] WARN &#160;org.apache.flink.streaming.api.operators.BackendRestorerProcedure [] - Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; restoring keyed state backend &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; WindowOperator_0a448493b4782967b150582570326227_(37/48) from alternative (1/2), will retry &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; more alternatives are available.
java.lang.RuntimeException: java.io.FileNotFoundException: /opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/localState/aid_45af7e6b612dad10b60554d81323d5f3/jid_2daf1d9bc9ed40ecb191303db813b0de/taskowned/cc3bac5d-020c-4ee0-8999-d661f4b9beac (No such file or directory)
&#160; &#160; at org.apache.flink.util.ExceptionUtils.rethrow(ExceptionUtils.java:321) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.state.changelog.StateChangelogHandleStreamHandleReader$1.advance(StateChangelogHandleStreamHandleReader.java:87) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.state.changelog.StateChangelogHandleStreamHandleReader$1.hasNext(StateChangelogHandleStreamHandleReader.java:69) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.state.changelog.restore.ChangelogBackendRestoreOperation.readBackendHandle(ChangelogBackendRestoreOperation.java:121) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.state.changelog.restore.ChangelogBackendRestoreOperation.restore(ChangelogBackendRestoreOperation.java:89) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.state.changelog.ChangelogStateBackend.restore(ChangelogStateBackend.java:94) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.state.changelog.AbstractChangelogStateBackend.createKeyedStateBackend(AbstractChangelogStateBackend.java:136) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.lambda$keyedStatedBackend$1(StreamTaskStateInitializerImpl.java:336) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.attemptCreateAndRestore(BackendRestorerProcedure.java:168) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.createAndRestore(BackendRestorerProcedure.java:135) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.keyedStatedBackend(StreamTaskStateInitializerImpl.java:353) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:165) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:267) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreGates(StreamTask.java:701) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:677) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:644) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:954) [flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:923) [flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:746) [flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.taskmanager.Task.run(Task.java:568) [flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834) [?:1.8.0_102]
Caused by: java.io.FileNotFoundException: /opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/localState/aid_45af7e6b612dad10b60554d81323d5f3/jid_2daf1d9bc9ed40ecb191303db813b0de/taskowned/cc3bac5d-020c-4ee0-8999-d661f4b9beac (No such file or directory)
&#160; &#160; at java.io.FileInputStream.open0(Native Method) ~[?:1.8.0_102]
&#160; &#160; at java.io.FileInputStream.open(FileInputStream.java:195) ~[?:1.8.0_102]
&#160; &#160; at java.io.FileInputStream.&amp;lt;init&amp;gt;(FileInputStream.java:138) ~[?:1.8.0_102]
&#160; &#160; at org.apache.flink.core.fs.local.LocalDataInputStream.&amp;lt;init&amp;gt;(LocalDataInputStream.java:50) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.core.fs.local.LocalFileSystem.open(LocalFileSystem.java:141) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.core.fs.SafetyNetWrapperFileSystem.open(SafetyNetWrapperFileSystem.java:89) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.state.filesystem.FileStateHandle.openInputStream(FileStateHandle.java:72) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.changelog.fs.ChangelogStreamHandleReaderWithCache.openAndSeek(ChangelogStreamHandleReaderWithCache.java:89) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.changelog.fs.StateChangeIteratorImpl.read(StateChangeIteratorImpl.java:42) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; at org.apache.flink.runtime.state.changelog.StateChangelogHandleStreamHandleReader$1.advance(StateChangelogHandleStreamHandleReader.java:85) ~[flink-dist_2.12-1.15-vvr-6.0-SNAPSHOT.jar:1.15-vvr-6.0-SNAPSHOT]
&#160; &#160; ... 21 more
2023-01-18 17:21:13,545 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.EmbeddedRocksDBStateBackend [] - Getting managed memory shared cache &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; RocksDB.
2023-01-18 17:21:13,545 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.EmbeddedRocksDBStateBackend [] - Obtained shared RocksDB cache of size 1438814063 bytes
2023-01-18 17:21:13,546 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.restore.RocksDBIncrementalRestoreOperation [] - Starting to restore from state handle: IncrementalRemoteKeyedStateHandle{backendIdentifier=b3e1d20f-164d-4c5b-aed2-91f5d1224183, stateHandleId=f404ffdb-715e-4f95-a850-f459639a30e6, keyGroupRange=KeyGroupRange{startKeyGroup=96, endKeyGroup=98}, checkpointId=125, sharedState={001388.sst=File State: oss:&lt;span class=&quot;code-comment&quot;&gt;//cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/bd7103e0-fe66-4400-a2a2-e4f3dda01b71 [51353250 bytes], 001383.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5e937d12-e1d5-4427-9401-80f5db6af2ee [67393725 bytes], 001314.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c2d374dc-88ba-4003-bad5-81590e56963d [67407704 bytes], 001403.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a7ec0f13-3ef1-4e69-a50e-071b9f6b092b [67411564 bytes], 001416.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9c82f81a-33d6-4b8f-a237-2150d0c311d8 [10391374 bytes], 001384.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b591513d-b850-4025-a126-452137b4a6fa [67397014 bytes], 001413.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5e2a0408-f9b4-4875-8594-2dc59df3bc66 [5307477 bytes], 001400.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/16bf5cda-4f04-40c9-8b54-ca1c393028f9 [67953551 bytes], 001316.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9543bc5c-dd9d-47b6-9626-159559b9ee45 [67406146 bytes], 001315.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b6099b46-bbef-486a-8c2f-ef232eefdeff [67409984 bytes], 001408.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/66354b67-97b2-41e8-ae48-678af553d2a7 [16861835 bytes], 001404.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a550c63b-003c-48d5-9bc2-45341ce4e641 [67413763 bytes], 001406.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/55822a0c-8448-48d2-a0c1-0bbccfaf31ca [67414722 bytes], 001317.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2b1f4dcc-76e2-4492-8470-bd512031a0ab [67407862 bytes], 001401.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/42a7b773-95d6-4a8b-bb18-64f083e9c627 [20184247 bytes], 001414.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/ec3a3d64-c0c1-4a5e-b541-dfc01a0f028d [19636706 bytes], 001385.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2ef14224-f229-4852-b97e-50268979f2a3 [67395048 bytes], 001399.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a4550160-1c0c-4bb7-9eb9-26e2a6d9ed43 [67931628 bytes], 001381.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c6278757-9048-4e9d-a67d-5b9fd46c2c4f [67404982 bytes], 001368.sst=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/4497322c-c46b-4d42-9313-1f36d929c577&apos;&lt;/span&gt;, dataBytes=1354}, 001407.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/3308882e-bf0f-4f26-9f3a-3d3dfb05fc85 [67409775 bytes], 001405.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5d5e1529-b109-483d-afa6-5d44297bec6d [67415504 bytes], 001318.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/7f9a7aa5-db80-4448-b987-1f9fdb88f5d1 [67406909 bytes], 001386.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2cf3a080-37d5-4133-b9d2-83e2ad49fc24 [67395104 bytes], 001411.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/66d3176b-2257-403a-be82-03c49162c05f [19605638 bytes], 001410.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/108bb1c1-99da-4920-acab-15f254326ed0 [11733963 bytes], 001387.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9027f480-b895-4336-80b9-dea244ce1572 [67397047 bytes], 001382.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/398f2188-6336-4efe-a014-6bd3bf2ce8c6 [67396271 bytes], 001415.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c73af6f6-18e2-424e-90f9-586809dfbba5 [1931553 bytes], 001402.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/f80462bb-eef1-4e3a-845c-97dea160e306 [67410281 bytes], 001313.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/88251386-e092-4a5e-b8bf-9c2e65148f5a [67408879 bytes]}, privateState={OPTIONS-000013=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b32ad6b5-4540-4b3e-9a82-14cebe231898&apos;&lt;/span&gt;, dataBytes=17286}, MANIFEST-000004=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c94b6317-b50b-4bf1-938d-83d7aad6ed6a [179781 bytes], CURRENT=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/3665ebc2-52ee-4a2e-87b6-6e0cc8458c37&apos;&lt;/span&gt;, dataBytes=16}}, metaStateHandle=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9af5edc4-c589-4f0b-91d7-515e068a3454&apos;&lt;/span&gt;, dataBytes=1187}, registered=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;} without rescaling.
&lt;/span&gt;2023-01-18 17:22:08,867 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.RocksDBStateDownloader [] - download IncrementalRemoteKeyedStateHandle{backendIdentifier=b3e1d20f-164d-4c5b-aed2-91f5d1224183, stateHandleId=f404ffdb-715e-4f95-a850-f459639a30e6, keyGroupRange=KeyGroupRange{startKeyGroup=96, endKeyGroup=98}, checkpointId=125, sharedState={001388.sst=File State: oss:&lt;span class=&quot;code-comment&quot;&gt;//cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/bd7103e0-fe66-4400-a2a2-e4f3dda01b71 [51353250 bytes], 001383.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5e937d12-e1d5-4427-9401-80f5db6af2ee [67393725 bytes], 001314.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c2d374dc-88ba-4003-bad5-81590e56963d [67407704 bytes], 001403.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a7ec0f13-3ef1-4e69-a50e-071b9f6b092b [67411564 bytes], 001416.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9c82f81a-33d6-4b8f-a237-2150d0c311d8 [10391374 bytes], 001384.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b591513d-b850-4025-a126-452137b4a6fa [67397014 bytes], 001413.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5e2a0408-f9b4-4875-8594-2dc59df3bc66 [5307477 bytes], 001400.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/16bf5cda-4f04-40c9-8b54-ca1c393028f9 [67953551 bytes], 001316.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9543bc5c-dd9d-47b6-9626-159559b9ee45 [67406146 bytes], 001315.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b6099b46-bbef-486a-8c2f-ef232eefdeff [67409984 bytes], 001408.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/66354b67-97b2-41e8-ae48-678af553d2a7 [16861835 bytes], 001404.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a550c63b-003c-48d5-9bc2-45341ce4e641 [67413763 bytes], 001406.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/55822a0c-8448-48d2-a0c1-0bbccfaf31ca [67414722 bytes], 001317.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2b1f4dcc-76e2-4492-8470-bd512031a0ab [67407862 bytes], 001401.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/42a7b773-95d6-4a8b-bb18-64f083e9c627 [20184247 bytes], 001414.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/ec3a3d64-c0c1-4a5e-b541-dfc01a0f028d [19636706 bytes], 001385.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2ef14224-f229-4852-b97e-50268979f2a3 [67395048 bytes], 001399.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a4550160-1c0c-4bb7-9eb9-26e2a6d9ed43 [67931628 bytes], 001381.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c6278757-9048-4e9d-a67d-5b9fd46c2c4f [67404982 bytes], 001368.sst=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/4497322c-c46b-4d42-9313-1f36d929c577&apos;&lt;/span&gt;, dataBytes=1354}, 001407.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/3308882e-bf0f-4f26-9f3a-3d3dfb05fc85 [67409775 bytes], 001405.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5d5e1529-b109-483d-afa6-5d44297bec6d [67415504 bytes], 001318.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/7f9a7aa5-db80-4448-b987-1f9fdb88f5d1 [67406909 bytes], 001386.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2cf3a080-37d5-4133-b9d2-83e2ad49fc24 [67395104 bytes], 001411.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/66d3176b-2257-403a-be82-03c49162c05f [19605638 bytes], 001410.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/108bb1c1-99da-4920-acab-15f254326ed0 [11733963 bytes], 001387.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9027f480-b895-4336-80b9-dea244ce1572 [67397047 bytes], 001382.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/398f2188-6336-4efe-a014-6bd3bf2ce8c6 [67396271 bytes], 001415.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c73af6f6-18e2-424e-90f9-586809dfbba5 [1931553 bytes], 001402.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/f80462bb-eef1-4e3a-845c-97dea160e306 [67410281 bytes], 001313.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/88251386-e092-4a5e-b8bf-9c2e65148f5a [67408879 bytes]}, privateState={OPTIONS-000013=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b32ad6b5-4540-4b3e-9a82-14cebe231898&apos;&lt;/span&gt;, dataBytes=17286}, MANIFEST-000004=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c94b6317-b50b-4bf1-938d-83d7aad6ed6a [179781 bytes], CURRENT=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/3665ebc2-52ee-4a2e-87b6-6e0cc8458c37&apos;&lt;/span&gt;, dataBytes=16}}, metaStateHandle=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9af5edc4-c589-4f0b-91d7-515e068a3454&apos;&lt;/span&gt;, dataBytes=1187}, registered=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}, state size = 1573793130, cost 55319 ms.
&lt;/span&gt;2023-01-18 17:22:08,909 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.restore.RocksDBIncrementalRestoreOperation [] - Finished restoring from state handle: IncrementalRemoteKeyedStateHandle{backendIdentifier=b3e1d20f-164d-4c5b-aed2-91f5d1224183, stateHandleId=f404ffdb-715e-4f95-a850-f459639a30e6, keyGroupRange=KeyGroupRange{startKeyGroup=96, endKeyGroup=98}, checkpointId=125, sharedState={001388.sst=File State: oss:&lt;span class=&quot;code-comment&quot;&gt;//cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/bd7103e0-fe66-4400-a2a2-e4f3dda01b71 [51353250 bytes], 001383.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5e937d12-e1d5-4427-9401-80f5db6af2ee [67393725 bytes], 001314.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c2d374dc-88ba-4003-bad5-81590e56963d [67407704 bytes], 001403.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a7ec0f13-3ef1-4e69-a50e-071b9f6b092b [67411564 bytes], 001416.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9c82f81a-33d6-4b8f-a237-2150d0c311d8 [10391374 bytes], 001384.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b591513d-b850-4025-a126-452137b4a6fa [67397014 bytes], 001413.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5e2a0408-f9b4-4875-8594-2dc59df3bc66 [5307477 bytes], 001400.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/16bf5cda-4f04-40c9-8b54-ca1c393028f9 [67953551 bytes], 001316.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9543bc5c-dd9d-47b6-9626-159559b9ee45 [67406146 bytes], 001315.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b6099b46-bbef-486a-8c2f-ef232eefdeff [67409984 bytes], 001408.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/66354b67-97b2-41e8-ae48-678af553d2a7 [16861835 bytes], 001404.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a550c63b-003c-48d5-9bc2-45341ce4e641 [67413763 bytes], 001406.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/55822a0c-8448-48d2-a0c1-0bbccfaf31ca [67414722 bytes], 001317.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2b1f4dcc-76e2-4492-8470-bd512031a0ab [67407862 bytes], 001401.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/42a7b773-95d6-4a8b-bb18-64f083e9c627 [20184247 bytes], 001414.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/ec3a3d64-c0c1-4a5e-b541-dfc01a0f028d [19636706 bytes], 001385.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2ef14224-f229-4852-b97e-50268979f2a3 [67395048 bytes], 001399.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/a4550160-1c0c-4bb7-9eb9-26e2a6d9ed43 [67931628 bytes], 001381.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c6278757-9048-4e9d-a67d-5b9fd46c2c4f [67404982 bytes], 001368.sst=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/4497322c-c46b-4d42-9313-1f36d929c577&apos;&lt;/span&gt;, dataBytes=1354}, 001407.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/3308882e-bf0f-4f26-9f3a-3d3dfb05fc85 [67409775 bytes], 001405.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/5d5e1529-b109-483d-afa6-5d44297bec6d [67415504 bytes], 001318.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/7f9a7aa5-db80-4448-b987-1f9fdb88f5d1 [67406909 bytes], 001386.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/2cf3a080-37d5-4133-b9d2-83e2ad49fc24 [67395104 bytes], 001411.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/66d3176b-2257-403a-be82-03c49162c05f [19605638 bytes], 001410.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/108bb1c1-99da-4920-acab-15f254326ed0 [11733963 bytes], 001387.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9027f480-b895-4336-80b9-dea244ce1572 [67397047 bytes], 001382.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/398f2188-6336-4efe-a014-6bd3bf2ce8c6 [67396271 bytes], 001415.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c73af6f6-18e2-424e-90f9-586809dfbba5 [1931553 bytes], 001402.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/f80462bb-eef1-4e3a-845c-97dea160e306 [67410281 bytes], 001313.sst=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/88251386-e092-4a5e-b8bf-9c2e65148f5a [67408879 bytes]}, privateState={OPTIONS-000013=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/b32ad6b5-4540-4b3e-9a82-14cebe231898&apos;&lt;/span&gt;, dataBytes=17286}, MANIFEST-000004=File State: oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/c94b6317-b50b-4bf1-938d-83d7aad6ed6a [179781 bytes], CURRENT=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/3665ebc2-52ee-4a2e-87b6-6e0cc8458c37&apos;&lt;/span&gt;, dataBytes=16}}, metaStateHandle=ByteStreamStateHandle{handleName=&lt;span class=&quot;code-quote&quot;&gt;&apos;oss://cluster-serving/flink-jobs/namespaces/state-test-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/deployments/1b1f8910-047f-4e51-a1bc-eea91e57600d/checkpoints/jobs/2daf1d9b-c9ed-40ec-b191-303db813b0de/2daf1d9bc9ed40ecb191303db813b0de/taskowned/9af5edc4-c589-4f0b-91d7-515e068a3454&apos;&lt;/span&gt;, dataBytes=1187}, registered=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;} without rescaling.
&lt;/span&gt;2023-01-18 17:22:08,911 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.restore.RocksDBIncrementalRestoreOperation [] - restore rocksdb cost 55365 ms.
2023-01-18 17:22:08,912 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackendBuilder [] - Finished building RocksDB keyed state-backend at /opt/flink/flink-tmp-dir/tm_job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31/tmp/job_2daf1d9bc9ed40ecb191303db813b0de_op_WindowOperator_0a448493b4782967b150582570326227__37_48__uuid_1404e597-c96c-4d7c-99b7-303fd98f80bd.
2023-01-18 17:22:08,915 [SlidingProcessingTimeWindows (37/48)#1] WARN &#160;org.apache.flink.metrics.MetricGroup &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - Name collision: Group already contains a Metric with the name &lt;span class=&quot;code-quote&quot;&gt;&apos;ChangelogStateBackend.lastFullSizeOfMaterialization&apos;&lt;/span&gt;. Metric will not be reported.[192.168.32.162, taskmanager, job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31, Flink Streaming Job, SlidingProcessingTimeWindows, 36]
2023-01-18 17:22:08,915 [SlidingProcessingTimeWindows (37/48)#1] WARN &#160;org.apache.flink.metrics.MetricGroup &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - Name collision: Group already contains a Metric with the name &lt;span class=&quot;code-quote&quot;&gt;&apos;ChangelogStateBackend.lastIncSizeOfMaterialization&apos;&lt;/span&gt;. Metric will not be reported.[192.168.32.162, taskmanager, job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31, Flink Streaming Job, SlidingProcessingTimeWindows, 36]
2023-01-18 17:22:08,915 [SlidingProcessingTimeWindows (37/48)#1] WARN &#160;org.apache.flink.metrics.MetricGroup &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - Name collision: Group already contains a Metric with the name &lt;span class=&quot;code-quote&quot;&gt;&apos;ChangelogStateBackend.lastFullSizeOfNonMaterialization&apos;&lt;/span&gt;. Metric will not be reported.[192.168.32.162, taskmanager, job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31, Flink Streaming Job, SlidingProcessingTimeWindows, 36]
2023-01-18 17:22:08,915 [SlidingProcessingTimeWindows (37/48)#1] WARN &#160;org.apache.flink.metrics.MetricGroup &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - Name collision: Group already contains a Metric with the name &lt;span class=&quot;code-quote&quot;&gt;&apos;ChangelogStateBackend.lastIncSizeOfNonMaterialization&apos;&lt;/span&gt;. Metric will not be reported.[192.168.32.162, taskmanager, job-2daf1d9b-c9ed-40ec-b191-303db813b0de-taskmanager-1-31, Flink Streaming Job, SlidingProcessingTimeWindows, 36]
2023-01-18 17:22:08,915 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.changelog.fs.FsStateChangelogStorage &#160; &#160; &#160; &#160;[] - createWriter &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; WindowOperator_0a448493b4782967b150582570326227_(37/48)/KeyGroupRange{startKeyGroup=96, endKeyGroup=98}: 00000000-0000-0000-0000-000000000002
2023-01-18 17:22:08,915 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.restore.ChangelogBackendRestoreOperation [] - read changelog handle start, total state size=190851072 .
2023-01-18 17:22:08,919 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.fs.osshadoop.StsFetcherCredentialsProvider &#160;[] - Old credential is going to expire. Fetch a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one.
2023-01-18 17:22:38,158 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.restore.ChangelogBackendRestoreOperation [] - read read changelog handle end, cost 29243 ms.
2023-01-18 17:22:38,158 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.common.PeriodicMaterializationManager [] - Task SlidingProcessingTimeWindows (37/48)#1 starts periodic materialization
2023-01-18 17:22:38,158 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.common.PeriodicMaterializationManager [] - Task SlidingProcessingTimeWindows (37/48)#1 schedules the next materialization in 82 seconds
2023-01-18 17:22:38,176 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.runtime.taskmanager.Task &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;[] - SlidingProcessingTimeWindows (37/48)#1 #1 (fa12cfa3b811a351e031b036b0e85d91) switched from INITIALIZING to RUNNING.
2023-01-18 17:22:39,057 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.ChangelogKeyedStateBackend &#160;[] - snapshot of SlidingProcessingTimeWindows (37/48)#1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint 11601, change range: 0..2, materialization ID 125
2023-01-18 17:22:43,779 [Source Data Fetcher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: KafkaWindowSource (37/48)#1] INFO &#160;org.apache.kafka.clients.consumer.internals.AbstractCoordinator [] - [Consumer clientId=xr_cl_1-36, groupId=xr_cl_1] Discovered group coordinator 192.168.47.158:9092 (id: 2147483546 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2023-01-18 17:22:44,100 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.ChangelogKeyedStateBackend &#160;[] - snapshot of SlidingProcessingTimeWindows (37/48)#1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint 11602, change range: 0..11, materialization ID 125
2023-01-18 17:22:47,531 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.ChangelogKeyedStateBackend &#160;[] - snapshot of SlidingProcessingTimeWindows (37/48)#1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint 11603, change range: 0..17, materialization ID 125
2023-01-18 17:22:50,837 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.ChangelogKeyedStateBackend &#160;[] - snapshot of SlidingProcessingTimeWindows (37/48)#1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint 11604, change range: 0..21, materialization ID 125
2023-01-18 17:22:53,580 [SlidingProcessingTimeWindows (37/48)#1] INFO &#160;org.apache.flink.state.changelog.ChangelogKeyedStateBackend &#160;[] - snapshot of SlidingProcessingTimeWindows (37/48)#1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint 11605, change range: 0..23, materialization ID 125 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above log can be simplified to the following scenario:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- cp1 trigger: file1,file1&apos;(local)
- JM: register [file1] to sharedRegistry
- cp1 complete: stopTracking [file1], register [file1&apos;] to localRegistry
- cp2 trigger: file1,file1&lt;span class=&quot;code-quote&quot;&gt;&apos;,file2,file2&apos;&lt;/span&gt;
- JM: register [file1,file2] to sharedRegistry
- cp2 complete: stopTracking [file1, file2], register [file1&lt;span class=&quot;code-quote&quot;&gt;&apos;,file2&apos;&lt;/span&gt;] to localRegistry
- cp1 subsume
- cp3 trigger: file1,file1&lt;span class=&quot;code-quote&quot;&gt;&apos;,file2,file2&apos;&lt;/span&gt;,file3,file3&apos;
- materialization: uploaded.clear()
- JM: register [file1,file2,file3] to sharedRegistry
- cp3 complete: stopTracking [file3], register [file3] to localRegistry
- cp2 subsume: [file1&lt;span class=&quot;code-quote&quot;&gt;&apos;, file2&apos;&lt;/span&gt;] are discarded
- &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; restore from cp3: local file1&lt;span class=&quot;code-quote&quot;&gt;&apos;,file2&apos;&lt;/span&gt; are not found&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13522454">FLINK-30863</key>
            <summary>Register local recovery files of changelog before notifyCheckpointComplete()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Yanfei Lei">Yanfei Lei</assignee>
                                    <reporter username="Yanfei Lei">Yanfei Lei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 1 Feb 2023 10:24:53 +0000</created>
                <updated>Fri, 20 Oct 2023 09:09:49 +0000</updated>
                            <resolved>Tue, 29 Aug 2023 08:39:06 +0000</resolved>
                                    <version>1.17.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17686588" author="roman_khachatryan" created="Thu, 9 Feb 2023 15:16:56 +0000"  >&lt;p&gt;Thanks for filing the ticket and opening the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you clarify my understanding?&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The issue doesn&apos;t cause the data loss currently; but it might make local recovery impossible after checkpoint abortion&lt;/li&gt;
	&lt;li&gt;With the proposed fix, in case of many subsequent aborted checkpoints, local state accumulates. This is a degradation&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Right?&lt;/p&gt;</comment>
                            <comment id="17686903" author="yanfei lei" created="Fri, 10 Feb 2023 07:11:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; Thanks for your reply.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Yes, this issue might make local recovery fail after checkpoint abortion, and then the job would recovery from remote DFS. This issue doesn&apos;t cause data loss.&lt;/li&gt;
	&lt;li&gt;In case of many subsequent aborted checkpoints, all aborted local state will not be deleted until the next completed checkpoint. Right, this is a degradation in some case.&#160; As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiarui&quot; class=&quot;user-hover&quot; rel=&quot;xiarui&quot;&gt;xiarui&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/flink/pull/21822#issuecomment-1418605498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;suggested&lt;/a&gt; in PR, I&apos;m going to use reference counting to decide when to delete a file.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17686999" author="roman_khachatryan" created="Fri, 10 Feb 2023 10:01:41 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt;, reference counting makes sense to me.&lt;/p&gt;</comment>
                            <comment id="17695042" author="yanfei lei" created="Wed, 1 Mar 2023 12:25:39 +0000"  >&lt;p&gt;Looking back at the fileNotFound problem of local recovery again, I found that my previous analysis was incorrect:&lt;/p&gt;

&lt;p&gt;For a checkpoint, notifyAbort() is impossible to come after notifyComplete() on TM.&lt;/p&gt;

&lt;p&gt;If TM is materialized before receiving confirm(), the previously uploaded queue in `FsStateChangelogWriter` will be cleared, so the local files of the completed checkpoint will not be registered again, while the JM owned files are registered before confirm(), and do not depend on the uploaded queue, so the local files are deleted, and the DFS files are still there.&lt;/p&gt;

&lt;p&gt;I added &#160;`testLocalFileAfterMaterialize` to simulate this scenario, and I think local files should be registered before confirm() to avoid this problem.&#160;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt; could you please take a look again?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17699585" author="assassinj" created="Mon, 13 Mar 2023 11:39:16 +0000"  >&lt;p&gt;Hello Yanfei Lei, I found another situation that also triggers FileNotFoundException in local recovery mode, which has nothing to do with the materialization process.&lt;br/&gt;
The specific description is as follows:&lt;br/&gt;
When a checkpoint is completed, the sendAcknowledgeMessages method will be called to notify each ExecutionVertex that the checkpoint is completed, and finally FsStateChangelogWriter#confirm() is called. When there are two or more operators in one tm, one operator will accidentally delete the changelog local files of other operators when executing the confirm() method.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; Please help to confirm whether this issue is discussed in this issue, or I am raising a separate issue&#65311;Thanks&lt;/p&gt;</comment>
                            <comment id="17699586" author="assassinj" created="Mon, 13 Mar 2023 11:39:42 +0000"  >&lt;p&gt;The above description can be simplified to the following scenario:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;cp1&lt;br/&gt;
&#160; &#160; - filter &#65306;f-file001&lt;br/&gt;
&#160; &#160; - window &#65306;w-file001&lt;/li&gt;
	&lt;li&gt;localChangelogRegistry&#65306;f-file001&#65292;w-file001&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;cp2&lt;br/&gt;
&#160; &#160; - filter &#65306;f-file001&#160;&lt;br/&gt;
&#160; &#160; &#160; &#160; - rum confirm&#65288;&#65289;first&#65292;and delete w-file001&lt;br/&gt;
&#160; &#160; - window &#65306;w-file002&lt;/li&gt;
	&lt;li&gt;localChangelogRegistry&#65306;f-file001&#65292;w-file002&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if restore from cp2: local w-file001 are not found&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17699621" author="yanfei lei" created="Mon, 13 Mar 2023 13:01:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=assassinj&quot; class=&quot;user-hover&quot; rel=&quot;assassinj&quot;&gt;assassinj&lt;/a&gt; Thanks for sharing a new situation, I think it&apos;s possible, because the lastUsedCheckpointID of `w-file001`&#160; will not be updated until the window operator confirm(), so it&apos;s deleted when the filter operator confirm().&lt;/p&gt;

&lt;p&gt;I think the current PR can solve this problem, WDYT?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17699920" author="assassinj" created="Tue, 14 Mar 2023 03:15:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; &#160;Thanks for your reply.&lt;/p&gt;

&lt;p&gt;I don&apos;t think the current pr will fix this, and I verified that it does.&lt;br/&gt;
The reason is that localChangelogRegistry in &lt;a href=&quot;https://github.com/apache/flink/pull/21822/files/b782fef3ed194d098d1f7fe4cc45355d2b95f1f4#diff-e071e8a89527c24be4ee5ee342ad7d47c870170ef915d1407d18e998f7847f16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ChangelogKeyedStateBackend.java&lt;/a&gt; is a new object.&lt;/p&gt;

&lt;p&gt;For this problem, I think of two other possible solutions:&lt;br/&gt;
Method 1. Change the logic of LocalChangelogRegistryImpl and add a mapping relationship between operator and file. When confirm() cleans up, only the files of its own operator are cleaned up;&lt;br/&gt;
Method 2. In LocalChangelogRegistryImpl#discardUpToCheckpoint(), change entry.f1 &amp;lt; upTo to entry.f1 &amp;lt; upTo -1.&lt;/p&gt;

&lt;p&gt;Compare the two solutions: method 1 has relatively large changes; method 2 is a trick method with small changes, but it is not easy to understand. At the same time, there will be one more checkpoint file storage occupation. WDYT?&lt;/p&gt;</comment>
                            <comment id="17700000" author="feifan wang" created="Tue, 14 Mar 2023 07:23:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; , sorry for the late reply, I agree to register before confirm() to avoid the both problems mentioned by you and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=assassinj&quot; class=&quot;user-hover&quot; rel=&quot;assassinj&quot;&gt;assassinj&lt;/a&gt; . Further, I think we should do the registration operation in persist(), because that&apos;s where the reference management is originally generated. To achieve this, I suggest pass checkpoint id to persist method. &lt;/p&gt;

&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17701000" author="yanfei lei" created="Thu, 16 Mar 2023 06:36:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=assassinj&quot; class=&quot;user-hover&quot; rel=&quot;assassinj&quot;&gt;assassinj&lt;/a&gt; Thanks for your investigation and solutions, you&apos;re right, I overlooked that every subtask has its own `localChangelogRegistry`. Can adjusting the scope of localChangelogRegistry to TM solve this problem?&lt;/p&gt;

&lt;p&gt;For two other possible solutions:&lt;/p&gt;

&lt;p&gt;I prefer method 1 and I think changing the scope of localChangelogRegistry based on the current PR can achieve the same effect.&lt;/p&gt;

&lt;p&gt;Why does method-2 work? I guess it&apos;s because the next checkpoint won&apos;t start until all subtasks of this checkpoint are confirmed, it&apos;s really not easy to understand as you mentioned&#128514;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt; Thanks for your reply and suggestion, I&apos;ll try to refactor the registration to persist().&lt;/p&gt;</comment>
                            <comment id="17714392" author="feifan wang" created="Thu, 20 Apr 2023 03:34:33 +0000"  >&lt;p&gt;There are two known issues with dstl file cleanup:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;local dstl files still in use be deleted (as described earlier in the current ticket)&lt;/li&gt;
	&lt;li&gt;remote dstl files cannot be cleaned up when checkpoint cannot be completed, even if materialization has completed&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;According to Tang Yun&apos;s reivew feedback, in order to avoid introducing half-baked solutions, I would like to initiate a discussion on dstl file cleanup.&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Here is my proposal :&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;divide the deletion of dstl files into two categories :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;delete by subsumed checkpoint&lt;/b&gt;
	&lt;ol&gt;
		&lt;li&gt;remote files : delete by JobManager , nothing to do with TaskManager (keep status quo)&lt;/li&gt;
		&lt;li&gt;local files : delete by LocalChangelogRegistry. Local checkpoint only used for job failover, so only retain one completed checkpoint. I suggest : Register the latest checkpointId referencing the dstl file to the LocalChangelogRegistry, regardless of whether the checkpoint is completed or not. When the checkpoint is complete, call LocalChangelogRegistry#discardUpToCheckpoint() method to delete the local file whose checkpointId is less than the completed checkpontId. In this way, the LocalChangelogRegistry can ensure that the latest completed local checkpoint is available, and local files only referenced by non-latest checkpoints can be deleted in time. (this PR does exactly that)&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;delete by not used StateChangeSet&lt;/b&gt;&lt;br/&gt;
The &quot;not used StateChangeSet&quot; refers to those StateChangelogSet that are not used by any checkpoint, or the checkpoint that uses it has aborted, and the StateChangeSet has been materialized. In this case, remote files and local files should be handled uniformly, and both are handled by TaskChangelogRegistry. We can introduce a &quot;StateChangeUsageTracker&quot; to find out those not used StateChangeSets based on checkpoint execution and materialization execution, and then notify TaskChangelogRegistry to release the reference count of the corresponding file.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In the method described above, the LocalChangelogRegistry is only responsible for the deletion of local files when checkpoint subsumed, just as implemented in this PR. Since each TaskManager only stores its own checkpoint files locally, and these files will be cleaned up when the TaskManager exits, I think the problem with local dstl files accumulation is milder than remote dstl files. So I suggest do the above modification in two steps :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;in this ticket, make LocalChangelogRegistry only delete local files when checkpoint completed. (just as the PR do)&lt;/li&gt;
	&lt;li&gt;open a new ticket to address deletion of not used both remote and local files.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuanmei&quot; class=&quot;user-hover&quot; rel=&quot;yuanmei&quot;&gt;yuanmei&lt;/a&gt; &#160;WDYT ?&lt;/p&gt;</comment>
                            <comment id="17714399" author="yanfei lei" created="Thu, 20 Apr 2023 03:57:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt; Thanks for your proposal!&#160; &#8220;2. delete by not used StateChangeSet&#8221; can partially solve the problem of dstl files accumulating without any checkpoint completing, but it depends on at least one materialization that can be completed. This is better than doing nothing on abort(), +1 for opening a new ticket to address deletion of not used both remote and local files.&lt;/p&gt;</comment>
                            <comment id="17753823" author="flink-jira-bot" created="Sun, 13 Aug 2023 22:35:20 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issue is assigned but has not received an update in 30 days, so it has been labeled &quot;stale-assigned&quot;.&lt;br/&gt;
If you are still working on the issue, please remove the label and add a comment updating the community on your progress.  If this issue is waiting on feedback, please consider this a reminder to the committer/reviewer. Flink is a very active project, and so we appreciate your patience.&lt;br/&gt;
If you are no longer working on the issue, please unassign yourself so someone else may work on it.&lt;/p&gt;</comment>
                            <comment id="17753869" author="feifan wang" created="Mon, 14 Aug 2023 02:11:28 +0000"  >&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt;&#160; is still working on the ticket, I removed the &apos;stale-assigned&apos; tag.&lt;/p&gt;</comment>
                            <comment id="17759873" author="yanfei lei" created="Tue, 29 Aug 2023 08:38:55 +0000"  >&lt;p&gt;Merged via c23a3002b837ecffa2d561a405c17c979c814c6e&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13055934" name="tm-log_fail_cl_local_recovery.txt" size="2004311" author="Yanfei Lei" created="Wed, 1 Mar 2023 11:44:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fjow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>