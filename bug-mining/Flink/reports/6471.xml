<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:10:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-27418] Flink SQL TopN result is wrong</title>
                <link>https://issues.apache.org/jira/browse/FLINK-27418</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Flink SQL TopN is executed multiple times with different results, sometimes with correct results and sometimes with incorrect results.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void flinkSqlJoinRetract() {
        EnvironmentSettings settings = EnvironmentSettings.newInstance()
                .useBlinkPlanner()
                .inStreamingMode()
                .build();

        StreamExecutionEnvironment streamEnv = StreamExecutionEnvironment.getExecutionEnvironment();
        streamEnv.setParallelism(1);
        StreamTableEnvironment tableEnv = StreamTableEnvironment.create(streamEnv, settings);
        tableEnv.getConfig().setIdleStateRetention(Duration.ofSeconds(10000));

        RowTypeInfo waybillTableTypeInfo = buildWaybillTableTypeInfo();
        RowTypeInfo itemTableTypeInfo = buildItemTableTypeInfo();
        SourceFunction&amp;lt;Row&amp;gt; waybillSourceFunction = buildWaybillStreamSource(waybillTableTypeInfo);
        SourceFunction&amp;lt;Row&amp;gt; itemSourceFunction = buildItemStreamSource(itemTableTypeInfo);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; waybillTable = &lt;span class=&quot;code-quote&quot;&gt;&quot;waybill&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; itemTable = &lt;span class=&quot;code-quote&quot;&gt;&quot;item&quot;&lt;/span&gt;;

        DataStreamSource&amp;lt;Row&amp;gt; waybillStream = streamEnv.addSource(
                waybillSourceFunction,
                waybillTable,
                waybillTableTypeInfo);
        DataStreamSource&amp;lt;Row&amp;gt; itemStream = streamEnv.addSource(
                itemSourceFunction,
                itemTable,
                itemTableTypeInfo);

        Expression[] waybillFields = ExpressionParser
                .parseExpressionList(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.join(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, waybillTableTypeInfo.getFieldNames())
                        + &lt;span class=&quot;code-quote&quot;&gt;&quot;,proctime.proctime&quot;&lt;/span&gt;).toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Expression[0]);
        Expression[] itemFields = ExpressionParser
                .parseExpressionList(
                        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.join(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, itemTableTypeInfo.getFieldNames()) + &lt;span class=&quot;code-quote&quot;&gt;&quot;,proctime.proctime&quot;&lt;/span&gt;)
                .toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Expression[0]);

        tableEnv.createTemporaryView(waybillTable, waybillStream, waybillFields);
        tableEnv.createTemporaryView(itemTable, itemStream, itemFields);

        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sql =
                &lt;span class=&quot;code-quote&quot;&gt;&quot;select \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    city_id, \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    count(*) as cnt\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;from (\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    select id,city_id\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    from (\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;        select \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;            id,\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;            city_id,\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;            row_number() over(partition by id order by utime desc ) as rno \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;        from (\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;            select \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;                waybill.id as id,\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;                coalesce(item.city_id, waybill.city_id) as city_id,\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;                waybill.utime as utime \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;            from waybill left join item \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;            on waybill.id = item.id \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;        ) \n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    )\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    where rno =1\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;)\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;group by city_id&quot;&lt;/span&gt;;

        StatementSet statementSet = tableEnv.createStatementSet();
        Table table = tableEnv.sqlQuery(sql);
        DataStream&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;, Row&amp;gt;&amp;gt; rowDataStream = tableEnv.toRetractStream(table, Row.class);
        rowDataStream.printToErr();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            streamEnv.execute();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            e.printStackTrace();
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; RowTypeInfo buildWaybillTableTypeInfo() {
        TypeInformation[] types = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TypeInformation[]{Types.INT(), Types.STRING(), Types.LONG(), Types.LONG()};
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] fields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;city_id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rider_id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;utime&quot;&lt;/span&gt;};
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RowTypeInfo(types, fields);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; RowTypeInfo buildItemTableTypeInfo() {
        TypeInformation[] types = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TypeInformation[]{Types.INT(), Types.STRING(), Types.LONG()};
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] fields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;city_id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;utime&quot;&lt;/span&gt;};
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RowTypeInfo(types, fields);
    }

    &lt;span class=&quot;code-comment&quot;&gt;//id,rider_id,city_id,utime
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; SourceFunction&amp;lt;Row&amp;gt; buildWaybillStreamSource(RowTypeInfo rowTypeInfo) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SourceFunction&amp;lt;Row&amp;gt;() {
            &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; stopped = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = 0;
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] ids = {111, 222, 333, 111};
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] cityIds = {&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;};

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run(SourceContext&amp;lt;Row&amp;gt; ctx) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!stopped) {
                    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; id = ids[count % ids.length];
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cityId = cityIds[count % cityIds.length];
                    Row row = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Row(4);
                    row.setField(0, id);
                    row.setField(1, cityId);
                    row.setField(2, (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) RandomUtils.nextInt(1000, 2000));
                    row.setField(3, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis());
                    printRow(rowTypeInfo, row);
                    ctx.collect(row);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (++count &amp;gt; 3) {
                        stopped = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                    }
                }
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancel() {
                stopped = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        };
    }

    &lt;span class=&quot;code-comment&quot;&gt;//id,city_id,utime
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; SourceFunction&amp;lt;Row&amp;gt; buildItemStreamSource(RowTypeInfo rowTypeInfo) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SourceFunction&amp;lt;Row&amp;gt;() {
            &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; stopped = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = 0;
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] ids = {111, 333};
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] cityIds = {&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;D&quot;&lt;/span&gt;};

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run(SourceContext&amp;lt;Row&amp;gt; ctx) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!stopped) {
                    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(RandomUtils.nextInt(1000, 2000));
                    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; id = ids[count % ids.length];
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cityId = cityIds[count % cityIds.length];
                    Row row = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Row(3);
                    row.setField(0, id);
                    row.setField(1, cityId);
                    &lt;span class=&quot;code-comment&quot;&gt;//row.setField(2, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis());
&lt;/span&gt;                    printRow(rowTypeInfo, row);
                    ctx.collect(row);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (++count &amp;gt;= 2) {
                        stopped = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                    }

                }
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancel() {
                stopped = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        };
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void printRow(RowTypeInfo rowTypeInfo, Row row) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prefix = &quot;&quot;;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; rowTypeInfo.getArity(); ++i) {
            prefix = i &amp;gt; 0 ? &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt; : &quot;&quot;;
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(prefix + rowTypeInfo.getFieldNames()[i] + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt; + row.getField(i));
        }
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;------------------------------------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;b&gt;wrong result&lt;/b&gt;&lt;/td&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;right result&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;id:111,city_id:A,rider_id:1137,utime:1650979957702&lt;br/&gt;
id:222,city_id:A,rider_id:1976,utime:1650979957725&lt;br/&gt;
id:333,city_id:B,rider_id:1916,utime:1650979957725&lt;br/&gt;
id:111,city_id:A,rider_id:1345,utime:1650979957725&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(false,A,1)&lt;br/&gt;
(true,A,2)&lt;br/&gt;
(true,B,1)&lt;br/&gt;
(false,A,2)&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(false,A,1)&lt;br/&gt;
(true,A,2)&lt;br/&gt;
id:111,city_id:C,utime:null&lt;br/&gt;
(false,A,2)&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(true,C,1)&lt;br/&gt;
(false,A,1)&lt;br/&gt;
(false,C,1)&lt;br/&gt;
(true,C,2)&lt;br/&gt;
id:333,city_id: D,utime:null&lt;br/&gt;
(false,B,1)&lt;br/&gt;
(true,D,1)&lt;br/&gt;
The final result:&lt;br/&gt;
C,2&lt;br/&gt;
D,1&lt;br/&gt;
is wrong.&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;br/&gt;
id:111,city_id:A,rider_id:1155,utime:1650980662019&lt;br/&gt;
id:222,city_id:A,rider_id:1875,utime:1650980662042&lt;br/&gt;
id:333,city_id:B,rider_id:1430,utime:1650980662042&lt;br/&gt;
id:111,city_id:A,rider_id:1308,utime:1650980662042&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(false,A,1)&lt;br/&gt;
(true,A,2)&lt;br/&gt;
(true,B,1)&lt;br/&gt;
(false,A,2)&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(false,A,1)&lt;br/&gt;
(true,A,2)&lt;br/&gt;
id:111,city_id:C,utime:null&lt;br/&gt;
(false,A,2)&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(false,A,1)&lt;br/&gt;
(true,A,2)&lt;br/&gt;
(false,A,2)&lt;br/&gt;
(true,A,1)&lt;br/&gt;
(true,C,1)&lt;br/&gt;
id:333,city_id: D,utime:null&lt;br/&gt;
(false,B,1)&lt;br/&gt;
(true,D,1)&lt;br/&gt;
The final result:&lt;br/&gt;
A,1&lt;br/&gt;
C,1&lt;br/&gt;
D,1&lt;br/&gt;
is right.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Flink 1.12.2 and Flink 1.14.3 test results are sometimes wrong&lt;/p&gt;</environment>
        <key id="13441830">FLINK-27418</key>
            <summary>Flink SQL TopN result is wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rovboyko">Roman Boyko</assignee>
                                    <reporter username="zhangbinzaifendou">zhangbin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 26 Apr 2022 14:10:08 +0000</created>
                <updated>Thu, 9 Jun 2022 08:38:16 +0000</updated>
                            <resolved>Thu, 9 Jun 2022 08:38:16 +0000</resolved>
                                    <version>1.12.2</version>
                    <version>1.14.3</version>
                                    <fixVersion>1.15.1</fixVersion>
                    <fixVersion>1.16.0</fixVersion>
                    <fixVersion>1.14.6</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17528202" author="zhangbinzaifendou" created="Tue, 26 Apr 2022 14:25:34 +0000"  >&lt;p&gt;Hi,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &#65292;I see you&apos;ve fixed several topn bugs.&lt;br/&gt;
I have found the cause of this wrong result, and I hope to discuss it with you.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17528284" author="martijnvisser" created="Tue, 26 Apr 2022 16:36:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbinzaifendou&quot; class=&quot;user-hover&quot; rel=&quot;zhangbinzaifendou&quot;&gt;zhangbinzaifendou&lt;/a&gt; Are you sure that you&apos;ve tested this in Flink 1.14? Your code refers to Blink Planner, but that doesn&apos;t exist in Flink 1.14. &lt;/p&gt;</comment>
                            <comment id="17528540" author="zhangbinzaifendou" created="Wed, 27 Apr 2022 05:09:43 +0000"  >&lt;p&gt;Thank you for your reply, the useBlinkPlanner method still exists in Flink 1.14 and the result is sometimes wrong in Flink 1.14. You will get different results if you execute it several times&lt;/p&gt;</comment>
                            <comment id="17531667" author="martijnvisser" created="Wed, 4 May 2022 11:08:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; What do you think? &lt;/p&gt;</comment>
                            <comment id="17539968" author="rovboyko" created="Fri, 20 May 2022 07:37:42 +0000"  >&lt;p&gt;The bug exists indeed. The simplest way to reproduce it is add this to RetractableTopNFunctionTest:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRetractRowNumber() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    AbstractTopNFunction func =
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RetractableTopNFunction(
                    ttlConfig,
                    InternalTypeInfo.ofFields(
                            VarCharType.STRING_TYPE,
                            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigIntType(),
                            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IntType(),
                            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IntType()),
                    comparableRecordComparator,
                    sortKeySelector,
                    RankType.ROW_NUMBER,
                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConstantRankRange(1, 1),
                    generatedEqualiser,
                    &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
                    &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

    OneInputStreamOperatorTestHarness&amp;lt;RowData, RowData&amp;gt; testHarness = createTestHarness(func);
    testHarness.open();
    testHarness.processElement(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 0));
    testHarness.processElement(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 9, 0));
    testHarness.processElement(deleteRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 0));
    testHarness.processElement(deleteRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 9, 0));
    testHarness.processElement(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 1));
    testHarness.processElement(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 9, 1));
    testHarness.close();

    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; expectedOutput = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    expectedOutput.add(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 0));
    expectedOutput.add(deleteRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 0));
    expectedOutput.add(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 9, 0));
    expectedOutput.add(deleteRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 9, 0));
    expectedOutput.add(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 1));
    expectedOutput.add(deleteRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 10, 1));
    expectedOutput.add(insertRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 1L, 9, 1));

    assertorWithRowNumber.assertOutputEquals(
            &lt;span class=&quot;code-quote&quot;&gt;&quot;output wrong.&quot;&lt;/span&gt;, expectedOutput, testHarness.getOutput());
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ll take it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbinzaifendou&quot; class=&quot;user-hover&quot; rel=&quot;zhangbinzaifendou&quot;&gt;zhangbinzaifendou&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; could you please assign it to me?&lt;/p&gt;</comment>
                            <comment id="17540003" author="martijnvisser" created="Fri, 20 May 2022 09:24:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rovboyko&quot; class=&quot;user-hover&quot; rel=&quot;rovboyko&quot;&gt;rovboyko&lt;/a&gt; Thanks, I&apos;ve assigned it to you&lt;/p&gt;</comment>
                            <comment id="17540342" author="rovboyko" created="Sat, 21 May 2022 04:02:13 +0000"  >&lt;p&gt;The PR is ready - &lt;a href=&quot;https://github.com/apache/flink/pull/19778&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/19778&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangbinzaifendou&quot; class=&quot;user-hover&quot; rel=&quot;zhangbinzaifendou&quot;&gt;zhangbinzaifendou&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; , could you please have a look?&lt;/p&gt;</comment>
                            <comment id="17551660" author="jark" created="Wed, 8 Jun 2022 15:06:17 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 99f4511de90052f182085f943337d86778bc8488&lt;/li&gt;
	&lt;li&gt;1.15.1: ce23d6331c448b401066006a794c7cf91aeb5fda&lt;/li&gt;
	&lt;li&gt;1.14.5: 80abb30a7217d4cee034aa375c1a72a07e0c5768&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11tww:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>