<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:32:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8562] Fix YARNSessionFIFOSecuredITCase</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8562</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently,&#160;YARNSessionFIFOSecuredITCase will not fail even if the current Flink YARN Kerberos integration is failing in production. Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8275&quot; title=&quot;Flink YARN deployment with Kerberos enabled not working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8275&quot;&gt;&lt;del&gt;FLINK-8275&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13136461">FLINK-8562</key>
            <summary>Fix YARNSessionFIFOSecuredITCase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="suez1224">Shuyi Chen</assignee>
                                    <reporter username="suez1224">Shuyi Chen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Feb 2018 03:48:53 +0000</created>
                <updated>Thu, 28 Feb 2019 11:24:50 +0000</updated>
                            <resolved>Thu, 22 Mar 2018 17:34:11 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16353590" author="githubbot" created="Tue, 6 Feb 2018 08:55:57 +0000"  >&lt;p&gt;GitHub user suez1224 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8562&quot; title=&quot;Fix YARNSessionFIFOSecuredITCase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8562&quot;&gt;&lt;del&gt;FLINK-8562&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Security&amp;#93;&lt;/span&gt; Fix YARNSessionFIFOSecuredITCase&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Fix YARNSessionFIFOSecuredITCase. It&apos;s currently broken.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add check on JM/TM output for successful keytab login&lt;/li&gt;
	&lt;li&gt;increase wait time for JM/TM to start&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Verified by running the YARNSessionFIFOSecuredITCase, and it fails on master. After patching &lt;a href=&quot;https://github.com/apache/flink/pull/5172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5172&lt;/a&gt;, it passes.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (y no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no )&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yno )&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: ( no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/suez1224/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/suez1224/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8562&quot; title=&quot;Fix YARNSessionFIFOSecuredITCase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8562&quot;&gt;&lt;del&gt;FLINK-8562&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5416&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3d23f47a54250f83c9003bd9ba285c57491ff99f&lt;br/&gt;
Author: Shuyi Chen &amp;lt;shuyi@...&amp;gt;&lt;br/&gt;
Date:   2018-02-06T08:50:21Z&lt;/p&gt;

&lt;p&gt;    Fix YARNSessionFIFOSecuredITCase&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16354623" author="suez1224" created="Tue, 6 Feb 2018 22:07:25 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tzulitai&quot; class=&quot;user-hover&quot; rel=&quot;tzulitai&quot;&gt;tzulitai&lt;/a&gt;, could you please help take a look at this? Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="16404029" author="githubbot" created="Sun, 18 Mar 2018 15:18:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175292445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175292445&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -379,6 +382,50 @@ public boolean accept(File dir, String name) {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	public static void ensureStringInNamedLogFiles(final String[] mustHave, final String fileName) {&lt;br/&gt;
    +		File cwd = new File(&quot;target/&quot; + YARN_CONFIGURATION.get(TEST_CLUSTER_NAME_KEY));&lt;br/&gt;
    +		Assert.assertTrue(&quot;Expecting directory &quot; + cwd.getAbsolutePath() + &quot; to exist&quot;, cwd.exists());&lt;br/&gt;
    +		Assert.assertTrue(&lt;br/&gt;
    +				&quot;Expecting directory &quot; + cwd.getAbsolutePath() + &quot; to be a directory&quot;, cwd.isDirectory());&lt;br/&gt;
    +&lt;br/&gt;
    +		File foundFile = findFile(cwd.getAbsolutePath(), new FilenameFilter() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public boolean accept(File dir, String name) {&lt;br/&gt;
    +				if (fileName != null &amp;amp;&amp;amp; !name.equals(fileName)) &lt;/p&gt;
{
    +					return false;
    +				}
&lt;p&gt;    +				File f = new File(dir.getAbsolutePath() + &quot;/&quot; + name);&lt;br/&gt;
    +				LOG.info(&quot;Searching in {}&quot;, f.getAbsolutePath());&lt;br/&gt;
    +				try {&lt;br/&gt;
    +					Set&amp;lt;String&amp;gt; foundSet = new HashSet&amp;lt;String&amp;gt;(mustHave.length);&lt;br/&gt;
    +					Scanner scanner = new Scanner(f);&lt;br/&gt;
    +					while (scanner.hasNextLine()) {&lt;br/&gt;
    +						final String lineFromFile = scanner.nextLine();&lt;br/&gt;
    +						for (String str : mustHave) {&lt;br/&gt;
    +							if (lineFromFile.contains(str)) &lt;/p&gt;
{
    +								foundSet.add(str);
    +							}
&lt;p&gt;    +						}&lt;br/&gt;
    +						if (foundSet.containsAll(Arrays.asList(mustHave))) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    can we construct `Arrays.asList(mustHave)` once and pass it to the `FilenameFilter`?&lt;/p&gt;</comment>
                            <comment id="16404030" author="githubbot" created="Sun, 18 Mar 2018 15:18:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175292359&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175292359&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -105,7 +105,7 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		//additional sleep for the JM/TM to start and establish connection&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sleep(2000);&lt;br/&gt;
    +		sleep(3000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why do we have to increase this timeout?&lt;/p&gt;</comment>
                            <comment id="16404031" author="githubbot" created="Sun, 18 Mar 2018 15:18:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175292394&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175292394&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -206,7 +209,7 @@ public void checkClusterEmpty() throws IOException, YarnException {&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfiguration = new org.apache.flink.configuration.Configuration();&lt;br/&gt;
    +		flinkConfiguration = GlobalConfiguration.loadConfiguration();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why do we have to load the configuration from disk and cannot use a vanilla `Configuration` object?&lt;/p&gt;</comment>
                            <comment id="16404032" author="githubbot" created="Sun, 18 Mar 2018 15:19:01 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175292522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175292522&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOSecuredITCase.java &amp;#8212;&lt;br/&gt;
    @@ -97,6 +98,15 @@ public static void teardownSecureCluster() throws Exception &lt;/p&gt;
{
     		SecureTestEnvironment.cleanup();
     	}

&lt;p&gt;    +	@Override&lt;br/&gt;
    +	public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
    +		super.testDetachedMode();&lt;br/&gt;
    +		ensureStringInNamedLogFiles(new String[]&lt;/p&gt;
{&quot;Login successful for user&quot;, &quot;using keytab file&quot;}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    From which component do these logging statements come from?&lt;/p&gt;</comment>
                            <comment id="16404344" author="githubbot" created="Mon, 19 Mar 2018 03:42:29 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175325243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175325243&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -105,7 +105,7 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		//additional sleep for the JM/TM to start and establish connection&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sleep(2000);&lt;br/&gt;
    +		sleep(3000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I found that this test can fail sometimes after the fix, therefore adding 1 second to avoid the false positive. It was not a problem before because this test used to pass all the time (because it&apos;s not doing the right check).&lt;/p&gt;</comment>
                            <comment id="16404346" author="githubbot" created="Mon, 19 Mar 2018 03:44:31 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175325407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175325407&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOSecuredITCase.java &amp;#8212;&lt;br/&gt;
    @@ -97,6 +98,15 @@ public static void teardownSecureCluster() throws Exception &lt;/p&gt;
{
     		SecureTestEnvironment.cleanup();
     	}

&lt;p&gt;    +	@Override&lt;br/&gt;
    +	public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
    +		super.testDetachedMode();&lt;br/&gt;
    +		ensureStringInNamedLogFiles(new String[]&lt;/p&gt;
{&quot;Login successful for user&quot;, &quot;using keytab file&quot;}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Please see UserGroupInformation.loginUserFromKeytab().&lt;/p&gt;</comment>
                            <comment id="16404427" author="githubbot" created="Mon, 19 Mar 2018 06:42:34 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175341644&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175341644&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -206,7 +209,7 @@ public void checkClusterEmpty() throws IOException, YarnException {&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfiguration = new org.apache.flink.configuration.Configuration();&lt;br/&gt;
    +		flinkConfiguration = GlobalConfiguration.loadConfiguration();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    In secure mode, the test will append keytab and principal option to the on-disk flink-conf.yaml before starting. So using a vanilla Configuration object is actually one of the issues why the current test code is broken.&lt;/p&gt;</comment>
                            <comment id="16404430" author="githubbot" created="Mon, 19 Mar 2018 06:48:02 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175342198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175342198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -379,6 +382,50 @@ public boolean accept(File dir, String name) {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	public static void ensureStringInNamedLogFiles(final String[] mustHave, final String fileName) {&lt;br/&gt;
    +		File cwd = new File(&quot;target/&quot; + YARN_CONFIGURATION.get(TEST_CLUSTER_NAME_KEY));&lt;br/&gt;
    +		Assert.assertTrue(&quot;Expecting directory &quot; + cwd.getAbsolutePath() + &quot; to exist&quot;, cwd.exists());&lt;br/&gt;
    +		Assert.assertTrue(&lt;br/&gt;
    +				&quot;Expecting directory &quot; + cwd.getAbsolutePath() + &quot; to be a directory&quot;, cwd.isDirectory());&lt;br/&gt;
    +&lt;br/&gt;
    +		File foundFile = findFile(cwd.getAbsolutePath(), new FilenameFilter() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public boolean accept(File dir, String name) {&lt;br/&gt;
    +				if (fileName != null &amp;amp;&amp;amp; !name.equals(fileName)) &lt;/p&gt;
{
    +					return false;
    +				}
&lt;p&gt;    +				File f = new File(dir.getAbsolutePath() + &quot;/&quot; + name);&lt;br/&gt;
    +				LOG.info(&quot;Searching in {}&quot;, f.getAbsolutePath());&lt;br/&gt;
    +				try {&lt;br/&gt;
    +					Set&amp;lt;String&amp;gt; foundSet = new HashSet&amp;lt;String&amp;gt;(mustHave.length);&lt;br/&gt;
    +					Scanner scanner = new Scanner(f);&lt;br/&gt;
    +					while (scanner.hasNextLine()) {&lt;br/&gt;
    +						final String lineFromFile = scanner.nextLine();&lt;br/&gt;
    +						for (String str : mustHave) {&lt;br/&gt;
    +							if (lineFromFile.contains(str)) &lt;/p&gt;
{
    +								foundSet.add(str);
    +							}
&lt;p&gt;    +						}&lt;br/&gt;
    +						if (foundSet.containsAll(Arrays.asList(mustHave))) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16404439" author="githubbot" created="Mon, 19 Mar 2018 07:24:05 +0000"  >&lt;p&gt;Github user suez1224 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks a lot, @tillrohrmann, for looking into the PR. I&apos;ve rebased and addressed your comment. Please take another look.&lt;/p&gt;</comment>
                            <comment id="16404486" author="githubbot" created="Mon, 19 Mar 2018 08:23:13 +0000"  >&lt;p&gt;Github user suez1224 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Also, I&apos;ve disabled the test for flip6 mode in order to make the test pass. Can you explain a bit on why this code block (&lt;a href=&quot;https://github.com/apache/flink/blob/25ac971d39e0ed58965334a6735396d5d10e7278/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java#L102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/25ac971d39e0ed58965334a6735396d5d10e7278/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java#L102&lt;/a&gt;) is disabled in flip6 mode? I can create another JIRA to address the issue in flip6 mode.&lt;/p&gt;</comment>
                            <comment id="16404987" author="githubbot" created="Mon, 19 Mar 2018 15:37:19 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175480192&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175480192&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -105,7 +105,7 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		//additional sleep for the JM/TM to start and establish connection&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sleep(2000);&lt;br/&gt;
    +		sleep(3000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Hmm is this timeout increase not a little bit arbitrary. Can we implement some better waiting strategy? Like waiting for the respective log statement, for example.&lt;/p&gt;</comment>
                            <comment id="16404988" author="githubbot" created="Mon, 19 Mar 2018 15:37:59 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175480428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175480428&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOSecuredITCase.java &amp;#8212;&lt;br/&gt;
    @@ -97,6 +98,15 @@ public static void teardownSecureCluster() throws Exception &lt;/p&gt;
{
     		SecureTestEnvironment.cleanup();
     	}

&lt;p&gt;    +	@Override&lt;br/&gt;
    +	public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
    +		super.testDetachedMode();&lt;br/&gt;
    +		ensureStringInNamedLogFiles(new String[]&lt;/p&gt;
{&quot;Login successful for user&quot;, &quot;using keytab file&quot;}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Thanks for the pointer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16405000" author="githubbot" created="Mon, 19 Mar 2018 15:46:17 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175483617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175483617&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -206,7 +209,7 @@ public void checkClusterEmpty() throws IOException, YarnException {&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfiguration = new org.apache.flink.configuration.Configuration();&lt;br/&gt;
    +		flinkConfiguration = GlobalConfiguration.loadConfiguration();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can&apos;t we read the vanilla configuration in `YarnTestBase#start:474` then configure the keytab and the principal and write this `Configuration` out via `BootstrapTool#writeConfiguration`? We could then simply set `flinkConfiguration` to this `Configuration`. What do you think?&lt;/p&gt;</comment>
                            <comment id="16405002" author="githubbot" created="Mon, 19 Mar 2018 15:47:45 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The problem is @suez1224 that in Flip-6 mode we won&apos;t allocate 2 containers if there is no job submitted. Thus, we would have to wait for a different signal in Flip-6 mode.&lt;/p&gt;</comment>
                            <comment id="16405908" author="githubbot" created="Tue, 20 Mar 2018 07:23:01 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175672004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175672004&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -206,7 +209,7 @@ public void checkClusterEmpty() throws IOException, YarnException {&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfiguration = new org.apache.flink.configuration.Configuration();&lt;br/&gt;
    +		flinkConfiguration = GlobalConfiguration.loadConfiguration();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Done, please take another look.&lt;/p&gt;</comment>
                            <comment id="16405909" author="githubbot" created="Tue, 20 Mar 2018 07:24:36 +0000"  >&lt;p&gt;Github user suez1224 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann what signal should I wait for? I can address the flip6 mode test in the end-to--end test JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8981&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-8981&lt;/a&gt;. What do you think?&lt;/p&gt;</comment>
                            <comment id="16405928" author="githubbot" created="Tue, 20 Mar 2018 07:54:58 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175677410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175677410&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -105,7 +105,7 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		//additional sleep for the JM/TM to start and establish connection&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sleep(2000);&lt;br/&gt;
    +		sleep(3000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Hmm, waiting for the log statement might be problematic, because if the job can not start due to other issues, then there will be no log files and the wait can be forever. &lt;/p&gt;</comment>
                            <comment id="16406023" author="githubbot" created="Tue, 20 Mar 2018 09:40:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175702568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175702568&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -105,7 +105,7 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		//additional sleep for the JM/TM to start and establish connection&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sleep(2000);&lt;br/&gt;
    +		sleep(3000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    For that we should have a timeout. If the timeout is triggered, then the test should fail.&lt;/p&gt;

&lt;p&gt;    A simplest approach would be to periodically check for this condition until you&apos;ve exceeded the timeout time.&lt;/p&gt;</comment>
                            <comment id="16406034" author="githubbot" created="Tue, 20 Mar 2018 09:44:03 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @suez1224 one could maybe probe the Flip-6 REST endpoint to wait until it is available and one can retrieve the `address:port/overview`. The overview should only be available after the `Dispatcher` has successfully established a connection with the RM.&lt;/p&gt;</comment>
                            <comment id="16406036" author="githubbot" created="Tue, 20 Mar 2018 09:45:16 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175704082&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175704082&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -515,28 +514,23 @@ private static void start(YarnConfiguration conf, String principal, String keyta&lt;/p&gt;

&lt;p&gt;     			File flinkConfDirPath = findFile(flinkDistRootDir, new ContainsName(new String[]&lt;/p&gt;
{&quot;flink-conf.yaml&quot;}
&lt;p&gt;));&lt;br/&gt;
     			Assert.assertNotNull(flinkConfDirPath);&lt;br/&gt;
    +			org.apache.flink.configuration.Configuration flinkCfg =&lt;br/&gt;
    +					new org.apache.flink.configuration.Configuration();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think we should read in the flink configuration stored under `flinkConfDirPath` instead of creating an empty one.&lt;/p&gt;</comment>
                            <comment id="16406038" author="githubbot" created="Tue, 20 Mar 2018 09:46:28 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r175704459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r175704459&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -465,27 +514,23 @@ private static void start(YarnConfiguration conf, String principal, String keyta&lt;/p&gt;

&lt;p&gt;     			File flinkConfDirPath = findFile(flinkDistRootDir, new ContainsName(new String[]&lt;/p&gt;
{&quot;flink-conf.yaml&quot;}
&lt;p&gt;));&lt;br/&gt;
     			Assert.assertNotNull(flinkConfDirPath);&lt;br/&gt;
    +			org.apache.flink.configuration.Configuration flinkCfg =&lt;br/&gt;
    +					new org.apache.flink.configuration.Configuration();&lt;/p&gt;

&lt;p&gt;     			if (!StringUtils.isBlank(principal) &amp;amp;&amp;amp; !StringUtils.isBlank(keytab)) {&lt;br/&gt;
    +&lt;br/&gt;
     				//copy conf dir to test temporary workspace location&lt;br/&gt;
     				tempConfPathForSecureRun = tmp.newFolder(&quot;conf&quot;);&lt;/p&gt;

&lt;p&gt;     				String confDirPath = flinkConfDirPath.getParentFile().getAbsolutePath();&lt;br/&gt;
     				FileUtils.copyDirectory(new File(confDirPath), tempConfPathForSecureRun);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (FileWriter fw = new FileWriter(new File(tempConfPathForSecureRun, &quot;flink-conf.yaml&quot;), true);&lt;/li&gt;
	&lt;li&gt;BufferedWriter bw = new BufferedWriter(fw);&lt;/li&gt;
	&lt;li&gt;PrintWriter out = new PrintWriter(bw)) 
{
    -
    -					LOG.info(&quot;writing keytab: &quot; + keytab + &quot; and principal: &quot; + principal + &quot; to config file&quot;);
    -					out.println(&quot;&quot;);
    -					out.println(&quot;#Security Configurations Auto Populated &quot;);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key() + &quot;: &quot; + keytab);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key() + &quot;: &quot; + principal);
    -					out.println(&quot;&quot;);
    -				}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    -					throw new RuntimeException(&quot;Exception occured while trying to append the security configurations.&quot;, e);
    -				}
&lt;p&gt;    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key(), keytab);&lt;br/&gt;
    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key(), principal);&lt;br/&gt;
    +				flinkCfg.setString(CoreOptions.MODE.key(), OLD_MODE);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we should assign the `Configuration` to `flinkConfiguration`, then we don&apos;t have to read it in from disk again.&lt;/p&gt;</comment>
                            <comment id="16408457" author="githubbot" created="Wed, 21 Mar 2018 19:23:47 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176209172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176209172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -465,27 +514,23 @@ private static void start(YarnConfiguration conf, String principal, String keyta&lt;/p&gt;

&lt;p&gt;     			File flinkConfDirPath = findFile(flinkDistRootDir, new ContainsName(new String[]&lt;/p&gt;
{&quot;flink-conf.yaml&quot;}
&lt;p&gt;));&lt;br/&gt;
     			Assert.assertNotNull(flinkConfDirPath);&lt;br/&gt;
    +			org.apache.flink.configuration.Configuration flinkCfg =&lt;br/&gt;
    +					new org.apache.flink.configuration.Configuration();&lt;/p&gt;

&lt;p&gt;     			if (!StringUtils.isBlank(principal) &amp;amp;&amp;amp; !StringUtils.isBlank(keytab)) {&lt;br/&gt;
    +&lt;br/&gt;
     				//copy conf dir to test temporary workspace location&lt;br/&gt;
     				tempConfPathForSecureRun = tmp.newFolder(&quot;conf&quot;);&lt;/p&gt;

&lt;p&gt;     				String confDirPath = flinkConfDirPath.getParentFile().getAbsolutePath();&lt;br/&gt;
     				FileUtils.copyDirectory(new File(confDirPath), tempConfPathForSecureRun);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (FileWriter fw = new FileWriter(new File(tempConfPathForSecureRun, &quot;flink-conf.yaml&quot;), true);&lt;/li&gt;
	&lt;li&gt;BufferedWriter bw = new BufferedWriter(fw);&lt;/li&gt;
	&lt;li&gt;PrintWriter out = new PrintWriter(bw)) 
{
    -
    -					LOG.info(&quot;writing keytab: &quot; + keytab + &quot; and principal: &quot; + principal + &quot; to config file&quot;);
    -					out.println(&quot;&quot;);
    -					out.println(&quot;#Security Configurations Auto Populated &quot;);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key() + &quot;: &quot; + keytab);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key() + &quot;: &quot; + principal);
    -					out.println(&quot;&quot;);
    -				}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    -					throw new RuntimeException(&quot;Exception occured while trying to append the security configurations.&quot;, e);
    -				}
&lt;p&gt;    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key(), keytab);&lt;br/&gt;
    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key(), principal);&lt;br/&gt;
    +				flinkCfg.setString(CoreOptions.MODE.key(), OLD_MODE);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    flinkConfiguration is instance variable and the method here is static.&lt;/p&gt;</comment>
                            <comment id="16408458" author="githubbot" created="Wed, 21 Mar 2018 19:23:55 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176209223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176209223&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -515,28 +514,23 @@ private static void start(YarnConfiguration conf, String principal, String keyta&lt;/p&gt;

&lt;p&gt;     			File flinkConfDirPath = findFile(flinkDistRootDir, new ContainsName(new String[]&lt;/p&gt;
{&quot;flink-conf.yaml&quot;}
&lt;p&gt;));&lt;br/&gt;
     			Assert.assertNotNull(flinkConfDirPath);&lt;br/&gt;
    +			org.apache.flink.configuration.Configuration flinkCfg =&lt;br/&gt;
    +					new org.apache.flink.configuration.Configuration();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16408459" author="githubbot" created="Wed, 21 Mar 2018 19:24:30 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176209369&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176209369&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -105,7 +105,7 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		//additional sleep for the JM/TM to start and establish connection&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sleep(2000);&lt;br/&gt;
    +		sleep(3000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good idea. Address your comment. Please take another look&lt;/p&gt;</comment>
                            <comment id="16408479" author="githubbot" created="Wed, 21 Mar 2018 19:44:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176214419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176214419&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -106,8 +106,16 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;//additional sleep for the JM/TM to start and establish connection&lt;/li&gt;
	&lt;li&gt;sleep(3000);&lt;br/&gt;
    +		// additional sleep for the JM/TM to start and establish connection&lt;br/&gt;
    +		long startTime = System.currentTimeMillis();&lt;br/&gt;
    +		while (System.currentTimeMillis() - startTime &amp;lt; 10000 &amp;amp;&amp;amp;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Let&apos;s use `System.nanoTime` for the deadline. `nanoTime` is not susceptible to clock shifts.&lt;/p&gt;</comment>
                            <comment id="16408480" author="githubbot" created="Wed, 21 Mar 2018 19:45:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176215020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176215020&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -465,27 +514,23 @@ private static void start(YarnConfiguration conf, String principal, String keyta&lt;/p&gt;

&lt;p&gt;     			File flinkConfDirPath = findFile(flinkDistRootDir, new ContainsName(new String[]&lt;/p&gt;
{&quot;flink-conf.yaml&quot;}
&lt;p&gt;));&lt;br/&gt;
     			Assert.assertNotNull(flinkConfDirPath);&lt;br/&gt;
    +			org.apache.flink.configuration.Configuration flinkCfg =&lt;br/&gt;
    +					new org.apache.flink.configuration.Configuration();&lt;/p&gt;

&lt;p&gt;     			if (!StringUtils.isBlank(principal) &amp;amp;&amp;amp; !StringUtils.isBlank(keytab)) {&lt;br/&gt;
    +&lt;br/&gt;
     				//copy conf dir to test temporary workspace location&lt;br/&gt;
     				tempConfPathForSecureRun = tmp.newFolder(&quot;conf&quot;);&lt;/p&gt;

&lt;p&gt;     				String confDirPath = flinkConfDirPath.getParentFile().getAbsolutePath();&lt;br/&gt;
     				FileUtils.copyDirectory(new File(confDirPath), tempConfPathForSecureRun);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (FileWriter fw = new FileWriter(new File(tempConfPathForSecureRun, &quot;flink-conf.yaml&quot;), true);&lt;/li&gt;
	&lt;li&gt;BufferedWriter bw = new BufferedWriter(fw);&lt;/li&gt;
	&lt;li&gt;PrintWriter out = new PrintWriter(bw)) 
{
    -
    -					LOG.info(&quot;writing keytab: &quot; + keytab + &quot; and principal: &quot; + principal + &quot; to config file&quot;);
    -					out.println(&quot;&quot;);
    -					out.println(&quot;#Security Configurations Auto Populated &quot;);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key() + &quot;: &quot; + keytab);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key() + &quot;: &quot; + principal);
    -					out.println(&quot;&quot;);
    -				}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    -					throw new RuntimeException(&quot;Exception occured while trying to append the security configurations.&quot;, e);
    -				}
&lt;p&gt;    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key(), keytab);&lt;br/&gt;
    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key(), principal);&lt;br/&gt;
    +				flinkCfg.setString(CoreOptions.MODE.key(), OLD_MODE);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Then let&apos;s store `flinkCfg` as a static variable and use it to create a new one&lt;br/&gt;
    `flinkConfiguration = new Configuration(flinkCfg)`&lt;/p&gt;</comment>
                            <comment id="16408549" author="githubbot" created="Wed, 21 Mar 2018 20:40:10 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176230467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176230467&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java &amp;#8212;&lt;br/&gt;
    @@ -106,8 +106,16 @@ public void testDetachedMode() throws InterruptedException, IOException {&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;//additional sleep for the JM/TM to start and establish connection&lt;/li&gt;
	&lt;li&gt;sleep(3000);&lt;br/&gt;
    +		// additional sleep for the JM/TM to start and establish connection&lt;br/&gt;
    +		long startTime = System.currentTimeMillis();&lt;br/&gt;
    +		while (System.currentTimeMillis() - startTime &amp;lt; 10000 &amp;amp;&amp;amp;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16408556" author="githubbot" created="Wed, 21 Mar 2018 20:44:34 +0000"  >&lt;p&gt;Github user suez1224 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416#discussion_r176231789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416#discussion_r176231789&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -465,27 +514,23 @@ private static void start(YarnConfiguration conf, String principal, String keyta&lt;/p&gt;

&lt;p&gt;     			File flinkConfDirPath = findFile(flinkDistRootDir, new ContainsName(new String[]&lt;/p&gt;
{&quot;flink-conf.yaml&quot;}
&lt;p&gt;));&lt;br/&gt;
     			Assert.assertNotNull(flinkConfDirPath);&lt;br/&gt;
    +			org.apache.flink.configuration.Configuration flinkCfg =&lt;br/&gt;
    +					new org.apache.flink.configuration.Configuration();&lt;/p&gt;

&lt;p&gt;     			if (!StringUtils.isBlank(principal) &amp;amp;&amp;amp; !StringUtils.isBlank(keytab)) {&lt;br/&gt;
    +&lt;br/&gt;
     				//copy conf dir to test temporary workspace location&lt;br/&gt;
     				tempConfPathForSecureRun = tmp.newFolder(&quot;conf&quot;);&lt;/p&gt;

&lt;p&gt;     				String confDirPath = flinkConfDirPath.getParentFile().getAbsolutePath();&lt;br/&gt;
     				FileUtils.copyDirectory(new File(confDirPath), tempConfPathForSecureRun);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (FileWriter fw = new FileWriter(new File(tempConfPathForSecureRun, &quot;flink-conf.yaml&quot;), true);&lt;/li&gt;
	&lt;li&gt;BufferedWriter bw = new BufferedWriter(fw);&lt;/li&gt;
	&lt;li&gt;PrintWriter out = new PrintWriter(bw)) 
{
    -
    -					LOG.info(&quot;writing keytab: &quot; + keytab + &quot; and principal: &quot; + principal + &quot; to config file&quot;);
    -					out.println(&quot;&quot;);
    -					out.println(&quot;#Security Configurations Auto Populated &quot;);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key() + &quot;: &quot; + keytab);
    -					out.println(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key() + &quot;: &quot; + principal);
    -					out.println(&quot;&quot;);
    -				}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    -					throw new RuntimeException(&quot;Exception occured while trying to append the security configurations.&quot;, e);
    -				}
&lt;p&gt;    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_KEYTAB.key(), keytab);&lt;br/&gt;
    +				flinkCfg.setString(SecurityOptions.KERBEROS_LOGIN_PRINCIPAL.key(), principal);&lt;br/&gt;
    +				flinkCfg.setString(CoreOptions.MODE.key(), OLD_MODE);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I make flinkConfiguration static. It&apos;s confusing to keep 2 flinkcfg, one static and one instance var.&lt;/p&gt;</comment>
                            <comment id="16408566" author="githubbot" created="Wed, 21 Mar 2018 20:50:24 +0000"  >&lt;p&gt;Github user suez1224 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann addressed your comments. PTAL.&lt;/p&gt;</comment>
                            <comment id="16409948" author="till.rohrmann" created="Thu, 22 Mar 2018 17:34:11 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master:&lt;br/&gt;
37a114875afb9352e6f7b10e2729a94d0eeb72ee&lt;br/&gt;
b550ac67fbf525863d5812d9d2a1010672a0169b&lt;/p&gt;

&lt;p&gt;1.5.0:&lt;br/&gt;
4b66514f2c31d5ea29493baf9d022a0115faf82d&lt;br/&gt;
9c105f2c982e511bc1274a86d629e7fa26cf7ac8&lt;/p&gt;</comment>
                            <comment id="16409949" author="githubbot" created="Thu, 22 Mar 2018 17:34:14 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5416&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ptxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>