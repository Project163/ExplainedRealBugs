<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20552] JdbcDynamicTableSink doesn&apos;t sink buffered data on checkpoint</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20552</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;JdbcBatchingOutputFormat  is wrapped to OutputFormatSinkFunction``` when createSinkTransformation at CommonPhysicalSink class. but OutputFormatSinkFunction don&apos;t implement CheckpointedFunction interface, so the flush method of JdbcBatchingOutputFormat can&apos;t be called  when checkpoint&lt;/p&gt;</description>
                <environment></environment>
        <key id="13345191">FLINK-20552</key>
            <summary>JdbcDynamicTableSink doesn&apos;t sink buffered data on checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="meijies">Jeremy Mei</assignee>
                                    <reporter username="meijies">Jeremy Mei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>starter</label>
                    </labels>
                <created>Thu, 10 Dec 2020 03:56:03 +0000</created>
                <updated>Fri, 25 Dec 2020 02:21:15 +0000</updated>
                            <resolved>Fri, 25 Dec 2020 02:21:15 +0000</resolved>
                                                    <fixVersion>1.13.0</fixVersion>
                                    <component>Connectors / JDBC</component>
                    <component>Table SQL / Ecosystem</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17246999" author="zhushang" created="Thu, 10 Dec 2020 04:04:53 +0000"  >&lt;p&gt;Maybe&#160;OutputFormatSinkFunction should implements&#160;CheckpointedFunction&lt;/p&gt;</comment>
                            <comment id="17247002" author="leonard xu" created="Thu, 10 Dec 2020 04:15:53 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=meijies&quot; class=&quot;user-hover&quot; rel=&quot;meijies&quot;&gt;meijies&lt;/a&gt;&#160;&lt;br/&gt;
 Thanks for the report&#65292; A simple way to fix this is wrapping the `JdbcBatchingOutputFormat` with `GenericJdbcSinkFunction` &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/table/JdbcDynamicTableSink.java#L87%C2%A0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; OutputFormatProvider.of(builder.build());
=&amp;gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; SinkFunctionProvider.of(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericJdbcSinkFunction&amp;lt;&amp;gt;(builder.build()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And we can add a test for this change,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=meijies&quot; class=&quot;user-hover&quot; rel=&quot;meijies&quot;&gt;meijies&lt;/a&gt;&#160;Do you like to help fix this ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17247031" author="meijies" created="Thu, 10 Dec 2020 05:47:44 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will fix this by the method you mentioned&lt;/p&gt;</comment>
                            <comment id="17247034" author="jark" created="Thu, 10 Dec 2020 05:54:01 +0000"  >&lt;p&gt;+1 to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&apos;s proposal.&lt;/p&gt;

&lt;p&gt;We should also add a proper testing for this.  An easier way to test this is using &lt;tt&gt;OneInputStreamOperatorTestHarness&lt;/tt&gt;. &lt;br/&gt;
You can have a look at the &lt;tt&gt;GroupAggregateHarnessTest#testAggregateWithRetraction&lt;/tt&gt; about how to create an operator harness by using SQL. And have a look at &lt;tt&gt;RowTimeDeduplicateFunctionTest#testRowTimeDeduplicateKeepLastRow(boolean, boolean, java.util.List&amp;lt;java.lang.Object&amp;gt;)&lt;/tt&gt; about how to snapshot and restore. &lt;/p&gt;</comment>
                            <comment id="17251536" author="jark" created="Fri, 18 Dec 2020 06:18:10 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=meijies&quot; class=&quot;user-hover&quot; rel=&quot;meijies&quot;&gt;meijies&lt;/a&gt;, are you still working on this? &lt;/p&gt;</comment>
                            <comment id="17251912" author="meijies" created="Fri, 18 Dec 2020 17:35:07 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;br/&gt;
Too busy these days, I will  fix this at this weekend.&lt;/p&gt;</comment>
                            <comment id="17252218" author="meijies" created="Sat, 19 Dec 2020 16:50:49 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It seems unable to create SinkOperator by using insert into sql. I have tryied to triger source operator do snapshot, but the snapshot function of sink operator didn&apos;t be trigered.  Do you haven any other ideas ?&lt;/p&gt;
</comment>
                            <comment id="17252590" author="jark" created="Mon, 21 Dec 2020 03:33:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=meijies&quot; class=&quot;user-hover&quot; rel=&quot;meijies&quot;&gt;meijies&lt;/a&gt;, how did you create SinkOperator? &lt;/p&gt;</comment>
                            <comment id="17252928" author="meijies" created="Mon, 21 Dec 2020 15:43:28 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;br/&gt;
Here is my test code, it seems unable create SinkOperator from TableResult. so i think maybe try to use JdbcDynamicTableSink to create SinkOperator. Look forward your advices, I will try it again tomorrow night.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
		StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
		List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LinkedList&amp;lt;&amp;gt;();
		data.add(1l);
		data.add(2l);
		DataStream&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; stream = env.fromCollection(data);

&lt;span class=&quot;code-comment&quot;&gt;//		Transformation&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; transformation = stream.getTransformation();
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//		StreamSource&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, ?&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; = ((LegacySourceTransformation&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;) transformation).getOperator();
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//		&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.setup(
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//			&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SourceOperatorStreamTask&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;(SourceOperatorStateContextUtil.getTestingEnvironment()),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//			&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MockStreamConfig(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration(), 1),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//			&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MockOutput&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;()));
&lt;/span&gt;
		StreamTableEnvironment tEnv = StreamTableEnvironment.create(env);
		Table t = tEnv.fromDataStream(stream, $(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;));
		tEnv.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;data_table&quot;&lt;/span&gt;, t);

		tEnv.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE checkpoint_sink (\n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot; id BIGINT\n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot;) WITH (\n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;url&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + DB_URL + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;table-name&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + OUTPUT_TABLE5 + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.buffer-flush.interval&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;\n&quot;&lt;/span&gt; + &lt;span class=&quot;code-comment&quot;&gt;// disable async flush
&lt;/span&gt;			&lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;);

		tEnv.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO checkpoint_sink \n&quot;&lt;/span&gt; +
			&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT id from data_table&quot;&lt;/span&gt;);


&lt;span class=&quot;code-comment&quot;&gt;//		&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.initializeState(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamTaskStateInitializerImpl(
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//			SourceOperatorStateContextUtil.getTestingEnvironment(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MemoryStateBackend()));
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//		&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.snapshotState(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StateSnapshotContextSynchronousImpl(100L, 100L));
&lt;/span&gt;
		check(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Row[]{Row.of(1l), Row.of(2l)}, DB_URL, OUTPUT_TABLE5, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17253272" author="jark" created="Tue, 22 Dec 2020 04:29:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=meijies&quot; class=&quot;user-hover&quot; rel=&quot;meijies&quot;&gt;meijies&lt;/a&gt;, yes, I also find it&apos;s not easy to get SinkOperator from the SQL. I think you can try to use JdbcDynamicTableSink. &lt;/p&gt;</comment>
                            <comment id="17254704" author="jark" created="Fri, 25 Dec 2020 02:21:15 +0000"  >&lt;p&gt;Fixed in master: 21a08ea5696c92505f85f3cba0e47e32d7c1e21d&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0lde0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>