<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10770] Some generated functions are not opened properly.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10770</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Recently I found sometimes UDFs are not open properly. It turns out when transforming sql to execution plan, some generated functions&apos; &lt;b&gt;open&lt;/b&gt; method are not called. e.g. &lt;b&gt;NonWindowJoin&lt;/b&gt;, &lt;b&gt;TimeBoundedStreamJoin&lt;/b&gt;, &lt;b&gt;FlatJoinRunner&lt;/b&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13196047">FLINK-10770</key>
            <summary>Some generated functions are not opened properly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wangsan">jrthe42</assignee>
                                    <reporter username="wangsan">jrthe42</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 3 Nov 2018 11:19:47 +0000</created>
                <updated>Thu, 8 Nov 2018 10:27:11 +0000</updated>
                            <resolved>Thu, 8 Nov 2018 10:27:11 +0000</resolved>
                                    <version>1.6.2</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16674050" author="githubbot" created="Sat, 3 Nov 2018 13:38:00 +0000"  >&lt;p&gt;jrthe42 opened a new pull request #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;br/&gt;
   When transforming sql to execution plan, some generated functions&apos; `open` method are not called., this may cause exception if the UDFs need be opened. This PR fix this issue.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Call `open` method after generated functions are complied and instantiated.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;br/&gt;
   This change added tests and can be verified as follows:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.flink.table.runtime.stream.table.UdfITCase&lt;/li&gt;
	&lt;li&gt;org.apache.flink.table.runtime.batch.table.UdfITCase&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not&lt;/b&gt;* applicable / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16677883" author="githubbot" created="Wed, 7 Nov 2018 09:15:06 +0000"  >&lt;p&gt;jrthe42 commented on issue #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014#issuecomment-436556496&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014#issuecomment-436556496&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @twalthr @hequn8128 @yanghua Could you please take a look at this PR?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16677918" author="githubbot" created="Wed, 7 Nov 2018 09:39:30 +0000"  >&lt;p&gt;Xpray commented on issue #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014#issuecomment-436563611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014#issuecomment-436563611&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Hi @jrthe42 , Thanks for the contribution. It seems you did not add test case to every generate function you modified,  are all these generate functions be short of initialization? &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16677926" author="githubbot" created="Wed, 7 Nov 2018 09:43:41 +0000"  >&lt;p&gt;Xpray edited a comment on issue #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014#issuecomment-436563611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014#issuecomment-436563611&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Hi @jrthe42 , Thanks for the contribution. It seems you did not add test case to every generate function you modified,  are all these generate functions short of initialization? And it seems some of them will be no UDF inside.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16677948" author="githubbot" created="Wed, 7 Nov 2018 10:03:00 +0000"  >&lt;p&gt;jrthe42 commented on issue #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014#issuecomment-436570733&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014#issuecomment-436570733&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Hi @Xpray, I only add a test case for *&lt;b&gt;NonWindowJoin&lt;/b&gt;*, that is what we meet in our application. I will try to add more test cases later.&lt;/p&gt;

&lt;p&gt;   Even if some generated functions do not have UDF inside, I think it is still better if we call &lt;b&gt;open&lt;/b&gt; and &lt;b&gt;close&lt;/b&gt; method  explicitly. We can cover the full lifecycle of generated functions in this way. What do you think?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16677976" author="githubbot" created="Wed, 7 Nov 2018 10:18:53 +0000"  >&lt;p&gt;Xpray commented on issue #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014#issuecomment-436575363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014#issuecomment-436575363&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    Covering full lifecycle of generated functions looks good to me, but I think we should avoid adding new ItTest file. @hequn8128 what do you think?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16679528" author="githubbot" created="Thu, 8 Nov 2018 09:58:08 +0000"  >&lt;p&gt;asfgit closed pull request #7014: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10770&quot; title=&quot;Some generated functions are not opened properly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10770&quot;&gt;&lt;del&gt;FLINK-10770&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Table &amp;amp; SQL&amp;#93;&lt;/span&gt; Some generated functions are not opened properly.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7014&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowMapRunner.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowMapRunner.scala&lt;br/&gt;
index 54bac601bcc..cb451b92cd7 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowMapRunner.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowMapRunner.scala&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;/p&gt;

&lt;p&gt; package org.apache.flink.table.runtime&lt;/p&gt;

&lt;p&gt;+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.functions.&lt;/p&gt;
{MapFunction, RichMapFunction}&lt;br/&gt;
 import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable&lt;br/&gt;
@@ -46,6 +47,8 @@ class CRowMapRunner&lt;span class=&quot;error&quot;&gt;&amp;#91;OUT&amp;#93;&lt;/span&gt;(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating MapFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, parameters)&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
   override def map(in: CRow): OUT = {
@@ -53,4 +56,8 @@ class CRowMapRunner[OUT](
   }&lt;br/&gt;
 &lt;br/&gt;
   override def getProducedType: TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;OUT&amp;#93;&lt;/span&gt; = returnType&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = {
+    FunctionUtils.closeFunction(function)
+  }&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowOutputProcessRunner.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowOutputProcessRunner.scala&lt;br/&gt;
index 600b8987a28..ebef577ff83 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowOutputProcessRunner.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/CRowOutputProcessRunner.scala&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 &lt;br/&gt;
 package org.apache.flink.table.runtime&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable&lt;br/&gt;
 import org.apache.flink.configuration.Configuration&lt;br/&gt;
@@ -49,6 +50,8 @@ class CRowOutputProcessRunner(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating ProcessFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, parameters)&lt;br/&gt;
 &lt;br/&gt;
     this.cRowWrapper = new CRowWrappingCollector()&lt;br/&gt;
     this.cRowWrapper.setChange(true)&lt;br/&gt;
@@ -68,4 +71,8 @@ class CRowOutputProcessRunner(&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
   override def getProducedType: TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;CRow&amp;#93;&lt;/span&gt; = returnType&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = {+    FunctionUtils.closeFunction(function)+  }&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/FlatJoinRunner.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/FlatJoinRunner.scala&lt;br/&gt;
index 0bf65694367..26ed962e01a 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/FlatJoinRunner.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/FlatJoinRunner.scala&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 &lt;br/&gt;
 package org.apache.flink.table.runtime&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.functions.{FlatJoinFunction, RichFlatJoinFunction}&lt;br/&gt;
 import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable&lt;br/&gt;
@@ -42,10 +43,16 @@ class FlatJoinRunner&lt;span class=&quot;error&quot;&gt;&amp;#91;IN1, IN2, OUT&amp;#93;&lt;/span&gt;(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating FlatJoinFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, parameters)&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
   override def join(first: IN1, second: IN2, out: Collector&lt;span class=&quot;error&quot;&gt;&amp;#91;OUT&amp;#93;&lt;/span&gt;): Unit =&lt;br/&gt;
     function.join(first, second, out)&lt;br/&gt;
 &lt;br/&gt;
   override def getProducedType: TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;OUT&amp;#93;&lt;/span&gt; = returnType&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = {
+    FunctionUtils.closeFunction(function)
+  }&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapRunner.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapRunner.scala&lt;br/&gt;
index 00d18ecc007..7f56ffe72cc 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapRunner.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapRunner.scala&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 &lt;br/&gt;
 package org.apache.flink.table.runtime&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.functions.{MapFunction, RichMapFunction}
&lt;p&gt; import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable&lt;br/&gt;
@@ -41,10 +42,16 @@ class MapRunner&lt;span class=&quot;error&quot;&gt;&amp;#91;IN, OUT&amp;#93;&lt;/span&gt;(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating MapFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, parameters)&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   override def map(in: IN): OUT =&lt;br/&gt;
     function.map(in)&lt;/p&gt;

&lt;p&gt;   override def getProducedType: TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;OUT&amp;#93;&lt;/span&gt; = returnType&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = &lt;/p&gt;
{
+    FunctionUtils.closeFunction(function)
+  }&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapSideJoinRunner.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapSideJoinRunner.scala&lt;br/&gt;
index 5f5a2cc4a19..f15aaa6432e 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapSideJoinRunner.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/MapSideJoinRunner.scala&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 &lt;br/&gt;
 package org.apache.flink.table.runtime&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.functions.{FlatJoinFunction, RichFlatMapFunction}&lt;br/&gt;
 import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable&lt;br/&gt;
@@ -43,6 +44,8 @@ abstract class MapSideJoinRunner&lt;span class=&quot;error&quot;&gt;&amp;#91;IN1, IN2, SINGLE_IN, MULTI_IN, OUT&amp;#93;&lt;/span&gt;(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating FlatJoinFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, parameters)&lt;br/&gt;
     broadcastSet = retrieveBroadcastSet&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
@@ -56,4 +59,8 @@ abstract class MapSideJoinRunner&lt;span class=&quot;error&quot;&gt;&amp;#91;IN1, IN2, SINGLE_IN, MULTI_IN, OUT&amp;#93;&lt;/span&gt;(&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
   override def getProducedType: TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;OUT&amp;#93;&lt;/span&gt; = returnType&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = {+    FunctionUtils.closeFunction(function)+  }
&lt;p&gt; }&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/NonWindowJoin.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/NonWindowJoin.scala&lt;br/&gt;
index 0fe2e39c3a7..1463e7022c7 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/NonWindowJoin.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/NonWindowJoin.scala&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 package org.apache.flink.table.runtime.join&lt;/p&gt;

&lt;p&gt; import org.apache.flink.api.common.functions.FlatJoinFunction&lt;br/&gt;
+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.state.&lt;/p&gt;
{MapState, MapStateDescriptor, ValueState, ValueStateDescriptor}
&lt;p&gt; import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.tuple.&lt;/p&gt;
{Tuple2 =&amp;gt; JTuple2}
&lt;p&gt;@@ -85,6 +86,8 @@ abstract class NonWindowJoin(&lt;br/&gt;
       genJoinFuncCode)&lt;/p&gt;

&lt;p&gt;     joinFunction = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(joinFunction, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(joinFunction, parameters)&lt;/p&gt;

&lt;p&gt;     // initialize left and right state, the first element of tuple2 indicates how many rows of&lt;br/&gt;
     // this row, while the second element represents the expired time of this row.&lt;br/&gt;
@@ -291,4 +294,8 @@ abstract class NonWindowJoin(&lt;br/&gt;
       joinFunction.join(otherSideRow, inputRow, cRowWrapper)&lt;br/&gt;
     }&lt;br/&gt;
   }&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = &lt;/p&gt;
{
+    FunctionUtils.closeFunction(joinFunction)
+  }&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/TimeBoundedStreamJoin.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/TimeBoundedStreamJoin.scala&lt;br/&gt;
index a44bdef2e09..1bdfcb5be0f 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/TimeBoundedStreamJoin.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/join/TimeBoundedStreamJoin.scala&lt;br/&gt;
@@ -22,6 +22,7 @@ import java.util&lt;br/&gt;
 import java.util.{List =&amp;gt; JList}&lt;br/&gt;
 &lt;br/&gt;
 import org.apache.flink.api.common.functions.FlatJoinFunction&lt;br/&gt;
+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.state._&lt;br/&gt;
 import org.apache.flink.api.common.typeinfo.{BasicTypeInfo, TypeInformation}&lt;br/&gt;
 import org.apache.flink.api.java.operators.join.JoinType&lt;br/&gt;
@@ -110,6 +111,8 @@ abstract class TimeBoundedStreamJoin(&lt;br/&gt;
       genJoinFuncCode)&lt;br/&gt;
     LOG.debug(&quot;Instantiating JoinFunction.&quot;)&lt;br/&gt;
     joinFunction = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(joinFunction, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(joinFunction, config)&lt;br/&gt;
 &lt;br/&gt;
     joinCollector = new EmitAwareCollector()&lt;br/&gt;
     joinCollector.setCRowChange(true)&lt;br/&gt;
@@ -492,6 +495,11 @@ abstract class TimeBoundedStreamJoin(&lt;br/&gt;
     }&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = {+    FunctionUtils.closeFunction(joinFunction)+  }
&lt;p&gt;+&lt;br/&gt;
   /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Update the operator time of the two streams.&lt;/li&gt;
	&lt;li&gt;Must be the first call in all processing methods (i.e., processElement(), onTimer()).&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinGroupReduceRunners.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinGroupReduceRunners.scala&lt;br/&gt;
index 9b0f08ea4a1..23ad51a0eff 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinGroupReduceRunners.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinGroupReduceRunners.scala&lt;br/&gt;
@@ -19,6 +19,7 @@ package org.apache.flink.table.runtime&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import java.lang.Iterable&lt;/p&gt;

&lt;p&gt;+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.functions.&lt;/p&gt;
{JoinFunction, RichGroupReduceFunction}
&lt;p&gt; import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.configuration.Configuration&lt;br/&gt;
@@ -41,6 +42,12 @@ abstract class OuterJoinGroupReduceRunner(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating JoinFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, config)&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = &lt;/p&gt;
{
+    FunctionUtils.closeFunction(function)
   }
&lt;p&gt; }&lt;/p&gt;

&lt;p&gt;diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinRunners.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinRunners.scala&lt;br/&gt;
index a9e0211c40f..fd3b46fbf63 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinRunners.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/outerJoinRunners.scala&lt;br/&gt;
@@ -20,6 +20,7 @@ package org.apache.flink.table.runtime&lt;/p&gt;

&lt;p&gt; import java.lang.&lt;/p&gt;
{Boolean =&amp;gt; JBool}

&lt;p&gt;+import org.apache.flink.api.common.functions.util.FunctionUtils&lt;br/&gt;
 import org.apache.flink.api.common.functions.&lt;/p&gt;
{JoinFunction, RichFlatJoinFunction}
&lt;p&gt; import org.apache.flink.api.common.typeinfo.TypeInformation&lt;br/&gt;
 import org.apache.flink.api.java.typeutils.ResultTypeQueryable&lt;br/&gt;
@@ -45,9 +46,15 @@ abstract class OuterJoinRunner(&lt;br/&gt;
     val clazz = compile(getRuntimeContext.getUserCodeClassLoader, name, code)&lt;br/&gt;
     LOG.debug(&quot;Instantiating FlatJoinFunction.&quot;)&lt;br/&gt;
     function = clazz.newInstance()&lt;br/&gt;
+    FunctionUtils.setFunctionRuntimeContext(function, getRuntimeContext)&lt;br/&gt;
+    FunctionUtils.openFunction(function, parameters)&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   override def getProducedType: TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt; = returnType&lt;br/&gt;
+&lt;br/&gt;
+  override def close(): Unit = &lt;/p&gt;
{
+    FunctionUtils.closeFunction(function)
+  }
&lt;p&gt; }&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/table/UdfITCase.scala b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/table/UdfITCase.scala&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..0b9506b7a96&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/table/UdfITCase.scala&lt;br/&gt;
@@ -0,0 +1,72 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.table.runtime.batch.table&lt;br/&gt;
+&lt;br/&gt;
+import scala.collection.mutable&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.api.scala._&lt;br/&gt;
+import org.apache.flink.api.scala.ExecutionEnvironment&lt;br/&gt;
+import org.apache.flink.table.api.scala._&lt;br/&gt;
+import org.apache.flink.table.api.TableEnvironment&lt;br/&gt;
+import org.apache.flink.table.api.scala.concat&lt;br/&gt;
+import org.apache.flink.table.runtime.utils.&lt;/p&gt;
{TableProgramsClusterTestBase}
&lt;p&gt;+import org.apache.flink.table.runtime.utils.TableProgramsTestBase.TableConfigMode&lt;br/&gt;
+import org.apache.flink.test.util.MultipleProgramsTestBase.TestExecutionMode&lt;br/&gt;
+import org.apache.flink.test.util.TestBaseUtils&lt;br/&gt;
+import org.apache.flink.types.Row&lt;br/&gt;
+import org.junit.Test&lt;br/&gt;
+import org.junit.runner.RunWith&lt;br/&gt;
+import org.junit.runners.Parameterized&lt;br/&gt;
+import scala.collection.JavaConverters._&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.table.utils.ScalarFunction0&lt;br/&gt;
+&lt;br/&gt;
+@RunWith(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Parameterized&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+class UdfITCase(&lt;br/&gt;
+    mode: TestExecutionMode,&lt;br/&gt;
+    configMode: TableConfigMode)&lt;br/&gt;
+  extends TableProgramsClusterTestBase(mode, configMode) {&lt;br/&gt;
+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  def testUdfOpen(): Unit = &lt;/p&gt;
{
+    val env: ExecutionEnvironment = ExecutionEnvironment.getExecutionEnvironment
+    val tEnv = TableEnvironment.getTableEnvironment(env, config)
+
+    val data1 = new mutable.MutableList[(Int, String)]
+    data1.+=((1, &quot;Hi1&quot;))
+    data1.+=((2, &quot;Hi2&quot;))
+    data1.+=((3, &quot;Hi3&quot;))
+
+    val data2 = new mutable.MutableList[(Int, String)]
+    data2.+=((1, &quot;Hello1&quot;))
+    data2.+=((2, &quot;Hello2&quot;))
+    data2.+=((3, &quot;Hello3&quot;))
+
+    val t1 = env.fromCollection(data1).toTable(tEnv, &apos;a, &apos;b)
+    val t2 = env.fromCollection(data2).toTable(tEnv, &apos;c, &apos;d)
+
+    val fun0 = new ScalarFunction0
+    val t = t1.join(t2, &apos;a === &apos;c ).select(&apos;a, &apos;b, &apos;d).where(fun0(concat(&apos;b,&apos;d)))
+
+    val results = t.toDataSet[Row].collect()
+    val expected = Seq(&quot;1,Hi1,Hello1&quot;, &quot;2,Hi2,Hello2&quot;, &quot;3,Hi3,Hello3&quot;).mkString(&quot;\n&quot;)
+    TestBaseUtils.compareResultAsText(results.asJava, expected)
+  }
&lt;p&gt;+&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/UdfITCase.scala b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/UdfITCase.scala&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..b1e03e27554&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/UdfITCase.scala&lt;br/&gt;
@@ -0,0 +1,69 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.table.runtime.stream.table&lt;br/&gt;
+&lt;br/&gt;
+import scala.collection.mutable&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.api.scala._&lt;br/&gt;
+import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment&lt;br/&gt;
+import org.apache.flink.table.api.scala._&lt;br/&gt;
+import org.apache.flink.table.api.TableEnvironment&lt;br/&gt;
+import org.apache.flink.table.api.scala.StreamTableEnvironment&lt;br/&gt;
+import org.apache.flink.table.runtime.utils.StreamITCase&lt;br/&gt;
+import org.apache.flink.table.utils.ScalarFunction0&lt;br/&gt;
+import org.apache.flink.test.util.AbstractTestBase&lt;br/&gt;
+import org.apache.flink.types.Row&lt;br/&gt;
+import org.junit.Before&lt;br/&gt;
+import org.junit.Assert._&lt;br/&gt;
+import org.junit.Test&lt;br/&gt;
+&lt;br/&gt;
+class UdfITCase extends AbstractTestBase {&lt;br/&gt;
+  val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment&lt;br/&gt;
+  val tEnv: StreamTableEnvironment = TableEnvironment.getTableEnvironment(env)&lt;br/&gt;
+  @Before&lt;br/&gt;
+  def clear(): Unit = &lt;/p&gt;
{
+    StreamITCase.clear
+  }
&lt;p&gt;+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  def testUdfOpen(): Unit = &lt;/p&gt;
{
+    val data1 = new mutable.MutableList[(Int, String)]
+    data1.+=((1, &quot;Hi1&quot;))
+    data1.+=((2, &quot;Hi2&quot;))
+    data1.+=((3, &quot;Hi3&quot;))
+
+    val data2 = new mutable.MutableList[(Int, String)]
+    data2.+=((1, &quot;Hello1&quot;))
+    data2.+=((2, &quot;Hello2&quot;))
+    data2.+=((3, &quot;Hello3&quot;))
+
+    val t1 = env.fromCollection(data1).toTable(tEnv, &apos;a, &apos;b)
+    val t2 = env.fromCollection(data2).toTable(tEnv, &apos;c, &apos;d)
+
+    val fun0 = new ScalarFunction0
+    val t = t1.join(t2, &apos;a === &apos;c ).select(&apos;a, &apos;b, &apos;d).where(fun0(concat(&apos;b,&apos;d)))
+
+    StreamITCase.clear
+    val results = t.toAppendStream[Row]
+    results.addSink(new StreamITCase.StringSink[Row])
+    env.execute()
+    val expected = Seq(&quot;1,Hi1,Hello1&quot;, &quot;2,Hi2,Hello2&quot;, &quot;3,Hi3,Hello3&quot;)
+    assertEquals(expected.sorted.mkString(&quot;,&quot;), StreamITCase.testResults.sorted.mkString(&quot;,&quot;))
+  }
&lt;p&gt;+}&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/utils/UserDefineScalarFunctions.scala b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/utils/UserDefineScalarFunctions.scala&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..f86bb70431e&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/utils/UserDefineScalarFunctions.scala&lt;br/&gt;
@@ -0,0 +1,34 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.table.utils&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.table.functions.&lt;/p&gt;
{FunctionContext, ScalarFunction}
&lt;p&gt;+&lt;br/&gt;
+/*&lt;b&gt;A Scalar function always return TRUE if opened correctly.&lt;/b&gt;/&lt;br/&gt;
+class ScalarFunction0 extends ScalarFunction {&lt;br/&gt;
+  private var flag: Boolean = false&lt;br/&gt;
+&lt;br/&gt;
+  override def open(context: FunctionContext): Unit = &lt;/p&gt;
{
+    flag = true
+  }
&lt;p&gt;+&lt;br/&gt;
+  def eval(str: String): Boolean = &lt;/p&gt;
{
+    flag
+  }
&lt;p&gt;+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16679568" author="twalthr" created="Thu, 8 Nov 2018 10:27:11 +0000"  >&lt;p&gt;Fixed in 1.8.0: c8b2ee27d80b1437dd65a9327da65c251febd736&lt;br/&gt;
Fixed in 1.7.0: df81b9d70d1dd7fd2f0dc86fa168f058991b0e33&lt;br/&gt;
Fixed in 1.6.3: 3777a91f593f615665b0d73f0f65948ba0c05a67&lt;br/&gt;
Fixed in 1.5.6: e2b5beeff594978c4fc383956ebf4624e656f4b9&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s003b4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>