<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:56:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22356] Filesystem/Hive partition file is not committed when watermark is applied on rowtime of TIMESTAMP_LTZ type</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22356</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; execution.checkpointing.&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; = 10s;
&lt;span class=&quot;code-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;local&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;time&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;zone&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;Asia/Shanghai&apos;&lt;/span&gt;;

&lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; mysource (
  ms &lt;span class=&quot;code-keyword&quot;&gt;bigint&lt;/span&gt;,
  ts &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; to_timestamp_ltz(ms, 3),
  watermark &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ts &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; ts - &lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;0.001&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;second&lt;/span&gt;
) &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;socket&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;hostname&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;127.0.0.1&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;port&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;9999&apos;&lt;/span&gt;
);

&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; fs_table2 (
    ms &lt;span class=&quot;code-keyword&quot;&gt;bigint&lt;/span&gt;,
  dt &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;,
  `&lt;span class=&quot;code-keyword&quot;&gt;hour&lt;/span&gt;` &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;,
  `mm` &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;
) PARTITIONED &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; (dt, `&lt;span class=&quot;code-keyword&quot;&gt;hour&lt;/span&gt;`, `mm`) &lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;filesystem&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;path&lt;/span&gt;&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/wuchong/Downloads/fs_table2&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;csv&lt;/span&gt;&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;commit&lt;/span&gt;.delay&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;1min&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;commit&lt;/span&gt;.policy.kind&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;success-&lt;span class=&quot;code-keyword&quot;&gt;file&lt;/span&gt;&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.rolling-policy.rollover-&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;30s&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.rolling-policy.&lt;span class=&quot;code-keyword&quot;&gt;check&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;30s&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;commit&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;trigger&lt;/span&gt;&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt;-&lt;span class=&quot;code-keyword&quot;&gt;time&lt;/span&gt;&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;time&lt;/span&gt;-extractor.&lt;span class=&quot;code-keyword&quot;&gt;timestamp&lt;/span&gt;-pattern&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;$dt $&lt;span class=&quot;code-keyword&quot;&gt;hour&lt;/span&gt;:$mm:00&apos;&lt;/span&gt;
);

&lt;span class=&quot;code-keyword&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;into&lt;/span&gt;  fs_table2
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; ms,
DATE_FORMAT(ts, &lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd&apos;&lt;/span&gt;), DATE_FORMAT(ts, &lt;span class=&quot;code-quote&quot;&gt;&apos;HH&apos;&lt;/span&gt;), DATE_FORMAT(ts, &lt;span class=&quot;code-quote&quot;&gt;&apos;mm&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; mysource;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Enther some data in socket:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt; nc -lk 9999
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839600000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839600123}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839600456}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839600789}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839660000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839660123}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839660456}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839660789}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839720000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839780000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839840000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839900000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618839960000}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;: 1618840020000}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, all the files are not committed (not &lt;tt&gt;_SUCCESS&lt;/tt&gt; file):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#10140;  hour=21 tree
.
&#9500;&#9472;&#9472; mm=40
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-0
&#9500;&#9472;&#9472; mm=41
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-1
&#9500;&#9472;&#9472; mm=42
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-2
&#9500;&#9472;&#9472; mm=43
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-3
&#9500;&#9472;&#9472; mm=44
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-4
&#9500;&#9472;&#9472; mm=45
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-5
&#9500;&#9472;&#9472; mm=46
&#9474;&#160;&#160; &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-6
&#9492;&#9472;&#9472; mm=47
    &#9492;&#9472;&#9472; part-cf06c6da-d301-4623-832c-9e0f356f6fb4-0-7

8 directories, 8 files
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13373625">FLINK-22356</key>
            <summary>Filesystem/Hive partition file is not committed when watermark is applied on rowtime of TIMESTAMP_LTZ type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="leonard">Leonard Xu</assignee>
                                    <reporter username="jark">Jark Wu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 19 Apr 2021 13:53:40 +0000</created>
                <updated>Fri, 28 May 2021 09:13:35 +0000</updated>
                            <resolved>Sun, 25 Apr 2021 14:52:40 +0000</resolved>
                                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.1</fixVersion>
                                    <component>Connectors / FileSystem</component>
                    <component>Connectors / Hive</component>
                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17325053" author="jark" created="Mon, 19 Apr 2021 13:57:59 +0000"  >&lt;p&gt;You can also reproduce this problem by using a simple datagen source &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; datagen_source (
    order_number &lt;span class=&quot;code-keyword&quot;&gt;BIGINT&lt;/span&gt;,
    price        &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
    buyer        &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;,
    ts &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;current_timestamp&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; timestamp_ltz(3)),
    proctime &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; proctime(),
    watermark &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ts &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; ts - &lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;0.001&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;second&lt;/span&gt;
) &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; (
    &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;-per-&lt;span class=&quot;code-keyword&quot;&gt;second&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17326561" author="leonard xu" created="Wed, 21 Apr 2021 14:08:32 +0000"  >&lt;p&gt;The root cause of this issue is the the extracted partition time is a TIMESTAMP literal from hive partition field, the `PartitionTimeCommitter` use watermark to compare the TIMESTAMP value, if the input rowtime field of TableSink is TIMESTAMP_LTZ, we need to shift the TIMESTAMP literal and then compare with watermark.&lt;br/&gt;
 But currently the rowtime field Datatype information is unreachable for TableSink, what I can image is introducing a method in DynamicTableSink.Context&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; DynamicTableSink {

    ChangelogMode getChangelogMode(ChangelogMode requestedMode);
    
    SinkRuntimeProvider getSinkRuntimeProvider(Context context);

    DynamicTableSink copy();

    &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Context {

        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isBounded();
 
       /**
         * Returns the DataType of the input time attribute field.
         *
         * &amp;lt;p&amp;gt;This information can be used to compare a table partition value with watermark in
         * partition commit scenario.
         */
        Optional&amp;lt;DataType&amp;gt; getTimeAttributeDataType();

....&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Do you have any suggestion?&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17326572" author="leonard xu" created="Wed, 21 Apr 2021 14:23:36 +0000"  >&lt;p&gt;I create an initial PR based on above comment, I&apos;ll add tests if we can reach an agreement or we have another idea to fix this issue.&lt;/p&gt;</comment>
                            <comment id="17326626" author="twalthr" created="Wed, 21 Apr 2021 15:22:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt; I would like to avoid making &lt;tt&gt;DynamicTableSink.Context&lt;/tt&gt; more complicated. It took a long time to make the interfaces as concise as possible. Can&apos;t we fix the issue on the Hive side only? The sink factory can simply access the resolved schema and check the watermark type and pass it to the sink, no? Btw isn&apos;t any usage of &lt;tt&gt;org.apache.flink.table.filesystem.DefaultPartTimeExtractor#toMills&lt;/tt&gt; invalid, not only for &lt;tt&gt;PartitionTimeCommitter&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17327066" author="jark" created="Thu, 22 Apr 2021 02:41:26 +0000"  >&lt;p&gt;&amp;gt; Can&apos;t we fix the issue on the Hive side only? The sink factory can simply access the resolved schema and check the watermark type and pass it to the sink, no?&lt;br/&gt;
We can&apos;t. Because the watermark information is on source table, not sink table, so Hive sink factory can&apos;t access to the watermark information. &lt;/p&gt;

&lt;p&gt;&amp;gt; Btw isn&apos;t any usage of org.apache.flink.table.filesystem.DefaultPartTimeExtractor#toMills invalid, not only for PartitionTimeCommitter.&lt;br/&gt;
The another usage of &lt;tt&gt;#toMillis&lt;/tt&gt; is used for comparing ordering of partitions, so it&apos;s used validly. &lt;/p&gt;</comment>
                            <comment id="17327180" author="twalthr" created="Thu, 22 Apr 2021 08:49:03 +0000"  >&lt;p&gt;I see. How about we expose the rowtime index through the context instead? I guess this could be useful for a couple of use cases, not only this scenario. We also did it in &lt;tt&gt;TransformationSinkProvider&lt;/tt&gt; and it could help for this use case as well?&lt;/p&gt;</comment>
                            <comment id="17327194" author="jark" created="Thu, 22 Apr 2021 09:06:16 +0000"  >&lt;p&gt;Sounds good to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="17327202" author="leonard xu" created="Thu, 22 Apr 2021 09:31:49 +0000"  >&lt;p&gt;Thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;and&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;&#160;,&#160; but maybe rowtime index is not enough?&lt;br/&gt;
 The &lt;b&gt;consumeDataType&lt;/b&gt; is not the query output DataType, but the schema of TableSink, it doesn&apos;t contains row time attribute.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;T&amp;gt; TypeInformation&amp;lt;T&amp;gt; createTypeInformation(DataType consumedDataType);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And I also consider if we extract the time attribute type from input &lt;b&gt;DataStream&amp;lt;RowData&lt;/b&gt;&amp;gt;&apos;s TypeInformation in &lt;b&gt;SinkRuntimeProvider&lt;/b&gt;, but it&apos;s pretty weak.&lt;/p&gt;</comment>
                            <comment id="17327250" author="twalthr" created="Thu, 22 Apr 2021 10:14:44 +0000"  >&lt;p&gt;It doesn&apos;t contain the &quot;attribute&quot; information anymore but it contains the information whether the field is TIMESTAMP or TIMESTAMP_LTZ, no? Regarding physical columns, &lt;tt&gt;consumedDataType&lt;/tt&gt; and &lt;tt&gt;outputDataType&lt;/tt&gt; should be equal at the beginning of the row modulo metadata. &lt;/p&gt;</comment>
                            <comment id="17328471" author="leonard xu" created="Thu, 22 Apr 2021 11:53:23 +0000"  >&lt;p&gt;I found two bad cases&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;after rethink our solution,&#160; 1. the query may not contain row time field&#160; 2. user may use implicit cast eg cast TIMESTAMP_LTZ&#160; field to TIMESTAMP field. I think we need a watermark metadataHandler to infer the watermark output(time attribute field) type and then expose to sink.&lt;/p&gt;</comment>
                            <comment id="17329127" author="twalthr" created="Thu, 22 Apr 2021 13:37:30 +0000"  >&lt;p&gt;Yes, the query may not contain a row time field. I&apos;m wondering when we decided that a watermark can be both TIMESTAMP or TIMESTAMP_LTZ, this makes the design pretty complicated. I thought we wanted to make watermarks always TIMESTAMP_LTZ (at least internally), even though the schema might return a different type for the expression. Given that watermarks are always TIMESTAMP_LTZ, all we need to do is converting the partition timestamp using the session time zone in the sink. &lt;/p&gt;</comment>
                            <comment id="17329131" author="twalthr" created="Thu, 22 Apr 2021 13:50:54 +0000"  >&lt;p&gt;Also, how do you derive a watermark type from a join between a table with rowtime TIMESTAMP and a table with rowtime TIMESTAMP_LTZ?&lt;/p&gt;</comment>
                            <comment id="17329141" author="twalthr" created="Thu, 22 Apr 2021 14:14:15 +0000"  >&lt;p&gt;I have to admit that I haven&apos;t looked into this time topic for quite some time after the FLIP has been accepted. Why do we even allow TIMESTAMP for rowtime? I thought we agreed on hard breaking pipelines for the greater good and FLIP-162 mentions only rowtime as TIMESTAMP_LTZ similar to PROCTIME(). This restriction would also solve &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22378&quot; title=&quot;Type mismatch when declaring SOURCE_WATERMARK on TIMESTAMP_LTZ column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22378&quot;&gt;&lt;del&gt;FLINK-22378&lt;/del&gt;&lt;/a&gt; easily.&lt;/p&gt;</comment>
                            <comment id="17329272" author="leonard xu" created="Thu, 22 Apr 2021 16:48:26 +0000"  >&lt;p&gt;I think what we want to achieve is that if users&apos; data source used long time, we recommend him/her use TIMESTAMP_LTZ, if users&apos; data source used timestamp string time, we recommend him/her use TIMESTAMP,&#160; and the later way is the most common way before we enhance&#160;TIMESTAMP_LTZ as row/proc time, it&apos;s too radical to disable TIMESTAMP as row time from my understanding.&lt;/p&gt;</comment>
                            <comment id="17330008" author="twalthr" created="Fri, 23 Apr 2021 06:14:02 +0000"  >&lt;p&gt;I understand the reasoning behind it but this is also achievable by casting the TIMESTAMP to TIMESTAMP_LTZ under the hood. We could make it possible that WATERMARK is always TIMESTAMP_LTZ by inserting a CAST(watermark_expression AS TIMESTAMP_LTZ) in the watermark generator. In this case, we only need to worry about casting TIMESTAMP to TIMESTAMP_LTZ in window operators etc.&lt;/p&gt;</comment>
                            <comment id="17330877" author="leonard xu" created="Fri, 23 Apr 2021 15:50:23 +0000"  >&lt;p&gt;After offline discussion with Timo and Jark,&#160; we reach a consensus for he quick fix.&lt;br/&gt;
 we have two user case will meet this issue&#65306; # user reported in mail list that they defined a long(&lt;tt&gt;Sytem.currentTimeMillis&lt;/tt&gt;, e.g. 0 ) in DataStream and used java.sql.Timestamp(e.g&#160;&lt;tt&gt;1970-01-01 08:00:00&lt;/tt&gt;&#160;in Shanghai) to define the row time and then&#160;convert to Table, the watermark in table is extended from DataStream, if the partition time field is from event time field, when comparing the watermark with the partition time field, this issue happens. I admit this is a wrong usage but some users used.&lt;/p&gt;

&lt;p&gt;&#160;&#160;2. This issue described, user defined a watermark on TIMESTAMP_LTZ column, and the partition-time field is aligned with local&#160;timestamp, this issue happens.&lt;/p&gt;

&lt;p&gt;we think the simplest way is to add a configuration for hive connector that used in comparing watermark long value and partition timestamp string.&#160;&lt;br/&gt;
 &#160;&lt;br/&gt;
 Thus, we finally proposed a configuration&#160;to fix this case.&#160;&lt;b&gt;`sink.partition-commit.watermark-time-zone`,&lt;/b&gt; it means the time zone to parse the long watermark value to TIMESTAMP value, the parsed watermark timestamp is used to compare with partition time to decide the partition should commit or not. The default value is &apos;UTC&apos;, which means the watermark is defined on TIMESTAMP column or not defined. If the watermark is defined on TIMESTAMP_LTZ column, the time zone of watermark is user configured time zone, the the value should be the user configured local time zone.&lt;br/&gt;
 &#160;&lt;/p&gt;</comment>
                            <comment id="17331545" author="jark" created="Sun, 25 Apr 2021 14:52:40 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: bddcbc4f93a8d473eafc0f9a1f976d43aa3af4ca&lt;/li&gt;
	&lt;li&gt;release-1.13: 740ad3df3ff6a33cb33223a71e174f989b5b04aa&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 29 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0q7gw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>