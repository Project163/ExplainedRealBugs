<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7989] flink-dist jar is deployed twice onto YARN</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7989</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We always add the &lt;tt&gt;flink-dist*.jar&lt;/tt&gt; ourselves, but it could also be inside a shipped folder such as the &quot;lib/&quot; folder and is then deployed again.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13116332">FLINK-7989</key>
            <summary>flink-dist jar is deployed twice onto YARN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Nov 2017 08:46:55 +0000</created>
                <updated>Wed, 29 Nov 2017 16:09:33 +0000</updated>
                            <resolved>Wed, 29 Nov 2017 16:09:33 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16240098" author="githubbot" created="Mon, 6 Nov 2017 10:08:19 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7989&quot; title=&quot;flink-dist jar is deployed twice onto YARN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7989&quot;&gt;&lt;del&gt;FLINK-7989&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; do not deploy the dist.jar file twice&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    We always add the dist.jar ourselves, but it could also be inside a shipped folder such as the &quot;lib/&quot; folder and was then distributed multiple times.&lt;/p&gt;

&lt;p&gt;    This PR is based on #4939 which changed the artefact uploads a bit.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;also exclude the `flink-dist*.jar` from any (recursive) upload of a shipped directory, e.g. `lib`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is already covered by existing tests, such as any test deploying a program on YARN (if it didn&apos;t include the `flink-dist*.jar` file, it would fail). Additionally, a manual deployment showed that `flink-dist*.jar` is only uploaded once.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (JavaDocs)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-7989&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4951&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6d40434b90d654df55dff3d267721743adc4f586&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2016-11-09T20:04:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4228&quot; title=&quot;YARN artifact upload does not work with S3AFileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4228&quot;&gt;&lt;del&gt;FLINK-4228&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn/s3&amp;#93;&lt;/span&gt; fix for yarn staging with s3a defaultFs&lt;/p&gt;

&lt;p&gt;    + includes a new unit tests for recursive uploads to hfds:// targets&lt;br/&gt;
    + add a unit test for recursive file uploads to s3:// via s3a&lt;/p&gt;

&lt;p&gt;commit df9f9b855185bafe89ac09f4accbd603807e3f56&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-11-03T14:29:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4228&quot; title=&quot;YARN artifact upload does not work with S3AFileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4228&quot;&gt;&lt;del&gt;FLINK-4228&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn/s3&amp;#93;&lt;/span&gt; turn the dependencies around&lt;/p&gt;

&lt;p&gt;    Instead of having flink-s3-fs-hadoop depend on flink-yarn_&amp;lt;scala_version&amp;gt;,&lt;br/&gt;
    let flink-yarn depend on the s3 filesystem and implement the test there.&lt;br/&gt;
    This is safer with regards to the scala-independent flink-s3-fs-hadoop project.&lt;/p&gt;

&lt;p&gt;commit e5488ef719573da0fe86b8355a8b997dd3e3d80a&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-11-03T20:19:34Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7989&quot; title=&quot;flink-dist jar is deployed twice onto YARN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7989&quot;&gt;&lt;del&gt;FLINK-7989&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; do not add the dist.jar file twice&lt;/p&gt;

&lt;p&gt;    We always add the dist.jar ourselves, but it could also be inside a shipped&lt;br/&gt;
    folder such as the &quot;lib/&quot; folder and was then distributed multiple times.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16240226" author="githubbot" created="Mon, 6 Nov 2017 12:44:55 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951#discussion_r149069349&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951#discussion_r149069349&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/AbstractYarnClusterDescriptor.java &amp;#8212;&lt;br/&gt;
    @@ -186,6 +186,8 @@ public void addShipFiles(List&amp;lt;File&amp;gt; shipFiles) {&lt;br/&gt;
     		for (File shipFile: shipFiles) {&lt;br/&gt;
     			// remove uberjar from ship list (by default everything in the lib/ folder is added to&lt;br/&gt;
     			// the list of files to ship, but we handle the uberjar separately.&lt;br/&gt;
    +			// NOTE: this does not filter the uberjar if added recursively, e.g. by having the &quot;lib&quot;&lt;br/&gt;
    +			//       folder in the shipFiles&lt;br/&gt;
     			if (!(shipFile.getName().startsWith(&quot;flink-dist&quot;) &amp;amp;&amp;amp; shipFile.getName().endsWith(&quot;jar&quot;))) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    this filtering seems redundant now, the non-directory branch in `uploadAndRegisterFiles` should catch it.&lt;/p&gt;

&lt;p&gt;    We may want to pull the directory expansion into this method instead, and keep uploadAndRegisterFiles as a dumb upload method.&lt;/p&gt;</comment>
                            <comment id="16240238" author="githubbot" created="Mon, 6 Nov 2017 12:57:00 +0000"  >&lt;p&gt;Github user NicoK commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951#discussion_r149071640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951#discussion_r149071640&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/AbstractYarnClusterDescriptor.java &amp;#8212;&lt;br/&gt;
    @@ -186,6 +186,8 @@ public void addShipFiles(List&amp;lt;File&amp;gt; shipFiles) {&lt;br/&gt;
     		for (File shipFile: shipFiles) {&lt;br/&gt;
     			// remove uberjar from ship list (by default everything in the lib/ folder is added to&lt;br/&gt;
     			// the list of files to ship, but we handle the uberjar separately.&lt;br/&gt;
    +			// NOTE: this does not filter the uberjar if added recursively, e.g. by having the &quot;lib&quot;&lt;br/&gt;
    +			//       folder in the shipFiles&lt;br/&gt;
     			if (!(shipFile.getName().startsWith(&quot;flink-dist&quot;) &amp;amp;&amp;amp; shipFile.getName().endsWith(&quot;jar&quot;))) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    oh - you&apos;re right.&lt;/p&gt;

&lt;p&gt;    Regarding the change of `uploadAndRegisterFiles`: I wouldn&apos;t upload the shipfiles in `addShipFiles` yet, so if we changed that, we&apos;d have to traverse through the directories twice as we definitely need to do that for the uploads and if we wanted to filter recursively in `addShipFiles`, too, then there as well.&lt;/p&gt;</comment>
                            <comment id="16240256" author="githubbot" created="Mon, 6 Nov 2017 13:10:04 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good, I think we can merge it once #4939 has been merged.&lt;/p&gt;</comment>
                            <comment id="16244266" author="githubbot" created="Wed, 8 Nov 2017 16:29:23 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    (rebased onto the newest #4939 which should fix the test failures shown by Travis on the previous build here)&lt;/p&gt;</comment>
                            <comment id="16259014" author="githubbot" created="Mon, 20 Nov 2017 09:35:33 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    #4939 has been merged now - I rebased this PR now so we can go ahead&lt;/p&gt;</comment>
                            <comment id="16260470" author="githubbot" created="Tue, 21 Nov 2017 09:35:02 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    FYI: travis errors are unrelated (ERROR 404 during download of &lt;a href=&quot;http://mirror.netcologne.de/apache.org/kafka/0.10.2.0/kafka_2.11-0.10.2.0.tgz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mirror.netcologne.de/apache.org/kafka/0.10.2.0/kafka_2.11-0.10.2.0.tgz&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="16270855" author="githubbot" created="Wed, 29 Nov 2017 14:44:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4951&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16270856" author="zentol" created="Wed, 29 Nov 2017 14:44:51 +0000"  >&lt;p&gt;master: 520a74f4b683e49ec233f11a0d5af6cc96e9f1cd&lt;/p&gt;</comment>
                            <comment id="16271014" author="zentol" created="Wed, 29 Nov 2017 16:09:33 +0000"  >&lt;p&gt;1.4: 3d568f52070a7719803a2bea5346d0e6f2a72615&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mflr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>