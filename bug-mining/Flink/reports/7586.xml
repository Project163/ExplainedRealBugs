<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-35935] CREATE TABLE AS doesn&apos;t work with LIMIT</title>
                <link>https://issues.apache.org/jira/browse/FLINK-35935</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE WITH (foo) AS (SELECT * FROM bar LIMIT 5)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above statement throws &quot;Caused by: java.lang.AssertionError: not a query: &quot; exception.&lt;/p&gt;

&lt;p&gt;A workaround is to wrap the query with CTE.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE WITH (foo) AS (WITH R AS (SELECT * FROM bar LIMIT 5) SELECT * FROM R)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13587377">FLINK-35935</key>
            <summary>CREATE TABLE AS doesn&apos;t work with LIMIT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xuyangzhong">Xuyang Zhong</assignee>
                                    <reporter username="xccui">Xingcan Cui</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 30 Jul 2024 22:56:56 +0000</created>
                <updated>Mon, 2 Sep 2024 09:35:43 +0000</updated>
                            <resolved>Thu, 15 Aug 2024 11:24:32 +0000</resolved>
                                    <version>1.18.1</version>
                                    <fixVersion>1.19.2</fixVersion>
                    <fixVersion>1.20.1</fixVersion>
                    <fixVersion>2.0-preview</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17870075" author="xuyangzhong" created="Thu, 1 Aug 2024 03:45:29 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xccui&quot; class=&quot;user-hover&quot; rel=&quot;xccui&quot;&gt;xccui&lt;/a&gt;. Can you provide more details about this bug? I tried to reproduce it in CalcTest with the following test, but it unexpectedly worked fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// add it in org.apache.flink.table.planner.plan.stream.sql#CalcTest
&lt;/span&gt;@Test
def test1(): Unit = {
  util.tableEnv.executeSql(
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE MySink WITH (&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;values&apos;&lt;/span&gt;) AS (SELECT * FROM MyTable limit 5)&quot;&lt;/span&gt;)
}

&lt;span class=&quot;code-comment&quot;&gt;// the optimizedRelNodes in PlannerBase#translate by debugging
&lt;/span&gt;StreamPhysicalSink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
&#160; StreamPhysicalLimit(offset=[0], fetch=[5])
&#160; &#160; StreamPhysicalExchange(distribution=[single])
&#160; &#160; &#160; StreamPhysicalLegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17871856" author="xccui" created="Thu, 8 Aug 2024 05:32:18 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuyangzhong&quot; class=&quot;user-hover&quot; rel=&quot;xuyangzhong&quot;&gt;xuyangzhong&lt;/a&gt; , it looks like this doesn&apos;t work for the filesystem connector. For instance&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATEOR REPLACE TABLE `default_catalog`.`default_database`.`test` WITH (    &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;filesystem&apos;&lt;/span&gt;,    &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;,    &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.parallelism&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;,    &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;) AS ( SELECT * FROM table WHERE dt = &lt;span class=&quot;code-quote&quot;&gt;&apos;2024-08-05&apos;&lt;/span&gt; LIMIT 10) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;`FETCH NEXT 10 ROWS ONLY` was added twice to the inner query.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.AssertionError: not a query: SELECT * FROM `table`
WHERE `table`.`dt` = &lt;span class=&quot;code-quote&quot;&gt;&apos;2024-08-05&apos;&lt;/span&gt;
FETCH NEXT 10 ROWS ONLY
FETCH NEXT 10 ROWS ONLY
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17872219" author="xuyangzhong" created="Fri, 9 Aug 2024 07:40:08 +0000"  >&lt;p&gt;This bug is caused by `CREATE OR REPLACE TABLE`. Could you like to assign this to me? I&apos;ll fix it these days.&#160;&lt;/p&gt;</comment>
                            <comment id="17873762" author="lincoln.86xy" created="Thu, 15 Aug 2024 01:25:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuyangzhong&quot; class=&quot;user-hover&quot; rel=&quot;xuyangzhong&quot;&gt;xuyangzhong&lt;/a&gt; Could you also backport this fix to 1.19 &amp;amp; 1.20 branches?&lt;/p&gt;</comment>
                            <comment id="17873763" author="lincoln.86xy" created="Thu, 15 Aug 2024 01:25:53 +0000"  >&lt;p&gt;Fixed in master: 729b8b81a77ba6c32711216b88a1bf57ccddfadc&lt;/p&gt;

&lt;p&gt;1.19: 9c3c82835422e68441e936b378045b76aad894f9&lt;/p&gt;

&lt;p&gt;1.20: c9729dc9201787b980c1d8b0ad05909fbf716bfb&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qly8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>