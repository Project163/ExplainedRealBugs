<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:21:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2616] Failing Test: ZooKeeperLeaderElectionTest</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2616</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Tests run: 6, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 146.262 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest
testMultipleLeaders(org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest) Time elapsed: 22.329 sec &amp;lt;&amp;lt;&amp;lt; ERROR!
java.util.concurrent.TimeoutException: Listener was not notified about a leader within 20000ms
at org.apache.flink.runtime.leaderelection.TestingListener.waitForLeader(TestingListener.java:69)
at org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest.testMultipleLeaders(ZooKeeperLeaderElectionTest.java:334)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/mjsax/flink/jobs/78553799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/mjsax/flink/jobs/78553799&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12861549">FLINK-2616</key>
            <summary>Failing Test: ZooKeeperLeaderElectionTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="mjsax">Matthias J. Sax</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Thu, 3 Sep 2015 12:01:22 +0000</created>
                <updated>Thu, 24 Sep 2015 12:59:09 +0000</updated>
                            <resolved>Thu, 24 Sep 2015 12:59:09 +0000</resolved>
                                                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14734968" author="till.rohrmann" created="Tue, 8 Sep 2015 15:12:31 +0000"  >&lt;p&gt;Increased the timeout to 60s. Hopefully this fixes the problem.&lt;/p&gt;

&lt;p&gt;Commit: e96e5c0b5f4a79c892965509026eafae67693e1f&lt;/p&gt;</comment>
                            <comment id="14736486" author="till.rohrmann" created="Wed, 9 Sep 2015 08:57:27 +0000"  >&lt;p&gt;Does not seem to be fixed by increasing the timeout&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://flink.a.o.uce.east.s3.amazonaws.com/travis-artifacts/StephanEwen/incubator-flink/889/889.1.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://flink.a.o.uce.east.s3.amazonaws.com/travis-artifacts/StephanEwen/incubator-flink/889/889.1.tar.gz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14746964" author="mjsax" created="Wed, 16 Sep 2015 06:23:36 +0000"  >&lt;p&gt;Unfortunately not. It just hit me twice:&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/mjsax/flink/jobs/80576844&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/mjsax/flink/jobs/80576844&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/80576857&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/80576857&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14747222" author="uce" created="Wed, 16 Sep 2015 09:40:02 +0000"  >&lt;p&gt;Why don&apos;t wait w/o an explicit timeout in the test? Our Travis has an implicit test timeout of &quot;Maven did not produce any output for X minutes&quot; (currently 5) after which the build fails and you get a stack trace of where it is stuck. If it still happens, we can think about different options. In the common case where the machine is fast, everything should be fine.&lt;/p&gt;</comment>
                            <comment id="14803038" author="till.rohrmann" created="Thu, 17 Sep 2015 15:02:38 +0000"  >&lt;p&gt;Encountered it again:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/80642071/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/80642071/log.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/80770636/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/80770636/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14810734" author="githubbot" created="Fri, 18 Sep 2015 10:39:59 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2616&quot; title=&quot;Failing Test: ZooKeeperLeaderElectionTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2616&quot;&gt;&lt;del&gt;FLINK-2616&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;test-stability&amp;#93;&lt;/span&gt; Hardens ZooKeeperLeaderElectionTest&lt;/p&gt;

&lt;p&gt;    Replaces Curator&apos;s TestingCluster with TestingServer in ZooKeeperElection/RetrievalTests. This should be more lightweight. Increased the timeout to 200s in ZooKeeperLeaderElectionTest.&lt;/p&gt;

&lt;p&gt;    Adds logging statements to ZooKeeperLeaderElection/RetrievalService.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixZooKeeperLeaderElectionTest&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1143&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit dd26ffc0688c89ec67ef738d050eb3311514d717&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-09-16T14:01:13Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2616&quot; title=&quot;Failing Test: ZooKeeperLeaderElectionTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2616&quot;&gt;&lt;del&gt;FLINK-2616&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;test-stability&amp;#93;&lt;/span&gt; Replaces Curator&apos;s TestingCluster with TestingServer in ZooKeeperElection/RetrievalTests. Increased the timeout to 200s in ZooKeeperLeaderElectionTest.&lt;/p&gt;

&lt;p&gt;    Adds logging statements to ZooKeeperLeaderElection/RetrievalService&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14818819" author="githubbot" created="Fri, 18 Sep 2015 10:45:48 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143#issuecomment-141416101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143#issuecomment-141416101&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I really tried hard to reproduce the failing test case `ZooKeeperLeaderElectionTest.testMultipleLeaders` but it was really hard. I think the test case fails because of too much load on Travis. Therefore, I tried to reduce the resources used by the `ZooKeeperLeaderElectionTest` and increased the timeouts in order to mitigate the problem.&lt;/p&gt;</comment>
                            <comment id="14875664" author="githubbot" created="Fri, 18 Sep 2015 14:09:17 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143#issuecomment-141461360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143#issuecomment-141461360&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Let&apos;s merge this and see if it fixes the problem...&lt;/p&gt;</comment>
                            <comment id="14875668" author="githubbot" created="Fri, 18 Sep 2015 14:13:43 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143#issuecomment-141462318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143#issuecomment-141462318&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Changes look good. Good debug messages as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14875680" author="githubbot" created="Fri, 18 Sep 2015 14:23:25 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143#issuecomment-141465883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143#issuecomment-141465883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hmm, it does not seem to solve the problem. I will further investigate the problem and reopen a PR which will hopefully fix it.&lt;/p&gt;</comment>
                            <comment id="14875681" author="githubbot" created="Fri, 18 Sep 2015 14:23:26 +0000"  >&lt;p&gt;Github user tillrohrmann closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1143&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14904440" author="githubbot" created="Wed, 23 Sep 2015 12:44:06 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1173&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2616&quot; title=&quot;Failing Test: ZooKeeperLeaderElectionTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2616&quot;&gt;&lt;del&gt;FLINK-2616&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;test-stability&amp;#93;&lt;/span&gt; Fixes ZooKeeperLeaderElectionTest.testMultipleLeaders by introducing second retrieval service&lt;/p&gt;

&lt;p&gt;    I think this time I&apos;ve figured out why the `ZooKeeperLeaderElectionTest.testMultipleLeaders` test case sometimes failed. Apparently, Curator&apos;s `NodeCache` does not receive all node changes. If for example, the node&apos;s data has been changed twice, the `NodeCache` eventually sees only the most recent state. This led to problems in the test case, because the `LeaderRetrievalListener` did not see the firstly changed leader address. The `ZooKeeperLeaderRetrievalService` only notifies the `LeaderRetrievalListener` about a new leader if the read address from the ZooKeeper nodes is different to the last read information. If the node cache misses the firstly changed leader address and only sees the overwritten (corrected) address, then it won&apos;t notify the listener, because for him nothing has changed. Therefore, the test failed because it waited for a changing leader address.&lt;/p&gt;

&lt;p&gt;    I resolved the test failure by using a second `LeaderRetrievalService` which is just started after the faulty leader information has been written to ZooKeeper. That way we can be sure that it will see any leader information, the false or the corrected data, for the first time.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixZooKeeperLeaderElectionTest2&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1173.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1173.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1173&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 573c3fac5f36df38f794b3a44f0573ff61c63ce4&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-09-23T12:34:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2616&quot; title=&quot;Failing Test: ZooKeeperLeaderElectionTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2616&quot;&gt;&lt;del&gt;FLINK-2616&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;test-stability&amp;#93;&lt;/span&gt; Fixes ZooKeeperLeaderElectionTest.testMultipleLeaders by introducing a second retrieval service to retrieve the leader address after the faulty address has been written.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14904772" author="githubbot" created="Wed, 23 Sep 2015 16:37:46 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1173#issuecomment-142656921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1173#issuecomment-142656921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Very nice, +1 to merge this!&lt;/p&gt;</comment>
                            <comment id="14905164" author="githubbot" created="Wed, 23 Sep 2015 20:09:42 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1173#issuecomment-142714852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1173#issuecomment-142714852&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 feel free to merge&lt;/p&gt;

&lt;p&gt;    Travis log file changes are good as well.&lt;/p&gt;</comment>
                            <comment id="14906306" author="githubbot" created="Thu, 24 Sep 2015 12:55:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1173#issuecomment-142919125&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1173#issuecomment-142919125&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging this.&lt;/p&gt;</comment>
                            <comment id="14906307" author="githubbot" created="Thu, 24 Sep 2015 12:57:44 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1173&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14906310" author="till.rohrmann" created="Thu, 24 Sep 2015 12:59:09 +0000"  >&lt;p&gt;Fixed via 0d19e94a18a334b6b5843c3ea81e20af096d7f35&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jqrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>