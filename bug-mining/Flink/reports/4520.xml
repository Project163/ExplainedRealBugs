<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:49:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17273] Fix not calling ResourceManager#closeTaskManagerConnection in KubernetesResourceManager in case of registered TaskExecutor failure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17273</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;At the moment, the &lt;tt&gt;KubernetesResourceManager&lt;/tt&gt; does not call the method of &lt;tt&gt;ResourceManager#closeTaskManagerConnection&lt;/tt&gt; once it detects that a currently registered task executor has failed. This ticket propoeses to fix this problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13299700">FLINK-17273</key>
            <summary>Fix not calling ResourceManager#closeTaskManagerConnection in KubernetesResourceManager in case of registered TaskExecutor failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xtsong">Xintong Song</assignee>
                                    <reporter username="felixzheng">Canbin Zheng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 20 Apr 2020 13:49:51 +0000</created>
                <updated>Thu, 14 Jan 2021 09:26:12 +0000</updated>
                            <resolved>Fri, 28 Aug 2020 08:19:26 +0000</resolved>
                                    <version>1.10.0</version>
                    <version>1.10.1</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Deployment / Kubernetes</component>
                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17088255" author="tison" created="Tue, 21 Apr 2020 03:30:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This seems a fast fail path when TM(Pod) failed, which we did in YARN &amp;amp; Mesos code path. It would be better you also have a look.&lt;/p&gt;
</comment>
                            <comment id="17088276" author="felixzheng" created="Tue, 21 Apr 2020 04:20:52 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17088324" author="fly_in_gis" created="Tue, 21 Apr 2020 06:08:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixzheng&quot; class=&quot;user-hover&quot; rel=&quot;felixzheng&quot;&gt;felixzheng&lt;/a&gt; Do you mean when a TaskManager pod crashed exceptionally, we should &lt;tt&gt;closeTaskManagerConnection&lt;/tt&gt; before removing the pod in &lt;tt&gt;KubernetesResourceManager&lt;/tt&gt;? If it is, i think it is a valid fix. Otherwise, we need to wait for the timeout.&lt;/p&gt;</comment>
                            <comment id="17088438" author="till.rohrmann" created="Tue, 21 Apr 2020 08:48:11 +0000"  >&lt;p&gt;&lt;tt&gt;ResourceManager#closeTaskManagerConnection&lt;/tt&gt; cleans up the registration state on the RM side and tries to notify the TM about the closed connection (this might succeed or not). Hence, I guess the K8s RM should also call this method whenever a TM or pod is signalled to have failed/disappeared.&lt;/p&gt;</comment>
                            <comment id="17089219" author="xintongsong" created="Wed, 22 Apr 2020 02:28:15 +0000"  >&lt;p&gt;I think this is a valid issue. +1 for fixing it.&lt;br/&gt;
IIUC, we can call &lt;tt&gt;ResourceManager#closeTaskManagerConnection&lt;/tt&gt; in &lt;tt&gt;KubernetesResourceManager#internalStopPod&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17089254" author="felixzheng" created="Wed, 22 Apr 2020 03:19:00 +0000"  >&lt;p&gt;Thanks for your attention! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; Given the following call stack,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;ResourceManager#releaseResource&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160; - &lt;tt&gt;KubernetesResourceManager#stopWorker&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160; - &lt;tt&gt;KubernetesResourceManager#internalStopPod&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160; - &lt;tt&gt;ResourceManager#closeTaskManagerConnection&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think it&apos;s enough to explicitly call &lt;tt&gt;ResourceManager#closeTaskManagerConnection&lt;/tt&gt; in &lt;tt&gt;KubernetesResourceManager#removePodIfTerminated&lt;/tt&gt; for this issue.&lt;/p&gt;</comment>
                            <comment id="17090578" author="till.rohrmann" created="Thu, 23 Apr 2020 12:34:46 +0000"  >&lt;p&gt;I think part of the problem why we missed to call this function is that &lt;tt&gt;ResourceManager&lt;/tt&gt; does not enforce a certain control flow. I think it would be better if the &lt;tt&gt;ResourceManager&lt;/tt&gt; offered some calls like &lt;tt&gt;notifyWorkerFailed&lt;/tt&gt; which will trigger the failover behaviour controlled by the &lt;tt&gt;ResourceManager&lt;/tt&gt; and not by the sub class. In order to make this work, I guess we should take a look at the overall architecture and think about what callbacks the &lt;tt&gt;ResourceManager&lt;/tt&gt; would need in order to do its job. Then the &lt;tt&gt;ResourceManager&lt;/tt&gt; should be responsible for reacting to failures and other signals and simply call the implementation specific callbacks (e.g. terminating a pod). In contrast to that, our current &lt;tt&gt;ResourceManager&lt;/tt&gt; implementations handle most of the logic themselves which can lead to problems such as forgetting to call a method in order to not violate the contract.&lt;/p&gt;</comment>
                            <comment id="17091096" author="xintongsong" created="Fri, 24 Apr 2020 02:09:00 +0000"  >&lt;p&gt;+1 for revisiting the boundary between &lt;tt&gt;ResourceManager&lt;/tt&gt; and its deployment specific implementations.&lt;br/&gt;
I think this would help deduplicating the worker lifecycle control flow across deployments. The RM implementations should only handles the minimum set of deployment specific API/behavior differences.&lt;/p&gt;</comment>
                            <comment id="17091156" author="felixzheng" created="Fri, 24 Apr 2020 04:13:10 +0000"  >&lt;p&gt;Thanks a lot for the input &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;. I agree that we need to revisit the boundary between &lt;tt&gt;ResourceManager&lt;/tt&gt; and its deployment-specific implementations, especially for the worker lifecycle control flow; I will take a closer look at the overall architecture and get back to further discuss it with you.&lt;/p&gt;</comment>
                            <comment id="17091374" author="fly_in_gis" created="Fri, 24 Apr 2020 09:25:34 +0000"  >&lt;p&gt;+1 to rethink and make a clear boundary&#160;between&#160;&lt;tt&gt;ResourceManager&lt;/tt&gt; and specific cluster deployment implementation. Some future developments will also benefit a lot from this.&lt;/p&gt;</comment>
                            <comment id="17150857" author="rmetzger" created="Fri, 3 Jul 2020 09:22:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixzheng&quot; class=&quot;user-hover&quot; rel=&quot;felixzheng&quot;&gt;felixzheng&lt;/a&gt; What&apos;s the status of this ticket?&lt;br/&gt;
I&apos;m currently checking some old tickets, and I found that there&apos;s no updates here in the past weeks.&lt;/p&gt;</comment>
                            <comment id="17151238" author="felixzheng" created="Sat, 4 Jul 2020 08:32:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; Sorry that I am busy in the past two months. How about changing the fixed version to 1.12?&lt;/p&gt;</comment>
                            <comment id="17151535" author="rmetzger" created="Sun, 5 Jul 2020 09:54:42 +0000"  >&lt;p&gt;no problem &amp;amp; done.&lt;/p&gt;</comment>
                            <comment id="17183869" author="xintongsong" created="Tue, 25 Aug 2020 08:49:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixzheng&quot; class=&quot;user-hover&quot; rel=&quot;felixzheng&quot;&gt;felixzheng&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Is there any updates on this ticket?&lt;/p&gt;

&lt;p&gt;I&apos;m asking because, we are making good progress in revisiting the boundary between &lt;tt&gt;ResourceManager&lt;/tt&gt; and its deployment specific implementations (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18620&quot; title=&quot;Unify behaviors of active resource managers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18620&quot;&gt;&lt;del&gt;FLINK-18620&lt;/del&gt;&lt;/a&gt;), so the previously discussed solution might no longer apply.&lt;/p&gt;

&lt;p&gt;If you have not already started working on this, would you be ok with me taking over this ticket?&lt;/p&gt;</comment>
                            <comment id="17185032" author="felixzheng" created="Wed, 26 Aug 2020 08:46:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;, I do not work on this issue, go ahead!&lt;/p&gt;</comment>
                            <comment id="17185069" author="xintongsong" created="Wed, 26 Aug 2020 09:49:26 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixzheng&quot; class=&quot;user-hover&quot; rel=&quot;felixzheng&quot;&gt;felixzheng&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17186375" author="xintongsong" created="Fri, 28 Aug 2020 08:19:26 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;master: 99ab2efa7e40f1ca97455e48134584904afd2da2&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dulk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>