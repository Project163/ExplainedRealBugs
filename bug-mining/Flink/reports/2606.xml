<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10204] StreamElementSerializer#copy broken for LatencyMarkers </title>
                <link>https://issues.apache.org/jira/browse/FLINK-10204</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We have a long running flink job that eventually fails and is shut down due to an internal serialization exception that we keep on getting. Here is the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2018-08-23 18:39:48,199 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Job NAV Estimation (4b5463d76167f9f5aac83a890e8a867d) switched from state FAILING to FAILED.
java.io.IOException: Corrupt stream, found tag: 127
at org.apache.flink.streaming.runtime.streamrecord.StreamElementSerializer.deserialize(StreamElementSerializer.java:219)
at org.apache.flink.streaming.runtime.streamrecord.StreamElementSerializer.deserialize(StreamElementSerializer.java:49)
at org.apache.flink.runtime.plugable.NonReusingDeserializationDelegate.read(NonReusingDeserializationDelegate.java:55)
at org.apache.flink.runtime.io.network.api.serialization.SpillingAdaptiveSpanningRecordDeserializer.getNextRecord(SpillingAdaptiveSpanningRecordDeserializer.java:140)
at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor.processInput(StreamTwoInputProcessor.java:206)
at org.apache.flink.streaming.runtime.tasks.TwoInputStreamTask.run(TwoInputStreamTask.java:115)
at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:306)
at org.apache.flink.runtime.taskmanager.Task.run(Task.java:703)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think I have tracked down the issue to a mismatch in the serialization/deserialization/copy code in the StreamElementSerializer with regards to the LATENCY_MARKER.&lt;/p&gt;

&lt;p&gt;The Serialization logic writes 3 LONGs and an INT. The copy logic only writes (and reads) a LONG and 2 INTs. Adding a test for the LatencyMarker throws an EOFException, and fixing the copy code causes the test to pass again.&lt;/p&gt;

&lt;p&gt;I&apos;ve written a unit test that highlights the problem, and have written the code to correct it.&lt;/p&gt;

&lt;p&gt;I&apos;ll submit a PR that goes along with it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13180829">FLINK-10204</key>
            <summary>StreamElementSerializer#copy broken for LatencyMarkers </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mstar_benl">Ben La Monica</assignee>
                                    <reporter username="mstar_benl">Ben La Monica</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 23 Aug 2018 21:09:35 +0000</created>
                <updated>Thu, 28 Feb 2019 10:46:05 +0000</updated>
                            <resolved>Mon, 27 Aug 2018 08:40:39 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16590863" author="githubbot" created="Thu, 23 Aug 2018 22:01:57 +0000"  >&lt;p&gt;benlamonica opened a new pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Contribution Checklist&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the pull request corresponds to a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/FLINK/issues&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/FLINK/issues&lt;/a&gt;). Exceptions are made for typos in JavaDoc or documentation files, which need no JIRA issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Name the pull request in the form &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXXX&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;component&amp;#93;&lt;/span&gt; Title of the pull request&quot;, where &lt;b&gt;FLINK-XXXX&lt;/b&gt; should be replaced by the actual issue number. Skip &lt;b&gt;component&lt;/b&gt; if you are unsure about which is the best component.&lt;br/&gt;
     Typo fixes that have no associated JIRA issue should be named following this pattern: `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Fix typo in event time introduction` or `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;javadocs&amp;#93;&lt;/span&gt; Expand JavaDoc for PuncuatedWatermarkGenerator`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fill out the template below to describe the changes contributed by the pull request. That will give reviewers the context they need to do the review.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the change passes the automated tests, i.e., `mvn clean verify` passes. You can set up Travis CI to do that following &lt;span class=&quot;error&quot;&gt;&amp;#91;this guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/contribute-code.html#best-practices&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/contribute-code.html#best-practices&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each pull request should address only one issue, not mix up code from multiple issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each commit in the pull request has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Once all items of the checklist are addressed, remove the above text and this checklist, leaving only the filled out template below.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;   *&lt;b&gt;(The sections below can be removed for hotfixes of typos)&lt;/b&gt;*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Fixes a serialization error with regards to the LatencyMarker not having the same binary format when serializing, and when copying the byte stream.  The following exception occurs after a long running flink job has been running for a while:&lt;/p&gt;

&lt;p&gt;   `2018-08-23 18:39:48,199 INFO  org.apache.flink.runtime.executiongraph.ExecutionGraph        - Job NAV Estimation (4b5463d76167f9f5aac83a890e8a867d) switched from state FAILING to FAILED.&lt;br/&gt;
   java.io.IOException: Corrupt stream, found tag: 127&lt;br/&gt;
   	at org.apache.flink.streaming.runtime.streamrecord.StreamElementSerializer.deserialize(StreamElementSerializer.java:219)&lt;br/&gt;
   	at org.apache.flink.streaming.runtime.streamrecord.StreamElementSerializer.deserialize(StreamElementSerializer.java:49)&lt;br/&gt;
   	at org.apache.flink.runtime.plugable.NonReusingDeserializationDelegate.read(NonReusingDeserializationDelegate.java:55)&lt;br/&gt;
   	at org.apache.flink.runtime.io.network.api.serialization.SpillingAdaptiveSpanningRecordDeserializer.getNextRecord(SpillingAdaptiveSpanningRecordDeserializer.java:140)&lt;br/&gt;
   	at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor.processInput(StreamTwoInputProcessor.java:206)&lt;br/&gt;
   	at org.apache.flink.streaming.runtime.tasks.TwoInputStreamTask.run(TwoInputStreamTask.java:115)&lt;br/&gt;
   	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:306)&lt;br/&gt;
   	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:703)&lt;br/&gt;
   	at java.lang.Thread.run(Thread.java:748)`&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*Added LatencyMarker to the StreamElementSerializerTest and then fixed the failure by correcting the StreamElementSerializer::copy method.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Commenting out the fix in the class will show that when serializing and deserializing, you will encounter an EOFException due to the incorrect copy*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: yes (modified the equals/hashCode on the LatencyMarker class so that the test would pass)&lt;/li&gt;
	&lt;li&gt;The serializers: yes&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): don&apos;t know&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: don&apos;t know&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? not applicable&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591330" author="githubbot" created="Fri, 24 Aug 2018 08:34:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212558104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212558104&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   was the existing implementation wrong?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591329" author="githubbot" created="Fri, 24 Aug 2018 08:34:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212558074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212558074&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;br/&gt;
+		if (this == obj) 
{
 			return true;
 		}&lt;/li&gt;
	&lt;li&gt;if (o == null || getClass() != o.getClass()){&lt;br/&gt;
+		if (obj == null) 
{
 			return false;
 		}&lt;br/&gt;
-&lt;br/&gt;
-		LatencyMarker that = (LatencyMarker) o;&lt;br/&gt;
-&lt;br/&gt;
-		if (markedTime != that.markedTime) {&lt;br/&gt;
+		if (getClass() != obj.getClass()) { 			return false; 		}&lt;/li&gt;
	&lt;li&gt;if (operatorId != that.operatorId) {&lt;br/&gt;
+		LatencyMarker other = (LatencyMarker) obj;&lt;br/&gt;
+		if (markedTime != other.markedTime) 
{
 			return false;
 		}&lt;/li&gt;
	&lt;li&gt;return subtaskIndex == that.subtaskIndex;&lt;br/&gt;
-&lt;br/&gt;
+		if (operatorId == null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (other.operatorId != null) {
+				return false;
+			}+		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else if (!operatorId.equals(other.operatorId)) &lt;/p&gt;
{
+			return false;
+		}&lt;br/&gt;
+		if (subtaskIndex != other.subtaskIndex) {+			return false;+		}
&lt;p&gt;+		return true;&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
 	public int hashCode() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int result = (int) (markedTime ^ (markedTime &amp;gt;&amp;gt;&amp;gt; 32));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   seems unrelated&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591396" author="githubbot" created="Fri, 24 Aug 2018 09:33:16 +0000"  >&lt;p&gt;StephanEwen commented on issue #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#issuecomment-415706823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#issuecomment-415706823&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Good catch!&lt;/p&gt;

&lt;p&gt;   Could you undo the changes to `LatencyMarker`? Keeps the file&apos;s change history clean/meaningful...&lt;br/&gt;
   Otherwise +1 to merge this!&lt;/p&gt;

&lt;p&gt;   Should also be merged into the 1.5 and 1.6 branches...&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591630" author="githubbot" created="Fri, 24 Aug 2018 13:14:38 +0000"  >&lt;p&gt;benlamonica commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212623923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212623923&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Yes, the prior implementation did this:&lt;br/&gt;
   `if (operatorId != that.operatorId) {`&lt;br/&gt;
   instead of calling equals(), which resulted in a false if the object is equivalent, but not the exact same object (for example, when the bytestream is copied).&lt;/p&gt;

&lt;p&gt;   These changes are just from eclipse generating the equals and hashCode methods. I needed to do this so that the unit test would actually pass since it uses the equals method in it&apos;s assertion.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591641" author="githubbot" created="Fri, 24 Aug 2018 13:21:29 +0000"  >&lt;p&gt;benlamonica commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212626021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212626021&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;br/&gt;
+		if (this == obj) 
{
 			return true;
 		}&lt;/li&gt;
	&lt;li&gt;if (o == null || getClass() != o.getClass()){&lt;br/&gt;
+		if (obj == null) 
{
 			return false;
 		}&lt;br/&gt;
-&lt;br/&gt;
-		LatencyMarker that = (LatencyMarker) o;&lt;br/&gt;
-&lt;br/&gt;
-		if (markedTime != that.markedTime) {&lt;br/&gt;
+		if (getClass() != obj.getClass()) { 			return false; 		}&lt;/li&gt;
	&lt;li&gt;if (operatorId != that.operatorId) {&lt;br/&gt;
+		LatencyMarker other = (LatencyMarker) obj;&lt;br/&gt;
+		if (markedTime != other.markedTime) 
{
 			return false;
 		}&lt;/li&gt;
	&lt;li&gt;return subtaskIndex == that.subtaskIndex;&lt;br/&gt;
-&lt;br/&gt;
+		if (operatorId == null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (other.operatorId != null) {
+				return false;
+			}+		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else if (!operatorId.equals(other.operatorId)) &lt;/p&gt;
{
+			return false;
+		}&lt;br/&gt;
+		if (subtaskIndex != other.subtaskIndex) {+			return false;+		}
&lt;p&gt;+		return true;&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
 	public int hashCode() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int result = (int) (markedTime ^ (markedTime &amp;gt;&amp;gt;&amp;gt; 32));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   This is just the way eclipse generates the hashCode. Since operatorId can be null, it does a nullcheck before calling hashCode on it.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591702" author="githubbot" created="Fri, 24 Aug 2018 14:05:26 +0000"  >&lt;p&gt;benlamonica commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212639070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212639070&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -89,6 +90,9 @@ public void testSerialization() throws Exception {&lt;/p&gt;

&lt;p&gt; 		Watermark negativeWatermark = new Watermark(-4647654567676555876L);&lt;br/&gt;
 		assertEquals(negativeWatermark, serializeAndDeserialize(negativeWatermark, serializer));&lt;br/&gt;
+&lt;br/&gt;
+		LatencyMarker latencyMarker = new LatencyMarker(System.currentTimeMillis(), new OperatorID(-1, -1), 1);&lt;br/&gt;
+		assertEquals(latencyMarker, serializeAndDeserialize(latencyMarker, serializer));&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   hashCode and equals changes are to support this line here. Without it, even though the objects have the same values, they still evaluate as not equal.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591707" author="githubbot" created="Fri, 24 Aug 2018 14:07:46 +0000"  >&lt;p&gt;benlamonica commented on issue #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#issuecomment-415769746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#issuecomment-415769746&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @StephanEwen and @zentol , I&apos;ve commented on the PR comments. The reason why LatencyMarker has changes is because the equals implementation was incorrect. It did an operatorId != that.operatorId, instead of !operatorId.equals(that.operatorId).&lt;/p&gt;

&lt;p&gt;   If you want, I can revert that change and just write a more complicated assertEquals statement in the test, but I feel that it is the correct change. The other stream records have equals correctly implemented so that they can compare after a copy.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591736" author="githubbot" created="Fri, 24 Aug 2018 14:23:49 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212645193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212645193&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;br/&gt;
+		if (this == obj) 
{
 			return true;
 		}&lt;/li&gt;
	&lt;li&gt;if (o == null || getClass() != o.getClass()){&lt;br/&gt;
+		if (obj == null) 
{
 			return false;
 		}&lt;br/&gt;
-&lt;br/&gt;
-		LatencyMarker that = (LatencyMarker) o;&lt;br/&gt;
-&lt;br/&gt;
-		if (markedTime != that.markedTime) {&lt;br/&gt;
+		if (getClass() != obj.getClass()) { 			return false; 		}&lt;/li&gt;
	&lt;li&gt;if (operatorId != that.operatorId) {&lt;br/&gt;
+		LatencyMarker other = (LatencyMarker) obj;&lt;br/&gt;
+		if (markedTime != other.markedTime) 
{
 			return false;
 		}&lt;/li&gt;
	&lt;li&gt;return subtaskIndex == that.subtaskIndex;&lt;br/&gt;
-&lt;br/&gt;
+		if (operatorId == null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (other.operatorId != null) {
+				return false;
+			}+		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else if (!operatorId.equals(other.operatorId)) &lt;/p&gt;
{
+			return false;
+		}&lt;br/&gt;
+		if (subtaskIndex != other.subtaskIndex) {+			return false;+		}
&lt;p&gt;+		return true;&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
 	public int hashCode() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int result = (int) (markedTime ^ (markedTime &amp;gt;&amp;gt;&amp;gt; 32));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   This change isn&apos;t necessary, please revert.&lt;/p&gt;

&lt;p&gt;   While it is theoretically possible for operatorId to be null, in practices this won&apos;t happen.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591737" author="githubbot" created="Fri, 24 Aug 2018 14:23:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212644961&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212644961&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;br/&gt;
+		if (this == obj) 
{
 			return true;
 		}&lt;/li&gt;
	&lt;li&gt;if (o == null || getClass() != o.getClass()){&lt;br/&gt;
+		if (obj == null) 
{
 			return false;
 		}&lt;br/&gt;
-&lt;br/&gt;
-		LatencyMarker that = (LatencyMarker) o;&lt;br/&gt;
-&lt;br/&gt;
-		if (markedTime != that.markedTime) {&lt;br/&gt;
+		if (getClass() != obj.getClass()) { 			return false; 		}&lt;/li&gt;
	&lt;li&gt;if (operatorId != that.operatorId) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   let&apos;s reduce this change to only replacing `operatorId != that.operatorId`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591804" author="githubbot" created="Fri, 24 Aug 2018 15:27:52 +0000"  >&lt;p&gt;benlamonica commented on a change in pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#discussion_r212666184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#discussion_r212666184&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -67,31 +67,40 @@ public int getSubtaskIndex() {&lt;br/&gt;
 	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean equals(Object o) {&lt;/li&gt;
	&lt;li&gt;if (this == o) {&lt;br/&gt;
+	public boolean equals(Object obj) {&lt;br/&gt;
+		if (this == obj) 
{
 			return true;
 		}&lt;/li&gt;
	&lt;li&gt;if (o == null || getClass() != o.getClass()){&lt;br/&gt;
+		if (obj == null) 
{
 			return false;
 		}&lt;br/&gt;
-&lt;br/&gt;
-		LatencyMarker that = (LatencyMarker) o;&lt;br/&gt;
-&lt;br/&gt;
-		if (markedTime != that.markedTime) {&lt;br/&gt;
+		if (getClass() != obj.getClass()) { 			return false; 		}&lt;/li&gt;
	&lt;li&gt;if (operatorId != that.operatorId) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Sure, I will do that.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16591852" author="githubbot" created="Fri, 24 Aug 2018 16:06:30 +0000"  >&lt;p&gt;benlamonica commented on issue #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#issuecomment-415805492&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#issuecomment-415805492&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @zentol do you want me to squash the commits and force push to this branch so that the history remains clean?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16592514" author="githubbot" created="Sat, 25 Aug 2018 07:59:48 +0000"  >&lt;p&gt;zentol commented on issue #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610#issuecomment-415951247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610#issuecomment-415951247&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Please keep commits separate so we can better judge what has changed. I will squash things when merging.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16593298" author="githubbot" created="Mon, 27 Aug 2018 08:20:28 +0000"  >&lt;p&gt;zentol closed pull request #6610: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10204&quot; title=&quot;StreamElementSerializer#copy broken for LatencyMarkers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10204&quot;&gt;&lt;del&gt;FLINK-10204&lt;/del&gt;&lt;/a&gt; - fix serialization/copy error for LatencyMarker records.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6610&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6610&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
index 932e1300d9c..4074251986f 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/LatencyMarker.java&lt;br/&gt;
@@ -80,7 +80,7 @@ public boolean equals(Object o) {&lt;br/&gt;
 		if (markedTime != that.markedTime) &lt;/p&gt;
{
 			return false;
 		}&lt;br/&gt;
-		if (operatorId != that.operatorId) {&lt;br/&gt;
+		if (!operatorId.equals(that.operatorId)) { 			return false; 		}
&lt;p&gt; 		return subtaskIndex == that.subtaskIndex;&lt;br/&gt;
diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializer.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializer.java&lt;br/&gt;
index ba92416d792..ed6022ff592 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializer.java&lt;br/&gt;
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializer.java&lt;br/&gt;
@@ -156,7 +156,8 @@ else if (tag == TAG_STREAM_STATUS) {&lt;br/&gt;
 		}&lt;br/&gt;
 		else if (tag == TAG_LATENCY_MARKER) &lt;/p&gt;
{
 			target.writeLong(source.readLong());
-			target.writeInt(source.readInt());
+			target.writeLong(source.readLong());
+			target.writeLong(source.readLong());
 			target.writeInt(source.readInt());
 		}
&lt;p&gt; else {&lt;br/&gt;
 			throw new IOException(&quot;Corrupt stream, found tag: &quot; + tag);&lt;br/&gt;
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerTest.java&lt;br/&gt;
index 4a993179793..0e4e84b5d30 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerTest.java&lt;br/&gt;
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/streamrecord/StreamElementSerializerTest.java&lt;br/&gt;
@@ -23,6 +23,7 @@&lt;br/&gt;
 import org.apache.flink.api.common.typeutils.base.StringSerializer;&lt;br/&gt;
 import org.apache.flink.core.memory.DataInputDeserializer;&lt;br/&gt;
 import org.apache.flink.core.memory.DataOutputSerializer;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.OperatorID;&lt;br/&gt;
 import org.apache.flink.streaming.api.watermark.Watermark;&lt;/p&gt;

&lt;p&gt; import org.junit.Test;&lt;br/&gt;
@@ -89,6 +90,9 @@ public void testSerialization() throws Exception &lt;/p&gt;
{
 
 		Watermark negativeWatermark = new Watermark(-4647654567676555876L);
 		assertEquals(negativeWatermark, serializeAndDeserialize(negativeWatermark, serializer));
+
+		LatencyMarker latencyMarker = new LatencyMarker(System.currentTimeMillis(), new OperatorID(-1, -1), 1);
+		assertEquals(latencyMarker, serializeAndDeserialize(latencyMarker, serializer));
 	}

&lt;p&gt; 	@SuppressWarnings(&quot;unchecked&quot;)&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16593331" author="zentol" created="Mon, 27 Aug 2018 08:38:53 +0000"  >&lt;p&gt;master: 89609881c1fa66294713bbb307e9bdfd03e57d9c&lt;br/&gt;
1.6: 7fb2012400091f5d56aac7ff01995763c63f25bf&lt;br/&gt;
1.5: 9ad1bff35411bc18d0c43a7e0322fc59852f9729&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xd9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>