<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3134] Make YarnJobManager&apos;s allocate call asynchronous</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3134</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;allocate()&lt;/tt&gt; call is used in the &lt;tt&gt;YarnJobManager&lt;/tt&gt; to send a heartbeat to the YARN resource manager. This call may block the JobManager actor system for arbitrary time, e.g. if retry handlers are set up within the call to allocate.&lt;/p&gt;

&lt;p&gt;I propose to use the &lt;tt&gt;AMRMClientAsync&lt;/tt&gt;&apos;s callback methods to send heartbeats and update the container information. The API is available for our supported Hadoop versions (2.3.0 and above).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://hadoop.apache.org/docs/stable/api/org/apache/hadoop/yarn/client/api/async/AMRMClientAsync.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hadoop.apache.org/docs/stable/api/org/apache/hadoop/yarn/client/api/async/AMRMClientAsync.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12919748">FLINK-3134</key>
            <summary>Make YarnJobManager&apos;s allocate call asynchronous</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="mxm">Maximilian Michels</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Dec 2015 16:05:43 +0000</created>
                <updated>Mon, 19 Dec 2016 12:47:05 +0000</updated>
                            <resolved>Thu, 17 Dec 2015 14:21:24 +0000</resolved>
                                    <version>0.10.0</version>
                    <version>0.10.1</version>
                    <version>1.0.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15046650" author="till.rohrmann" created="Tue, 8 Dec 2015 09:49:10 +0000"  >&lt;p&gt;big +1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15052874" author="githubbot" created="Fri, 11 Dec 2015 15:08:26 +0000"  >&lt;p&gt;GitHub user mxm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3134&quot; title=&quot;Make YarnJobManager&amp;#39;s allocate call asynchronous&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3134&quot;&gt;&lt;del&gt;FLINK-3134&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; asynchronous YarnJobManager heartbeats&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use AMRMClientAsync instead of AMRMClient&lt;/li&gt;
	&lt;li&gt;handle allocation and startup of containers in callbacks&lt;/li&gt;
	&lt;li&gt;remove YarnHeartbeat message&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The AMRMClientAsync uses one thread to communicate with the resource&lt;br/&gt;
    manager and an additional thread to execute the callbacks.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mxm/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flink&lt;/a&gt; yart-heartbeat-async&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1450&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8ec6d492795801ffc7c76f37a3a3200bbf85f81c&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-12-08T13:35:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3134&quot; title=&quot;Make YarnJobManager&amp;#39;s allocate call asynchronous&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3134&quot;&gt;&lt;del&gt;FLINK-3134&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; asynchronous YarnJobManager heartbeats&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use AMRMClientAsync instead of AMRMClient&lt;/li&gt;
	&lt;li&gt;handle allocation and startup of containers in callbacks&lt;/li&gt;
	&lt;li&gt;remove YarnHeartbeat message&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The AMRMClientAsync uses one thread to communicate with the resource&lt;br/&gt;
    manager and an additional thread to execute the callbacks.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15057656" author="githubbot" created="Tue, 15 Dec 2015 09:03:38 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47611363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47611363&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = &lt;/p&gt;
{
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onNodesUpdated(updatedNodes: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;NodeReport&amp;#93;&lt;/span&gt;): Unit = {    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onContainersCompleted(statuses: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerStatus&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +      // TODO change this&lt;br/&gt;
    +      log.debug(s&quot;Processed Heartbeat with RMClient. Running containers $runningContainers, &quot; +&lt;br/&gt;
    +        s&quot;failed containers $failedContainers, &quot; +&lt;br/&gt;
    +        s&quot;allocated containers ${allocatedContainersList.size}.&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +      val completedContainerStatuses = statuses.asScala&lt;br/&gt;
    +      val idStatusMap = completedContainerStatuses&lt;br/&gt;
    +        .map(status =&amp;gt; (status.getContainerId, status)).toMap&lt;br/&gt;
    +&lt;br/&gt;
    +      completedContainerStatuses.foreach {&lt;br/&gt;
    +        status =&amp;gt; log.info(s&quot;Container ${status.getContainerId} is completed &quot; +&lt;br/&gt;
    +          s&quot;with diagnostics: ${status.getDiagnostics}&quot;)&lt;br/&gt;
    +      }&lt;br/&gt;
    +&lt;br/&gt;
    +      // get failed containers (returned containers are also completed, so we have to&lt;br/&gt;
    +      // distinguish if it was running before).&lt;br/&gt;
    +      val (completedContainers, remainingRunningContainers) = runningContainersList&lt;br/&gt;
    +        .partition(idStatusMap contains _.getId)&lt;br/&gt;
    +&lt;br/&gt;
    +      completedContainers.foreach {&lt;br/&gt;
    +        container =&amp;gt;&lt;br/&gt;
    +          val status = idStatusMap(container.getId)&lt;br/&gt;
    +          failedContainers += 1&lt;br/&gt;
    +          runningContainers -= 1&lt;br/&gt;
    +          log.info(s&quot;Container ${status.getContainerId} was a running container. &quot; +&lt;br/&gt;
    +            s&quot;Total failed containers $failedContainers.&quot;)&lt;br/&gt;
    +          val detail = status.getExitStatus match &lt;/p&gt;
{
    +            case -103 =&amp;gt; &quot;Vmem limit exceeded&quot;;
    +            case -104 =&amp;gt; &quot;Pmem limit exceeded&quot;;
    +            case _ =&amp;gt; &quot;&quot;
    +          }
&lt;p&gt;    +          messageListener foreach {&lt;br/&gt;
    +            _ ! decorateMessage(&lt;br/&gt;
    +              YarnMessage(s&quot;Diagnostics for containerID=${status.getContainerId} in &quot; +&lt;br/&gt;
    +                s&quot;state=${status.getState}.\n${status.getDiagnostics} $detail&quot;)&lt;br/&gt;
    +            )&lt;br/&gt;
    +          }&lt;br/&gt;
    +      }&lt;br/&gt;
    +&lt;br/&gt;
    +      runningContainersList = remainingRunningContainers&lt;br/&gt;
    +&lt;br/&gt;
    +      // maxFailedContainers == -1 is infinite number of retries.&lt;br/&gt;
    +      if (maxFailedContainers != -1 &amp;amp;&amp;amp; failedContainers &amp;gt;= maxFailedContainers) {&lt;br/&gt;
    +        val msg = s&quot;Stopping YARN session because the number of failed &quot; +&lt;br/&gt;
    +          s&quot;containers ($failedContainers) exceeded the maximum failed container &quot; +&lt;br/&gt;
    +          s&quot;count ($maxFailedContainers). This number is controlled by &quot; +&lt;br/&gt;
    +          s&quot;the &apos;${ConfigConstants.YARN_MAX_FAILED_CONTAINERS}&apos; configuration &quot; +&lt;br/&gt;
    +          s&quot;setting. By default its the number of requested containers&quot;&lt;br/&gt;
    +        log.error(msg)&lt;br/&gt;
    +        self ! decorateMessage(StopYarnSession(FinalApplicationStatus.FAILED, msg))&lt;br/&gt;
    +&lt;br/&gt;
    +      }&lt;br/&gt;
    +&lt;br/&gt;
    +      allocateContainers()&lt;br/&gt;
    +&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onContainersAllocated(containers: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;Container&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    +      println(&quot;onContainersAllocated&quot;)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Looks like a leftover debug message&lt;/p&gt;</comment>
                            <comment id="15057676" author="githubbot" created="Tue, 15 Dec 2015 09:08:43 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47611847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47611847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/ApplicationClient.scala &amp;#8212;&lt;br/&gt;
    @@ -29,6 +31,7 @@ import org.apache.flink.runtime.akka.AkkaUtils&lt;br/&gt;
     import org.apache.flink.runtime.yarn.FlinkYarnClusterStatus&lt;br/&gt;
     import org.apache.flink.yarn.YarnMessages._&lt;br/&gt;
     import scala.collection.mutable&lt;br/&gt;
    +import scala.concurrent.Await&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    These imports are probably unused&lt;/p&gt;</comment>
                            <comment id="15057683" author="githubbot" created="Tue, 15 Dec 2015 09:15:10 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47612509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47612509&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Why are we not sending a `StopYarnSession` message when this callback is called?&lt;/p&gt;</comment>
                            <comment id="15057687" author="githubbot" created="Tue, 15 Dec 2015 09:19:04 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47612925&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47612925&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = &lt;/p&gt;
{
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onNodesUpdated(updatedNodes: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;NodeReport&amp;#93;&lt;/span&gt;): Unit = {    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onContainersCompleted(statuses: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerStatus&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +      // TODO change this&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    TODO? Why not changing this?&lt;/p&gt;</comment>
                            <comment id="15057689" author="githubbot" created="Tue, 15 Dec 2015 09:20:07 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#issuecomment-164696473&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#issuecomment-164696473&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve tested the change on a cluster and everything is working fine.&lt;br/&gt;
    I had some minor comments.&lt;/p&gt;</comment>
                            <comment id="15058018" author="githubbot" created="Tue, 15 Dec 2015 12:58:11 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47632106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47632106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = &lt;/p&gt;
{
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onNodesUpdated(updatedNodes: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;NodeReport&amp;#93;&lt;/span&gt;): Unit = {    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onContainersCompleted(statuses: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerStatus&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +      // TODO change this&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I wanted to remove the debug message here because heartbeat messages are processed in the heartbeat thread and logging a heartbeat on a callback does not really make sense. Thank you.&lt;/p&gt;</comment>
                            <comment id="15058019" author="githubbot" created="Tue, 15 Dec 2015 13:00:00 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47632302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47632302&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Very good question. I&apos;ll see if I can change that.&lt;/p&gt;</comment>
                            <comment id="15058020" author="githubbot" created="Tue, 15 Dec 2015 13:00:04 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47632308&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47632308&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/ApplicationClient.scala &amp;#8212;&lt;br/&gt;
    @@ -29,6 +31,7 @@ import org.apache.flink.runtime.akka.AkkaUtils&lt;br/&gt;
     import org.apache.flink.runtime.yarn.FlinkYarnClusterStatus&lt;br/&gt;
     import org.apache.flink.yarn.YarnMessages._&lt;br/&gt;
     import scala.collection.mutable&lt;br/&gt;
    +import scala.concurrent.Await&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yep. Thanks.&lt;/p&gt;</comment>
                            <comment id="15058021" author="githubbot" created="Tue, 15 Dec 2015 13:00:07 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47632315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47632315&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = &lt;/p&gt;
{
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onNodesUpdated(updatedNodes: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;NodeReport&amp;#93;&lt;/span&gt;): Unit = {    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onContainersCompleted(statuses: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerStatus&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +      // TODO change this&lt;br/&gt;
    +      log.debug(s&quot;Processed Heartbeat with RMClient. Running containers $runningContainers, &quot; +&lt;br/&gt;
    +        s&quot;failed containers $failedContainers, &quot; +&lt;br/&gt;
    +        s&quot;allocated containers ${allocatedContainersList.size}.&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +      val completedContainerStatuses = statuses.asScala&lt;br/&gt;
    +      val idStatusMap = completedContainerStatuses&lt;br/&gt;
    +        .map(status =&amp;gt; (status.getContainerId, status)).toMap&lt;br/&gt;
    +&lt;br/&gt;
    +      completedContainerStatuses.foreach {&lt;br/&gt;
    +        status =&amp;gt; log.info(s&quot;Container ${status.getContainerId} is completed &quot; +&lt;br/&gt;
    +          s&quot;with diagnostics: ${status.getDiagnostics}&quot;)&lt;br/&gt;
    +      }&lt;br/&gt;
    +&lt;br/&gt;
    +      // get failed containers (returned containers are also completed, so we have to&lt;br/&gt;
    +      // distinguish if it was running before).&lt;br/&gt;
    +      val (completedContainers, remainingRunningContainers) = runningContainersList&lt;br/&gt;
    +        .partition(idStatusMap contains _.getId)&lt;br/&gt;
    +&lt;br/&gt;
    +      completedContainers.foreach {&lt;br/&gt;
    +        container =&amp;gt;&lt;br/&gt;
    +          val status = idStatusMap(container.getId)&lt;br/&gt;
    +          failedContainers += 1&lt;br/&gt;
    +          runningContainers -= 1&lt;br/&gt;
    +          log.info(s&quot;Container ${status.getContainerId} was a running container. &quot; +&lt;br/&gt;
    +            s&quot;Total failed containers $failedContainers.&quot;)&lt;br/&gt;
    +          val detail = status.getExitStatus match &lt;/p&gt;
{
    +            case -103 =&amp;gt; &quot;Vmem limit exceeded&quot;;
    +            case -104 =&amp;gt; &quot;Pmem limit exceeded&quot;;
    +            case _ =&amp;gt; &quot;&quot;
    +          }
&lt;p&gt;    +          messageListener foreach {&lt;br/&gt;
    +            _ ! decorateMessage(&lt;br/&gt;
    +              YarnMessage(s&quot;Diagnostics for containerID=${status.getContainerId} in &quot; +&lt;br/&gt;
    +                s&quot;state=${status.getState}.\n${status.getDiagnostics} $detail&quot;)&lt;br/&gt;
    +            )&lt;br/&gt;
    +          }&lt;br/&gt;
    +      }&lt;br/&gt;
    +&lt;br/&gt;
    +      runningContainersList = remainingRunningContainers&lt;br/&gt;
    +&lt;br/&gt;
    +      // maxFailedContainers == -1 is infinite number of retries.&lt;br/&gt;
    +      if (maxFailedContainers != -1 &amp;amp;&amp;amp; failedContainers &amp;gt;= maxFailedContainers) {&lt;br/&gt;
    +        val msg = s&quot;Stopping YARN session because the number of failed &quot; +&lt;br/&gt;
    +          s&quot;containers ($failedContainers) exceeded the maximum failed container &quot; +&lt;br/&gt;
    +          s&quot;count ($maxFailedContainers). This number is controlled by &quot; +&lt;br/&gt;
    +          s&quot;the &apos;${ConfigConstants.YARN_MAX_FAILED_CONTAINERS}&apos; configuration &quot; +&lt;br/&gt;
    +          s&quot;setting. By default its the number of requested containers&quot;&lt;br/&gt;
    +        log.error(msg)&lt;br/&gt;
    +        self ! decorateMessage(StopYarnSession(FinalApplicationStatus.FAILED, msg))&lt;br/&gt;
    +&lt;br/&gt;
    +      }&lt;br/&gt;
    +&lt;br/&gt;
    +      allocateContainers()&lt;br/&gt;
    +&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onContainersAllocated(containers: JavaList&lt;span class=&quot;error&quot;&gt;&amp;#91;Container&amp;#93;&lt;/span&gt;): Unit = {&lt;br/&gt;
    +      println(&quot;onContainersAllocated&quot;)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yep. Thanks.&lt;/p&gt;</comment>
                            <comment id="15058137" author="githubbot" created="Tue, 15 Dec 2015 14:35:19 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47642396&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47642396&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I&apos;m running into &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-1842&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-1842&lt;/a&gt; in the tests. This is a race condition between the application master (shutting down) and the yarn client (killing the application and removing it from the cache) which leads to a &lt;/p&gt;

&lt;p&gt;        org.apache.hadoop.yarn.exceptions.InvalidApplicationMasterRequestException: Application doesn&apos;t exist in cache appattempt_1450184990589_0005_000001&lt;br/&gt;
    	at org.apache.hadoop.yarn.server.resourcemanager.ApplicationMasterService.throwApplicationDoesNotExistInCacheException(ApplicationMasterService.java:329)&lt;br/&gt;
    	at org.apache.hadoop.yarn.server.resourcemanager.ApplicationMasterService.finishApplicationMaster(ApplicationMasterService.java:288)&lt;br/&gt;
    	at org.apache.hadoop.yarn.api.impl.pb.service.ApplicationMasterProtocolPBServiceImpl.finishApplicationMaster(ApplicationMasterProtocolPBServiceImpl.java:75)&lt;br/&gt;
    	at org.apache.hadoop.yarn.proto.ApplicationMasterProtocol$ApplicationMasterProtocolService$2.callBlockingMethod(ApplicationMasterProtocol.java:97)&lt;br/&gt;
    	at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:585)&lt;br/&gt;
    	at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:928)&lt;br/&gt;
    	at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1962)&lt;br/&gt;
    	at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1958)&lt;br/&gt;
    	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    	at javax.security.auth.Subject.doAs(Subject.java:422)&lt;br/&gt;
    	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)&lt;br/&gt;
    	at org.apache.hadoop.ipc.Server$Handler.run(Server.java:1956)&lt;/p&gt;

&lt;p&gt;    when unregistering the resource manager client. I think we have to catch this exception when it occurs while unregistering the application master.&lt;/p&gt;

&lt;p&gt;    For an explanation see also&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-1842?focusedCommentId=13977886&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13977886&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-1842?focusedCommentId=13977886&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13977886&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15058142" author="githubbot" created="Tue, 15 Dec 2015 14:37:24 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47642649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47642649&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -754,6 +538,243 @@ class YarnJobManager(&lt;br/&gt;
           memoryLimit&lt;br/&gt;
         }&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Heartbeats with the resource manager and handles container updates.&lt;br/&gt;
    +    */&lt;br/&gt;
    +  object AMRMClientAsyncHandler extends AMRMClientAsync.CallbackHandler {&lt;br/&gt;
    +&lt;br/&gt;
    +    private var client : AMRMClientAsync&lt;span class=&quot;error&quot;&gt;&amp;#91;ContainerRequest&amp;#93;&lt;/span&gt; = null&lt;br/&gt;
    +&lt;br/&gt;
    +    override def onError(e: Throwable): Unit = &lt;/p&gt;
{
    +      self ! decorateMessage(
    +        StopYarnSession(
    +          FinalApplicationStatus.FAILED,
    +          &quot;Error in communication with Yarn resource manager: &quot; + e.getMessage)
    +      )
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def getProgress: Float = &lt;/p&gt;
{
    +      runningContainers.toFloat / numTaskManagers
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    override def onShutdownRequest(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Note, that this is only after I add the `StopYarnSession` to the callback.&lt;/p&gt;</comment>
                            <comment id="15058149" author="githubbot" created="Tue, 15 Dec 2015 14:40:57 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#issuecomment-164783687&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#issuecomment-164783687&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the comments. I&apos;ve updated the pull request.&lt;/p&gt;</comment>
                            <comment id="15058218" author="githubbot" created="Tue, 15 Dec 2015 15:38:09 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47651966&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47651966&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -155,12 +156,14 @@ class YarnJobManager(&lt;/p&gt;

&lt;p&gt;           rmClientOption foreach {&lt;br/&gt;
             rmClient =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover{&lt;br/&gt;
    +          Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover {&lt;br/&gt;
    +            // &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-1842&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-1842&lt;/a&gt;&lt;br/&gt;
    +            case e : InvalidApplicationMasterRequestException =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    How about at least logging the exception to make sure we are not silently swallowing the exception.&lt;/p&gt;</comment>
                            <comment id="15058244" author="githubbot" created="Tue, 15 Dec 2015 16:02:11 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47656011&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47656011&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -155,12 +156,14 @@ class YarnJobManager(&lt;/p&gt;

&lt;p&gt;           rmClientOption foreach {&lt;br/&gt;
             rmClient =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover{&lt;br/&gt;
    +          Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover {&lt;br/&gt;
    +            // &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-1842&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-1842&lt;/a&gt;&lt;br/&gt;
    +            case e : InvalidApplicationMasterRequestException =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Okay, I think the cleaner solution is to ignore the shutdown request callback. This changes nothing about the current behavior of the YarnJobManager and keeps the code clean of such unfortunate workarounds. Do you approve?&lt;/p&gt;</comment>
                            <comment id="15058250" author="githubbot" created="Tue, 15 Dec 2015 16:08:11 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47656932&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47656932&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -155,12 +156,14 @@ class YarnJobManager(&lt;/p&gt;

&lt;p&gt;           rmClientOption foreach {&lt;br/&gt;
             rmClient =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover{&lt;br/&gt;
    +          Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover {&lt;br/&gt;
    +            // &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-1842&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-1842&lt;/a&gt;&lt;br/&gt;
    +            case e : InvalidApplicationMasterRequestException =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, lets ignore the shutdown callback. YARN will kill our container anyways.&lt;/p&gt;</comment>
                            <comment id="15058260" author="githubbot" created="Tue, 15 Dec 2015 16:19:09 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#discussion_r47658721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#discussion_r47658721&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/scala/org/apache/flink/yarn/YarnJobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -155,12 +156,14 @@ class YarnJobManager(&lt;/p&gt;

&lt;p&gt;           rmClientOption foreach {&lt;br/&gt;
             rmClient =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover{&lt;br/&gt;
    +          Try(rmClient.unregisterApplicationMaster(status, diag, &quot;&quot;)).recover {&lt;br/&gt;
    +            // &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-1842&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-1842&lt;/a&gt;&lt;br/&gt;
    +            case e : InvalidApplicationMasterRequestException =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Ok, updated.&lt;/p&gt;</comment>
                            <comment id="15059729" author="githubbot" created="Wed, 16 Dec 2015 09:14:55 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450#issuecomment-165042507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450#issuecomment-165042507&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If no objections, I&apos;d like to merge this soon. Travis failures are unrelated to Yarn.&lt;/p&gt;</comment>
                            <comment id="15062094" author="githubbot" created="Thu, 17 Dec 2015 14:20:49 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1450&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15062095" author="mxm" created="Thu, 17 Dec 2015 14:21:24 +0000"  >&lt;p&gt;4e52fe4304566e5239996b3d48290e0c1f0772e8&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12862231">FLINK-2629</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pjl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>