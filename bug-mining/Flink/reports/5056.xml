<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21139] ThresholdMeterTest.testMarkMultipleEvents unstable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-21139</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The test &lt;tt&gt;ThresholdMeterTest.testMarkMultipleEvents&lt;/tt&gt; seems to be unstable.&lt;/p&gt;

&lt;p&gt;The version of Flink is&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;$ git log -1&lt;/cite&gt;&lt;br/&gt;
&lt;cite&gt;commit 6e77cfdff8a358adab4ab770a503197d95a64440 (HEAD -&amp;gt; master, origin/master, origin/HEAD)&lt;/cite&gt;&lt;br/&gt;
&lt;cite&gt;Author: Roman Khachatryan &amp;lt;khachatryan.roman@gmail.com&amp;gt;&lt;/cite&gt;&lt;br/&gt;
&lt;cite&gt;Date: Fri Jan 22 14:39:48 2021 +0100&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;The test fails with the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Expected: a numeric value within &amp;lt;1.0E-6&amp;gt; of &amp;lt;40.0&amp;gt;
     but: &amp;lt;0.0&amp;gt; differed by &amp;lt;39.999999&amp;gt;
	at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)
	at org.junit.Assert.assertThat(Assert.java:956)
	at org.junit.Assert.assertThat(Assert.java:923)
	at org.apache.flink.metrics.ThresholdMeterTest.testMarkMultipleEvents(ThresholdMeterTest.java:58)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:27)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junitcore.JUnitCore.run(JUnitCore.java:55)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.createRequestAndRun(JUnitCoreWrapper.java:137)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.executeLazy(JUnitCoreWrapper.java:119)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:87)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:75)
	at org.apache.maven.surefire.junitcore.JUnitCoreProvider.invoke(JUnitCoreProvider.java:158)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;$ java -version &amp;amp;&amp;amp; javac -version&lt;br/&gt;
openjdk version &quot;11.0.8&quot; 2020-07-14&lt;br/&gt;
OpenJDK Runtime Environment AdoptOpenJDK (build 11.0.8+10-202007292333)&lt;br/&gt;
Eclipse OpenJ9 VM AdoptOpenJDK (build master-dc7cbe4bd, JRE 11 Linux riscv-64-Bit Compressed References 20200729_78 (JIT disabled, AOT disabled)&lt;br/&gt;
OpenJ9 - dc7cbe4bd&lt;br/&gt;
OMR - 1c0299f20&lt;br/&gt;
JCL - 94b9d6d2c6 based on jdk-11.0.8+10)&lt;br/&gt;
javac 11.0.8&lt;br/&gt;
$ uname -a&lt;br/&gt;
Linux test-gdams-debian10-riscv64-1.adoptopenjdk.net 5.0.0-rc1-56210-g0a657e0d72f0 #1 SMP Fri May 15 18:05:26 EDT 2020 riscv64 GNU/Linux&lt;br/&gt;
$ cat /proc/cpuinfo&lt;br/&gt;
processor : 0&lt;br/&gt;
hart : 1&lt;br/&gt;
isa : rv64imafdc&lt;br/&gt;
mmu : sv39&lt;br/&gt;
uarch : sifive,rocket0&lt;/p&gt;</environment>
        <key id="13354550">FLINK-21139</key>
            <summary>ThresholdMeterTest.testMarkMultipleEvents unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ZhenqiuHuang">Zhenqiu Huang</assignee>
                                    <reporter username="oceanfish81">Ivan Serdyuk</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 25 Jan 2021 23:47:37 +0000</created>
                <updated>Fri, 28 May 2021 08:16:02 +0000</updated>
                            <resolved>Tue, 2 Feb 2021 01:50:12 +0000</resolved>
                                                    <fixVersion>1.13.0</fixVersion>
                                    <component>API / Core</component>
                    <component>Benchmarks</component>
                    <component>Build System</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17272098" author="till.rohrmann" created="Tue, 26 Jan 2021 13:14:55 +0000"  >&lt;p&gt;Thanks for reporting this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=oceanfish81&quot; class=&quot;user-hover&quot; rel=&quot;oceanfish81&quot;&gt;oceanfish81&lt;/a&gt;. The unstable test has been introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10868&quot; title=&quot;Flink&amp;#39;s JobCluster ResourceManager doesn&amp;#39;t use maximum-failed-containers as limit of resource acquirement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10868&quot;&gt;&lt;del&gt;FLINK-10868&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hpeter&quot; class=&quot;user-hover&quot; rel=&quot;hpeter&quot;&gt;hpeter&lt;/a&gt; could you take a look at this problem?&lt;/p&gt;</comment>
                            <comment id="17272103" author="till.rohrmann" created="Tue, 26 Jan 2021 13:19:58 +0000"  >&lt;p&gt;Looking at the code of &lt;tt&gt;ThresholdMeter&lt;/tt&gt; it looks that we are using &lt;tt&gt;System.currentTimeMillis&lt;/tt&gt;. I think this is not optimal because &lt;tt&gt;System.currentTimeMillis&lt;/tt&gt; can be subject to clock jumps. I think it would be better to use &lt;tt&gt;Clock&lt;/tt&gt; here.&lt;/p&gt;</comment>
                            <comment id="17272297" author="zhenqiuhuang" created="Tue, 26 Jan 2021 18:09:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; &lt;br/&gt;
Sure. Please assign it to me to fix it today.&lt;/p&gt;</comment>
                            <comment id="17272518" author="xintongsong" created="Wed, 27 Jan 2021 02:14:06 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=oceanfish81&quot; class=&quot;user-hover&quot; rel=&quot;oceanfish81&quot;&gt;oceanfish81&lt;/a&gt; for reporting this and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; for looking into this.&lt;/p&gt;

&lt;p&gt;+1 for improve the testability by injecting a &lt;tt&gt;Clock&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ZhenqiuHuang&quot; class=&quot;user-hover&quot; rel=&quot;ZhenqiuHuang&quot;&gt;ZhenqiuHuang&lt;/a&gt; for offering to fix this. I&apos;ve assigned you, please go ahead.&lt;/p&gt;</comment>
                            <comment id="17275780" author="zhenqiuhuang" created="Sun, 31 Jan 2021 05:00:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;&lt;br/&gt;
The ManualClock is defined in flink-core. Currently, ThresholdMeter is defined in flink-metrics. I feel it is not wise to make flink-metrics dependent on flink-core module. Any suggestions about this?&lt;/p&gt;</comment>
                            <comment id="17275790" author="xintongsong" created="Sun, 31 Jan 2021 06:32:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ZhenqiuHuang&quot; class=&quot;user-hover&quot; rel=&quot;ZhenqiuHuang&quot;&gt;ZhenqiuHuang&lt;/a&gt;,&lt;br/&gt;
Maybe we can move &lt;tt&gt;ThreasholdMeter&lt;/tt&gt; to &lt;tt&gt;org.apache.flink.runtime.metrics&lt;/tt&gt;. There&apos;s already &lt;tt&gt;TimerGauge&lt;/tt&gt;, which also uses &lt;tt&gt;Clock&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17275963" author="zhenqiuhuang" created="Sun, 31 Jan 2021 19:32:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;&lt;br/&gt;
Make sense. Just created the PR. Please review it when you have time.&lt;/p&gt;</comment>
                            <comment id="17276788" author="xintongsong" created="Tue, 2 Feb 2021 01:50:12 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;master (1.13): b9e576fb845b817d804da3d68471ff8a4723dcf3&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13198103">FLINK-10868</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mzaw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>