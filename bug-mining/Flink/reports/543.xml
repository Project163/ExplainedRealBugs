<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:20:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2543] State handling does not support deserializing classes through the UserCodeClassloader</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2543</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The current implementation of the state checkpointing does not support custom classes, because the UserCodeClassLoader is not used to deserialize the state.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error: java.lang.RuntimeException: Failed to deserialize state handle and setup initial &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; state.
at org.apache.flink.runtime.taskmanager.Task.run(Task.java:544)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.ClassNotFoundException: com.ottogroup.bi.searchlab.searchsessionizer.OperatorState
at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:424)
at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348)
at java.io.ObjectInputStream.resolveClass(ObjectInputStream.java:626)
at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1613)
at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1518)
at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1774)
at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)
at java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)
at org.apache.flink.runtime.state.ByteStreamStateHandle.getState(ByteStreamStateHandle.java:63)
at org.apache.flink.runtime.state.ByteStreamStateHandle.getState(ByteStreamStateHandle.java:33)
at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.restoreInitialState(AbstractUdfStreamOperator.java:83)
at org.apache.flink.streaming.runtime.tasks.StreamTask.setInitialState(StreamTask.java:276)
at org.apache.flink.runtime.state.StateUtils.setOperatorState(StateUtils.java:51)
at org.apache.flink.runtime.taskmanager.Task.run(Task.java:541)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue has been reported by a user: &lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Custom-Class-for-state-checkpointing-td2415.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Custom-Class-for-state-checkpointing-td2415.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12856899">FLINK-2543</key>
            <summary>State handling does not support deserializing classes through the UserCodeClassloader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rmetzger">Robert Metzger</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2015 12:08:35 +0000</created>
                <updated>Thu, 28 Feb 2019 11:15:07 +0000</updated>
                            <resolved>Sun, 30 Aug 2015 18:47:01 +0000</resolved>
                                    <version>0.9</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14704577" author="rmetzger" created="Thu, 20 Aug 2015 09:25:58 +0000"  >&lt;p&gt;Just a quick update on this: I have a fix for the issue, but while working on it I found another bug with our user class handling.&lt;br/&gt;
Once the other bug is fixed as well, I&apos;ll open a PR.&lt;/p&gt;</comment>
                            <comment id="14709200" author="githubbot" created="Mon, 24 Aug 2015 12:45:58 +0000"  >&lt;p&gt;GitHub user rmetzger opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2543&quot; title=&quot;State handling does not support deserializing classes through the UserCodeClassloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2543&quot;&gt;&lt;del&gt;FLINK-2543&lt;/del&gt;&lt;/a&gt; Fix user object deserialization for user state&lt;/p&gt;

&lt;p&gt;    File-based state handles were using the system classloader to deserialize the state object.&lt;/p&gt;

&lt;p&gt;    Exceptions send from the JobManager to the JobClient were relying on Akka&apos;s JavaSerialization, which does not have access to the user code classloader.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rmetzger/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rmetzger/flink&lt;/a&gt; flink2543&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1048&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f5a642267a5ce69018d900398e4eb5134b2ea747&lt;br/&gt;
Author: Robert Metzger &amp;lt;rmetzger@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-08-18T16:15:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2543&quot; title=&quot;State handling does not support deserializing classes through the UserCodeClassloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2543&quot;&gt;&lt;del&gt;FLINK-2543&lt;/del&gt;&lt;/a&gt; Fix user object deserialization for file-based state handles. Send exceptions from JM --&amp;gt; JC in serialized form&lt;/p&gt;

&lt;p&gt;    Exceptions send from the JobManager to the JobClient were relying on Akka&apos;s JavaSerialization, which does not have access to the user code classloader.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14709263" author="githubbot" created="Mon, 24 Aug 2015 13:19:52 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37749500&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37749500&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/LocalExecutor.java &amp;#8212;&lt;br/&gt;
    @@ -176,8 +175,7 @@ public JobExecutionResult executePlan(Plan plan) throws Exception {&lt;br/&gt;
     				JobGraph jobGraph = jgg.compileJobGraph(op);&lt;/p&gt;

&lt;p&gt;     				boolean sysoutPrint = isPrintingStatusDuringExecution();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SerializedJobExecutionResult result = flink.submitJobAndWait(jobGraph,sysoutPrint);&lt;/li&gt;
	&lt;li&gt;return result.toJobExecutionResult(ClassLoader.getSystemClassLoader());&lt;br/&gt;
    +				return flink.submitJobAndWait(jobGraph,sysoutPrint);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Missing space...&lt;/p&gt;</comment>
                            <comment id="14709307" author="githubbot" created="Mon, 24 Aug 2015 13:46:03 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37752056&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37752056&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/util/SerializedThrowable.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,106 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.flink.runtime.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.google.common.base.Preconditions;&lt;br/&gt;
    +import org.apache.flink.util.ExceptionUtils;&lt;br/&gt;
    +import org.apache.flink.util.InstantiationUtil;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Utility class for dealing with serialized Throwables.&lt;br/&gt;
    + * Needed to send around user-specific exception classes with Akka.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class SerializedThrowable implements Serializable {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    no serialVersionUID&lt;/p&gt;</comment>
                            <comment id="14709308" author="githubbot" created="Mon, 24 Aug 2015 13:46:33 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-134206474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-134206474&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good, modulo some minor comments. But maybe @tillrohrmann has something to say, let&apos;s wait for him. &lt;/p&gt;</comment>
                            <comment id="14709328" author="githubbot" created="Mon, 24 Aug 2015 13:57:38 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37753243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37753243&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/client/JobClient.java &amp;#8212;&lt;br/&gt;
    @@ -123,12 +122,12 @@ public static InetSocketAddress getJobManagerAddress(Configuration config) throw&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@throws org.apache.flink.runtime.client.JobExecutionException Thrown if the job&lt;/li&gt;
	&lt;li&gt;execution fails.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SerializedJobExecutionResult submitJobAndWait(&lt;br/&gt;
    +	public static JobExecutionResult submitJobAndWait(&lt;br/&gt;
     			ActorSystem actorSystem,&lt;br/&gt;
     			ActorGateway jobManagerGateway,&lt;br/&gt;
     			JobGraph jobGraph,&lt;br/&gt;
     			FiniteDuration timeout,&lt;/li&gt;
	&lt;li&gt;boolean sysoutLogUpdates) throws JobExecutionException {&lt;br/&gt;
    +			boolean sysoutLogUpdates, ClassLoader usercodeClassloader) throws JobExecutionException {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Style: Why appending the new parameter to the last line when all the other parameters are written in a new line?&lt;/p&gt;</comment>
                            <comment id="14709333" author="githubbot" created="Mon, 24 Aug 2015 14:00:53 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37753621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37753621&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java &amp;#8212;&lt;br/&gt;
    @@ -1028,8 +1029,12 @@ public void registerExecutionListener(ActorGateway listener) {&lt;/p&gt;

&lt;p&gt;     	private void notifyJobStatusChange(JobStatus newState, Throwable error) {&lt;br/&gt;
     		if (jobStatusListenerActors.size() &amp;gt; 0) {&lt;br/&gt;
    +			SerializedThrowable st = null;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `st` is not really descriptive. A slightly longer variable name could be helpful.&lt;/p&gt;</comment>
                            <comment id="14709337" author="githubbot" created="Mon, 24 Aug 2015 14:04:51 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37753999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37753999&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/TaskExecutionState.java &amp;#8212;&lt;br/&gt;
    @@ -160,19 +123,10 @@ public TaskExecutionState(JobID jobID, ExecutionAttemptID executionId,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;job this update refers to.&lt;br/&gt;
     	 */&lt;br/&gt;
     	public Throwable getError(ClassLoader usercodeClassloader) {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (this.serializedError == null) {&lt;br/&gt;
    +		if (this.throwable == null) 
{
     			return null;
     		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (this.cachedError == null) {&lt;/li&gt;
	&lt;li&gt;try 
{
    -				cachedError = (Throwable) InstantiationUtil.deserializeObject(this.serializedError, usercodeClassloader);
    -			}&lt;/li&gt;
	&lt;li&gt;catch (Exception e) 
{
    -				throw new RuntimeException(&quot;Error while deserializing the attached exception&quot;, e);
    -			}&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;return this.cachedError;&lt;br/&gt;
    +		return throwable.getError(usercodeClassloader);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Could we place the last return in an else branch to make the control flow clearer?&lt;/p&gt;</comment>
                            <comment id="14709341" author="githubbot" created="Mon, 24 Aug 2015 14:07:25 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37754281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37754281&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/util/SerializedThrowable.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,106 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.flink.runtime.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.google.common.base.Preconditions;&lt;br/&gt;
    +import org.apache.flink.util.ExceptionUtils;&lt;br/&gt;
    +import org.apache.flink.util.InstantiationUtil;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Utility class for dealing with serialized Throwables.&lt;br/&gt;
    + * Needed to send around user-specific exception classes with Akka.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class SerializedThrowable implements Serializable {&lt;br/&gt;
    +	private final byte[] serializedError;&lt;br/&gt;
    +&lt;br/&gt;
    +	// The exception must not be (de)serialized with the class, as its&lt;br/&gt;
    +	// class may not be part of the system class loader.&lt;br/&gt;
    +	private transient Throwable cachedError;&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Create a new SerializedThrowable.&lt;br/&gt;
    +	 * @param error The exception to serialize.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public SerializedThrowable(Throwable error) {&lt;br/&gt;
    +		Preconditions.checkNotNull(error, &quot;The exception to serialize has to be set&quot;);&lt;br/&gt;
    +		this.cachedError = error;&lt;br/&gt;
    +		byte[] serializedError;&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			serializedError = InstantiationUtil.serializeObject(error);
    +		}
&lt;p&gt;    +		catch (Throwable t) {&lt;br/&gt;
    +			// could not serialize exception. send the stringified version instead&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				this.cachedError = new Exception(ExceptionUtils.stringifyException(error));
    +				serializedError = InstantiationUtil.serializeObject(this.cachedError);
    +			}
&lt;p&gt;    +			catch (Throwable tt) {&lt;br/&gt;
    +				// seems like we cannot do much to report the actual exception&lt;br/&gt;
    +				// report a placeholder instead&lt;br/&gt;
    +				try &lt;/p&gt;
{
    +					this.cachedError = new Exception(&quot;Cause is a &apos;&quot; + error.getClass().getName()
    +							+ &quot;&apos; (failed to serialize or stringify)&quot;);
    +					serializedError = InstantiationUtil.serializeObject(this.cachedError);
    +				}
&lt;p&gt;    +				catch (Throwable ttt) &lt;/p&gt;
{
    +					// this should never happen unless the JVM is fubar.
    +					// we just report the state without the error
    +					this.cachedError = null;
    +					serializedError = null;
    +				}
&lt;p&gt;    +			}&lt;br/&gt;
    +		}&lt;br/&gt;
    +		this.serializedError = serializedError;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public Throwable getError(ClassLoader usercodeClassloader) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    What kind of camel case is `usercodeClassloader`?&lt;/p&gt;</comment>
                            <comment id="14709343" author="githubbot" created="Mon, 24 Aug 2015 14:09:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37754479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37754479&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -327,8 +327,11 @@ class JobManager(&lt;br/&gt;
           currentJobs.get(jobID) match {&lt;br/&gt;
             case Some((executionGraph, jobInfo)) =&amp;gt; executionGraph.getJobName&lt;/p&gt;

&lt;p&gt;    +          val deserializedError = if(error != null) {&lt;br/&gt;
    +            error.getError(executionGraph.getUserClassLoader)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    why not renaming `error.getError` =&amp;gt; `serializedError.deserializeError`? Makes things a little bit clearer.&lt;/p&gt;</comment>
                            <comment id="14709346" author="githubbot" created="Mon, 24 Aug 2015 14:12:02 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37754792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37754792&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/messages/ExecutionGraphMessages.scala &amp;#8212;&lt;br/&gt;
    @@ -80,7 +81,7 @@ object ExecutionGraphMessages {&lt;br/&gt;
           jobID: JobID,&lt;br/&gt;
           newJobStatus: JobStatus,&lt;br/&gt;
           timestamp: Long,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;error: Throwable)&lt;br/&gt;
    +      error: SerializedThrowable)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why not giving the serialized throwable a name which indicates that it&apos;s actually a serialized throwable?&lt;/p&gt;</comment>
                            <comment id="14709366" author="githubbot" created="Mon, 24 Aug 2015 14:25:00 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37756262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37756262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/client/JobClient.java &amp;#8212;&lt;br/&gt;
    @@ -160,12 +159,12 @@ public static SerializedJobExecutionResult submitJobAndWait(&lt;/p&gt;

&lt;p&gt;     				SerializedJobExecutionResult result = ((JobManagerMessages.JobResultSuccess) answer).result();&lt;br/&gt;
     				if (result != null) &lt;/p&gt;
{
    -					return result;
    +					return result.toJobExecutionResult(usercodeClassloader);
     				}
&lt;p&gt; else &lt;/p&gt;
{
     					throw new Exception(&quot;Job was successfully executed but result contained a null JobExecutionResult.&quot;);
     				}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;} else if (answer instanceof Status.Failure) 
{
    -				throw ((Status.Failure) answer).cause();
    +			}
&lt;p&gt; else if (answer instanceof JobClientMessages.JobFailure) {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why do we introduce a new `JobFailure` message here? Can&apos;t we simply let our `SerializedThrowable` class inherit from `Exception` and send it as a failure over the network? We then only have to add in the outer try block a catch block which deserializes the wrapped exception.&lt;/p&gt;</comment>
                            <comment id="14709368" author="githubbot" created="Mon, 24 Aug 2015 14:25:42 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r37756350&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r37756350&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/client/JobClientActor.java &amp;#8212;&lt;br/&gt;
    @@ -128,6 +128,13 @@ else if (message instanceof Status.Success) &lt;/p&gt;
{
     			// job was successfully submitted :-)
     			logger.info(&quot;Job was successfully submitted to the JobManager&quot;);
     		}
&lt;p&gt;    +		else if (message instanceof JobClientMessages.JobFailure) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Wrapping the `SerializedThrowable` in a `Failure` would allow us to get rid off this if branch.&lt;/p&gt;</comment>
                            <comment id="14709376" author="githubbot" created="Mon, 24 Aug 2015 14:29:20 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-134226512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-134226512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I had some comments. The main question is why do we introduce a new `JobFailure` message instead of treating a `SerializedThrowable` as what it is, namely a `Failure`. If we let `SerializedThrowable` extend `Exception`, then we could send the serialized throwable over the network using a `Failure`, like any other exception. Thus there are no duplicate code paths. Only at the receiving end, we have to check for a `SerializedThrowable` and deserialize the wrapped exception to obtain the original value. &lt;/p&gt;</comment>
                            <comment id="14711343" author="githubbot" created="Tue, 25 Aug 2015 14:16:24 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-134600109&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-134600109&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I made the SerializedThrowable an Exception and removed the `JobFailure` message again.&lt;/p&gt;</comment>
                            <comment id="14716364" author="githubbot" created="Thu, 27 Aug 2015 09:32:31 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135363969&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135363969&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I addressed all PR comments.&lt;/p&gt;</comment>
                            <comment id="14716370" author="githubbot" created="Thu, 27 Aug 2015 09:36:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078076&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/client/JobClient.java &amp;#8212;&lt;br/&gt;
    @@ -177,9 +176,18 @@ public static SerializedJobExecutionResult submitJobAndWait(&lt;br/&gt;
     			throw new JobTimeoutException(jobGraph.getJobID(), &quot;Timeout while waiting for JobManager answer. &quot; +&lt;br/&gt;
     					&quot;Job time exceeded &quot; + AkkaUtils.INF_TIMEOUT(), e);&lt;br/&gt;
     		}&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;catch (Throwable t) {&lt;br/&gt;
    +		catch(SerializedThrowable serializedThrowable) {&lt;br/&gt;
    +			Throwable deserialized = SerializedThrowable.get(serializedThrowable, userCodeClassloader);&lt;br/&gt;
    +			if(deserialized instanceof JobExecutionException) 
{
    +				// no need to wrap the Throwable into a JobExecutionException again.
    +				throw (JobExecutionException)deserialized;
    +			}
&lt;p&gt;    +			throw new JobExecutionException(jobGraph.getJobID(),&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can we put this statement in an `else` branch?&lt;/p&gt;</comment>
                            <comment id="14716376" author="githubbot" created="Thu, 27 Aug 2015 09:38:33 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078252&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -349,27 +351,29 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;                   case JobStatus.CANCELED =&amp;gt;&lt;br/&gt;
                     jobInfo.client ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Failure(&lt;/li&gt;
	&lt;li&gt;new JobCancellationException(&lt;/li&gt;
	&lt;li&gt;jobID,&lt;/li&gt;
	&lt;li&gt;&quot;Job was cancelled.&quot;, error)&lt;br/&gt;
    +                  Failure(new SerializedThrowable(&lt;br/&gt;
    +                      new JobCancellationException(&lt;br/&gt;
    +                        jobID,&lt;br/&gt;
    +                      &quot;Job was cancelled.&quot;, deserializedError)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Indentation and line breaks&lt;/p&gt;</comment>
                            <comment id="14716380" author="githubbot" created="Thu, 27 Aug 2015 09:40:32 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078400&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -349,27 +351,29 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;                   case JobStatus.CANCELED =&amp;gt;&lt;br/&gt;
                     jobInfo.client ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Failure(&lt;/li&gt;
	&lt;li&gt;new JobCancellationException(&lt;/li&gt;
	&lt;li&gt;jobID,&lt;/li&gt;
	&lt;li&gt;&quot;Job was cancelled.&quot;, error)&lt;br/&gt;
    +                  Failure(new SerializedThrowable(&lt;br/&gt;
    +                      new JobCancellationException(&lt;br/&gt;
    +                        jobID,&lt;br/&gt;
    +                      &quot;Job was cancelled.&quot;, deserializedError)&lt;br/&gt;
    +                    )&lt;br/&gt;
                       )&lt;br/&gt;
                     )&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                   case JobStatus.FAILED =&amp;gt;&lt;br/&gt;
                     jobInfo.client ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Failure(&lt;/li&gt;
	&lt;li&gt;new JobExecutionException(&lt;/li&gt;
	&lt;li&gt;jobID,&lt;/li&gt;
	&lt;li&gt;&quot;Job execution failed.&quot;,&lt;/li&gt;
	&lt;li&gt;error)&lt;br/&gt;
    +                  Failure(new SerializedThrowable(&lt;br/&gt;
    +                      new JobExecutionException(&lt;br/&gt;
    +                        jobID,&lt;br/&gt;
    +                        &quot;Job execution failed.&quot;,&lt;br/&gt;
    +                        deserializedError)&lt;br/&gt;
    +                    )&lt;br/&gt;
                       )&lt;br/&gt;
                     )&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                   case x =&amp;gt;&lt;br/&gt;
                     val exception = new JobExecutionException(jobID, s&quot;$x is not a &quot; +&lt;br/&gt;
                       &quot;terminal state.&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jobInfo.client ! decorateMessage(Failure(exception))&lt;br/&gt;
    +                jobInfo.client ! decorateMessage(Failure(new SerializedThrowable(exception)))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Do we really need to serialize the `JobExecutionException` in a `SerializedThrowable` here?&lt;/p&gt;</comment>
                            <comment id="14716381" author="githubbot" created="Thu, 27 Aug 2015 09:41:16 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078466&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078466&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/minicluster/FlinkMiniCluster.scala &amp;#8212;&lt;br/&gt;
    @@ -239,7 +239,7 @@ abstract class FlinkMiniCluster(&lt;/p&gt;

&lt;p&gt;       @throws(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;JobExecutionException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
       def submitJobAndWait(jobGraph: JobGraph, printUpdates: Boolean)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;: SerializedJobExecutionResult = {&lt;br/&gt;
    +                                                                : JobExecutionResult = {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Indentation?&lt;/p&gt;</comment>
                            <comment id="14716385" author="githubbot" created="Thu, 27 Aug 2015 09:42:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078531&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078531&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/resources/log4j-test.properties &amp;#8212;&lt;br/&gt;
    @@ -18,7 +18,7 @@&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Set root logger level to OFF to not flood build logs&lt;/li&gt;
	&lt;li&gt;set manually to INFO for debugging purposes&lt;br/&gt;
    -log4j.rootLogger=OFF, testlogger&lt;br/&gt;
    +log4j.rootLogger=INFO, testlogger
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Unintended commit?&lt;/p&gt;</comment>
                            <comment id="14716390" author="githubbot" created="Thu, 27 Aug 2015 09:45:58 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078804&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078804&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -349,27 +351,29 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;                   case JobStatus.CANCELED =&amp;gt;&lt;br/&gt;
                     jobInfo.client ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Failure(&lt;/li&gt;
	&lt;li&gt;new JobCancellationException(&lt;/li&gt;
	&lt;li&gt;jobID,&lt;/li&gt;
	&lt;li&gt;&quot;Job was cancelled.&quot;, error)&lt;br/&gt;
    +                  Failure(new SerializedThrowable(&lt;br/&gt;
    +                      new JobCancellationException(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why do we have to serialize the `JobCancellationException` here? Isn&apos;t it enough to only serialize the error transferred with the `JobStatusChanged` message?&lt;/p&gt;</comment>
                            <comment id="14716392" author="githubbot" created="Thu, 27 Aug 2015 09:46:26 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#discussion_r38078839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#discussion_r38078839&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -349,27 +351,29 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;                   case JobStatus.CANCELED =&amp;gt;&lt;br/&gt;
                     jobInfo.client ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Failure(&lt;/li&gt;
	&lt;li&gt;new JobCancellationException(&lt;/li&gt;
	&lt;li&gt;jobID,&lt;/li&gt;
	&lt;li&gt;&quot;Job was cancelled.&quot;, error)&lt;br/&gt;
    +                  Failure(new SerializedThrowable(&lt;br/&gt;
    +                      new JobCancellationException(&lt;br/&gt;
    +                        jobID,&lt;br/&gt;
    +                      &quot;Job was cancelled.&quot;, deserializedError)&lt;br/&gt;
    +                    )&lt;br/&gt;
                       )&lt;br/&gt;
                     )&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                   case JobStatus.FAILED =&amp;gt;&lt;br/&gt;
                     jobInfo.client ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Failure(&lt;/li&gt;
	&lt;li&gt;new JobExecutionException(&lt;/li&gt;
	&lt;li&gt;jobID,&lt;/li&gt;
	&lt;li&gt;&quot;Job execution failed.&quot;,&lt;/li&gt;
	&lt;li&gt;error)&lt;br/&gt;
    +                  Failure(new SerializedThrowable(&lt;br/&gt;
    +                      new JobExecutionException(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Same here with the serialization of `JobExecutionException`.&lt;/p&gt;</comment>
                            <comment id="14716394" author="githubbot" created="Thu, 27 Aug 2015 09:46:39 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135367041&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135367041&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I had some more comments.&lt;/p&gt;</comment>
                            <comment id="14718383" author="githubbot" created="Fri, 28 Aug 2015 11:38:22 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135746206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135746206&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I am trying this out right now.&lt;/p&gt;

&lt;p&gt;    It stands in conflict with other pending pull requests that actually want to get the &quot;job-specificness&quot; out of the Client, which means foremost dropping the classloader in the client. This pull request bakes the classloader in even more.&lt;/p&gt;

&lt;p&gt;    The next thing where I am unsure about is the &quot;SerializedThrowable&quot;. I am personally a big fan of making things explicit. If something comes back that needs explicit deserialization, it should look like this. Currently, we hope that everyone remembers to check whether the exception is a serialized throwable. it not, we silently loose cause and stack trace.&lt;/p&gt;</comment>
                            <comment id="14718385" author="githubbot" created="Fri, 28 Aug 2015 11:39:54 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135746375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135746375&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Actually, we can somewhat ignore the first problem - it seems that we can rebase the client refactoring pull requests well onto this.&lt;/p&gt;</comment>
                            <comment id="14718389" author="githubbot" created="Fri, 28 Aug 2015 11:43:16 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135746761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135746761&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay, one change I would like to do during merging is to not deserialize exceptions on the JobManager. I would extend the SerializedThrowable to include the original message and original stack trace so that it can be printed / logged just like the original exception. Exceptions in the execution graph would always be serialized exceptions always as well.&lt;/p&gt;</comment>
                            <comment id="14718451" author="githubbot" created="Fri, 28 Aug 2015 12:21:36 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135758781&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135758781&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    What do you mean with making things explicit? Sending a dedicated message or sending a `SerializedThrowable` which extends `Exception`?&lt;/p&gt;</comment>
                            <comment id="14718453" author="githubbot" created="Fri, 28 Aug 2015 12:24:13 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135759647&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135759647&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In the first version of this pull request I was sending a `JobFailure(st: SerializedThrowable)` in case of an error.&lt;br/&gt;
    The `SerializedThrowable` did not extend Exception. This way, users had to really manually turn the response into a Throwable.&lt;/p&gt;</comment>
                            <comment id="14718493" author="githubbot" created="Fri, 28 Aug 2015 12:46:17 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135765919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135765919&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Explicit would mean here to send something where the receiver knows that he has to deserialize. Whether through a dedicated message, or a SerializedThrowable that is NOT a Throwable would not make much difference.&lt;/p&gt;</comment>
                            <comment id="14718512" author="githubbot" created="Fri, 28 Aug 2015 12:55:53 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135767450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135767450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree. In both cases the compiler cannot help much to avoid forgetting about it and, thus, it&apos;s the responsibility of the programmer to make sure that the failure case is handled properly. It should be added to the description of the `JobSubmitAndWait` message what can expected as the return value of the future.&lt;/p&gt;</comment>
                            <comment id="14718529" author="githubbot" created="Fri, 28 Aug 2015 13:06:24 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135769165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135769165&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have now actually a pretty interesting solution. I changed the SerializedThrowable such that it looks like the original exception, with respect to message, stack trace, printing, etc. Logging the serialized throwable, for example, looks like logging the original exception. If one forgets to de-serialize it, it is not super bad any more.&lt;/p&gt;

&lt;p&gt;    Furthermore, the SerializedThrowable is not unwrapped when sent by a TaskManager to the JobManager, but kept as it is (skip some work).&lt;/p&gt;

&lt;p&gt;    When sending an exception back to the client, the original message is sent back. Which may be a SerializedThrowable (if it originated at the workers) or not (if it originated at the JobManager, such as missing resources).&lt;/p&gt;

&lt;p&gt;    The client would still need to check and deserialize like it does now.&lt;/p&gt;</comment>
                            <comment id="14718531" author="githubbot" created="Fri, 28 Aug 2015 13:07:55 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135769797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135769797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The added advantage of that approach s that we keep no user exceptions alive in the execution graph.&lt;/p&gt;

&lt;p&gt;    Not keeping those alive is quite desirable, actually, to allow user code unloading.&lt;/p&gt;</comment>
                            <comment id="14718532" author="githubbot" created="Fri, 28 Aug 2015 13:08:50 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135770247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135770247&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    That sounds very good.&lt;/p&gt;</comment>
                            <comment id="14718533" author="githubbot" created="Fri, 28 Aug 2015 13:09:50 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135770745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135770745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The `SerializedThrowable` is then a subclass of `Exception`?&lt;/p&gt;

&lt;p&gt;    I think it&apos;s a very good solution to not deserialize the exception on the `JobManager`.&lt;/p&gt;</comment>
                            <comment id="14718538" author="githubbot" created="Fri, 28 Aug 2015 13:11:53 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135771604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135771604&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann Yes, it is still a subclass of `Exception` and thrown in the regular way by the Akka `Failure` response.&lt;/p&gt;</comment>
                            <comment id="14718549" author="githubbot" created="Fri, 28 Aug 2015 13:22:06 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135774461&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135774461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I like this solution &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14719285" author="githubbot" created="Fri, 28 Aug 2015 14:44:57 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135793797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135793797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hmm... the more I work on it, the trickier it appears.&lt;/p&gt;

&lt;p&gt;    It is efficient when done rigth, but one needs to watch carefully at what places to wrap an exception and when not.&lt;/p&gt;

&lt;p&gt;    The solution to always serialize/deserialize manually during transport is far easier, actually...&lt;/p&gt;</comment>
                            <comment id="14719286" author="githubbot" created="Fri, 28 Aug 2015 14:45:22 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135793882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135793882&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Only disadvantage is that archived execution graphs prevent user class unloading...&lt;/p&gt;</comment>
                            <comment id="14720014" author="githubbot" created="Fri, 28 Aug 2015 15:34:37 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135808065&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135808065&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I would like to revert the thing back to not use serialized throwable at all.&lt;/p&gt;

&lt;p&gt;    The SerializedThrowable would be used only in archived execution graphs, to make sure no user code exceptions remain.&lt;/p&gt;

&lt;p&gt;    That way, we have a crystal clear separation of concerns. Not everyone failing something is concerned with watching for serializability.&lt;/p&gt;</comment>
                            <comment id="14720033" author="githubbot" created="Fri, 28 Aug 2015 15:49:08 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135811858&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135811858&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure whether this would solve the initial problem. I thought the problem was that a user code exception can be sent from the `JobManager` to the `JobClientActor` which will cause Akka to fail while serializing it.&lt;/p&gt;</comment>
                            <comment id="14720036" author="githubbot" created="Fri, 28 Aug 2015 15:50:40 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135812417&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135812417&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sending a stringified exception is not an option between jm and client because the user might rely on the exception in the RemoteExecEnv.&lt;/p&gt;</comment>
                            <comment id="14720045" author="githubbot" created="Fri, 28 Aug 2015 15:56:57 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048#issuecomment-135813751&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048#issuecomment-135813751&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Right, I am going for an explicit serialized form of the exception at this point.&lt;/p&gt;</comment>
                            <comment id="14721659" author="githubbot" created="Sun, 30 Aug 2015 18:46:10 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1048&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1048&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14721661" author="stephanewen" created="Sun, 30 Aug 2015 18:47:01 +0000"  >&lt;p&gt;Fixed via bf8c8e54094151348caedd3120931516f76c3cf3 and 0ba53558f9b56b1e17c84ab8e4ee639ca09b9133&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j1un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>