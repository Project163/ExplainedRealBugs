<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3971] Aggregates handle null values incorrectly.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3971</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Table API and SQL aggregates are supposed to ignore null values, e.g., &lt;tt&gt;sum(1,2,null,4)&lt;/tt&gt; is supposed to return &lt;tt&gt;7&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;There current implementation is correct if at least one valid value is present however, is incorrect if only null values are aggregated. &lt;tt&gt;sum(null, null, null)&lt;/tt&gt; should return &lt;tt&gt;null&lt;/tt&gt; instead of &lt;tt&gt;0&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Currently only the Count aggregate handles the case of null-values-only correctly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12972737">FLINK-3971</key>
            <summary>Aggregates handle null values incorrectly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gallenvara_bg">GaoLun</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 May 2016 14:50:58 +0000</created>
                <updated>Tue, 14 Jun 2016 16:27:27 +0000</updated>
                            <resolved>Tue, 14 Jun 2016 16:27:27 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15301660" author="gallenvara_bg" created="Thu, 26 May 2016 07:17:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt; If no one work on this issue, i would have a try.&lt;/p&gt;</comment>
                            <comment id="15301691" author="fhueske" created="Thu, 26 May 2016 07:41:40 +0000"  >&lt;p&gt;Sure, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gallenvara_bg&quot; class=&quot;user-hover&quot; rel=&quot;gallenvara_bg&quot;&gt;gallenvara_bg&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15306505" author="githubbot" created="Mon, 30 May 2016 10:42:45 +0000"  >&lt;p&gt;GitHub user gallenvara opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3971&quot; title=&quot;Aggregates handle null values incorrectly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3971&quot;&gt;&lt;del&gt;FLINK-3971&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tableAPI&amp;#93;&lt;/span&gt; Aggregates handle null values incorrectly.&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Null-values-only aggregation handling in Max/Min/Average/Sum.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/gallenvara/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gallenvara/flink&lt;/a&gt; flink-3971&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2049&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cb39f098e5cea0867fc63c8661257cc9664a4882&lt;br/&gt;
Author: gallenvara &amp;lt;gallenvara@126.com&amp;gt;&lt;br/&gt;
Date:   2016-05-30T10:30:07Z&lt;/p&gt;

&lt;p&gt;    Null-values-only aggregation handling.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15307470" author="githubbot" created="Tue, 31 May 2016 09:09:20 +0000"  >&lt;p&gt;Github user gallenvara commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#issuecomment-222633219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#issuecomment-222633219&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske I have changed the return type to generic `T` in `AvgAggregation` class because when return `null.asInstanceof&lt;span class=&quot;error&quot;&gt;&amp;#91;Short/Int/..&amp;#93;&lt;/span&gt;` , the value can convert to `0`.&lt;/p&gt;</comment>
                            <comment id="15310722" author="githubbot" created="Wed, 1 Jun 2016 17:34:17 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the PR @gallenvara. I&apos;m currently on vacation with limited access to internet. Will review your PR when I am back in roughly a week.&lt;/p&gt;</comment>
                            <comment id="15324684" author="githubbot" created="Fri, 10 Jun 2016 15:59:40 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638155&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/AvgAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -66,51 +66,63 @@ abstract class IntegralAvgAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; extends AvgAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; &lt;/p&gt;
{
       def doPrepare(value: Any, partial: Row): Unit
     }

&lt;p&gt;    -class ByteAvgAggregate extends IntegralAvgAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +class ByteAvgAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; extends IntegralAvgAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think it would be cleaner to keep the `Byte` type parameter.&lt;br/&gt;
    How about we add an abstract method `def doEvaluate(buffer: Row): Any` to `IntegralAvgAggregate`. &lt;br/&gt;
    The subclasses of `IntegralAvgAggregate` implement `doEvaluate` like `ByteAvgAggregate`:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    override def doEvaluate(buffer: Row): Any = {&lt;br/&gt;
      val bufferSum = buffer.productElement(partialSumIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt;&lt;br/&gt;
      val bufferCount = buffer.productElement(partialCountIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt;&lt;br/&gt;
      if (bufferCount == 0L) &lt;/p&gt;
{
        null
      }
&lt;p&gt; else &lt;/p&gt;
{
        (bufferSum / bufferCount).toByte
      }
&lt;p&gt;    }&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    and return an `Any` which is casted to `T` by `IntegralAvgAggregate.evaluate()` as follows:&lt;/p&gt;


&lt;p&gt;    ```&lt;br/&gt;
    override def evaluate(buffer: Row): T = &lt;/p&gt;
{
      doEvaluate(buffer).asInstanceOf[T]
    }
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    Same for the `FloatingAvgAggregate` and its subclasses.&lt;/p&gt;</comment>
                            <comment id="15324685" author="githubbot" created="Fri, 10 Jun 2016 16:00:48 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638346&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638346&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/MaxAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -48,8 +48,16 @@ abstract class MaxAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(implicit ord: Ordering&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) extends Aggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; {&lt;br/&gt;
       override def merge(intermediate: Row, buffer: Row): Unit = {&lt;br/&gt;
         val partialValue = intermediate.productElement(maxIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;br/&gt;
         val bufferValue = buffer.productElement(maxIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val max: T = if (ord.compare(partialValue, bufferValue) &amp;gt; 0) partialValue else bufferValue&lt;/li&gt;
	&lt;li&gt;buffer.setField(maxIndex, max)&lt;br/&gt;
    +    if (partialValue == null &amp;amp;&amp;amp; bufferValue == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can we reorder the `if else` cases to move the common case of `partialValue != null &amp;amp;&amp;amp; bufferValue != null` to the top?&lt;/p&gt;</comment>
                            <comment id="15324686" author="githubbot" created="Fri, 10 Jun 2016 16:01:25 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638439&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/MaxAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -48,8 +48,16 @@ abstract class MaxAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(implicit ord: Ordering&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) extends Aggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; {&lt;br/&gt;
       override def merge(intermediate: Row, buffer: Row): Unit = {&lt;br/&gt;
         val partialValue = intermediate.productElement(maxIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;br/&gt;
         val bufferValue = buffer.productElement(maxIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val max: T = if (ord.compare(partialValue, bufferValue) &amp;gt; 0) partialValue else bufferValue&lt;/li&gt;
	&lt;li&gt;buffer.setField(maxIndex, max)&lt;br/&gt;
    +    if (partialValue == null &amp;amp;&amp;amp; bufferValue == null) {&lt;br/&gt;
    +      buffer.setField(maxIndex, null.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    When setting a field in a `Row` to `null` we do not need to cast.&lt;/p&gt;</comment>
                            <comment id="15324689" author="githubbot" created="Fri, 10 Jun 2016 16:01:40 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638477&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/MaxAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -74,7 +82,7 @@ class ByteMaxAggregate extends MaxAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt; {&lt;br/&gt;
       override def intermediateDataType = Array(BasicTypeInfo.BYTE_TYPE_INFO)&lt;/p&gt;

&lt;p&gt;       override def initiate(intermediate: Row): Unit = {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;intermediate.setField(maxIndex, Byte.MinValue)&lt;br/&gt;
    +    intermediate.setField(maxIndex, null.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No cast necessary&lt;/p&gt;</comment>
                            <comment id="15324690" author="githubbot" created="Fri, 10 Jun 2016 16:02:56 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638676&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638676&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/MinAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -48,8 +48,16 @@ abstract  class MinAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(implicit ord: Ordering&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) extends Aggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;{&lt;br/&gt;
       override def merge(partial: Row, buffer: Row): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    all comments on `MaxAggregate` apply here as well.&lt;/p&gt;</comment>
                            <comment id="15324694" author="githubbot" created="Fri, 10 Jun 2016 16:03:25 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638756&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/SumAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -27,13 +27,21 @@ abstract class SumAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T: Numeric&amp;#93;&lt;/span&gt;&lt;br/&gt;
       protected var sumIndex: Int = _&lt;/p&gt;

&lt;p&gt;       override def initiate(partial: Row): Unit = &lt;/p&gt;
{
    -    partial.setField(sumIndex, numeric.zero)
    +    partial.setField(sumIndex, null.asInstanceOf[T])
       }

&lt;p&gt;       override def merge(partial1: Row, buffer: Row): Unit = {&lt;br/&gt;
         val partialValue = partial1.productElement(sumIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;br/&gt;
         val bufferValue = buffer.productElement(sumIndex).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;buffer.setField(sumIndex, numeric.plus(partialValue, bufferValue))&lt;br/&gt;
    +    if (partialValue == null &amp;amp;&amp;amp; bufferValue == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Please reorder `if else` cases as in `MaxAggregate`&lt;/p&gt;</comment>
                            <comment id="15324695" author="githubbot" created="Fri, 10 Jun 2016 16:03:32 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66638771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66638771&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/SumAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -27,13 +27,21 @@ abstract class SumAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T: Numeric&amp;#93;&lt;/span&gt;&lt;br/&gt;
       protected var sumIndex: Int = _&lt;/p&gt;

&lt;p&gt;       override def initiate(partial: Row): Unit = {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;partial.setField(sumIndex, numeric.zero)&lt;br/&gt;
    +    partial.setField(sumIndex, null.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No cast necessary.&lt;/p&gt;</comment>
                            <comment id="15324709" author="githubbot" created="Fri, 10 Jun 2016 16:10:58 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @gallenvara, thanks for the PR. &lt;br/&gt;
    I added a few comments inline. Can you in addition extend the `CountAggregateTest` with an all-null case? &lt;/p&gt;

&lt;p&gt;    Thanks, Fabian&lt;/p&gt;</comment>
                            <comment id="15326910" author="githubbot" created="Mon, 13 Jun 2016 07:06:57 +0000"  >&lt;p&gt;Github user gallenvara commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske sorry for the late update. Codes have been modified based on your comments.&lt;/p&gt;</comment>
                            <comment id="15327050" author="githubbot" created="Mon, 13 Jun 2016 09:22:18 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66762005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66762005&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/MaxAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -48,8 +57,16 @@ abstract class MaxAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(implicit ord: Ordering&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) extends Aggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; {&lt;br/&gt;
       override def merge(intermediate: Row, buffer: Row): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think we can make this method a bit more efficient:&lt;br/&gt;
    ```&lt;br/&gt;
    val partialValue = ...&lt;br/&gt;
    if (partialValue != null) {&lt;br/&gt;
      val bufferValue = ...&lt;br/&gt;
      if (bufferValue != null) &lt;/p&gt;
{
        val max = ...
        buffer.setField(maxIndex, max)
      }
&lt;p&gt; else &lt;/p&gt;
{
        buffer.setField(maxIndex, partialValue)
      }
&lt;p&gt;    }&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    Same applies for `MinAggregate` and `SumAggregate`.&lt;/p&gt;</comment>
                            <comment id="15327053" author="githubbot" created="Mon, 13 Jun 2016 09:23:23 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @gallenvara, thanks for the update! Looks good. After my last comment is fix, the PR should be good to merge. Thanks, Fabian&lt;/p&gt;</comment>
                            <comment id="15327083" author="githubbot" created="Mon, 13 Jun 2016 09:45:08 +0000"  >&lt;p&gt;Github user gallenvara commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049#discussion_r66765029&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049#discussion_r66765029&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/runtime/aggregate/MaxAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -48,8 +57,16 @@ abstract class MaxAggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(implicit ord: Ordering&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) extends Aggregate&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; {&lt;br/&gt;
       override def merge(intermediate: Row, buffer: Row): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes, you are right. The cases where `partialValue == null` should be ignored directly.&lt;/p&gt;</comment>
                            <comment id="15327084" author="githubbot" created="Mon, 13 Jun 2016 09:45:34 +0000"  >&lt;p&gt;Github user gallenvara commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske fixed! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15327580" author="githubbot" created="Mon, 13 Jun 2016 15:17:41 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the fast update @gallenvara. Good to merge!&lt;/p&gt;</comment>
                            <comment id="15327689" author="githubbot" created="Mon, 13 Jun 2016 16:24:41 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @gallenvara, you have a merge commit in your changes.&lt;br/&gt;
    Can you rebase your changes to the current master and squash the commits? &lt;br/&gt;
    Thanks!&lt;/p&gt;</comment>
                            <comment id="15328667" author="githubbot" created="Tue, 14 Jun 2016 00:05:26 +0000"  >&lt;p&gt;Github user gallenvara commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske Done.&lt;/p&gt;</comment>
                            <comment id="15329468" author="githubbot" created="Tue, 14 Jun 2016 13:09:48 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging&lt;/p&gt;</comment>
                            <comment id="15329805" author="fhueske" created="Tue, 14 Jun 2016 16:27:27 +0000"  >&lt;p&gt;Fixed with fdf43609977c807deb3bb81bf1095efb721fe688&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yhfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>