<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:44:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15911] Flink does not work over NAT</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15911</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, it is not possible to run Flink over network address translation. The problem is that the Flink processes do not allow to specify separate bind and external ports. Moreover, the &lt;tt&gt;TaskManager&lt;/tt&gt; tries to resolve the given &lt;tt&gt;taskmanager.host&lt;/tt&gt; which might not be resolvable. This breaks NAT or docker setups where the external address is not resolvable from within the container/internal network.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13283393">FLINK-15911</key>
            <summary>Flink does not work over NAT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xtsong">Xintong Song</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>usability</label>
                    </labels>
                <created>Wed, 5 Feb 2020 07:34:06 +0000</created>
                <updated>Mon, 22 Mar 2021 12:51:12 +0000</updated>
                            <resolved>Wed, 25 Mar 2020 01:28:02 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17041749" author="xintongsong" created="Fri, 21 Feb 2020 10:39:04 +0000"  >&lt;p&gt;I&apos;ve spent some time looking into this issue, together with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13171&quot; title=&quot;Add withParameters(Configuration) method to DataStream operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13171&quot;&gt;&lt;del&gt;FLINK-13171&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15154&quot; title=&quot;Change Flink binding addresses in local mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15154&quot;&gt;&lt;del&gt;FLINK-15154&lt;/del&gt;&lt;/a&gt;. I think these three ticket can be resolved together. Therefore, I&apos;m closing the other two tickets and working on this ticket.&lt;/p&gt;

&lt;p&gt;I&apos;m posting my proposed solution to this issue below, in case someone has a different thought.&lt;/p&gt;

&lt;p&gt;In addition to the current configuration options (&apos;jobmanager.rpc.&lt;span class=&quot;error&quot;&gt;&amp;#91;address|port&amp;#93;&lt;/span&gt;&apos;, &apos;taskmanager.&lt;span class=&quot;error&quot;&gt;&amp;#91;host|rpc.port&amp;#93;&lt;/span&gt;&apos;), I propose to introduce the 4 new config options: &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;jobmanager|taskmanager&amp;#93;&lt;/span&gt;.rpc.bind-&lt;span class=&quot;error&quot;&gt;&amp;#91;address|port&amp;#93;&lt;/span&gt;&apos;.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The original config options will be used to decided the exposed address and port, same as they are now.&lt;/li&gt;
	&lt;li&gt;The new config options will be used to decide the bind address and port, without default values.&lt;/li&gt;
	&lt;li&gt;If the bind address/port is not specified, by default JM/TM binds to the IP address 0.0.0.0 and the port that is exposed, same as the current behavior.&lt;/li&gt;
	&lt;li&gt;Note that, while &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;jobmanager|taskmanager&amp;#93;&lt;/span&gt;.rpc.port&apos; allows specifying a range of ports (e.g., 50100-50200) or any free port (if the value is 0), &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;jobmanager|taskmanager&amp;#93;&lt;/span&gt;.rpc.bind-port&apos; accepts only one specific non-zero port.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Minor: I&apos;m actually thinking about changing &apos;taskmanager.host&apos; to &apos;taskmanager.rpc.address&apos;, with backward compatibility on the old key, for unifying the config keys&apos; format. Not absolutely necessary though.&lt;/p&gt;</comment>
                            <comment id="17046718" author="till.rohrmann" created="Thu, 27 Feb 2020 15:12:29 +0000"  >&lt;p&gt;The plan sounds good to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;. Please go ahead with the implementation.&lt;/p&gt;</comment>
                            <comment id="17048809" author="xintongsong" created="Mon, 2 Mar 2020 05:59:40 +0000"  >&lt;p&gt;Some updates on this ticket.&lt;/p&gt;

&lt;p&gt;I&apos;ve decoupled bind-address/bind-port from the address/port of JM/TM RPC services, verified successfully with a docker-based e2e test with the default parallelism 1. But I run into problems when increasing the parallelism to have multiple TMs, because TMs failed to find each other&apos;s Netty shuffle address/port.&lt;/p&gt;

&lt;p&gt;I talked to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt;&#160;offline. He confirmed that Netty shuffle service uses TM address in two ways:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The address passed into NettyShuffleEnvironment is used for binding to the local address. It should use the bind-address.&lt;/li&gt;
	&lt;li&gt;The address wrapped in TaskManagerLocation will be sent to JobMaster, which will be used by tasks for accessing the TM&apos;s shuffle service.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will continue trying to resolve address/port problem of Netty shuffle service.&lt;/p&gt;

&lt;p&gt;In addition, the address/port and bind-address/bind-port of the following services may also need to separated. I would like to exclude them from the scope of this ticket, to keep a minimum set of changes in this ticket for getting Flink work over NAT.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Blob Server on JM. This is only needed if we we want to submit jobs from outside of NAT to a Flink session cluster whose JM runs behind NAT. I will try to address this in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15154&quot; title=&quot;Change Flink binding addresses in local mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15154&quot;&gt;&lt;del&gt;FLINK-15154&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;KvStateService on TM. This is only used for queryable state, which I&apos;m not sure how many use cases do we have. Also, I&apos;m not familiar with how the KvStateService works. If we want to get it work over NAT, I would need help from someone familiar with it.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17065828" author="till.rohrmann" created="Tue, 24 Mar 2020 14:27:36 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;03b6e763d5578c3b503246a2a40e5fd1fb990570&lt;br/&gt;
8a1dbcc07d6b4ed7702741cd8b1c73d95f0d2583&lt;br/&gt;
3c997796e3aa6c4498849bcb029ffe6f5db515fc&lt;br/&gt;
9dc7a4a47f85153b98e1f50eb8917dd6c8e15c85&lt;br/&gt;
5c35d9d95144593193244a07b965e310707488a9&lt;/p&gt;</comment>
                            <comment id="17066307" author="xintongsong" created="Wed, 25 Mar 2020 01:27:46 +0000"  >&lt;p&gt;Reopen to add release notes.&lt;/p&gt;</comment>
                            <comment id="17305826" author="bo cui" created="Mon, 22 Mar 2021 02:17:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt; in yarn cluster, what are  bind-address of JM&amp;amp;TM&#65311; It is not a good practice to listen on all interfaces(0.0.0.0). and many companies are not allowed to listen on 0.0.0.0 or ::.&lt;br/&gt;
thx&lt;/p&gt;</comment>
                            <comment id="17305841" author="xintongsong" created="Mon, 22 Mar 2021 02:48:15 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bo+Cui&quot; class=&quot;user-hover&quot; rel=&quot;Bo Cui&quot;&gt;Bo Cui&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Could you explain why listening on 0.0.0.0 is not allowed? And if not 0.0.0.0, which address should flink bind to in your case?&lt;/p&gt;</comment>
                            <comment id="17305869" author="bo cui" created="Mon, 22 Mar 2021 03:30:27 +0000"  >&lt;p&gt;1&#12289;all 0 has some security risks.&lt;br/&gt;
2&#12289;i think add new config, like network.allow.listen.0, default true.  if false, we shold use other address&lt;/p&gt;</comment>
                            <comment id="17305874" author="xintongsong" created="Mon, 22 Mar 2021 03:46:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;1&#12289;all 0 has some security risks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Could you explain in specific what security risks are caused by listening to 0.0.0.0? Are all of your Yarn NM&apos;s exposed via external IP addressed? Shouldn&apos;t it be the responsibility of something like a firewall to prevent unwanted accesses?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2&#12289;i think add new config, like network.allow.listen.0, default true. if false, we shold use other address&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The question is which &quot;other address&quot; should be used?&lt;/p&gt;</comment>
                            <comment id="17305915" author="bo cui" created="Mon, 22 Mar 2021 06:29:09 +0000"  >&lt;p&gt;1&#12289; all client IP can access the port through any NIC. yes ,the problem can be solved by using the firewall, but no network adapter is missing from the firewall, and it is not a good practice to listen on all interfaces&lt;br/&gt;
2&#12289;like &lt;a href=&quot;https://github.com/apache/flink/blob/a33e6bd390a9935c3e25b6913bed0ff6b4a78818/flink-yarn/src/main/java/org/apache/flink/yarn/YarnTaskExecutorRunner.java#L140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/a33e6bd390a9935c3e25b6913bed0ff6b4a78818/flink-yarn/src/main/java/org/apache/flink/yarn/YarnTaskExecutorRunner.java#L140&lt;/a&gt;, we can use taskmanager.host, or update value of taskmanager.bind-host in YarnTaskExecutorRunner#setupConfigurationFromVariables. Or other better way...&lt;br/&gt;
thx&lt;/p&gt;</comment>
                            <comment id="17305971" author="xintongsong" created="Mon, 22 Mar 2021 08:07:43 +0000"  >&lt;p&gt;I think it&apos;s a good practice to listen on as less interfaces as possible &lt;b&gt;only if&lt;/b&gt; we know which interface exactly should be used.&lt;/p&gt;

&lt;p&gt;In your case, IIUC, the security concern comes from the fact that there are multiple network interfaces on your Yarn NM machines, and not all of them are safe. IMO, this is a flaw of Yarn cluster management. Applications running on Yarn (i.e. Flink) should not understand which interface is safe and which is not. These physical specifications are supposed to be transparent to the applications.&lt;/p&gt;

&lt;p&gt;I&apos;m afraid binding to `taskmanager.host` is not an option.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This configuration option represents the external address that other peers should use to connect to the current peer. Depending on the network setups, this address may not be resolvable locally.&lt;/li&gt;
	&lt;li&gt;As the codes suggest, this configuration option may not alway be set. The value can be `null`.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17305982" author="bo cui" created="Mon, 22 Mar 2021 08:24:27 +0000"  >&lt;p&gt;got...thank you very much &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17306067" author="bo cui" created="Mon, 22 Mar 2021 09:49:00 +0000"  >&lt;p&gt;but &lt;b&gt;on yarn&lt;/b&gt;, taskmanager.host can not be null, and All addresses can be resolved locally. right&#65311; so we can update value of taskmanager.bind-host in YarnTaskExecutorRunner#setupConfigurationFromVariables&#65311; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17306072" author="xintongsong" created="Mon, 22 Mar 2021 10:03:36 +0000"  >&lt;p&gt;Isn&apos;t it depending on the machine setups that whether all addresses can be resolved locally?&lt;/p&gt;

&lt;p&gt;And most importantly, as explained above, I&apos;m not sure if the application should decide which network interface on the machine should be used.&lt;/p&gt;</comment>
                            <comment id="17306173" author="bo cui" created="Mon, 22 Mar 2021 12:48:32 +0000"  >&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13022768/13022768_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13022771/13022771_screenshot-2.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
 i think it might be better on yarn...taskExecutorHostname must be resolved&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure if the application should decide which network interface on the machine should be used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;TM use the IP address assigned by the JM.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13293573">FLINK-16751</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13273342">FLINK-15154</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13250778">FLINK-13717</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13022768" name="screenshot-1.png" size="28989" author="Bo Cui" created="Mon, 22 Mar 2021 12:44:23 +0000"/>
                            <attachment id="13022771" name="screenshot-2.png" size="4019" author="Bo Cui" created="Mon, 22 Mar 2021 12:44:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b62w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Flink now supports working over NAT networks, by configuring separated external and local bind addresses/ports.&lt;br/&gt;
&lt;br/&gt;
The following configuration options will be used for external addresses/ports.&lt;br/&gt;
* jobmanager.rpc.address&lt;br/&gt;
* jobmanager.rpc.port&lt;br/&gt;
* taskmanager.host&lt;br/&gt;
* taskmanager.rpc.port&lt;br/&gt;
* taskmanager.data.port&lt;br/&gt;
&lt;br/&gt;
The following configuration options will be used for local bind addresses/ports.&lt;br/&gt;
* jobmanager.bind-host&lt;br/&gt;
* jobmanager.rpc.bind-port&lt;br/&gt;
* taskmanager.bind-host&lt;br/&gt;
* taskmanager.rpc.bind-port&lt;br/&gt;
* taskmanager.data.bind-port&lt;br/&gt;
&lt;br/&gt;
Note: Currently, the new feature does not work with queryable state.&lt;br/&gt;
Note: If hostname is used for the external address of a Flink process (JM/TM), it is required to be resolvable from all the other processes (excluding itself).</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>