<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6103] LocalFileSystem rename() uses File.renameTo()</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6103</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I&apos;ve tried to move a directory to another on the LocalFilesystem and it doesn&apos;t work (in my case fs is an instance of java.io.UnixFileSystem).&lt;br/&gt;
As for Flink-1840 (there was a PR to fix the issue - &lt;a href=&quot;https://github.com/apache/flink/pull/578&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/578&lt;/a&gt;) the problem is that &lt;tt&gt;File.renameTo()&lt;/tt&gt; is not reliable.&lt;/p&gt;

&lt;p&gt;Indeed, the Javadoc says:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Renames the file denoted by this abstract pathname. Many aspects of the behavior of this method are inherently platform-dependent: The rename operation might not be able to move a file from one filesystem to another, it might not be atomic, and it might not succeed if a file with the destination abstract pathname already exists. The return value should always be checked to make sure that the rename operation was successful. Note that the java.nio.file.Files class defines the move method to move or rename a file in a platform independent manner&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13057028">FLINK-6103</key>
            <summary>LocalFileSystem rename() uses File.renameTo()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="f.pompermaier">Flavio Pompermaier</assignee>
                                    <reporter username="f.pompermaier">Flavio Pompermaier</reporter>
                        <labels>
                            <label>filesystem</label>
                    </labels>
                <created>Fri, 17 Mar 2017 15:20:01 +0000</created>
                <updated>Fri, 21 Apr 2017 07:56:49 +0000</updated>
                            <resolved>Fri, 21 Apr 2017 07:56:15 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15930143" author="f.pompermaier" created="Fri, 17 Mar 2017 15:34:23 +0000"  >&lt;p&gt;I&apos;ve tried &lt;tt&gt;com.google.common.io.Files.move()&lt;/tt&gt; and it doesn&apos;t work either with directories.&lt;/p&gt;

&lt;p&gt;Maybe it&apos;s better to follow &lt;a href=&quot;https://docs.oracle.com/javase/tutorial/essential/io/move.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/tutorial/essential/io/move.html&lt;/a&gt; and use &lt;tt&gt;Files.move(source, target, REPLACE_EXISTING)&lt;/tt&gt; ?&lt;/p&gt;</comment>
                            <comment id="15934866" author="stephanewen" created="Tue, 21 Mar 2017 16:47:03 +0000"  >&lt;p&gt;+1 to go with {{Files.move(source, target, REPLACE_EXISTING)}&lt;/p&gt;</comment>
                            <comment id="15936845" author="f.pompermaier" created="Wed, 22 Mar 2017 18:17:50 +0000"  >&lt;p&gt;Maybe also BlobServerConnection could benefit from the same fix (in order to avoid to rely on Guava)&lt;/p&gt;</comment>
                            <comment id="15937924" author="f.pompermaier" created="Thu, 23 Mar 2017 08:30:25 +0000"  >&lt;p&gt;Here&apos;s the PR link: &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15940053" author="githubbot" created="Fri, 24 Mar 2017 09:35:02 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598#discussion_r107863788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598#discussion_r107863788&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/core/fs/local/LocalFileSystem.java &amp;#8212;&lt;br/&gt;
    @@ -262,8 +265,13 @@ public FSDataOutputStream create(&lt;br/&gt;
     	public boolean rename(final Path src, final Path dst) throws IOException {&lt;br/&gt;
     		final File srcFile = pathToFile(src);&lt;br/&gt;
     		final File dstFile = pathToFile(dst);&lt;br/&gt;
    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return srcFile.renameTo(dstFile);&lt;br/&gt;
    +		//Files.move fails if the destination directory doesn&apos;t exist&lt;br/&gt;
    +		if(dstFile.getParentFile()!= null &amp;amp;&amp;amp; !dstFile.getParentFile().exists())
{
    +			Files.createDirectories(dstFile.getParentFile().toPath());
    +		}
&lt;p&gt;    +		//this throws an IOException if any error occurs&lt;br/&gt;
    +		Files.move(srcFile.toPath(), dstFile.toPath(), StandardCopyOption.REPLACE_EXISTING);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    If we want to preserve the old semantics, we should catch the exception and return `false` in that case.&lt;/p&gt;</comment>
                            <comment id="15940258" author="githubbot" created="Fri, 24 Mar 2017 12:49:31 +0000"  >&lt;p&gt;Github user fpompermaier commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598#discussion_r107894608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598#discussion_r107894608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/core/fs/local/LocalFileSystem.java &amp;#8212;&lt;br/&gt;
    @@ -262,8 +265,13 @@ public FSDataOutputStream create(&lt;br/&gt;
     	public boolean rename(final Path src, final Path dst) throws IOException {&lt;br/&gt;
     		final File srcFile = pathToFile(src);&lt;br/&gt;
     		final File dstFile = pathToFile(dst);&lt;br/&gt;
    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return srcFile.renameTo(dstFile);&lt;br/&gt;
    +		//Files.move fails if the destination directory doesn&apos;t exist&lt;br/&gt;
    +		if(dstFile.getParentFile()!= null &amp;amp;&amp;amp; !dstFile.getParentFile().exists())
{
    +			Files.createDirectories(dstFile.getParentFile().toPath());
    +		}
&lt;p&gt;    +		//this throws an IOException if any error occurs&lt;br/&gt;
    +		Files.move(srcFile.toPath(), dstFile.toPath(), StandardCopyOption.REPLACE_EXISTING);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    So why is the method trowing an IOException?&lt;/p&gt;</comment>
                            <comment id="15940518" author="githubbot" created="Fri, 24 Mar 2017 15:12:48 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598#discussion_r107925602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598#discussion_r107925602&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/core/fs/local/LocalFileSystem.java &amp;#8212;&lt;br/&gt;
    @@ -262,8 +265,13 @@ public FSDataOutputStream create(&lt;br/&gt;
     	public boolean rename(final Path src, final Path dst) throws IOException {&lt;br/&gt;
     		final File srcFile = pathToFile(src);&lt;br/&gt;
     		final File dstFile = pathToFile(dst);&lt;br/&gt;
    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return srcFile.renameTo(dstFile);&lt;br/&gt;
    +		//Files.move fails if the destination directory doesn&apos;t exist&lt;br/&gt;
    +		if(dstFile.getParentFile()!= null &amp;amp;&amp;amp; !dstFile.getParentFile().exists())
{
    +			Files.createDirectories(dstFile.getParentFile().toPath());
    +		}
&lt;p&gt;    +		//this throws an IOException if any error occurs&lt;br/&gt;
    +		Files.move(srcFile.toPath(), dstFile.toPath(), StandardCopyOption.REPLACE_EXISTING);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think that is inherited from the interface that is also used by the HdfsFileSystem. The outcomes are `true`(rename success), `false` (rename failed), and `IOExeption` (communication with filesystem failed).&lt;/p&gt;</comment>
                            <comment id="15943926" author="githubbot" created="Mon, 27 Mar 2017 19:45:20 +0000"  >&lt;p&gt;Github user fpompermaier commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Does the current exception handling address your comments @StephanEwen?&lt;/p&gt;</comment>
                            <comment id="15947043" author="githubbot" created="Wed, 29 Mar 2017 12:44:37 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think we don&apos;t need the logging in all of the cases. We typically avoid logging in &quot;utility functions&quot;, which are missing the context if the exception is in fact a problem worth mentioning, of if it only adds noise to the log.&lt;/p&gt;

&lt;p&gt;    Other than that, I think its good.&lt;/p&gt;</comment>
                            <comment id="15975002" author="githubbot" created="Wed, 19 Apr 2017 16:23:19 +0000"  >&lt;p&gt;Github user fpompermaier commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Anyone willing to merge this PR...?&lt;/p&gt;</comment>
                            <comment id="15975018" author="githubbot" created="Wed, 19 Apr 2017 16:30:07 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fpompermaier have you addressed the comment @StephanEwen regarding logging?&lt;/p&gt;</comment>
                            <comment id="15975242" author="githubbot" created="Wed, 19 Apr 2017 18:27:58 +0000"  >&lt;p&gt;Github user fpompermaier commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Of course..but how should I handle them? should I catch just one exception? What should I log?&lt;/p&gt;</comment>
                            <comment id="15975260" author="githubbot" created="Wed, 19 Apr 2017 18:38:39 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I would do the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;log nothing&lt;/li&gt;
	&lt;li&gt;Catch the errors that are regular &quot;move failed&quot; exceptions and return false.&lt;/li&gt;
	&lt;li&gt;`FileNotFoundException`&lt;/li&gt;
	&lt;li&gt;`DirectoryNotEmptyException`&lt;/li&gt;
	&lt;li&gt;`SecurityException`&lt;/li&gt;
	&lt;li&gt;Let all other `IOExceptions` bubble out&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15976167" author="githubbot" created="Thu, 20 Apr 2017 06:25:05 +0000"  >&lt;p&gt;Github user fpompermaier commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Now it should be ok&lt;/p&gt;</comment>
                            <comment id="15976373" author="githubbot" created="Thu, 20 Apr 2017 09:36:11 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks, I&apos;ll take it from here...&lt;/p&gt;</comment>
                            <comment id="15978250" author="stephanewen" created="Fri, 21 Apr 2017 07:56:16 +0000"  >&lt;p&gt;Fixed via a4f9a54953132fbd1a44888a403576c157649f1f and f9eac3afd4c613df8bc577c080e71230d98df87a&lt;/p&gt;</comment>
                            <comment id="15978252" author="githubbot" created="Fri, 21 Apr 2017 07:56:49 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3598&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cfhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>