<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:41:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13601] RegionFailoverITCase is unstable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13601</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Excerpt from &lt;a href=&quot;https://travis-ci.com/flink-ci/flink/jobs/222711830:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.com/flink-ci/flink/jobs/222711830:&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
10:44:31.222 [INFO] Running org.apache.flink.test.checkpointing.RegionFailoverITCase
org.apache.flink.client.program.ProgramInvocationException: Job failed (JobID: 9e0fbeaa580123e05cfce5554f443d23)
    at org.apache.flink.client.program.MiniClusterClient.submitJob(MiniClusterClient.java:92)
    at org.apache.flink.test.checkpointing.RegionFailoverITCase.testMultiRegionFailover(RegionFailoverITCase.java:132)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
    at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:298)
    at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:292)
    at java.util.concurrent.FutureTask.run(FutureTask.java:266)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.apache.flink.runtime.client.JobExecutionException: Job execution failed.
    at org.apache.flink.runtime.jobmaster.JobResult.toJobExecutionResult(JobResult.java:146)
    at org.apache.flink.client.program.MiniClusterClient.submitJob(MiniClusterClient.java:90)
    ... 13 more
Caused by: java.lang.RuntimeException: Test failed due to unexpected recovered index: 2000, &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; last completed checkpoint record index: 1837
    at org.apache.flink.test.checkpointing.RegionFailoverITCase$StringGeneratingSourceFunction.initializeState(RegionFailoverITCase.java:300)
    at org.apache.flink.streaming.util.functions.StreamingFunctionUtils.tryRestoreFunction(StreamingFunctionUtils.java:178)
    at org.apache.flink.streaming.util.functions.StreamingFunctionUtils.restoreFunctionState(StreamingFunctionUtils.java:160)
    at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.initializeState(AbstractUdfStreamOperator.java:96)
    at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:281)
    at org.apache.flink.streaming.runtime.tasks.StreamTask.initializeState(StreamTask.java:862)
    at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:367)
    at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:688)
    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:518)
    ... 1 more
10:44:39.210 [ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 7.983 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.test.checkpointing.RegionFailoverITCase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13249130">FLINK-13601</key>
            <summary>RegionFailoverITCase is unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunta">Yun Tang</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 6 Aug 2019 13:22:22 +0000</created>
                <updated>Fri, 18 Oct 2019 12:47:55 +0000</updated>
                            <resolved>Fri, 18 Oct 2019 12:47:54 +0000</resolved>
                                    <version>1.9.0</version>
                    <version>1.10.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16901047" author="aljoscha" created="Tue, 6 Aug 2019 13:24:35 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt;, I think you wrote the test.&lt;/p&gt;</comment>
                            <comment id="16901050" author="till.rohrmann" created="Tue, 6 Aug 2019 13:25:42 +0000"  >&lt;p&gt;If this is only a test instability, then we can decrease the priority of this issue to critical.&lt;/p&gt;</comment>
                            <comment id="16901363" author="yunta" created="Tue, 6 Aug 2019 18:34:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; After looking up the &lt;a href=&quot;https://transfer.sh/bNhvk/1452.8.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;detail log&lt;/a&gt; of&#160;&lt;a href=&quot;https://travis-ci.com/flink-ci/flink/jobs/222711830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;flink-ci-failure&lt;/a&gt;. I am pretty sure that this is a test instability.&lt;/p&gt;

&lt;p&gt;Currently, I use &lt;tt&gt;notifyCheckpointComplete&lt;/tt&gt; interface to record &lt;tt&gt;snapshotIndicesOfSubTask&lt;/tt&gt; and &lt;tt&gt;lastCompletedCheckpointId&lt;/tt&gt; on task side. However, the checkpoint 15 completed just after this task failed, and &lt;tt&gt;notifyCheckpointComplete&lt;/tt&gt; would not invoked on task side anymore since this the task has been failded. In other words, &lt;tt&gt;lastCompletedCheckpointId&lt;/tt&gt; would only be record as last complete checkpoint 14, which leads to the failure.&lt;br/&gt;
 Below is related code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void notifyCheckpointComplete(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; checkpointId) {
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getRuntimeContext().getIndexOfThisSubtask() == NUM_OF_REGIONS - 1) {
		lastCompletedCheckpointId.set(checkpointId);
		snapshotIndicesOfSubTask.put(checkpointId, lastRegionIndex);
		numCompletedCheckpoints.incrementAndGet();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And below is the logs which record this situation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
10:44:38,755 INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator     - Triggering checkpoint 15 @ 1565088278754 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 9e0fbeaa580123e05cfce5554f443d23.
10:44:38,762 INFO  org.apache.flink.runtime.taskmanager.Task                     - Map (3/3) (fb073c45e552de69f06e8037f581491c) switched from RUNNING to FAILED.
org.apache.flink.test.checkpointing.RegionFailoverITCase$TestException
	at org.apache.flink.test.checkpointing.RegionFailoverITCase$FailingMapperFunction.map(RegionFailoverITCase.java:344)
	at org.apache.flink.test.checkpointing.RegionFailoverITCase$FailingMapperFunction.map(RegionFailoverITCase.java:315)
	at org.apache.flink.streaming.api.operators.StreamMap.processElement(StreamMap.java:41)
	at org.apache.flink.streaming.runtime.io.StreamOneInputProcessor.processElement(StreamOneInputProcessor.java:164)
	at org.apache.flink.streaming.runtime.io.StreamOneInputProcessor.processInput(StreamOneInputProcessor.java:143)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.performDefaultAction(StreamTask.java:269)
	at org.apache.flink.streaming.runtime.tasks.mailbox.execution.MailboxProcessor.runMailboxLoop(MailboxProcessor.java:140)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:378)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:688)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:518)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
10:44:38,776 INFO  org.apache.flink.runtime.executiongraph.failover.flip1.RestartPipelinedRegionStrategy  - Calculating tasks to restart to recover the failed task 5c51e52cde5a1c4df827ddb38fbc8da9_2.
10:44:38,776 INFO  org.apache.flink.runtime.executiongraph.failover.flip1.RestartPipelinedRegionStrategy  - 3 tasks should be restarted to recover the failed task 5c51e52cde5a1c4df827ddb38fbc8da9_2. 
10:44:38,776 INFO  org.apache.flink.runtime.executiongraph.ExecutionGraph        - Source: Custom Source (3/3) (1a7ad9441ead7561b1a92bef8d46e421) switched from RUNNING to CANCELING.
10:44:38,776 INFO  org.apache.flink.runtime.executiongraph.ExecutionGraph        - Sink: Unnamed (3/3) (6cdcfb1522f95345e0afbd32e82aaa68) switched from RUNNING to CANCELING.
10:44:38,777 INFO  org.apache.flink.runtime.executiongraph.ExecutionGraph        - Discarding the results produced by task execution fb073c45e552de69f06e8037f581491c.
10:44:38,777 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task Source: Custom Source (3/3) (1a7ad9441ead7561b1a92bef8d46e421).
10:44:38,780 INFO  org.apache.flink.runtime.taskmanager.Task                     - Source: Custom Source (3/3) (1a7ad9441ead7561b1a92bef8d46e421) switched from RUNNING to CANCELING.
10:44:38,780 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code Source: Custom Source (3/3) (1a7ad9441ead7561b1a92bef8d46e421).
10:44:38,780 INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator     - Completed checkpoint 15 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 9e0fbeaa580123e05cfce5554f443d23 (35251 bytes in 26 ms).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I plan to use a customized &lt;tt&gt;CompletedCheckpointStore&lt;/tt&gt; to record information instead of relaying on the &lt;tt&gt;notifyCheckpointComplete&lt;/tt&gt; invoked on task side to fix this problem. Pleas assign this ticket to me.&lt;/p&gt;</comment>
                            <comment id="16901833" author="till.rohrmann" created="Wed, 7 Aug 2019 07:42:48 +0000"  >&lt;p&gt;I&apos;ve assigned you to this ticket &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt;. Please move it into &quot;in progress&quot; once you start working on it.&lt;/p&gt;</comment>
                            <comment id="16954564" author="zentol" created="Fri, 18 Oct 2019 12:47:55 +0000"  >&lt;p&gt;master: db436d93797ef1422444ff4d92f966865c264cc3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13194814">FLINK-10712</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05dkg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>