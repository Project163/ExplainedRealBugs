<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:29:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7444] Make external calls non-blocking</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7444</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;All external calls from a &lt;tt&gt;RpcEndpoint&lt;/tt&gt; can be potentially blocking, e.g. calls to the &lt;tt&gt;FatalErrorHandler&lt;/tt&gt;. Therefore, I propose to make all these calls coming from the &lt;tt&gt;RpcEndpoint&apos;s&lt;/tt&gt; main thread non-blocking by running them in an &lt;tt&gt;Executor&lt;/tt&gt;. That way the main thread will never be blocked.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13094455">FLINK-7444</key>
            <summary>Make external calls non-blocking</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>flip-6</label>
                    </labels>
                <created>Mon, 14 Aug 2017 12:50:18 +0000</created>
                <updated>Sun, 3 Sep 2017 22:18:56 +0000</updated>
                            <resolved>Sun, 3 Sep 2017 22:18:35 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16125629" author="githubbot" created="Mon, 14 Aug 2017 12:52:07 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4540&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4540&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7444&quot; title=&quot;Make external calls non-blocking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7444&quot;&gt;&lt;del&gt;FLINK-7444&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; Make external calls non-blocking&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Make all external calls from the RpcEndpoint&apos;s main thread non blocking by&lt;br/&gt;
    executing them as a runnable in an Executor.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; makeEndpointsNonBlocking&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4540.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4540.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4540&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ccaabc5c54fb91bdbadbc22191565e308c0f4c1b&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-08-14T12:48:33Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7444&quot; title=&quot;Make external calls non-blocking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7444&quot;&gt;&lt;del&gt;FLINK-7444&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;rpc&amp;#93;&lt;/span&gt; Make external calls non-blocking&lt;/p&gt;

&lt;p&gt;    Make all external calls from the RpcEndpoint&apos;s main thread non blocking by&lt;br/&gt;
    executing them as a runnable in an Executor.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16125791" author="stephanewen" created="Mon, 14 Aug 2017 14:55:59 +0000"  >&lt;p&gt;Is that possibly  pre-mature optimization?&lt;br/&gt;
A fatal error handler blocking the main thread sounds permissible, because the process will anyways not continue normally after that.&lt;/p&gt;

&lt;p&gt;Also, direct calls have the advantage of succeeding better in fatal cases. An OOM that cannot spawn a thread will not be reported if passed through an executor.&lt;/p&gt;

&lt;p&gt;Especially for the fatal error handler, I would actually suggest to explicitly NOT send it through an executor. &lt;/p&gt;</comment>
                            <comment id="16126361" author="till.rohrmann" created="Mon, 14 Aug 2017 20:38:38 +0000"  >&lt;p&gt;It is problematic if the error handler tries to stop the failing &lt;tt&gt;RpcEndpoint&lt;/tt&gt; in a blocking fashion. Then, it is basically deadlocked because the actor thread never terminates. We have seen this problem with the &lt;tt&gt;MiniCluster&lt;/tt&gt; where an &lt;tt&gt;Exception&lt;/tt&gt; is thrown at shut down which blocks the actor&apos;s main thread while the &lt;tt&gt;MiniCluster&lt;/tt&gt; is being shut down waiting for the &lt;tt&gt;ActorSystem&lt;/tt&gt; to terminate.&lt;/p&gt;

&lt;p&gt;I think the underlying problem is that one does not know what&apos;s happening outside of the &lt;tt&gt;RpcEndpoint&apos;s&lt;/tt&gt; main thread and the idea was to guard against this by making the calls asynchronous. I see the point that one would want to react fast to fatal errors and maybe the problem is that we are abusing the &lt;tt&gt;FatalErrorHandler&lt;/tt&gt; also for non fatal errors (e.g. more like an uncaught exception handler). Maybe we can introduce different failure cases but then one shouldn&apos;t do any blocking operations which require the &lt;tt&gt;RpcEndpoint&lt;/tt&gt; to be terminated in the fatal error case.&lt;/p&gt;
</comment>
                            <comment id="16128873" author="stephanewen" created="Wed, 16 Aug 2017 14:33:51 +0000"  >&lt;p&gt;The case you mentioned to me sounds like it should be the responsibility of the MiniCluster to do the shutdown asynchronously.&lt;/p&gt;</comment>
                            <comment id="16130133" author="till.rohrmann" created="Thu, 17 Aug 2017 09:12:57 +0000"  >&lt;p&gt;I agree that the &lt;tt&gt;FatalErrorHandler&lt;/tt&gt; should be executed directly as you&apos;ve said and I will change the PR accordingly. All other external calls (e.g. the &lt;tt&gt;OnCompletionActions&lt;/tt&gt;), will remain being executed asynchronously since I think this is more bullet-proof.&lt;/p&gt;</comment>
                            <comment id="16151948" author="githubbot" created="Sun, 3 Sep 2017 20:54:23 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4540&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4540&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve made the `FatalErrorHandler` calls non asynchronous. Rebasing and if Travis gives green light, I&apos;ll merge this PR.&lt;/p&gt;</comment>
                            <comment id="16151993" author="till.rohrmann" created="Sun, 3 Sep 2017 22:18:35 +0000"  >&lt;p&gt;Fixed via a3df5a2ca52880b6681446d95f1d916a01f55681&lt;/p&gt;</comment>
                            <comment id="16151994" author="githubbot" created="Sun, 3 Sep 2017 22:18:56 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4540&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4540&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ir6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>