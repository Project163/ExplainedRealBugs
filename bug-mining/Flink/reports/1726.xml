<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6328] Savepoints must not be counted as retained checkpoints</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6328</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The Checkpoint Store retains the &lt;b&gt;n&lt;/b&gt; latest checkpoints.&lt;br/&gt;
Savepoints are counted as well, meaning that for settings with 1 retained checkpoint, there are sometimes no retained checkpoints at all, only a savepoint.&lt;/p&gt;

&lt;p&gt;That is dangerous, because savepoints must be assumed to disappear at any point in time - their lifecycle is out of control of the CheckpointCoordinator.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13065082">FLINK-6328</key>
            <summary>Savepoints must not be counted as retained checkpoints</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Apr 2017 13:08:27 +0000</created>
                <updated>Wed, 2 Oct 2019 17:43:18 +0000</updated>
                            <resolved>Tue, 23 May 2017 11:43:29 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.3.0</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15996608" author="aljoscha" created="Thu, 4 May 2017 11:58:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; Have you started working on this? If not, do you have an idea about the complexity?&lt;/p&gt;</comment>
                            <comment id="16013923" author="rmetzger" created="Wed, 17 May 2017 12:22:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; is this a blocker for the 1.3 release?&lt;/p&gt;</comment>
                            <comment id="16016776" author="tonywei" created="Fri, 19 May 2017 01:35:43 +0000"  >&lt;p&gt;Hi all,&lt;/p&gt;

&lt;p&gt;Are this and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6071&quot; title=&quot;Savepoints should not count in the number of retained checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6071&quot;&gt;&lt;del&gt;FLINK-6071&lt;/del&gt;&lt;/a&gt; the similar issues?&lt;/p&gt;</comment>
                            <comment id="16019629" author="till.rohrmann" created="Mon, 22 May 2017 14:31:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tonywei&quot; class=&quot;user-hover&quot; rel=&quot;tonywei&quot;&gt;tonywei&lt;/a&gt; yes &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6071&quot; title=&quot;Savepoints should not count in the number of retained checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6071&quot;&gt;&lt;del&gt;FLINK-6071&lt;/del&gt;&lt;/a&gt; is a duplicate.&lt;/p&gt;</comment>
                            <comment id="16019663" author="till.rohrmann" created="Mon, 22 May 2017 14:54:49 +0000"  >&lt;p&gt;Given that the lifecycle of a savepoint is out of control of the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt;, I think it is best to not add savepoints to the &lt;tt&gt;CompletedCheckpointStore&lt;/tt&gt; and, thus, not considering them for job recovery. The reason for this is &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4815&quot; title=&quot;Automatic fallback to earlier checkpoints when checkpoint restore fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4815&quot;&gt;FLINK-4815&lt;/a&gt;, because otherwise a single broken/deleted savepoint will thwart Flink&apos;s whole recovery mechanism.&lt;/p&gt;

&lt;p&gt;Once &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4815&quot; title=&quot;Automatic fallback to earlier checkpoints when checkpoint restore fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4815&quot;&gt;FLINK-4815&lt;/a&gt; has been added we might think again about re-adding savepoints to the &lt;tt&gt;CompletedCheckpointStore&lt;/tt&gt; and, thus, allowing to recover from savepoints in case of failures. When doing so, we should, however, not count the savepoints for the number of retained checkpoints, because we cannot be sure that they still exist.&lt;/p&gt;</comment>
                            <comment id="16019720" author="githubbot" created="Mon, 22 May 2017 15:46:59 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6328&quot; title=&quot;Savepoints must not be counted as retained checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6328&quot;&gt;&lt;del&gt;FLINK-6328&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;chkPts&amp;#93;&lt;/span&gt; Don&apos;t add savepoints to CompletedCheckpointStore&lt;/p&gt;

&lt;p&gt;    The lifecycle of savepoints is not managed by the CheckpointCoordinator and fully&lt;br/&gt;
    in the hand of the user. Therefore, the CheckpointCoordinator cannot rely on them&lt;br/&gt;
    when trying to recover from failures. E.g. a user moving a savepoint shortly before&lt;br/&gt;
    a failure could completely break Flink&apos;s recovery mechanism because Flink cannot&lt;br/&gt;
    skip failed checkpoints when recovering.&lt;/p&gt;

&lt;p&gt;    Therefore, until Flink is able to skip failed checkpoints when recovering, we should&lt;br/&gt;
    not add savepoints to the CompletedCheckpointStore which is used to retrieve checkpoint&lt;br/&gt;
    for recovery. The distinction of a savepoint is done on the basis of the&lt;br/&gt;
    CheckpointProperties (CheckpointProperties.STANDARD_SAVEPOINT).&lt;/p&gt;

&lt;p&gt;    cc @rmetzger &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixSavepointHandling&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3965&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9c069ad80d66f03a0f90c8ba1a780cbba111896e&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-05-22T15:41:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6328&quot; title=&quot;Savepoints must not be counted as retained checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6328&quot;&gt;&lt;del&gt;FLINK-6328&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;chkPts&amp;#93;&lt;/span&gt; Don&apos;t add savepoints to CompletedCheckpointStore&lt;/p&gt;

&lt;p&gt;    The lifecycle of savepoints is not managed by the CheckpointCoordinator and fully&lt;br/&gt;
    in the hand of the user. Therefore, the CheckpointCoordinator cannot rely on them&lt;br/&gt;
    when trying to recover from failures. E.g. a user moving a savepoint shortly before&lt;br/&gt;
    a failure could completely break Flink&apos;s recovery mechanism because Flink cannot&lt;br/&gt;
    skip failed checkpoints when recovering.&lt;/p&gt;

&lt;p&gt;    Therefore, until Flink is able to skip failed checkpoints when recovering, we should&lt;br/&gt;
    not add savepoints to the CompletedCheckpointStore which is used to retrieve checkpoint&lt;br/&gt;
    for recovery. The distinction of a savepoint is done on the basis of the&lt;br/&gt;
    CheckpointProperties (CheckpointProperties.STANDARD_SAVEPOINT).&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16020682" author="githubbot" created="Tue, 23 May 2017 05:40:57 +0000"  >&lt;p&gt;Github user tony810430 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965#discussion_r117902054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965#discussion_r117902054&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -864,22 +864,28 @@ private void completePendingCheckpoint(PendingCheckpoint pendingCheckpoint) thro&lt;br/&gt;
     			// the pending checkpoint must be discarded after the finalization&lt;br/&gt;
     			Preconditions.checkState(pendingCheckpoint.isDiscarded() &amp;amp;&amp;amp; completedCheckpoint != null);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -				completedCheckpointStore.addCheckpoint(completedCheckpoint);
    -			}
&lt;p&gt; catch (Exception exception) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;// we failed to store the completed checkpoint. Let&apos;s clean up&lt;/li&gt;
	&lt;li&gt;executor.execute(new Runnable() {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public void run() {&lt;/li&gt;
	&lt;li&gt;try 
{
    -							completedCheckpoint.discardOnFailedStoring();
    -						}
&lt;p&gt; catch (Throwable t) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;LOG.warn(&quot;Could not properly discard completed checkpoint {}.&quot;, completedCheckpoint.getCheckpointID(), t);&lt;br/&gt;
    +			// TODO: add savepoints to completed checkpoint store once &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4815&quot; title=&quot;Automatic fallback to earlier checkpoints when checkpoint restore fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4815&quot;&gt;FLINK-4815&lt;/a&gt; has been completed&lt;br/&gt;
    +			if (!CheckpointProperties.isSavepoint(completedCheckpoint.getProperties())) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why not use `completedCheckpoint.getProperties().isSavepoint()` to check whether it is a savepoint or not?&lt;br/&gt;
    This method had already been implemented in `CheckpoinProperties`.&lt;/p&gt;</comment>
                            <comment id="16020692" author="githubbot" created="Tue, 23 May 2017 06:11:25 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965#discussion_r117906785&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965#discussion_r117906785&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -864,22 +864,28 @@ private void completePendingCheckpoint(PendingCheckpoint pendingCheckpoint) thro&lt;br/&gt;
     			// the pending checkpoint must be discarded after the finalization&lt;br/&gt;
     			Preconditions.checkState(pendingCheckpoint.isDiscarded() &amp;amp;&amp;amp; completedCheckpoint != null);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -				completedCheckpointStore.addCheckpoint(completedCheckpoint);
    -			}
&lt;p&gt; catch (Exception exception) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;// we failed to store the completed checkpoint. Let&apos;s clean up&lt;/li&gt;
	&lt;li&gt;executor.execute(new Runnable() {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public void run() {&lt;/li&gt;
	&lt;li&gt;try 
{
    -							completedCheckpoint.discardOnFailedStoring();
    -						}
&lt;p&gt; catch (Throwable t) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;LOG.warn(&quot;Could not properly discard completed checkpoint {}.&quot;, completedCheckpoint.getCheckpointID(), t);&lt;br/&gt;
    +			// TODO: add savepoints to completed checkpoint store once &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4815&quot; title=&quot;Automatic fallback to earlier checkpoints when checkpoint restore fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4815&quot;&gt;FLINK-4815&lt;/a&gt; has been completed&lt;br/&gt;
    +			if (!CheckpointProperties.isSavepoint(completedCheckpoint.getProperties())) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good point. I missed that. Will adapt the PR.&lt;/p&gt;</comment>
                            <comment id="16020719" author="githubbot" created="Tue, 23 May 2017 06:56:13 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to merge&lt;/p&gt;</comment>
                            <comment id="16020799" author="githubbot" created="Tue, 23 May 2017 08:25:06 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @tony810430 and @rmetzger. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="16020800" author="githubbot" created="Tue, 23 May 2017 08:26:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3965&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16021080" author="till.rohrmann" created="Tue, 23 May 2017 11:43:29 +0000"  >&lt;p&gt;1.4.0: 6f570e7b6810e1645a4f7094f17ab9e8559fa139&lt;br/&gt;
1.3.0: 39114e26bdc8e69e04478d1ff7596860f289a013&lt;br/&gt;
1.2.2: cc1ed221fd3ab5b535983a4c1c94bbdb93d71309&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13056597">FLINK-6071</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dt5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>