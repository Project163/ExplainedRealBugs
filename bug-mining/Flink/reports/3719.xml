<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15919] MemoryManager shouldn&apos;t allow releasing more memory than reserved</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15919</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently &lt;tt&gt;MemoryManager&lt;/tt&gt; allows releasing more memory than reserved for the same owner object, which could be reproduced by adding below test case into &lt;tt&gt;MemoryManagerTest&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	@Test
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMemoryReleaseGuard() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; MemoryReservationException {
		&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; owner = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;();
		&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; owner2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;();

		&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; totalHeapMemorySize = memoryManager.availableMemory(MemoryType.HEAP);
		memoryManager.reserveMemory(owner, MemoryType.HEAP, PAGE_SIZE);
		memoryManager.reserveMemory(owner2, MemoryType.HEAP, PAGE_SIZE);
		memoryManager.releaseMemory(owner, MemoryType.HEAP, PAGE_SIZE);
		memoryManager.releaseMemory(owner, MemoryType.HEAP, PAGE_SIZE);
		&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; heapMemoryLeft = memoryManager.availableMemory(MemoryType.HEAP);
		assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Memory leak happens&quot;&lt;/span&gt;, totalHeapMemorySize - PAGE_SIZE, heapMemoryLeft);
		memoryManager.releaseAllMemory(owner2, MemoryType.HEAP);
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13283459">FLINK-15919</key>
            <summary>MemoryManager shouldn&apos;t allow releasing more memory than reserved</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyu">Yu Li</assignee>
                                    <reporter username="liyu">Yu Li</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 5 Feb 2020 12:15:19 +0000</created>
                <updated>Fri, 7 Feb 2020 20:14:21 +0000</updated>
                            <resolved>Thu, 6 Feb 2020 12:19:20 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17030611" author="carp84" created="Wed, 5 Feb 2020 12:16:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; FYI. Please help decide whether this is a blocker for 1.10.0 or it&apos;s ok to fix in later versions. Thanks.&lt;/p&gt;</comment>
                            <comment id="17030615" author="carp84" created="Wed, 5 Feb 2020 12:23:20 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=GJL&quot; class=&quot;user-hover&quot; rel=&quot;GJL&quot;&gt;GJL&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azagrebin&quot; class=&quot;user-hover&quot; rel=&quot;azagrebin&quot;&gt;azagrebin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17031260" author="xintongsong" created="Thu, 6 Feb 2020 04:00:30 +0000"  >&lt;p&gt;Thanks for reporting this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liyu&quot; class=&quot;user-hover&quot; rel=&quot;liyu&quot;&gt;liyu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think this is indeed a problem that would be good to fix, but I would not consider this as a blocker for 1.10.0.&lt;/p&gt;

&lt;p&gt;Memory manager is an internal class, and as long as there is no memory consumer tries to release memory more than reserved / allocated, it should be fine. Are we already aware of any problem that a memory consumer may release more than reserved / allocated? If not, I would suggest to fix it in later versions.&lt;/p&gt;</comment>
                            <comment id="17031281" author="carp84" created="Thu, 6 Feb 2020 05:05:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are we already aware of any problem that a memory consumer may release more than reserved / allocated?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;None from me.&lt;/p&gt;

&lt;p&gt;Some background: the test mentioned in description was motivated by the &lt;a href=&quot;https://github.com/apache/flink/pull/11018#pullrequestreview-353658300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;discussion&lt;/a&gt; during PR review of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15905&quot; title=&quot;Fix Race Condition when releasing shared memory resource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15905&quot;&gt;&lt;del&gt;FLINK-15905&lt;/del&gt;&lt;/a&gt;, where we depend on the guard in &lt;tt&gt;MemoryManager&lt;/tt&gt; to make sure &lt;b&gt;&lt;em&gt;later&lt;/em&gt;&lt;/b&gt; changes won&apos;t cause &quot;double release&quot; of the memory accounting.&lt;/p&gt;</comment>
                            <comment id="17031540" author="carp84" created="Thu, 6 Feb 2020 12:19:20 +0000"  >&lt;p&gt;Fix in:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;release-1.10 via f4aa9f81ccc052a7802aee6ad3dfee2b2f8be514&lt;/li&gt;
	&lt;li&gt;master via d3f53dd0865b1dc390c09566d1baa49581591e2b&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17031546" author="carp84" created="Thu, 6 Feb 2020 12:38:06 +0000"  >&lt;p&gt;Change the fix version from &lt;tt&gt;1.10.0&lt;/tt&gt; to &lt;tt&gt;1.10.1&lt;/tt&gt;. Will change it back if there comes a RC3 for 1.10.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b6hk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>