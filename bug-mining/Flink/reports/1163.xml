<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4341] Kinesis connector does not emit maximum watermark properly</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4341</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;*&lt;b&gt;Prevously reported as &quot;Checkpoint state size grows unbounded when task parallelism not uniform&quot;&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;This issue was first encountered with Flink release 1.1.0 (commit 45f7825). I was previously using a 1.1.0 snapshot (commit 18995c8) which performed as expected.  This issue was introduced somewhere between those commits.&lt;/p&gt;

&lt;p&gt;I&apos;ve got a Flink application that uses the Kinesis Stream Consumer to read from a Kinesis stream with 2 shards. I&apos;ve got 2 task managers with 2 slots each, providing a total of 4 slots.  When running the application with a parallelism of 4, the Kinesis consumer uses 2 slots (one per Kinesis shard) and 4 slots for subsequent tasks that process the Kinesis stream data. I use an in-memory store for checkpoint data.&lt;/p&gt;

&lt;p&gt;Yesterday I upgraded to Flink 1.1.0 (45f7825) and noticed that checkpoint states were growing unbounded when running with a parallelism of 4, checkpoint interval of 10 seconds:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ID  State Size
1   11.3 MB
2    20.9 MB
3   30.6 MB
4   41.4 MB
5   52.6 MB
6   62.5 MB
7   71.5 MB
8   83.3 MB
9   93.5 MB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first 4 checkpoints generally succeed, but then fail with an exception like the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: Error triggering a checkpoint as the result of receiving checkpoint barrier at org.apache.flink.streaming.runtime.tasks.StreamTask$2.onEvent(StreamTask.java:768)
  at org.apache.flink.streaming.runtime.tasks.StreamTask$2.onEvent(StreamTask.java:758)
  at org.apache.flink.streaming.runtime.io.BarrierBuffer.processBarrier(BarrierBuffer.java:203)
  at org.apache.flink.streaming.runtime.io.BarrierBuffer.getNextNonBlocked(BarrierBuffer.java:129)
  at org.apache.flink.streaming.runtime.io.StreamInputProcessor.processInput(StreamInputProcessor.java:183)
  at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.run(OneInputStreamTask.java:66)
  at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:266)
  at org.apache.flink.runtime.taskmanager.Task.run(Task.java:584)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.io.IOException: Size of the state is larger than the maximum permitted memory-backed state. Size=12105407 , maxSize=5242880 . Consider using a different state backend, like the File &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt; State backend.
  at org.apache.flink.runtime.state.memory.MemoryStateBackend.checkSize(MemoryStateBackend.java:146)
  at org.apache.flink.runtime.state.memory.MemoryStateBackend$MemoryCheckpointOutputStream.closeAndGetBytes(MemoryStateBackend.java:200)
  at org.apache.flink.runtime.state.memory.MemoryStateBackend$MemoryCheckpointOutputStream.closeAndGetHandle(MemoryStateBackend.java:190)
  at org.apache.flink.runtime.state.AbstractStateBackend$CheckpointStateOutputView.closeAndGetHandle(AbstractStateBackend.java:447)
  at org.apache.flink.streaming.runtime.operators.windowing.WindowOperator.snapshotOperatorState(WindowOperator.java:879)
  at org.apache.flink.streaming.runtime.tasks.StreamTask.performCheckpoint(StreamTask.java:598)
  at org.apache.flink.streaming.runtime.tasks.StreamTask$2.onEvent(StreamTask.java:762)
  ... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-08-09 17:44:43,626 INFO  org.apache.flink.streaming.runtime.tasks.StreamTask           - Restoring checkpointed state to task Fold: property_id, player -&amp;gt; 10-minute Sliding-Window Percentile Aggregation -&amp;gt; Sink: InfluxDB (2/4)
2016-08-09 17:44:51,236 ERROR akka.remote.EndpointWriter            - Transient association error (association remains live) akka.remote.OversizedPayloadException: Discarding oversized payload sent to Actor[akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@10.55.2.212:6123/user/jobmanager#510517238]: max allowed size 10485760 bytes, actual size of encoded &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.flink.runtime.messages.checkpoint.AcknowledgeCheckpoint was 10891825 bytes.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This can be fixed by simply submitting the job with a parallelism of 2. I suspect there was a regression introduced relating to assumptions about the number of sub-tasks associated with a job stage (e.g. assuming 4 instead of a value ranging from 1-4). This is currently preventing me from using all available Task Manager slots.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12996063">FLINK-4341</key>
            <summary>Kinesis connector does not emit maximum watermark properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tzulitai">Tzu-Li (Gordon) Tai</assignee>
                                    <reporter username="skidder">Scott Kidder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Aug 2016 20:20:04 +0000</created>
                <updated>Fri, 4 Nov 2016 12:30:25 +0000</updated>
                            <resolved>Mon, 29 Aug 2016 09:49:32 +0000</resolved>
                                    <version>1.1.0</version>
                    <version>1.1.1</version>
                                    <fixVersion>1.1.2</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Connectors / Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15414301" author="skidder" created="Tue, 9 Aug 2016 21:54:53 +0000"  >&lt;p&gt;I also noticed that when checkpointing is enabled and I&apos;m using a parallelism of 2 the processing speed is extremely slow compared to that of Flink 18995c8. I disabled checkpointing altogether and the speed returned to previous levels.&lt;/p&gt;

&lt;p&gt;I&apos;m currently building Flink from source to pull in hotfixes added to the release-1.1 branch since commit 45f7825. I&apos;ll update this issue with my findings.&lt;/p&gt;</comment>
                            <comment id="15414334" author="stephanewen" created="Tue, 9 Aug 2016 22:15:17 +0000"  >&lt;p&gt;Thanks for reporting this issue. Sounds pretty serious.&lt;/p&gt;

&lt;p&gt;Would be important to see if this is a general checkpointing regression, or a change in the behavior of the Kinesis connector since the snapshot version you used.&lt;/p&gt;

&lt;p&gt;Do you have a way to test this job with a testdata-generating source, i.e. without Kinesis?&lt;/p&gt;</comment>
                            <comment id="15414599" author="skidder" created="Wed, 10 Aug 2016 02:16:43 +0000"  >&lt;p&gt;Unfortunately I don&apos;t have the time to develop a test application to demonstrate this issue without Kinesis. It might be reproducible with Kafka when the number of shards (or the Kafka equivalent) is less than the parallelism specified on the job.&lt;/p&gt;

&lt;p&gt;Also, I noticed that the 1.1.0 binaries available for download were created on August 4 and don&apos;t include the latest commits on the release-1.1 branch in Git. Do you know when they&apos;ll be updated? I deploy Flink as a Docker container and use the Flink tar-gzip binary to build the Docker image.&lt;/p&gt;
</comment>
                            <comment id="15414927" author="rmetzger" created="Wed, 10 Aug 2016 08:45:51 +0000"  >&lt;p&gt;I&apos;ll implement a little testing job to see if Kinesis is causing the issues with the growing state.&lt;/p&gt;</comment>
                            <comment id="15414944" author="stephanewen" created="Wed, 10 Aug 2016 08:54:58 +0000"  >&lt;p&gt;Scott, we are trying to set up a test to see if some changes in the Kinesis connector between the revisions you mentioned may be responsible.&lt;/p&gt;

&lt;p&gt;To confirm: We will test revision &lt;tt&gt;18995c8c7b8f9c75035b1a95a00379944c6f2b0c&lt;/tt&gt; (fast) against revision &lt;tt&gt;45f7825111232f0dd225068a72d8a092f67d49d0&lt;/tt&gt; (slow)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tzulitai&quot; class=&quot;user-hover&quot; rel=&quot;tzulitai&quot;&gt;tzulitai&lt;/a&gt; Do you have a suspicion or hunch what we should look out for?&lt;/p&gt;

&lt;p&gt;Concerning the latest commits from release-1.1 branch: The release-1.1 branch has the 1.1.x versions in progress. After the 1.1.0 release candidate was created, new fixes were added that will go into 1.1.x versions. The 1.1.1 release fixes only the maven deployment of the 1.1.0 release (no code changes) and the 1.1.2 release will contain all the commits in the release-1.1 branch at that point.&lt;/p&gt;</comment>
                            <comment id="15415058" author="tzulitai" created="Wed, 10 Aug 2016 10:02:20 +0000"  >&lt;p&gt;I just did a test on revision 45f7825111232f0dd225068a72d8a092f67d49d0 (slow), with 2 Kinesis shards &amp;amp; source parallelism of 4. The job consisted only of the Kinesis consumer source and print as sink (the &lt;tt&gt;ManualConsumerProducerTest&lt;/tt&gt; in our manual tests, with checkpointing enabled). However, I did not experience significant slowdown with &amp;amp; w/o checkpointing. I also did not observe unbounded checkpoint size.&lt;/p&gt;

&lt;p&gt;I&apos;m afraid I currently don&apos;t have any idea of what may be causing the reported issue in the Kinesis connector. I&apos;ll keep this in mind.&lt;/p&gt;</comment>
                            <comment id="15415064" author="rmetzger" created="Wed, 10 Aug 2016 10:08:53 +0000"  >&lt;p&gt;In my tests so far, the Kinesis consumer is not using much memory (few KBs) (in a 2TM, 4 slots setup with 2 shards)&lt;br/&gt;
From the reported exception, it seems that the WindowOperator is exceeding the limit of the memory state backend, not Kinesis.&lt;/p&gt;</comment>
                            <comment id="15415074" author="stephanewen" created="Wed, 10 Aug 2016 10:14:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=skidder&quot; class=&quot;user-hover&quot; rel=&quot;skidder&quot;&gt;skidder&lt;/a&gt; Do you set something like &quot;allowed lateness&quot; in the window operator?&lt;/p&gt;

&lt;p&gt;Would be great if you could share your program (via private mail stephan@data-artisans.com) then we can try and see if we can see something suspicious.&lt;/p&gt;
</comment>
                            <comment id="15425408" author="skidder" created="Wed, 17 Aug 2016 21:26:45 +0000"  >&lt;p&gt;I repeated my tests using Flink 1.1.1 and continue to have problems with the checkpoint growing in size until it reaches the AKKA message size limit (I override it to allow up to 30MB) or the heap-memory is exhausted on the task managers. It&apos;s as though old data that&apos;s outside the window continues to occupy memory.&lt;/p&gt;</comment>
                            <comment id="15426173" author="aljoscha" created="Thu, 18 Aug 2016 09:45:43 +0000"  >&lt;p&gt;The regression was introduced in commit 17dfd68d05be991b58ffe4b9252b09ca61ec8f05. The problem is that before, the Kinesis Source was emitting a &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; watermark if now shards were assigned to it. With the change the kinesis source no longer does this. What this means is that it will not emit watermarks which in turn means that downstream watermarks, i.e. at the window operators, don&apos;t advance. Thus, the WindowOperator will simply accumulate state for all the windows that it keeps and never fire/purge that state. This explains the growing state size.&lt;/p&gt;</comment>
                            <comment id="15426223" author="stephanewen" created="Thu, 18 Aug 2016 10:20:41 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; for debugging this. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tzulitai&quot; class=&quot;user-hover&quot; rel=&quot;tzulitai&quot;&gt;tzulitai&lt;/a&gt; do you think you can have a look at this? Sounds like this should go into the next version and bugfix release.&lt;/p&gt;</comment>
                            <comment id="15426231" author="rmetzger" created="Thu, 18 Aug 2016 10:26:25 +0000"  >&lt;p&gt;The reason why the Kinesis consumer is not emitting the &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; watermark is to support transparent resharding.&lt;br/&gt;
So if the number of shards changes, inactive consumer instances might start consuming records. If we send a &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt;, the watermarks would be messed up.&lt;/p&gt;

&lt;p&gt;This means that we need to fail the Kinesis consumer if a resharding has occurred.&lt;/p&gt;</comment>
                            <comment id="15426232" author="tzulitai" created="Thu, 18 Aug 2016 10:27:12 +0000"  >&lt;p&gt;I can take a look at fixing this after I get back from vacation this week &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; for pointing this out.&lt;/p&gt;

&lt;p&gt;One question, what will be a reasonable way to fix this? The rework in 17dfd68d05be991b58ffe4b9252b09ca61ec8f05 took away the &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; because parallel source instances that initially did not have shards assigned to it may still have shards due to resharding of Kinesis streams in the future. I&apos;m working on Kafka repartitioning too for our Kafka connectors, and we&apos;ll likely need to deal with this there too.&lt;/p&gt;</comment>
                            <comment id="15426418" author="aljoscha" created="Thu, 18 Aug 2016 13:17:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tzulitai&quot; class=&quot;user-hover&quot; rel=&quot;tzulitai&quot;&gt;tzulitai&lt;/a&gt; We (Stephan and I) were quickly bouncing around some ideas and what we came up with as a likely solution is to introduce some service in the JobManager (per source) that gets messages from all sources about their min-watermark. The service would then send out the min-watermark to all sources again so that sources that don&apos;t have a watermark of their own can emit that as a watermark.&lt;/p&gt;

&lt;p&gt;This should work because the watermark should not decrease due to resharding because the data is still hopefully the same.&lt;/p&gt;</comment>
                            <comment id="15427912" author="stephanewen" created="Fri, 19 Aug 2016 09:43:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; This is probably a good long term solution.&lt;br/&gt;
We still need to see if we can find a more lightweight fix that we can apply to 1.1.2&lt;/p&gt;</comment>
                            <comment id="15428584" author="skidder" created="Fri, 19 Aug 2016 18:25:21 +0000"  >&lt;p&gt;FYI, I&apos;ve confirmed that explicitly setting the parallelism on the Kinesis source to equal the number of shards (e.g. 2) allows the remaining application stages to run at larger parallelism values (e.g. 4) successfully.&lt;/p&gt;</comment>
                            <comment id="15433114" author="rmetzger" created="Tue, 23 Aug 2016 16:11:59 +0000"  >&lt;p&gt;For the short term: I think we have to disable the transparent resharding support in Kinesis.&lt;br/&gt;
Before we can add support for partition discovery in Kafka (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4022&quot; title=&quot;Partition discovery / regex topic subscription for the Kafka consumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4022&quot;&gt;&lt;del&gt;FLINK-4022&lt;/del&gt;&lt;/a&gt;) and before activating resharding in kinesis again, we need to implement a low watermark service in the JobManager.&lt;/p&gt;</comment>
                            <comment id="15433850" author="tzulitai" created="Tue, 23 Aug 2016 23:23:51 +0000"  >&lt;p&gt;I agree. I&apos;ve been trying around for the past few days, and I think this is the only way to go for now.&lt;br/&gt;
I&apos;ll see if there&apos;s a easy way to deactivate this and add &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; back easily in the current code without reverting back.&lt;/p&gt;

&lt;p&gt;I&apos;m also quite interested in working on the low watermark service for the JobManager. However, since there seems to be some ongoing effort of reworking the JobManager, I wonder if it makes sense to implement this service into the current JobManager now?&lt;/p&gt;</comment>
                            <comment id="15435309" author="githubbot" created="Wed, 24 Aug 2016 17:12:19 +0000"  >&lt;p&gt;GitHub user tzulitai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4341&quot; title=&quot;Kinesis connector does not emit maximum watermark properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4341&quot;&gt;&lt;del&gt;FLINK-4341&lt;/del&gt;&lt;/a&gt; Let idle consumer subtasks emit max value watermarks and fail on resharding&lt;/p&gt;

&lt;p&gt;    This is a short-term fix, until the min-watermark service for the JobManager described in the JIRA discussion is available.&lt;/p&gt;

&lt;p&gt;    The way this fix works is that we let idle subtasks that initially don&apos;t get assigned shards emit a `Long.MAX_VALUE` watermark. Also, we &lt;em&gt;only fail hard if an idle subtask&lt;/em&gt; is assigned new shards when resharding happens, to avoid messing up the watermarks. So, if all subtasks are not initially idle on startup (i.e., when total number of shards &amp;gt; consumer parallelism), the Kinesis consumer can still transparently handle resharding like before without failing.&lt;/p&gt;

&lt;p&gt;    I&apos;ve tested exactly-once with our manual tests (with and w/o resharding) and the fix works nicely, still retaining exactly-once guarantee despite non-transparency. However, I&apos;m a bit unsure on how to test if the unbounded state with window operators is also fixed with this change, so we&apos;re still yet to clarify this.&lt;/p&gt;

&lt;p&gt;    R: @rmetzger and @aljoscha for review. Thanks in advance!&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tzulitai/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tzulitai/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4341&quot; title=&quot;Kinesis connector does not emit maximum watermark properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4341&quot;&gt;&lt;del&gt;FLINK-4341&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2414&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit bc8e50d99be745300f7418c58e9d30abc5469ba3&lt;br/&gt;
Author: Gordon Tai &amp;lt;tzulitai@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-08-24T08:38:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4341&quot; title=&quot;Kinesis connector does not emit maximum watermark properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4341&quot;&gt;&lt;del&gt;FLINK-4341&lt;/del&gt;&lt;/a&gt; Let idle consumer subtasks emit max value watermarks and fail on resharding&lt;/p&gt;

&lt;p&gt;    This no longer allows the Kinesis consumer to transparently handle resharding.&lt;br/&gt;
    This is a short-term workaround until we have a min-watermark notification service available in the JobManager.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15436980" author="githubbot" created="Thu, 25 Aug 2016 14:27:50 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you for opening a pull request to fix the issue.&lt;/p&gt;

&lt;p&gt;    I think we also need to cover another case: What happens when the number of shards has been reduced in a resharding and some fetchers are now without a shard? I think in that case, the worker also needs to emit a final Long.MAX_VALUE, and it has to fail once it gets a shard assigned again.&lt;/p&gt;</comment>
                            <comment id="15437051" author="githubbot" created="Thu, 25 Aug 2016 15:10:48 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah yes, correct. I&apos;ll update this soon.&lt;/p&gt;</comment>
                            <comment id="15440877" author="githubbot" created="Sat, 27 Aug 2016 06:54:56 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Minus @rmetzger&apos;s comment this looks good to merge! Thanks for fixing this @tzulitai!&lt;/p&gt;</comment>
                            <comment id="15441113" author="githubbot" created="Sat, 27 Aug 2016 09:19:01 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    To include the missing case @rmetzger mentioned, it turns out the fix is actually more complicated than I expected due to correct state determination after every reshard, and requires a bit of rework on our current shard discovery mechanism to get it right.&lt;/p&gt;

&lt;p&gt;    Heads-up notice that this will probably need a re-review. Sorry for the delay, I&apos;m currently still on it, hopefully will update the PR by the end of today &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15443011" author="githubbot" created="Sun, 28 Aug 2016 07:53:33 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @rmetzger, @aljoscha the changes are ready for another review now, thanks!&lt;/p&gt;</comment>
                            <comment id="15445398" author="githubbot" created="Mon, 29 Aug 2016 09:44:00 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you for the pull request. I&apos;ll merge it to master and the release-1.1 branch.&lt;/p&gt;</comment>
                            <comment id="15445404" author="githubbot" created="Mon, 29 Aug 2016 09:48:11 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15445410" author="rmetzger" created="Mon, 29 Aug 2016 09:49:32 +0000"  >&lt;p&gt;Resolved for master in &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/7b574cf5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/7b574cf5&lt;/a&gt;&lt;br/&gt;
Resolved for 1.1.2 in &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/81f30c5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/81f30c5e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15445449" author="githubbot" created="Mon, 29 Aug 2016 10:06:41 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @rmetzger !&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13018054">FLINK-5017</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i323wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>