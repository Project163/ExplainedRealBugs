<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15168] Exception is thrown when using kafka source connector with flink planner</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15168</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;when running the following case using kafka as source connector in flink planner, we will get a RuntimeException:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);
env.setParallelism(1);StreamTableEnvironment tEnv = StreamTableEnvironment.create(env);tEnv.connect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Kafka()
        .version(&lt;span class=&quot;code-quote&quot;&gt;&quot;0.11&quot;&lt;/span&gt;)
        .topic(&lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;)
        .startFromEarliest()
        .property(&lt;span class=&quot;code-quote&quot;&gt;&quot;zookeeper.connect&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:2181&quot;&lt;/span&gt;)
        .property(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;))
        .withFormat(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Json()
                .failOnMissingField(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                .jsonSchema(&lt;span class=&quot;code-quote&quot;&gt;&quot;{&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;  type: &lt;span class=&quot;code-quote&quot;&gt;&apos;object&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;  properties: {&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    a: {&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;      type: &lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    },&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    b: {&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;      type: &lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    },&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    c: {&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;      type: &lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    },&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    time: {&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;      type: &lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;      format: &lt;span class=&quot;code-quote&quot;&gt;&apos;date-time&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;    }&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;  }&quot;&lt;/span&gt; +
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;}&quot;&lt;/span&gt;
                ))
        .withSchema(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema()
                .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;rowtime&quot;&lt;/span&gt;, Types.SQL_TIMESTAMP)
                .rowtime(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Rowtime()
                        .timestampsFromField(&lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;)
                        .watermarksPeriodicBounded(60000))
                .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, Types.STRING)
                .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, Types.STRING)
                .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;, Types.STRING))
        .inAppendMode()
        .registerTableSource(&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;);Table t = tEnv.scan(&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;).select(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;);tEnv.toAppendStream(t, Row.class).print();
tEnv.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The RuntimeException detail:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.RuntimeException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; applying rule PushProjectIntoTableSourceScanRule, args [rel#26:FlinkLogicalCalc.LOGICAL(input=RelSubset#25,expr#0..3={inputs},a=$t1), Scan(table:[default_catalog, default_database, source], fields:(rowtime, a, b, c), source:Kafka011TableSource(rowtime, a, b, c))]Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.RuntimeException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; applying rule PushProjectIntoTableSourceScanRule, args [rel#26:FlinkLogicalCalc.LOGICAL(input=RelSubset#25,expr#0..3={inputs},a=$t1), Scan(table:[default_catalog, default_database, source], fields:(rowtime, a, b, c), source:Kafka011TableSource(rowtime, a, b, c))] at org.apache.calcite.plan.volcano.VolcanoRuleCall.onMatch(VolcanoRuleCall.java:235) at org.apache.calcite.plan.volcano.VolcanoPlanner.findBestExp(VolcanoPlanner.java:631) at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:327) at org.apache.flink.table.plan.Optimizer.runVolcanoPlanner(Optimizer.scala:280) at org.apache.flink.table.plan.Optimizer.optimizeLogicalPlan(Optimizer.scala:199) at org.apache.flink.table.plan.StreamOptimizer.optimize(StreamOptimizer.scala:66) at org.apache.flink.table.planner.StreamPlanner.translateToType(StreamPlanner.scala:389) at org.apache.flink.table.planner.StreamPlanner.org$apache$flink$table$planner$StreamPlanner$$translate(StreamPlanner.scala:180) at org.apache.flink.table.planner.StreamPlanner$$anonfun$translate$1.apply(StreamPlanner.scala:117) at org.apache.flink.table.planner.StreamPlanner$$anonfun$translate$1.apply(StreamPlanner.scala:117) at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234) at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234) at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:891) at scala.collection.AbstractIterator.foreach(Iterator.scala:1334) at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72) at scala.collection.AbstractIterable.foreach(Iterable.scala:54) at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;map(TraversableLike.scala:234) at scala.collection.AbstractTraversable.map(Traversable.scala:104) at org.apache.flink.table.planner.StreamPlanner.translate(StreamPlanner.scala:117) at org.apache.flink.table.api.java.internal.StreamTableEnvironmentImpl.toDataStream(StreamTableEnvironmentImpl.java:351) at org.apache.flink.table.api.java.internal.StreamTableEnvironmentImpl.toAppendStream(StreamTableEnvironmentImpl.java:259) at org.apache.flink.table.api.java.internal.StreamTableEnvironmentImpl.toAppendStream(StreamTableEnvironmentImpl.java:250) at org.apache.flink.table.api.example.batch.JavaBatchWordCount.main(JavaBatchWordCount.java:64)Caused by: org.apache.flink.table.api.ValidationException: Rowtime field &lt;span class=&quot;code-quote&quot;&gt;&apos;rowtime&apos;&lt;/span&gt; has invalid type LocalDateTime. Rowtime attributes must be of type Timestamp. at org.apache.flink.table.sources.TableSourceUtil$$anonfun$3.apply(TableSourceUtil.scala:114) at org.apache.flink.table.sources.TableSourceUtil$$anonfun$3.apply(TableSourceUtil.scala:92) at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234) at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234) at scala.collection.IndexedSeqOptimized$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IndexedSeqOptimized.scala:33) at scala.collection.mutable.ArrayOps$ofRef.foreach(ArrayOps.scala:186) at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;map(TraversableLike.scala:234) at scala.collection.mutable.ArrayOps$ofRef.map(ArrayOps.scala:186) at org.apache.flink.table.sources.TableSourceUtil$.computeIndexMapping(TableSourceUtil.scala:92) at org.apache.flink.table.sources.TableSourceUtil$.getPhysicalIndexes(TableSourceUtil.scala:307) at org.apache.flink.table.plan.rules.logical.PushProjectIntoTableSourceScanRule.onMatch(PushProjectIntoTableSourceScanRule.scala:46) at org.apache.calcite.plan.volcano.VolcanoRuleCall.onMatch(VolcanoRuleCall.java:208) ... 22 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13273538">FLINK-15168</key>
            <summary>Exception is thrown when using kafka source connector with flink planner</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="hxbks2ks">Huang Xingbo</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 10 Dec 2019 07:17:59 +0000</created>
                <updated>Thu, 19 Dec 2019 21:46:26 +0000</updated>
                            <resolved>Thu, 19 Dec 2019 21:46:26 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Table SQL / Legacy Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16992356" author="docete" created="Tue, 10 Dec 2019 09:32:36 +0000"  >&lt;p&gt;The reason is&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14645&quot; title=&quot;Data types defined in DDL will lose precision and nullability when converting to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14645&quot;&gt;&lt;del&gt;FLINK-14645&lt;/del&gt;&lt;/a&gt; introduces DataType(instead of TypeInformation) de/serialize for Schema.&#160;&lt;/p&gt;

&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14645&quot; title=&quot;Data types defined in DDL will lose precision and nullability when converting to properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14645&quot;&gt;&lt;del&gt;FLINK-14645&lt;/del&gt;&lt;/a&gt;, the Types.SQL_TIMESTAMP in the Schema would serialize to &quot;TIMESTAMP&quot; and deserialize to Types.SQL_TIMESTAMP back when create the kafka table source.&#160;&lt;/p&gt;

&lt;p&gt;After Flink-14645, the&#160;Types.SQL_TIMESTAMP in the Schema would serialize to &quot;TIMESTAMP(3)&quot; and deserialize to DataTypes.Timestamp(3).bridgedTo(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;LocalDateTime&amp;#93;&lt;/span&gt;), which convert to Types.LOCAL_DATE_TIME in&#160;TableSourceUtil&lt;/p&gt;</comment>
                            <comment id="16992363" author="docete" created="Tue, 10 Dec 2019 09:39:46 +0000"  >&lt;p&gt;We should use new type system in&#160;TableSourceUtil to avoid such surprise &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16992375" author="lzljs3620320" created="Tue, 10 Dec 2019 09:52:44 +0000"  >&lt;p&gt;&amp;gt;&#160;We should use new type system in&#160;TableSourceUtil to avoid such surprise&lt;/p&gt;

&lt;p&gt;Before this, we should find why it is a&#160;DataTypes.Timestamp(3).bridgedTo(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;LocalDateTime&amp;#93;&lt;/span&gt;) instead of&#160;DataTypes.Timestamp(3).bridgedTo(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Timestamp&amp;#93;&lt;/span&gt;).&lt;/p&gt;</comment>
                            <comment id="16992398" author="docete" created="Tue, 10 Dec 2019 10:23:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;The serialize/deserialize of DataType in TableSchema ignores conversion class&lt;/p&gt;</comment>
                            <comment id="16992707" author="dawidwys" created="Tue, 10 Dec 2019 16:20:53 +0000"  >&lt;p&gt;I increased the priority of this issue as it basically makes table sources with time attributes unusable. (at least with legacy planner). I think it is the right assessment that the &lt;tt&gt;TableSourceUtil&lt;/tt&gt; is the problem. I think it might be even good idea to aim to remove the whole class altogether. I can try and help with that if you have not started working on that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=docete&quot; class=&quot;user-hover&quot; rel=&quot;docete&quot;&gt;docete&lt;/a&gt; yet.&lt;/p&gt;
</comment>
                            <comment id="16993156" author="docete" created="Wed, 11 Dec 2019 03:10:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;&#160;I have not started preparing PR for this bug, feel free to take it.&lt;/p&gt;</comment>
                            <comment id="16994345" author="leonard xu" created="Thu, 12 Dec 2019 07:45:14 +0000"  >&lt;p&gt;This issue will lead end2end  cron test fail every day too.&lt;/p&gt;</comment>
                            <comment id="16994529" author="jark" created="Thu, 12 Dec 2019 10:58:49 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; for working on it. I can help to review once the PR is ready. &lt;/p&gt;</comment>
                            <comment id="17000428" author="dawidwys" created="Thu, 19 Dec 2019 21:46:26 +0000"  >&lt;p&gt;Fixed in&lt;br/&gt;
master: 39b7992db59fb55d5408b5528d17c924dfce649e&lt;br/&gt;
1.10: 422ab8a928413dde21e5c4c8a4068751b7d23fb7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13263965">FLINK-14505</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13275432">FLINK-15323</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13273921">FLINK-15200</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13275227">FLINK-15316</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 47 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09iag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>