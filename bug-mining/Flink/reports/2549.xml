<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9841] Web UI only show partial taskmanager log </title>
                <link>https://issues.apache.org/jira/browse/FLINK-9841</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In the web UI, we select a task manager and click the &quot;log&quot; tab, but the UI only show the partial log (first part), can never update even if we click the &quot;refresh&quot; button.&lt;/p&gt;

&lt;p&gt;However, the job manager is always OK.&lt;/p&gt;

&lt;p&gt;The reason is the resource be closed twice.&lt;/p&gt;</description>
                <environment>&lt;p&gt;env : Flink on YARN&lt;/p&gt;

&lt;p&gt;version : 1.5.0&lt;/p&gt;</environment>
        <key id="13171934">FLINK-9841</key>
            <summary>Web UI only show partial taskmanager log </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yanghua">vinoyang</assignee>
                                    <reporter username="yanghua">vinoyang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 13 Jul 2018 08:04:56 +0000</created>
                <updated>Mon, 23 Jul 2018 12:25:48 +0000</updated>
                            <resolved>Mon, 23 Jul 2018 12:25:48 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Runtime / REST</component>
                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16542893" author="githubbot" created="Fri, 13 Jul 2018 11:11:20 +0000"  >&lt;p&gt;GitHub user yanghua opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9841&quot; title=&quot;Web UI only show partial taskmanager log &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9841&quot;&gt;&lt;del&gt;FLINK-9841&lt;/del&gt;&lt;/a&gt; Web UI only show partial taskmanager log&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;This pull request fixed a bug triggered web UI only show partial taskmanager log&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Remove the redundant resource close&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / *&lt;b&gt;not documented&lt;/b&gt;*)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/yanghua/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yanghua/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9841&quot; title=&quot;Web UI only show partial taskmanager log &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9841&quot;&gt;&lt;del&gt;FLINK-9841&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6329&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e69efdef7546bd88c5a73d303e689ea5d051b931&lt;br/&gt;
Author: yanghua &amp;lt;yanghua1127@...&amp;gt;&lt;br/&gt;
Date:   2018-07-13T08:48:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9841&quot; title=&quot;Web UI only show partial taskmanager log &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9841&quot;&gt;&lt;del&gt;FLINK-9841&lt;/del&gt;&lt;/a&gt; Web UI only show partial taskmanager log&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16542931" author="githubbot" created="Fri, 13 Jul 2018 11:37:28 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol yes, you are right, sorry about my expression.  here we should not use try-with-resource, because the listener will close the file. And it seems try-with-resource close operation more faster than the complete listener.&lt;/p&gt;</comment>
                            <comment id="16544549" author="githubbot" created="Sun, 15 Jul 2018 14:02:06 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys  can you review this PR?&lt;/p&gt;</comment>
                            <comment id="16545107" author="githubbot" created="Mon, 16 Jul 2018 11:53:05 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329#discussion_r202655436&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329#discussion_r202655436&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/taskmanager/AbstractTaskManagerFileHandler.java &amp;#8212;&lt;br/&gt;
    @@ -208,51 +209,77 @@ private void removeBlob(RemovalNotification&amp;lt;ResourceID, CompletableFuture&amp;lt;Transi&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	private void transferFile(ChannelHandlerContext ctx, File file, HttpRequest httpRequest) throws FlinkException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (final RandomAccessFile randomAccessFile = new RandomAccessFile(file, &quot;r&quot;)) {&lt;/li&gt;
	&lt;li&gt;final long fileLength = randomAccessFile.length();&lt;br/&gt;
    +		final RandomAccessFile randomAccessFile;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (final FileChannel fileChannel = randomAccessFile.getChannel()) {&lt;br/&gt;
    +		try 
{
    +			randomAccessFile = new RandomAccessFile(file, &quot;r&quot;);
    +		}
&lt;p&gt; catch (FileNotFoundException e) &lt;/p&gt;
{
    +			throw new FlinkException(&quot;Can not find file &quot; + file + &quot;.&quot;, e);
    +		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;HttpResponse response = new DefaultHttpResponse(HTTP_1_1, OK);&lt;/li&gt;
	&lt;li&gt;response.headers().set(CONTENT_TYPE, &quot;text/plain&quot;);&lt;br/&gt;
    +		final long fileLength;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (HttpHeaders.isKeepAlive(httpRequest)) 
{
    -					response.headers().set(CONNECTION, HttpHeaders.Values.KEEP_ALIVE);
    -				}&lt;/li&gt;
	&lt;li&gt;HttpHeaders.setContentLength(response, fileLength);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// write the initial line and the header.&lt;/li&gt;
	&lt;li&gt;ctx.write(response);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// write the content.&lt;/li&gt;
	&lt;li&gt;final ChannelFuture lastContentFuture;&lt;/li&gt;
	&lt;li&gt;final GenericFutureListener&amp;lt;Future&amp;lt;? super Void&amp;gt;&amp;gt; completionListener = future -&amp;gt; 
{
    -					fileChannel.close();
    -					randomAccessFile.close();
    -				}
&lt;p&gt;;&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (ctx.pipeline().get(SslHandler.class) == null) 
{
    -					ctx.write(
    -						new DefaultFileRegion(fileChannel, 0, fileLength), ctx.newProgressivePromise())
    -						.addListener(completionListener);
    -					lastContentFuture = ctx.writeAndFlush(LastHttpContent.EMPTY_LAST_CONTENT);
    -
    -				}
&lt;p&gt; else &lt;/p&gt;
{
    -					lastContentFuture = ctx
    -						.writeAndFlush(
    -							new HttpChunkedInput(new ChunkedFile(randomAccessFile, 0, fileLength, 8192)),
    -							ctx.newProgressivePromise())
    -						.addListener(completionListener);
    -
    -					// HttpChunkedInput will write the end marker (LastHttpContent) for us.
    -				}
&lt;p&gt;    +		try {&lt;br/&gt;
    +			fileLength = randomAccessFile.length();&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    you could move this back into the following try block, like this:&lt;br/&gt;
    ```&lt;br/&gt;
    try {&lt;br/&gt;
    			final long fileLength = randomAccessFile.length();&lt;br/&gt;
    			final FileChannel fileChannel = randomAccessFile.getChannel();&lt;/p&gt;

&lt;p&gt;    			try &lt;/p&gt;
{
    				[... actual handler code ...]
    			}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
    				fileChannel.close();
    				throw e;
    			}
&lt;p&gt;    		} catch (IOException ioe) {&lt;br/&gt;
    			try &lt;/p&gt;
{
    				randomAccessFile.close();
    			}
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    				log.warn(&quot;Error while closing file.&quot;, e);
    			}
&lt;p&gt;    		}&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16547742" author="githubbot" created="Wed, 18 Jul 2018 12:20:48 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol this PR match your requirement? I hope it can be merged into 1.6, so that users can see the full taskmanager log. &lt;/p&gt;</comment>
                            <comment id="16552600" author="githubbot" created="Mon, 23 Jul 2018 10:15:53 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6329&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16552746" author="zentol" created="Mon, 23 Jul 2018 12:25:48 +0000"  >&lt;p&gt;master: 8d58bf4a110441a0f3c9d592f8f34ccacb7cb9a8&lt;br/&gt;
1.6: b08414bc041e42d968e8289a8412e77efe14dc94&lt;br/&gt;
1.5: 1ec893027b0b24545509ff9715039fc3580130a0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vuxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>