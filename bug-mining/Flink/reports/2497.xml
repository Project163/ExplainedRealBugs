<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8785] JobSubmitHandler does not handle JobSubmissionExceptions</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8785</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If the job submission, i.e. &lt;tt&gt;DispatcherGateway#submitJob&lt;/tt&gt; fails with a &lt;tt&gt;JobSubmissionException&lt;/tt&gt; the &lt;tt&gt;JobSubmissionHandler&lt;/tt&gt; returns &quot;Internal server error&quot; instead of signaling the failed job submission.&lt;/p&gt;

&lt;p&gt;This can for example occur if the transmitted execution graph is faulty, as tested by the &lt;tt&gt;JobSubmissionFailsITCase&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13140941">FLINK-8785</key>
            <summary>JobSubmitHandler does not handle JobSubmissionExceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>flip-6</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 26 Feb 2018 15:08:02 +0000</created>
                <updated>Wed, 2 Oct 2019 17:50:38 +0000</updated>
                            <resolved>Tue, 3 Jul 2018 19:16:36 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                    <component>Runtime / REST</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16391274" author="wind_ljy" created="Thu, 8 Mar 2018 14:03:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; You mean the exception should be caught instead of being thrown ?&lt;/p&gt;</comment>
                            <comment id="16404597" author="zentol" created="Mon, 19 Mar 2018 10:26:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wind_ljy&quot; class=&quot;user-hover&quot; rel=&quot;wind_ljy&quot;&gt;wind_ljy&lt;/a&gt; Handlers are only allowed to throw {{RestHandlerException}}s, to provide proper error messages and error codes.&lt;/p&gt;</comment>
                            <comment id="16405966" author="wind_ljy" created="Tue, 20 Mar 2018 08:43:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; I can see that many handlers send error response&#160;whose &quot;ErrorResponseBody&quot; is&#160;&quot;internal server error&quot;. I guess you expect that the &quot;ErrorResponseBody&quot; returns the real message of the exception like &quot;The job graph is wrong&quot;. I can take this task if you can give me more details about this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And I can&apos;t see &quot;internal server error&quot; in&#160;JobSubmissionFailsITCase, is it because the job is not submitted in a restful way ?&lt;/p&gt;</comment>
                            <comment id="16406048" author="zentol" created="Tue, 20 Mar 2018 10:00:05 +0000"  >&lt;p&gt;You can reproduce this by starting a flip6 cluster (you can use &lt;tt&gt;MiniCluster&lt;/tt&gt; in the IDE) and submitting a job using the &lt;tt&gt;RestClusterClient&lt;/tt&gt;. (See &lt;tt&gt;MiniClusterResource&lt;/tt&gt; on how to set these up)&lt;/p&gt;

&lt;p&gt;I went through all cases where we explicitly return an internal server error (by searching for the string), and those are all intended as they truly only occur on internal errors. Handlers are allowed to throw internal server errors, but must do so explicitly.&lt;/p&gt;</comment>
                            <comment id="16413085" author="wind_ljy" created="Sun, 25 Mar 2018 15:54:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; Thanks! I&apos;ve reproduced the &quot;internal server error&quot; and run several unit tests of it. I find that the easiest way to return an error message is adding the &quot;error.getMessage()&quot;:&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HandlerUtils.sendErrorResponse(
   ctx,
   httpRequest,
   &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ErrorResponseBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal server error. &quot;&lt;/span&gt; + error.getMessage() + &lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;),
   HttpResponseStatus.INTERNAL_SERVER_ERROR,
   responseHeaders);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For example, if you submit an empty JobGraph, the&#160;response will be &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;Internal server error.Could not start JobManager.&amp;#93;&lt;/span&gt;&quot;. If it&apos;s still not explicit enough, I can add more messages in &quot;Dispatcher.submitJob&quot; and the response will be &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;Internal server error.Could not start JobManager.Could not set up JobManager.The given job is empty.&amp;#93;&lt;/span&gt;&quot;. The response is long but I can&apos;t&#160;do anything about it because the messages are delivered and combined between functions.&lt;/p&gt;

&lt;p&gt;What do you think of&#160;my plan or do you have any suggestions ?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16440751" author="zentol" created="Tue, 17 Apr 2018 11:09:14 +0000"  >&lt;p&gt;The &lt;tt&gt;ErrorResponseBody&lt;/tt&gt; can accept a list of errors. I would suggest to pass in the the message of all exceptions in the trace.&lt;/p&gt;

&lt;p&gt;For the response code we will have to stick to &lt;tt&gt;INTERNAL_SERVER_ERROR&lt;/tt&gt; as we just can&apos;t differentiate between the errors right now.&lt;/p&gt;</comment>
                            <comment id="16441047" author="wind_ljy" created="Tue, 17 Apr 2018 15:42:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Okay, I&apos;ve already known how to do this. I will assign this task to myself if you don&apos;t mind.&lt;/p&gt;</comment>
                            <comment id="16443562" author="githubbot" created="Thu, 19 Apr 2018 04:30:18 +0000"  >&lt;p&gt;GitHub user buptljy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5877&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8785&quot; title=&quot;JobSubmitHandler does not handle JobSubmissionExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8785&quot;&gt;&lt;del&gt;FLINK-8785&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Job-Submission&amp;#93;&lt;/span&gt;Handle JobSubmissionExceptions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    We will get an &quot;Internal server error&quot; exception if we submit a jobgraph with a restclusterclient. This PR helps us get more details and causes of the exception, such as &quot;The jobgraph is empty&quot; message.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;br/&gt;
    Add causes and details of an exception which happens in job submission.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/buptljy/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/buptljy/flink&lt;/a&gt; 8785&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5877.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5877.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5877&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 443a3c0fda861cd5324083df93ed5080c2f9f476&lt;br/&gt;
Author: wind &amp;lt;bupt_ljy@...&amp;gt;&lt;br/&gt;
Date:   2018-04-18T17:29:14Z&lt;/p&gt;

&lt;p&gt;    add error messages&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16443563" author="wind_ljy" created="Thu, 19 Apr 2018 04:30:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; Can you help review my PR ?&lt;/p&gt;</comment>
                            <comment id="16444055" author="githubbot" created="Thu, 19 Apr 2018 13:37:37 +0000"  >&lt;p&gt;Github user buptljy commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5877&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol  ok, I thought that it was a small change before, so you mean we can make more changes on the messages of the exceptions and let them reported more properly ? &lt;br/&gt;
    I will test all the cases in the JobSubmissionFailsITCase. &lt;/p&gt;</comment>
                            <comment id="16510844" author="githubbot" created="Wed, 13 Jun 2018 09:26:37 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8785&quot; title=&quot;JobSubmitHandler does not handle JobSubmissionExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8785&quot;&gt;&lt;del&gt;FLINK-8785&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rest&amp;#93;&lt;/span&gt; Handle JobSubmissionExceptions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Currently, if a  `JobSubmissionException` occurs the `JobSubmissionHandler` only returns `505 Internal server error.`, with no details about the original exception.&lt;br/&gt;
    This PR modifies the handler to returns the messages of all exceptions in the stack trace.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;modify `RestHandlerException` to allow multiple error messages, similar to `ErrorResponseBody`&lt;/li&gt;
	&lt;li&gt;modify `JobSubmitHandler` to handle exceptions during the job submission&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;see `JobSubmitHandlerTest#testFailedJobSubmission&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 8785&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6158.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6158.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6158&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit bdb9a7b3949ce0fc1d31e57459e51f593ee0b699&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-06-13T09:15:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8785&quot; title=&quot;JobSubmitHandler does not handle JobSubmissionExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8785&quot;&gt;&lt;del&gt;FLINK-8785&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rest&amp;#93;&lt;/span&gt; Handle JobSubmissionExceptions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16510851" author="githubbot" created="Wed, 13 Jun 2018 09:32:05 +0000"  >&lt;p&gt;Github user buptljy closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5877&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16512451" author="githubbot" created="Thu, 14 Jun 2018 13:18:46 +0000"  >&lt;p&gt;Github user zentol closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6158&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16526130" author="githubbot" created="Thu, 28 Jun 2018 09:02:56 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8785&quot; title=&quot;JobSubmitHandler does not handle JobSubmissionExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8785&quot;&gt;&lt;del&gt;FLINK-8785&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rest&amp;#93;&lt;/span&gt; Handle JobSubmissionExceptions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR modifies the `JobSubmitHandler` to handle exceptions contained in the future returned by `DispatcherGateway#submitJob`.&lt;/p&gt;

&lt;p&gt;    An exception handler was added via `CompletableFuture#exceptionally` to return a proper `ErrorResponseBody` signaling that the job submission has failed.&lt;/p&gt;

&lt;p&gt;    This PR is pretty much the bare-bones solution; in the JIRA I advocated for including error messages from exceptions since there are various reasons why the submission could fail, but I can&apos;t find a satisfying solution.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;see new test in `JobSubmitHandlerTest`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 8785_basic&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6222&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 32fe49270596cdcf2f91f822c3a6504a14ba40eb&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-06-28T08:57:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8785&quot; title=&quot;JobSubmitHandler does not handle JobSubmissionExceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8785&quot;&gt;&lt;del&gt;FLINK-8785&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;rest&amp;#93;&lt;/span&gt; Handle JobSubmissionExceptions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16527669" author="githubbot" created="Fri, 29 Jun 2018 14:10:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199170250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199170250&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandler.java &amp;#8212;&lt;br/&gt;
    @@ -66,6 +67,9 @@ public JobSubmitHandler(&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		return gateway.submitJob(jobGraph, timeout)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()));&lt;br/&gt;
    +			.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()))&lt;br/&gt;
    +			.exceptionally(exception -&amp;gt; {&lt;br/&gt;
    +				throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Maybe we could add the `exception.getMessage` to the `message` of the `RestHandlerException`. Otherwise the user will only see `&quot;Job submission failed.&quot;` in the `ErrorResponseBody`. With the change it could be `&quot;Job submission failed: Failure cause&quot;`&lt;/p&gt;</comment>
                            <comment id="16527670" author="githubbot" created="Fri, 29 Jun 2018 14:10:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199170668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199170668&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandlerTest.java &amp;#8212;&lt;br/&gt;
    @@ -87,4 +89,33 @@ public void testSuccessfulJobSubmission() throws Exception &lt;/p&gt;
{
     		handler.handleRequest(new HandlerRequest&amp;lt;&amp;gt;(request, EmptyMessageParameters.getInstance()), mockGateway)
     			.get();
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testFailedJobSubmission() throws Exception {&lt;br/&gt;
    +		final String errorMessage = &quot;test&quot;;&lt;br/&gt;
    +		DispatcherGateway mockGateway = mock(DispatcherGateway.class);&lt;br/&gt;
    +		when(mockGateway.submitJob(any(JobGraph.class), any(Time.class))).thenReturn(FutureUtils.completedExceptionally(new Exception(errorMessage)));&lt;br/&gt;
    +		GatewayRetriever&amp;lt;DispatcherGateway&amp;gt; mockGatewayRetriever = mock(GatewayRetriever.class);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    No need to create a mock. `() -&amp;gt; CompletableFuture.completed(mockGateway)` should be good enough.&lt;/p&gt;</comment>
                            <comment id="16527671" author="githubbot" created="Fri, 29 Jun 2018 14:10:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199171079&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199171079&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandlerTest.java &amp;#8212;&lt;br/&gt;
    @@ -87,4 +89,33 @@ public void testSuccessfulJobSubmission() throws Exception &lt;/p&gt;
{
     		handler.handleRequest(new HandlerRequest&amp;lt;&amp;gt;(request, EmptyMessageParameters.getInstance()), mockGateway)
     			.get();
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testFailedJobSubmission() throws Exception {&lt;br/&gt;
    +		final String errorMessage = &quot;test&quot;;&lt;br/&gt;
    +		DispatcherGateway mockGateway = mock(DispatcherGateway.class);&lt;br/&gt;
    +		when(mockGateway.submitJob(any(JobGraph.class), any(Time.class))).thenReturn(FutureUtils.completedExceptionally(new Exception(errorMessage)));&lt;br/&gt;
    +		GatewayRetriever&amp;lt;DispatcherGateway&amp;gt; mockGatewayRetriever = mock(GatewayRetriever.class);&lt;br/&gt;
    +&lt;br/&gt;
    +		JobSubmitHandler handler = new JobSubmitHandler(&lt;br/&gt;
    +			CompletableFuture.completedFuture(&quot;http://localhost:1234&quot;),&lt;br/&gt;
    +			mockGatewayRetriever,&lt;br/&gt;
    +			RpcUtils.INF_TIMEOUT,&lt;br/&gt;
    +			Collections.emptyMap());&lt;br/&gt;
    +&lt;br/&gt;
    +		JobGraph job = new JobGraph(&quot;testjob&quot;);&lt;br/&gt;
    +		JobSubmitRequestBody request = new JobSubmitRequestBody(job);&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			handler.handleRequest(new HandlerRequest&amp;lt;&amp;gt;(request, EmptyMessageParameters.getInstance()), mockGateway)
    +				.get();
    +		}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
    +			Throwable t = ExceptionUtils.stripExecutionException(e);&lt;br/&gt;
    +			if (t instanceof RestHandlerException)&lt;/p&gt;
{
    +				Assert.assertTrue(t.getMessage().equals(&quot;Job submission failed.&quot;));
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				throw e;
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think we should make sure that `errorMessage` is part of the `RestHandlerException#message`. Otherwise this information won&apos;t be sent to the client in the form of the `ErrorResponseBody`.&lt;/p&gt;</comment>
                            <comment id="16528071" author="githubbot" created="Fri, 29 Jun 2018 18:42:24 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199248513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199248513&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandler.java &amp;#8212;&lt;br/&gt;
    @@ -66,6 +67,9 @@ public JobSubmitHandler(&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		return gateway.submitJob(jobGraph, timeout)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()));&lt;br/&gt;
    +			.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()))&lt;br/&gt;
    +			.exceptionally(exception -&amp;gt; {&lt;br/&gt;
    +				throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I&apos;m not quite fond of the idea. As alluded in the PR description and JIRA I agree that the existing error message isn&apos;t &lt;em&gt;helpful&lt;/em&gt;, yet better than the current state.&lt;/p&gt;

&lt;p&gt;    I rather like that so far the REST API has control over the error messages. This ensures that the user only sees messages that were actually meant for him.&lt;/p&gt;

&lt;p&gt;    In contrast, exception messages are pretty much arbitrary. They may change at will, the audience isn&apos;t defined (user vs dev), may only helpful if the fully stack trace is present, often don&apos;t have any message at all (see usages of `Preconditions`, or NPEs) and typically only describe what went wrong, not why, how to fix it or if it even was a user-error. Given that this would break down the barrier between internal/user-facing messages you obviously also run into cases where users have &lt;em&gt;no idea&lt;/em&gt; what the message even means. Finally you end up with mismatches between the error message and error code.&lt;/p&gt;

&lt;p&gt;    To me the underlying issue is that `submitJob` funnels all manner of exceptions into a `FlinkException/JobSubmissionException` that we can&apos;t do much with. Neither can we categorize them in any way, nor distinguish between who&apos;s responsible (user vs Flink) nor when in the process the failure occurred.&lt;br/&gt;
    Without diving into the implementation you don&apos;t &lt;em&gt;even know which exceptions are thrown&lt;/em&gt;, but i suppose this is a general issue of `CompletableFutures`.&lt;/p&gt;</comment>
                            <comment id="16528609" author="githubbot" created="Sat, 30 Jun 2018 07:53:26 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6229&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @satybald thanks for your contribution, based on &lt;span class=&quot;error&quot;&gt;&amp;#91;Flink&amp;#39;s contribution guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;) you&apos;d better open an issue in &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/FLINK/issues/FLINK-8785?filter=allopenissues&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/FLINK/issues/FLINK-8785?filter=allopenissues&lt;/a&gt;) before submit a PR.&lt;/p&gt;</comment>
                            <comment id="16528914" author="githubbot" created="Sat, 30 Jun 2018 22:19:26 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199333683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199333683&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandler.java &amp;#8212;&lt;br/&gt;
    @@ -66,6 +67,9 @@ public JobSubmitHandler(&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		return gateway.submitJob(jobGraph, timeout)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()));&lt;br/&gt;
    +			.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()))&lt;br/&gt;
    +			.exceptionally(exception -&amp;gt; {&lt;br/&gt;
    +				throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I see your point. I&apos;m just wondering whether some bits of context wouldn&apos;t be helpful on the client side when using the CLI. So for example if the job was misconfigured or if it was already submitted to the cluster in HA mode, then it would be helpful for the user to know.&lt;/p&gt;</comment>
                            <comment id="16529799" author="githubbot" created="Mon, 2 Jul 2018 12:22:06 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199477966&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199477966&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandler.java &amp;#8212;&lt;br/&gt;
    @@ -66,6 +67,9 @@ public JobSubmitHandler(&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		return gateway.submitJob(jobGraph, timeout)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()));&lt;br/&gt;
    +			.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()))&lt;br/&gt;
    +			.exceptionally(exception -&amp;gt; {&lt;br/&gt;
    +				throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    well, there&apos;s no doubt that it &lt;em&gt;could&lt;/em&gt; be helpful; my point is that it can be &lt;em&gt;harmful&lt;/em&gt; if not done properly.&lt;/p&gt;

&lt;p&gt;    The `submitJob` should either provide the `JobSubmitHandler` with means to detect these exceptions and create adequate responses, or explicitly throw exceptions with messages that we can safely pass on to users.&lt;/p&gt;

&lt;p&gt;    That said, I do not know how to do either of these things in a good way. &#128542; &lt;/p&gt;

&lt;p&gt;    For completeness sake, here are ideas that came to mind:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;1&lt;br/&gt;
    Introduce a special `FlinkUserFacingException` that we &quot;trust&quot; to contain a good error message.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Con: This provides little additional safety and will never provide proper HTTP response code.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;2&lt;br/&gt;
    Introduce dedicated exceptions for the scenarios that you listed and explicitly look for them in the `exceptionally` block, i.e&lt;br/&gt;
    ```&lt;br/&gt;
    .exceptionally(exception -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    	if (exception instanceof JobAlreadyExistsException) {
    		throw new CompletionException(new RestHandlerException(&quot;Job already exists.&quot;, HttpResponseStatus.BAD_REQUEST, exception));
    	} else {
    		throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
    	}    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    ```&lt;/p&gt;&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Con: Obviously, this approach is inherently flawed as there is no guarantee that a given exception can be thrown; we would have to manually keep it in sync with the actual implementation because `CompletableFuture` throw a wrench into sane exception handling. &#128545; &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;3&lt;br/&gt;
    Encode possible user-facing exceptions in the return value of `submitJob`, i.e. return a `AckOrException`&lt;br/&gt;
    ```&lt;br/&gt;
    public class AckOrException 
{
    	// holds exception, could also be a series of nullable fields
    	private final SuperEither&amp;lt;ExceptionA, ExceptionB, ExceptionC&amp;gt; exception; 
    	...
    	public void throwIfError() throws ExceptionA, ExceptionB, ExceptionC;
    }
&lt;p&gt;    ```&lt;br/&gt;
    Con: Relies on users to call `throwIfError` and introduces an entirely separate channel for passing errors, but it would allow exception matching.&lt;/p&gt;&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16530990" author="githubbot" created="Tue, 3 Jul 2018 08:15:18 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199719645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199719645&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandler.java &amp;#8212;&lt;br/&gt;
    @@ -66,6 +67,9 @@ public JobSubmitHandler(&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		return gateway.submitJob(jobGraph, timeout)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()));&lt;br/&gt;
    +			.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()))&lt;br/&gt;
    +			.exceptionally(exception -&amp;gt; {&lt;br/&gt;
    +				throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Do note that this discussion isn&apos;t really blocking the PR from being merged as it would effectively be an extension of it.&lt;/p&gt;</comment>
                            <comment id="16531275" author="githubbot" created="Tue, 3 Jul 2018 12:13:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222#discussion_r199783421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222#discussion_r199783421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/rest/handler/job/JobSubmitHandler.java &amp;#8212;&lt;br/&gt;
    @@ -66,6 +67,9 @@ public JobSubmitHandler(&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		return gateway.submitJob(jobGraph, timeout)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()));&lt;br/&gt;
    +			.thenApply(ack -&amp;gt; new JobSubmitResponseBody(&quot;/jobs/&quot; + jobGraph.getJobID()))&lt;br/&gt;
    +			.exceptionally(exception -&amp;gt; {&lt;br/&gt;
    +				throw new CompletionException(new RestHandlerException(&quot;Job submission failed.&quot;, HttpResponseStatus.INTERNAL_SERVER_ERROR, exception));
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I would be in favor of approach 3 because we are doing something similar for the `JobExecutionResult`/`JobResult`. We could then throw the exception on the `RestClusterClient`. And I also agree that this is something we can add as a follow up. Can you please create a JIRA issue for this @zentol.&lt;/p&gt;</comment>
                            <comment id="16531293" author="githubbot" created="Tue, 3 Jul 2018 12:27:40 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging, will create the issue once I&apos;m done.&lt;/p&gt;</comment>
                            <comment id="16531833" author="zentol" created="Tue, 3 Jul 2018 19:16:36 +0000"  >&lt;p&gt;master: 81d135578c026842e6d8bc95391da60886612166&lt;/p&gt;

&lt;p&gt;1.5: 06b9bf13197712f3c6e81b380386b78dc5979de0&lt;/p&gt;</comment>
                            <comment id="16531842" author="githubbot" created="Tue, 3 Jul 2018 19:26:00 +0000"  >&lt;p&gt;Github user zentol closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6222&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6222&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13144277">FLINK-8925</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13147960">FLINK-9082</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13165333">FLINK-9568</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qljb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>