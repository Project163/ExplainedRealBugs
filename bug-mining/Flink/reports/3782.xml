<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:44:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-16281] parameter &apos;maxRetryTimes&apos; can not work in JDBCUpsertTableSink</title>
                <link>https://issues.apache.org/jira/browse/FLINK-16281</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When I insert data to a mysql table that do no exists in my test database will get exception,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table &lt;span class=&quot;code-quote&quot;&gt;&apos;test.gmv_table&apos;&lt;/span&gt; doesn&lt;span class=&quot;code-quote&quot;&gt;&apos;t existCaused by: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table &apos;&lt;/span&gt;test.gmv_table&lt;span class=&quot;code-quote&quot;&gt;&apos; doesn&apos;&lt;/span&gt;t exist at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) at java.lang.reflect.Constructor.newInstance(Constructor.java:423) at com.mysql.jdbc.Util.handleNewInstance(Util.java:425) at com.mysql.jdbc.Util.getInstance(Util.java:408) at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:944) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3933) at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:3869) at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:2524) at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:2675) at com.mysql.jdbc.ConnectionImpl.execSQL(ConnectionImpl.java:2465) at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1912) at com.mysql.jdbc.PreparedStatement.executeUpdateInternal(PreparedStatement.java:2133) at com.mysql.jdbc.PreparedStatement.executeBatchSerially(PreparedStatement.java:1810) ... 44 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but after I increased the &apos;connector.write.max-retries&apos; value from 1 to 3, the exception disappeared.&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;p&gt;So, I look up the flush&#160; implement code :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void flush() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
   checkFlushException();

   &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt;= maxRetryTimes; i++) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
         jdbcWriter.executeBatch();
         batchCount = 0;
         &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
         LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;JDBC executeBatch error, retry times = {}&quot;&lt;/span&gt;, i, e);
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i &amp;gt;= maxRetryTimes) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
         }
         &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000 * i);
      }
   }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I found the `jdbcWriter` will clear its `batchedArgs` member after first&#160;call `jdbcWriter.executeBatch()` as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//com.mysql.jdbc.PreparedStatement
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.statementExecuting.set(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    clearBatch();
}

&lt;span class=&quot;code-comment&quot;&gt;// clearBatch() function implement
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void clearBatch() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
 &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (checkClosed().getConnectionMutex()) {
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.batchedArgs != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.batchedArgs.clear();
 }
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the next time&#65288; where i&amp;gt; 1&#65289; to call `jdbcWriter.executeBatch()` ,&#160; the function will return empty array rather than execute the flush data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//com.mysql.jdbc.PreparedStatement
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.batchedArgs == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.batchedArgs.size() == 0) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;[0];
}
... &lt;span class=&quot;code-comment&quot;&gt;// flush data code&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13287539">FLINK-16281</key>
            <summary>parameter &apos;maxRetryTimes&apos; can not work in JDBCUpsertTableSink</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="leonard">Leonard Xu</assignee>
                                    <reporter username="leonard">Leonard Xu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 25 Feb 2020 15:44:57 +0000</created>
                <updated>Wed, 13 May 2020 16:46:32 +0000</updated>
                            <resolved>Tue, 3 Mar 2020 13:49:27 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.1</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Ecosystem</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17045055" author="leonard xu" created="Wed, 26 Feb 2020 01:17:21 +0000"  >&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17045062" author="lzljs3620320" created="Wed, 26 Feb 2020 01:26:46 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&#160;for reporting. Can you give more information? Where do your codes come from? What is this bug? How to re-produce this bug? I don&apos;t get what are you mean.&lt;/p&gt;</comment>
                            <comment id="17045075" author="leonard xu" created="Wed, 26 Feb 2020 01:50:09 +0000"  >&lt;p&gt;Hi&#65292; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;&lt;br/&gt;
I update the description information, hope it&apos;s clear enough.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17045097" author="lzljs3620320" created="Wed, 26 Feb 2020 02:48:10 +0000"  >&lt;p&gt;I got it, More specifically, it is bug in &lt;tt&gt;AppendOnlyWriter&lt;/tt&gt;, &lt;tt&gt;UpsertWriter&lt;/tt&gt;&#160;is OK, right?&lt;/p&gt;</comment>
                            <comment id="17045098" author="lzljs3620320" created="Wed, 26 Feb 2020 02:48:41 +0000"  >&lt;p&gt;Feel free to open a pull request.&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17045103" author="leonard xu" created="Wed, 26 Feb 2020 02:54:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;Yes&#65292; it only exists in&#160;AppendOnlyWriter, I&apos;d like to open a PR.&lt;/p&gt;</comment>
                            <comment id="17049820" author="lzljs3620320" created="Tue, 3 Mar 2020 01:26:33 +0000"  >&lt;p&gt;master: 3e10f0a5ca1179f8a95185c3d3c03ec9fe0dabb6&lt;/p&gt;</comment>
                            <comment id="17049821" author="lzljs3620320" created="Tue, 3 Mar 2020 01:26:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&#160;can you open a PR for release-1.10?&lt;/p&gt;</comment>
                            <comment id="17049840" author="leonard xu" created="Tue, 3 Mar 2020 02:05:21 +0000"  >&lt;p&gt;Hi,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&#160;can you open a PR for release-1.10?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ok, I&apos;ll open a PR soon.&lt;/p&gt;</comment>
                            <comment id="17050226" author="leonard xu" created="Tue, 3 Mar 2020 13:48:25 +0000"  >&lt;p&gt;release-1.10: 833924dcab13879a5c896effb8fce8dc1963e826&lt;/p&gt;</comment>
                            <comment id="17106461" author="carp84" created="Wed, 13 May 2020 16:46:32 +0000"  >&lt;p&gt;Remove the release note since the existing one only marks commits for different branches rather than any notice-able content like incompatible changes or usage for new features, etc.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bvg0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>