<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30908] Fatal error in ResourceManager caused YARNSessionFIFOSecuredITCase.testDetachedMode to fail</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30908</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;There&apos;s a build failure in &lt;tt&gt;YARNSessionFIFOSecuredITCase.testDetachedMode&lt;/tt&gt; which is caused by a fatal error in the ResourceManager:&lt;br/&gt;
&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=45720&amp;amp;view=logs&amp;amp;j=245e1f2e-ba5b-5570-d689-25ae21e5302f&amp;amp;t=d04c9862-880c-52f5-574b-a7a79fef8e0f&amp;amp;l=29869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=45720&amp;amp;view=logs&amp;amp;j=245e1f2e-ba5b-5570-d689-25ae21e5302f&amp;amp;t=d04c9862-880c-52f5-574b-a7a79fef8e0f&amp;amp;l=29869&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Feb 05 02:41:58 java.io.InterruptedIOException: Interrupted waiting to send RPC request to server
Feb 05 02:41:58 java.io.InterruptedIOException: Interrupted waiting to send RPC request to server
Feb 05 02:41:58 	at org.apache.hadoop.ipc.Client.call(Client.java:1480) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.ipc.Client.call(Client.java:1422) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:118) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at com.sun.proxy.$Proxy31.allocate(Unknown Source) ~[?:?]
Feb 05 02:41:58 	at org.apache.hadoop.yarn.api.impl.pb.client.ApplicationMasterProtocolPBClientImpl.allocate(ApplicationMasterProtocolPBClientImpl.java:77) ~[hadoop-yarn-common-3.2.3.jar:?]
Feb 05 02:41:58 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_292]
Feb 05 02:41:58 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_292]
Feb 05 02:41:58 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_292]
Feb 05 02:41:58 	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_292]
Feb 05 02:41:58 	at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:422) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:165) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:157) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:95) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:359) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at com.sun.proxy.$Proxy32.allocate(Unknown Source) ~[?:?]
Feb 05 02:41:58 	at org.apache.hadoop.yarn.client.api.impl.AMRMClientImpl.allocate(AMRMClientImpl.java:325) ~[hadoop-yarn-client-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.yarn.client.api.async.impl.AMRMClientAsyncImpl$HeartbeatThread.run(AMRMClientAsyncImpl.java:311) [hadoop-yarn-client-3.2.3.jar:?]
Feb 05 02:41:58 Caused by: java.lang.InterruptedException
Feb 05 02:41:58 	at java.util.concurrent.FutureTask.awaitDone(FutureTask.java:404) ~[?:1.8.0_292]
Feb 05 02:41:58 	at java.util.concurrent.FutureTask.get(FutureTask.java:191) ~[?:1.8.0_292]
Feb 05 02:41:58 	at org.apache.hadoop.ipc.Client$Connection.sendRpcRequest(Client.java:1180) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	at org.apache.hadoop.ipc.Client.call(Client.java:1475) ~[hadoop-common-3.2.3.jar:?]
Feb 05 02:41:58 	... 17 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13523165">FLINK-30908</key>
            <summary>Fatal error in ResourceManager caused YARNSessionFIFOSecuredITCase.testDetachedMode to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xtsong">Xintong Song</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 6 Feb 2023 07:28:39 +0000</created>
                <updated>Wed, 3 May 2023 15:03:34 +0000</updated>
                            <resolved>Mon, 20 Feb 2023 02:12:16 +0000</resolved>
                                    <version>1.17.0</version>
                                    <fixVersion>1.17.0</fixVersion>
                                    <component>Deployment / YARN</component>
                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17684553" author="mapohl" created="Mon, 6 Feb 2023 09:52:00 +0000"  >&lt;p&gt;Not sure, yet, whether that&apos;s related but there&apos;s a &lt;tt&gt;ApplicationAttemptNotFoundException&lt;/tt&gt; which causes application &lt;tt&gt;application_1675564836997_0002&lt;/tt&gt; to be killed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
02:41:17,442 [IPC Server handler 9 on &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; port 46716] INFO  org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl [] - Stopping container with container Id: container_1675564836997_0002_01_000002
02:41:17,458 [IPC Server handler 2 on &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; port 45213] ERROR org.apache.hadoop.yarn.server.resourcemanager.ApplicationMasterService [] - Application attempt appattempt_1675564836997_0002_000001 doesn&apos;t exist in ApplicationMasterService cache.
02:41:17,459 [IPC Server handler 2 on &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; port 45213] INFO  org.apache.hadoop.ipc.Server                                 [] - IPC Server handler 2 on &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; port 45213, call Call#8 Retry#0 org.apache.hadoop.yarn.api.ApplicationMasterProtocolPB.allocate from 192.168.144.2:35386
org.apache.hadoop.yarn.exceptions.ApplicationAttemptNotFoundException: Application attempt appattempt_1675564836997_0002_000001 doesn&apos;t exist in ApplicationMasterService cache.
        at org.apache.hadoop.yarn.server.resourcemanager.ApplicationMasterService.allocate(ApplicationMasterService.java:407) ~[hadoop-yarn-server-resourcemanager-3.2.3.jar:?]
        at org.apache.hadoop.yarn.api.impl.pb.service.ApplicationMasterProtocolPBServiceImpl.allocate(ApplicationMasterProtocolPBServiceImpl.java:60) ~[hadoop-yarn-common-3.2.3.jar:?]
        at org.apache.hadoop.yarn.proto.ApplicationMasterProtocol$ApplicationMasterProtocolService$2.callBlockingMethod(ApplicationMasterProtocol.java:99) ~[hadoop-yarn-api-3.2.3.jar:?]
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:549) ~[hadoop-common-3.2.3.jar:?]
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine.java:518) ~[hadoop-common-3.2.3.jar:?]
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:1086) ~[hadoop-common-3.2.3.jar:?]
        at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:1029) [hadoop-common-3.2.3.jar:?]
        at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:957) [hadoop-common-3.2.3.jar:?]
        at java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_292]
        at javax.security.auth.Subject.doAs(Subject.java:422) [?:1.8.0_292]
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762) [hadoop-common-3.2.3.jar:?]
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:2957) [hadoop-common-3.2.3.jar:?]
02:41:17,560 [Listener at 2c636c5cfb18/37932] INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl        [] - Killed application application_1675564836997_0002
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Application container &lt;tt&gt;container_1675564836997_0002_01_000002&lt;/tt&gt; is used for the TaskManager (&lt;tt&gt;container_1675564836997_0002_01_000001&lt;/tt&gt; for the JobManager).&lt;/p&gt;</comment>
                            <comment id="17684555" author="mapohl" created="Mon, 6 Feb 2023 09:58:52 +0000"  >&lt;p&gt;The above mentioned error happens closely (time-wise) to the fatal error in Flink&apos;s ResourceManager:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-02-05 02:41:17,459 ERROR org.apache.hadoop.yarn.client.api.async.impl.AMRMClientAsyncImpl [] - Exception on heartbeat
java.io.InterruptedIOException: Interrupted waiting to send RPC request to server
    at org.apache.hadoop.ipc.Client.call(Client.java:1480) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.ipc.Client.call(Client.java:1422) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:231) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:118) ~[hadoop-common-3.2.3.jar:?]
    at com.sun.proxy.$Proxy31.allocate(Unknown Source) ~[?:?]
    at org.apache.hadoop.yarn.api.impl.pb.client.ApplicationMasterProtocolPBClientImpl.allocate(ApplicationMasterProtocolPBClientImpl.java:77) ~[hadoop-yarn-common-3.2.3.jar:?]
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_292]
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_292]
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_292]
    at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_292]
    at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:422) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeMethod(RetryInvocationHandler.java:165) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invoke(RetryInvocationHandler.java:157) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.io.retry.RetryInvocationHandler$Call.invokeOnce(RetryInvocationHandler.java:95) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:359) ~[hadoop-common-3.2.3.jar:?]
    at com.sun.proxy.$Proxy32.allocate(Unknown Source) ~[?:?]
    at org.apache.hadoop.yarn.client.api.impl.AMRMClientImpl.allocate(AMRMClientImpl.java:325) ~[hadoop-yarn-client-3.2.3.jar:?]
    at org.apache.hadoop.yarn.client.api.async.impl.AMRMClientAsyncImpl$HeartbeatThread.run(AMRMClientAsyncImpl.java:311) [hadoop-yarn-client-3.2.3.jar:?]
Caused by: java.lang.InterruptedException
    at java.util.concurrent.FutureTask.awaitDone(FutureTask.java:404) ~[?:1.8.0_292]
    at java.util.concurrent.FutureTask.get(FutureTask.java:191) ~[?:1.8.0_292]
    at org.apache.hadoop.ipc.Client$Connection.sendRpcRequest(Client.java:1180) ~[hadoop-common-3.2.3.jar:?]
    at org.apache.hadoop.ipc.Client.call(Client.java:1475) ~[hadoop-common-3.2.3.jar:?]
    ... 17 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="17684572" author="mapohl" created="Mon, 6 Feb 2023 10:31:44 +0000"  >&lt;p&gt;The WordCount job finishes successfully. This triggers the shutdown from the Flink side.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Application finishes at &lt;tt&gt;2023-02-05 02:41:17,116&lt;/tt&gt; where the JobMaster is removed from the ResourceManager&lt;/li&gt;
	&lt;li&gt;YarnTestBase sends an application status at &lt;tt&gt;02:41:17,357&lt;/tt&gt; and triggers the shutdown afterwards&lt;/li&gt;
	&lt;li&gt;Kill request received on the Yarn side at &lt;tt&gt;02:41:17,359&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;ClusterEntrypoint receives SIGTERM at &lt;tt&gt;02:41:17,381&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17684573" author="mapohl" created="Mon, 6 Feb 2023 10:32:19 +0000"  >&lt;p&gt;&lt;del&gt;There is an KRB error reported on INFO log level by the KdcHandler at &lt;tt&gt;02:41:13:755&lt;/tt&gt; Just to be sure: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bamrabi&quot; class=&quot;user-hover&quot; rel=&quot;bamrabi&quot;&gt;bamrabi&lt;/a&gt;: This issue is actual not a problem, is it? ...considering that we worked on Kerberos support in 1.17.&lt;/del&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
02:41:13,755 [     pool-3-thread-1] INFO  org.apache.kerby.kerberos.kerb.server.request.KdcRequest     [] - The preauth data is empty.
02:41:13,755 [     pool-3-thread-1] INFO  org.apache.kerby.kerberos.kerb.server.KdcHandler             [] - KRB error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing request:Additional pre-authentication required
02:41:13,808 [     pool-3-thread-1] INFO  org.apache.kerby.kerberos.kerb.server.request.AsRequest      [] - AS_REQ ISSUE: authtime 1675564873807,hadoop/localhost@EXAMPLE.COM &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; krbtgt/EXAMPLE.COM@EXAMPLE.COM
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Update&lt;/b&gt;: The concern shared above shouldn&apos;t be the reason for the cause. The error appears during the graceful shutdown of the JobManager process/ResourceManager. It looks like a race condition between YARN and Flink. There&apos;s s still communication happening between the ResourceManager and the TaskManager while the TaskManager is shut down by YARN.&lt;/p&gt;</comment>
                            <comment id="17684588" author="mapohl" created="Mon, 6 Feb 2023 10:50:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xtsong&quot; class=&quot;user-hover&quot; rel=&quot;xtsong&quot;&gt;xtsong&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huwh&quot; class=&quot;user-hover&quot; rel=&quot;huwh&quot;&gt;huwh&lt;/a&gt; may you have a look at it? Could that be an issue related to your work on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-20988&quot; title=&quot;Various resource allocation improvements for active resource managers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-20988&quot;&gt;&lt;del&gt;FLINK-20988&lt;/del&gt;&lt;/a&gt; subtasks?&lt;/p&gt;</comment>
                            <comment id="17684600" author="mapohl" created="Mon, 6 Feb 2023 11:13:58 +0000"  >&lt;p&gt;I&apos;ve found a comment from Xintong in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22312&quot; title=&quot;YARNSessionFIFOSecuredITCase&amp;gt;YARNSessionFIFOITCase.checkForProhibitedLogContents due to the heartbeat exception with Yarn RM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22312&quot;&gt;&lt;del&gt;FLINK-22312&lt;/del&gt;&lt;/a&gt; on this error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The InterruptedIOException is expected. It can happen if AMRMClient happens to be waiting for a heartbeat response when the cluster is shutdown.&lt;br/&gt;
I&apos;ll add it to the whitelist for the log prohibited string checking.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We also whitelist this error in &lt;a href=&quot;https://github.com/apache/flink/blob/573ed922346c791760d27653543c2b8df56f51f7/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java#L172-L174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;YarnTestBase:172-174&lt;/a&gt;. Do we need to find a way to avoid triggering the fatal error handler for this issue? &lt;/p&gt;</comment>
                            <comment id="17684602" author="mapohl" created="Mon, 6 Feb 2023 11:15:24 +0000"  >&lt;p&gt;Can we assume based on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22312&quot; title=&quot;YARNSessionFIFOSecuredITCase&amp;gt;YARNSessionFIFOITCase.checkForProhibitedLogContents due to the heartbeat exception with Yarn RM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22312&quot;&gt;&lt;del&gt;FLINK-22312&lt;/del&gt;&lt;/a&gt; that it&apos;s a ongoing issue that is not necessarily only an issue in 1.17 meaning that this issue isn&apos;t a blocker for the 1.17 release?&lt;/p&gt;</comment>
                            <comment id="17684615" author="xintongsong" created="Mon, 6 Feb 2023 11:44:14 +0000"  >&lt;p&gt;This is indeed related to FLINK_20988. The &lt;tt&gt;InterruptedIOException&lt;/tt&gt; is expected and is included in the whitelist for prohibited string checking. However, this should not be handled as a fatal error.&lt;/p&gt;

&lt;p&gt;I think this is a blocker. Depending on which process finishes first (the gracefully shutdown and the fatal error handling), it may cause the process to terminate with an error exit code, which lead to restarting of the application being shutdown.&lt;/p&gt;

&lt;p&gt;I&apos;ll provide a fix for it asap.&lt;/p&gt;</comment>
                            <comment id="17685040" author="xintongsong" created="Tue, 7 Feb 2023 03:48:05 +0000"  >&lt;p&gt;After looking more into the logs and Hadoop codes, we believe &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-20988&quot; title=&quot;Various resource allocation improvements for active resource managers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-20988&quot;&gt;&lt;del&gt;FLINK-20988&lt;/del&gt;&lt;/a&gt; is not the cause of this failure.&lt;/p&gt;

&lt;p&gt;The test failure is caused by:&lt;br/&gt;
1. &lt;tt&gt;AMRMClientAsync&lt;/tt&gt; sends an &lt;tt&gt;InterruptedIOException&lt;/tt&gt; to the callback handler (&lt;tt&gt;YarnContainerEventHandler&lt;/tt&gt;) after being stopped.&lt;br/&gt;
2. All errors sent to &lt;tt&gt;YarnContainerEventHandler&lt;/tt&gt; are treated as fatal error in Flink.&lt;/p&gt;

&lt;p&gt;This is not a newly introduced issue. 1) exists in Hadoop 2.9+ versions (&lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-5999&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-5999&lt;/a&gt;), and 2) is the behavior since yarn deployment is supported. &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-20988&quot; title=&quot;Various resource allocation improvements for active resource managers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-20988&quot;&gt;&lt;del&gt;FLINK-20988&lt;/del&gt;&lt;/a&gt; did introduce another chance for exceptions during shutdown to be handled as fatal error, but that is not the cause of this test failure. Given that this issue already exist in previous releases, I&apos;m downgrading this ticket to Critical priority.&lt;/p&gt;

&lt;p&gt;The proper fix might be to ignore the exceptions in &lt;tt&gt;YarnContainerEventHandler&lt;/tt&gt; after being terminated. I&apos;ll update the PR and fix this.&lt;/p&gt;</comment>
                            <comment id="17685045" author="fly_in_gis" created="Tue, 7 Feb 2023 03:59:42 +0000"  >&lt;p&gt;+1 for Xintong&apos;s analysis and proposal.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-5999&quot; title=&quot;AMRMClientAsync will stop if any exceptions thrown on allocate call &quot; class=&quot;issue-link&quot; data-issue-key=&quot;YARN-5999&quot;&gt;&lt;del&gt;YARN-5999&lt;/del&gt;&lt;/a&gt; introduced a side effect that &lt;tt&gt;CallbackHandler#onError&lt;/tt&gt; will have a chance to be executed when stopping the AMRMAyncClient.&lt;/p&gt;</comment>
                            <comment id="17690976" author="xintongsong" created="Mon, 20 Feb 2023 02:12:16 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master (1.18): 6b47f45ffd22e0ff332a528dccfbd8b664e28702&lt;/li&gt;
	&lt;li&gt;release-1.17: 6b47f45ffd22e0ff332a528dccfbd8b664e28702&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17691139" author="mapohl" created="Mon, 20 Feb 2023 11:22:16 +0000"  >&lt;p&gt;Thanks for providing a fix for that issue, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xtsong&quot; class=&quot;user-hover&quot; rel=&quot;xtsong&quot;&gt;xtsong&lt;/a&gt;. Just to fix things (the matching commit hash caught my attention) - here&apos;s an updated of the commits per branch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;master (1.18):
	&lt;ul&gt;
		&lt;li&gt;296ee78efdd5c19308a2967f5b7a2f994324b0f4&lt;/li&gt;
		&lt;li&gt;9b92a89c1853e140be3889df47c12bc36f42a96b&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;release-1.17:
	&lt;ul&gt;
		&lt;li&gt;aecefe756df39b44b18574483a02b6753b8092fc&lt;/li&gt;
		&lt;li&gt;6b47f45ffd22e0ff332a528dccfbd8b664e28702&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17691331" author="xintongsong" created="Tue, 21 Feb 2023 02:01:53 +0000"  >&lt;p&gt;Nice catch, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13525560">FLINK-31169</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13534509">FLINK-31974</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13529972">FLINK-31609</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13372976">FLINK-22312</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13055177" name="mvn-1.FLINK-30908.log" size="218134" author="mapohl" created="Mon, 6 Feb 2023 10:41:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fo20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>