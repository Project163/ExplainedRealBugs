<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14533] PushFilterIntoTableSourceScanRule misses predicate pushdowns</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14533</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When Flink attempts to perform predicate pushdown via `PushFilterIntoTableSourceScanRule`, it first checks the RexNodes to see if they can actually be pushed down to the source. It does that via `RexNodeToExpressionConverter.visitCall`, which traverses the nodes and eventually checks to see if it&apos;s a condition it knows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
call.getOperator &lt;span class=&quot;code-keyword&quot;&gt;match&lt;/span&gt; { 
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; SqlStdOperatorTable.OR =&amp;gt; Option(operands.reduceLeft { (l, r) =&amp;gt; Or(l.asInstanceOf[PlannerExpression], r.asInstanceOf[PlannerExpression]) }) 
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; SqlStdOperatorTable.AND =&amp;gt; Option(operands.reduceLeft { (l, r) =&amp;gt; And(l.asInstanceOf[PlannerExpression], r.asInstanceOf[PlannerExpression]) }) 
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; function: SqlFunction =&amp;gt; lookupFunction(replace(function.getName), operands)  
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; postfix: SqlPostfixOperator =&amp;gt; lookupFunction(replace(postfix.getName), operands) 
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; operator@_ =&amp;gt; lookupFunction(replace(s&lt;span class=&quot;code-quote&quot;&gt;&quot;${operator.getKind}&quot;&lt;/span&gt;), operands) 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If we take as an example the following query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;, b, &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; d 
&lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;LOWER&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;%%foo%%&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;LOWER&lt;/span&gt;(b) &lt;span class=&quot;code-keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;%%python%%&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When we hit the above pattern match, we fall to the case matching `SqlFunction`, as `LOWER` is of that type. Inside `lookupFunction`, we have a call to `functionCatalog.lookupFunction(name)` which looks up the given function in the function catalog. Eventually, we reach a static class called `BuiltInFunctionDefinitions`, which defines all of Flink&apos;s built in functions. When we iterate the list of built in functions as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
foundDefinition = BuiltInFunctionDefinitions.getDefinitions()
				.stream()
				.filter(f -&amp;gt; functionName.equals(normalizeName(f.getName())))
				.findFirst()
				.map(Function.identity());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;This doesn&apos;t yield a result, because `LOWER`, inside `BuiltInFunctionDefinitions`, is defined as follows:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; BuiltInFunctionDefinition LOWER =
		&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BuiltInFunctionDefinition.Builder()
			.name(&lt;span class=&quot;code-quote&quot;&gt;&quot;lowerCase&quot;&lt;/span&gt;)
			.kind(SCALAR)
			.outputTypeStrategy(TypeStrategies.MISSING)
			.build();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
And since we&apos;re using String to do the lookups, this fails to match, hence returning `null` and causing the entire pushdown to fail.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13264485">FLINK-14533</key>
            <summary>PushFilterIntoTableSourceScanRule misses predicate pushdowns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Yuval.Itzchakov">Yuval Itzchakov</assignee>
                                    <reporter username="Yuval.Itzchakov">Yuval Itzchakov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 25 Oct 2019 13:37:27 +0000</created>
                <updated>Wed, 19 Feb 2020 13:16:15 +0000</updated>
                            <resolved>Wed, 19 Feb 2020 13:14:17 +0000</resolved>
                                    <version>1.8.1</version>
                    <version>1.8.2</version>
                    <version>1.9.0</version>
                    <version>1.9.1</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17040010" author="jark" created="Wed, 19 Feb 2020 13:14:17 +0000"  >&lt;p&gt;Fixed in master(1.11.0): 296a8af2250022b03c391bab9e8d17c98180aedd&lt;/p&gt;</comment>
                            <comment id="17040012" author="jark" created="Wed, 19 Feb 2020 13:15:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yuval.Itzchakov&quot; class=&quot;user-hover&quot; rel=&quot;Yuval.Itzchakov&quot;&gt;Yuval.Itzchakov&lt;/a&gt;, I didn&apos;t check-pick it back to 1.10 and 1.9, because it may change the plan. The community gives the guarantee that the SQL job state should be reused across minor releases. Hope it makes sense to you. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07yfc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>