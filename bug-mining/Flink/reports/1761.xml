<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6783] Wrongly extracted TypeInformations for WindowedStream::aggregate</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6783</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The following test fails because of wrongly acquired output type for &lt;tt&gt;AggregateFunction&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testAggregateWithWindowFunctionDifferentResultTypes() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
	StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

	DataStream&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; source = env.fromElements(Tuple2.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;, 1), Tuple2.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;, 2));

	DataStream&amp;lt;Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; window = source
		.keyBy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TupleKeySelector())
		.window(TumblingEventTimeWindows.of(Time.of(1, TimeUnit.SECONDS)))
		.aggregate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AggregateFunction&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;() {
			@Override
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; createAccumulator() {
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Tuple2.of(&quot;&quot;, 0);
			}

			@Override
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void add(
				Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; value, Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; accumulator) {

			}

			@Override
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getResult(Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; accumulator) {
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; accumulator.f0;
			}

			@Override
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; merge(
				Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; a, Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; b) {
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Tuple2.of(&quot;&quot;, 0);
			}
		}, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WindowFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, TimeWindow&amp;gt;() {
			@Override
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void apply(
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s,
				TimeWindow window,
				Iterable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; input,
				Collector&amp;lt;Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
				out.collect(Tuple3.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;, &quot;&lt;/span&gt;&quot;, 0));
			}
		});

	OneInputTransformation&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; transform =
		(OneInputTransformation&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt;) window.getTransformation();

	OneInputStreamOperator&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; = transform.getOperator();

	Assert.assertTrue(&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; WindowOperator);
	WindowOperator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, ?, ?, ?&amp;gt; winOperator =
		(WindowOperator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, ?, ?, ?&amp;gt;) &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;;

	Assert.assertTrue(winOperator.getTrigger() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; EventTimeTrigger);
	Assert.assertTrue(winOperator.getWindowAssigner() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; TumblingEventTimeWindows);
	Assert.assertTrue(winOperator.getStateDescriptor() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; AggregatingStateDescriptor);

	processElementAndEnsureOutput(
		&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;, winOperator.getKeySelector(), BasicTypeInfo.STRING_TYPE_INFO, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;, 1));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test results in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.flink.api.common.functions.InvalidTypesException: Input mismatch: Tuple type expected.

	at org.apache.flink.api.java.typeutils.TypeExtractor.validateInputType(TypeExtractor.java:1157)
	at org.apache.flink.api.java.typeutils.TypeExtractor.getUnaryOperatorReturnType(TypeExtractor.java:451)
	at org.apache.flink.streaming.api.datastream.WindowedStream.aggregate(WindowedStream.java:855)
	at org.apache.flink.streaming.runtime.operators.windowing.WindowTranslationTest.testAggregateWithWindowFunctionDifferentResultTypes(WindowTranslationTest.java:702)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:51)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: org.apache.flink.api.common.functions.InvalidTypesException: Tuple type expected.
	at org.apache.flink.api.java.typeutils.TypeExtractor.validateInfo(TypeExtractor.java:1204)
	at org.apache.flink.api.java.typeutils.TypeExtractor.validateInputType(TypeExtractor.java:1154)
	... 25 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tracked down the issue and the reason is wrongly handled &lt;tt&gt;outputTypeArgumentIndex&lt;/tt&gt; in &lt;tt&gt;TypeExtractor::getUnaryOperatorReturnType&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;My proposition is to remove/deprecate version of &lt;tt&gt;TypeExtractor::getUnaryOperatorReturnType&lt;/tt&gt; that accepts &lt;tt&gt;hasIterable&lt;/tt&gt; and &lt;tt&gt;hasCollector&lt;/tt&gt; as parameters and move all invocations to explicitly passing index of output type (after fixing &lt;tt&gt;outputTypeArgumentIndex&lt;/tt&gt; handling in line &lt;tt&gt;TypeExtractor:455&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13076178">FLINK-6783</key>
            <summary>Wrongly extracted TypeInformations for WindowedStream::aggregate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                            <label>flink-rel-1.3.1-blockers</label>
                    </labels>
                <created>Wed, 31 May 2017 12:37:56 +0000</created>
                <updated>Tue, 1 Oct 2019 15:39:16 +0000</updated>
                            <resolved>Thu, 8 Jun 2017 12:09:22 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>1.3.1</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16031096" author="twalthr" created="Wed, 31 May 2017 12:50:21 +0000"  >&lt;p&gt;+1 for this change.&lt;/p&gt;</comment>
                            <comment id="16031111" author="aljoscha" created="Wed, 31 May 2017 13:02:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; I think you could also change the &lt;tt&gt;DummyAggregationFunction&lt;/tt&gt; used in the tests to have different types for &lt;tt&gt;IN&lt;/tt&gt;, &lt;tt&gt;ACC&lt;/tt&gt;, and &lt;tt&gt;OUT&lt;/tt&gt; when fixing this. What do you think?&lt;/p&gt;</comment>
                            <comment id="16031115" author="dawidwys" created="Wed, 31 May 2017 13:04:06 +0000"  >&lt;p&gt;Sure &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;, will do!&lt;/p&gt;</comment>
                            <comment id="16032806" author="githubbot" created="Thu, 1 Jun 2017 11:18:10 +0000"  >&lt;p&gt;GitHub user dawidwys opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6783&quot; title=&quot;Wrongly extracted TypeInformations for WindowedStream::aggregate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6783&quot;&gt;&lt;del&gt;FLINK-6783&lt;/del&gt;&lt;/a&gt; Changed passing index of type argument while extracting &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;return type.&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dawidwys/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dawidwys/flink&lt;/a&gt; flink-6783&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4039&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cb20120ccbaac1ebf3c2f8aafd4d3e82e5fe9fc1&lt;br/&gt;
Author: Dawid Wysakowicz &amp;lt;dawid@getindata.com&amp;gt;&lt;br/&gt;
Date:   2017-06-01T11:17:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6783&quot; title=&quot;Wrongly extracted TypeInformations for WindowedStream::aggregate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6783&quot;&gt;&lt;del&gt;FLINK-6783&lt;/del&gt;&lt;/a&gt; Changed passing index of type argument while extracting return type.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16032809" author="githubbot" created="Thu, 1 Jun 2017 11:20:10 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The PR is not fully ready yet, but as it touches critical part, I would like to hear early opinions from somebody more experienced with the Type system. Would be good to know if I am going the right way &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16034351" author="githubbot" created="Fri, 2 Jun 2017 09:07:29 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I like the idea of explicitly passing the argument parameters a lot! I would even suggest to remove the old methods with `hasCollector` and so on instead of just deprecating.&lt;/p&gt;

&lt;p&gt;    Could you please elaborate a bit how the lambda argument arrays work? &lt;/p&gt;</comment>
                            <comment id="16034362" author="githubbot" created="Fri, 2 Jun 2017 09:20:01 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sure, with the arrays you provide index of the input/output parameters in lambdas. The lambdaInputTypeArgumentIndices&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; is the argument index of lambda function. The lambdaInputTypeArgumentIndices&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is the index within the argument, if the argument is a generic type and so on.&lt;/p&gt;

&lt;p&gt;    So for example if we have a functional interface like:&lt;br/&gt;
    `&lt;br/&gt;
    public interface Dummy&amp;lt;IN, OUT&amp;gt; &lt;/p&gt;
{
    OUT apply(Map&amp;lt;String, List&amp;lt;IN&amp;gt;&amp;gt; value)
    }
&lt;p&gt;    `&lt;br/&gt;
    To extract inputType *&lt;b&gt;IN&lt;/b&gt;* from lambda you need to provide array like `new int[] &lt;/p&gt;
{0,1,0}
&lt;p&gt;`.&lt;/p&gt;
</comment>
                            <comment id="16034459" author="githubbot" created="Fri, 2 Jun 2017 10:27:25 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah, so it performs nested navigation. If I had a type like&lt;br/&gt;
    ```&lt;br/&gt;
    public interface Dummy&amp;lt;IN, OUT&amp;gt; &lt;/p&gt;
{ OUT apply(Map&amp;lt;String, Map&amp;lt;List&amp;lt;IN&amp;gt;, String&amp;gt;&amp;gt; value) }
&lt;p&gt;    ```&lt;br/&gt;
    it would be `new int[] &lt;/p&gt;
{0,1,0,1}
&lt;p&gt;`?&lt;/p&gt;</comment>
                            <comment id="16034462" author="githubbot" created="Fri, 2 Jun 2017 10:29:57 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In fact `new int[] &lt;/p&gt;
{0,1,0,0}
&lt;p&gt;`, but I think you got the point.&lt;/p&gt;</comment>
                            <comment id="16034606" author="githubbot" created="Fri, 2 Jun 2017 12:26:17 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think it is ready for a review.&lt;/p&gt;</comment>
                            <comment id="16034630" author="githubbot" created="Fri, 2 Jun 2017 12:50:37 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks, and yes, I see my mistake now.&lt;/p&gt;

&lt;p&gt;    I&apos;ll review, but could you please also have a look, @twalthr? I think you have more experience with this than I do.&lt;/p&gt;
</comment>
                            <comment id="16034723" author="githubbot" created="Fri, 2 Jun 2017 13:55:21 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r119851342&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r119851342&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -422,37 +521,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     				throw new InvalidTypesException(&quot;Internal error occurred.&quot;, e);&lt;br/&gt;
     			}&lt;br/&gt;
     			if (exec != null) {&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaInputTypeArgumentIndices != null &amp;amp;&amp;amp; lambdaInputTypeArgumentIndices.length &amp;gt;= 1,&lt;br/&gt;
    +					&quot;Indices for input type arguments within lambda not provided&quot;);&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaOutputTypeArgumentIndices != null,&lt;br/&gt;
    +					&quot;Indices for output type arguments within lambda not provided&quot;);&lt;br/&gt;
     				// check for lambda type erasure&lt;br/&gt;
     				validateLambdaGenericParameters(exec);&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int paramLen = exec.getParameterTypes().length - 1;&lt;br/&gt;
    +				final int paramLen = exec.getParameterTypes().length;&lt;br/&gt;
    +&lt;br/&gt;
    +				final Method sam = getSingleAbstractMethod(baseClass);&lt;br/&gt;
    +				final int baseParametersLen = sam.getParameterTypes().length;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What is the difference between `paramLen` and `baseParametersLen`? Is it that the first is the number of generic parameters of the SAM itself and `baseParametersLen` is the number of parameters of the method?&lt;/p&gt;</comment>
                            <comment id="16034771" author="githubbot" created="Fri, 2 Jun 2017 14:18:44 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r119868212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r119868212&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -422,37 +521,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     				throw new InvalidTypesException(&quot;Internal error occurred.&quot;, e);&lt;br/&gt;
     			}&lt;br/&gt;
     			if (exec != null) {&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaInputTypeArgumentIndices != null &amp;amp;&amp;amp; lambdaInputTypeArgumentIndices.length &amp;gt;= 1,&lt;br/&gt;
    +					&quot;Indices for input type arguments within lambda not provided&quot;);&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaOutputTypeArgumentIndices != null,&lt;br/&gt;
    +					&quot;Indices for output type arguments within lambda not provided&quot;);&lt;br/&gt;
     				// check for lambda type erasure&lt;br/&gt;
     				validateLambdaGenericParameters(exec);&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int paramLen = exec.getParameterTypes().length - 1;&lt;br/&gt;
    +				final int paramLen = exec.getParameterTypes().length;&lt;br/&gt;
    +&lt;br/&gt;
    +				final Method sam = getSingleAbstractMethod(baseClass);&lt;br/&gt;
    +				final int baseParametersLen = sam.getParameterTypes().length;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Kind of. baseParametersLen is the number of arguments that the method of interface has. So this is the &quot;array&quot; that the indices point to.&lt;/p&gt;

&lt;p&gt;    paramLen is the number of parameters of the lambda, which can have some additional parameters e.g. from the closure. So we need both of those lengths to index the argument correctly. &lt;/p&gt;</comment>
                            <comment id="16034776" author="githubbot" created="Fri, 2 Jun 2017 14:23:26 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r119869362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r119869362&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -422,37 +521,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     				throw new InvalidTypesException(&quot;Internal error occurred.&quot;, e);&lt;br/&gt;
     			}&lt;br/&gt;
     			if (exec != null) {&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaInputTypeArgumentIndices != null &amp;amp;&amp;amp; lambdaInputTypeArgumentIndices.length &amp;gt;= 1,&lt;br/&gt;
    +					&quot;Indices for input type arguments within lambda not provided&quot;);&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaOutputTypeArgumentIndices != null,&lt;br/&gt;
    +					&quot;Indices for output type arguments within lambda not provided&quot;);&lt;br/&gt;
     				// check for lambda type erasure&lt;br/&gt;
     				validateLambdaGenericParameters(exec);&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int paramLen = exec.getParameterTypes().length - 1;&lt;br/&gt;
    +				final int paramLen = exec.getParameterTypes().length;&lt;br/&gt;
    +&lt;br/&gt;
    +				final Method sam = getSingleAbstractMethod(baseClass);&lt;br/&gt;
    +				final int baseParametersLen = sam.getParameterTypes().length;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I see, thank you!&lt;/p&gt;</comment>
                            <comment id="16034777" author="githubbot" created="Fri, 2 Jun 2017 14:23:47 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Now, let&apos;s wait for @twalthr in case he has any comments.&lt;/p&gt;</comment>
                            <comment id="16039129" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120391605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120391605&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -464,57 +578,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Returns the binary operator&apos;s return type.&lt;/li&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @param function Function to extract the return type from&lt;/li&gt;
	&lt;li&gt;* @param baseClass Base class of the function&lt;/li&gt;
	&lt;li&gt;* @param hasIterables True if the first function parameter is an iterable, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param hasCollector True if the function has an additional collector parameter, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param in1Type Type of the left side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param in2Type Type of the right side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param functionName Function name&lt;/li&gt;
	&lt;li&gt;* @param allowMissing Can the type information be missing&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN1&amp;gt; Left side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN2&amp;gt; Right side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;OUT&amp;gt; Output type&lt;/li&gt;
	&lt;li&gt;* @return TypeInformation of the return type of the function&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;/li&gt;
	&lt;li&gt;@PublicEvolving&lt;/li&gt;
	&lt;li&gt;public static &amp;lt;IN1, IN2, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getBinaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;Function function,&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; baseClass,&lt;/li&gt;
	&lt;li&gt;boolean hasIterables,&lt;/li&gt;
	&lt;li&gt;boolean hasCollector,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN1&amp;gt; in1Type,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN2&amp;gt; in2Type,&lt;/li&gt;
	&lt;li&gt;String functionName,&lt;/li&gt;
	&lt;li&gt;boolean allowMissing) {&lt;br/&gt;
    +	private static Type extractType(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Please give this method a more meaningful name (e.g. extractTypeFromLambda) and a Javadoc. You can also move it to `TypeExtractionUtils`.&lt;/p&gt;</comment>
                            <comment id="16039130" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120387120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120387120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -354,49 +479,21 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns the unary operator&apos;s return type.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param function Function to extract the return type from&lt;/li&gt;
	&lt;li&gt;* @param baseClass Base class of the function&lt;/li&gt;
	&lt;li&gt;* @param hasIterable True if the first function parameter is an iterable, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param hasCollector True if the function has an additional collector parameter, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param inType Type of the input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param functionName Function name&lt;/li&gt;
	&lt;li&gt;* @param allowMissing Can the type information be missing&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN&amp;gt; Input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;OUT&amp;gt; Output type&lt;/li&gt;
	&lt;li&gt;* @return TypeInformation of the return type of the function&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;/li&gt;
	&lt;li&gt;@PublicEvolving&lt;/li&gt;
	&lt;li&gt;public static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;Function function,&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; baseClass,&lt;/li&gt;
	&lt;li&gt;boolean hasIterable,&lt;/li&gt;
	&lt;li&gt;boolean hasCollector,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN&amp;gt; inType,&lt;/li&gt;
	&lt;li&gt;String functionName,&lt;/li&gt;
	&lt;li&gt;boolean allowMissing) 
{
    -
    -		return getUnaryOperatorReturnType(
    -			function,
    -			baseClass,
    -			hasIterable ? 0 : -1,
    -			hasCollector ? 0 : -1,
    -			inType,
    -			functionName,
    -			allowMissing);
    -	}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Returns the unary operator&apos;s return type.&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;&amp;lt;b&amp;gt;NOTE:&amp;lt;/b&amp;gt; lambda type indices allows extraction of Type from lambdas. To extract input type &amp;lt;b&amp;gt;IN&amp;lt;/b&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    allow&lt;/p&gt;</comment>
                            <comment id="16039131" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120389039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120389039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -422,37 +521,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     				throw new InvalidTypesException(&quot;Internal error occurred.&quot;, e);&lt;br/&gt;
     			}&lt;br/&gt;
     			if (exec != null) {&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaInputTypeArgumentIndices != null &amp;amp;&amp;amp; lambdaInputTypeArgumentIndices.length &amp;gt;= 1,&lt;br/&gt;
    +					&quot;Indices for input type arguments within lambda not provided&quot;);&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaOutputTypeArgumentIndices != null,&lt;br/&gt;
    +					&quot;Indices for output type arguments within lambda not provided&quot;);&lt;br/&gt;
     				// check for lambda type erasure&lt;br/&gt;
     				validateLambdaGenericParameters(exec);&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int paramLen = exec.getParameterTypes().length - 1;&lt;br/&gt;
    +				final int paramLen = exec.getParameterTypes().length;&lt;br/&gt;
    +&lt;br/&gt;
    +				final Method sam = getSingleAbstractMethod(baseClass);&lt;br/&gt;
    +				final int baseParametersLen = sam.getParameterTypes().length;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can you add an inline comment to both `paramLen` and `baseParametersLen`?&lt;/p&gt;</comment>
                            <comment id="16039132" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120384026&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120384026&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -216,7 +253,15 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     			boolean allowMissing)&lt;br/&gt;
     	{&lt;br/&gt;
     		return getUnaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function, AggregateFunction.class, 0, 2, inType, functionName, allowMissing);&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AggregateFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think this array is not necessary, because the `AggregateFunction` is not a SAM. Maybe you can change `NO_OUTPUT_INDEX` to `NO_INDEX` and also use it here.&lt;/p&gt;</comment>
                            <comment id="16039133" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120392260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120392260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -464,57 +578,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Returns the binary operator&apos;s return type.&lt;/li&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @param function Function to extract the return type from&lt;/li&gt;
	&lt;li&gt;* @param baseClass Base class of the function&lt;/li&gt;
	&lt;li&gt;* @param hasIterables True if the first function parameter is an iterable, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param hasCollector True if the function has an additional collector parameter, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param in1Type Type of the left side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param in2Type Type of the right side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param functionName Function name&lt;/li&gt;
	&lt;li&gt;* @param allowMissing Can the type information be missing&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN1&amp;gt; Left side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN2&amp;gt; Right side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;OUT&amp;gt; Output type&lt;/li&gt;
	&lt;li&gt;* @return TypeInformation of the return type of the function&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;/li&gt;
	&lt;li&gt;@PublicEvolving&lt;/li&gt;
	&lt;li&gt;public static &amp;lt;IN1, IN2, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getBinaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;Function function,&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; baseClass,&lt;/li&gt;
	&lt;li&gt;boolean hasIterables,&lt;/li&gt;
	&lt;li&gt;boolean hasCollector,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN1&amp;gt; in1Type,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN2&amp;gt; in2Type,&lt;/li&gt;
	&lt;li&gt;String functionName,&lt;/li&gt;
	&lt;li&gt;boolean allowMissing) {&lt;br/&gt;
    +	private static Type extractType(&lt;br/&gt;
    +			LambdaExecutable exec,&lt;br/&gt;
    +			int[] lambdaTypeArgumentIndices,&lt;br/&gt;
    +			int paramLen,&lt;br/&gt;
    +			int baseParametersLen) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		Type output = exec.getParameterTypes()[paramLen - baseParametersLen + lambdaTypeArgumentIndices[0]];    +		for (int i = 1; i &amp;lt; lambdaTypeArgumentIndices.length; i++) {
    +			output = extractTypeArgument(output, lambdaTypeArgumentIndices[i]);
    +		}    +		return output;    +	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return getBinaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;baseClass,&lt;/li&gt;
	&lt;li&gt;hasIterables ? 0 : -1,&lt;/li&gt;
	&lt;li&gt;hasCollector ? 0 : -1,&lt;/li&gt;
	&lt;li&gt;in1Type,&lt;/li&gt;
	&lt;li&gt;in2Type,&lt;/li&gt;
	&lt;li&gt;functionName,&lt;/li&gt;
	&lt;li&gt;allowMissing&lt;/li&gt;
	&lt;li&gt;);&lt;br/&gt;
    +	private static Method getSingleAbstractMethod(Class&amp;lt;?&amp;gt; baseClass) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can you document and move this to TypeExtractionUtils?&lt;/p&gt;</comment>
                            <comment id="16039134" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120389999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120389999&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -336,8 +461,8 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     	public static &amp;lt;T&amp;gt; TypeInformation&amp;lt;T&amp;gt; getPartitionerTypes(Partitioner&amp;lt;T&amp;gt; partitioner, String functionName, boolean allowMissing) {&lt;br/&gt;
     		return new TypeExtractor().privateCreateTypeInfo(Partitioner.class, partitioner.getClass(), 0, null, null);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can you also update the `Partitioner` to support lambdas?&lt;/p&gt;</comment>
                            <comment id="16039135" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120397022&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120397022&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/CoGroupedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -231,14 +231,18 @@ protected WithWindow(DataStream&amp;lt;T1&amp;gt; input1,&lt;br/&gt;
     		public &amp;lt;T&amp;gt; DataStream&amp;lt;T&amp;gt; apply(CoGroupFunction&amp;lt;T1, T2, T&amp;gt; function) {&lt;/p&gt;

&lt;p&gt;     			TypeInformation&amp;lt;T&amp;gt; resultType = TypeExtractor.getBinaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;CoGroupFunction.class,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;input1.getType(),&lt;/li&gt;
	&lt;li&gt;input2.getType(),&lt;/li&gt;
	&lt;li&gt;&quot;CoGroup&quot;,&lt;/li&gt;
	&lt;li&gt;false);&lt;br/&gt;
    +				function,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We could use `TypeExtractor#getCoGroupReturnTypes()` and save some duplicate code, but I&apos;m also fine with this.&lt;/p&gt;</comment>
                            <comment id="16039136" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120397178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120397178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/ConnectedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -203,9 +203,19 @@ public StreamExecutionEnvironment getExecutionEnvironment() {&lt;br/&gt;
     	 */&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; map(CoMapFunction&amp;lt;IN1, IN2, R&amp;gt; coMapper) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(coMapper,&lt;/li&gt;
	&lt;li&gt;CoMapFunction.class, false, true, getType1(), getType2(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(), true);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(&lt;br/&gt;
    +			coMapper,&lt;br/&gt;
    +			CoMapFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No lambda.&lt;/p&gt;</comment>
                            <comment id="16039138" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120396063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120396063&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/AllWindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -507,12 +505,41 @@ public AllWindowedStream(DataStream&amp;lt;T&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, AllWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getAllWindowFunctionReturnType(windowFunction, aggResultType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getAllWindowFunctionReturnType(&lt;br/&gt;
    +			AllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{1, 0},&lt;br/&gt;
    +			new int[]{2, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessAllWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessAllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessAllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{1, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `ProcessAllWindowFunction` is not a SAM. We do not need this parameters. &lt;/p&gt;</comment>
                            <comment id="16039137" author="githubbot" created="Tue, 6 Jun 2017 15:55:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120398290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120398290&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/JoinedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -221,14 +221,18 @@ protected WithWindow(DataStream&amp;lt;T1&amp;gt; input1,&lt;br/&gt;
     		 */&lt;br/&gt;
     		public &amp;lt;T&amp;gt; DataStream&amp;lt;T&amp;gt; apply(JoinFunction&amp;lt;T1, T2, T&amp;gt; function) {&lt;br/&gt;
     			TypeInformation&amp;lt;T&amp;gt; resultType = TypeExtractor.getBinaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;JoinFunction.class,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;input1.getType(),&lt;/li&gt;
	&lt;li&gt;input2.getType(),&lt;/li&gt;
	&lt;li&gt;&quot;Join&quot;,&lt;/li&gt;
	&lt;li&gt;false);&lt;br/&gt;
    +				function,&lt;br/&gt;
    +				JoinFunction.class,&lt;br/&gt;
    +				0,&lt;br/&gt;
    +				1,&lt;br/&gt;
    +				2,&lt;br/&gt;
    +				new int[]
{0, 0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Wrong lambda arguments. Should be `(0), (0), ()`.&lt;/p&gt;</comment>
                            <comment id="16039139" author="githubbot" created="Tue, 6 Jun 2017 15:55:41 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120397513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120397513&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/ConnectedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -254,9 +274,19 @@ public StreamExecutionEnvironment getExecutionEnvironment() {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; process(&lt;br/&gt;
     			CoProcessFunction&amp;lt;IN1, IN2, R&amp;gt; coProcessFunction) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(coProcessFunction,&lt;/li&gt;
	&lt;li&gt;CoProcessFunction.class, false, true, getType1(), getType2(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(), true);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(&lt;br/&gt;
    +			coProcessFunction,&lt;br/&gt;
    +			CoProcessFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No lambda.&lt;/p&gt;</comment>
                            <comment id="16039140" author="githubbot" created="Tue, 6 Jun 2017 15:55:41 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120397600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120397600&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/DataStream.java &amp;#8212;&lt;br/&gt;
    @@ -574,13 +574,15 @@ public ExecutionConfig getExecutionConfig() {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; process(ProcessFunction&amp;lt;T, R&amp;gt; processFunction) {&lt;/p&gt;

&lt;p&gt;     		TypeInformation&amp;lt;R&amp;gt; outType = TypeExtractor.getUnaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processFunction,&lt;/li&gt;
	&lt;li&gt;ProcessFunction.class,&lt;/li&gt;
	&lt;li&gt;false,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;getType(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(),&lt;/li&gt;
	&lt;li&gt;true);&lt;br/&gt;
    +			processFunction,&lt;br/&gt;
    +			ProcessFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No lambda.&lt;/p&gt;</comment>
                            <comment id="16039141" author="githubbot" created="Tue, 6 Jun 2017 15:55:41 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120399201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120399201&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/WindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -981,12 +976,42 @@ public WindowedStream(KeyedStream&amp;lt;T, K&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, ProcessWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getProcessWindowFunctionReturnType(windowFunction, aggResultType, null);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT, KEY&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getWindowFunctionReturnType(&lt;br/&gt;
    +		WindowFunction&amp;lt;IN, OUT, KEY, ?&amp;gt; function,&lt;br/&gt;
    +		TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			WindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{2, 0},&lt;br/&gt;
    +			new int[]{3, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT, KEY&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessWindowFunction&amp;lt;IN, OUT, KEY, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType,&lt;br/&gt;
    +			String functionName) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{2, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    No lambda.&lt;/p&gt;</comment>
                            <comment id="16039142" author="githubbot" created="Tue, 6 Jun 2017 15:55:42 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120398789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120398789&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/KeyedStream.java &amp;#8212;&lt;br/&gt;
    @@ -267,13 +267,15 @@ private boolean validateKeyTypeIsHashable(TypeInformation&amp;lt;?&amp;gt; type) {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; process(ProcessFunction&amp;lt;T, R&amp;gt; processFunction) {&lt;/p&gt;

&lt;p&gt;     		TypeInformation&amp;lt;R&amp;gt; outType = TypeExtractor.getUnaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processFunction,&lt;/li&gt;
	&lt;li&gt;ProcessFunction.class,&lt;/li&gt;
	&lt;li&gt;false,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;getType(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(),&lt;/li&gt;
	&lt;li&gt;true);&lt;br/&gt;
    +			processFunction,&lt;br/&gt;
    +			ProcessFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No lambda.&lt;/p&gt;</comment>
                            <comment id="16039143" author="githubbot" created="Tue, 6 Jun 2017 15:55:42 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120397389&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120397389&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/ConnectedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -227,9 +237,19 @@ public StreamExecutionEnvironment getExecutionEnvironment() {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; flatMap(&lt;br/&gt;
     			CoFlatMapFunction&amp;lt;IN1, IN2, R&amp;gt; coFlatMapper) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(coFlatMapper,&lt;/li&gt;
	&lt;li&gt;CoFlatMapFunction.class, false, true, getType1(), getType2(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(), true);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(&lt;br/&gt;
    +			coFlatMapper,&lt;br/&gt;
    +			CoFlatMapFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No lambda.&lt;/p&gt;</comment>
                            <comment id="16039144" author="githubbot" created="Tue, 6 Jun 2017 15:55:43 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120398682&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120398682&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/JoinedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -300,14 +304,18 @@ protected WithWindow(DataStream&amp;lt;T1&amp;gt; input1,&lt;br/&gt;
     		 */&lt;br/&gt;
     		public &amp;lt;T&amp;gt; DataStream&amp;lt;T&amp;gt; apply(FlatJoinFunction&amp;lt;T1, T2, T&amp;gt; function) {&lt;br/&gt;
     			TypeInformation&amp;lt;T&amp;gt; resultType = TypeExtractor.getBinaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;FlatJoinFunction.class,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;input1.getType(),&lt;/li&gt;
	&lt;li&gt;input2.getType(),&lt;/li&gt;
	&lt;li&gt;&quot;Join&quot;,&lt;/li&gt;
	&lt;li&gt;false);&lt;br/&gt;
    +				function,&lt;br/&gt;
    +				FlatJoinFunction.class,&lt;br/&gt;
    +				0,&lt;br/&gt;
    +				1,&lt;br/&gt;
    +				2,&lt;br/&gt;
    +				new int[]
{0, 0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Wrong lambda arguments. Should be `(0), (1), (2, 0)`&lt;/p&gt;</comment>
                            <comment id="16039212" author="githubbot" created="Tue, 6 Jun 2017 16:34:12 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120412137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120412137&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/AllWindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -507,12 +505,41 @@ public AllWindowedStream(DataStream&amp;lt;T&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, AllWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getAllWindowFunctionReturnType(windowFunction, aggResultType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getAllWindowFunctionReturnType(&lt;br/&gt;
    +			AllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{1, 0},&lt;br/&gt;
    +			new int[]{2, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessAllWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessAllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessAllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{1, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think `ProcessAllWindowFunction` is a `FunctionalInterface`. The only abstract method `process`. All other methods have default implementation, so you can pass lambda as `ProcessAllWindowFunction`.&lt;/p&gt;</comment>
                            <comment id="16040609" author="githubbot" created="Wed, 7 Jun 2017 09:46:11 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys What&apos;s your schedule to address the comments?&lt;br/&gt;
    This is one of the real blockers for the 1.3.1 release, and I would like to put the first RC this week.&lt;/p&gt;</comment>
                            <comment id="16040611" author="githubbot" created="Wed, 7 Jun 2017 09:48:19 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I will address them today. I am working on last comment with enabling the changes also for Partitioner.&lt;/p&gt;</comment>
                            <comment id="16040620" author="githubbot" created="Wed, 7 Jun 2017 09:55:18 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Cool, thank you!&lt;/p&gt;</comment>
                            <comment id="16040928" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120555761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120555761&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/ConnectedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -203,9 +203,19 @@ public StreamExecutionEnvironment getExecutionEnvironment() {&lt;br/&gt;
     	 */&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; map(CoMapFunction&amp;lt;IN1, IN2, R&amp;gt; coMapper) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(coMapper,&lt;/li&gt;
	&lt;li&gt;CoMapFunction.class, false, true, getType1(), getType2(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(), true);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(&lt;br/&gt;
    +			coMapper,&lt;br/&gt;
    +			CoMapFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040929" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120555725&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120555725&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/CoGroupedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -231,14 +231,18 @@ protected WithWindow(DataStream&amp;lt;T1&amp;gt; input1,&lt;br/&gt;
     		public &amp;lt;T&amp;gt; DataStream&amp;lt;T&amp;gt; apply(CoGroupFunction&amp;lt;T1, T2, T&amp;gt; function) {&lt;/p&gt;

&lt;p&gt;     			TypeInformation&amp;lt;T&amp;gt; resultType = TypeExtractor.getBinaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;CoGroupFunction.class,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;input1.getType(),&lt;/li&gt;
	&lt;li&gt;input2.getType(),&lt;/li&gt;
	&lt;li&gt;&quot;CoGroup&quot;,&lt;/li&gt;
	&lt;li&gt;false);&lt;br/&gt;
    +				function,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    DONE&lt;/p&gt;</comment>
                            <comment id="16040930" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120555882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120555882&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/ConnectedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -254,9 +274,19 @@ public StreamExecutionEnvironment getExecutionEnvironment() {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; process(&lt;br/&gt;
     			CoProcessFunction&amp;lt;IN1, IN2, R&amp;gt; coProcessFunction) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(coProcessFunction,&lt;/li&gt;
	&lt;li&gt;CoProcessFunction.class, false, true, getType1(), getType2(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(), true);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(&lt;br/&gt;
    +			coProcessFunction,&lt;br/&gt;
    +			CoProcessFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040931" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120556140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120556140&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/JoinedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -221,14 +221,18 @@ protected WithWindow(DataStream&amp;lt;T1&amp;gt; input1,&lt;br/&gt;
     		 */&lt;br/&gt;
     		public &amp;lt;T&amp;gt; DataStream&amp;lt;T&amp;gt; apply(JoinFunction&amp;lt;T1, T2, T&amp;gt; function) {&lt;br/&gt;
     			TypeInformation&amp;lt;T&amp;gt; resultType = TypeExtractor.getBinaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;JoinFunction.class,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;input1.getType(),&lt;/li&gt;
	&lt;li&gt;input2.getType(),&lt;/li&gt;
	&lt;li&gt;&quot;Join&quot;,&lt;/li&gt;
	&lt;li&gt;false);&lt;br/&gt;
    +				function,&lt;br/&gt;
    +				JoinFunction.class,&lt;br/&gt;
    +				0,&lt;br/&gt;
    +				1,&lt;br/&gt;
    +				2,&lt;br/&gt;
    +				new int[]
{0, 0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040933" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120555933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120555933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/DataStream.java &amp;#8212;&lt;br/&gt;
    @@ -574,13 +574,15 @@ public ExecutionConfig getExecutionConfig() {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; process(ProcessFunction&amp;lt;T, R&amp;gt; processFunction) {&lt;/p&gt;

&lt;p&gt;     		TypeInformation&amp;lt;R&amp;gt; outType = TypeExtractor.getUnaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processFunction,&lt;/li&gt;
	&lt;li&gt;ProcessFunction.class,&lt;/li&gt;
	&lt;li&gt;false,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;getType(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(),&lt;/li&gt;
	&lt;li&gt;true);&lt;br/&gt;
    +			processFunction,&lt;br/&gt;
    +			ProcessFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think it is lambda&lt;/p&gt;</comment>
                            <comment id="16040932" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120556233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120556233&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/JoinedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -300,14 +304,18 @@ protected WithWindow(DataStream&amp;lt;T1&amp;gt; input1,&lt;br/&gt;
     		 */&lt;br/&gt;
     		public &amp;lt;T&amp;gt; DataStream&amp;lt;T&amp;gt; apply(FlatJoinFunction&amp;lt;T1, T2, T&amp;gt; function) {&lt;br/&gt;
     			TypeInformation&amp;lt;T&amp;gt; resultType = TypeExtractor.getBinaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;FlatJoinFunction.class,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;input1.getType(),&lt;/li&gt;
	&lt;li&gt;input2.getType(),&lt;/li&gt;
	&lt;li&gt;&quot;Join&quot;,&lt;/li&gt;
	&lt;li&gt;false);&lt;br/&gt;
    +				function,&lt;br/&gt;
    +				FlatJoinFunction.class,&lt;br/&gt;
    +				0,&lt;br/&gt;
    +				1,&lt;br/&gt;
    +				2,&lt;br/&gt;
    +				new int[]
{0, 0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040934" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120555777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120555777&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/ConnectedStreams.java &amp;#8212;&lt;br/&gt;
    @@ -227,9 +237,19 @@ public StreamExecutionEnvironment getExecutionEnvironment() {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; flatMap(&lt;br/&gt;
     			CoFlatMapFunction&amp;lt;IN1, IN2, R&amp;gt; coFlatMapper) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(coFlatMapper,&lt;/li&gt;
	&lt;li&gt;CoFlatMapFunction.class, false, true, getType1(), getType2(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(), true);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; outTypeInfo = TypeExtractor.getBinaryOperatorReturnType(&lt;br/&gt;
    +			coFlatMapper,&lt;br/&gt;
    +			CoFlatMapFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040935" author="githubbot" created="Wed, 7 Jun 2017 14:06:22 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120556277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120556277&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/KeyedStream.java &amp;#8212;&lt;br/&gt;
    @@ -267,13 +267,15 @@ private boolean validateKeyTypeIsHashable(TypeInformation&amp;lt;?&amp;gt; type) {&lt;br/&gt;
     	public &amp;lt;R&amp;gt; SingleOutputStreamOperator&amp;lt;R&amp;gt; process(ProcessFunction&amp;lt;T, R&amp;gt; processFunction) {&lt;/p&gt;

&lt;p&gt;     		TypeInformation&amp;lt;R&amp;gt; outType = TypeExtractor.getUnaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processFunction,&lt;/li&gt;
	&lt;li&gt;ProcessFunction.class,&lt;/li&gt;
	&lt;li&gt;false,&lt;/li&gt;
	&lt;li&gt;true,&lt;/li&gt;
	&lt;li&gt;getType(),&lt;/li&gt;
	&lt;li&gt;Utils.getCallLocationName(),&lt;/li&gt;
	&lt;li&gt;true);&lt;br/&gt;
    +			processFunction,&lt;br/&gt;
    +			ProcessFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think it is lambda&lt;/p&gt;</comment>
                            <comment id="16040936" author="githubbot" created="Wed, 7 Jun 2017 14:06:23 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120558383&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120558383&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -464,57 +578,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Returns the binary operator&apos;s return type.&lt;/li&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @param function Function to extract the return type from&lt;/li&gt;
	&lt;li&gt;* @param baseClass Base class of the function&lt;/li&gt;
	&lt;li&gt;* @param hasIterables True if the first function parameter is an iterable, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param hasCollector True if the function has an additional collector parameter, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param in1Type Type of the left side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param in2Type Type of the right side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param functionName Function name&lt;/li&gt;
	&lt;li&gt;* @param allowMissing Can the type information be missing&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN1&amp;gt; Left side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN2&amp;gt; Right side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;OUT&amp;gt; Output type&lt;/li&gt;
	&lt;li&gt;* @return TypeInformation of the return type of the function&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;/li&gt;
	&lt;li&gt;@PublicEvolving&lt;/li&gt;
	&lt;li&gt;public static &amp;lt;IN1, IN2, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getBinaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;Function function,&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; baseClass,&lt;/li&gt;
	&lt;li&gt;boolean hasIterables,&lt;/li&gt;
	&lt;li&gt;boolean hasCollector,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN1&amp;gt; in1Type,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN2&amp;gt; in2Type,&lt;/li&gt;
	&lt;li&gt;String functionName,&lt;/li&gt;
	&lt;li&gt;boolean allowMissing) {&lt;br/&gt;
    +	private static Type extractType(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040937" author="githubbot" created="Wed, 7 Jun 2017 14:06:23 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120556450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120556450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/WindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -981,12 +976,42 @@ public WindowedStream(KeyedStream&amp;lt;T, K&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, ProcessWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getProcessWindowFunctionReturnType(windowFunction, aggResultType, null);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT, KEY&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getWindowFunctionReturnType(&lt;br/&gt;
    +		WindowFunction&amp;lt;IN, OUT, KEY, ?&amp;gt; function,&lt;br/&gt;
    +		TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			WindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{2, 0},&lt;br/&gt;
    +			new int[]{3, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT, KEY&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessWindowFunction&amp;lt;IN, OUT, KEY, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType,&lt;br/&gt;
    +			String functionName) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{2, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think it is lambda&lt;/p&gt;</comment>
                            <comment id="16040938" author="githubbot" created="Wed, 7 Jun 2017 14:06:23 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120556550&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120556550&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -216,7 +253,15 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     			boolean allowMissing)&lt;br/&gt;
     	{&lt;br/&gt;
     		return getUnaryOperatorReturnType(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;function, AggregateFunction.class, 0, 2, inType, functionName, allowMissing);&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AggregateFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			2,&lt;br/&gt;
    +			new int[]
{0}
&lt;p&gt;,&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040939" author="githubbot" created="Wed, 7 Jun 2017 14:06:24 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120558346&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120558346&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -422,37 +521,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     				throw new InvalidTypesException(&quot;Internal error occurred.&quot;, e);&lt;br/&gt;
     			}&lt;br/&gt;
     			if (exec != null) {&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaInputTypeArgumentIndices != null &amp;amp;&amp;amp; lambdaInputTypeArgumentIndices.length &amp;gt;= 1,&lt;br/&gt;
    +					&quot;Indices for input type arguments within lambda not provided&quot;);&lt;br/&gt;
    +				Preconditions.checkArgument(&lt;br/&gt;
    +					lambdaOutputTypeArgumentIndices != null,&lt;br/&gt;
    +					&quot;Indices for output type arguments within lambda not provided&quot;);&lt;br/&gt;
     				// check for lambda type erasure&lt;br/&gt;
     				validateLambdaGenericParameters(exec);&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int paramLen = exec.getParameterTypes().length - 1;&lt;br/&gt;
    +				final int paramLen = exec.getParameterTypes().length;&lt;br/&gt;
    +&lt;br/&gt;
    +				final Method sam = getSingleAbstractMethod(baseClass);&lt;br/&gt;
    +				final int baseParametersLen = sam.getParameterTypes().length;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040940" author="githubbot" created="Wed, 7 Jun 2017 14:06:24 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120558300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120558300&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -354,49 +479,21 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns the unary operator&apos;s return type.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param function Function to extract the return type from&lt;/li&gt;
	&lt;li&gt;* @param baseClass Base class of the function&lt;/li&gt;
	&lt;li&gt;* @param hasIterable True if the first function parameter is an iterable, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param hasCollector True if the function has an additional collector parameter, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param inType Type of the input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param functionName Function name&lt;/li&gt;
	&lt;li&gt;* @param allowMissing Can the type information be missing&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN&amp;gt; Input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;OUT&amp;gt; Output type&lt;/li&gt;
	&lt;li&gt;* @return TypeInformation of the return type of the function&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;/li&gt;
	&lt;li&gt;@PublicEvolving&lt;/li&gt;
	&lt;li&gt;public static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;Function function,&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; baseClass,&lt;/li&gt;
	&lt;li&gt;boolean hasIterable,&lt;/li&gt;
	&lt;li&gt;boolean hasCollector,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN&amp;gt; inType,&lt;/li&gt;
	&lt;li&gt;String functionName,&lt;/li&gt;
	&lt;li&gt;boolean allowMissing) 
{
    -
    -		return getUnaryOperatorReturnType(
    -			function,
    -			baseClass,
    -			hasIterable ? 0 : -1,
    -			hasCollector ? 0 : -1,
    -			inType,
    -			functionName,
    -			allowMissing);
    -	}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Returns the unary operator&apos;s return type.&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;&amp;lt;b&amp;gt;NOTE:&amp;lt;/b&amp;gt; lambda type indices allows extraction of Type from lambdas. To extract input type &amp;lt;b&amp;gt;IN&amp;lt;/b&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16040941" author="githubbot" created="Wed, 7 Jun 2017 14:06:24 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120558405&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120558405&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -464,57 +578,52 @@ private static void registerFactory(Type t, Class&amp;lt;? extends TypeInfoFactory&amp;gt; fac&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Returns the binary operator&apos;s return type.&lt;/li&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @param function Function to extract the return type from&lt;/li&gt;
	&lt;li&gt;* @param baseClass Base class of the function&lt;/li&gt;
	&lt;li&gt;* @param hasIterables True if the first function parameter is an iterable, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param hasCollector True if the function has an additional collector parameter, otherwise false&lt;/li&gt;
	&lt;li&gt;* @param in1Type Type of the left side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param in2Type Type of the right side input elements (In case of an iterable, it is the element type)&lt;/li&gt;
	&lt;li&gt;* @param functionName Function name&lt;/li&gt;
	&lt;li&gt;* @param allowMissing Can the type information be missing&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN1&amp;gt; Left side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;IN2&amp;gt; Right side input type&lt;/li&gt;
	&lt;li&gt;* @param &amp;lt;OUT&amp;gt; Output type&lt;/li&gt;
	&lt;li&gt;* @return TypeInformation of the return type of the function&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;@SuppressWarnings(&quot;unchecked&quot;)&lt;/li&gt;
	&lt;li&gt;@PublicEvolving&lt;/li&gt;
	&lt;li&gt;public static &amp;lt;IN1, IN2, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getBinaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;Function function,&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; baseClass,&lt;/li&gt;
	&lt;li&gt;boolean hasIterables,&lt;/li&gt;
	&lt;li&gt;boolean hasCollector,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN1&amp;gt; in1Type,&lt;/li&gt;
	&lt;li&gt;TypeInformation&amp;lt;IN2&amp;gt; in2Type,&lt;/li&gt;
	&lt;li&gt;String functionName,&lt;/li&gt;
	&lt;li&gt;boolean allowMissing) {&lt;br/&gt;
    +	private static Type extractType(&lt;br/&gt;
    +			LambdaExecutable exec,&lt;br/&gt;
    +			int[] lambdaTypeArgumentIndices,&lt;br/&gt;
    +			int paramLen,&lt;br/&gt;
    +			int baseParametersLen) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		Type output = exec.getParameterTypes()[paramLen - baseParametersLen + lambdaTypeArgumentIndices[0]];    +		for (int i = 1; i &amp;lt; lambdaTypeArgumentIndices.length; i++) {
    +			output = extractTypeArgument(output, lambdaTypeArgumentIndices[i]);
    +		}    +		return output;    +	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return getBinaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;function,&lt;/li&gt;
	&lt;li&gt;baseClass,&lt;/li&gt;
	&lt;li&gt;hasIterables ? 0 : -1,&lt;/li&gt;
	&lt;li&gt;hasCollector ? 0 : -1,&lt;/li&gt;
	&lt;li&gt;in1Type,&lt;/li&gt;
	&lt;li&gt;in2Type,&lt;/li&gt;
	&lt;li&gt;functionName,&lt;/li&gt;
	&lt;li&gt;allowMissing&lt;/li&gt;
	&lt;li&gt;);&lt;br/&gt;
    +	private static Method getSingleAbstractMethod(Class&amp;lt;?&amp;gt; baseClass) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16042469" author="githubbot" created="Thu, 8 Jun 2017 09:44:41 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys I merged to master, now I rebased on `release-1.3` and running tests before merging there as well.&lt;/p&gt;

&lt;p&gt;    Thanks for fixing this so quickly! &#128076; &lt;/p&gt;</comment>
                            <comment id="16042555" author="githubbot" created="Thu, 8 Jun 2017 11:08:40 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120860095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120860095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/AllWindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -507,12 +505,41 @@ public AllWindowedStream(DataStream&amp;lt;T&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, AllWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getAllWindowFunctionReturnType(windowFunction, aggResultType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getAllWindowFunctionReturnType(&lt;br/&gt;
    +			AllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{1, 0},&lt;br/&gt;
    +			new int[]{2, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessAllWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessAllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessAllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{1, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    @dawidwys correct me if I&apos;m wrong but as far as I know, a `FunctionalInterface` must be an interface. All `ProcessXXX` functions are regular classes with one abstract methods, but this does not qualify them for lambdas. See also &lt;a href=&quot;https://stackoverflow.com/questions/24610207/abstract-class-as-functional-interface&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/24610207/abstract-class-as-functional-interface&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16042563" author="githubbot" created="Thu, 8 Jun 2017 11:21:19 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120862262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120862262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/AllWindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -507,12 +505,41 @@ public AllWindowedStream(DataStream&amp;lt;T&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, AllWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getAllWindowFunctionReturnType(windowFunction, aggResultType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getAllWindowFunctionReturnType(&lt;br/&gt;
    +			AllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{1, 0},&lt;br/&gt;
    +			new int[]{2, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessAllWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessAllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessAllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{1, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You are right! I was not aware of that. Sorry for that. Shall I change it then to `NO_INDEX`?&lt;/p&gt;</comment>
                            <comment id="16042603" author="aljoscha" created="Thu, 8 Jun 2017 12:09:22 +0000"  >&lt;p&gt;Fixed on release-1.3 in&lt;br/&gt;
b2d6dc1d4914f29f6ed1120daff645b3c8073716&lt;/p&gt;

&lt;p&gt;Fixed on master in&lt;br/&gt;
bcaf816dc5313c6c7de1e3436cc87036fd2ea3d0&lt;/p&gt;</comment>
                            <comment id="16042604" author="githubbot" created="Thu, 8 Jun 2017 12:09:44 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys Could you please close this PR?&lt;/p&gt;</comment>
                            <comment id="16042628" author="githubbot" created="Thu, 8 Jun 2017 12:33:43 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120875203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120875203&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/AllWindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -507,12 +505,41 @@ public AllWindowedStream(DataStream&amp;lt;T&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, AllWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getAllWindowFunctionReturnType(windowFunction, aggResultType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getAllWindowFunctionReturnType(&lt;br/&gt;
    +			AllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{1, 0},&lt;br/&gt;
    +			new int[]{2, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessAllWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessAllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessAllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{1, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Ha, it seems I might have merged to fast. What will happen if we leave it as is? Shouldn&apos;t the analysis simply fail? We should probably just push a hot fix for this.&lt;/p&gt;

&lt;p&gt;    Sorry for the inconvenience. &lt;/p&gt;</comment>
                            <comment id="16042665" author="githubbot" created="Thu, 8 Jun 2017 13:08:04 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r120882223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r120882223&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/datastream/AllWindowedStream.java &amp;#8212;&lt;br/&gt;
    @@ -507,12 +505,41 @@ public AllWindowedStream(DataStream&amp;lt;T&amp;gt; input,&lt;br/&gt;
     		TypeInformation&amp;lt;V&amp;gt; aggResultType = TypeExtractor.getAggregateFunctionReturnType(&lt;br/&gt;
     				aggFunction, input.getType(), null, false);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeInformation&amp;lt;R&amp;gt; resultType = TypeExtractor.getUnaryOperatorReturnType(&lt;/li&gt;
	&lt;li&gt;windowFunction, AllWindowFunction.class, true, true, aggResultType, null, false);&lt;br/&gt;
    +		TypeInformation&amp;lt;R&amp;gt; resultType = getAllWindowFunctionReturnType(windowFunction, aggResultType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return aggregate(aggFunction, windowFunction, accumulatorType, aggResultType, resultType);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getAllWindowFunctionReturnType(&lt;br/&gt;
    +			AllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			AllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]&lt;/p&gt;
{1, 0},&lt;br/&gt;
    +			new int[]{2, 0},&lt;br/&gt;
    +			inType,&lt;br/&gt;
    +			null,&lt;br/&gt;
    +			false);&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static &amp;lt;IN, OUT&amp;gt; TypeInformation&amp;lt;OUT&amp;gt; getProcessAllWindowFunctionReturnType(&lt;br/&gt;
    +			ProcessAllWindowFunction&amp;lt;IN, OUT, ?&amp;gt; function,&lt;br/&gt;
    +			TypeInformation&amp;lt;IN&amp;gt; inType) {&lt;br/&gt;
    +		return TypeExtractor.getUnaryOperatorReturnType(&lt;br/&gt;
    +			function,&lt;br/&gt;
    +			ProcessAllWindowFunction.class,&lt;br/&gt;
    +			0,&lt;br/&gt;
    +			1,&lt;br/&gt;
    +			new int[]{1, 0}
&lt;p&gt;,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes, it is not a serious problem. But we should change it to be consistent. @dawidwys Can you create a hot fix for it?&lt;/p&gt;</comment>
                            <comment id="16042675" author="githubbot" created="Thu, 8 Jun 2017 13:14:44 +0000"  >&lt;p&gt;GitHub user dawidwys opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4089&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6783&quot; title=&quot;Wrongly extracted TypeInformations for WindowedStream::aggregate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6783&quot;&gt;&lt;del&gt;FLINK-6783&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Removed lamba indices for abstract classes&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dawidwys/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dawidwys/flink&lt;/a&gt; lambda-type-hotfix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4089.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4089.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4089&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ed19187f2c918dd283b7e0cea263efb175d73742&lt;br/&gt;
Author: Dawid Wysakowicz &amp;lt;dawid@getindata.com&amp;gt;&lt;br/&gt;
Date:   2017-06-08T13:13:58Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6783&quot; title=&quot;Wrongly extracted TypeInformations for WindowedStream::aggregate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6783&quot;&gt;&lt;del&gt;FLINK-6783&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Removed lamba indices for abstract classes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16042677" author="githubbot" created="Thu, 8 Jun 2017 13:16:16 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I created a hotfix for the discussed issue: #4089 . I will close this PR then.&lt;/p&gt;</comment>
                            <comment id="16042678" author="githubbot" created="Thu, 8 Jun 2017 13:16:17 +0000"  >&lt;p&gt;Github user dawidwys closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16042691" author="githubbot" created="Thu, 8 Jun 2017 13:30:53 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4089&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    A hotfix is for when no FLINK ticket has been created, and typically no PR. This commit header should be something like `&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6783&quot; title=&quot;Wrongly extracted TypeInformations for WindowedStream::aggregate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6783&quot;&gt;&lt;del&gt;FLINK-6783&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt;`.&lt;/p&gt;</comment>
                            <comment id="16052793" author="githubbot" created="Sat, 17 Jun 2017 10:34:13 +0000"  >&lt;p&gt;Github user dawidwys closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4089&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16052877" author="githubbot" created="Sat, 17 Jun 2017 15:29:58 +0000"  >&lt;p&gt;Github user tedyu commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r122570865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r122570865&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractionUtils.java &amp;#8212;&lt;br/&gt;
    @@ -161,6 +164,77 @@ public static LambdaExecutable checkAndExtractLambda(Function function) throws T&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Extracts type from given index from lambda. It supports nested types.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param exec lambda function to extract the type from&lt;br/&gt;
    +	 * @param lambdaTypeArgumentIndices position of type to extract in type hierarchy&lt;br/&gt;
    +	 * @param paramLen count of total parameters of the lambda (including closure parameters)&lt;br/&gt;
    +	 * @param baseParametersLen count of lambda interface parameters (without closure parameters)&lt;br/&gt;
    +	 * @return extracted type&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static Type extractTypeFromLambda(&lt;br/&gt;
    +		LambdaExecutable exec,&lt;br/&gt;
    +		int[] lambdaTypeArgumentIndices,&lt;br/&gt;
    +		int paramLen,&lt;br/&gt;
    +		int baseParametersLen) {&lt;br/&gt;
    +		Type output = exec.getParameterTypes()[paramLen - baseParametersLen + lambdaTypeArgumentIndices&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;];&lt;br/&gt;
    +		for (int i = 1; i &amp;lt; lambdaTypeArgumentIndices.length; i++) &lt;/p&gt;
{
    +			output = extractTypeArgument(output, lambdaTypeArgumentIndices[i]);
    +		}
&lt;p&gt;    +		return output;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * * This method extracts the n-th type argument from the given type. An InvalidTypesException&lt;br/&gt;
    +	 * is thrown if the type does not have any type arguments or if the index exceeds the number&lt;br/&gt;
    +	 * of type arguments.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param t Type to extract the type arguments from&lt;br/&gt;
    +	 * @param index Index of the type argument to extract&lt;br/&gt;
    +	 * @return The extracted type argument&lt;br/&gt;
    +	 * @throws InvalidTypesException if the given type does not have any type arguments or if the&lt;br/&gt;
    +	 * index exceeds the number of type arguments.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static Type extractTypeArgument(Type t, int index) throws InvalidTypesException {&lt;br/&gt;
    +		if (t instanceof ParameterizedType) {&lt;br/&gt;
    +			Type[] actualTypeArguments = ((ParameterizedType) t).getActualTypeArguments();&lt;br/&gt;
    +&lt;br/&gt;
    +			if (index &amp;lt; 0 || index &amp;gt;= actualTypeArguments.length) &lt;/p&gt;
{
    +				throw new InvalidTypesException(&quot;Cannot extract the type argument with index &quot; +
    +												index + &quot; because the type has only &quot; + actualTypeArguments.length +
    +												&quot; type arguments.&quot;);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				return actualTypeArguments[index];
    +			}
&lt;p&gt;    +		} else &lt;/p&gt;
{
    +			throw new InvalidTypesException(&quot;The given type &quot; + t + &quot; is not a parameterized type.&quot;);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Extracts a Single Abstract Method (SAM) as defined in Java Specification (4.3.2. The Class Object,&lt;br/&gt;
    +	 * 9.8 Functional Interfaces, 9.4.3 Interface Method Body) from given class.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param baseClass&lt;br/&gt;
    +	 * @throws InvalidTypesException if the given class does not implement&lt;br/&gt;
    +	 * @return&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static Method getSingleAbstractMethod(Class&amp;lt;?&amp;gt; baseClass) {&lt;br/&gt;
    +		Method sam = null;&lt;br/&gt;
    +		for (Method method : baseClass.getMethods()) {&lt;br/&gt;
    +			if (Modifier.isAbstract(method.getModifiers())) {&lt;br/&gt;
    +				if (sam == null) &lt;/p&gt;
{
    +					sam = method;
    +				}
&lt;p&gt; else {&lt;br/&gt;
    +					throw new InvalidTypesException(&lt;br/&gt;
    +						&quot;Given class: &quot; + baseClass + &quot; is not a FunctionalInterface. It does not have a SAM.&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This message seems to be inexact: if there is no SAM, sam would be null upon returning from the method.&lt;br/&gt;
    I suggest changing the message and adding a check (for null sam) prior to returning.&lt;/p&gt;</comment>
                            <comment id="16053680" author="githubbot" created="Mon, 19 Jun 2017 09:16:04 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4039#discussion_r122657181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4039#discussion_r122657181&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractionUtils.java &amp;#8212;&lt;br/&gt;
    @@ -161,6 +164,77 @@ public static LambdaExecutable checkAndExtractLambda(Function function) throws T&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Extracts type from given index from lambda. It supports nested types.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param exec lambda function to extract the type from&lt;br/&gt;
    +	 * @param lambdaTypeArgumentIndices position of type to extract in type hierarchy&lt;br/&gt;
    +	 * @param paramLen count of total parameters of the lambda (including closure parameters)&lt;br/&gt;
    +	 * @param baseParametersLen count of lambda interface parameters (without closure parameters)&lt;br/&gt;
    +	 * @return extracted type&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static Type extractTypeFromLambda(&lt;br/&gt;
    +		LambdaExecutable exec,&lt;br/&gt;
    +		int[] lambdaTypeArgumentIndices,&lt;br/&gt;
    +		int paramLen,&lt;br/&gt;
    +		int baseParametersLen) {&lt;br/&gt;
    +		Type output = exec.getParameterTypes()[paramLen - baseParametersLen + lambdaTypeArgumentIndices&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;];&lt;br/&gt;
    +		for (int i = 1; i &amp;lt; lambdaTypeArgumentIndices.length; i++) &lt;/p&gt;
{
    +			output = extractTypeArgument(output, lambdaTypeArgumentIndices[i]);
    +		}
&lt;p&gt;    +		return output;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * * This method extracts the n-th type argument from the given type. An InvalidTypesException&lt;br/&gt;
    +	 * is thrown if the type does not have any type arguments or if the index exceeds the number&lt;br/&gt;
    +	 * of type arguments.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param t Type to extract the type arguments from&lt;br/&gt;
    +	 * @param index Index of the type argument to extract&lt;br/&gt;
    +	 * @return The extracted type argument&lt;br/&gt;
    +	 * @throws InvalidTypesException if the given type does not have any type arguments or if the&lt;br/&gt;
    +	 * index exceeds the number of type arguments.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static Type extractTypeArgument(Type t, int index) throws InvalidTypesException {&lt;br/&gt;
    +		if (t instanceof ParameterizedType) {&lt;br/&gt;
    +			Type[] actualTypeArguments = ((ParameterizedType) t).getActualTypeArguments();&lt;br/&gt;
    +&lt;br/&gt;
    +			if (index &amp;lt; 0 || index &amp;gt;= actualTypeArguments.length) &lt;/p&gt;
{
    +				throw new InvalidTypesException(&quot;Cannot extract the type argument with index &quot; +
    +												index + &quot; because the type has only &quot; + actualTypeArguments.length +
    +												&quot; type arguments.&quot;);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				return actualTypeArguments[index];
    +			}
&lt;p&gt;    +		} else &lt;/p&gt;
{
    +			throw new InvalidTypesException(&quot;The given type &quot; + t + &quot; is not a parameterized type.&quot;);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Extracts a Single Abstract Method (SAM) as defined in Java Specification (4.3.2. The Class Object,&lt;br/&gt;
    +	 * 9.8 Functional Interfaces, 9.4.3 Interface Method Body) from given class.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param baseClass&lt;br/&gt;
    +	 * @throws InvalidTypesException if the given class does not implement&lt;br/&gt;
    +	 * @return&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static Method getSingleAbstractMethod(Class&amp;lt;?&amp;gt; baseClass) {&lt;br/&gt;
    +		Method sam = null;&lt;br/&gt;
    +		for (Method method : baseClass.getMethods()) {&lt;br/&gt;
    +			if (Modifier.isAbstract(method.getModifiers())) {&lt;br/&gt;
    +				if (sam == null) &lt;/p&gt;
{
    +					sam = method;
    +				}
&lt;p&gt; else {&lt;br/&gt;
    +					throw new InvalidTypesException(&lt;br/&gt;
    +						&quot;Given class: &quot; + baseClass + &quot; is not a FunctionalInterface. It does not have a SAM.&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    @tedyu You are right. I&apos;ve created a PR with a fix. Could you have a look? #4140&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fozb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>