<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24648] Ceil, floor for some timeunit return wrong results or fail with CompileException</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24648</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;There are issues&lt;br/&gt;
1. for &lt;tt&gt;TIMESTAMP WITHOUT TIMEZONE&lt;/tt&gt; and &lt;tt&gt;DATE&lt;/tt&gt; it returns wrong result for queries&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ceil&lt;/span&gt;(timstamp&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-26-10 12:12:12&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; decade);
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ceil&lt;/span&gt;(timstamp&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-26-10 12:12:12&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; century);
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ceil&lt;/span&gt;(timstamp&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-26-10 12:12:12&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; millennium);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;same for &lt;tt&gt;FLOOR&lt;/tt&gt; and &lt;tt&gt;DATE&lt;/tt&gt;&lt;br/&gt;
2. for &lt;tt&gt;TIMESTAMP WITH TIMEZONE&lt;/tt&gt; it throws exception below.&lt;/p&gt;

&lt;p&gt;Expected for the query&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;floor&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-10-07&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; decade) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; floor_decade,      
         &lt;span class=&quot;code-keyword&quot;&gt;ceil&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-10-07&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; decade) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; ceil_decade,
         &lt;span class=&quot;code-keyword&quot;&gt;floor&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-10-07&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; century) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; floor_century,
         &lt;span class=&quot;code-keyword&quot;&gt;ceil&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-10-07&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; century) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; ceil_century,
         &lt;span class=&quot;code-keyword&quot;&gt;floor&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-10-07&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; millennium) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; floor_millennium,
         &lt;span class=&quot;code-keyword&quot;&gt;ceil&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-10-07&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; millennium) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; ceil_millennium;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; floor_decade ceil_decade floor_century ceil_century floor_millennium ceil_millennium
   2020-01-01  2030-01-01    2001-01-01   2101-01-01       2001-01-01      3001-01-01
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;based on  PostgreSQL&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and Vertica&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; defibitions &lt;br/&gt;
And for both the definition is the same&lt;br/&gt;
&lt;tt&gt;DECADE&lt;/tt&gt; - The year field divided by 10&lt;br/&gt;
&lt;tt&gt;CENTURY&lt;/tt&gt; - The first century starts at 0001-01-01 00:00:00 AD, although they did not know it at the time. This definition applies to all Gregorian calendar countries. There is no century number 0, you go from -1 century to 1 century.&lt;br/&gt;
&lt;tt&gt;MILLENNIUM&lt;/tt&gt; - The millennium number, where the first millennium is 1 and each millenium starts on 01-01-y001. For example, millennium 2 starts on 01-01-1001.&lt;br/&gt;
from&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://www.postgresql.org/docs/14/functions-datetime.html#FUNCTIONS-DATETIME-EXTRACT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.postgresql.org/docs/14/functions-datetime.html#FUNCTIONS-DATETIME-EXTRACT&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://www.vertica.com/docs/9.2.x/HTML/Content/Authoring/SQLReferenceManual/Functions/Date-Time/DATE_PART.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.vertica.com/docs/9.2.x/HTML/Content/Authoring/SQLReferenceManual/Functions/Date-Time/DATE_PART.htm&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] Could not execute SQL statement. Reason:
org.codehaus.commons.compiler.CompileException: Line 57, Column 0: No applicable constructor/method found for actual parameters &quot;org.apache.flink.table.data.TimestampData, org.apache.flink.table.data.TimestampData&quot;; candidates are: &quot;public static int org.apache.calcite.runtime.SqlFunctions.ceil(int, java.math.BigDecimal)&quot;, &quot;public static java.math.BigDecimal org.apache.calcite.runtime.SqlFunctions.ceil(java.math.BigDecimal, int)&quot;, &quot;public static java.math.BigDecimal org.apache.calcite.runtime.SqlFunctions.ceil(java.math.BigDecimal, java.math.BigDecimal)&quot;, &quot;public static short org.apache.calcite.runtime.SqlFunctions.ceil(short, short)&quot;, &quot;public static java.math.BigDecimal org.apache.calcite.runtime.SqlFunctions.ceil(java.math.BigDecimal)&quot;, &quot;public static double org.apache.calcite.runtime.SqlFunctions.ceil(double)&quot;, &quot;public static float org.apache.calcite.runtime.SqlFunctions.ceil(float)&quot;, &quot;public static byte org.apache.calcite.runtime.SqlFunctions.ceil(byte, byte)&quot;, &quot;public static long org.apache.calcite.runtime.SqlFunctions.ceil(long, long)&quot;, &quot;public static int org.apache.calcite.runtime.SqlFunctions.ceil(int, int)&quot;
	at org.codehaus.janino.UnitCompiler.compileError(UnitCompiler.java:12211)
	at org.codehaus.janino.UnitCompiler.findMostSpecificIInvocable(UnitCompiler.java:9263)
	at org.codehaus.janino.UnitCompiler.findIMethod(UnitCompiler.java:9123)
	at org.codehaus.janino.UnitCompiler.findIMethod(UnitCompiler.java:9025)
	at org.codehaus.janino.UnitCompiler.compileGet2(UnitCompiler.java:5062)
	at org.codehaus.janino.UnitCompiler.access$9100(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$16.visitMethodInvocation(UnitCompiler.java:4423)
	at org.codehaus.janino.UnitCompiler$16.visitMethodInvocation(UnitCompiler.java:4396)
	at org.codehaus.janino.Java$MethodInvocation.accept(Java.java:5073)
	at org.codehaus.janino.UnitCompiler.compileGet(UnitCompiler.java:4396)
	at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:5662)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:3792)
	at org.codehaus.janino.UnitCompiler.access$6100(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$13.visitAssignment(UnitCompiler.java:3754)
	at org.codehaus.janino.UnitCompiler$13.visitAssignment(UnitCompiler.java:3734)
	at org.codehaus.janino.Java$Assignment.accept(Java.java:4477)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3734)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2360)
	at org.codehaus.janino.UnitCompiler.access$1800(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$6.visitExpressionStatement(UnitCompiler.java:1494)
	at org.codehaus.janino.UnitCompiler$6.visitExpressionStatement(UnitCompiler.java:1487)
	at org.codehaus.janino.Java$ExpressionStatement.accept(Java.java:2874)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1487)
	at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1567)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1553)
	at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1493)
	at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1487)
	at org.codehaus.janino.Java$Block.accept(Java.java:2779)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1487)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2476)
	at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1495)
	at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1487)
	at org.codehaus.janino.Java$IfStatement.accept(Java.java:2950)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1487)
	at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1567)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3388)
	at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1357)
	at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1330)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:822)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:432)
	at org.codehaus.janino.UnitCompiler.access$400(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:411)
	at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:406)
	at org.codehaus.janino.Java$PackageMemberClassDeclaration.accept(Java.java:1414)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:406)
	at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:378)
	at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:237)
	at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:465)
	at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:216)
	at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:207)
	at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:80)
	at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:75)
	at org.apache.flink.table.runtime.generated.CompileUtils.doCompile(CompileUtils.java:86)
	at org.apache.flink.table.runtime.generated.CompileUtils.lambda$compile$1(CompileUtils.java:74)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache$LocalManualCache$1.load(LocalCache.java:4864)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3529)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2278)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2155)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2045)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache.get(LocalCache.java:3962)
	at org.apache.flink.shaded.guava30.com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4859)
	at org.apache.flink.table.runtime.generated.CompileUtils.compile(CompileUtils.java:74)
	at org.apache.flink.table.runtime.generated.GeneratedClass.compile(GeneratedClass.java:102)
	at org.apache.flink.table.runtime.generated.GeneratedClass.newInstance(GeneratedClass.java:83)
	at org.apache.flink.table.runtime.operators.CodeGenOperatorFactory.createStreamOperator(CodeGenOperatorFactory.java:40)
	at org.apache.flink.streaming.api.operators.StreamOperatorFactoryUtil.createOperator(StreamOperatorFactoryUtil.java:81)
	at org.apache.flink.streaming.runtime.tasks.OperatorChain.createOperator(OperatorChain.java:712)
	at org.apache.flink.streaming.runtime.tasks.OperatorChain.createOperatorChain(OperatorChain.java:686)
	at org.apache.flink.streaming.runtime.tasks.OperatorChain.createOutputCollector(OperatorChain.java:626)
	at org.apache.flink.streaming.runtime.tasks.OperatorChain.&amp;lt;init&amp;gt;(OperatorChain.java:187)
	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.&amp;lt;init&amp;gt;(RegularOperatorChain.java:63)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:675)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:661)
	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:960)
	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:929)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:753)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:574)
	at java.base/java.lang.Thread.run(Thread.java:834)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13408414">FLINK-24648</key>
            <summary>Ceil, floor for some timeunit return wrong results or fail with CompileException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Sergey Nuyanzin">Sergey Nuyanzin</assignee>
                                    <reporter username="Sergey Nuyanzin">Sergey Nuyanzin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 26 Oct 2021 11:13:15 +0000</created>
                <updated>Thu, 4 Nov 2021 01:57:37 +0000</updated>
                            <resolved>Wed, 3 Nov 2021 07:55:37 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.15.0</fixVersion>
                                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17434359" author="sergey nuyanzin" created="Tue, 26 Oct 2021 13:23:43 +0000"  >&lt;p&gt;The PR contains changes in DateTimeUtils&lt;br/&gt;
The similar changes recently were added in Avatica &lt;a href=&quot;https://github.com/apache/calcite-avatica/commit/e462b09d4d8b6dd64a9a9c0562a6d11868751a06&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/calcite-avatica/commit/e462b09d4d8b6dd64a9a9c0562a6d11868751a06&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17437793" author="lzljs3620320" created="Wed, 3 Nov 2021 07:55:37 +0000"  >&lt;p&gt;master: ac12dc2b02aaaf6cdd1354d72a17391fb137ae0a&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w5vk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>