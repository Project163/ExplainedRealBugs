<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31133] PartiallyFinishedSourcesITCase hangs if a checkpoint fails</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31133</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=46299&amp;amp;view=logs&amp;amp;j=39d5b1d5-3b41-54dc-6458-1e2ddd1cdcf3&amp;amp;t=0c010d0c-3dec-5bf1-d408-7b18988b1b2b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=46299&amp;amp;view=logs&amp;amp;j=39d5b1d5-3b41-54dc-6458-1e2ddd1cdcf3&amp;amp;t=0c010d0c-3dec-5bf1-d408-7b18988b1b2b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This build ran into a timeout. Based on the stacktraces reported, it was either caused by &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=46299&amp;amp;view=logs&amp;amp;j=39d5b1d5-3b41-54dc-6458-1e2ddd1cdcf3&amp;amp;t=0c010d0c-3dec-5bf1-d408-7b18988b1b2b&amp;amp;l=13475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SnapshotMigrationTestBase.restoreAndExecute&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007f23d800b800 nid=0x60cdd waiting on condition [0x00007f23e1c0d000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
	at org.apache.flink.test.checkpointing.utils.SnapshotMigrationTestBase.restoreAndExecute(SnapshotMigrationTestBase.java:382)
	at org.apache.flink.test.migration.TypeSerializerSnapshotMigrationITCase.testSnapshot(TypeSerializerSnapshotMigrationITCase.java:172)
	at sun.reflect.GeneratedMethodAccessor47.invoke(Unknown Source)
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=46299&amp;amp;view=logs&amp;amp;j=39d5b1d5-3b41-54dc-6458-1e2ddd1cdcf3&amp;amp;t=0c010d0c-3dec-5bf1-d408-7b18988b1b2b&amp;amp;l=10401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PartiallyFinishedSourcesITCase.test&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-02-20T07:13:05.6084711Z &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007fd35c00b800 nid=0x8c8a waiting on condition [0x00007fd363d0f000]
2023-02-20T07:13:05.6085149Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
2023-02-20T07:13:05.6085487Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
2023-02-20T07:13:05.6085925Z 	at org.apache.flink.runtime.testutils.CommonTestUtils.waitUntilCondition(CommonTestUtils.java:145)
2023-02-20T07:13:05.6086512Z 	at org.apache.flink.runtime.testutils.CommonTestUtils.waitUntilCondition(CommonTestUtils.java:138)
2023-02-20T07:13:05.6087103Z 	at org.apache.flink.runtime.testutils.CommonTestUtils.waitForSubtasksToFinish(CommonTestUtils.java:291)
2023-02-20T07:13:05.6087730Z 	at org.apache.flink.runtime.operators.lifecycle.TestJobExecutor.waitForSubtasksToFinish(TestJobExecutor.java:226)
2023-02-20T07:13:05.6088410Z 	at org.apache.flink.runtime.operators.lifecycle.PartiallyFinishedSourcesITCase.test(PartiallyFinishedSourcesITCase.java:138)
2023-02-20T07:13:05.6088957Z 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Still, it sounds odd: Based on a code analysis it&apos;s quite unlikely that those two caused the issue. The former one has a 5 min timeout (see related code in &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.15/flink-tests/src/test/java/org/apache/flink/test/checkpointing/utils/SnapshotMigrationTestBase.java#L382&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SnapshotMigrationTestBase:382&lt;/a&gt;). For the other one, we found it being not responsible in the past when some other concurrent test caused the issue (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-30261&quot; title=&quot;PartiallyFinishedSourcesITCase.test timed out while waiting for tasks to finish&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-30261&quot;&gt;&lt;del&gt;FLINK-30261&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;An investigation on where we lose the time for the timeout revealed that &lt;tt&gt;AdaptiveSchedulerITCase&lt;/tt&gt; took 2980s to finish (see &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=46299&amp;amp;view=logs&amp;amp;j=39d5b1d5-3b41-54dc-6458-1e2ddd1cdcf3&amp;amp;t=0c010d0c-3dec-5bf1-d408-7b18988b1b2b&amp;amp;l=5265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build logs&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-02-20T03:43:55.4546050Z Feb 20 03:43:55 [ERROR] Picked up JAVA_TOOL_OPTIONS: -XX:+HeapDumpOnOutOfMemoryError
2023-02-20T03:43:58.0448506Z Feb 20 03:43:58 [INFO] Running org.apache.flink.test.scheduling.AdaptiveSchedulerITCase
2023-02-20T04:33:38.6824634Z Feb 20 04:33:38 [INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2,980.445 s - in org.apache.flink.test.scheduling.AdaptiveSchedulerITCase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13525410">FLINK-31133</key>
            <summary>PartiallyFinishedSourcesITCase hangs if a checkpoint fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 20 Feb 2023 10:08:07 +0000</created>
                <updated>Wed, 8 Mar 2023 17:55:07 +0000</updated>
                            <resolved>Fri, 3 Mar 2023 20:13:48 +0000</resolved>
                                    <version>1.15.3</version>
                    <version>1.16.1</version>
                    <version>1.18.0</version>
                    <version>1.17.1</version>
                                    <fixVersion>1.15.4</fixVersion>
                    <fixVersion>1.16.2</fixVersion>
                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.17.1</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17691117" author="mapohl" created="Mon, 20 Feb 2023 10:14:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; could you have a look at that one if you find time? I&apos;m worried that there&apos;s an issue that&apos;s also present in newer versions. But I guess, it&apos;s hard to investigate if we don&apos;t have logs.&lt;/p&gt;</comment>
                            <comment id="17691159" author="mapohl" created="Mon, 20 Feb 2023 12:54:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; discovered multiple checkpoint failure due to exceeding the tolerable failure threshold for creating a checkpoint (which seems to be 10min):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
04:24:18,587 [    Checkpoint Timer] WARN  org.apache.flink.runtime.checkpoint.CheckpointFailureManager [] - Failed to trigger or complete checkpoint 4 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job af8411cc8af5e2485beb4466ffd452a3. (0 consecutive failed attempts so far)
org.apache.flink.runtime.checkpoint.CheckpointException: Checkpoint expired before completing.
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator$CheckpointCanceller.run(CheckpointCoordinator.java:2143) [flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_292]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_292]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_292]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_292]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_292]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_292]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_292]
04:24:18,588 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-8] INFO  org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler [] - Restarting job.
org.apache.flink.util.FlinkRuntimeException: Exceeded checkpoint tolerable failure threshold.
        at org.apache.flink.runtime.checkpoint.CheckpointFailureManager.checkFailureAgainstCounter(CheckpointFailureManager.java:206) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at org.apache.flink.runtime.checkpoint.CheckpointFailureManager.handleJobLevelCheckpointException(CheckpointFailureManager.java:169) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at org.apache.flink.runtime.checkpoint.CheckpointFailureManager.handleCheckpointException(CheckpointFailureManager.java:122) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingCheckpoint(CheckpointCoordinator.java:2082) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingCheckpoint(CheckpointCoordinator.java:2061) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.access$600(CheckpointCoordinator.java:98) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at org.apache.flink.runtime.checkpoint.CheckpointCoordinator$CheckpointCanceller.run(CheckpointCoordinator.java:2143) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_292]
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_292]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) ~[?:1.8.0_292]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) ~[?:1.8.0_292]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_292]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_292]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) ~[?:1.8.0_292]
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;&#160; can you help with that one?&lt;/p&gt;</comment>
                            <comment id="17691693" author="roman_khachatryan" created="Tue, 21 Feb 2023 16:25:02 +0000"  >&lt;p&gt;I think the issue is actually PartiallyFinishedSourcesITCase.&lt;/p&gt;

&lt;p&gt;It starts at 3:40&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
03:40:55,702 [ &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;main] INFO &#160;org.apache.flink.runtime.operators.lifecycle.PartiallyFinishedSourcesITCase [] -
================================================================================
Test test[complex graph ALL_SUBTASKS, failover: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, strategy: full](org.apache.flink.runtime.operators.lifecycle.PartiallyFinishedSourcesITCase) is running.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then a checkpoint fails because of a timeout:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
03:41:10,775 [ChangelogRetryScheduler-1] INFO &#160;org.apache.flink.changelog.fs.RetryingExecutor &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - failed with 3 attempts: Attempt 3 timed out after 1000ms
03:41:10,777 [AsyncOperations-thread-1] INFO &#160;org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable [] - transform-2-keyed (4/4)#0 - asynchronous part of checkpoint 2 could not be completed.
java.util.concurrent.CompletionException: java.io.IOException: java.util.concurrent.TimeoutException: Attempt 3 timed out after 1000ms
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:607) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at org.apache.flink.changelog.fs.FsStateChangelogWriter$UploadCompletionListener.onFailure(FsStateChangelogWriter.java:383) ~[flink-dstl-dfs-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.changelog.fs.FsStateChangelogWriter.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$0(FsStateChangelogWriter.java:223) ~[flink-dstl-dfs-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at java.util.ArrayList.removeIf(ArrayList.java:1415) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at org.apache.flink.changelog.fs.FsStateChangelogWriter.lambda$handleUploadFailure$4(FsStateChangelogWriter.java:222) ~[flink-dstl-dfs-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.runThrowing(StreamTaskActionExecutor.java:50) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.mailbox.Mail.run(Mail.java:90) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.processMailsWhenDefaultActionUnavailable(MailboxProcessor.java:338) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.processMail(MailboxProcessor.java:324) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.runMailboxLoop(MailboxProcessor.java:201) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTask.runMailboxLoop(StreamTask.java:807) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:756) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:948) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:927) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:741) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.taskmanager.Task.run(Task.java:563) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_292]
Caused by: java.io.IOException: java.util.concurrent.TimeoutException: Attempt 3 timed out after 1000ms
&#160; &#160; &#160; &#160; at org.apache.flink.changelog.fs.FsStateChangelogWriter$UploadCompletionListener.onFailure(FsStateChangelogWriter.java:377) ~[flink-dstl-dfs-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; ... 15 more
Caused by: java.util.concurrent.TimeoutException: Attempt 3 timed out after 1000ms
&#160; &#160; &#160; &#160; at org.apache.flink.changelog.fs.RetryingExecutor$RetriableActionAttempt.fmtError(RetryingExecutor.java:285) ~[flink-dstl-dfs-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.changelog.fs.RetryingExecutor$RetriableActionAttempt.lambda$scheduleTimeout$1(RetryingExecutor.java:280) ~[flink-dstl-dfs-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_292]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After which it runs normally, ~1.4K checkpoints succeed.&lt;/p&gt;

&lt;p&gt;At 6:56, it finally reches no space left on device:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
06:56:53,713 [jobmanager-io-thread-1] INFO &#160;org.apache.flink.runtime.checkpoint.CheckpointCoordinator &#160; &#160;[] - Completed checkpoint 1396 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 1e2e4e86643f8249324da01fe5f8a04a (34948548049 bytes, checkpointDuration=6869 ms, finalizationTime=12 ms).
06:56:53,715 [ &#160; &#160;Checkpoint Timer] INFO &#160;org.apache.flink.runtime.checkpoint.CheckpointCoordinator &#160; &#160;[] - Triggering checkpoint 1397 (type=CheckpointType{name=&lt;span class=&quot;code-quote&quot;&gt;&apos;Checkpoint&apos;&lt;/span&gt;, sharingFilesStrategy=FORWARD_BACKWARD}) @ 1676876213715 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 1e2e4e86643f8249324da01fe5f8a04a.
...
06:57:02,402 [AsyncOperations-thread-1] INFO &#160;org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable [] - MultipleInputOperator (1/4)#1 - asynchronous part of checkpoint 1397 could not be completed.
java.util.concurrent.ExecutionException: java.io.IOException: No space left on device
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.api.operators.OperatorSnapshotFinalizer.&amp;lt;init&amp;gt;(OperatorSnapshotFinalizer.java:66) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable.finalizeNonFinishedSnapshots(AsyncCheckpointRunnable.java:191) ~[flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable.run(AsyncCheckpointRunnable.java:124) [flink-streaming-java-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_292]
Caused by: java.io.IOException: No space left on device
&#160; &#160; &#160; &#160; at java.io.FileOutputStream.writeBytes(Native Method) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.io.FileOutputStream.write(FileOutputStream.java:326) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at org.apache.flink.core.fs.local.LocalDataOutputStream.write(LocalDataOutputStream.java:68) ~[flink-core-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.core.fs.FSDataOutputStreamWrapper.write(FSDataOutputStreamWrapper.java:65) ~[flink-core-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.state.filesystem.FsCheckpointStreamFactory$FsCheckpointStateOutputStream.write(FsCheckpointStreamFactory.java:296) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAP &#160;SHOT]
&#160; &#160; &#160; &#160; at java.io.DataOutputStream.write(DataOutputStream.java:107) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at java.io.FilterOutputStream.write(FilterOutputStream.java:97) ~[?:1.8.0_292]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.io.network.buffer.NetworkBuffer.getBytes(NetworkBuffer.java:397) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.shaded.netty4.io.netty.buffer.AbstractUnpooledSlicedByteBuf.getBytes(AbstractUnpooledSlicedByteBuf.java:392) ~[flink-shaded-netty-4.1.70.Final-15.0.jar:?]
&#160; &#160; &#160; &#160; at org.apache.flink.shaded.netty4.io.netty.buffer.SlicedByteBuf.getBytes(SlicedByteBuf.java:26) ~[flink-shaded-netty-4.1.70.Final-15.0.jar:?]
&#160; &#160; &#160; &#160; at org.apache.flink.shaded.netty4.io.netty.buffer.ReadOnlyByteBuf.getBytes(ReadOnlyByteBuf.java:264) ~[flink-shaded-netty-4.1.70.Final-15.0.jar:?]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateSerializerImpl.writeData(ChannelStateSerializer.java:164) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateCheckpointWriter.lambda$write$2(ChannelStateCheckpointWriter.java:171) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateCheckpointWriter.runWithChecks(ChannelStateCheckpointWriter.java:295) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateCheckpointWriter.write(ChannelStateCheckpointWriter.java:165) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateCheckpointWriter.writeInput(ChannelStateCheckpointWriter.java:138) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequest.lambda$write$0(ChannelStateWriteRequest.java:63) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequest.lambda$buildWriteRequest$2(ChannelStateWriteRequest.java:92) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequest.execute(ChannelStateWriteRequest.java:211) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestDispatcherImpl.dispatchInternal(ChannelStateWriteRequestDispatcherImpl.java:85) ~[flink-runtime-1.15-SNAPSHOT.jar:1 &#160;.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestDispatcherImpl.dispatch(ChannelStateWriteRequestDispatcherImpl.java:62) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAP &#160;SHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.loop(ChannelStateWriteRequestExecutorImpl.java:96) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.run(ChannelStateWriteRequestExecutorImpl.java:75) ~[flink-runtime-1.15-SNAPSHOT.jar:1.15-SNAPSHOT]
&#160; &#160; &#160; &#160; ... 1 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Some other tests failed as a result with serialization failures or &quot;no such file&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m going to change the priority to Major because it&apos;s a pure test issue.&lt;/p&gt;</comment>
                            <comment id="17693544" author="roman_khachatryan" created="Sat, 25 Feb 2023 22:34:10 +0000"  >&lt;p&gt;There are two issues in case of a checkpoint failure:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;FAIL command might be dispatched to the source task that&apos;s already finished execution&lt;/li&gt;
	&lt;li&gt;waiting for the failover times out, but it then waits indefinitely to obtain job status result&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The issue affects only 1.15 because in later versions, state upload timeout and nr. of attempts were increased in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-27169&quot; title=&quot;PartiallyFinishedSourcesITCase.test hangs on azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-27169&quot;&gt;&lt;del&gt;FLINK-27169&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve created a &lt;a href=&quot;https://github.com/apache/flink/pull/22022&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; to address (1) and (2) and reopened &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-27169&quot; title=&quot;PartiallyFinishedSourcesITCase.test hangs on azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-27169&quot;&gt;&lt;del&gt;FLINK-27169&lt;/del&gt;&lt;/a&gt; to backport increased timeouts/attempts to 1.15.&lt;/p&gt;</comment>
                            <comment id="17695501" author="carp84" created="Thu, 2 Mar 2023 06:58:33 +0000"  >&lt;p&gt;The 1.15.4 version is about to release with &lt;a href=&quot;https://lists.apache.org/thread/4463cypc257l7j9rj2pycofbsdbbjx59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RC under vote&lt;/a&gt;. Please check and confirm whether this issue could still make into 1.15.4 and move it out if not. Thanks.&lt;/p&gt;</comment>
                            <comment id="17695523" author="roman_khachatryan" created="Thu, 2 Mar 2023 07:44:24 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liyu&quot; class=&quot;user-hover&quot; rel=&quot;liyu&quot;&gt;liyu&lt;/a&gt; , you are right, it will likely not make it into 1.15.4. I&apos;ll updated the version.&lt;/p&gt;</comment>
                            <comment id="17695540" author="carp84" created="Thu, 2 Mar 2023 08:23:53 +0000"  >&lt;p&gt;Thanks for the quick action &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17696304" author="roman_khachatryan" created="Fri, 3 Mar 2023 20:13:48 +0000"  >&lt;p&gt;Fix merged as&#160;&lt;/p&gt;

&lt;p&gt;1.15 51660f840cfc505b9b9cb72530fde7f9f8a4dee2&lt;br/&gt;
1.16 cf04b2c08fa04091845bd310990497129c3bcbe8&lt;br/&gt;
1.17 6e7703738cdefed17277ea86d2c9dc25393eceac&lt;br/&gt;
master 4aacff572a9e3996c5dee9273638831e4040c767&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1g1w8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>