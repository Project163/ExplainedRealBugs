<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:36:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10670] Fix Correlate codegen error</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10670</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;TableFunctionCollector should handle reuseInitCode and reuseMemberCode&lt;/p&gt;</description>
                <environment></environment>
        <key id="13193868">FLINK-10670</key>
            <summary>Fix Correlate codegen error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="RuidongLi">Ruidong Li</assignee>
                                    <reporter username="RuidongLi">Ruidong Li</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 24 Oct 2018 13:36:26 +0000</created>
                <updated>Mon, 19 Nov 2018 22:01:30 +0000</updated>
                            <resolved>Mon, 19 Nov 2018 22:01:30 +0000</resolved>
                                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16662476" author="githubbot" created="Wed, 24 Oct 2018 16:11:25 +0000"  >&lt;p&gt;Xpray opened a new pull request #6923: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10670&quot; title=&quot;Fix Correlate codegen error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10670&quot;&gt;&lt;del&gt;FLINK-10670&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix Correlate codegen error&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6923&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;lt;!--&lt;br/&gt;
   &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;   &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Contribution Checklist&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the pull request corresponds to a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/FLINK/issues&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/FLINK/issues&lt;/a&gt;). Exceptions are made for typos in JavaDoc or documentation files, which need no JIRA issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Name the pull request in the form &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXXX&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;component&amp;#93;&lt;/span&gt; Title of the pull request&quot;, where &lt;b&gt;FLINK-XXXX&lt;/b&gt; should be replaced by the actual issue number. Skip &lt;b&gt;component&lt;/b&gt; if you are unsure about which is the best component.&lt;br/&gt;
     Typo fixes that have no associated JIRA issue should be named following this pattern: `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Fix typo in event time introduction` or `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;javadocs&amp;#93;&lt;/span&gt; Expand JavaDoc for PuncuatedWatermarkGenerator`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fill out the template below to describe the changes contributed by the pull request. That will give reviewers the context they need to do the review.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the change passes the automated tests, i.e., `mvn clean verify` passes. You can set up Travis CI to do that following &lt;span class=&quot;error&quot;&gt;&amp;#91;this guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/contribute-code.html#best-practices&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/contribute-code.html#best-practices&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each pull request should address only one issue, not mix up code from multiple issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each commit in the pull request has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Once all items of the checklist are addressed, remove the above text and this checklist, leaving only the filled out template below.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;   *&lt;b&gt;(The sections below can be removed for hotfixes of typos)&lt;/b&gt;*&lt;br/&gt;
   --&amp;gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;br/&gt;
   TableFunctionCollector should handle reuseInitStatements and reuseMemberStatements&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
	&lt;li&gt;merge the statements of `CollectorCodeGenerator` and `FunctionCodeGenerator`&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;   This change added tests and can be verified as follows:&lt;br/&gt;
   Added test: org.apache.flink.table.runtime.stream.table.CorrelateITCase#testTableFunctionCollectorInit&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`:  no&lt;/li&gt;
	&lt;li&gt;The serializers:  no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive):  no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper:  no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector:  no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature?  no&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16691709" author="githubbot" created="Mon, 19 Nov 2018 13:45:55 +0000"  >&lt;p&gt;asfgit closed pull request #6923: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10670&quot; title=&quot;Fix Correlate codegen error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10670&quot;&gt;&lt;del&gt;FLINK-10670&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix Correlate codegen error&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6923&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala&lt;br/&gt;
index 2816f116ffd..ad36aa6e6ec 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala&lt;br/&gt;
@@ -109,39 +109,39 @@ abstract class CodeGenerator(&lt;/p&gt;

&lt;p&gt;   // set of member statements that will be added only once&lt;br/&gt;
   // we use a LinkedHashSet to keep the insertion order&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusableMemberStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusableMemberStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // set of constructor statements that will be added only once&lt;br/&gt;
   // we use a LinkedHashSet to keep the insertion order&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusableInitStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusableInitStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // set of open statements for RichFunction that will be added only once&lt;br/&gt;
   // we use a LinkedHashSet to keep the insertion order&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusableOpenStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusableOpenStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // set of close statements for RichFunction that will be added only once&lt;br/&gt;
   // we use a LinkedHashSet to keep the insertion order&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusableCloseStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusableCloseStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // set of statements that will be added only once per record;&lt;br/&gt;
   // code should only update member variables because local variables are not accessible if&lt;br/&gt;
   // the code needs to be split;&lt;br/&gt;
   // we use a LinkedHashSet to keep the insertion order&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusablePerRecordStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusablePerRecordStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // map of initial input unboxing expressions that will be added only once&lt;br/&gt;
   // (inputTerm, index) -&amp;gt; expr&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusableInputUnboxingExprs: mutable.Map&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int), GeneratedExpression&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusableInputUnboxingExprs: mutable.Map&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int), GeneratedExpression&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.Map&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int), GeneratedExpression&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // set of constructor statements that will be added only once&lt;br/&gt;
   // we use a LinkedHashSet to keep the insertion order&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected val reusableConstructorStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, String)&amp;#93;&lt;/span&gt; =&lt;br/&gt;
+  val reusableConstructorStatements: mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, String)&amp;#93;&lt;/span&gt; =&lt;br/&gt;
     mutable.LinkedHashSet&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, String)&amp;#93;&lt;/span&gt;()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   /**&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CollectorCodeGenerator.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CollectorCodeGenerator.scala&lt;br/&gt;
index 85d858fb75b..bd225c60b6b 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CollectorCodeGenerator.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CollectorCodeGenerator.scala&lt;br/&gt;
@@ -86,14 +86,24 @@ class CollectorCodeGenerator(&lt;br/&gt;
       s&quot;$input2TypeClass $input2Term&quot; // local variable&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    val memberCodes = (reusableMemberStatements ++ codeGenerator.reusableMemberStatements)&lt;br/&gt;
+      .mkString(&quot;&quot;, &quot;\n&quot;, &quot;\n&quot;)&lt;br/&gt;
+&lt;br/&gt;
+    val initCodes = (reusableInitStatements ++ codeGenerator.reusableInitStatements)&lt;br/&gt;
+      .mkString(&quot;&quot;, &quot;\n&quot;, &quot;\n&quot;)&lt;br/&gt;
+&lt;br/&gt;
+    val reusePerRecordCodes =&lt;br/&gt;
+      (reusablePerRecordStatements ++ codeGenerator.reusablePerRecordStatements)&lt;br/&gt;
+      .mkString(&quot;&quot;, &quot;\n&quot;, &quot;\n&quot;)&lt;br/&gt;
+&lt;br/&gt;
     val funcCode = j&quot;&quot;&quot;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;public class $className extends ${classOf[TableFunctionCollector&lt;span class=&quot;error&quot;&gt;&amp;#91;_&amp;#93;&lt;/span&gt;].getCanonicalName} {&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  $recordMember
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  ${reuseMemberCode()}&lt;br/&gt;
+      &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  ${memberCodes}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  public $className() throws Exception {
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${reuseInitCode()}&lt;br/&gt;
+      &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${initCodes}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  }&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  @Override&lt;br/&gt;
@@ -107,7 +117,7 @@ class CollectorCodeGenerator(&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    $input1TypeClass $input1Term = ($input1TypeClass) getInput();&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    $recordAssignment = ($input2TypeClass) record;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${reuseInputUnboxingCode()}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${reusePerRecordCode()}&lt;br/&gt;
+      &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${reusePerRecordCodes}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    $bodyCode&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  }&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;diff --git a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/CommonCorrelate.scala b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/CommonCorrelate.scala&lt;br/&gt;
index 3475e1901e9..18e1e5c5011 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/CommonCorrelate.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/CommonCorrelate.scala&lt;br/&gt;
@@ -150,17 +150,9 @@ trait CommonCorrelate &lt;/p&gt;
{
          |&quot;&quot;&quot;.stripMargin
     }
&lt;p&gt; else {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// adjust indices of InputRefs to adhere to schema expected by generator&lt;/li&gt;
	&lt;li&gt;val changeInputRefIndexShuttle = new RexShuttle {&lt;/li&gt;
	&lt;li&gt;override def visitInputRef(inputRef: RexInputRef): RexNode = 
{
-          new RexInputRef(inputSchema.arity + inputRef.getIndex, inputRef.getType)
-        }&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;// Run generateExpression to add init statements (ScalarFunctions) of condition to generator.&lt;/li&gt;
	&lt;li&gt;//   The generated expression is discarded.&lt;/li&gt;
	&lt;li&gt;generator.generateExpression(condition.get.accept(changeInputRefIndexShuttle))&lt;br/&gt;
-&lt;br/&gt;
       filterGenerator.input1Term = filterGenerator.input2Term&lt;br/&gt;
+      // filterGenerator run generateExpression to add init statements and member fields&lt;br/&gt;
+      // then combine with existing statements in generator&lt;br/&gt;
       val filterCondition = filterGenerator.generateExpression(condition.get)&lt;br/&gt;
       s&quot;&quot;&quot;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;${filterGenerator.reuseInputUnboxingCode()}&lt;br/&gt;
diff --git a/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/CorrelateITCase.scala b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/CorrelateITCase.scala&lt;br/&gt;
index f4b1f805974..ef9787e6ed5 100644&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/CorrelateITCase.scala&lt;br/&gt;
+++ b/flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/table/CorrelateITCase.scala&lt;br/&gt;
@@ -23,6 +23,7 @@ import org.apache.flink.api.scala._&lt;br/&gt;
 import org.apache.flink.streaming.api.scala.
{DataStream, StreamExecutionEnvironment}
&lt;p&gt; import org.apache.flink.table.api.scala._&lt;br/&gt;
 import org.apache.flink.table.api.&lt;/p&gt;
{TableEnvironment, Types, ValidationException}
&lt;p&gt;+import org.apache.flink.table.expressions.&lt;/p&gt;
{CurrentTimestamp, DateFormat}
&lt;p&gt; import org.apache.flink.table.expressions.utils.&lt;/p&gt;
{Func18, Func20, RichFunc2}
&lt;p&gt; import org.apache.flink.table.runtime.utils.&lt;/p&gt;
{StreamITCase, StreamTestData, _}
&lt;p&gt; import org.apache.flink.table.utils._&lt;br/&gt;
@@ -284,6 +285,27 @@ class CorrelateITCase extends AbstractTestBase &lt;/p&gt;
{
     )
   }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+  @Test&lt;br/&gt;
+  def testTableFunctionCollectorInit(): Unit = &lt;/p&gt;
{
+    val t = testData(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)
+    val func0 = new TableFunc0
+
+    // this case will generate &apos;timestamp&apos; member field and &apos;DateFormatter&apos;
+    val result = t
+      .join(func0(&apos;c) as(&apos;d, &apos;e))
+      .where(DateFormat(CurrentTimestamp(), &quot;yyyyMMdd&quot;) === &apos;d)
+      .select(&apos;c, &apos;d, &apos;e)
+      .toAppendStream[Row]
+
+    result.addSink(new StreamITCase.StringSink[Row])
+    env.execute()
+
+    assertEquals(
+      Seq(),
+      StreamITCase.testResults.sorted
+    )
+  }
&lt;p&gt;+&lt;br/&gt;
   private def testData(&lt;br/&gt;
       env: StreamExecutionEnvironment)&lt;br/&gt;
     : DataStream&lt;span class=&quot;error&quot;&gt;&amp;#91;(Int, Long, String)&amp;#93;&lt;/span&gt; = {&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16691739" author="twalthr" created="Mon, 19 Nov 2018 14:12:13 +0000"  >&lt;p&gt;Fixed in master: ea9507dbc2479d77fd85f431c38589263cb07fa0&lt;br/&gt;
Fixed in 1.7: 76974bd531a8b6c654cc7b7f9f1cce15efc4fe14&lt;br/&gt;
Fixed in 1.6: edd37816bb80f0c67fc187b4383eaa5c3ded07ae&lt;br/&gt;
Fixed in 1.5: 7a142575a5f032ea596242d3d654c1383b853879&lt;/p&gt;</comment>
                            <comment id="16692334" author="till.rohrmann" created="Mon, 19 Nov 2018 22:01:30 +0000"  >&lt;p&gt;Updated fix version&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zl53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>