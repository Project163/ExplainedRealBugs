<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9777] YARN: JM and TM Memory must be specified with Units </title>
                <link>https://issues.apache.org/jira/browse/FLINK-9777</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6469&quot; title=&quot;Configure Memory Sizes with units&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6469&quot;&gt;&lt;del&gt;FLINK-6469&lt;/del&gt;&lt;/a&gt; breaks backwards compatibility because the JobManager and TaskManager memory must be specified with units (otherwise bytes are assumed). The command to start a YARN session as documented (&lt;a href=&quot;https://github.com/apache/flink/blob/9f736d1927c62d220a82931c4f5ffa4955910f27/docs/ops/deployment/yarn_setup.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/9f736d1927c62d220a82931c4f5ffa4955910f27/docs/ops/deployment/yarn_setup.md) &lt;/a&gt; would not work because 1024 bytes and 4096 bytes are not enough for the heap size. The command finishes with the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.reflect.UndeclaredThrowableException
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1854)
	at org.apache.flink.runtime.security.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)
	at org.apache.flink.yarn.cli.FlinkYarnSessionCli.main(FlinkYarnSessionCli.java:802)
Caused by: org.apache.flink.client.deployment.ClusterDeploymentException: Couldn&apos;t deploy Yarn session cluster
	at org.apache.flink.yarn.AbstractYarnClusterDescriptor.deploySessionCluster(AbstractYarnClusterDescriptor.java:420)
	at org.apache.flink.yarn.cli.FlinkYarnSessionCli.run(FlinkYarnSessionCli.java:599)
	at org.apache.flink.yarn.cli.FlinkYarnSessionCli.lambda$main$2(FlinkYarnSessionCli.java:802)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1836)
	... 2 more
Caused by: org.apache.flink.util.FlinkException: Cannot fulfill the minimum memory requirements with the provided cluster specification. Please increase the memory of the cluster.
	at org.apache.flink.yarn.AbstractYarnClusterDescriptor.validateClusterSpecification(AbstractYarnClusterDescriptor.java:453)
	at org.apache.flink.yarn.AbstractYarnClusterDescriptor.deployInternal(AbstractYarnClusterDescriptor.java:475)
	at org.apache.flink.yarn.AbstractYarnClusterDescriptor.deploySessionCluster(AbstractYarnClusterDescriptor.java:413)
	... 7 more
Caused by: java.lang.IllegalArgumentException
	at org.apache.flink.util.Preconditions.checkArgument(Preconditions.java:123)
	at org.apache.flink.runtime.clusterframework.ContaineredTaskManagerParameters.calculateCutoffMB(ContaineredTaskManagerParameters.java:115)
	at org.apache.flink.yarn.AbstractYarnClusterDescriptor.validateClusterSpecification(AbstractYarnClusterDescriptor.java:450)
	... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;commit 9f736d1927c62d220a82931c4f5ffa4955910f27&lt;/p&gt;</environment>
        <key id="13170719">FLINK-9777</key>
            <summary>YARN: JM and TM Memory must be specified with Units </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yanghua">vinoyang</assignee>
                                    <reporter username="gjy">Gary Yao</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 8 Jul 2018 15:42:11 +0000</created>
                <updated>Wed, 18 Jul 2018 07:08:06 +0000</updated>
                            <resolved>Wed, 18 Jul 2018 06:39:27 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Deployment / YARN</component>
                    <component>Documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16536477" author="yanghua" created="Mon, 9 Jul 2018 01:35:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt; I&#160;fixed issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6469&quot; title=&quot;Configure Memory Sizes with units&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6469&quot;&gt;&lt;del&gt;FLINK-6469&lt;/del&gt;&lt;/a&gt;, I will take this ticket.&lt;/p&gt;</comment>
                            <comment id="16538592" author="gjy" created="Tue, 10 Jul 2018 13:31:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanghua&quot; class=&quot;user-hover&quot; rel=&quot;yanghua&quot;&gt;yanghua&lt;/a&gt; How do you want to fix it? &lt;/p&gt;</comment>
                            <comment id="16538702" author="yanghua" created="Tue, 10 Jul 2018 14:40:56 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt; now the command option &quot;-jm&quot; and &quot;-tm&quot; have matched the new config key &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;jobmanager.heap.size&quot;&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;taskmanager.heap.size&quot;&lt;/a&gt;.&#160; So we should guide users to use the memory unit.&lt;/p&gt;

&lt;p&gt;Actually, both standalone and yarn-session the config is&#160;backwards compatibility. Here is a &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-core/src/main/java/org/apache/flink/configuration/MemorySize.java#L143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;method&lt;/a&gt; to do this. So when we prase the two keys&apos; value, we&#160;need use this method.&#160; I will use this method at[ this place|&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L389&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L389&lt;/a&gt;.]&#160;And change the command option description.&lt;/p&gt;</comment>
                            <comment id="16538703" author="yanghua" created="Tue, 10 Jul 2018 14:41:48 +0000"  >&lt;p&gt;will fix soon.&lt;/p&gt;</comment>
                            <comment id="16538765" author="githubbot" created="Tue, 10 Jul 2018 15:20:10 +0000"  >&lt;p&gt;GitHub user yanghua opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9777&quot; title=&quot;YARN: JM and TM Memory must be specified with Units &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9777&quot;&gt;&lt;del&gt;FLINK-9777&lt;/del&gt;&lt;/a&gt; YARN: JM and TM Memory must be specified with Units&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;This pull request specify unit for JM and TM memory on YARN mode&lt;/b&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;parse the jm and tm with default MB unit&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;change related document&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is already covered by existing tests*.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / *&lt;b&gt;not documented&lt;/b&gt;*)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/yanghua/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yanghua/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9777&quot; title=&quot;YARN: JM and TM Memory must be specified with Units &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9777&quot;&gt;&lt;del&gt;FLINK-9777&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6297&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0ba28e996e5dc01040b9dd4cc9d3d86f6cb9dacd&lt;br/&gt;
Author: yanghua &amp;lt;yanghua1127@...&amp;gt;&lt;br/&gt;
Date:   2018-07-10T15:16:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9777&quot; title=&quot;YARN: JM and TM Memory must be specified with Units &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9777&quot;&gt;&lt;del&gt;FLINK-9777&lt;/del&gt;&lt;/a&gt; YARN: JM and TM Memory must be specified with Units&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16539385" author="githubbot" created="Tue, 10 Jul 2018 23:53:24 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @GJL please review~&lt;/p&gt;</comment>
                            <comment id="16539953" author="githubbot" created="Wed, 11 Jul 2018 11:46:43 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol can you review this?&lt;/p&gt;</comment>
                            <comment id="16541341" author="githubbot" created="Thu, 12 Jul 2018 08:47:25 +0000"  >&lt;p&gt;Github user GJL commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I will take a look later.&lt;/p&gt;</comment>
                            <comment id="16541428" author="githubbot" created="Thu, 12 Jul 2018 10:11:57 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r201981340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r201981340&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/ops/deployment/yarn_setup.md &amp;#8212;&lt;br/&gt;
    @@ -101,12 +101,12 @@ Usage:&lt;br/&gt;
        Optional&lt;br/&gt;
          -D &amp;lt;arg&amp;gt;                        Dynamic properties&lt;br/&gt;
          &lt;del&gt;d,&lt;/del&gt;-detached                   Start detached&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;del&gt;jm,&lt;/del&gt;-jobManagerMemory &amp;lt;arg&amp;gt;    Memory for JobManager Container &lt;span class=&quot;error&quot;&gt;&amp;#91;in MB&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +     &lt;del&gt;jm,&lt;/del&gt;-jobManagerMemory &amp;lt;arg&amp;gt;    Memory for JobManager Container &lt;span class=&quot;error&quot;&gt;&amp;#91;with unit, if not, use MB&amp;#93;&lt;/span&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    nit: I would reword this to: &lt;br/&gt;
    &amp;gt; &lt;b&gt;Memory for JobManager container with optional unit (default: MB).&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="16541429" author="githubbot" created="Thu, 12 Jul 2018 10:11:57 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r201980407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r201980407&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Was there a reason against making `JOB_MANAGER_HEAP_MEMORY_MB` a deprecated key for `JOB_MANAGER_HEAP_MEMORY` when you worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6469&quot; title=&quot;Configure Memory Sizes with units&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6469&quot;&gt;&lt;del&gt;FLINK-6469&lt;/del&gt;&lt;/a&gt;? That is:&lt;br/&gt;
    ```&lt;br/&gt;
    public static final ConfigOption&amp;lt;String&amp;gt; JOB_MANAGER_HEAP_MEMORY =&lt;br/&gt;
    		key(&quot;jobmanager.heap.size&quot;)&lt;br/&gt;
    			.defaultValue(&quot;1024m&quot;)&lt;br/&gt;
    			.withDeprecatedKeys(&quot;jobmanager.heap.mb&quot;)&lt;br/&gt;
    		    ...&lt;br/&gt;
    ```&lt;br/&gt;
    I am not sure what happens if someone only configures `jobmanager.heap.mb` in `flink-conf.yaml`. Will the value be respected for all deployment modes?&lt;/p&gt;

&lt;p&gt;    Same holds for the TaskManager config key.&lt;/p&gt;</comment>
                            <comment id="16541431" author="githubbot" created="Thu, 12 Jul 2018 10:15:30 +0000"  >&lt;p&gt;Github user GJL commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc: @dawidwys @StephanEwen &lt;/p&gt;</comment>
                            <comment id="16541481" author="githubbot" created="Thu, 12 Jul 2018 11:14:25 +0000"  >&lt;p&gt;Github user yanghua commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r201997464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r201997464&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6469&quot; title=&quot;Configure Memory Sizes with units&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6469&quot;&gt;&lt;del&gt;FLINK-6469&lt;/del&gt;&lt;/a&gt;, in order to config the jm&apos;s memory with unit I introduced a new key and deprecated `jobmanager.heap.mb`.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;in flink codebase(except shell script) I have removed all the place used `JOB_MANAGER_HEAP_MEMORY_MB` and `jobmanager.heap.mb`, so it will not be used.&lt;/li&gt;
	&lt;li&gt;in shell (`config.sh`) the old key `jobmanager.heap.mb` also be supported if the new key `jobmanager.heap.size` can not be read, so it still be supported.&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="16541482" author="githubbot" created="Thu, 12 Jul 2018 11:15:01 +0000"  >&lt;p&gt;Github user yanghua commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r201997596&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r201997596&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/ops/deployment/yarn_setup.md &amp;#8212;&lt;br/&gt;
    @@ -101,12 +101,12 @@ Usage:&lt;br/&gt;
        Optional&lt;br/&gt;
          -D &amp;lt;arg&amp;gt;                        Dynamic properties&lt;br/&gt;
          &lt;del&gt;d,&lt;/del&gt;-detached                   Start detached&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;del&gt;jm,&lt;/del&gt;-jobManagerMemory &amp;lt;arg&amp;gt;    Memory for JobManager Container &lt;span class=&quot;error&quot;&gt;&amp;#91;in MB&amp;#93;&lt;/span&gt;&lt;br/&gt;
    +     &lt;del&gt;jm,&lt;/del&gt;-jobManagerMemory &amp;lt;arg&amp;gt;    Memory for JobManager Container &lt;span class=&quot;error&quot;&gt;&amp;#91;with unit, if not, use MB&amp;#93;&lt;/span&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    change this soon&lt;/p&gt;</comment>
                            <comment id="16541563" author="githubbot" created="Thu, 12 Jul 2018 12:37:24 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202017985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202017985&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Would it hurt to add `.withDeprecatedKeys(&quot;jobmanager.heap.mb&quot;)`? In case someone does not use the scripts to start the cluster.&lt;/p&gt;</comment>
                            <comment id="16541565" author="githubbot" created="Thu, 12 Jul 2018 12:40:13 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202018873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202018873&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think the problem here would be that we would need to get back to MB as a default unit for this option. Or am I wrong here? The whole idea for introducing the new option was to switch to bytes as a default one, if none provided. &lt;/p&gt;</comment>
                            <comment id="16541573" author="githubbot" created="Thu, 12 Jul 2018 12:46:17 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202020619&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202020619&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @dawidwys As I understand, backwards compatibility should be prioritized. See &lt;a href=&quot;https://github.com/apache/flink/pull/5448#issuecomment-394296226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5448#issuecomment-394296226&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt; We need to add an additional MemoryUnit.parse() method that takes the &quot;default&quot; unit, so that we parse the old heap sizes such that they are in MB if nothing else is specified.&lt;/p&gt;</comment>
                            <comment id="16541585" author="githubbot" created="Thu, 12 Jul 2018 12:54:08 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202023148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202023148&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Agreed, missed it previously. Unfortunately `withDeprecatedKeys` won&apos;t solve it though. Either we should revert the option (and use the mb versions), or anywhere we use the new option, we should also check for the old one. &lt;/p&gt;</comment>
                            <comment id="16541739" author="githubbot" created="Thu, 12 Jul 2018 14:33:51 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202057663&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202057663&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @dawidwys Why is it not enough?&lt;/p&gt;

&lt;p&gt;    &amp;gt; When obtaining a value from the configuration via Configuration.getValue(ConfigOption), the deprecated keys will be checked in the order provided to this method. The first key for which a value is found will be used - that value will be returned.&lt;/p&gt;</comment>
                            <comment id="16541745" author="githubbot" created="Thu, 12 Jul 2018 14:38:55 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202059575&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202059575&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Imagine a case when previously we had in configuration:&lt;/p&gt;

&lt;p&gt;        jobmanager.heap.mb: 1024&lt;/p&gt;

&lt;p&gt;    which meant 1024 MB, in the new code we will pass 1024 as value for `jobmanager.heap.size`, which was introduced solely to treat numbers without units as bytes. Therefore it will be parsed as 1024 bytes rather than 1024 MB.&lt;/p&gt;

&lt;p&gt;    If we switch the default unit to MB, there is no point for having a new `ConfigOption`.&lt;/p&gt;</comment>
                            <comment id="16541793" author="githubbot" created="Thu, 12 Jul 2018 15:08:53 +0000"  >&lt;p&gt;Github user yanghua commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202071052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202071052&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    to @GJL we can not use `.withDeprecatedKeys(&quot;jobmanager.heap.mb&quot;)` because `jobmanager.heap.size` and `jobmanager.heap.mb` has different meaning. The former can use different unit such *&lt;b&gt;1g&lt;/b&gt;* but the latter can just measure with *&lt;b&gt;MB&lt;/b&gt;*.&lt;/p&gt;

&lt;p&gt;    to @dawidwys and @GJL , now the `jobmanager.heap.mb` just used in config file, and can be calculated accurately, this is used for backwards compatibility, but in the project, it is useless, all the place can be replaced with `jobmanager.heap.size`, and the key in the code could not been exposed to the user?&lt;/p&gt;</comment>
                            <comment id="16541805" author="githubbot" created="Thu, 12 Jul 2018 15:19:14 +0000"  >&lt;p&gt;Github user yanghua commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202075216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202075216&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    introduce a new config key is used to make the `jobmanager.heap.mb` backwards compatibility in flink config file (config.sh can calculate it accurately). And user can specify the unit for the value of the key `jobmanager.heap.size` .&lt;/p&gt;

&lt;p&gt;    So if we remove anything about `JOB_MANAGER_HEAP_MEMORY_MB ` in Java and Scala code, is there any problem?&lt;/p&gt;</comment>
                            <comment id="16541842" author="githubbot" created="Thu, 12 Jul 2018 15:47:52 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202085772&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202085772&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -386,10 +386,10 @@ private ClusterSpecification createClusterSpecification(Configuration configurat&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		// JobManager Memory&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY)).getMebiBytes();&lt;br/&gt;
    +		final int jobManagerMemoryMB = MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY), MemorySize.MemoryUnit.MEGA_BYTES).getMebiBytes();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we cannot do this as users might not use the `config.sh`. At the same time we think we really should keep backwards compatibility, as otherwise there might be complaints.  We&apos;ve discussed this with @GJL offline and we think the way to go right now would be to check everywhere we use the new option to check for the old one as well if the new one was not set.&lt;/p&gt;

&lt;p&gt;    That is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;`org.apache.flink.client.deployment.ClusterSpecification#fromConfiguration`&lt;/li&gt;
	&lt;li&gt;`org.apache.flink.yarn.YarnResourceManager#YarnResourceManager`&lt;/li&gt;
	&lt;li&gt;`org.apache.flink.yarn.cli.FlinkYarnSessionCli#createClusterSpecification`&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Probably we should wrap it in some utility method.&lt;/p&gt;

&lt;p&gt;    Also for the yarn command line we should keep the old behaviour. This means we should add &quot;m&quot; suffix in `org.apache.flink.yarn.cli.FlinkYarnSessionCli#applyCommandLineOptionsToConfiguration`&lt;/p&gt;</comment>
                            <comment id="16543017" author="githubbot" created="Fri, 13 Jul 2018 12:52:19 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202339002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202339002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -500,11 +501,11 @@ protected Configuration applyCommandLineOptionsToConfiguration(CommandLine comma&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		if (commandLine.hasOption(jmMemory.getOpt())) &lt;/p&gt;
{
    -			effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()));
    +			effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()) + &quot;m&quot;);
     		}

&lt;p&gt;     		if (commandLine.hasOption(tmMemory.getOpt())) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;effectiveConfiguration.setString(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(tmMemory.getOpt()));&lt;br/&gt;
    +			effectiveConfiguration.setString(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(tmMemory.getOpt()) + &quot;m&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Same as above.&lt;/p&gt;</comment>
                            <comment id="16543018" author="githubbot" created="Fri, 13 Jul 2018 12:52:19 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202338312&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202338312&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/ConfigurationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -29,6 +29,46 @@&lt;/p&gt;

&lt;p&gt;     	private static final String[] EMPTY = new String&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Get job manager&apos;s heap memory.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * This method will check the new key &lt;/p&gt;
{@link JobManagerOptions#JOB_MANAGER_HEAP_MEMORY}
&lt;p&gt; and&lt;br/&gt;
    +	 * the old key &lt;/p&gt;
{@link JobManagerOptions#JOB_MANAGER_HEAP_MEMORY_MB}
&lt;p&gt; for backwards compatibility.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration the configuration object&lt;br/&gt;
    +	 * @return the memory size of job manager&apos;s heap memory.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static MemorySize getJobManagerHeapMemory(Configuration configuration) {&lt;br/&gt;
    +		if (configuration.containsKey(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY.key())) &lt;/p&gt;
{
    +			return MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY));
    +		}
&lt;p&gt; else if (configuration.containsKey(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY_MB.key())) &lt;/p&gt;
{
    +			return MemorySize.parse(configuration.getInteger(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY_MB) + &quot;m&quot;);
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			throw new RuntimeException(&quot;Can not find config key : &quot; + JobManagerOptions.JOB_MANAGER_HEAP_MEMORY.key()
    +			+ &quot; or &quot; + JobManagerOptions.JOB_MANAGER_HEAP_MEMORY_MB);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Get task manager&apos;s heap memory.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * This method will check the new key &lt;/p&gt;
{@link TaskManagerOptions#TASK_MANAGER_HEAP_MEMORY}
&lt;p&gt; and&lt;br/&gt;
    +	 * the old key &lt;/p&gt;
{@link TaskManagerOptions#TASK_MANAGER_HEAP_MEMORY_MB}
&lt;p&gt; for backwards compatibility.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration the configuration object&lt;br/&gt;
    +	 * @return the memory size of task manager&apos;s heap memory.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static MemorySize getTaskManagerHeapMemory(Configuration configuration) {&lt;br/&gt;
    +		if (configuration.containsKey(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY.key())) &lt;/p&gt;
{
    +			return MemorySize.parse(configuration.getString(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY));
    +		}
&lt;p&gt; else if (configuration.containsKey(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY_MB.key())) &lt;/p&gt;
{
    +			return MemorySize.parse(configuration.getInteger(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY_MB) + &quot;m&quot;);
    +		}
&lt;p&gt; else {&lt;br/&gt;
    +			throw new RuntimeException(&quot;Can not find config key : &quot; + TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY.key()&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Use `FlinkRuntimeException`.&lt;/p&gt;</comment>
                            <comment id="16543019" author="githubbot" created="Fri, 13 Jul 2018 12:52:19 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202338296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202338296&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/ConfigurationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -29,6 +29,46 @@&lt;/p&gt;

&lt;p&gt;     	private static final String[] EMPTY = new String&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Get job manager&apos;s heap memory.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * This method will check the new key &lt;/p&gt;
{@link JobManagerOptions#JOB_MANAGER_HEAP_MEMORY}
&lt;p&gt; and&lt;br/&gt;
    +	 * the old key &lt;/p&gt;
{@link JobManagerOptions#JOB_MANAGER_HEAP_MEMORY_MB}
&lt;p&gt; for backwards compatibility.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration the configuration object&lt;br/&gt;
    +	 * @return the memory size of job manager&apos;s heap memory.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static MemorySize getJobManagerHeapMemory(Configuration configuration) {&lt;br/&gt;
    +		if (configuration.containsKey(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY.key())) &lt;/p&gt;
{
    +			return MemorySize.parse(configuration.getString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY));
    +		}
&lt;p&gt; else if (configuration.containsKey(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY_MB.key())) &lt;/p&gt;
{
    +			return MemorySize.parse(configuration.getInteger(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY_MB) + &quot;m&quot;);
    +		}
&lt;p&gt; else {&lt;br/&gt;
    +			throw new RuntimeException(&quot;Can not find config key : &quot; + JobManagerOptions.JOB_MANAGER_HEAP_MEMORY.key()&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Use `FlinkRuntimeException`.&lt;/p&gt;</comment>
                            <comment id="16543020" author="githubbot" created="Fri, 13 Jul 2018 12:52:19 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202338957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202338957&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -500,11 +501,11 @@ protected Configuration applyCommandLineOptionsToConfiguration(CommandLine comma&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		if (commandLine.hasOption(jmMemory.getOpt())) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()));&lt;br/&gt;
    +			effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()) + &quot;m&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we have to be a bit smarter here. The unit might be already provided from cli, right?&lt;/p&gt;</comment>
                            <comment id="16543322" author="githubbot" created="Fri, 13 Jul 2018 15:09:14 +0000"  >&lt;p&gt;Github user yanghua commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202381490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202381490&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -500,11 +501,11 @@ protected Configuration applyCommandLineOptionsToConfiguration(CommandLine comma&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		if (commandLine.hasOption(jmMemory.getOpt())) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()));&lt;br/&gt;
    +			effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()) + &quot;m&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    you are right, I have update the PR, please review, thanks.&lt;/p&gt;</comment>
                            <comment id="16545001" author="githubbot" created="Mon, 16 Jul 2018 09:39:30 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202624004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202624004&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -500,11 +500,19 @@ protected Configuration applyCommandLineOptionsToConfiguration(CommandLine comma&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		if (commandLine.hasOption(jmMemory.getOpt())) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()));&lt;br/&gt;
    +			String jmMemoryVal = commandLine.getOptionValue(jmMemory.getOpt());&lt;br/&gt;
    +			if (!jmMemoryVal.toLowerCase().contains(&quot;m&quot;)) 
{
    +				jmMemoryVal += &quot;m&quot;;
    +			}
&lt;p&gt;    +			effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, jmMemoryVal);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		if (commandLine.hasOption(tmMemory.getOpt())) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;effectiveConfiguration.setString(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(tmMemory.getOpt()));&lt;br/&gt;
    +			String tmMemoryVal = commandLine.getOptionValue(tmMemory.getOpt());&lt;br/&gt;
    +			if (!tmMemoryVal.toLowerCase().contains(&quot;m&quot;)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Same as above&lt;/p&gt;</comment>
                            <comment id="16545002" author="githubbot" created="Mon, 16 Jul 2018 09:39:30 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r202623960&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r202623960&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java &amp;#8212;&lt;br/&gt;
    @@ -500,11 +500,19 @@ protected Configuration applyCommandLineOptionsToConfiguration(CommandLine comma&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;     		if (commandLine.hasOption(jmMemory.getOpt())) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;effectiveConfiguration.setString(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY, commandLine.getOptionValue(jmMemory.getOpt()));&lt;br/&gt;
    +			String jmMemoryVal = commandLine.getOptionValue(jmMemory.getOpt());&lt;br/&gt;
    +			if (!jmMemoryVal.toLowerCase().contains(&quot;m&quot;)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This won&apos;t cover other units than &quot;m&quot;. How about checking it with `MemoryUnit.hasUnit`?&lt;/p&gt;</comment>
                            <comment id="16545022" author="githubbot" created="Mon, 16 Jul 2018 10:02:38 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Changes look good now. I think we are still missing tests for the added behaviour. We should check:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if yarn cli parameters are properly parsed without units&lt;/li&gt;
	&lt;li&gt;if yarn cli parameters are properly parsed with units other than m&lt;/li&gt;
	&lt;li&gt;if the logic for `getJobManagerHeapMemory/getTaskManagerHeapMemory` works properly (if the old parameter is parsed if the new one is not provided. If the default value is provided if no option was set.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16546425" author="githubbot" created="Tue, 17 Jul 2018 11:17:23 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys added test case, please review~&lt;/p&gt;</comment>
                            <comment id="16546517" author="githubbot" created="Tue, 17 Jul 2018 12:30:28 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r203000441&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r203000441&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/test/java/org/apache/flink/yarn/FlinkYarnSessionCliTest.java &amp;#8212;&lt;br/&gt;
    @@ -352,6 +352,76 @@ public void testConfigurationClusterSpecification() throws Exception &lt;/p&gt;
{
     		assertThat(clusterSpecification.getSlotsPerTaskManager(), is(slotsPerTaskManager));
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Tests the specifying heap memory for job manager and task manager.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testHeapMemoryProperty() throws Exception {&lt;br/&gt;
    +		//without unit&lt;br/&gt;
    +		String[] args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024&quot;, &quot;-ytm&quot;, &quot;2048&quot; }
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +		FlinkYarnSessionCli flinkYarnSessionCli = new FlinkYarnSessionCli(&lt;br/&gt;
    +			new Configuration(),&lt;br/&gt;
    +			tmp.getRoot().getAbsolutePath(),&lt;br/&gt;
    +			&quot;y&quot;,&lt;br/&gt;
    +			&quot;yarn&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CommandLine commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +&lt;br/&gt;
    +		ClusterSpecification clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit &quot;m&quot;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should be a separate test&lt;/p&gt;</comment>
                            <comment id="16546518" author="githubbot" created="Tue, 17 Jul 2018 12:30:28 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r203000456&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r203000456&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/test/java/org/apache/flink/yarn/FlinkYarnSessionCliTest.java &amp;#8212;&lt;br/&gt;
    @@ -352,6 +352,76 @@ public void testConfigurationClusterSpecification() throws Exception &lt;/p&gt;
{
     		assertThat(clusterSpecification.getSlotsPerTaskManager(), is(slotsPerTaskManager));
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Tests the specifying heap memory for job manager and task manager.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testHeapMemoryProperty() throws Exception {&lt;br/&gt;
    +		//without unit&lt;br/&gt;
    +		String[] args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024&quot;, &quot;-ytm&quot;, &quot;2048&quot; }
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +		FlinkYarnSessionCli flinkYarnSessionCli = new FlinkYarnSessionCli(&lt;br/&gt;
    +			new Configuration(),&lt;br/&gt;
    +			tmp.getRoot().getAbsolutePath(),&lt;br/&gt;
    +			&quot;y&quot;,&lt;br/&gt;
    +			&quot;yarn&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CommandLine commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +&lt;br/&gt;
    +		ClusterSpecification clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit &quot;m&quot;&lt;br/&gt;
    +		args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024m&quot;, &quot;-ytm&quot;, &quot;2048m&quot; }
&lt;p&gt;;&lt;br/&gt;
    +		commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +		clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit non &quot;m&quot;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should be a separate test&lt;/p&gt;</comment>
                            <comment id="16546519" author="githubbot" created="Tue, 17 Jul 2018 12:30:28 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r203000806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r203000806&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/test/java/org/apache/flink/yarn/FlinkYarnSessionCliTest.java &amp;#8212;&lt;br/&gt;
    @@ -352,6 +352,76 @@ public void testConfigurationClusterSpecification() throws Exception &lt;/p&gt;
{
     		assertThat(clusterSpecification.getSlotsPerTaskManager(), is(slotsPerTaskManager));
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Tests the specifying heap memory for job manager and task manager.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testHeapMemoryProperty() throws Exception {&lt;br/&gt;
    +		//without unit&lt;br/&gt;
    +		String[] args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024&quot;, &quot;-ytm&quot;, &quot;2048&quot; }
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +		FlinkYarnSessionCli flinkYarnSessionCli = new FlinkYarnSessionCli(&lt;br/&gt;
    +			new Configuration(),&lt;br/&gt;
    +			tmp.getRoot().getAbsolutePath(),&lt;br/&gt;
    +			&quot;y&quot;,&lt;br/&gt;
    +			&quot;yarn&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CommandLine commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +&lt;br/&gt;
    +		ClusterSpecification clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit &quot;m&quot;&lt;br/&gt;
    +		args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024m&quot;, &quot;-ytm&quot;, &quot;2048m&quot; }
&lt;p&gt;;&lt;br/&gt;
    +		commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +		clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit non &quot;m&quot;&lt;br/&gt;
    +		args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1g&quot;, &quot;-ytm&quot;, &quot;2g&quot; }
&lt;p&gt;;&lt;br/&gt;
    +		commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +		clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//specify old config key&lt;br/&gt;
    +		Configuration configuration = new Configuration();&lt;br/&gt;
    +		configuration.setInteger(JobManagerOptions.JOB_MANAGER_HEAP_MEMORY_MB, 2048);&lt;br/&gt;
    +		configuration.setInteger(TaskManagerOptions.TASK_MANAGER_HEAP_MEMORY_MB, 4096);&lt;br/&gt;
    +&lt;br/&gt;
    +		flinkYarnSessionCli = new FlinkYarnSessionCli(&lt;br/&gt;
    +			configuration,&lt;br/&gt;
    +			tmp.getRoot().getAbsolutePath(),&lt;br/&gt;
    +			&quot;y&quot;,&lt;br/&gt;
    +			&quot;yarn&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +		commandLine = flinkYarnSessionCli.parseCommandLineOptions(new String&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, false);&lt;br/&gt;
    +&lt;br/&gt;
    +		clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(2048));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(4096));&lt;br/&gt;
    +&lt;br/&gt;
    +		//set nothing use default value&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should be a separate test&lt;/p&gt;</comment>
                            <comment id="16546520" author="githubbot" created="Tue, 17 Jul 2018 12:30:28 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297#discussion_r203000672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297#discussion_r203000672&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/test/java/org/apache/flink/yarn/FlinkYarnSessionCliTest.java &amp;#8212;&lt;br/&gt;
    @@ -352,6 +352,76 @@ public void testConfigurationClusterSpecification() throws Exception &lt;/p&gt;
{
     		assertThat(clusterSpecification.getSlotsPerTaskManager(), is(slotsPerTaskManager));
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Tests the specifying heap memory for job manager and task manager.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testHeapMemoryProperty() throws Exception {&lt;br/&gt;
    +		//without unit&lt;br/&gt;
    +		String[] args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024&quot;, &quot;-ytm&quot;, &quot;2048&quot; }
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +		FlinkYarnSessionCli flinkYarnSessionCli = new FlinkYarnSessionCli(&lt;br/&gt;
    +			new Configuration(),&lt;br/&gt;
    +			tmp.getRoot().getAbsolutePath(),&lt;br/&gt;
    +			&quot;y&quot;,&lt;br/&gt;
    +			&quot;yarn&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CommandLine commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +&lt;br/&gt;
    +		ClusterSpecification clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit &quot;m&quot;&lt;br/&gt;
    +		args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1024m&quot;, &quot;-ytm&quot;, &quot;2048m&quot; }
&lt;p&gt;;&lt;br/&gt;
    +		commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +		clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//with unit non &quot;m&quot;&lt;br/&gt;
    +		args = new String[] &lt;/p&gt;
{ &quot;-yn&quot;, &quot;2&quot;, &quot;-yjm&quot;, &quot;1g&quot;, &quot;-ytm&quot;, &quot;2g&quot; }
&lt;p&gt;;&lt;br/&gt;
    +		commandLine = flinkYarnSessionCli.parseCommandLineOptions(args, false);&lt;br/&gt;
    +		clusterSpecification = flinkYarnSessionCli.getClusterSpecification(commandLine);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertThat(clusterSpecification.getMasterMemoryMB(), is(1024));&lt;br/&gt;
    +		assertThat(clusterSpecification.getTaskManagerMemoryMB(), is(2048));&lt;br/&gt;
    +&lt;br/&gt;
    +		//specify old config key&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should be a separate test&lt;/p&gt;</comment>
                            <comment id="16546755" author="githubbot" created="Tue, 17 Jul 2018 15:05:08 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    LGTM for me, Thanks for your contribution @yanghua.&lt;/p&gt;

&lt;p&gt;    @GJL would you like to have last look, or can I merge it?&lt;/p&gt;</comment>
                            <comment id="16546800" author="githubbot" created="Tue, 17 Jul 2018 15:36:45 +0000"  >&lt;p&gt;Github user GJL commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys Please merge.&lt;/p&gt;</comment>
                            <comment id="16547453" author="githubbot" created="Wed, 18 Jul 2018 06:37:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6297&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6297&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16547457" author="dawidwys" created="Wed, 18 Jul 2018 06:41:52 +0000"  >&lt;p&gt;Fixed in 1.6 via: 4095a310a39e2cbf79228e2a84eac19a61f4c9d6&lt;br/&gt;
Fixed in master via: 343614cd8e73f2d10ba5cb99759b022dd829d03f&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vnin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>