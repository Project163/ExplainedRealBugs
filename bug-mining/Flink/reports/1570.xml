<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5985] Flink treats every task as stateful (making topology changes impossible)</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5985</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It seems  that Flink treats every Task as stateful so changing the topology is not possible without setting uid on every single operator.&lt;/p&gt;

&lt;p&gt;If the topology has an iteration this is virtually impossible (or at least gets super hacky)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13048926">FLINK-5985</key>
            <summary>Flink treats every task as stateful (making topology changes impossible)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="gyfora">Gyula Fora</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Mar 2017 16:06:46 +0000</created>
                <updated>Mon, 20 Mar 2017 12:43:34 +0000</updated>
                            <resolved>Fri, 17 Mar 2017 17:17:40 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15900973" author="uce" created="Wed, 8 Mar 2017 09:35:56 +0000"  >&lt;p&gt;It should be possible to change the topology if you set the UIDs &lt;b&gt;only&lt;/b&gt; for the stateful operators, because these are the only ones that are part of the savepoint state.&lt;/p&gt;

&lt;p&gt;If you don&apos;t set any UIDs, changing the topology will result in a changed auto generated UID for the stateful operators as well. That&apos;s the situation you are describing here, right?&lt;/p&gt;</comment>
                            <comment id="15900980" author="gyfora" created="Wed, 8 Mar 2017 09:41:00 +0000"  >&lt;p&gt;It should be possible to set it for &lt;b&gt;only&lt;/b&gt; the stateful ones but it doesn work.&lt;/p&gt;</comment>
                            <comment id="15900995" author="gyfora" created="Wed, 8 Mar 2017 09:53:35 +0000"  >&lt;p&gt;even something as simple as stream.filter(event -&amp;gt; true) requires a uid. Also the iteration tasks which are impossible to assign a uid for in the API&lt;/p&gt;</comment>
                            <comment id="15901040" author="uce" created="Wed, 8 Mar 2017 10:30:21 +0000"  >&lt;p&gt;I fully agree that this whole UID business is very tricky and intransparent right now.&lt;/p&gt;

&lt;p&gt;Could you:&lt;br/&gt;
1) Post the Exception you get&lt;br/&gt;
2) Run the job before the savepoint with DEBUG logging for org.apache.flink.streaming.api.graph&lt;br/&gt;
3) Run the job with which you want to restore with DEBUG logging for org.apache.flink.streaming.api.graph?&lt;/p&gt;

&lt;p&gt;Either this is a bug or we are overlooking a stateful task that does not have a UID set. You can set a UID after the fact with 1.2 via `setUIDHash` to the String of the JobVertexID.&lt;/p&gt;</comment>
                            <comment id="15901105" author="gyfora" created="Wed, 8 Mar 2017 11:17:15 +0000"  >&lt;p&gt;Hi Ufuk,&lt;/p&gt;

&lt;p&gt;I did exactly this yesterday:&lt;/p&gt;

&lt;p&gt;First got an error like: Cannot map savepoint state for operator xxx to the new program, because the operator is not available in the new program. Then I added the debugging to see which actual operator was misbehaving.&lt;/p&gt;

&lt;p&gt;It showed a stateless map, so I was like whatever and set the uidHash(xxx) and I tried again. Now it gave the same error for a different stateless operator (lets say a filter). I kept adding the hashes for the stateless operators until I reached to the point where it complained about not being able to map back the Iteration sink, that&apos;s when I gave up.&lt;/p&gt;</comment>
                            <comment id="15901356" author="uce" created="Wed, 8 Mar 2017 14:41:23 +0000"  >&lt;p&gt;Is it possible to share the driver program (privately works as well)? I could then try to reproduce the issue with dummy data.&lt;/p&gt;
</comment>
                            <comment id="15901424" author="gyfora" created="Wed, 8 Mar 2017 15:28:34 +0000"  >&lt;p&gt;I was somehow assuming that this affects all jobs. Unfortunately I cannot send the program but I can try to reproduce it in a minimal example tomorrow. I know this used to work in 1.1 with pretty much the same job.&lt;/p&gt;</comment>
                            <comment id="15903110" author="gyfora" created="Thu, 9 Mar 2017 14:19:37 +0000"  >&lt;p&gt;You can easily reproduce the bug locally by running the following simple program:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/gyfora/b5ccf836dc9e95bab2b1f5f483cb8bf6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/gyfora/b5ccf836dc9e95bab2b1f5f483cb8bf6&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Take a savepoint and uncomment the stateless map before the sink to change the sink hash then restore.&lt;/p&gt;</comment>
                            <comment id="15904779" author="uce" created="Fri, 10 Mar 2017 09:28:43 +0000"  >&lt;p&gt;Thanks for taking the time to create the example, Gyula.&lt;/p&gt;</comment>
                            <comment id="15904869" author="uce" created="Fri, 10 Mar 2017 10:36:16 +0000"  >&lt;p&gt;Thanks again for reporting this. You are right, we accidentally changed the behaviour between 1.1 and 1.2. This is a critical issue.&lt;/p&gt;

&lt;p&gt;In 1.1 we did not serialize stateless tasks as part of the savepoint and therefore never took them into account on savepoint loading. With the recent refactorings in 1.2 we now serialize stateless tasks this as &quot;zero length state&quot;. This makes the stateless operators part of the savepoint we try to load the state back to the new job.&lt;/p&gt;

&lt;p&gt;I think there a couple of easy ways to fix this, but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefanrichter83%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;stefanrichter83@gmail.com&quot;&gt;stefanrichter83@gmail.com&lt;/a&gt; probably has the definitive answer here.&lt;/p&gt;

&lt;p&gt;I think this issue warrants a 1.2.1 release asap as users cannot change their topologies if they didn&apos;t specify a UID for each operator.&lt;/p&gt;</comment>
                            <comment id="15904895" author="srichter" created="Fri, 10 Mar 2017 10:59:57 +0000"  >&lt;p&gt;I think the proper solution is based on preventing those empty files from being written, but there must be some differentiation between stateless tasks and stateful tasks with (currently) empty state. For the later ones, the empty state indicates restores which is an exposed signal for user code.&lt;/p&gt;</comment>
                            <comment id="15907169" author="githubbot" created="Mon, 13 Mar 2017 10:58:37 +0000"  >&lt;p&gt;GitHub user StefanRRichter opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt; Report no task states for stateless tasks in checkpointing&lt;/p&gt;

&lt;p&gt;    This PR fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt;. The solution is based on acknowledging `null` instead of some empty SubtaskState to `CheckpointCoordinator#acknowledgeCheckpoint(...)`, so that no `TaskState` is registered under the `JobVertexID` of a stateless task in the checkpoint. &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StefanRRichter/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StefanRRichter/flink&lt;/a&gt; no-taskstate-for-stateless&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3523&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit af45e89d011033b98ceca455725c7f167052ec74&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-03-10T16:55:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt; Report no task states for stateless tasks in checkpointing&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15907170" author="githubbot" created="Mon, 13 Mar 2017 10:58:53 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    CC @gyfora @uce &lt;/p&gt;</comment>
                            <comment id="15907359" author="githubbot" created="Mon, 13 Mar 2017 12:25:56 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The changes look reasonable &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15907396" author="githubbot" created="Mon, 13 Mar 2017 12:48:15 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I could only try the backported version on the topology that caused the problem initally (that is running 1.2.0)&lt;/p&gt;</comment>
                            <comment id="15924182" author="githubbot" created="Tue, 14 Mar 2017 13:28:30 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @gyfora if the effort is reasonable, it would be great to try this out on your topology. As soon as you give your +1, I could merge this change &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15924255" author="githubbot" created="Tue, 14 Mar 2017 14:11:04 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Im gonna try to cherry-pick this on 1.2 and run it today&lt;/p&gt;</comment>
                            <comment id="15924256" author="githubbot" created="Tue, 14 Mar 2017 14:12:30 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Great, thanks!&lt;/p&gt;</comment>
                            <comment id="15924352" author="githubbot" created="Tue, 14 Mar 2017 14:50:33 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There seems to have been some changes in the StreamTask and some tests so I couldn&apos;t rebase this nicely. Do you have a minute to take a look and maybe push a branch with the backport please? That would help me a lot.&lt;/p&gt;</comment>
                            <comment id="15924428" author="githubbot" created="Tue, 14 Mar 2017 15:39:20 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sure, I just quickly prepared a backport here: &lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/StefanRRichter/flink/tree/FLINK-5985-backport-to-1.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StefanRRichter/flink/tree/FLINK-5985-backport-to-1.2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15924869" author="githubbot" created="Tue, 14 Mar 2017 19:40:36 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hm, doesnt seem to work for the first try. What I did is I updated the client with the new jar based on your backport branch. Redeployed the job with a savepoint (to get the new Flink version), took a savepoint and tried to redeploy with the changed topology. &lt;/p&gt;

&lt;p&gt;    I still seem to get the same error.&lt;/p&gt;

&lt;p&gt;    Is it possible that the previous checkpoints have an effect on this? In any case I will double check tomorrow morning and try to do the test again.&lt;/p&gt;</comment>
                            <comment id="15924934" author="githubbot" created="Tue, 14 Mar 2017 20:31:05 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It also doesnt seem to work starting from a clean state and then savepoint redeploy with changed topology so maybe I am really screwing up something&lt;/p&gt;</comment>
                            <comment id="15925768" author="githubbot" created="Wed, 15 Mar 2017 08:55:29 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StefanRRichter It seems to work correctly locally, I am trying to see what went wrong with my yarn tests, but this shouldnt block you&lt;/p&gt;</comment>
                            <comment id="15925773" author="githubbot" created="Wed, 15 Mar 2017 09:04:13 +0000"  >&lt;p&gt;Github user gyfora commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah, the reason is probably that I didnt change my job jar, and this relies on changes in the rocks backend&lt;/p&gt;</comment>
                            <comment id="15925776" author="githubbot" created="Wed, 15 Mar 2017 09:06:50 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ok, then the mystery is finally solved &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks again for reporting this problem and your additional testing efforts!&lt;/p&gt;</comment>
                            <comment id="15925781" author="githubbot" created="Wed, 15 Mar 2017 09:11:59 +0000"  >&lt;p&gt;Github user StefanRRichter closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3542&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15925786" author="githubbot" created="Wed, 15 Mar 2017 09:17:40 +0000"  >&lt;p&gt;GitHub user StefanRRichter opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Backport for 1.2&amp;#93;&lt;/span&gt; Report no task states for stateless tasks on checkpointing&lt;/p&gt;

&lt;p&gt;    This PR is a backport of #3523 to Flink 1.2.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StefanRRichter/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StefanRRichter/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt;-backport-to-1.2&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3543&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0eb568152583a328c8e1342c94dd6dd2068bacbb&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-03-14T15:37:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt; Report no task states for stateless tasks on checkpointing&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15925789" author="githubbot" created="Wed, 15 Mar 2017 09:22:14 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, it should still work because the changes on `RocksDBKeyedStateBackend` are purely cosmetical without changing any functionality.&lt;/p&gt;</comment>
                            <comment id="15925794" author="githubbot" created="Wed, 15 Mar 2017 09:27:19 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hm, one potential pitfall that I see is operator chaining, in case your stateless operators are chained together with stateful ones. But then again, you said it works locally?&lt;/p&gt;</comment>
                            <comment id="15926165" author="githubbot" created="Wed, 15 Mar 2017 13:21:20 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523#discussion_r106161900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523#discussion_r106161900&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/StreamTaskTest.java &amp;#8212;&lt;br/&gt;
    @@ -640,6 +640,74 @@ public SubtaskState answer(InvocationOnMock invocation) throws Throwable &lt;/p&gt;
{
     		verify(rawOperatorStateHandle).discardState();
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * This test ensures that empty snapshots (no op/keyed stated whatsoever) will be reported as stateless tasks. This&lt;br/&gt;
    +	 * happens by translating an empty &lt;/p&gt;
{@link SubtaskState}
&lt;p&gt; into reporting &apos;null&apos; to #acknowledgeCheckpoint.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testEmptySubtaskStateLeadsToStatelessAcknowledgment() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think the fact that this test requires extensive whiteboxing means we should move the whole `CheckpointOperation` to a separate class and make it work independent of `StreamTask`.&lt;/p&gt;</comment>
                            <comment id="15926172" author="githubbot" created="Wed, 15 Mar 2017 13:29:03 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good fix!&lt;/p&gt;

&lt;p&gt;    I think that verifying the possibility to reconfigure a job with respect to stateless operators warrants an ITCase. Can we extend the `SavepointITCase` for that?&lt;/p&gt;</comment>
                            <comment id="15926173" author="githubbot" created="Wed, 15 Mar 2017 13:29:12 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think that verifying the possibility to reconfigure a job with respect to stateless operators warrants an ITCase. Can we extend the `SavepointITCase` for that?&lt;/p&gt;</comment>
                            <comment id="15926295" author="githubbot" created="Wed, 15 Mar 2017 14:51:09 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523#discussion_r106185325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523#discussion_r106185325&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/StreamTaskTest.java &amp;#8212;&lt;br/&gt;
    @@ -640,6 +640,74 @@ public SubtaskState answer(InvocationOnMock invocation) throws Throwable &lt;/p&gt;
{
     		verify(rawOperatorStateHandle).discardState();
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5985&quot; title=&quot;Flink treats every task as stateful (making topology changes impossible)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5985&quot;&gt;&lt;del&gt;FLINK-5985&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * This test ensures that empty snapshots (no op/keyed stated whatsoever) will be reported as stateless tasks. This&lt;br/&gt;
    +	 * happens by translating an empty &lt;/p&gt;
{@link SubtaskState}
&lt;p&gt; into reporting &apos;null&apos; to #acknowledgeCheckpoint.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testEmptySubtaskStateLeadsToStatelessAcknowledgment() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes, we could separate the classes. `CheckpointOperation` is already a static inner class anyways. I would suggest to do this in a followup.&lt;/p&gt;</comment>
                            <comment id="15926831" author="githubbot" created="Wed, 15 Mar 2017 19:43:10 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Can we slightly adapt the test to target more the typical use case:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Original job has some stateless ops (no uid), and some stateful ones (with uid)&lt;/li&gt;
	&lt;li&gt;Create a modified job that has the same stateful ones (same uids) but different stateless ones&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Otherwise this looks good.&lt;/p&gt;</comment>
                            <comment id="15929932" author="githubbot" created="Fri, 17 Mar 2017 13:06:25 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good.&lt;/p&gt;

&lt;p&gt;    +1 for merging this!&lt;/p&gt;</comment>
                            <comment id="15930320" author="githubbot" created="Fri, 17 Mar 2017 17:13:27 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @StephanEwen. I updated the test as suggested. Merging this now.&lt;/p&gt;</comment>
                            <comment id="15930324" author="githubbot" created="Fri, 17 Mar 2017 17:16:44 +0000"  >&lt;p&gt;Github user StefanRRichter closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3523&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15930327" author="srichter" created="Fri, 17 Mar 2017 17:17:40 +0000"  >&lt;p&gt;fixed in 20fff32.&lt;/p&gt;</comment>
                            <comment id="15931916" author="aljoscha" created="Sun, 19 Mar 2017 19:56:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srichter&quot; class=&quot;user-hover&quot; rel=&quot;srichter&quot;&gt;srichter&lt;/a&gt; Did you also put this onto the release-1.2 branch? I&apos;m asking since it&apos;s marked as &quot;fixed for 1.2.1&quot;.&lt;/p&gt;</comment>
                            <comment id="15932414" author="githubbot" created="Mon, 20 Mar 2017 09:55:48 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Could you merge this @StefanRRichter? I think it is one of the last blockers for 1.2.1 and it&apos;s a pretty critical issue...&lt;/p&gt;</comment>
                            <comment id="15932420" author="githubbot" created="Mon, 20 Mar 2017 09:59:37 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, will do today.&lt;/p&gt;</comment>
                            <comment id="15932572" author="githubbot" created="Mon, 20 Mar 2017 12:43:09 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15932573" author="githubbot" created="Mon, 20 Mar 2017 12:43:34 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b27r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>