<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:23:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-38567] ForSt state backend error with GROUP BY and async state execution</title>
                <link>https://issues.apache.org/jira/browse/FLINK-38567</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;While testing the disaggregate state backend with ForSt DB I ran into the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.Exception: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; creating StreamOperatorStateContext.
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:359)
	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:280)
	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateAndGates(StreamTask.java:858)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$restoreInternal$5(StreamTask.java:812)
	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:812)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:771)
	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:963)
	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:932)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:756)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:568)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
Caused by: org.apache.flink.util.FlinkException: Could not restore keyed state backend &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncKeyedProcessOperator_dc09592d5320e3ce8d45932dc9094772_(1/1) from any of the 1 provided restore options.
	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.createAndRestore(BackendRestorerProcedure.java:165)
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.keyedStatedBackend(StreamTaskStateInitializerImpl.java:486)
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:195)
	... 12 common frames omitted
Caused by: org.apache.flink.runtime.state.BackendBuildingException: Caught unexpected exception.
	at org.apache.flink.state.forst.ForStKeyedStateBackendBuilder.build(ForStKeyedStateBackendBuilder.java:319)
	at org.apache.flink.state.forst.ForStStateBackend.createAsyncKeyedStateBackend(ForStStateBackend.java:474)
	at org.apache.flink.state.forst.ForStStateBackend.createAsyncKeyedStateBackend(ForStStateBackend.java:98)
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.lambda$keyedStatedBackend$3(StreamTaskStateInitializerImpl.java:475)
	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.attemptCreateAndRestore(BackendRestorerProcedure.java:173)
	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.createAndRestore(BackendRestorerProcedure.java:137)
	... 14 common frames omitted
Caused by: java.io.IOException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; opening ForSt instance.
	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:97)
	at org.apache.flink.state.forst.restore.ForStHandle.loadDb(ForStHandle.java:140)
	at org.apache.flink.state.forst.restore.ForStHandle.openDB(ForStHandle.java:118)
	at org.apache.flink.state.forst.restore.ForStNoneRestoreOperation.restore(ForStNoneRestoreOperation.java:64)
	at org.apache.flink.state.forst.ForStKeyedStateBackendBuilder.build(ForStKeyedStateBackendBuilder.java:261)
	... 19 common frames omitted
Caused by: org.forstdb.RocksDBException: NotFound
	at org.forstdb.RocksDB.open(Native Method)
	at org.forstdb.RocksDB.open(RocksDB.java:318)
	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:85)
	... 23 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Flink SQL query I used is a simple &lt;tt&gt;GROUP BY&lt;/tt&gt; operation:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT COUNT(page) as page_count, userid FROM user_audit GROUP BY userid;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the configuration used to reproduce this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
execution.state-recovery.from-local, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
jobmanager.adaptive-scheduler.submission.resource-stabilization-timeout, 30s
taskmanager.memory.jvm-metaspace.size, 200m
kubernetes.cluster-id, q-64dfbe96-e7e2-4991-8b95-a5906fd9b3c7
high-availability.storageDir, s3p:&lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;execution.checkpointing.savepoint-dir, s3p:&lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;metrics.internal.query-service.port, 6127
kubernetes.namespace, q-64dfbe96-e7e2-4991-8b95-a5906fd9b3c7
state.backend.forst.writebuffer.size, 4mb
metrics.reporters, prom
state.backend.forst.metrics.estimate-num-keys, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
state.backend.type, forst
table.exec.async-state.enabled, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
execution.checkpointing.mode, EXACTLY_ONCE
metrics.reporter.prom.port, 9999
taskmanager.memory.process.size, 1024m
execution.checkpointing.incremental, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
taskmanager.memory.network.fraction, 0.08
jobmanager.rpc.port, 6123
web.upload.dir, /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/run/flink-app-jar
execution.checkpointing.interval, 30000
execution.checkpointing.timeout, 60000
&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.port, 8081
s3.upload.max.concurrent.uploads, 10
restart-strategy.fixed-delay.delay, 3s
state.backend.forst.compaction.level.max-size-level-base, 8mb
taskmanager.memory.managed.fraction, 0.35
blob.server.port, 6124
state.backend.forst.compaction.level.target-file-size-base, 4mb
metrics.system-resource, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
high-availability.type, KUBERNETES
state.backend.forst.local-dir, /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/run/flink-forst-local
taskmanager.cpu.cores, 1
metrics.reporter.prom.factory.class, org.apache.flink.metrics.prometheus.PrometheusReporterFactory
state.backend.forst.writebuffer.count, 16
query.server.port, 6125
taskmanager.memory.jvm-overhead.min, 128m
s3.endpoint, s3.us-west-2.amazonaws.com
state.backend.forst.metrics.compaction-pending, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
taskmanager.data.port, 6121
taskmanager.numberOfTaskSlots, 1
execution.checkpointing.dir, s3p:&lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;taskmanager.memory.network.min, 0m
restart-strategy.fixed-delay.attempts, 10
jobmanager.memory.process.size, 1024m
taskmanager.rpc.port, 6122
table.exec.mini-batch.enabled, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
jobmanager.scheduler, Adaptive
high-availability, org.apache.flink.kubernetes.highavailability.KubernetesHaServicesFactory
table.optimizer.agg-phase-strategy, ONE_PHASE
restart-strategy, fixed-delay
execution.checkpointing.snapshot-compression, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
state.backend.forst.metrics.num-running-compactions, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
s3.path.style.access, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on &lt;a href=&quot;https://nightlies.apache.org/flink/flink-docs-master/docs/ops/state/disaggregated_state/#for-sql-jobs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;documentation&lt;/a&gt;, a non-distinct aggregation should already be supported for asynchronous state access, and it seems like I&apos;ve ran into a bug with the async disaggregated state. I haven&apos;t tested any of the other operators, e.g. windowing, but I confirmed that a simple projection works just fine with the same configuration.&lt;/p&gt;

&lt;p&gt;If the &lt;tt&gt;table.exec.async-state.enabled&lt;/tt&gt; config is set to &lt;tt&gt;false&lt;/tt&gt;, the jobs are able to make progress.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13632474">FLINK-38567</key>
            <summary>ForSt state backend error with GROUP BY and async state execution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="AlexYinHan">Han Yin</assignee>
                                    <reporter username="morezaei00">Mohsen Rezaei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 26 Oct 2025 03:56:10 +0000</created>
                <updated>Tue, 11 Nov 2025 11:09:32 +0000</updated>
                            <resolved>Wed, 5 Nov 2025 09:39:44 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="18033765" author="JIRAUSER305300" created="Wed, 29 Oct 2025 08:32:22 +0000"  >&lt;p&gt;I&apos;m running into a potentially similar issue using the DataStream API. The full exception is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; opening ForSt instance.	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:97) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStHandle.loadDb(ForStHandle.java:140) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStHandle.openDB(ForStHandle.java:118) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStNoneRestoreOperation.restore(ForStNoneRestoreOperation.java:64) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStKeyedStateBackendBuilder.build(ForStKeyedStateBackendBuilder.java:261) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStStateBackend.createAsyncKeyedStateBackend(ForStStateBackend.java:474) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStStateBackend.createAsyncKeyedStateBackend(ForStStateBackend.java:98) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.lambda$keyedStatedBackend$3(StreamTaskStateInitializerImpl.java:475) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.attemptCreateAndRestore(BackendRestorerProcedure.java:173) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.createAndRestore(BackendRestorerProcedure.java:137) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.keyedStatedBackend(StreamTaskStateInitializerImpl.java:486) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:195) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:280) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateAndGates(StreamTask.java:858) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$restoreInternal$5(StreamTask.java:812) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:812) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:771) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:963) [flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:932) [flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:756) [flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:568) [flink-dist-2.1.0.jar:2.1.0]	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) [?:?]Caused by: org.forstdb.RocksDBException: NotFound	at org.forstdb.RocksDB.open(Native Method) ~[flink-dist-2.1.0.jar:2.1.0]	at org.forstdb.RocksDB.open(RocksDB.java:318) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:85) ~[flink-dist-2.1.0.jar:2.1.0]	... 23 more2025-10-29 08:30:43,965 WARN  org.apache.flink.streaming.api.operators.BackendRestorerProcedure [] - Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; restoring keyed state backend &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AsyncKeyedCoProcessOperator_84984c1fa2897a7a40e728e4e87e1da9_(1/1) from alternative (1/1), will retry &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; more alternatives are available.org.apache.flink.runtime.state.BackendBuildingException: Caught unexpected exception.	at org.apache.flink.state.forst.ForStKeyedStateBackendBuilder.build(ForStKeyedStateBackendBuilder.java:319) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStStateBackend.createAsyncKeyedStateBackend(ForStStateBackend.java:474) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStStateBackend.createAsyncKeyedStateBackend(ForStStateBackend.java:98) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.lambda$keyedStatedBackend$3(StreamTaskStateInitializerImpl.java:475) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.attemptCreateAndRestore(BackendRestorerProcedure.java:173) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.createAndRestore(BackendRestorerProcedure.java:137) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.keyedStatedBackend(StreamTaskStateInitializerImpl.java:486) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:195) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:280) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateAndGates(StreamTask.java:858) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$restoreInternal$5(StreamTask.java:812) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:812) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:771) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:963) [flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:932) [flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:756) [flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:568) [flink-dist-2.1.0.jar:2.1.0]	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) [?:?]Caused by: java.io.IOException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; opening ForSt instance.	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:97) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStHandle.loadDb(ForStHandle.java:140) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStHandle.openDB(ForStHandle.java:118) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStNoneRestoreOperation.restore(ForStNoneRestoreOperation.java:64) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStKeyedStateBackendBuilder.build(ForStKeyedStateBackendBuilder.java:261) ~[flink-dist-2.1.0.jar:2.1.0]	... 19 moreCaused by: org.forstdb.RocksDBException: NotFound	at org.forstdb.RocksDB.open(Native Method) ~[flink-dist-2.1.0.jar:2.1.0]	at org.forstdb.RocksDB.open(RocksDB.java:318) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:85) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStHandle.loadDb(ForStHandle.java:140) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStHandle.openDB(ForStHandle.java:118) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.restore.ForStNoneRestoreOperation.restore(ForStNoneRestoreOperation.java:64) ~[flink-dist-2.1.0.jar:2.1.0]	at org.apache.flink.state.forst.ForStKeyedStateBackendBuilder.build(ForStKeyedStateBackendBuilder.java:261) ~[flink-dist-2.1.0.jar:2.1.0]	... 19 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m seeing this when using the Presto S3 filesystem plugin and starting a job without an existing state store.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve only seen this issue when using the Presto S3 FS. Using the Hadoop S3 FS seems to work.&lt;/p&gt;</comment>
                            <comment id="18034326" author="zakelly" created="Fri, 31 Oct 2025 06:45:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=morezaei00&quot; class=&quot;user-hover&quot; rel=&quot;morezaei00&quot;&gt;morezaei00&lt;/a&gt; Thanks for reporting this!&lt;/p&gt;

&lt;p&gt;From the description you provide, I suspect this error is thrown when the ForSt native core is invoking Flink&apos;s filesystem to initialize the primary directory. Unfortunately, the deeper error stack was swallowed by the cross-language call. I&apos;m trying to investigate this.&lt;/p&gt;</comment>
                            <comment id="18034330" author="zakelly" created="Fri, 31 Oct 2025 07:00:55 +0000"  >&lt;p&gt;One thing I would like to make sure about your setup. How would you enable the Presto S3 filesystem plugin?&lt;/p&gt;</comment>
                            <comment id="18034342" author="zakelly" created="Fri, 31 Oct 2025 08:37:05 +0000"  >&lt;p&gt;And it would be nice if you could provide more log around the exception.&lt;/p&gt;</comment>
                            <comment id="18034349" author="JIRAUSER305300" created="Fri, 31 Oct 2025 08:54:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt; I&apos;m running a deploying using version 1.13 of the K8s operator. I&apos;m installing Presto by copying it from the base docker image.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FROM flink:2.1.0-java17
# Enable the Presto S3 filesystem plugin
RUN mkdir -p /opt/flink/plugins/flink-s3-fs-presto &amp;amp;&amp;amp; \
&#160; &#160; cp /opt/flink/opt/flink-s3-fs-presto-*.jar /opt/flink/plugins/flink-s3-fs-presto/
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In my Flink configuration I&apos;m using s3p:// URLs&#160;&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
high-availability:
  type: kubernetes
  storageDir: &lt;span class=&quot;code-quote&quot;&gt;&quot;s3p:&lt;span class=&quot;code-comment&quot;&gt;//{{ .Values.state.bucketName }}/ha&quot;&lt;/span&gt;
&lt;/span&gt;
....
execution:
  state-recovery.claim-mode: CLAIM
  checkpointing:
    dir: &lt;span class=&quot;code-quote&quot;&gt;&quot;s3p:&lt;span class=&quot;code-comment&quot;&gt;//{{ .Values.state.bucketName }}/checkpoints&quot;&lt;/span&gt;
&lt;/span&gt;    savepoint-dir: &lt;span class=&quot;code-quote&quot;&gt;&quot;s3p:&lt;span class=&quot;code-comment&quot;&gt;//{{ .Values.state.bucketName }}/savepoints&quot;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m not doing anything else Presto related.&lt;/p&gt;</comment>
                            <comment id="18034360" author="pnowojski" created="Fri, 31 Oct 2025 09:26:54 +0000"  >&lt;p&gt;I have seen the same issue also using s3 Presto, that is setup the same way &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=faltomare&quot; class=&quot;user-hover&quot; rel=&quot;faltomare&quot;&gt;faltomare&lt;/a&gt; reported.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;And it would be nice if you could provide more log around the exception.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There is not much. Task attempts to initialise, all normal log entries that you would expect during initialisation and then this &lt;tt&gt;NotFound&lt;/tt&gt; is thrown (Flink 2.0.x)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.flink.runtime.state.BackendBuildingException: Caught unexpected exception.
	at org.apache.flink.state.forst.sync.ForStSyncKeyedStateBackendBuilder.build(ForStSyncKeyedStateBackendBuilder.java:386)
	at org.apache.flink.state.forst.ForStStateBackend.createKeyedStateBackend(ForStStateBackend.java:555)
	at org.apache.flink.state.forst.ForStStateBackend.createKeyedStateBackend(ForStStateBackend.java:97)
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.lambda$keyedStatedBackend$3(StreamTaskStateInitializerImpl.java:478)
	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.attemptCreateAndRestore(BackendRestorerProcedure.java:173)
	at org.apache.flink.streaming.api.operators.BackendRestorerProcedure.createAndRestore(BackendRestorerProcedure.java:137)
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.keyedStatedBackend(StreamTaskStateInitializerImpl.java:489)
	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:220)
	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:284)
	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:120)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateAndGates(StreamTask.java:882)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$restoreInternal$5(StreamTask.java:834)
	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:834)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:785)
	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:1069)
	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:1031)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:846)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:654)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.io.IOException: Error while opening ForSt instance.
	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:97)
	at org.apache.flink.state.forst.restore.ForStHandle.loadDb(ForStHandle.java:115)
	at org.apache.flink.state.forst.restore.ForStHandle.openDB(ForStHandle.java:93)
	at org.apache.flink.state.forst.restore.ForStNoneRestoreOperation.restore(ForStNoneRestoreOperation.java:64)
	at org.apache.flink.state.forst.sync.ForStSyncKeyedStateBackendBuilder.build(ForStSyncKeyedStateBackendBuilder.java:309)
	... 19 more
Caused by: org.forstdb.RocksDBException: NotFound
	at org.forstdb.RocksDB.open(Native Method)
	at org.forstdb.RocksDB.open(RocksDB.java:318)
	at org.apache.flink.state.forst.ForStOperationUtils.openDB(ForStOperationUtils.java:85)
	... 23 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="18034362" author="JIRAUSER305300" created="Fri, 31 Oct 2025 09:31:55 +0000"  >&lt;p&gt;I&apos;ve seen the same thing. There is nothing in the logs before outside of normal task initiation.&#160;&lt;/p&gt;</comment>
                            <comment id="18034367" author="zakelly" created="Fri, 31 Oct 2025 10:09:14 +0000"  >&lt;p&gt;Thanks for the information. I&apos;m trying to reproduce it locally.&lt;/p&gt;</comment>
                            <comment id="18034946" author="zakelly" created="Mon, 3 Nov 2025 04:19:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=faltomare&quot; class=&quot;user-hover&quot; rel=&quot;faltomare&quot;&gt;faltomare&lt;/a&gt; I managed to reproduce the issue and did some debugging. I found that Presto&#8217;s filesystem implementation is incomplete and not fully POSIX-compliant (&lt;a href=&quot;https://github.com/prestodb/presto/blob/4a60975074b3d2351bca9cfcad064e9c1654d08b/presto-hive/src/main/java/com/facebook/presto/hive/s3/PrestoS3FileSystem.java#L554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/prestodb/presto/blob/4a60975074b3d2351bca9cfcad064e9c1654d08b/presto-hive/src/main/java/com/facebook/presto/hive/s3/PrestoS3FileSystem.java#L554&lt;/a&gt;). The main problem lies in PrestoS3FileSystem.mkdir, which currently does nothing and simply returns true without actually creating the directory. This causes issues for RocksDB/ForSt as the initialization expects directories to be properly created and then verified via existence checks.&lt;/p&gt;

&lt;p&gt;As a workaround, I plan to implement a temporary fix in ForStStateBackend by wrapping the filesystem to track paths that are created. The existence check will return the correct result even for empty directories.&lt;/p&gt;</comment>
                            <comment id="18035011" author="pnowojski" created="Mon, 3 Nov 2025 10:15:18 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt; for the investigation. I&apos;m looking forward to test the hotfix!&lt;/p&gt;</comment>
                            <comment id="18035336" author="JIRAUSER305300" created="Tue, 4 Nov 2025 13:23:05 +0000"  >&lt;p&gt;Thank you very much for the update&lt;/p&gt;</comment>
                            <comment id="18035544" author="zakelly" created="Wed, 5 Nov 2025 09:39:32 +0000"  >&lt;p&gt;Merge 4989549 into master&lt;/p&gt;</comment>
                            <comment id="18037401" author="zakelly" created="Tue, 11 Nov 2025 11:09:18 +0000"  >&lt;p&gt;Backport 952e630 into 2.1;  263cf4e into 2.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 hours ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1yaxs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>