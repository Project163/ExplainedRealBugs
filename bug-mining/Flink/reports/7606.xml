<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-36125] File not found exception on restoring state handles with file merging</title>
                <link>https://issues.apache.org/jira/browse/FLINK-36125</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;1.20 app with file merging with across checkpoints option enabled.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;execution.checkpointing.file-merging.enabled&lt;/b&gt;: true&lt;/p&gt;

&lt;p&gt;&lt;b&gt;execution.checkpointing.file-merging.across-checkpoint-boundary&lt;/b&gt;: true&lt;/p&gt;

&lt;p&gt;App uses Zookeeper for HA and S3 for HDFS with RocksDB state backend.&lt;/p&gt;

&lt;p&gt;Summary of events:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;App started to fail and restarted due to Zookeeper connection failure&lt;/li&gt;
	&lt;li&gt;It tried to use the previous directory with the log below while restoring&lt;/li&gt;
	&lt;li&gt;&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Reusing previous directory s3:.../taskowned/job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.195.1-6122-34e093 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpoint file-merging. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;FileMergingSnapshotManager could not find the checkpoint file under `taskowned` directory and the app started to failover.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.FileNotFoundException: No such file or directory: s3:.../taskowned/job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.196.233-6122-acb0af/5ce4c69f-f02a-4f91-a656-9abdfa9d47fd	at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.lambda$restoreStateHandles$11(FileMergingSnapshotManagerBase.java:880)	at java.base/java.util.HashMap.computeIfAbsent(HashMap.java:1134)	at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.lambda$restoreStateHandles$12(FileMergingSnapshotManagerBase.java:861)	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)	at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:195)	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:177)	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)	at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:177)	at java.base/java.util.stream.Streams$StreamBuilderImpl.forEachRemaining(Streams.java:411)	at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:658)	at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:274)	at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)	at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:274)	at java.base/java.util.ArrayList$Itr.forEachRemaining(ArrayList.java:1033)	at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)	at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:734)	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)	at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:274)	at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)	at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.restoreStateHandles(FileMergingSnapshotManagerBase.java:858)	at org.apache.flink.runtime.checkpoint.filemerging.SubtaskFileMergingManagerRestoreOperation.restore(SubtaskFileMergingManagerRestoreOperation.java:102)	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.registerRestoredStateToFileMergingManager(StreamTaskStateInitializerImpl.java:353)	at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:163)	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:275)	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106)	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateAndGates(StreamTask.java:858)	at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$restoreInternal$5(StreamTask.java:812)	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55)	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:812)	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:771)	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:972)	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:941)	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:765)	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:577)	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)Caused by: java.io.FileNotFoundException: No such file or directory: s3:&lt;span class=&quot;code-comment&quot;&gt;//0825968657d315d337418c6a010371c3320d5792/6676b9fb581c449ea78d95efdd338ee1-021367244083-1724062514899/checkpoints/6676b9fb581c449ea78d95efdd338ee1/taskowned/job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.196.233-6122-acb0af/5ce4c69f-f02a-4f91-a656-9abdfa9d47fd	at org.apache.hadoop.fs.s3a.S3AFileSystem.s3GetFileStatus(S3AFileSystem.java:3866)	at org.apache.hadoop.fs.s3a.S3AFileSystem.innerGetFileStatus(S3AFileSystem.java:3688)	at org.apache.hadoop.fs.s3a.S3AFileSystem.lambda$getFileStatus$24(S3AFileSystem.java:3556)	at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.lambda$trackDurationOfOperation$5(IOStatisticsBinding.java:499)	at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.trackDuration(IOStatisticsBinding.java:444)	at org.apache.hadoop.fs.s3a.S3AFileSystem.trackDurationAndSpan(S3AFileSystem.java:2337)	at org.apache.hadoop.fs.s3a.S3AFileSystem.trackDurationAndSpan(S3AFileSystem.java:2356)	at org.apache.hadoop.fs.s3a.S3AFileSystem.getFileStatus(S3AFileSystem.java:3554)	at org.apache.flink.fs.s3hadoop.common.HadoopFileSystem.getFileStatus(HadoopFileSystem.java:85)	at org.apache.flink.core.fs.PluginFileSystemFactory$ClassLoaderFixingFileSystem.getFileStatus(PluginFileSystemFactory.java:105)	at org.apache.flink.core.fs.SafetyNetWrapperFileSystem.getFileStatus(SafetyNetWrapperFileSystem.java:65)	at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.getFileSize(FileMergingSnapshotManagerBase.java:910)	at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.lambda$restoreStateHandles$11(FileMergingSnapshotManagerBase.java:878) &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13589604">FLINK-36125</key>
            <summary>File not found exception on restoring state handles with file merging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zakelly">Zakelly Lan</assignee>
                                    <reporter username="burakoz">Burak Ozakinci</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 21 Aug 2024 13:11:08 +0000</created>
                <updated>Fri, 12 Sep 2025 07:20:22 +0000</updated>
                            <resolved>Fri, 12 Sep 2025 03:14:20 +0000</resolved>
                                    <version>1.20.0</version>
                                    <fixVersion>1.20.1</fixVersion>
                    <fixVersion>2.0-preview</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17875488" author="zakelly" created="Wed, 21 Aug 2024 13:30:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=burakoz&quot; class=&quot;user-hover&quot; rel=&quot;burakoz&quot;&gt;burakoz&lt;/a&gt; Thanks for reporting this! Actually the log &apos;Reusing previous directory&apos; is misleading. It happens when several tasks run within one task-manager.&lt;/p&gt;

&lt;p&gt;Would you please provide taskmanager log before the ZK connection failure? And could you check if the directory &apos;s3://0825968657d315d337418c6a010371c3320d5792/6676b9fb581c449ea78d95efdd338ee1-021367244083-1724062514899/checkpoints/6676b9fb581c449ea78d95efdd338ee1/taskowned/&lt;b&gt;job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.196.233-6122-acb0af&lt;/b&gt;&apos; exist or not?&lt;/p&gt;</comment>
                            <comment id="17875516" author="JIRAUSER303336" created="Wed, 21 Aug 2024 14:34:19 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt;, thanks for rapid response.&lt;/p&gt;

&lt;p&gt;There is not many interesting logs before the issue actually. The sequence is like:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Triggering checkpoint 4694 (type=CheckpointType{name=&lt;span class=&quot;code-quote&quot;&gt;&apos;Checkpoint&apos;&lt;/span&gt;, sharingFilesStrategy=FORWARD_BACKWARD}) @ 1724110749502 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 6676b9fb581c449ea78d95efdd338ee1. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Committing ../chk-4694/_metadata with MPU ID &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Reported span: SimpleSpan{scope=org.apache.flink.runtime.checkpoint.CheckpointStatsTracker, name=Checkpoint, startTsMillis=1724110749502, endTsMillis=1724110753198, attributes={jobId=6676b9fb581c449ea78d95efdd338ee1, checkpointId=4694, checkpointStatus=COMPLETED, fullSize=364882338, checkpointedSize=151129380}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Completed checkpoint 4694 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 6676b9fb581c449ea78d95efdd338ee1 (364882338 
bytes, checkpointDuration=3931 ms, finalizationTime=286 ms). &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And then ZK connection suspends with&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Session
 0x1008e9071d30003 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; server zk-cs/123.12.123.12:1212, Closing socket 
connection. Attempting reconnect except it is a SessionExpiredException.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is likely that this file is deleted at some point.&lt;/p&gt;

&lt;p&gt;The file does not exist in the directory.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17875713" author="zakelly" created="Thu, 22 Aug 2024 02:26:39 +0000"  >&lt;p&gt;&amp;gt; The file does not exist in the directory.&lt;br/&gt;
So the specific file &quot;5ce4c69f-f02a-4f91-a656-9abdfa9d47fd&quot; does not exist, but the parent directory &quot;job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.196.233-6122-acb0af&quot; does exist, right? &lt;/p&gt;</comment>
                            <comment id="17875801" author="JIRAUSER303336" created="Thu, 22 Aug 2024 10:31:00 +0000"  >&lt;p&gt;&amp;gt; So the specific file &quot;5ce4c69f-f02a-4f91-a656-9abdfa9d47fd&quot; does not exist, but the parent directory &quot;job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.196.233-6122-acb0af&quot; does exist, right?&#160;&lt;/p&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;p&gt;The file&#160; ,5ce4c69f-f02a-4f91-a656-9abdfa9d47fd, does not exist.&lt;/p&gt;

&lt;p&gt;The parent, job_6676b9fb581c449ea78d95efdd338ee1_tm_10.99.196.233-6122-acb0af exists as an empty directory.&lt;/p&gt;</comment>
                            <comment id="17875833" author="zakelly" created="Thu, 22 Aug 2024 12:25:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=burakoz&quot; class=&quot;user-hover&quot; rel=&quot;burakoz&quot;&gt;burakoz&lt;/a&gt; Thanks for the information! It helps a lot.&lt;/p&gt;

&lt;p&gt;After reading through the related code, I do notice there might be a rare concurrency issue that may cause wrong deletion of files from previous checkpoint. A fix PR is submit. It only affects the file-merging with across checkpoints option enabled. I&apos;m not sure if this is the root cause of the issue you are facing, and I&apos;m trying to reproduce it.&lt;/p&gt;</comment>
                            <comment id="17878785" author="zakelly" created="Tue, 3 Sep 2024 09:25:12 +0000"  >&lt;p&gt;The concurrency issue merged into master via: 2c16d884abdd2f33b86cb313775fbc0cc158a4be&lt;br/&gt;
1.20 via: b234229ca1a03f3c0c8b5176d267415309371cb4&lt;/p&gt;


&lt;p&gt;Feel free to reopen this if there&apos;s still a problem.&lt;/p&gt;</comment>
                            <comment id="18012476" author="JIRAUSER301498" created="Thu, 7 Aug 2025 05:58:18 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am afraid the problem still persist.&lt;br/&gt;
My setup:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Flink 2.1.0&lt;/li&gt;
	&lt;li&gt;Flink Operator 1.12.1&lt;/li&gt;
	&lt;li&gt;Kubernets HA enabled backed with S3&lt;/li&gt;
	&lt;li&gt;execution.checkpointing.file-merging.enabled: &quot;true&quot;&lt;/li&gt;
	&lt;li&gt;execution.checkpointing.snapshot-compression: &quot;true&quot;&lt;/li&gt;
	&lt;li&gt;execution.checkpointing.file-merging.across-checkpoint-boundary: &quot;false&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;What happened:&lt;/p&gt;

&lt;p&gt;1. Checkpoint was triggered and reported as completed&lt;/p&gt;

&lt;p&gt;2025-08-06 19:21:12,271 INFO &#160;org.apache.flink.runtime.checkpoint.CheckpointCoordinator &#160; &#160;[] - Triggering checkpoint 99272 (type=CheckpointType{name=&apos;Checkpoint&apos;, sharingFilesStrategy=FORWARD_BACKWARD}) @ 1754508072261 for job d6212bf4789bc8482aa3ff20d9329d5e.&lt;/p&gt;

&lt;p&gt;2025-08-06 19:26:30,382 INFO &#160;org.apache.flink.runtime.checkpoint.CheckpointCoordinator &#160; &#160;[] - Completed checkpoint 99272 for job d6212bf4789bc8482aa3ff20d9329d5e (24665280477 bytes, checkpointDuration=317745 ms, finalizationTime=376 ms).&lt;/p&gt;

&lt;p&gt;2. Immedietly after connection to TM had failed&lt;/p&gt;

&lt;p&gt;2025-08-06 19:26:33,432 WARN &#160;org.apache.pekko.remote.ReliableDeliverySupervisor &#160; &#160; &#160; &#160; &#160; [] - Association with remote system &lt;span class=&quot;error&quot;&gt;&amp;#91;pekko.tcp://flink@10.131.44.202:6122&amp;#93;&lt;/span&gt; has failed, address is now gated for &lt;span class=&quot;error&quot;&gt;&amp;#91;50&amp;#93;&lt;/span&gt; ms. Reason: &lt;span class=&quot;error&quot;&gt;&amp;#91;Disassociated&amp;#93;&lt;/span&gt;&#160;&lt;/p&gt;

&lt;p&gt;2025-08-06 19:26:33,433 WARN &#160;org.apache.pekko.remote.ReliableDeliverySupervisor &#160; &#160; &#160; &#160; &#160; [] - Association with remote system &lt;span class=&quot;error&quot;&gt;&amp;#91;pekko.tcp://flink-metrics@10.131.44.202:34173&amp;#93;&lt;/span&gt; has failed, address is now gated for &lt;span class=&quot;error&quot;&gt;&amp;#91;50&amp;#93;&lt;/span&gt; ms. Reason: &lt;span class=&quot;error&quot;&gt;&amp;#91;Disassociated&amp;#93;&lt;/span&gt;&#160;&#160; &#160;&#160;&lt;/p&gt;

&lt;p&gt;org.apache.flink.runtime.io.network.netty.exception.RemoteTransportException: Lost connection to task manager &apos;10.131.44.202/10.131.44.202:37715 [ taskmanager-1-1 ] &apos;. This indicates that the remote task manager was lost.&lt;/p&gt;

&lt;p&gt;2025-08-06 21:26:33.614 Caused by: org.apache.flink.shaded.netty4.io.netty.channel.unix.Errors$NativeIoException: recvAddress(..) failed: Connection reset by peer&lt;/p&gt;

&lt;p&gt;3. Job fails during recovery&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-08-06 21:33:11.026 java.lang.RuntimeException: java.io.FileNotFoundException: File does not exist: s3p:&lt;span class=&quot;code-comment&quot;&gt;//bucket/checkpoints/d6212bf4789bc8482aa3ff20d9329d5e/shared/job_d6212bf4789bc8482aa3ff20d9329d5e_op_b593a9bbf97dc8936e86835227736403_8_24/a5e5f149-86a1-491a-b8e9-c28edf51ea8e2025-08-06 21:33:11.026
&lt;/span&gt;    at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.lambda$restoreStateHandles$11(FileMergingSnapshotManagerBase.java:880) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at java.base/java.util.HashMap.computeIfAbsent(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.lambda$restoreStateHandles$12(FileMergingSnapshotManagerBase.java:861) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$3$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$2$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$2$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$3$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.copyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.evaluate(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline.forEach(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$7$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.copyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.evaluate(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline.forEach(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$7$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.ArrayList$Itr.forEachRemaining(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.Spliterators$IteratorSpliterator.forEachRemaining(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.copyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.evaluate(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline.forEach(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline$7$1.accept(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.copyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.AbstractPipeline.evaluate(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at java.base/java.util.stream.ReferencePipeline.forEach(Unknown Source) ~[?:?]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.restoreStateHandles(FileMergingSnapshotManagerBase.java:858) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.checkpoint.filemerging.SubtaskFileMergingManagerRestoreOperation.restore(SubtaskFileMergingManagerRestoreOperation.java:102) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.registerRestoredStateToFileMergingManager(StreamTaskStateInitializerImpl.java:382) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.api.operators.StreamTaskStateInitializerImpl.streamOperatorStateContext(StreamTaskStateInitializerImpl.java:165) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:280) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateAndGates(StreamTask.java:858) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$restoreInternal$5(StreamTask.java:812) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:812) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:771) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:963) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:932) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:756) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:568) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) [?:?]2025-08-06 21:33:11.026
Caused by: java.io.FileNotFoundException: File does not exist: s3p:&lt;span class=&quot;code-comment&quot;&gt;//bucket/checkpoints/d6212bf4789bc8482aa3ff20d9329d5e/shared/job_d6212bf4789bc8482aa3ff20d9329d5e_op_b593a9bbf97dc8936e86835227736403_8_24/a5e5f149-86a1-491a-b8e9-c28edf51ea8e2025-08-06 21:33:11.026
&lt;/span&gt;    at com.facebook.presto.hive.s3.PrestoS3FileSystem.getFileStatus(PrestoS3FileSystem.java:361) ~[?:?]2025-08-06 21:33:11.026
    at org.apache.flink.fs.s3presto.common.HadoopFileSystem.getFileStatus(HadoopFileSystem.java:88) ~[?:?]2025-08-06 21:33:11.026
    at org.apache.flink.core.fs.PluginFileSystemFactory$ClassLoaderFixingFileSystem.getFileStatus(PluginFileSystemFactory.java:106) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.core.fs.SafetyNetWrapperFileSystem.getFileStatus(SafetyNetWrapperFileSystem.java:78) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.getFileSize(FileMergingSnapshotManagerBase.java:910) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026
    at org.apache.flink.runtime.checkpoint.filemerging.FileMergingSnapshotManagerBase.lambda$restoreStateHandles$11(FileMergingSnapshotManagerBase.java:878) ~[flink-dist-2.1.0.jar:2.1.0]2025-08-06 21:33:11.026  ... 59 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="18012500" author="zakelly" created="Thu, 7 Aug 2025 08:00:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gliter&quot; class=&quot;user-hover&quot; rel=&quot;gliter&quot;&gt;gliter&lt;/a&gt; Thanks for reporting, I reopen this ticket, investigating....&lt;/p&gt;</comment>
                            <comment id="18012524" author="JIRAUSER301498" created="Thu, 7 Aug 2025 08:53:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt; is my assumption correct that this could be caused by file merging process?&#160;&lt;/p&gt;</comment>
                            <comment id="18012533" author="zakelly" created="Thu, 7 Aug 2025 09:41:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gliter&quot; class=&quot;user-hover&quot; rel=&quot;gliter&quot;&gt;gliter&lt;/a&gt; I guess that might be true, since this feature is experimental &amp;amp; still under evaluation.&lt;/p&gt;
</comment>
                            <comment id="18012540" author="zakelly" created="Thu, 7 Aug 2025 10:19:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gliter&quot; class=&quot;user-hover&quot; rel=&quot;gliter&quot;&gt;gliter&lt;/a&gt; I feel there&apos;s might be an issue when checkpoint abort. Would you please check the JM log and see if there is a message about checkpoint abortion, thanks.&lt;/p&gt;</comment>
                            <comment id="18012558" author="JIRAUSER301498" created="Thu, 7 Aug 2025 11:41:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt; The checkpoint was completed successfully&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-08-06 19:26:30,382 INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator [] - Completed checkpoint 99272 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job d6212bf4789bc8482aa3ff20d9329d5e (24665280477 bytes, checkpointDuration=317745 ms, finalizationTime=376 ms).&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;br/&gt;
but 3 seconds after it lost connection with TM&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-08-06 19:26:33,432 WARN &#160;org.apache.pekko.remote.ReliableDeliverySupervisor &#160; &#160; &#160; &#160; &#160; [] - Association with remote system [pekko.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@10.131.44.202:6122] has failed, address is now gated &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [50] ms. Reason: [Disassociated]&#160;&#160;
&lt;/span&gt;2025-08-06 19:26:33,433 WARN &#160;org.apache.pekko.remote.ReliableDeliverySupervisor &#160; &#160; &#160; &#160; &#160; [] - Association with remote system [pekko.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink-metrics@10.131.44.202:34173] has failed, address is now gated &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [50] ms. Reason: [Disassociated]&#160;
&lt;/span&gt;org.apache.flink.runtime.io.network.netty.exception.RemoteTransportException: Lost connection to task manager &lt;span class=&quot;code-quote&quot;&gt;&apos;10.131.44.202/10.131.44.202:37715 [ taskmanager-1-1 ] &apos;&lt;/span&gt;. This indicates that the remote task manager was lost.
...
Caused by: org.apache.flink.shaded.netty4.io.netty.channel.unix.Errors$NativeIoException: recvAddress(..) failed: Connection reset by peer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;br/&gt;
After that it went to restarting entire job and be stuck in the loop due to this broken checkpoint.&lt;br/&gt;
&#160;&lt;br/&gt;
On the TM side there are similar connection issue, looks like random network fail&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2025-08-06 19:26:33,423 ERROR org.apache.flink.runtime.io.network.netty.PartitionRequestQueue [] - Encountered error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; consuming partitions (connection to /10.131.44.202:46824)
2025-08-06 19:26:33.424 &#160; &#160;org.apache.flink.shaded.netty4.io.netty.channel.unix.Errors$NativeIoException: recvAddress(..) failed: Connection reset by peer&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="18019514" author="zakelly" created="Thu, 11 Sep 2025 07:18:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gliter&quot; class=&quot;user-hover&quot; rel=&quot;gliter&quot;&gt;gliter&lt;/a&gt; I think &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-38347&quot; title=&quot;Checkpoint file-merging manager may delete the directory unexpectedly when some RPC messages lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-38347&quot;&gt;&lt;del&gt;FLINK-38347&lt;/del&gt;&lt;/a&gt; is the root cause, since there is a connection lost in your case.&lt;/p&gt;</comment>
                            <comment id="18019756" author="zakelly" created="Fri, 12 Sep 2025 03:14:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-38347&quot; title=&quot;Checkpoint file-merging manager may delete the directory unexpectedly when some RPC messages lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-38347&quot;&gt;&lt;del&gt;FLINK-38347&lt;/del&gt;&lt;/a&gt; has merged and backported, so I close this ticket.&lt;/p&gt;</comment>
                            <comment id="18019783" author="JIRAUSER301498" created="Fri, 12 Sep 2025 07:20:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt; thank you.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13628634">FLINK-38347</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13071018" name="app_code.txt" size="1117" author="burakoz" created="Wed, 21 Aug 2024 13:15:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qzog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>