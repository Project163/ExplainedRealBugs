<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9243] SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure is unstable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9243</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;There are some instances:&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/370121126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/370121126&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/370022111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/370022111&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/370055803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/370055803&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13154682">FLINK-9243</key>
            <summary>SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure is unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="sihuazhou">Sihua Zhou</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 24 Apr 2018 03:19:16 +0000</created>
                <updated>Wed, 2 Oct 2019 17:47:49 +0000</updated>
                            <resolved>Wed, 25 Apr 2018 21:53:43 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Runtime / Network</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16452051" author="sihuazhou" created="Wed, 25 Apr 2018 10:55:11 +0000"  >&lt;p&gt;one more: &lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/370525366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/370525366&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16452091" author="zentol" created="Wed, 25 Apr 2018 11:39:11 +0000"  >&lt;p&gt;This happens very frequently lately. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=NicoK&quot; class=&quot;user-hover&quot; rel=&quot;NicoK&quot;&gt;NicoK&lt;/a&gt; I saw that you reduced the # of buffers while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9076&quot; title=&quot;Make credit-based floating buffers optional&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9076&quot;&gt;&lt;del&gt;FLINK-9076&lt;/del&gt;&lt;/a&gt;. Did you do this since you saw this kind of failures? Maybe we can just reduce it even further...&lt;/p&gt;</comment>
                            <comment id="16452094" author="sihuazhou" created="Wed, 25 Apr 2018 11:41:38 +0000"  >&lt;p&gt;It seems like the tests are running concurrently, the (&lt;tt&gt;ExecutionEnvironment#contextEnvironmentFactory&lt;/tt&gt;) set by &lt;tt&gt;SuccessAfterNetworkBuffersFailureITCase&lt;/tt&gt; was override by other tests.&lt;/p&gt;</comment>
                            <comment id="16452119" author="githubbot" created="Wed, 25 Apr 2018 12:00:33 +0000"  >&lt;p&gt;GitHub user sihuazhou opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5911&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9243&quot; title=&quot;SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9243&quot;&gt;&lt;del&gt;FLINK-9243&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt;harden SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure()&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR aim to harden `SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure()`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Use a dedicated TestEnvironment in `SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure()` to avoid concurrently problem&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    no&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    no&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sihuazhou/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sihuazhou/flink&lt;/a&gt; fixTestSuccessfulProgramAfterFailureUnstable&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5911.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5911.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5911&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0eb8055aa466ec8d7c2b60d9e2a185a7df9c5863&lt;br/&gt;
Author: sihuazhou &amp;lt;summerleafs@...&amp;gt;&lt;br/&gt;
Date:   2018-04-25T11:57:34Z&lt;/p&gt;

&lt;p&gt;    Use dedicated TestEnvironment in SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure() to avoid concurrently problem&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16452120" author="githubbot" created="Wed, 25 Apr 2018 12:00:46 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5911&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @zentol &lt;/p&gt;</comment>
                            <comment id="16452122" author="zentol" created="Wed, 25 Apr 2018 12:03:03 +0000"  >&lt;p&gt;ITCases are run in their own JVM, it shouldn&apos;t be possible for this to affect the test outcome.&lt;/p&gt;</comment>
                            <comment id="16452124" author="githubbot" created="Wed, 25 Apr 2018 12:04:40 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5911&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    please see my latest comment in the JIRA.&lt;/p&gt;</comment>
                            <comment id="16452140" author="githubbot" created="Wed, 25 Apr 2018 12:11:57 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5911&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    hmm...so, closing ...&lt;/p&gt;</comment>
                            <comment id="16452141" author="githubbot" created="Wed, 25 Apr 2018 12:11:58 +0000"  >&lt;p&gt;Github user sihuazhou closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5911&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16452186" author="nicok" created="Wed, 25 Apr 2018 12:40:26 +0000"  >&lt;p&gt;yes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;, I was reducing the number of buffers to the value before the credit-based flow control changes and briefly tested that it was working...&lt;br/&gt;
However, credit and non-credit code paths still have slightly different minimum buffer requirements on the receiver (see &lt;tt&gt;org.apache.flink.runtime.io.network.NetworkEnvironment#setupInputGate()&lt;/tt&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;non-credit requires at least one buffer per input channel&lt;/li&gt;
	&lt;li&gt;credit requires &lt;tt&gt;taskmanager.network.memory.buffers-per-channel&lt;/tt&gt; (default: 2) buffers per input channel&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I do see a difference in handling &lt;tt&gt;RemoteInputChannel&lt;/tt&gt; vs. &lt;tt&gt;LocalInputChannel&lt;/tt&gt; in this regard: local channels were also counted in non-credit mode while with credit-based flow control, they are not. &lt;tt&gt;LocalInputChannel&lt;/tt&gt;, however, do not need their own buffers since they will take those from the result subpartition they are connected to.&lt;/p&gt;

&lt;p&gt;Let me do some more digging and I&apos;ll see whether I can come up with a good solution to unify this here. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt; also has some thoughts on this but I think, the credit-based part may actually be the correct way to go.&lt;/p&gt;</comment>
                            <comment id="16452840" author="githubbot" created="Wed, 25 Apr 2018 18:32:13 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9243&quot; title=&quot;SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9243&quot;&gt;&lt;del&gt;FLINK-9243&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; fix flaky SuccessAfterNetworkBuffersFailureITCase&lt;/p&gt;

&lt;p&gt;    this adds some `rebalance()` operations into `SuccessAfterNetworkBuffersFailureITCase#runKMeans` which should be set up to fail and at the same time allow `#runConnectedComponents()` to succeed. It appears, these two have been too close together regarding network buffer use before.&lt;/p&gt;

&lt;p&gt;    I ran the test 500 times locally and it always succeeded now.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-9243&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5915.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5915.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5915&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f78151b345bb297963c861135b1312ccfb1945cc&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-04-25T18:27:43Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9243&quot; title=&quot;SuccessAfterNetworkBuffersFailureITCase#testSuccessfulProgramAfterFailure is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9243&quot;&gt;&lt;del&gt;FLINK-9243&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; fix flaky SuccessAfterNetworkBuffersFailureITCase&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16453146" author="githubbot" created="Wed, 25 Apr 2018 21:51:35 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging.&lt;/p&gt;</comment>
                            <comment id="16453149" author="zentol" created="Wed, 25 Apr 2018 21:53:43 +0000"  >&lt;p&gt;master: 0113ee2b33e3f86bb6a3de2ecf60d8e7bf554be2&lt;br/&gt;
1.5: 687278d791a10b7b8e3eede93a264a11eaa7651f&lt;/p&gt;</comment>
                            <comment id="16453152" author="githubbot" created="Wed, 25 Apr 2018 21:54:33 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5915&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16453569" author="githubbot" created="Thu, 26 Apr 2018 06:34:59 +0000"  >&lt;p&gt;Github user zhijiangW commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The points is already `rebalance()` in line 131, so it is no need to `rebalance()` again in line 137?&lt;/p&gt;</comment>
                            <comment id="16453693" author="githubbot" created="Thu, 26 Apr 2018 08:38:15 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    true, `points.rebalance()` is redundant, thanks for having a look, I created a follow-up fix in #5916&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sxlr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>