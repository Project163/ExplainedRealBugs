<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7540] Akka hostnames are not normalised consistently</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7540</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In &lt;tt&gt;NetUtils.unresolvedHostToNormalizedString()&lt;/tt&gt; we lowercase hostnames, Akka seems to preserve the uppercase/lowercase distinctions when starting the Actor. This leads to problems because other parts (for example &lt;tt&gt;JobManagerRetriever&lt;/tt&gt;) cannot find the actor leading to a nonfunctional cluster.&lt;/p&gt;

&lt;h1&gt;&lt;a name=&quot;OriginalIssueText&quot;&gt;&lt;/a&gt;Original Issue Text&lt;/h1&gt;

&lt;p&gt;Hostnames in my  hadoop cluster are like these: &#8220;DSJ-RTB-4T-177&#8221;,&#8221; DSJ-signal-900G-71&#8221;&lt;br/&gt;
When using the following command:&lt;br/&gt;
./bin/flink run -m yarn-cluster -yn 1 -yqu xl_trip -yjm 1024 ~/flink-1.3.1/examples/batch/WordCount.jar --input /user/all_trip_dev/test/testcount.txt --output /user/all_trip_dev/test/result  &lt;br/&gt;
Or&lt;br/&gt;
./bin/yarn-session.sh -d -jm 6144  -tm 12288 -qu xl_trip -s 24 -n 5 -nm &quot;flink-YarnSession-jm6144-tm12288-s24-n5-xl_trip&quot;&lt;br/&gt;
There will be some exceptions at Command line interface:&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: Unable to get ClusterClient status from Application Client&lt;br/&gt;
at org.apache.flink.yarn.YarnClusterClient.getClusterStatus(YarnClusterClient.java:243)&lt;br/&gt;
&#8230;&lt;br/&gt;
Caused by: org.apache.flink.util.FlinkException: Could not connect to the leading JobManager. Please check that the JobManager is running.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Thenthejobfails%2Cstartingtheyarnsessionisthesame.&quot;&gt;&lt;/a&gt;Then the job fails , starting the yarn-session is the same.&lt;/h4&gt;

&lt;p&gt;The exceptions of the application log:&lt;br/&gt;
2017-08-10 17:36:10,334 WARN  org.apache.flink.runtime.webmonitor.JobManagerRetriever       - Failed to retrieve leader gateway and port.&lt;br/&gt;
akka.actor.ActorNotFound: Actor not found for: ActorSelection&lt;span class=&quot;error&quot;&gt;&amp;#91;Anchor(akka.tcp://flink@dsj-signal-4t-248:65082/), Path(/user/jobmanager)&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#8230;&lt;br/&gt;
2017-08-10 17:36:10,837 ERROR org.apache.flink.yarn.YarnFlinkResourceManager                - Resource manager could not register at JobManager&lt;br/&gt;
akka.pattern.AskTimeoutException: Ask timed out on [ActorSelection&lt;span class=&quot;error&quot;&gt;&amp;#91;Anchor(akka.tcp://flink@dsj-signal-4t-248:65082/), Path(/user/jobmanager)&amp;#93;&lt;/span&gt;] after &lt;span class=&quot;error&quot;&gt;&amp;#91;10000 ms&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;And I found some differences in actor System:&lt;br/&gt;
2017-08-10 17:35:56,791 INFO  org.apache.flink.yarn.YarnJobManager                          - Starting JobManager at akka.tcp://flink@DSJ-signal-4T-248:65082/user/jobmanager.&lt;br/&gt;
2017-08-10 17:35:56,880 INFO  org.apache.flink.yarn.YarnJobManager                          - JobManager akka.tcp://flink@DSJ-signal-4T-248:65082/user/jobmanager was granted leadership with leader session ID Some(00000000-0000-0000-0000-000000000000).&lt;br/&gt;
2017-08-10 17:36:00,312 INFO  org.apache.flink.runtime.webmonitor.WebRuntimeMonitor         - Web frontend listening at 0:0:0:0:0:0:0:0:54921&lt;br/&gt;
2017-08-10 17:36:00,312 INFO  org.apache.flink.runtime.webmonitor.WebRuntimeMonitor         - Starting with JobManager akka.tcp://flink@DSJ-signal-4T-248:65082/user/jobmanager on port 54921&lt;br/&gt;
2017-08-10 17:36:00,313 INFO  org.apache.flink.runtime.webmonitor.JobManagerRetriever       - New leader reachable under akka.tcp://flink@dsj-signal-4t-248:65082/user/jobmanager:00000000-0000-0000-0000-000000000000.&lt;/p&gt;


&lt;p&gt;The JobManager is  &#8220;akka.tcp://flink@DSJ-signal-4T-248:65082&#8221; and the JobManagerRetriever is &#8220;akka.tcp://flink@dsj-signal-4t-248:65082&#8221;&lt;br/&gt;
The hostname of JobManagerRetriever&#8217;s actor is lowercase.&lt;/p&gt;


&lt;p&gt;And I read source code,&lt;br/&gt;
Class NetUtils the unresolvedHostToNormalizedString(String host) method of line 127:&lt;br/&gt;
	public static String unresolvedHostToNormalizedString(String host) { 		&lt;br/&gt;
// Return loopback interface address if host is null 		&lt;br/&gt;
// This represents the behavior of &lt;/p&gt;
{@code InetAddress.getByName }
&lt;p&gt; and RFC 3330 		if (host == null) &lt;/p&gt;
{ 			
   host = InetAddress.getLoopbackAddress().getHostAddress(); 		
}
&lt;p&gt; else &lt;/p&gt;
{ 			host = host.trim().toLowerCase(); 		}
&lt;p&gt;...&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;It turns the host name into lowercase.&lt;br/&gt;
Therefore, JobManagerRetriever certainly can not find Jobmanager&apos;s actorSYstem.&lt;br/&gt;
Then I removed the call to the toLowerCase() method in the source code.&lt;/p&gt;

&lt;p&gt;Finally ,I can submit a job in yarn-cluster mode and start a yarn-session.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="13097922">FLINK-7540</key>
            <summary>Akka hostnames are not normalised consistently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="oty5081">Tong Yan Ou</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Mon, 28 Aug 2017 10:01:58 +0000</created>
                <updated>Thu, 26 Oct 2017 07:52:36 +0000</updated>
                            <resolved>Thu, 26 Oct 2017 07:51:52 +0000</resolved>
                                    <version>1.3.1</version>
                    <version>1.3.2</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Deployment / YARN</component>
                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1209600">336h</timeoriginalestimate>
                            <timeestimate seconds="1209600">336h</timeestimate>
                                        <comments>
                            <comment id="16200822" author="aljoscha" created="Wed, 11 Oct 2017 19:29:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=oty5081&quot; class=&quot;user-hover&quot; rel=&quot;oty5081&quot;&gt;oty5081&lt;/a&gt; Thanks a lot for reporting this!&lt;/p&gt;

&lt;p&gt;The code that is starting the Akka actor system in the YARN case (pre FLIP-6) is here: &lt;a href=&quot;https://github.com/apache/flink/blob/b4120c1e15be1c36d07dfb29080e29750d5a0955/flink-yarn/src/main/java/org/apache/flink/yarn/YarnApplicationMasterRunner.java#L309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/b4120c1e15be1c36d07dfb29080e29750d5a0955/flink-yarn/src/main/java/org/apache/flink/yarn/YarnApplicationMasterRunner.java#L309&lt;/a&gt;. We would probably have to use the same hostname normalisation here.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; What do you think about this? For FLIP-6 there seem to be several different entry points and it&apos;s not always clear to me how the actor system get&apos;s its name.&lt;/p&gt;</comment>
                            <comment id="16201096" author="till.rohrmann" created="Wed, 11 Oct 2017 22:36:48 +0000"  >&lt;p&gt;This is indeed a big problem for setups where you have lower and upper case hostnames and if you use IPv6 addresses. The underlying problem is as Aljoscha pointed out that we don&apos;t apply the hostname normalisation consistently. For example, the &lt;tt&gt;StandaloneHaServices&lt;/tt&gt; assume that hostname are normalized. However, this is not true in the Yarn, Mesos and Flip-6 case. For the HA mode this is not a problem since we distribute the hostnames via ZooKeeper.&lt;/p&gt;

&lt;p&gt;All the affected cases have in common that they start their &lt;tt&gt;ActorSystem&lt;/tt&gt; via the &lt;tt&gt;BootstrapTools&lt;/tt&gt;. Adding the normalization to &lt;tt&gt;AkkaUtils#getAkkaConfig(Configuration, Option&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int)&amp;#93;&lt;/span&gt;)&lt;/tt&gt; should solve the problem because all remote actor systems get their hostname configuration via this method.&lt;/p&gt;</comment>
                            <comment id="16201187" author="githubbot" created="Wed, 11 Oct 2017 23:26:15 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4812&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7540&quot; title=&quot;Akka hostnames are not normalised consistently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7540&quot;&gt;&lt;del&gt;FLINK-7540&lt;/del&gt;&lt;/a&gt; Apply consistent hostname normalization&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The hostname normalization is now applied when generating the remote akka config.&lt;br/&gt;
    That way it should be ensured that all ActorSystems are bound to a normalized&lt;br/&gt;
    hostname.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add hostname normalization to `AkkaUtils#getAkkaConfig`&lt;/li&gt;
	&lt;li&gt;Replace manual ActorSystem instantiation with `BootstrapTools#startActorSystem`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added `AkkaUtilsTest#getAkkaConfig`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes) It affects how `ActorSystem` are instantiated.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixHostnameNormalization&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4812.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4812.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4812&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 00876ead7a4a7492d643f6cba3e784044c54669e&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-10-11T23:17:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7540&quot; title=&quot;Akka hostnames are not normalised consistently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7540&quot;&gt;&lt;del&gt;FLINK-7540&lt;/del&gt;&lt;/a&gt; Apply consistent hostname normalization&lt;/p&gt;

&lt;p&gt;    The hostname normalization is now applied when generationg the remote akka config.&lt;br/&gt;
    That way it should be ensured that all ActorSystems are bound to a normalized&lt;br/&gt;
    hostname.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16216851" author="githubbot" created="Tue, 24 Oct 2017 12:58:10 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4812&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    These changes look good! &#128077; &lt;/p&gt;

&lt;p&gt;    And the code is even simplified by using a common method for creating the actor system.&lt;/p&gt;</comment>
                            <comment id="16219056" author="githubbot" created="Wed, 25 Oct 2017 16:55:06 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4812&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @aljoscha. Rebasing and once Travis gives green light, I&apos;ll merge this PR.&lt;/p&gt;</comment>
                            <comment id="16220124" author="till.rohrmann" created="Thu, 26 Oct 2017 07:51:52 +0000"  >&lt;p&gt;Fixed via 3039df8099bc8d42b645d69deb360c884c94b83b&lt;/p&gt;</comment>
                            <comment id="16220125" author="githubbot" created="Thu, 26 Oct 2017 07:52:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4812&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jce7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>