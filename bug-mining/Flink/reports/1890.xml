<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:29:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7240] Externalized RocksDB can fail with stackoverflow</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7240</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testExternalizedFullRocksDBCheckpointsStandalone(org.apache.flink.test.checkpointing.ExternalizedCheckpointITCase)  Time elapsed: 146.894 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.StackOverflowError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at java.util.Hashtable.get(Hashtable.java:363)
	at java.util.Properties.getProperty(Properties.java:969)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.java:720)
	at sun.security.action.GetPropertyAction.run(GetPropertyAction.java:84)
	at sun.security.action.GetPropertyAction.run(GetPropertyAction.java:49)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.io.PrintWriter.&amp;lt;init&amp;gt;(PrintWriter.java:116)
	at java.io.PrintWriter.&amp;lt;init&amp;gt;(PrintWriter.java:100)
	at org.apache.log4j.DefaultThrowableRenderer.render(DefaultThrowableRenderer.java:58)
	at org.apache.log4j.spi.ThrowableInformation.getThrowableStrRep(ThrowableInformation.java:87)
	at org.apache.log4j.spi.LoggingEvent.getThrowableStrRep(LoggingEvent.java:413)
	at org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:313)
	at org.apache.log4j.WriterAppender.append(WriterAppender.java:162)
	at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)
	at org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)
	at org.apache.log4j.Category.callAppenders(Category.java:206)
	at org.apache.log4j.Category.forcedLog(Category.java:391)
	at org.apache.log4j.Category.log(Category.java:856)
	at org.slf4j.impl.Log4jLoggerAdapter.info(Log4jLoggerAdapter.java:381)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:392)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
	at org.apache.flink.runtime.testingUtils.TestingCluster.requestCheckpoint(TestingCluster.scala:394)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/zentol/flink/jobs/255760513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/zentol/flink/jobs/255760513&lt;/a&gt;&lt;/p&gt;</environment>
        <key id="13088859">FLINK-7240</key>
            <summary>Externalized RocksDB can fail with stackoverflow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Thu, 20 Jul 2017 18:24:29 +0000</created>
                <updated>Thu, 10 Aug 2017 09:22:19 +0000</updated>
                            <resolved>Thu, 10 Aug 2017 09:22:19 +0000</resolved>
                                    <version>1.3.1</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16115815" author="till.rohrmann" created="Sun, 6 Aug 2017 14:20:45 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://travis-ci.org/tillrohrmann/flink/jobs/261186890&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/tillrohrmann/flink/jobs/261186890&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16115817" author="till.rohrmann" created="Sun, 6 Aug 2017 14:25:01 +0000"  >&lt;p&gt;The problem has been introduced with a hotfix which tries to solve a problem with &lt;tt&gt;TestingJobManagerMessages.WaitForAllVerticesToBeRunning&lt;/tt&gt;. Since the commit message does not specify the problem I cannot tell what the original problem. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefanrichter83%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;stefanrichter83@gmail.com&quot;&gt;stefanrichter83@gmail.com&lt;/a&gt; can tell more.&lt;/p&gt;</comment>
                            <comment id="16115821" author="till.rohrmann" created="Sun, 6 Aug 2017 14:32:19 +0000"  >&lt;p&gt;My guess with the current solution would be that the Job was never started successfully and thus, we see the &lt;tt&gt;StackOverflowError&lt;/tt&gt; because we are recursively calling `requestCheckpoint` in a non successful checkpoint case.&lt;/p&gt;</comment>
                            <comment id="16116716" author="till.rohrmann" created="Mon, 7 Aug 2017 15:09:39 +0000"  >&lt;p&gt;The underlying problem is the following: The &lt;tt&gt;ExternalizedCheckpointITCase&lt;/tt&gt; executes multiple jobs per test on the same cluster. The individual jobs are stopped via a &lt;tt&gt;CancelJob&lt;/tt&gt; message. The problem then is that we don&apos;t wait until the jobs have been completely cancelled. This is loosely enforced by a &lt;tt&gt;Thread.sleep&lt;/tt&gt; call. If this timeout should not be enough (e.g. on Travis), then it might be the case that the next job will simply fail because it has not enough resources available. If we then try to request a new checkpoint, it will always fail. This combined with the recursive retry leads then to the &lt;tt&gt;StackOverflowError&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16118017" author="githubbot" created="Tue, 8 Aug 2017 08:08:36 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7240&quot; title=&quot;Externalized RocksDB can fail with stackoverflow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7240&quot;&gt;&lt;del&gt;FLINK-7240&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Stabilize ExternalizedCheckpointITCase&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Stabilize `ExternalizedCheckpointITCase`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The problem was that the TestingCluster did not wait properly after canceling the&lt;br/&gt;
    job that the job was also completely removed from the cluster before submitting&lt;br/&gt;
    the next job. This could lead to a NoResourceAvailableException which ultimately&lt;br/&gt;
    made the job fail.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixExternalizedCheckpointITCase&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4497.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4497.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4497&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2a8adef594c965182324d3a02c1979e118ebf850&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-08-08T08:04:34Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7240&quot; title=&quot;Externalized RocksDB can fail with stackoverflow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7240&quot;&gt;&lt;del&gt;FLINK-7240&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Stabilize ExternalizedCheckpointITCase&lt;/p&gt;

&lt;p&gt;    The problem was that the TestingCluster did not wait properly after canceling the&lt;br/&gt;
    job that the job was also completely removed from the cluster before submitting&lt;br/&gt;
    the next job. This could lead to a NoResourceAvailableException which ultimately&lt;br/&gt;
    made the job fail.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16118028" author="githubbot" created="Tue, 8 Aug 2017 08:19:42 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for looking into this @tillrohrmann ! The fix looks good to me. +1 for merging.&lt;/p&gt;</comment>
                            <comment id="16119050" author="githubbot" created="Tue, 8 Aug 2017 21:23:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I actually think that this does not fully stabilize the test case. The problem is the following: Waiting for all `Tasks` to be in state `RUNNING` is not sufficient but only necessary. The `StreamTask` can still be not running and thus the checkpoint gets rejected. I propose to add a `CountDownLatch` to the source function to signal when all sources are really running. Only then we will trigger the checkpoint.&lt;/p&gt;</comment>
                            <comment id="16121295" author="githubbot" created="Thu, 10 Aug 2017 09:01:01 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @StefanRRichter. Travis passes now. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="16121319" author="githubbot" created="Thu, 10 Aug 2017 09:21:59 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4497&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16121320" author="till.rohrmann" created="Thu, 10 Aug 2017 09:22:19 +0000"  >&lt;p&gt;Fixed via f9db6fe1dd0c82209db9c064c8f6f1aa99b9590c&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3htf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>