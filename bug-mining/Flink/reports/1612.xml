<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6300] PID1 of docker images does not behave correctly</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6300</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When running the task manager and job manager docker images the process with PID1 is a bash script.&lt;/p&gt;

&lt;p&gt;There is a problem in using bash as the PID1 process in a docker&lt;br/&gt;
container as docker sends SIGTERM, but bash doesn&apos;t send this to its&lt;br/&gt;
child processes.&lt;/p&gt;

&lt;p&gt;This means for example that if a container was ever killed and a child&lt;br/&gt;
process had a file open then the file may get corrupted.&lt;/p&gt;

&lt;p&gt;It&apos;s covered in more detail in a blog post here:&lt;br/&gt;
&lt;a href=&quot;https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From the mailing list (Nico):&lt;br/&gt;
&quot;Some background:&lt;br/&gt;
Although docker-entrypoint.sh uses &quot;exec&quot; to run succeeding bash scripts for&lt;br/&gt;
jobmanager.sh and taskmanager.sh, respectively, and thus replaces itself with&lt;br/&gt;
these scripts, they do not seem to use exec themselves for foreground&lt;br/&gt;
processes and thus may run into the problem you described.&lt;br/&gt;
I may be wrong, but I did not find any other fallback to handle this in the&lt;br/&gt;
current code base.&quot;&lt;/p&gt;

&lt;p&gt;Potentially useful information:&lt;/p&gt;

&lt;p&gt;dockerd version 1.1.3 added an init flag:&lt;/p&gt;

&lt;p&gt;&quot;You can use the --init flag to indicate that an init process should be used as the PID 1 in the container. Specifying an init process ensures the usual responsibilities of an init system, such as reaping zombie processes, are performed inside the created container.&quot;&lt;br/&gt;
from:&lt;br/&gt;
&lt;a href=&quot;https://docs.docker.com/engine/reference/run/#restart-policies---restart&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.docker.com/engine/reference/run/#restart-policies---restart&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;perhaps the fix could be just to update readme for these images to specify to use this flag.&lt;/p&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="13063448">FLINK-6300</key>
            <summary>PID1 of docker images does not behave correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="plucas">Patrick Lucas</assignee>
                                    <reporter username="ksharp">kathleen sharp</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Apr 2017 11:47:16 +0000</created>
                <updated>Tue, 18 Apr 2017 14:50:13 +0000</updated>
                            <resolved>Tue, 18 Apr 2017 14:50:13 +0000</resolved>
                                    <version>1.1.4</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>flink-docker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15972612" author="githubbot" created="Tue, 18 Apr 2017 13:00:40 +0000"  >&lt;p&gt;GitHub user patricklucas opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6300&quot; title=&quot;PID1 of docker images does not behave correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6300&quot;&gt;&lt;del&gt;FLINK-6300&lt;/del&gt;&lt;/a&gt; Use &apos;exec&apos; in start-foreground calls&lt;/p&gt;

&lt;p&gt;    To avoid signal-handling issues in Docker, applications need to run as&lt;br/&gt;
    a single executable or use a process manager that forwards signals&lt;br/&gt;
    correctly, in either case running as PID 1.&lt;/p&gt;

&lt;p&gt;    Since Flink uses a number of chained scripts before the ultimate call&lt;br/&gt;
    to `java`, we need to use `exec` so that the script executable is&lt;br/&gt;
    replaced, ultimately resulting in a single `java` process as PID 1.&lt;/p&gt;

&lt;p&gt;    There&apos;s no need to run a process manager since Flink only actually&lt;br/&gt;
    requires a single process.&lt;/p&gt;

&lt;p&gt;    *&lt;b&gt;Note:&lt;/b&gt;* As there has not been a Flink release since these codepaths were introduced, I&apos;m comfortable with merging this change for 1.2.1 since my manual testing was successful.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/patricklucas/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/patricklucas/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6300&quot; title=&quot;PID1 of docker images does not behave correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6300&quot;&gt;&lt;del&gt;FLINK-6300&lt;/del&gt;&lt;/a&gt;_docker_pid_1_fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3734&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3be49de04c239083a5f050bf891834fc8abc12c9&lt;br/&gt;
Author: Patrick Lucas &amp;lt;me@patricklucas.com&amp;gt;&lt;br/&gt;
Date:   2017-04-18T12:48:49Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6300&quot; title=&quot;PID1 of docker images does not behave correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6300&quot;&gt;&lt;del&gt;FLINK-6300&lt;/del&gt;&lt;/a&gt; Use &apos;exec&apos; in start-foreground calls&lt;/p&gt;

&lt;p&gt;    To avoid signal-handling issues in Docker, applications need to run as&lt;br/&gt;
    a single executable or use a process manager that forwards signals&lt;br/&gt;
    correctly, in either case running as PID 1.&lt;/p&gt;

&lt;p&gt;    Since Flink uses a number of chained scripts before the ultimate call&lt;br/&gt;
    to `java`, we need to use `exec` so that the script executable is&lt;br/&gt;
    replaced, ultimately resulting in a single `java` process as PID 1.&lt;/p&gt;

&lt;p&gt;    There&apos;s no need to run a process manager since Flink only actually&lt;br/&gt;
    requires a single process.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15972631" author="githubbot" created="Tue, 18 Apr 2017 13:10:03 +0000"  >&lt;p&gt;Github user patricklucas commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @greghogan, fyi&lt;/p&gt;</comment>
                            <comment id="15972644" author="githubbot" created="Tue, 18 Apr 2017 13:15:57 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="15972662" author="githubbot" created="Tue, 18 Apr 2017 13:27:00 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 (seems to work nicely, as expected)&lt;/p&gt;</comment>
                            <comment id="15972696" author="githubbot" created="Tue, 18 Apr 2017 13:52:17 +0000"  >&lt;p&gt;Github user patricklucas commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan do you think you could merge this? (also to 1.2.1)&lt;/p&gt;

&lt;p&gt;    If not I can try to rope in someone else.&lt;/p&gt;</comment>
                            <comment id="15972726" author="githubbot" created="Tue, 18 Apr 2017 13:57:55 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @patricklucas yes, had just come back to say that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15972727" author="githubbot" created="Tue, 18 Apr 2017 13:59:26 +0000"  >&lt;p&gt;Github user patricklucas commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Great, thanks!&lt;/p&gt;</comment>
                            <comment id="15972829" author="githubbot" created="Tue, 18 Apr 2017 14:47:32 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3734&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15972836" author="greghogan" created="Tue, 18 Apr 2017 14:50:13 +0000"  >&lt;p&gt;1.3.0: 9d3f127e4f0ddd15ae7af393e0c5b0d3dd81d812&lt;br/&gt;
1.2.2: 4a1aa4ce80fd886266ee7ba76caf27feba3c0f43&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dj3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>