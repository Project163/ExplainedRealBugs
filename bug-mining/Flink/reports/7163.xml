<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:17:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-32681] RocksDBStateDownloaderTest.testMultiThreadCleanupOnFailure unstablie</title>
                <link>https://issues.apache.org/jira/browse/FLINK-32681</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51712&amp;amp;view=logs&amp;amp;j=77a9d8e1-d610-59b3-fc2a-4766541e0e33&amp;amp;t=125e07e7-8de0-5c6c-a541-a567415af3ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51712&amp;amp;view=logs&amp;amp;j=77a9d8e1-d610-59b3-fc2a-4766541e0e33&amp;amp;t=125e07e7-8de0-5c6c-a541-a567415af3ef&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Failed 3 times in yesterdays nightly run.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Jul 26 01:12:46 01:12:46.889 [ERROR] org.apache.flink.contrib.streaming.state.RocksDBStateDownloaderTest.testMultiThreadCleanupOnFailure  Time elapsed: 0.044 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
Jul 26 01:12:46 java.lang.AssertionError
Jul 26 01:12:46 	at org.junit.Assert.fail(Assert.java:87)
Jul 26 01:12:46 	at org.junit.Assert.assertTrue(Assert.java:42)
Jul 26 01:12:46 	at org.junit.Assert.assertFalse(Assert.java:65)
Jul 26 01:12:46 	at org.junit.Assert.assertFalse(Assert.java:75)
Jul 26 01:12:46 	at org.apache.flink.contrib.streaming.state.RocksDBStateDownloaderTest.testMultiThreadCleanupOnFailure(RocksDBStateDownloaderTest.java:151)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13544919">FLINK-32681</key>
            <summary>RocksDBStateDownloaderTest.testMultiThreadCleanupOnFailure unstablie</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 26 Jul 2023 07:51:29 +0000</created>
                <updated>Mon, 11 Dec 2023 09:21:41 +0000</updated>
                            <resolved>Tue, 1 Aug 2023 15:36:21 +0000</resolved>
                                    <version>1.18.0</version>
                                    <fixVersion>1.18.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17747872" author="sergey nuyanzin" created="Thu, 27 Jul 2023 09:13:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51712&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=24c3384f-1bcb-57b3-224f-51bf973bbee8&amp;amp;l=10308&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51712&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=24c3384f-1bcb-57b3-224f-51bf973bbee8&amp;amp;l=10308&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17748380" author="sergey nuyanzin" created="Fri, 28 Jul 2023 02:59:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51777&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=24c3384f-1bcb-57b3-224f-51bf973bbee8&amp;amp;l=10286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51777&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=24c3384f-1bcb-57b3-224f-51bf973bbee8&amp;amp;l=10286&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17748606" author="mapohl" created="Fri, 28 Jul 2023 13:05:05 +0000"  >&lt;p&gt;twice in the same build:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51777&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=24c3384f-1bcb-57b3-224f-51bf973bbee8&amp;amp;l=10286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51777&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=24c3384f-1bcb-57b3-224f-51bf973bbee8&amp;amp;l=10286&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51777&amp;amp;view=logs&amp;amp;j=77a9d8e1-d610-59b3-fc2a-4766541e0e33&amp;amp;t=125e07e7-8de0-5c6c-a541-a567415af3ef&amp;amp;l=10241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51777&amp;amp;view=logs&amp;amp;j=77a9d8e1-d610-59b3-fc2a-4766541e0e33&amp;amp;t=125e07e7-8de0-5c6c-a541-a567415af3ef&amp;amp;l=10241&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17748609" author="mapohl" created="Fri, 28 Jul 2023 13:09:53 +0000"  >&lt;p&gt;I&apos;m linking &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-32345&quot; title=&quot;Improve parallel download of RocksDB incremental state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-32345&quot;&gt;&lt;del&gt;FLINK-32345&lt;/del&gt;&lt;/a&gt; as a cause because that failing test was added in that issue. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srichter&quot; class=&quot;user-hover&quot; rel=&quot;srichter&quot;&gt;srichter&lt;/a&gt; can you take this one?&lt;/p&gt;

&lt;p&gt;I raised the priority to Critical as well.&lt;/p&gt;</comment>
                            <comment id="17749203" author="srichter" created="Mon, 31 Jul 2023 13:35:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; I was trying to reproduce this locally without success, could it be an infra related problem? The code is calling `FileUtils::deleteDirectoryQuietly` to cleanup files and if something goes wrong during the deletion, it could still find the directories and fail the test. I could also just try to test if delete was called and not if the files where actually deleted to abstract away from such infra problems, wdyt?&lt;/p&gt;</comment>
                            <comment id="17749218" author="mapohl" created="Mon, 31 Jul 2023 14:41:21 +0000"  >&lt;p&gt;The test failure is reproducible locally (with a Linux machine). I ran the test locally (utilizing Intellij&apos;s repeated execution feature) and it failed consistently after a few runs. Are you using MacOS or Windows? Adding sleep seems to lower the changes before of the failure appearing.&lt;/p&gt;

&lt;p&gt;Working with callbacks here would be a way to test the code. But it would be still good to understand why we see this strange behavior.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t look like the &lt;tt&gt;deleteDirectoryQuietly&lt;/tt&gt; call is the issue (even though I&apos;d argue that exposing exceptions would be the better way to do it): When changing the code to &lt;tt&gt;deleteDirectory&lt;/tt&gt;, the assertion was still the same with no &lt;tt&gt;IOException&lt;/tt&gt; appearing instead.&lt;/p&gt;</comment>
                            <comment id="17749247" author="srichter" created="Mon, 31 Jul 2023 15:41:03 +0000"  >&lt;p&gt;I&apos;m running on Mac, but with a sleep I already managed to reproduce it. I&apos;ll take a look what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="17749522" author="feifan wang" created="Tue, 1 Aug 2023 07:53:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srichter&quot; class=&quot;user-hover&quot; rel=&quot;srichter&quot;&gt;srichter&lt;/a&gt; , I&apos;m also very interested in this problem. I think it is caused by the directory being created again by the download task that was already started. I think it can be solved with a cleaner that is aware of task failure, and I submitted a draft &lt;a href=&quot;https://github.com/apache/flink/pull/23111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; explaining the idea (perhaps as a final fix if you think it is appropriate). You can take a look if you don&apos;t mind. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17749541" author="feifan wang" created="Tue, 1 Aug 2023 08:09:21 +0000"  >&lt;p&gt;Sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt;&#160; I didn&apos;t notice that the ticket has been assigned before submitting the PR.&lt;/p&gt;</comment>
                            <comment id="17749599" author="srichter" created="Tue, 1 Aug 2023 09:59:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt;Thanks for the offer but I&apos;ve already worked on a fix yesterday. But please feel free to review it later.&lt;/p&gt;</comment>
                            <comment id="17749910" author="srichter" created="Tue, 1 Aug 2023 15:36:21 +0000"  >&lt;p&gt;merged into master d11cc32&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13540162">FLINK-32345</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jds8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>