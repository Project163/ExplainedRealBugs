<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5420] Make CEP operators rescalable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5420</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This issue targets making the operators in the CEP library re-scalable. After this is implemented, the user will be able to take a savepoint and restart his job with a different parallelism.&lt;br/&gt;
This issue depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5845&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-5845&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;The way this is done is that we introduce the &lt;tt&gt;TimeServiceHandler&lt;/tt&gt; in the &lt;tt&gt;AbstractStreamOperator&lt;/tt&gt;, which keeps the registered &lt;tt&gt;InternalTimerService&lt;/tt&gt; s (before this was in the &lt;tt&gt;AbstractStreamOperator&lt;/tt&gt;) and a new service called &lt;tt&gt;KeyRegistry&lt;/tt&gt;. The &lt;tt&gt;KeyRegistry&lt;/tt&gt; will be fault tolerant and rescalable and will allow to register keys and a callback which will be invoked for each registered key upon reception of a watermark. This can be seen as keeping (recurring) timers for each of the registered keys that will fire &quot;at the next watermark&quot;.&lt;/p&gt;

&lt;p&gt;After introducing this service, upon reception of a watermark, all the processing of the NFAs will be delegated to the callback.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13032550">FLINK-5420</key>
            <summary>Make CEP operators rescalable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkl0u">Kostas Kloudas</assignee>
                                    <reporter username="kkl0u">Kostas Kloudas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jan 2017 13:38:45 +0000</created>
                <updated>Tue, 28 Feb 2017 18:53:18 +0000</updated>
                            <resolved>Tue, 28 Feb 2017 18:09:46 +0000</resolved>
                                    <version>1.2.0</version>
                                                    <component>Library / CEP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                                                            <comments>
                            <comment id="15811887" author="till.rohrmann" created="Mon, 9 Jan 2017 14:20:46 +0000"  >&lt;p&gt;Adding a description containing some more details about the problem could be helpful.&lt;/p&gt;</comment>
                            <comment id="15865674" author="githubbot" created="Tue, 14 Feb 2017 12:14:17 +0000"  >&lt;p&gt;GitHub user kl0u opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3307&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5420&quot; title=&quot;Make CEP operators rescalable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5420&quot;&gt;&lt;del&gt;FLINK-5420&lt;/del&gt;&lt;/a&gt; Make CEP operators rescalable&lt;/p&gt;

&lt;p&gt;    Transforms the CEP operators into ProcessFunctions that use only managed keyed state. Rescalability now comes out-of-the-box. In addition, for the keyed operator, the list of seen keys is replaced by timers set by the incoming elements that will fire at the next watermark.&lt;/p&gt;

&lt;p&gt;    More information about how rescalability is achieved can be found here:&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-5420&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kl0u/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kl0u/flink&lt;/a&gt; cep-ref&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3307.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3307.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3307&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 230ee80355f7219d56d1010d8850dbe39866c7e8&lt;br/&gt;
Author: kl0u &amp;lt;kkloudas@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-01-27T14:30:32Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5420&quot; title=&quot;Make CEP operators rescalable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5420&quot;&gt;&lt;del&gt;FLINK-5420&lt;/del&gt;&lt;/a&gt; Make CEP operators rescalable&lt;/p&gt;

&lt;p&gt;    Transforms the CEP operators into ProcessFunctions&lt;br/&gt;
    that use only managed keyed state. Rescalability&lt;br/&gt;
    now comes out-of-the-box. In addition, for the&lt;br/&gt;
    keyed operator, the list of seen keys is replaced&lt;br/&gt;
    by timers set by the incoming elements that will&lt;br/&gt;
    fire at the next watermark.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15869534" author="githubbot" created="Thu, 16 Feb 2017 08:41:38 +0000"  >&lt;p&gt;Github user kl0u closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3307&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15882637" author="githubbot" created="Fri, 24 Feb 2017 13:10:43 +0000"  >&lt;p&gt;GitHub user kl0u opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5420&quot; title=&quot;Make CEP operators rescalable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5420&quot;&gt;&lt;del&gt;FLINK-5420&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cep&amp;#93;&lt;/span&gt; Make the CEP operators rescalable&lt;/p&gt;

&lt;p&gt;    More on the related JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-5420&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kl0u/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kl0u/flink&lt;/a&gt; cep-uni-rescale&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3412&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ee5862973d2b8b8dca8333eaaff6ca82a4e9a069&lt;br/&gt;
Author: kl0u &amp;lt;kkloudas@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-02-24T09:34:43Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5420&quot; title=&quot;Make CEP operators rescalable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5420&quot;&gt;&lt;del&gt;FLINK-5420&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cep&amp;#93;&lt;/span&gt; Make the CEP operators rescalable&lt;/p&gt;

&lt;p&gt;    Introduces the KeyRegistry in the TimeServiceHandler&lt;br/&gt;
    which allows to specify a callback and register keys&lt;br/&gt;
    for which we want this callback to be invoked on each&lt;br/&gt;
    watermark.&lt;/p&gt;

&lt;p&gt;    Given this service, now the CEP operator has only&lt;br/&gt;
    keyed state, and the non-keyed one (keys) are&lt;br/&gt;
    handled by the KeyRegistry.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15882677" author="githubbot" created="Fri, 24 Feb 2017 13:36:27 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412#discussion_r102940901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412#discussion_r102940901&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/KeyRegistry.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,257 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.streaming.api.operators;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputViewStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataOutputViewStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.runtime.state.KeyGroupRangeAssignment;&lt;br/&gt;
    +import org.apache.flink.runtime.state.KeyGroupsList;&lt;br/&gt;
    +import org.apache.flink.streaming.api.watermark.Watermark;&lt;br/&gt;
    +import org.apache.flink.util.InstantiationUtil;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.HashSet;&lt;br/&gt;
    +import java.util.Set;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.flink.util.Preconditions.checkArgument;&lt;br/&gt;
    +import static org.apache.flink.util.Preconditions.checkNotNull;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * The key registry allows to register a &lt;/p&gt;
{@link OnWatermarkCallback}
&lt;p&gt; and multiple keys, for which&lt;br/&gt;
    + * the callback will be invoked periodically, upon reception of each subsequent &lt;/p&gt;
{@link Watermark}
&lt;p&gt;,&lt;br/&gt;
    + * after the registration of the key.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * &amp;lt;b&amp;gt;NOTE: &amp;lt;/b&amp;gt; This service is only available to &amp;lt;b&amp;gt;keyed&amp;lt;/b&amp;gt; operators.&lt;br/&gt;
    + *&lt;br/&gt;
    + *  @param &amp;lt;K&amp;gt; The type of key returned by the &lt;/p&gt;
{@code KeySelector}
&lt;p&gt;.&lt;br/&gt;
    + * */&lt;br/&gt;
    +public class KeyRegistry&amp;lt;K&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    To keep it in line with the other services this could be called `InternalWatermarkCallbackService`.&lt;/p&gt;</comment>
                            <comment id="15882678" author="githubbot" created="Fri, 24 Feb 2017 13:36:27 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412#discussion_r102940776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412#discussion_r102940776&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/TimeServiceHandler.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,223 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.streaming.api.operators;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.annotation.VisibleForTesting;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputViewStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataOutputViewStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.runtime.state.KeyGroupsList;&lt;br/&gt;
    +import org.apache.flink.runtime.state.VoidNamespaceSerializer;&lt;br/&gt;
    +import org.apache.flink.streaming.api.watermark.Watermark;&lt;br/&gt;
    +import org.apache.flink.streaming.runtime.tasks.ProcessingTimeService;&lt;br/&gt;
    +import org.apache.flink.util.Preconditions;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.HashMap;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * A handler keeping all the time-related services available to all operators extending the&lt;br/&gt;
    + * &lt;/p&gt;
{@link AbstractStreamOperator}
&lt;p&gt;. These are the different &lt;/p&gt;
{@link HeapInternalTimerService timer services}
&lt;p&gt;    + * and the &lt;/p&gt;
{@link KeyRegistry}
&lt;p&gt;.&lt;br/&gt;
    + *&lt;br/&gt;
    + * &amp;lt;b&amp;gt;NOTE:&amp;lt;/b&amp;gt; These services are only available to keyed operators.&lt;br/&gt;
    + *&lt;br/&gt;
    + * @param &amp;lt;K&amp;gt; The type of keys used for the timers and the registry.&lt;br/&gt;
    + * @param &amp;lt;N&amp;gt; The type of namespace used for the timers.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class TimeServiceHandler&amp;lt;K, N&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should be package private since it&apos;s only used by the `AbstractStreamOperator`. Maybe also mark it as `@Internal` just to be save. &lt;/p&gt;</comment>
                            <comment id="15882680" author="githubbot" created="Fri, 24 Feb 2017 13:36:27 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412#discussion_r102940564&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412#discussion_r102940564&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java &amp;#8212;&lt;br/&gt;
    @@ -887,6 +864,30 @@ public void close() {&lt;br/&gt;
     	//  Watermark handling&lt;br/&gt;
     	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;    +	public &amp;lt;K&amp;gt; void registerWatermarkCallback(KeyRegistry.OnWatermarkCallback&amp;lt;K&amp;gt; callback, TypeSerializer&amp;lt;K&amp;gt; keySerializer) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Come to think of it, we should probably only expose a method like `getInternalWatermarkCallbackService()`. (I discussed this offline with @kl0u)&lt;/p&gt;</comment>
                            <comment id="15882679" author="githubbot" created="Fri, 24 Feb 2017 13:36:27 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412#discussion_r102939631&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412#discussion_r102939631&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java &amp;#8212;&lt;br/&gt;
    @@ -887,6 +864,30 @@ public void close() {&lt;br/&gt;
     	//  Watermark handling&lt;br/&gt;
     	// ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;    +	public &amp;lt;K&amp;gt; void registerWatermarkCallback(KeyRegistry.OnWatermarkCallback&amp;lt;K&amp;gt; callback, TypeSerializer&amp;lt;K&amp;gt; keySerializer) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The key serialiser can be retrieved from `getKeyedStateBackend().getKeySerializer()`.&lt;/p&gt;</comment>
                            <comment id="15883208" author="githubbot" created="Fri, 24 Feb 2017 17:59:35 +0000"  >&lt;p&gt;Github user kl0u commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the comments @aljoscha . I integrated them and waiting for Travis.&lt;/p&gt;</comment>
                            <comment id="15888165" author="githubbot" created="Tue, 28 Feb 2017 15:02:49 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412#discussion_r103471738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412#discussion_r103471738&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/OnWatermarkCallback.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,39 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.streaming.api.operators;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.streaming.api.watermark.Watermark;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * A callback registered with the &lt;/p&gt;
{@link InternalWatermarkCallbackService}
&lt;p&gt; service. This callback will&lt;br/&gt;
    + * be invoked for all keys registered with the service, upon reception of a watermark.&lt;br/&gt;
    + */&lt;br/&gt;
    +public interface OnWatermarkCallback&amp;lt;KEY&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should probably also be `@Internal`.&lt;/p&gt;</comment>
                            <comment id="15888166" author="githubbot" created="Tue, 28 Feb 2017 15:02:49 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412#discussion_r103471629&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412#discussion_r103471629&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/InternalWatermarkCallbackService.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,237 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.streaming.api.operators;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputViewStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataOutputViewStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.runtime.state.KeyGroupRangeAssignment;&lt;br/&gt;
    +import org.apache.flink.runtime.state.KeyGroupsList;&lt;br/&gt;
    +import org.apache.flink.streaming.api.watermark.Watermark;&lt;br/&gt;
    +import org.apache.flink.util.InstantiationUtil;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.util.HashSet;&lt;br/&gt;
    +import java.util.Set;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.flink.util.Preconditions.checkArgument;&lt;br/&gt;
    +import static org.apache.flink.util.Preconditions.checkNotNull;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * The watermark callback service allows to register a &lt;/p&gt;
{@link OnWatermarkCallback OnWatermarkCallback}
&lt;p&gt;    + * and multiple keys, for which the callback will be invoked every time a new &lt;/p&gt;
{@link Watermark}
&lt;p&gt; is received&lt;br/&gt;
    + * (after the registration of the key).&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * &amp;lt;b&amp;gt;NOTE: &amp;lt;/b&amp;gt; This service is only available to &amp;lt;b&amp;gt;keyed&amp;lt;/b&amp;gt; operators.&lt;br/&gt;
    + *&lt;br/&gt;
    + *  @param &amp;lt;K&amp;gt; The type of key returned by the &lt;/p&gt;
{@code KeySelector}
&lt;p&gt;.&lt;br/&gt;
    + * */&lt;br/&gt;
    +public class InternalWatermarkCallbackService&amp;lt;K&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Slight Javadoc typo, and this should probably be `@Internal`.&lt;/p&gt;</comment>
                            <comment id="15888192" author="githubbot" created="Tue, 28 Feb 2017 15:19:35 +0000"  >&lt;p&gt;Github user kl0u commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the comments @aljoscha .&lt;/p&gt;</comment>
                            <comment id="15888580" author="kkl0u" created="Tue, 28 Feb 2017 18:09:32 +0000"  >&lt;p&gt;Merged at commit daf0ccda4dc60a267be7b8074d40e48d22ccb13f&lt;/p&gt;</comment>
                            <comment id="15888661" author="githubbot" created="Tue, 28 Feb 2017 18:53:18 +0000"  >&lt;p&gt;Github user kl0u closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3412&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13044487">FLINK-5845</subtask>
                            <subtask id="13044491">FLINK-5846</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38csf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>