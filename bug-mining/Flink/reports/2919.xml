<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:38:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11336] Flink HA didn&apos;t remove ZK metadata</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11336</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Flink HA didn&apos;t remove ZK metadata&lt;/p&gt;

&lt;p&gt;such as&#160;&lt;/p&gt;

&lt;p&gt;go to zk cli&#160; :&#160;ls /flinkone&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12954971/12954971_image-2019-01-15-19-42-21-902.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;i suggest we should delete this&#160;metadata when the application&#160; cancel or throw&#160;exception&lt;/p&gt;</description>
                <environment></environment>
        <key id="13209631">FLINK-11336</key>
            <summary>Flink HA didn&apos;t remove ZK metadata</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="shengjk1">shengjk1</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 15 Jan 2019 11:58:11 +0000</created>
                <updated>Fri, 1 Mar 2024 08:24:32 +0000</updated>
                            <resolved>Tue, 5 Mar 2019 15:52:20 +0000</resolved>
                                                    <fixVersion>1.8.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16745020" author="stephanewen" created="Thu, 17 Jan 2019 12:58:46 +0000"  >&lt;p&gt;Flink should remove the metadata when the job terminates, which means&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;finished (for batch and bounded streams)&lt;/li&gt;
	&lt;li&gt;failed with no further retries&lt;/li&gt;
	&lt;li&gt;cancelled&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It does not remove the metadata if you just kill the YARN application or stop all containers. In that case Flink does not know that this was not a failure, but an intended shutdown.&lt;/p&gt;

&lt;p&gt;Can you confirm that this was a proper termination (as described above).&lt;br/&gt;
If yes, which way did you start the Flink job?&lt;/p&gt;</comment>
                            <comment id="16745782" author="shengjk1" created="Fri, 18 Jan 2019 04:46:50 +0000"  >&lt;p&gt;Unfamiliar with batch and bounded streams,so&#160;Inconvenient conclusion but&#160; such as unbounded streams&lt;/p&gt;

&lt;p&gt;&#160;when&lt;/p&gt;

&lt;p&gt;&#160; &#160; failed with no further retries&lt;/p&gt;

&lt;p&gt;&#160; &#160; cancelled&lt;/p&gt;

&lt;p&gt;we can&#160;remove the metadata ,As for how to start, you can start normally.I have already tried it, no&#160;problems in&#160;1.8.0_151&#160; flink 1.7.1 CDH5.13.1&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16746275" author="stephanewen" created="Fri, 18 Jan 2019 13:22:22 +0000"  >&lt;p&gt;Sorry, I cannot follow. What is the behavior now you observed?&lt;/p&gt;</comment>
                            <comment id="16747322" author="shengjk1" created="Sun, 20 Jan 2019 03:11:03 +0000"  >&lt;p&gt;1.No matter what form stop flink, such&#160; as cancel,failed with no further retries,kill, metadata not be deleted.&lt;/p&gt;

&lt;p&gt;2.when&#160;cancel,failed with no further retries,kill,manually deleting metadata has no effect on newly launched programs even if there has a savepoint&lt;/p&gt;

&lt;p&gt;this is my&#160;observed&#160;behavior&lt;/p&gt;</comment>
                            <comment id="16748851" author="stephanewen" created="Tue, 22 Jan 2019 15:48:05 +0000"  >&lt;p&gt;What way did you start Flink?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;standalone&lt;/li&gt;
	&lt;li&gt;Yarn (per job or as a session)&lt;/li&gt;
	&lt;li&gt;Mesos&lt;/li&gt;
	&lt;li&gt;Container&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16749548" author="shengjk1" created="Wed, 23 Jan 2019 05:53:10 +0000"  >&lt;p&gt;Yarn (per job or as a session)&lt;/p&gt;</comment>
                            <comment id="16781618" author="shengjk1" created="Fri, 1 Mar 2019 12:27:23 +0000"  >&lt;p&gt;hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have other questions and suggestions:&lt;/p&gt;

&lt;p&gt;&#160;1. I want to know if&#160; will also delete invalid directories on HDFS, similar to zk metadata?&#160; because most of the metadata of HA is stored on HDFS. such as when&#160; job is failed.&lt;/p&gt;

&lt;p&gt;&#160;2. when the job is canceled, the job&apos;s metadata is&#160; deleted&#160;as default , but i think it also should&#160;&#160;delete the corresponding directory, such as &lt;tt&gt;jobId&lt;/tt&gt;/shared and &lt;tt&gt;jobId&lt;/tt&gt;/taskowned.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16781641" author="till.rohrmann" created="Fri, 1 Mar 2019 12:58:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shengjk1&quot; class=&quot;user-hover&quot; rel=&quot;shengjk1&quot;&gt;shengjk1&lt;/a&gt;, I think you are right that we should also delete the checkpoint directories &lt;tt&gt;jobid/shared&lt;/tt&gt; and &lt;tt&gt;jobId/taskowned&lt;/tt&gt; if the job reaches a globally terminal state.&lt;/p&gt;

&lt;p&gt;In order to not blow up the scope of this issue I would, however, suggest to create a separate issue for the cleanup of these directories. This issue tries to address the problems of the ZooKeeper meta data cleanup.&lt;/p&gt;</comment>
                            <comment id="16781656" author="till.rohrmann" created="Fri, 1 Mar 2019 13:09:09 +0000"  >&lt;p&gt;I&apos;ve opened the issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11789&quot; title=&quot;Checkpoint directories are not cleaned up after job termination&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11789&quot;&gt;FLINK-11789&lt;/a&gt; to track the checkpoint directory clean up &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shengjk1&quot; class=&quot;user-hover&quot; rel=&quot;shengjk1&quot;&gt;shengjk1&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16781683" author="shengjk1" created="Fri, 1 Mar 2019 13:45:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&#160;&#160;Yay, i think too, thank you&#160;&lt;/p&gt;</comment>
                            <comment id="16784591" author="till.rohrmann" created="Tue, 5 Mar 2019 15:52:20 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
1.9.0: 11a8234b50586d476371c64f9d751e8e65fdad0a&lt;br/&gt;
1.8.0: f53594d8aad42d1de44fa8a33acc043cbd4c1d57&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                                                <inwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13570429">FLINK-34557</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13194452">FLINK-10694</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13070762">FLINK-6522</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12954971" name="image-2019-01-15-19-42-21-902.png" size="138209" author="shengjk1" created="Tue, 15 Jan 2019 11:42:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|y000v4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>