<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-32976] NullPointException when starting flink cluster in standalone mode</title>
                <link>https://issues.apache.org/jira/browse/FLINK-32976</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It can be reproduced when starting flink cluster with hadoop configuration.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Set up hadoop conf , hadoop classpath
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// start jobManager
&lt;/span&gt;

./jobmanager.sh start-foreground &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The error message as follows:&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;Caused by: java.ang.NullPointerException
at org.apache.flink. runtime. security.token.hadoop.HadoopFSDelegationTokenProvider.getFileSystemsToAccess(HadoopFSDelegationTokenProvider.java:173)~[flink-dist-1.17.1.jar:1.17.1]
at org.apache.flink.runtime.security.token.hadoop.HadoopFSDelegationTokenProvidertionTokens$1(HadoopFSDelegationTokenProvider.java:113) ~[flink-dist-1.17.1.jar:1.17.1
at java.security.AccessController.doprivileged(Native Method)~[?:1.8.0 281]
at javax.security.auth.Subject.doAs(Subject.java:422)~[?:1.8.0 281]
at org. apache.hadoop . security.UserGroupInformation.doAs(UserGroupInformation. java:1876) ~flink-shacd-hadoop-3-uber-3.1.1.7.2.1.0-327-9.0.jar:3.1.1.7.2.1.0-327-9.0]
at org. apache.flink. runtime.security.token .hadoop .HadoopFSDelegationTokenProvider.obtainDelegationTcens(HadoopFSDelegationTokenProvider.java:108)~flink-dist-1.17.1.jar:1.17.1]
at org.apache.flink. runtime. security.token.DefaultDelegationTokenManager . lambda$obtainDel
SAndGetNextRenewal$1(DefaultDelegationTokenManager .java:264)~ flink-dist-1.17.1.jar:1.17.1]
at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193) ~?:1.8.0 281
at java.util.HashMap$ValueSpliterator.forEachRemaining(HashMap.java:1628)~[?:1.8.0 281]at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)~?:1.8.0 281]
at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472) ~?:1.8.0 281at java,util.stream.Reduce0ps$Reduce0p.evaluateSequential(Reduce0ps.java:708)~?:1.8.0 281]
at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)~[?:1.8.0 281]at java.util.stream.ReferencePipeline.reduce(ReferencePipeline.java:479) ~?:1.8.0 281
at java.util.stream.ReferencePipeline.min(ReferencePipeline.java:520)~?:1.8.0 281at org. apache. flink. runtime. security.token.DefaultDelegationTokenManager .obtainDelegationTokensAndGeNextRenewal(DefaultDelegationTokenManager .java:286)~[flink-dist-1.17.1.jar:1.17.1
at org.apache. flink.runtime. security.token.DefaultDelegationTokenManager. obtainDelegationTokens(DefaltDelegationTokenManager.java:242)~[flink-dist-1.17.1.jar:1.17.1]
at org.apache.flink.runtime.entrypoint.ClusterEntrypoint.initializes@) ~[flink-dist-1.17.1.jar:1.17.1]
at org.apache.flink.runtime.entrypoint.clusterEntrypoint.nk-dist-1.17.1.jar:1.17.1]
at org.apache.flink.runtime.entrypoint.ClusterEntrypoint:232) ~[flink-dist-1.17.1.jar:1.17.1]
at java.security.AccessController.doPrivileged(Native Method) ~[?:1.8. 281]
at javax.security.auth.Subject.doAs(Subject.java:422)~?:1.8.0 281]
at org. apache.hadoop . security.UserGroupInformation. doAs (UserGroupInformation. java:1876)~[flink-shadd-hadoop-3-uber-3.1.1.7.2.1.0-327-9.0.jar:3.1.1.7.2.1.0-327-9.0]
at org.apache.flink.runtime.security. contexts .HadoopSecurityContext.runSecured(HadoopSecurijava:41) ~[flink-dist-1.17.1.jar:1.17.1
at org. apache.flink. runtime. entrypoint. ClusterEntrypoint . startCluster(clusterEntrypoint. java:229)link-dist-1.17.1.jar:1.17.1]...2 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13548816">FLINK-32976</key>
            <summary>NullPointException when starting flink cluster in standalone mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hackergin">Feng Jin</assignee>
                                    <reporter username="hackergin">Feng Jin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 28 Aug 2023 09:55:56 +0000</created>
                <updated>Fri, 22 Sep 2023 08:51:39 +0000</updated>
                            <resolved>Fri, 22 Sep 2023 07:59:05 +0000</resolved>
                                    <version>1.17.1</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Runtime / Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17759601" author="martijnvisser" created="Mon, 28 Aug 2023 14:27:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hackergin&quot; class=&quot;user-hover&quot; rel=&quot;hackergin&quot;&gt;hackergin&lt;/a&gt; Please provide info on what you&apos;ve tried and how to reproduce this issue: there&apos;s currently not enough information to determine what&apos;s the issue&lt;/p&gt;</comment>
                            <comment id="17759670" author="hackergin" created="Mon, 28 Aug 2023 17:24:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;&#160; Sorry for the not clearly description. I have updated the reproducible steps.&#160; &#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The corresponding code for &#160;is as follows:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/hackergin/flink/blob/78136133fbec4ca145dec66d4bc0c324c8e16d82/flink-runtime/src/main/java/org/apache/flink/runtime/security/token/hadoop/HadoopFSDelegationTokenProvider.java#L173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hackergin/flink/blob/78136133fbec4ca145dec66d4bc0c324c8e16d82/flink-runtime/src/main/java/org/apache/flink/runtime/security/token/hadoop/HadoopFSDelegationTokenProvider.java#L173&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (flinkConfiguration.getString(DeploymentOptions.TARGET).toLowerCase().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;yarn&quot;&lt;/span&gt;)) {
    LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running on YARN, trying to add staging directory to file systems to access&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; yarnStagingDirectory =
            flinkConfiguration.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;yarn.staging-directory&quot;&lt;/span&gt;, &quot;&quot;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!StringUtils.isBlank(yarnStagingDirectory)) {
        LOG.debug(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;Adding staging directory to file systems to access {}&quot;&lt;/span&gt;,
                yarnStagingDirectory);
        result.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(yarnStagingDirectory).getFileSystem(hadoopConfiguration));
        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Staging directory added to file systems to access successfully&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        LOG.debug(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;Staging directory is not set or empty so not added to file systems to access&quot;&lt;/span&gt;);
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When starting the standalone cluster, since the TARGET parameter is not set, there is no check for the existence of TARGET, resulting in a null pointer error.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Therefore, we can easily fix this issue by adding a check.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Flink stand alone cluster with Hadoop configuration is not a common practice. Most Flink jobs are either run on YARN or on Kubernetes. In these two modes, the TARGET parameter is correctly set, so this issue does not occur.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17759917" author="martijnvisser" created="Tue, 29 Aug 2023 11:13:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaborgsomogyi&quot; class=&quot;user-hover&quot; rel=&quot;gaborgsomogyi&quot;&gt;gaborgsomogyi&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="17760024" author="gaborgsomogyi" created="Tue, 29 Aug 2023 16:28:30 +0000"  >&lt;p&gt;Yeah, DeploymentOptions.TARGET null check is the way to go. Thanks for reporting it.&lt;/p&gt;</comment>
                            <comment id="17760046" author="hackergin" created="Tue, 29 Aug 2023 17:20:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaborgsomogyi&quot; class=&quot;user-hover&quot; rel=&quot;gaborgsomogyi&quot;&gt;gaborgsomogyi&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;&#160; I would like to fix this this, please assign this issue to me.&#160;&lt;/p&gt;</comment>
                            <comment id="17767883" author="gaborgsomogyi" created="Fri, 22 Sep 2023 07:59:05 +0000"  >&lt;p&gt;1fb95c3 on master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1k1g8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>