<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7942] NPE when apply FilterJoinRule</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7942</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Test case &lt;b&gt;testFilterRule1&lt;/b&gt; fails due to a NPE &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.RuntimeException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; applying rule FilterJoinRule:FilterJoinRule:filter, args [rel#148:LogicalFilter.NONE(input=rel#146:Subset#12.NONE,condition=&amp;gt;=(AS(org$apache$flink$table$api$batch$table$Merger$$773bb962ee701f47b08bc74058c46bb3($1, AS(org$apache$flink$table$api$batch$table$Merger$$773bb962ee701f47b08bc74058c46bb3($1, $3), &lt;span class=&quot;code-quote&quot;&gt;&apos;c0&apos;&lt;/span&gt;)), &lt;span class=&quot;code-quote&quot;&gt;&apos;c1&apos;&lt;/span&gt;), 0)), rel#145:LogicalJoin.NONE(left=rel#143:Subset#10.NONE,right=rel#144:Subset#11.NONE,condition==($0, $2),joinType=left)]

	at org.apache.calcite.plan.volcano.VolcanoRuleCall.onMatch(VolcanoRuleCall.java:236)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.findBestExp(VolcanoPlanner.java:650)
	at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:368)
	at org.apache.flink.table.api.TableEnvironment.runVolcanoPlanner(TableEnvironment.scala:270)
	at org.apache.flink.table.api.BatchTableEnvironment.optimize(BatchTableEnvironment.scala:347)
	at org.apache.flink.table.utils.BatchTableTestUtil.verifyTable(TableTestBase.scala:186)
	testFilterRule1(FilterRuleTest.scala:63)	
Caused by: java.lang.NullPointerException
	at org.apache.calcite.plan.Strong.isNull(Strong.java:110)
	at org.apache.calcite.plan.Strong.anyNull(Strong.java:166)
	at org.apache.calcite.plan.Strong.isNull(Strong.java:114)
	at org.apache.calcite.plan.Strong.isNotTrue(Strong.java:99)
	at org.apache.calcite.plan.Strong.isNotTrue(Strong.java:84)
	at org.apache.calcite.plan.RelOptUtil.simplifyJoin(RelOptUtil.java:2354)
	at org.apache.calcite.rel.rules.FilterJoinRule.perform(FilterJoinRule.java:149)
	at org.apache.calcite.rel.rules.FilterJoinRule$FilterIntoJoinRule.onMatch(FilterJoinRule.java:348)
	at org.apache.calcite.plan.volcano.VolcanoRuleCall.onMatch(VolcanoRuleCall.java:212)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but &lt;b&gt;testFilterRule2&lt;/b&gt; works which has the same query written in SQL.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FilterRuleTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TableTestBase {

  @Test
  def testFilterRule1(): Unit = {
    val util = batchTestUtil()
    val t1 = util.addTable[(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Int, Int)](&lt;span class=&quot;code-quote&quot;&gt;&apos;a, &apos;&lt;/span&gt;b, &apos;c)
    val t2 = util.addTable[(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Int, Int)](&lt;span class=&quot;code-quote&quot;&gt;&apos;d, &apos;&lt;/span&gt;e, &apos;f)
    val results = t1
      .leftOuterJoin(t2, &lt;span class=&quot;code-quote&quot;&gt;&apos;b === &apos;&lt;/span&gt;e)
      .select(&lt;span class=&quot;code-quote&quot;&gt;&apos;c, Merger(&apos;&lt;/span&gt;c, &lt;span class=&quot;code-quote&quot;&gt;&apos;f) as &apos;&lt;/span&gt;c0)
      .select(Merger(&lt;span class=&quot;code-quote&quot;&gt;&apos;c, &apos;&lt;/span&gt;c0) as &apos;c1)
      .where(&apos;c1 &amp;gt;= 0)

    val expected = unaryNode(
      &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetCalc&quot;&lt;/span&gt;,
      binaryNode(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetJoin&quot;&lt;/span&gt;,
        unaryNode(
          &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetCalc&quot;&lt;/span&gt;,
          batchTableNode(0),
          term(&lt;span class=&quot;code-quote&quot;&gt;&quot;select&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;)
        ),
        unaryNode(
          &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetCalc&quot;&lt;/span&gt;,
          batchTableNode(1),
          term(&lt;span class=&quot;code-quote&quot;&gt;&quot;select&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;f&quot;&lt;/span&gt;)
        ),
        term(&lt;span class=&quot;code-quote&quot;&gt;&quot;where&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;=(b, e)&quot;&lt;/span&gt;),
        term(&lt;span class=&quot;code-quote&quot;&gt;&quot;join&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;f&quot;&lt;/span&gt;),
        term(&lt;span class=&quot;code-quote&quot;&gt;&quot;joinType&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;LeftOuterJoin&quot;&lt;/span&gt;)
      ),
      term(&lt;span class=&quot;code-quote&quot;&gt;&quot;select&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Merger$(c, Merger$(c, f)) AS c1&quot;&lt;/span&gt;),
      term(&lt;span class=&quot;code-quote&quot;&gt;&quot;where&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;=(Merger$(c, Merger$(c, f)), 0)&quot;&lt;/span&gt;)
    )

    util.verifyTable(results, expected)
  }

  @Test
  def testFilterRule2(): Unit = {
    val util = batchTestUtil()
    util.addTable[(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Int, Int)](&lt;span class=&quot;code-quote&quot;&gt;&quot;T1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;a, &apos;&lt;/span&gt;b, &apos;c)
    util.addTable[(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Int, Int)](&lt;span class=&quot;code-quote&quot;&gt;&quot;T2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;d, &apos;&lt;/span&gt;e, &apos;f)
    util.tableEnv.registerFunction(&lt;span class=&quot;code-quote&quot;&gt;&quot;udf_test&quot;&lt;/span&gt;, Merger)

    val sql =
      s&quot;&quot;&quot;
         |select c1
         |from (
         |  select udf_test(c, c0) as c1
         |  from (
         |    select c, udf_test(b, c) as c0
         |      from
         |      (select a, b, c
         |        from T1
         |        left &lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt; join T2
         |        on T1.b = T2.e
         |      ) tmp
         |  ) tmp1
         |) tmp2
         |where c1 &amp;gt;= 0
       &quot;&quot;&quot;.stripMargin

    val results = util.tableEnv.sqlQuery(sql)
    val expected = &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetCalc(select=[udf_test(c, udf_test(b, c)) AS c1]) \n&quot;&lt;/span&gt; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetJoin(where=[=(b, e)], join=[b, c, e], joinType=[LeftOuterJoin])\n&quot;&lt;/span&gt; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetCalc(select=[b, c], where=[&amp;gt;=(udf_test(c, udf_test(b, c)), 0)])\n&quot;&lt;/span&gt; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetScan(table=[[_DataSetTable_0]])\n&quot;&lt;/span&gt; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetCalc(select=[e])\n&quot;&lt;/span&gt; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;DataSetScan(table=[[_DataSetTable_1]])&quot;&lt;/span&gt;
    util.verifyTable(results, expected)
  }
}

object Merger &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ScalarFunction {
  def eval(f0: Int, f1: Int): Int = {
    f0 + f1
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A simple way to fix this is to change the calcite class &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; org.apache.calcite.plan.Strong&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;add an additional entry to the EnumMap in createPolicyMap method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;map.put(SqlKind.AS, Policy.AS_IS);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Either copy to Flink package and modify it  or using reflection somewhere.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if there exists other issues like this one since not all the types in SQLKind included in the Strong.MAP.&lt;br/&gt;
@&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;  @&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; any ideas?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13112950">FLINK-7942</key>
            <summary>NPE when apply FilterJoinRule</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lincoln.86xy">lincoln lee</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Oct 2017 06:47:56 +0000</created>
                <updated>Wed, 30 Jan 2019 10:36:29 +0000</updated>
                            <resolved>Wed, 30 Jan 2019 10:36:29 +0000</resolved>
                                                    <fixVersion>1.4.0</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16235700" author="fhueske" created="Thu, 2 Nov 2017 13:14:44 +0000"  >&lt;p&gt;Julian&apos;s response on &lt;a href=&quot;https://issues.apache.org/jira/browse/CALCITE-2023&quot; title=&quot;Add SqlKind.AS to policy map of org.apache.calcite.plan.Strong due to NPE when apply FilterJoinRule &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CALCITE-2023&quot;&gt;&lt;del&gt;CALCITE-2023&lt;/del&gt;&lt;/a&gt; suggests to generate &lt;tt&gt;RexNode&lt;/tt&gt; expressions without &lt;tt&gt;AS&lt;/tt&gt; nodes. &lt;br/&gt;
Maybe we can fix this in the Table API &lt;tt&gt;Expression&lt;/tt&gt; -&amp;gt; &lt;tt&gt;RexNode&lt;/tt&gt; translation.&lt;/p&gt;</comment>
                            <comment id="16251353" author="twalthr" created="Tue, 14 Nov 2017 13:13:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt; if it is ok, I would try to fix this issue? Maybe we can still get it into the next release.&lt;/p&gt;</comment>
                            <comment id="16253111" author="lincoln.86xy" created="Wed, 15 Nov 2017 08:36:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; It&apos;s great if you have time to fix this, I&apos;m on vocation now.&lt;/p&gt;</comment>
                            <comment id="16253293" author="githubbot" created="Wed, 15 Nov 2017 11:13:17 +0000"  >&lt;p&gt;GitHub user twalthr opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5019&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7942&quot; title=&quot;NPE when apply FilterJoinRule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7942&quot;&gt;&lt;del&gt;FLINK-7942&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Reduce aliasing in RexNodes&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR reduces the number of `AS` expressions in projects. This fixes the bug mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7942&quot; title=&quot;NPE when apply FilterJoinRule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7942&quot;&gt;&lt;del&gt;FLINK-7942&lt;/del&gt;&lt;/a&gt; with the `FilterJoinRule` and improves the plans. Many calc operations are not needed anymore. For multi-windows, the change caused some problems that are not trivial to fix, so they still use aliasing for resolving time attributes.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Remove explicit alias expression from RexNodes&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added testFilterJoinRule in JoinTest.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? not applicable&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/twalthr/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twalthr/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7942&quot; title=&quot;NPE when apply FilterJoinRule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7942&quot;&gt;&lt;del&gt;FLINK-7942&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5019.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5019.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5019&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 82356f22154c563fcd8bd018dd954fe274e7fe5f&lt;br/&gt;
Author: twalthr &amp;lt;twalthr@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-11-15T11:07:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7942&quot; title=&quot;NPE when apply FilterJoinRule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7942&quot;&gt;&lt;del&gt;FLINK-7942&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Reduce aliasing in RexNodes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16253379" author="githubbot" created="Wed, 15 Nov 2017 12:29:34 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5019#discussion_r151110174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5019#discussion_r151110174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/stream/table/OverWindowTest.scala &amp;#8212;&lt;br/&gt;
    @@ -203,19 +203,17 @@ class OverWindowTest extends TableTestBase {&lt;br/&gt;
             &quot;DataStreamCalc&quot;,&lt;br/&gt;
             unaryNode(&lt;br/&gt;
               &quot;DataStreamOverAggregate&quot;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;unaryNode(&lt;/li&gt;
	&lt;li&gt;&quot;DataStreamCalc&quot;,&lt;/li&gt;
	&lt;li&gt;streamTableNode(0),&lt;/li&gt;
	&lt;li&gt;term(&quot;select&quot;, &quot;a&quot;, &quot;c&quot;, &quot;proctime&quot;)&lt;/li&gt;
	&lt;li&gt;),&lt;br/&gt;
    +          streamTableNode(0),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The new plan is less efficient, because a projection isn&apos;t pushed down anymore and a wider row needs to be materialized in the over window.&lt;/p&gt;</comment>
                            <comment id="16253654" author="githubbot" created="Wed, 15 Nov 2017 15:41:56 +0000"  >&lt;p&gt;Github user twalthr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5019&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @fhueske. I simplified the changes a bit more. Now we use explicit aliases only for windows and the alias operator. &lt;/p&gt;</comment>
                            <comment id="16253814" author="githubbot" created="Wed, 15 Nov 2017 17:08:34 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5019&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good. +1 to merge&lt;/p&gt;</comment>
                            <comment id="16253840" author="githubbot" created="Wed, 15 Nov 2017 17:30:10 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5019&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16253849" author="twalthr" created="Wed, 15 Nov 2017 17:37:03 +0000"  >&lt;p&gt;Fixed in 1.5: b6a2dc345f37c4b643789e98d02e23a022d31415&lt;br/&gt;
Fixed in 1.4: 13962e1ffda62218031bf426ee9c06146c7c5573&lt;/p&gt;</comment>
                            <comment id="16622869" author="mcrystal" created="Thu, 20 Sep 2018 23:31:09 +0000"  >&lt;p&gt;I know that this is marked as resolved, but I&apos;m wondering if there was a regression or if the are other codepaths that may still exhibit this issue.&#160; I am running flink 1.6.1 and am seeing the same stack trace as above (included below).  I don&apos;t have a standalone test yet (the code is a bit involved in that the actual joins and projections are controlled by external configurations in this case), but the sequence of events is basically as follows:&lt;/p&gt;

&lt;p&gt;1. A table, T1, is registered with the table env using a CsvTableSource&lt;br/&gt;
2. A second table, T2, is registered with the env using a CsvTableSource.  &lt;br/&gt;
3. The columns in T2 are aliased (using the .as(String)) method to ensure that there are no name clashes during the join.&lt;br/&gt;
4. T2 is joined to T1 using a single equality join condition and then the desired columns are selected.&lt;br/&gt;
5. The columns of the result of step 4, J1, are renamed back to the &apos;expected&apos; names using the .as(String) method&lt;br/&gt;
6. The data is J1 is filtered&lt;br/&gt;
7. The filtered table is then joined to another table, T3, using the same process as in steps 3 - 5&lt;br/&gt;
8. Another table, T4, is also joined using the process as in steps 3 - 5&lt;br/&gt;
8. The resultant table is then grouped/aggregated&lt;br/&gt;
9. The resultant table is then filtered &lt;br/&gt;
10. The final table is sent to a sink for writing to disk&lt;/p&gt;

&lt;p&gt;Also, as a sanity check, I performed the hack mentioned above (modifying the calcite class to have map.put(SqlKind.AS, Policy.AS_IS)&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and the code then worked as expected.&lt;/p&gt;


&lt;p&gt;java.lang.RuntimeException: Error while applying rule FilterJoinRule:FilterJoinRule:filter, args &lt;a href=&quot;#468:Subset#41.NONE,condition==(AS($5, _UTF-16LE&amp;#39;level&amp;#39;), _UTF-16LE&amp;#39;Level 1&amp;#39;)), rel#467:LogicalJoin.NONE(left=rel#465:Subset#39.NONE,right=rel#466:Subset#40.NONE,condition==($1, $3),joinType=left)&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;rel#771:LogicalFilter.NONE(input=rel#468:Subset#41.NONE,condition==(AS($5, _UTF-16LE&apos;level&apos;), _UTF-16LE&apos;Level 1&apos;)), rel#467:LogicalJoin.NONE(left=rel#465:Subset#39.NONE,right=rel#466:Subset#40.NONE,condition==($1, $3),joinType=left)&lt;/a&gt;&lt;br/&gt;
                at org.apache.calcite.plan.volcano.VolcanoRuleCall.onMatch(VolcanoRuleCall.java:236)&lt;br/&gt;
                at org.apache.calcite.plan.volcano.VolcanoPlanner.findBestExp(VolcanoPlanner.java:650)&lt;br/&gt;
                at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:368)&lt;br/&gt;
                at org.apache.flink.table.api.TableEnvironment.runVolcanoPlanner(TableEnvironment.scala:271)&lt;br/&gt;
                at org.apache.flink.table.api.BatchTableEnvironment.optimize(BatchTableEnvironment.scala:478)&lt;br/&gt;
                at org.apache.flink.table.api.BatchTableEnvironment.translate(BatchTableEnvironment.scala:511)&lt;br/&gt;
                at org.apache.flink.table.api.BatchTableEnvironment.writeToSink(BatchTableEnvironment.scala:311)&lt;br/&gt;
                at org.apache.flink.table.api.Table.writeToSink(table.scala:862)&lt;br/&gt;
                at org.apache.flink.table.api.Table.writeToSink(table.scala:830)&lt;br/&gt;
...&lt;br/&gt;
Caused by: java.lang.NullPointerException: null&lt;br/&gt;
                at org.apache.calcite.plan.Strong.isNull(Strong.java:110)&lt;br/&gt;
                at org.apache.calcite.plan.Strong.anyNull(Strong.java:166)&lt;br/&gt;
                at org.apache.calcite.plan.Strong.isNull(Strong.java:114)&lt;br/&gt;
                at org.apache.calcite.plan.Strong.isNotTrue(Strong.java:99)&lt;br/&gt;
                at org.apache.calcite.plan.Strong.isNotTrue(Strong.java:84)&lt;br/&gt;
                at org.apache.calcite.plan.RelOptUtil.simplifyJoin(RelOptUtil.java:2353)&lt;br/&gt;
                at org.apache.calcite.rel.rules.FilterJoinRule.perform(FilterJoinRule.java:149)&lt;br/&gt;
                at org.apache.calcite.rel.rules.FilterJoinRule$FilterIntoJoinRule.onMatch(FilterJoinRule.java:348)&lt;br/&gt;
                at org.apache.calcite.plan.volcano.VolcanoRuleCall.onMatch(VolcanoRuleCall.java:212)&lt;br/&gt;
                ... 21 common frames omitted&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="13112955">CALCITE-2023</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lur3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>