<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6397] MultipleProgramsTestBase does not reset ContextEnvironment</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6397</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The MultipleProgramsTestBase sets a new TestEnvironment as a context environment but never explicitly unsets it, which can result subsequent tests categorically failing.&lt;/p&gt;

&lt;p&gt;The CustomDistributionITCase doesn&apos;t unset the context either; and some streaming test that i haven&apos;t quite nailed down yet.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13067409">FLINK-6397</key>
            <summary>MultipleProgramsTestBase does not reset ContextEnvironment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="SleePy">Biao Liu</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Apr 2017 14:54:47 +0000</created>
                <updated>Wed, 2 Oct 2019 17:50:48 +0000</updated>
                            <resolved>Sat, 13 May 2017 19:49:37 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15988079" author="sleepy" created="Fri, 28 Apr 2017 02:31:32 +0000"  >&lt;p&gt;I would like to fix this problem.&lt;br/&gt;
But I didn&apos;t find the &lt;tt&gt;ClusterDistributionITCase&lt;/tt&gt; in master branch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15988264" author="zentol" created="Fri, 28 Apr 2017 05:58:02 +0000"  >&lt;p&gt;It&apos;s called &lt;/p&gt;
{CustomDistributionITCase}
&lt;p&gt;, fixing the description now.&lt;/p&gt;</comment>
                            <comment id="15999660" author="githubbot" created="Sun, 7 May 2017 02:58:09 +0000"  >&lt;p&gt;Github user ifndef-SleePy commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810#discussion_r115133175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810#discussion_r115133175&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-test-utils-parent/flink-test-utils/src/main/java/org/apache/flink/test/util/MultipleProgramsTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -80,29 +80,36 @@&lt;/p&gt;

&lt;p&gt;     	protected final TestExecutionMode mode;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +	private TestEnvironment testEnvironment;&lt;br/&gt;
    +&lt;br/&gt;
    +	private CollectionTestEnvironment collectionTestEnvironment;&lt;br/&gt;
    +&lt;br/&gt;
     	public MultipleProgramsTestBase(TestExecutionMode mode) {&lt;br/&gt;
     		this.mode = mode;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
     		switch(mode){&lt;br/&gt;
     			case CLUSTER:&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;new TestEnvironment(cluster, 4).setAsContext();&lt;br/&gt;
    +				testEnvironment = new TestEnvironment(cluster, 4);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @zentol I just found that I can not move these codes into &amp;#64;Before method, because it will not work with JUnit Parameterized. I proposal to keep these codes in constructor. What do you think?&lt;/p&gt;</comment>
                            <comment id="15999661" author="githubbot" created="Sun, 7 May 2017 03:08:18 +0000"  >&lt;p&gt;Github user ifndef-SleePy commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think Till has implemented a static unsetAsContext method in TestEnvironment recently. I rebased the implementation from master, and recommit the pull request.&lt;/p&gt;</comment>
                            <comment id="15999662" author="sleepy" created="Sun, 7 May 2017 03:11:59 +0000"  >&lt;p&gt;Somehow the pull request did not been connected with jira. Maybe because I did not write the right title at beginning.&lt;/p&gt;</comment>
                            <comment id="15999736" author="githubbot" created="Sun, 7 May 2017 08:44:46 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810#discussion_r115137365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810#discussion_r115137365&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-test-utils-parent/flink-test-utils/src/main/java/org/apache/flink/test/util/MultipleProgramsTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -80,29 +80,36 @@&lt;/p&gt;

&lt;p&gt;     	protected final TestExecutionMode mode;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +	private TestEnvironment testEnvironment;&lt;br/&gt;
    +&lt;br/&gt;
    +	private CollectionTestEnvironment collectionTestEnvironment;&lt;br/&gt;
    +&lt;br/&gt;
     	public MultipleProgramsTestBase(TestExecutionMode mode) {&lt;br/&gt;
     		this.mode = mode;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
     		switch(mode){&lt;br/&gt;
     			case CLUSTER:&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;new TestEnvironment(cluster, 4).setAsContext();&lt;br/&gt;
    +				testEnvironment = new TestEnvironment(cluster, 4);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Could you try this instead: &lt;a href=&quot;https://github.com/junit-team/junit4/issues/45#issuecomment-6422143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/junit-team/junit4/issues/45#issuecomment-6422143&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16000236" author="githubbot" created="Mon, 8 May 2017 04:10:34 +0000"  >&lt;p&gt;Github user ifndef-SleePy commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810#discussion_r115170542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810#discussion_r115170542&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-test-utils-parent/flink-test-utils/src/main/java/org/apache/flink/test/util/MultipleProgramsTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -80,29 +80,36 @@&lt;/p&gt;

&lt;p&gt;     	protected final TestExecutionMode mode;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +	private TestEnvironment testEnvironment;&lt;br/&gt;
    +&lt;br/&gt;
    +	private CollectionTestEnvironment collectionTestEnvironment;&lt;br/&gt;
    +&lt;br/&gt;
     	public MultipleProgramsTestBase(TestExecutionMode mode) {&lt;br/&gt;
     		this.mode = mode;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
     		switch(mode){&lt;br/&gt;
     			case CLUSTER:&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;new TestEnvironment(cluster, 4).setAsContext();&lt;br/&gt;
    +				testEnvironment = new TestEnvironment(cluster, 4);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thank you for responding. Last my comment is not correct. Actually what I want to say is that we can not move these code to &amp;#64;BeforeClass and &amp;#64;AfterClass. But we can move them to &amp;#64;Before and &amp;#64;After, however it will bring a little overhead since &amp;#64;Before and &amp;#64;After will be called for each test method. I pushed a new commit using &amp;#64;Before and &amp;#64;After.&lt;/p&gt;</comment>
                            <comment id="16000903" author="githubbot" created="Mon, 8 May 2017 15:21:57 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810#discussion_r115274563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810#discussion_r115274563&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-test-utils-parent/flink-test-utils/src/main/java/org/apache/flink/test/util/MultipleProgramsTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -97,6 +105,12 @@ public MultipleProgramsTestBase(TestExecutionMode mode) {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	@After&lt;br/&gt;
    +	public void teardownEnvironment() {&lt;br/&gt;
    +		TestEnvironment.unsetAsContext();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    you could add another switch here, instead of calling both methods every time.&lt;/p&gt;</comment>
                            <comment id="16000904" author="githubbot" created="Mon, 8 May 2017 15:21:58 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810#discussion_r115274387&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810#discussion_r115274387&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-test-utils-parent/flink-test-utils/src/main/java/org/apache/flink/test/util/CollectionTestEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -49,7 +49,7 @@ public JobExecutionResult execute(String jobName) throws Exception &lt;/p&gt;
{
     		return result;
     	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected void setAsContext() {&lt;br/&gt;
    +	public void setAsContext() {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    do we still need this change?&lt;/p&gt;</comment>
                            <comment id="16001936" author="githubbot" created="Tue, 9 May 2017 02:23:22 +0000"  >&lt;p&gt;Github user ifndef-SleePy commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi, I updated this review. I don&apos;t know why there is no reminding in jira and email.&lt;/p&gt;</comment>
                            <comment id="16002229" author="githubbot" created="Tue, 9 May 2017 07:50:47 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    We don&apos;t get notifications about pushed commits in general, only for comments and created/closed pull requests.&lt;/p&gt;</comment>
                            <comment id="16004394" author="githubbot" created="Wed, 10 May 2017 09:36:10 +0000"  >&lt;p&gt;Github user ifndef-SleePy commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    OK, got it. Thank you for explanation. Is there any more problems with this pull request?&lt;/p&gt;</comment>
                            <comment id="16004424" author="githubbot" created="Wed, 10 May 2017 09:59:58 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Not quite; the `CassandraConnectorITCase` was broken in the process. This test contains both batch and streaming jobs that rely on different TestEnvironments. When the batch `TestEnvironment` is set as the context the streaming tests will fail.&lt;/p&gt;

&lt;p&gt;    `StreamExecutionEnvironment#getExecutionEnvironment()` doesn&apos;t account for this case, and tries to create a `LocalStreamEnvironment` which however fails since no explicit environment may be create when a context environment was set.&lt;/p&gt;

&lt;p&gt;    This is more or less a problem of the cassandra test; it shouldn&apos;t actually run any streaming jobs. Let me fix that, then we&apos;ll get back to this PR.&lt;/p&gt;

&lt;p&gt;    Besides that i don&apos;t see any problems right now.&lt;/p&gt;</comment>
                            <comment id="16008758" author="githubbot" created="Fri, 12 May 2017 21:51:05 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve fixed the cassandra tests, would be great if you could rebase this PR. You should be able to discard all changes to the cassandra tests in this PR.&lt;/p&gt;</comment>
                            <comment id="16009102" author="githubbot" created="Sat, 13 May 2017 03:38:11 +0000"  >&lt;p&gt;Github user ifndef-SleePy commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Nice work!&lt;br/&gt;
    I have rebased master.&lt;/p&gt;</comment>
                            <comment id="16009384" author="githubbot" created="Sat, 13 May 2017 15:47:33 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging.&lt;/p&gt;</comment>
                            <comment id="16009490" author="githubbot" created="Sat, 13 May 2017 19:47:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3810&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16009495" author="zentol" created="Sat, 13 May 2017 19:49:37 +0000"  >&lt;p&gt;1.3: 36edac4b16993459dedf9f76d05f9e96b918c783&lt;br/&gt;
1.4: 707f25fdf9800e4113661c8d774bfcdc5d9c51d1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3e6xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>