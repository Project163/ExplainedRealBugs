<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:19:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2074] Sliding Window Keeps Emitting Elements After Source Stops Producing</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2074</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This happens when the source produces some elements, then the source stops for a while and then produces again some elements before stopping again. After this, the window will just keep emitting the last emitted element indefinitely.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12831735">FLINK-2074</key>
            <summary>Sliding Window Keeps Emitting Elements After Source Stops Producing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2015 13:38:56 +0000</created>
                <updated>Thu, 28 Feb 2019 11:15:32 +0000</updated>
                            <resolved>Tue, 26 May 2015 09:04:38 +0000</resolved>
                                    <version>0.9</version>
                                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14554281" author="aljoscha" created="Thu, 21 May 2015 13:42:06 +0000"  >&lt;p&gt;You can try it with this modified example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;WindowWordCount {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
		env.setParallelism(1);

		DataStream&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; text = env.socketTextStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, 9999);

		text.flatMap(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WordCount.Tokenizer())
				.window(Time.of(4, TimeUnit.SECONDS)).every(Time.of(2, TimeUnit.SECONDS))
				.sum(1)
				.flatten()
				.print();

		env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;WindowWordCount&quot;&lt;/span&gt;);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start the socket, emit some values, pause, emit some more values, pause. Then the window keeps emitting.&lt;/p&gt;</comment>
                            <comment id="14556102" author="ggevay" created="Fri, 22 May 2015 12:45:55 +0000"  >&lt;p&gt;I did some debugging on this, and although I don&apos;t understand a lots of things in the relevant code, I think I found one problem:&lt;/p&gt;

&lt;p&gt;In SlidingTimePreReducer, when an element is given to timestampWrapper.getTimestamp, it is not returning the same timestamp that is used in TimeEvictionPolicy and TimeTriggerPolicy to determine the windows, because it ultimately calls SystemTimestamp.getTimestamp, which just returns System.currentTimeMillis().&lt;/p&gt;

&lt;p&gt;This might cause a bug in SlidingTimePreReducer.currentEligible, because that function determines when to close a preaggregate and start a new one, and so an element can get into the preaggregate of a later window than what the policy is saying (if it is before the end of a window by just a few milliseconds, and this call happens a few milliseconds later then the getTimestamp call in the policies).&lt;/p&gt;

&lt;p&gt;Another place where this can cause trouble is SlidingTimePreReducer.afterEmit. I really have no idea how the condition of the inner if can ever be false, but it is most likely not checking what it was intended to check, as timestampWrapper.getTimestamp(lastStored) won&apos;t return the timestamp of the last stored element, but will return the current system time instead.&lt;/p&gt;

&lt;p&gt;Unfortunately this is not causing the bug that this Jira is describing, as this can occur only rarely, but the Jira is easy to reproduce.&lt;/p&gt;</comment>
                            <comment id="14556115" author="aljoscha" created="Fri, 22 May 2015 13:12:05 +0000"  >&lt;p&gt;Thanks for looking into this. Although these issues might not be related to the bug at hand we certainly need to address these in the future.&lt;/p&gt;</comment>
                            <comment id="14556231" author="aljoscha" created="Fri, 22 May 2015 14:33:19 +0000"  >&lt;p&gt;I think I found the bug and fixed it. I&apos;ll do the pull request once checks are through on travis.&lt;/p&gt;</comment>
                            <comment id="14556352" author="githubbot" created="Fri, 22 May 2015 15:51:18 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2074&quot; title=&quot;Sliding Window Keeps Emitting Elements After Source Stops Producing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2074&quot;&gt;&lt;del&gt;FLINK-2074&lt;/del&gt;&lt;/a&gt; Fix erroneous emission of Sliding Time PreReducer&lt;/p&gt;

&lt;p&gt;    Before this, a sliding time window would keep emitting the last result&lt;br/&gt;
    because the number of elements per pre-aggregation result was not&lt;br/&gt;
    correctly reset on eviction.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; streaming-time-window-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #716&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 17e0d782a83dd05da0fc4cfbb52efa260a36e54b&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-05-22T14:30:58Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2074&quot; title=&quot;Sliding Window Keeps Emitting Elements After Source Stops Producing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2074&quot;&gt;&lt;del&gt;FLINK-2074&lt;/del&gt;&lt;/a&gt; Fix erroneous emission of Sliding Time PreReducer&lt;/p&gt;

&lt;p&gt;    Before this, a sliding time window would keep emitting the last result&lt;br/&gt;
    because the number of elements per pre-aggregation result was not&lt;br/&gt;
    correctly reset on eviction.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14556380" author="githubbot" created="Fri, 22 May 2015 16:16:27 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716#issuecomment-104702211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716#issuecomment-104702211&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Is there an easy way to add a test for this?&lt;/p&gt;</comment>
                            <comment id="14556410" author="githubbot" created="Fri, 22 May 2015 16:36:11 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716#issuecomment-104706869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716#issuecomment-104706869&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t know, all this time we had the wrong behaviour and no tests were catching it.&lt;/p&gt;</comment>
                            <comment id="14556414" author="githubbot" created="Fri, 22 May 2015 16:39:25 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716#issuecomment-104708161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716#issuecomment-104708161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thats actually a compelling case for adding a test. &lt;br/&gt;
    Also it seems that you are planning to rework a lot of the windowing stuff .. The more tests you have there, the easier your rework will be.&lt;/p&gt;</comment>
                            <comment id="14558260" author="githubbot" created="Mon, 25 May 2015 13:35:08 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716#issuecomment-105233972&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716#issuecomment-105233972&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @rmetzger I added tests for both SlidingTimePreReducer and SlidingTimeGroupedPreReducer to verify that they correctly flush their states after a burst of elements.&lt;/p&gt;</comment>
                            <comment id="14558371" author="githubbot" created="Mon, 25 May 2015 16:21:37 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716#issuecomment-105260996&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716#issuecomment-105260996&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Amazing, thank you.&lt;/p&gt;

&lt;p&gt;    +1 to merge.&lt;/p&gt;</comment>
                            <comment id="14558847" author="githubbot" created="Tue, 26 May 2015 08:21:50 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/716&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/716&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f1rj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>