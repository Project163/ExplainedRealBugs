<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6884] Incompatible TableSource#getReturnType and actual input type should fail faster</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6884</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When a &lt;tt&gt;TableSource#getReturnType&lt;/tt&gt; differs from the actual input type the exception is thrown in code generation step with an exception that is hard to track back:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.flink.table.codegen.CodeGenException: Arity of result type does not match number of expressions.
	at org.apache.flink.table.codegen.CodeGenerator.generateResultExpression(CodeGenerator.scala:940)
	at org.apache.flink.table.codegen.CodeGenerator.generateConverterResultExpression(CodeGenerator.scala:883)
	at org.apache.flink.table.plan.nodes.CommonScan$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;generatedConversionFunction(CommonScan.scala:57)
	at org.apache.flink.table.plan.nodes.datastream.StreamTableSourceScan.generatedConversionFunction(StreamTableSourceScan.scala:35)
	at org.apache.flink.table.plan.nodes.datastream.StreamScan$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;convertToInternalRow(StreamScan.scala:48)
	at org.apache.flink.table.plan.nodes.datastream.StreamTableSourceScan.convertToInternalRow(StreamTableSourceScan.scala:35)
	at org.apache.flink.table.plan.nodes.datastream.StreamTableSourceScan.translateToPlan(StreamTableSourceScan.scala:107)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be nice if more meaningful exception was thrown earlier.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13078869">FLINK-6884</key>
            <summary>Incompatible TableSource#getReturnType and actual input type should fail faster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunjincheng121">sunjincheng</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 Jun 2017 14:22:42 +0000</created>
                <updated>Tue, 1 Oct 2019 15:39:07 +0000</updated>
                            <resolved>Wed, 14 Jun 2017 09:36:07 +0000</resolved>
                                    <version>1.3.0</version>
                                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16045587" author="sunjincheng121" created="Sat, 10 Jun 2017 15:53:09 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;  you are right, we can improve the error message, such as add the &lt;tt&gt;Arity value&lt;/tt&gt;, &lt;tt&gt;expression number vaue&lt;/tt&gt; ,&lt;tt&gt;result type&lt;/tt&gt; and &lt;tt&gt;expressiongs&lt;/tt&gt;. &lt;br/&gt;
In fact there are a couple of exception message need to improved in `generateResultExpression` method. Such as &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Arity of result type does not match number of expressions.&lt;/li&gt;
	&lt;li&gt;Arity of result field names does not match number of expressions.&lt;/li&gt;
	&lt;li&gt;Incompatible types of expression and result type.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, I will improve those messages as much as possible. &lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
SunJincheng&lt;/p&gt;
</comment>
                            <comment id="16045608" author="sunjincheng121" created="Sat, 10 Jun 2017 16:52:09 +0000"  >&lt;p&gt;The &lt;tt&gt;generateResultExpression&lt;/tt&gt; is called by &lt;tt&gt;generateConverterResultExpression&lt;/tt&gt; method which calculate the list of expressions&#65292;So I think we can only improve the error message. What do you think? &lt;/p&gt;</comment>
                            <comment id="16045612" author="githubbot" created="Sat, 10 Jun 2017 16:57:33 +0000"  >&lt;p&gt;GitHub user sunjincheng121 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6884&quot; title=&quot;Incompatible TableSource#getReturnType and actual input type should fail faster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6884&quot;&gt;&lt;del&gt;FLINK-6884&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Improve confused exception information.&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6884&quot; title=&quot;Incompatible TableSource#getReturnType and actual input type should fail faster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6884&quot;&gt;&lt;del&gt;FLINK-6884&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Improve confused exception information.&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sunjincheng121/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sunjincheng121/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6884&quot; title=&quot;Incompatible TableSource#getReturnType and actual input type should fail faster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6884&quot;&gt;&lt;del&gt;FLINK-6884&lt;/del&gt;&lt;/a&gt;-PR&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4100&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6215b5d1606c39ca29b4897d0d4ffacdf30cc7cb&lt;br/&gt;
Author: sunjincheng121 &amp;lt;sunjincheng121@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-06-10T16:54:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6884&quot; title=&quot;Incompatible TableSource#getReturnType and actual input type should fail faster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6884&quot;&gt;&lt;del&gt;FLINK-6884&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Improve confused exception information.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16045679" author="githubbot" created="Sat, 10 Jun 2017 20:17:34 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100#discussion_r121265361&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100#discussion_r121265361&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/api/TableEnvironment.scala &amp;#8212;&lt;br/&gt;
    @@ -718,16 +718,20 @@ abstract class TableEnvironment(val config: TableConfig) {&lt;br/&gt;
         // validate that at least the field types of physical and logical type match&lt;br/&gt;
         // we do that here to make sure that plan translation was correct&lt;br/&gt;
         if (schema.physicalTypeInfo != inputTypeInfo) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw TableException(&quot;The field types of physical and logical row types do not match.&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;This is a bug and should not happen. Please file an issue.&quot;)&lt;br/&gt;
    +      throw TableException(&lt;br/&gt;
    +        s&quot;The field types of physical and logical row types do not match. &quot; +&lt;br/&gt;
    +        s&quot;Physical type is &lt;span class=&quot;error&quot;&gt;&amp;#91;${schema.physicalTypeInfo}&amp;#93;&lt;/span&gt;, Logical type is &lt;span class=&quot;error&quot;&gt;&amp;#91;${inputTypeInfo}&amp;#93;&lt;/span&gt;. &quot; +&lt;br/&gt;
    +        s&quot;This is a bug and should not happen. Please file an issue.&quot;)&lt;br/&gt;
         }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         val fieldTypes = schema.physicalFieldTypeInfo&lt;br/&gt;
         val fieldNames = schema.physicalFieldNames&lt;/p&gt;

&lt;p&gt;         // validate requested type&lt;br/&gt;
         if (requestedTypeInfo.getArity != fieldTypes.length) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new TableException(&quot;Arity of result does not match requested type.&quot;)&lt;br/&gt;
    +      throw new TableException(&lt;br/&gt;
    +        s&quot;Arity&lt;span class=&quot;error&quot;&gt;&amp;#91;${requestedTypeInfo.getArity}&amp;#93;&lt;/span&gt; of result&lt;span class=&quot;error&quot;&gt;&amp;#91;${requestedTypeInfo}&amp;#93;&lt;/span&gt; does not match &quot; +
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Result and requested types need to be switched.&lt;/p&gt;</comment>
                            <comment id="16045680" author="githubbot" created="Sat, 10 Jun 2017 20:17:34 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100#discussion_r121265430&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100#discussion_r121265430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/CodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -936,32 +936,42 @@ class CodeGenerator(&lt;br/&gt;
           resultFieldNames: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;br/&gt;
         : GeneratedExpression = {&lt;br/&gt;
         // initial type check&lt;br/&gt;
    +    //s&quot;requested: $requestedTypeInfo; Actual: $fType&quot;)&lt;br/&gt;
         if (returnType.getArity != fieldExprs.length) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new CodeGenException(&quot;Arity of result type does not match number of expressions.&quot;)&lt;br/&gt;
    +      throw new CodeGenException(&lt;br/&gt;
    +        s&quot;Arity&lt;span class=&quot;error&quot;&gt;&amp;#91;${returnType.getArity}&amp;#93;&lt;/span&gt; of result type&lt;span class=&quot;error&quot;&gt;&amp;#91;$returnType}&amp;#93;&lt;/span&gt; does not match &quot; +
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `type&lt;span class=&quot;error&quot;&gt;&amp;#91;$returnType}&amp;#93;&lt;/span&gt;` needs a `&lt;/p&gt;
{` (or `}
&lt;p&gt;` should be removed)&lt;/p&gt;</comment>
                            <comment id="16045843" author="githubbot" created="Sun, 11 Jun 2017 06:01:11 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    HI @fhueske Thanks very much for your reviewing. Update the PR. according your comments.&lt;/p&gt;

&lt;p&gt;    Best,&lt;br/&gt;
    SunJincheng&lt;/p&gt;</comment>
                            <comment id="16045881" author="githubbot" created="Sun, 11 Jun 2017 09:37:29 +0000"  >&lt;p&gt;Github user wuchong commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good job! &lt;br/&gt;
    +1 to merge&lt;/p&gt;</comment>
                            <comment id="16047352" author="githubbot" created="Tue, 13 Jun 2017 02:37:31 +0000"  >&lt;p&gt;Github user wuchong commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging...&lt;/p&gt;</comment>
                            <comment id="16048939" author="githubbot" created="Wed, 14 Jun 2017 09:35:13 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4100&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16048940" author="jark" created="Wed, 14 Jun 2017 09:36:07 +0000"  >&lt;p&gt;Fixed in 59bd8bec1a47fbf120d0df91d1de988c090ab0f6&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3g4sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>