<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:56:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22239] Improve support for JdbcXaSinkFunction</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22239</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;JdbcXaSinkFunction uses Xa protocol/interface to implement exactly-once guarantee (within each subtask partition).&lt;/p&gt;

&lt;p&gt;Xa is a protocol/interface designed for two-phase commit of distributed DBS (RMs).&lt;br/&gt;
XA guarantees that transactional updates are committed in all of the participating databases, or are fully rolled back out of all of the databases, reverting to the state prior to the start of the transaction.&lt;/p&gt;

&lt;p&gt;Hence some of the dbs that support XA treats XA transaction as global trans, and some of them does not support multiple global trans (per connection) at a time, MYSQL for example (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21743&quot; title=&quot;JdbcXaSinkFunction throws XAER_RMFAIL when calling snapshotState and beginTx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21743&quot;&gt;&lt;del&gt;FLINK-21743&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;This ticket is a follow-up to address such limitations.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13371589">FLINK-22239</key>
            <summary>Improve support for JdbcXaSinkFunction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="ym">Yuan Mei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 12 Apr 2021 11:28:22 +0000</created>
                <updated>Wed, 8 Sep 2021 09:58:44 +0000</updated>
                            <resolved>Tue, 20 Apr 2021 20:17:03 +0000</resolved>
                                                    <fixVersion>1.13.0</fixVersion>
                                    <component>Connectors / JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17319920" author="ym" created="Tue, 13 Apr 2021 06:04:06 +0000"  >&lt;p&gt;Possible solution:&lt;/p&gt;

&lt;p&gt;Maintain a pool of connections to DB per sink task to simulate multiple xa transactions per sink task&lt;/p&gt;</comment>
                            <comment id="17324168" author="ym" created="Sat, 17 Apr 2021 04:18:46 +0000"  >&lt;p&gt;I am reviewing the fix-PR,&lt;/p&gt;

&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22311&quot; title=&quot;Flink JDBC XA connector need to set maxRetries to 0 to properly working&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22311&quot;&gt;&lt;del&gt;FLINK-22311&lt;/del&gt;&lt;/a&gt; (a bug report from user using this feature connecting to Oracle), I suggest releasing the feature after manually testing the fix with &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/15627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/15627&lt;/a&gt; (along with the failover part)&lt;/p&gt;

&lt;p&gt;1. Postgres&lt;br/&gt;
2. MySQL&lt;br/&gt;
3. Oracle &lt;/p&gt;

&lt;p&gt;with proper documentation.&lt;/p&gt;</comment>
                            <comment id="17326085" author="roman_khachatryan" created="Tue, 20 Apr 2021 20:17:03 +0000"  >&lt;p&gt;Merged into 1.13 as 9e4e14adef2014f4c0b3dda1967f2811a5610723.&lt;br/&gt;
Merged into master as 3482390d7d9cca0f6e8c9d201730a9d02fe2ec8e.&lt;/p&gt;</comment>
                            <comment id="17380505" author="maver1ck" created="Wed, 14 Jul 2021 11:07:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; &lt;br/&gt;
 Changing defaults from this PR gives me following error on Oracle&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
09:35:18.980 [Source: Custom Source -&amp;gt; Sink: Unnamed (1/1)#0] WARN  org.apache.flink.runtime.taskmanager.Task - Source: Custom Source -&amp;gt; Sink: Unnamed (1/1)#0 (0485d1334319956f744b35249e94ae7d) switched from INITIALIZING to FAILED with failure cause: org.apache.flink.util.FlinkRuntimeException: unable to recover, error -3: resource manager error has occurred. [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]
        at org.apache.flink.connector.jdbc.xa.XaFacadeImpl.wrapException(XaFacadeImpl.java:356)
        at org.apache.flink.connector.jdbc.xa.XaFacadeImpl.lambda$execute$12(XaFacadeImpl.java:267)
        at java.base/java.util.Optional.orElseThrow(Optional.java:408)
        at org.apache.flink.connector.jdbc.xa.XaFacadeImpl.execute(XaFacadeImpl.java:267)
        at org.apache.flink.connector.jdbc.xa.XaFacadeImpl.recover(XaFacadeImpl.java:227)
        at org.apache.flink.connector.jdbc.xa.XaFacadePoolingImpl.recover(XaFacadePoolingImpl.java:120)
        at org.apache.flink.connector.jdbc.xa.XaGroupOpsImpl.recoverAndRollback(XaGroupOpsImpl.java:109)
        at org.apache.flink.connector.jdbc.xa.JdbcXaSinkFunction.open(JdbcXaSinkFunction.java:261)
        at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:34)
        at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:102)
        at org.apache.flink.streaming.api.operators.StreamSink.open(StreamSink.java:46)
        at org.apache.flink.streaming.runtime.tasks.OperatorChain.initializeStateAndOpenOperators(OperatorChain.java:437)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreGates(StreamTask.java:582)
        at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$SynchronizedStreamTaskActionExecutor.call(StreamTaskActionExecutor.java:100)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.executeRestore(StreamTask.java:562)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.runWithCleanUpOnFail(StreamTask.java:647)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:537)
        at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:759)
        at org.apache.flink.runtime.taskmanager.Task.run(Task.java:566)
        at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17380517" author="roman_khachatryan" created="Wed, 14 Jul 2021 11:45:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt;&#160;could you clarify which defaults were changed?&lt;/p&gt;

&lt;p&gt;Also the PR is merged, are you testing against master?&lt;/p&gt;</comment>
                            <comment id="17380526" author="maver1ck" created="Wed, 14 Jul 2021 11:53:32 +0000"  >&lt;p&gt;I&apos;m doing migration of my codebase to 1.13.1 and setting&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; DEFAULT_RECOVERED_AND_ROLLBACK = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;makes tests for XA sink and Oracle failing.&lt;/p&gt;</comment>
                            <comment id="17380544" author="roman_khachatryan" created="Wed, 14 Jul 2021 12:13:34 +0000"  >&lt;p&gt;Hmm..I just quickly searched for this error and found that Oracle &lt;a href=&quot;https://www.ibm.com/support/pages/receiving-xa-recover-operation-3-when-restarting-application-server-when-using-oracle-database&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;may require additional configuration&lt;/a&gt;&#160;for XA_RECOVER.&lt;/p&gt;

&lt;p&gt;Can it be something similar in your case?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13372975">FLINK-22311</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13370065">FLINK-22141</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13364053">FLINK-21743</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0puwo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>