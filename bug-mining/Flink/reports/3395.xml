<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:41:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14380] Type Extractor POJO setter check does not allow for Immutable Case Class</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14380</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When deciding if a class conforms to POJO using the type extractor Flink checks that the class implements a setter and getter method. For the setter method Flink makes the assertion that the return type is `Void`. This is an issue if using a case class as often the return type of a case class setter is a copy of the objects class. Consider the following case class:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; class  SomeClass(x: Int) {
    x_=(newX: Int): SomeClass = { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.copy(x = newX) }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;This class will be identified as not being valid POJO although getter (generated) and setter methods are provided because the return type of the setter is not void. &lt;/p&gt;

&lt;p&gt;This issue discourages immutabilaty and makes the usage of case classes not possible without falling back to Kryo Serializer.&lt;/p&gt;

&lt;p&gt;The issue is located in &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java&lt;/a&gt; on line 1806. Here is a permalink to the line &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/80b27a150026b7b5cb707bd9fa3e17f565bb8112/flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java#L1806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/80b27a150026b7b5cb707bd9fa3e17f565bb8112/flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java#L1806&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;A copy of the if check is here&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;((methodNameLow.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;+fieldNameLow) || methodNameLow.equals(fieldNameLow+&lt;span class=&quot;code-quote&quot;&gt;&quot;_$eq&quot;&lt;/span&gt;)) &amp;amp;&amp;amp;
					m.getParameterTypes().length == 1 &amp;amp;&amp;amp; &lt;span class=&quot;code-comment&quot;&gt;// one parameter of the field&apos;s type
&lt;/span&gt;					(m.getGenericParameterTypes()[0].equals( fieldType ) || (fieldTypeWrapper != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; m.getParameterTypes()[0].equals( fieldTypeWrapper )) || (fieldTypeGeneric != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; m.getGenericParameterTypes()[0].equals(fieldTypeGeneric) ) )&amp;amp;&amp;amp;
					&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type is void.
&lt;/span&gt;					m.getReturnType().equals(&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;.TYPE)
				) {
					hasSetter = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
				}
			}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;I believe the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
m.getReturnType().equals(&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;.TYPE)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be modified to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
m.getReturnType().equals(&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;.TYPE) || m.getReturnType().equals(clazz)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will allow for case class setters which return copies of the object enabling to use case classes. This allows us to maintain immutability without being forced to fall back to the Kryo Serializer.  &lt;/p&gt;</description>
                <environment>&lt;p&gt;Not relavent&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13261867">FLINK-14380</key>
            <summary>Type Extractor POJO setter check does not allow for Immutable Case Class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mzuehlke">Marco Z&#252;hlke</assignee>
                                    <reporter username="elliotvilhelm">Elliot Pourmand</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 11 Oct 2019 18:20:33 +0000</created>
                <updated>Mon, 11 Nov 2019 14:15:50 +0000</updated>
                            <resolved>Mon, 11 Nov 2019 14:15:50 +0000</resolved>
                                    <version>1.8.2</version>
                    <version>1.9.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>API / Scala</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16949748" author="elliotvilhelm" created="Fri, 11 Oct 2019 19:24:26 +0000"  >&lt;p&gt;Related pull request: &lt;a href=&quot;https://github.com/apache/flink/pull/9882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9882&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16951872" author="aljoscha" created="Tue, 15 Oct 2019 11:55:37 +0000"  >&lt;p&gt;Copying my comment from github:&lt;/p&gt;

&lt;p&gt;I don&apos;t think this will work, since the setter for case classes doesn&apos;t actually modify the case class and Flink only has a reference to the unmodified case class. When using the Scala API, the type analysis stack should correctly analyze case classes and use the CaseClassSerializer for them. (The TypeExtractor is only used for the Java API)&lt;/p&gt;</comment>
                            <comment id="16952430" author="elliotvilhelm" created="Wed, 16 Oct 2019 01:54:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; Thanks for the response! That makes sense. I am seeing this output in our Scala application on launch for most case classes.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;&quot;MyCaseClass.scala cannot be used as a POJO type because not all fields are valid POJO fields, and must be processed as GenericType.&quot;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;We are using case classes so I was confused. I had isolated this output to here which I realize in in the Java api:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/blob/80b27a150026b7b5cb707bd9fa3e17f565bb8112/flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java#L1857&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/80b27a150026b7b5cb707bd9fa3e17f565bb8112/flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java#L1857&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Perhaps this is a bug or likely I am misunderstanding something? &#128516; &lt;/p&gt;</comment>
                            <comment id="16952597" author="twalthr" created="Wed, 16 Oct 2019 08:15:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elliotvilhelm&quot; class=&quot;user-hover&quot; rel=&quot;elliotvilhelm&quot;&gt;elliotvilhelm&lt;/a&gt;, I agree that we should support immutable types in the future. The issues you have mentioned and also the interoperability with Scala are big arguments for improvements here. For the Table API, we will support immutable types as mentioned in &lt;a href=&quot;https://docs.google.com/document/d/1Zf8-okGvCiTTRaTN0IqtTGrrjXYNGFJnhUQyinF4xcU/edit?ts=5d9f20a2#&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FLIP-65&lt;/a&gt;. I hope some of the improvements will bubble up into Flink&apos;s the core modules. But for this (as Aljoscha mentioned) we need changes on the serializer side as well. The type extractor must be kept in sync with what the serializers support.&lt;/p&gt;</comment>
                            <comment id="16952835" author="stephanewen" created="Wed, 16 Oct 2019 13:39:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elliotvilhelm&quot; class=&quot;user-hover&quot; rel=&quot;elliotvilhelm&quot;&gt;elliotvilhelm&lt;/a&gt; What &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; mentioned is that the Scala Case Class code should not go through this logic in the first place.&lt;br/&gt;
It should be handled by the Scala type inference and extractor, which should support immutable Scala Case Classes.&lt;/p&gt;</comment>
                            <comment id="16952858" author="aljoscha" created="Wed, 16 Oct 2019 14:02:54 +0000"  >&lt;p&gt;Again forwarding my comment from GH (we should stick to discussing this here, please):&lt;/p&gt;

&lt;p&gt;Maybe you could give some more details about your job? Which API are you using? DataSet, DataStream, or Table? Are you using the Scala version of the API, that is org.apache.flink.api.scala if you&apos;re using the DataSet API?&lt;/p&gt;</comment>
                            <comment id="16953536" author="aljoscha" created="Thu, 17 Oct 2019 09:18:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elliotvilhelm&quot; class=&quot;user-hover&quot; rel=&quot;elliotvilhelm&quot;&gt;elliotvilhelm&lt;/a&gt; could you please post a stack trace that shows how/why &lt;tt&gt;TypeExtractor&lt;/tt&gt; is invoked? Or provide a minimal code example that triggers it?&lt;/p&gt;</comment>
                            <comment id="16957200" author="mzuehlke" created="Tue, 22 Oct 2019 16:10:38 +0000"  >&lt;p&gt;I bumped into the same case. Using a pure scala streaming app.&lt;/p&gt;

&lt;p&gt;Here is a stacktrace (on flink 1.9):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	  at org.apache.flink.api.java.typeutils.TypeExtractor.analyzePojo(TypeExtractor.java:1857)
	  at org.apache.flink.api.java.typeutils.TypeExtractor.privateGetForClass(TypeExtractor.java:1746)
	  at org.apache.flink.api.java.typeutils.TypeExtractor.privateGetForClass(TypeExtractor.java:1643)
	  at org.apache.flink.api.java.typeutils.TypeExtractor.createTypeInfoWithTypeHierarchy(TypeExtractor.java:921)
	  at org.apache.flink.api.java.typeutils.TypeExtractor.privateCreateTypeInfo(TypeExtractor.java:803)
	  at org.apache.flink.api.java.typeutils.TypeExtractor.getUnaryOperatorReturnType(TypeExtractor.java:587)
	  at org.apache.flink.api.java.typeutils.TypeExtractor.getFlatMapReturnTypes(TypeExtractor.java:196)
	  at org.apache.flink.streaming.api.datastream.DataStream.flatMap(DataStream.java:611)
	  at org.apache.flink.streaming.api.scala.DataStream.flatMap(DataStream.scala:647)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16957626" author="aljoscha" created="Wed, 23 Oct 2019 07:32:20 +0000"  >&lt;p&gt;I see, the problem is here: &lt;a href=&quot;https://github.com/apache/flink/blob/e0efabe8884f22b4a1c7ab9df3274b3fca03dcfb/flink-streaming-scala/src/main/scala/org/apache/flink/streaming/api/scala/DataStream.scala#L647&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/e0efabe8884f22b4a1c7ab9df3274b3fca03dcfb/flink-streaming-scala/src/main/scala/org/apache/flink/streaming/api/scala/DataStream.scala#L647&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The issue is that we call &lt;tt&gt;DataStream.flatMap()&lt;/tt&gt; from the Java API, and this in turns calls the type extractor. But afterwards we set the type that was extracted from Scala using &lt;tt&gt;returns()&lt;/tt&gt;. &lt;tt&gt;process()&lt;/tt&gt; has a version that allows passing the &lt;tt&gt;TypeInformation&lt;/tt&gt; in the method call, the solution for this issue here will be to also do the same for the other methods of &lt;tt&gt;DataStream&lt;/tt&gt; and not use &lt;tt&gt;returns()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Anyone want to take a try and cut a PR for that?&lt;/p&gt;</comment>
                            <comment id="16957809" author="mzuehlke" created="Wed, 23 Oct 2019 12:03:19 +0000"  >&lt;p&gt;I will give it a try.&lt;/p&gt;

&lt;p&gt;At a first look at least &#160;&lt;tt&gt;Datastream#map}, {{Datastream#flatMap&lt;/tt&gt;, &#160;&lt;tt&gt;ConnectedStreams#map&lt;/tt&gt; and &lt;tt&gt;ConnectedStreams#flatMap&lt;/tt&gt;  are using the &lt;tt&gt;returns()&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="16960175" author="mzuehlke" created="Fri, 25 Oct 2019 22:21:12 +0000"  >&lt;p&gt;A pull request in line with the suggestion by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;: &lt;a href=&quot;https://github.com/apache/flink/pull/9999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9999&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16966895" author="elliotvilhelm" created="Mon, 4 Nov 2019 18:28:20 +0000"  >&lt;p&gt;Thanks everyone for your investigation, I thought I was crazy. I was unable to trace in our application, tried to add Flink source files for debugging but ran into issues. It has been a busy dev month for us. Very happy to see the issue was discovered, love the open source community.&lt;/p&gt;</comment>
                            <comment id="16971576" author="aljoscha" created="Mon, 11 Nov 2019 14:15:50 +0000"  >&lt;p&gt;Fixed on master in 47c277d85aca6ce288505b13cd3a3595911e6bfa.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; unless you wanted to keep this open to also backport the fix to previous versions.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07iqo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>