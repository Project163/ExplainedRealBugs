<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:19:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-34070] MiniClusterITCase.testHandleStreamingJobsWhenNotEnoughSlot fails for the AdaptiveScheduler</title>
                <link>https://issues.apache.org/jira/browse/FLINK-34070</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We experience test failures of &lt;tt&gt;MiniClusterITCase.testHandleStreamingJobsWhenNotEnoughSlot&lt;/tt&gt; with the &lt;tt&gt;AdaptiveScheduler&lt;/tt&gt; being enabled after &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-33414&quot; title=&quot;MiniClusterITCase.testHandleStreamingJobsWhenNotEnoughSlot fails due to unexpected TimeoutException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-33414&quot;&gt;&lt;del&gt;FLINK-33414&lt;/del&gt;&lt;/a&gt; was fixed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Jan 09 02:01:16         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
Jan 09 02:01:16 	at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1707)
Jan 09 02:01:16 	at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3313)
Jan 09 02:01:16 	at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1742)
Jan 09 02:01:16 	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
Jan 09 02:01:16 	at org.apache.flink.runtime.minicluster.MiniCluster.executeJobBlocking(MiniCluster.java:1050)
Jan 09 02:01:16 	at org.apache.flink.runtime.minicluster.MiniClusterITCase.runHandleJobsWhenNotEnoughSlots(MiniClusterITCase.java:152)
Jan 09 02:01:16 	at org.apache.flink.runtime.minicluster.MiniClusterITCase.lambda$testHandleStreamingJobsWhenNotEnoughSlot$0(MiniClusterITCase.java:119)
Jan 09 02:01:16 	at org.apache.flink.runtime.minicluster.MiniClusterITCase$$Lambda$1927/1144737794.call(Unknown Source)
Jan 09 02:01:16 	at org.assertj.core.api.ThrowableAssert.catchThrowable(ThrowableAssert.java:63)
Jan 09 02:01:16 	at org.assertj.core.api.AssertionsForClassTypes.catchThrowable(AssertionsForClassTypes.java:892)
Jan 09 02:01:16 	at org.assertj.core.api.Assertions.catchThrowable(Assertions.java:1366)
Jan 09 02:01:16 	at org.assertj.core.api.Assertions.assertThatThrownBy(Assertions.java:1210)
Jan 09 02:01:16 	at org.apache.flink.runtime.minicluster.MiniClusterITCase.testHandleStreamingJobsWhenNotEnoughSlot(MiniClusterITCase.java:119)
Jan 09 02:01:16 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
Jan 09 02:01:16 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
Jan 09 02:01:16 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56124&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=9813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56124&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=9813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56166&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56166&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10782&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56226&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56226&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10773&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56285&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10800&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56285&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10800&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13564492">FLINK-34070</key>
            <summary>MiniClusterITCase.testHandleStreamingJobsWhenNotEnoughSlot fails for the AdaptiveScheduler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mapohl">Matthias Pohl</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 12 Jan 2024 11:46:03 +0000</created>
                <updated>Wed, 17 Jan 2024 13:10:37 +0000</updated>
                            <resolved>Wed, 17 Jan 2024 13:10:37 +0000</resolved>
                                    <version>1.19.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17806055" author="mapohl" created="Fri, 12 Jan 2024 13:29:37 +0000"  >&lt;p&gt;This issue can be reproduced locally:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvn -pl flink-runtime test -Dtest=MiniClusterITCase#testHandleStreamingJobsWhenNotEnoughSlot -Dflink.tests.enable-adaptive-scheduler=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dfast &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17806072" author="mapohl" created="Fri, 12 Jan 2024 14:48:58 +0000"  >&lt;p&gt;The &lt;tt&gt;AdaptiveScheduler&lt;/tt&gt; uses &lt;tt&gt;DeclarativeSlotPoolServiceFactory&lt;/tt&gt; in contrast to the &lt;tt&gt;DefaultScheduler&lt;/tt&gt; and the &lt;tt&gt;AdaptiveBatchScheduler&lt;/tt&gt; which use &lt;tt&gt;DeclarativeSlotPoolBridgeServiceFactory&lt;/tt&gt;&#160;(see &lt;a href=&quot;https://github.com/apache/flink/blob/a9383fd4d51b1161292628145e2f427f574a07d4/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/DefaultSlotPoolServiceSchedulerFactory.java#L177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DefaultSlotPoolServiceSchedulerFactory:177ff&lt;/a&gt;). That makes the &lt;tt&gt;JobMaster&lt;/tt&gt; use different implementations of the &lt;tt&gt;SlotPoolService&lt;/tt&gt;&#160;interface in &lt;a href=&quot;https://github.com/apache/flink/blob/16bac7802284563c95cfe18fcf153e91dc06216e/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobMaster.java#L333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JobMaster:333&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;DeclarativeSlotPoolService&lt;/tt&gt; (used by the &lt;tt&gt;AdaptiveScheduler&lt;/tt&gt;) doesn&apos;t implement &lt;tt&gt;SlotPoolService#notifyNotEnoughResourcesAvailable&lt;/tt&gt; but relies on the empty default implementation.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;DeclarativeSlotPoolBridge&lt;/tt&gt; (used by the other two scheduler implementations) does implement implement &lt;tt&gt;notifyNotEnoughResourcesAvailable&lt;/tt&gt; in &lt;a href=&quot;https://github.com/apache/flink/blob/72bff2a2d0072602e4e625476bf5480dc50dc76c/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/DeclarativeSlotPoolBridge.java#L395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DeclarativeSlotPoolBridge:395ff&lt;/a&gt; which triggers aborting pending requests.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Conclusion: The &lt;tt&gt;AdaptiveScheduler&lt;/tt&gt; doesn&apos;t participate in the early cancellation of pending slot requests that cannot be fulfilled.&#160;&lt;/p&gt;</comment>
                            <comment id="17806110" author="mapohl" created="Fri, 12 Jan 2024 15:56:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; Do you remember whether there was a specific architectural-driven reason why we don&apos;t respond to &lt;tt&gt;notifyNotEnoughResourcesAvailable&lt;/tt&gt; for the &lt;tt&gt;DeclarativeSlotPoolService&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17806125" author="jiang xin" created="Fri, 12 Jan 2024 17:06:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; Thanks for the clarification of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-33414&quot; title=&quot;MiniClusterITCase.testHandleStreamingJobsWhenNotEnoughSlot fails due to unexpected TimeoutException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-33414&quot;&gt;&lt;del&gt;FLINK-33414&lt;/del&gt;&lt;/a&gt; and creating the new one.&lt;/p&gt;

&lt;p&gt;I think the following comments in the original test may caused some misunderstandings. Actually, `SLOT_REQUEST_TIMEOUT` is the fallback timeout of the default scheduler, while `RESOURCE_WAIT_TIMEOUT` is the delay to trigger the slot resource checking of the adaptive scheduler.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; triggers the failure &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; scheduler
&lt;/span&gt;configuration.setLong(
    JobManagerOptions.SLOT_REQUEST_TIMEOUT, slotRequestTimeout.toMillis());
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; triggers the failure &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the adaptive scheduler
&lt;/span&gt;configuration.set(JobManagerOptions.RESOURCE_WAIT_TIMEOUT, slotRequestTimeout); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So we should set the `RESOURCE_WAIT_TIMEOUT` to `Duration.ofMillis(1)` to trigger the checking ASAP instead of `Duration.ofMillis(Long.MAX_VALUE)`, WDYT?&lt;/p&gt;</comment>
                            <comment id="17806821" author="mapohl" created="Mon, 15 Jan 2024 13:28:07 +0000"  >&lt;p&gt;I provided a PR for this issue that made the test more explicit and covers all three supported scenarios. WDYT?&lt;/p&gt;</comment>
                            <comment id="17807247" author="mapohl" created="Tue, 16 Jan 2024 14:13:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56340&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56340&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10869&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17807253" author="mapohl" created="Tue, 16 Jan 2024 14:16:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56348&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10840&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56348&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=10840&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17807257" author="mapohl" created="Tue, 16 Jan 2024 14:22:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56359&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=9767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56359&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=9767&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17807269" author="mapohl" created="Tue, 16 Jan 2024 14:35:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56416&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=9821&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=56416&amp;amp;view=logs&amp;amp;j=0e7be18f-84f2-53f0-a32d-4a5e4a174679&amp;amp;t=7c1d86e3-35bd-5fd5-3b7c-30c126a78702&amp;amp;l=9821&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17807720" author="mapohl" created="Wed, 17 Jan 2024 13:10:37 +0000"  >&lt;p&gt;master: &lt;a href=&quot;https://github.com/apache/flink/commit/024ed963ed8358ae78e728108ac6c95046924f67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;024ed963ed8358ae78e728108ac6c95046924f67&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13556225">FLINK-33414</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mpso:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>