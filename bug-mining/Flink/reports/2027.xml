<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7838] Kafka011ProducerExactlyOnceITCase do not finish</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7838</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;See attached log&lt;/p&gt;</description>
                <environment></environment>
        <key id="13109296">FLINK-7838</key>
            <summary>Kafka011ProducerExactlyOnceITCase do not finish</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnowojski">Piotr Nowojski</assignee>
                                    <reporter username="pnowojski">Piotr Nowojski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Oct 2017 15:54:12 +0000</created>
                <updated>Wed, 8 Nov 2017 13:11:25 +0000</updated>
                            <resolved>Wed, 8 Nov 2017 13:11:25 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16208966" author="till.rohrmann" created="Wed, 18 Oct 2017 08:31:42 +0000"  >&lt;p&gt;Are you working on this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;? If so, then please set the status to in progress.&lt;/p&gt;</comment>
                            <comment id="16218850" author="pnowojski" created="Wed, 25 Oct 2017 15:05:33 +0000"  >&lt;p&gt;Added log with another dead lock example at org.apache.kafka.clients.producer.KafkaProducer.initTransactions, called in restoring state.&lt;/p&gt;</comment>
                            <comment id="16222448" author="githubbot" created="Fri, 27 Oct 2017 14:23:44 +0000"  >&lt;p&gt;GitHub user pnowojski opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7838&quot; title=&quot;Kafka011ProducerExactlyOnceITCase do not finish&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7838&quot;&gt;&lt;del&gt;FLINK-7838&lt;/del&gt;&lt;/a&gt; Bunch of hotfixes and fix missing synchronization in FlinkKafkaProducer011&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Most important is the commit adding missing synchronization, that might been the cause for some deadlocks on travis. Others are just non critical hotfixes.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Please check individual commit messages.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is already covered by existing Kafka 0.11 connector tests.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (*&lt;b&gt;yes&lt;/b&gt;* / no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/pnowojski/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pnowojski/flink&lt;/a&gt; f7838&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4915&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4e0492595f497a49c63b8ffddcc66e720e4e4433&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-24T15:35:56Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Bump Kafka 0.11 dependency&lt;/p&gt;

&lt;p&gt;    This might include some bugfixes&lt;/p&gt;

&lt;p&gt;commit e38b3461bc97a175bf67f1072b2e8a2a891c1f1a&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-24T15:57:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7838&quot; title=&quot;Kafka011ProducerExactlyOnceITCase do not finish&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7838&quot;&gt;&lt;del&gt;FLINK-7838&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Add missing synchronization in FlinkKafkaProducer&lt;/p&gt;

&lt;p&gt;commit 04127b9c44807f5379e07d801847d993c39e94b1&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-26T08:02:15Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Fix FlinkKafkaProducer011 logger&lt;/p&gt;

&lt;p&gt;commit 8b47ac214c4022563be8128e84bc02d5de98819c&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-27T13:11:24Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-tests&amp;#93;&lt;/span&gt; Fix test names so that they are not ignored by mvn build&lt;/p&gt;

&lt;p&gt;commit a6c4c8bbdbfc5c238557e151fa8598e71a562411&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-25T16:08:46Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Move checkpointing enable checking to initializeState&lt;/p&gt;

&lt;p&gt;    initializeState is called before open and since both of those functions&lt;br/&gt;
    relay on chosen semantic, that means checkpointing enable check should&lt;br/&gt;
    happen in initializeState.&lt;/p&gt;

&lt;p&gt;commit 055e5d125df895fd010e1171d1d39f37177518a2&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-27T13:14:58Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Remove unsued field in FlinkKafkaProducer011&lt;/p&gt;

&lt;p&gt;commit 6cf55ed8977135af01099452962962199e253348&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-27T13:47:26Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Do not return producers to a pool in abort for non EXACTLY_ONCE modes&lt;/p&gt;

&lt;p&gt;    Previously on abort(...) producers were returned to the pool. This was minor bug,&lt;br/&gt;
    probably without any negative side effect, however this patch fixes it&lt;br/&gt;
    and adds additional sanity checks to guard against similar bugs&lt;br/&gt;
    in the future.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16222450" author="pnowojski" created="Fri, 27 Oct 2017 14:24:12 +0000"  >&lt;p&gt;The main problem in this issue is this bug in Kafka:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6132&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6132&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; I&apos;m not sure what we should do now in that case. I tried bumping our connector to work with Kafka 1.0.0-rc3 and this dead lock error was gone, however the upgrade broke the consumer side of our connector.&lt;/p&gt;</comment>
                            <comment id="16222494" author="githubbot" created="Fri, 27 Oct 2017 14:53:39 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @GJL @aljoscha could you take a look?&lt;/p&gt;</comment>
                            <comment id="16222522" author="githubbot" created="Fri, 27 Oct 2017 15:08:28 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147436687&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147436687&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -483,11 +478,6 @@ public void setLogFailuresOnly(boolean logFailuresOnly) {&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public void open(Configuration configuration) throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (semantic != Semantic.NONE &amp;amp;&amp;amp; !((StreamingRuntimeContext) this.getRuntimeContext()).isCheckpointingEnabled()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What is the benefit of moving this into `initializeState()`?&lt;/p&gt;</comment>
                            <comment id="16222550" author="githubbot" created="Fri, 27 Oct 2017 15:29:53 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147442314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147442314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -563,7 +553,7 @@ public void close() throws Exception &lt;/p&gt;
{
     			asyncException = ExceptionUtils.firstOrSuppressed(e, asyncException);
     		}
&lt;p&gt;     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;producersPool.close();&lt;br/&gt;
    +			producersPool.ifPresent(pool -&amp;gt; pool.close());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I am not adamant about it but using `Optional` in private fields is not without controversy: &lt;a href=&quot;https://stackoverflow.com/a/26328555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/a/26328555&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Also, `ifPresent(pool -&amp;gt; pool.close()` only works because `close` does not declare any checked exceptions. If it did, the code would not compile.&lt;/p&gt;</comment>
                            <comment id="16222551" author="githubbot" created="Fri, 27 Oct 2017 15:30:15 +0000"  >&lt;p&gt;Github user GJL commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &#128077; &lt;/p&gt;</comment>
                            <comment id="16224561" author="githubbot" created="Mon, 30 Oct 2017 09:36:25 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147652455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147652455&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -483,11 +478,6 @@ public void setLogFailuresOnly(boolean logFailuresOnly) {&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public void open(Configuration configuration) throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (semantic != Semantic.NONE &amp;amp;&amp;amp; !((StreamingRuntimeContext) this.getRuntimeContext()).isCheckpointingEnabled()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `initializeState()` performs some clean up actions that depends on the semantic - cleaning up/closing lingering transactions, thus this check should happen earlier. Otherwise `EXACTLY_ONCE` cleaning up code would be executed unnecessarily.&lt;/p&gt;</comment>
                            <comment id="16224563" author="githubbot" created="Mon, 30 Oct 2017 09:38:47 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147652950&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147652950&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -563,7 +553,7 @@ public void close() throws Exception &lt;/p&gt;
{
     			asyncException = ExceptionUtils.firstOrSuppressed(e, asyncException);
     		}
&lt;p&gt;     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;producersPool.close();&lt;br/&gt;
    +			producersPool.ifPresent(pool -&amp;gt; pool.close());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I know about this controversy/discussion. However I don&apos;t know in what universe nullable fields are better compared to `Optional` fields :|&lt;/p&gt;</comment>
                            <comment id="16224577" author="githubbot" created="Mon, 30 Oct 2017 09:55:09 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147656743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147656743&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;/li&gt;
	&lt;li&gt;Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(sender, &quot;wakeup&quot;);&lt;/li&gt;
	&lt;li&gt;result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Not related to your changes and can be done in a separate PR but I think we should add this check from the original sources to &lt;b&gt;&quot;mitigate&quot;&lt;/b&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6119&quot; title=&quot;Silent Data Loss in Kafka011 Transactional Producer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6119&quot;&gt;&lt;del&gt;KAFKA-6119&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
    ```&lt;br/&gt;
    if (!newPartitionsInTransaction.isEmpty())&lt;br/&gt;
                enqueueRequest(addPartitionsToTransactionHandler());&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16224640" author="githubbot" created="Mon, 30 Oct 2017 10:43:27 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147667457&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147667457&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}, new Object[]{txnRequestHandler});&lt;br/&gt;
    -		TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;br/&gt;
    -		Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;br/&gt;
    -		invoke(sender, &quot;wakeup&quot;);&lt;br/&gt;
    -		result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;br/&gt;
    +			invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;br/&gt;
    +			TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;br/&gt;
    +			Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;br/&gt;
    +			invoke(sender, &quot;wakeup&quot;);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `sender.wakeup` is outside of the lock in the original code. Do you think it makes a difference?&lt;/p&gt;</comment>
                            <comment id="16224721" author="githubbot" created="Mon, 30 Oct 2017 11:18:01 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147674418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147674418&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}, new Object[]{txnRequestHandler});&lt;br/&gt;
    -		TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;br/&gt;
    -		Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;br/&gt;
    -		invoke(sender, &quot;wakeup&quot;);&lt;br/&gt;
    -		result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;br/&gt;
    +			invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;br/&gt;
    +			TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;br/&gt;
    +			Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;br/&gt;
    +			invoke(sender, &quot;wakeup&quot;);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good catch. It shouldn&apos;t make a difference, but I will change it to better match original code.&lt;/p&gt;</comment>
                            <comment id="16224737" author="githubbot" created="Mon, 30 Oct 2017 11:22:07 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147675169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147675169&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;/li&gt;
	&lt;li&gt;Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(sender, &quot;wakeup&quot;);&lt;/li&gt;
	&lt;li&gt;result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I implemented it, however in that case it would be much harder to test reliably `enqueueRequest(addPartitionsToTransactionHandler());` since in vast majority of cases this would be a dead code :/&lt;/p&gt;</comment>
                            <comment id="16224831" author="githubbot" created="Mon, 30 Oct 2017 12:37:45 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147689963&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147689963&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -483,11 +478,6 @@ public void setLogFailuresOnly(boolean logFailuresOnly) {&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public void open(Configuration configuration) throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (semantic != Semantic.NONE &amp;amp;&amp;amp; !((StreamingRuntimeContext) this.getRuntimeContext()).isCheckpointingEnabled()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    ok&lt;/p&gt;</comment>
                            <comment id="16225238" author="githubbot" created="Mon, 30 Oct 2017 16:15:59 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147754127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147754127&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;/li&gt;
	&lt;li&gt;Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(sender, &quot;wakeup&quot;);&lt;/li&gt;
	&lt;li&gt;result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    How are you testing now that `enqueueRequest` is called? &lt;/p&gt;</comment>
                            <comment id="16225241" author="githubbot" created="Mon, 30 Oct 2017 16:17:09 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147754468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147754468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011Test.java &amp;#8212;&lt;br/&gt;
    @@ -61,7 +61,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IT cases for the 
{@link FlinkKafkaProducer011}
&lt;p&gt;.&lt;br/&gt;
      */&lt;br/&gt;
     @SuppressWarnings(&quot;serial&quot;)&lt;br/&gt;
    -public class FlinkKafkaProducer011Tests extends KafkaTestBase {&lt;br/&gt;
    +public class FlinkKafkaProducer011Test extends KafkaTestBase {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Shouldn&apos;t this be named `*ITCase` according to the coding conventions ?&lt;/p&gt;</comment>
                            <comment id="16226549" author="githubbot" created="Tue, 31 Oct 2017 10:06:37 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147941508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147941508&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;/li&gt;
	&lt;li&gt;Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(sender, &quot;wakeup&quot;);&lt;/li&gt;
	&lt;li&gt;result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It is always being called on `FlinkKafkaProducer::flush()`, so that&apos;s pretty easy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16226554" author="githubbot" created="Tue, 31 Oct 2017 10:10:46 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r147942486&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r147942486&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011Test.java &amp;#8212;&lt;br/&gt;
    @@ -61,7 +61,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IT cases for the 
{@link FlinkKafkaProducer011}
&lt;p&gt;.&lt;br/&gt;
      */&lt;br/&gt;
     @SuppressWarnings(&quot;serial&quot;)&lt;br/&gt;
    -public class FlinkKafkaProducer011Tests extends KafkaTestBase {&lt;br/&gt;
    +public class FlinkKafkaProducer011Test extends KafkaTestBase {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Aren&apos;t all of the other `ITCase`s starting a Flink job? &lt;/p&gt;

&lt;p&gt;    Regardless I named it `Test` originally because it is slightly more unit &quot;testish&quot; compared to `Kafka011ProducerExactlyOnceITCase`.&lt;/p&gt;</comment>
                            <comment id="16233899" author="githubbot" created="Wed, 1 Nov 2017 10:32:32 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r148226920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r148226920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011Test.java &amp;#8212;&lt;br/&gt;
    @@ -61,7 +61,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IT cases for the 
{@link FlinkKafkaProducer011}
&lt;p&gt;.&lt;br/&gt;
      */&lt;br/&gt;
     @SuppressWarnings(&quot;serial&quot;)&lt;br/&gt;
    -public class FlinkKafkaProducer011Tests extends KafkaTestBase {&lt;br/&gt;
    +public class FlinkKafkaProducer011Test extends KafkaTestBase {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I haven&apos;t looked into too many `ITCase`s but coding guidelines require unit tests to be subsecond execution speed:&lt;br/&gt;
    &amp;gt;Please use unit tests to test isolated functionality, such as methods. Unit tests should execute in subseconds and should be preferred whenever possible. The name of unit test classes have to on *Test. Use integration tests to implement long-running tests.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;http://flink.apache.org/contribute-code.html#coding-guidelines&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/contribute-code.html#coding-guidelines&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Then again, I don&apos;t know how consistent the tests are.&lt;/p&gt;</comment>
                            <comment id="16233905" author="githubbot" created="Wed, 1 Nov 2017 10:35:11 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r148227364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r148227364&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/FlinkKafkaProducer.java &amp;#8212;&lt;br/&gt;
    @@ -226,13 +228,19 @@ public int getTransactionCoordinatorId() {&lt;/p&gt;

&lt;p&gt;     	private void flushNewPartitions() &lt;/p&gt;
{
     		LOG.info(&quot;Flushing new partitions&quot;);
    +		enqueueNewPartitions().await();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	private TransactionalRequestResult enqueueNewPartitions() {&lt;br/&gt;
     		Object transactionManager = getValue(kafkaProducer, &quot;transactionManager&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(transactionManager, &quot;enqueueRequest&quot;, new Class[]
{txnRequestHandler.getClass().getSuperclass()}
&lt;p&gt;, new Object[]&lt;/p&gt;
{txnRequestHandler}
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;TransactionalRequestResult result = (TransactionalRequestResult) getValue(txnRequestHandler, txnRequestHandler.getClass().getSuperclass(), &quot;result&quot;);&lt;/li&gt;
	&lt;li&gt;Object sender = getValue(kafkaProducer, &quot;sender&quot;);&lt;/li&gt;
	&lt;li&gt;invoke(sender, &quot;wakeup&quot;);&lt;/li&gt;
	&lt;li&gt;result.await();&lt;br/&gt;
    +		synchronized (transactionManager) {&lt;br/&gt;
    +			Object txnRequestHandler = invoke(transactionManager, &quot;addPartitionsToTransactionHandler&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Did you add the `!newPartitionsInTransaction.isEmpty()` check in the end? I couldn&apos;t find it on first glance. &lt;/p&gt;

&lt;p&gt;    Regarding tests, if you add the check, would your current test fail? If not, I think the behaviour isn&apos;t properly tested.&lt;/p&gt;</comment>
                            <comment id="16235167" author="githubbot" created="Thu, 2 Nov 2017 04:40:42 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915#discussion_r148441559&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915#discussion_r148441559&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011Test.java &amp;#8212;&lt;br/&gt;
    @@ -61,7 +61,7 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;IT cases for the 
{@link FlinkKafkaProducer011}
&lt;p&gt;.&lt;br/&gt;
      */&lt;br/&gt;
     @SuppressWarnings(&quot;serial&quot;)&lt;br/&gt;
    -public class FlinkKafkaProducer011Tests extends KafkaTestBase {&lt;br/&gt;
    +public class FlinkKafkaProducer011Test extends KafkaTestBase {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I&apos;m leaning towards `*ITCase` here, since it is indeed an integration test with Kafka.&lt;/p&gt;</comment>
                            <comment id="16235168" author="githubbot" created="Thu, 2 Nov 2017 04:41:55 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the work and reviews @GJL @pnowojski.&lt;br/&gt;
    I did a pass also, changes LGTM.&lt;br/&gt;
    Left one last comment regarding the integration test class name.&lt;br/&gt;
    Other than that, would like to merge this if there are no other objections.&lt;/p&gt;</comment>
                            <comment id="16235473" author="githubbot" created="Thu, 2 Nov 2017 09:54:53 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve added a commit to rename the 011 producer integration test to `ITCase`. Please let me know if you disagree with that @pnowojski @GJL.&lt;/p&gt;</comment>
                            <comment id="16235481" author="githubbot" created="Thu, 2 Nov 2017 10:01:40 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16235556" author="githubbot" created="Thu, 2 Nov 2017 11:08:08 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fine for me, thanks!&lt;/p&gt;</comment>
                            <comment id="16243876" author="aljoscha" created="Wed, 8 Nov 2017 13:11:16 +0000"  >&lt;p&gt;Reopen to fix release note.&lt;/p&gt;</comment>
                            <comment id="16243877" author="aljoscha" created="Wed, 8 Nov 2017 13:11:25 +0000"  >&lt;p&gt;Resolved issues on our side. There is still pending dead locking issue in Kafka: &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6132&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6132&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6042&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6042&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13111156">FLINK-7896</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12893960" name="initTransactions_deadlock.txt" size="2513153" author="pnowojski" created="Wed, 25 Oct 2017 15:05:13 +0000"/>
                            <attachment id="12892094" name="log.txt" size="2324079" author="pnowojski" created="Fri, 13 Oct 2017 15:55:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3l90f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>