<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4046] Failing a restarting job can get stuck in JobStatus.FAILING</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4046</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When a job is in state &lt;tt&gt;RESTARTING&lt;/tt&gt;, then it can happen that all of its &lt;tt&gt;ExecutionJobVertices&lt;/tt&gt; are in a final state (if they have not been reset). When calling &lt;tt&gt;fail&lt;/tt&gt; on this &lt;tt&gt;ExecutionGraph&lt;/tt&gt; will transition the state to &lt;tt&gt;FAILING&lt;/tt&gt; and call cancel on all &lt;tt&gt;ExecutionJobVertices&lt;/tt&gt;. The job state &lt;tt&gt;FAILING&lt;/tt&gt; can only be left iff all &lt;tt&gt;ExecutionJobVertices&lt;/tt&gt; have reached a final state. The notification of this final state is only sent to the &lt;tt&gt;ExecutionGraph&lt;/tt&gt; when all subtasks of an &lt;tt&gt;ExecutionJobVertex&lt;/tt&gt; have transitioned to a final state. However, this won&apos;t happen because the &lt;tt&gt;ExeuctionJobVertices&lt;/tt&gt; are already in a final state. The result is that a job can get stuck in the state &lt;tt&gt;FAILING&lt;/tt&gt; if &lt;tt&gt;fail&lt;/tt&gt; is called on a &lt;tt&gt;RESTARTING&lt;/tt&gt; job.&lt;/p&gt;

&lt;p&gt;I propose to add a direct transition from &lt;tt&gt;RESTARTING&lt;/tt&gt; to &lt;tt&gt;FAILED&lt;/tt&gt; as it is the case for the &lt;tt&gt;cancel&lt;/tt&gt; call (transition from &lt;tt&gt;RESTARTING&lt;/tt&gt; to &lt;tt&gt;CANCELED&lt;/tt&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12977233">FLINK-4046</key>
            <summary>Failing a restarting job can get stuck in JobStatus.FAILING</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2016 13:49:26 +0000</created>
                <updated>Thu, 23 Jun 2016 12:13:16 +0000</updated>
                            <resolved>Thu, 23 Jun 2016 12:00:12 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15327080" author="githubbot" created="Mon, 13 Jun 2016 09:44:12 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4046&quot; title=&quot;Failing a restarting job can get stuck in JobStatus.FAILING&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4046&quot;&gt;&lt;del&gt;FLINK-4046&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Add direct state transition from RESTARTING to FAILED&lt;/p&gt;

&lt;p&gt;    A job can get stuck in FAILING if fail is called on a restarting job which has&lt;br/&gt;
    not yet reset its ExecutionJobVertices, because these vertices would not call&lt;br/&gt;
    jobVertexInFinalState. This method, however, must be called in order to transition&lt;br/&gt;
    from FAILING to FAILED. In order to solve the problem, this PR introduces a direct&lt;br/&gt;
    state transition from `RESTARTING` to `FAILED`, if `fail` is called when being in state &lt;br/&gt;
    `RESTARTING`.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixFailWhileRestarting&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2095&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 094c6b59eb92cb5a0f3bf41aa92aab399ba4127c&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-06-09T13:54:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4046&quot; title=&quot;Failing a restarting job can get stuck in JobStatus.FAILING&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4046&quot;&gt;&lt;del&gt;FLINK-4046&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Add direct state transition from RESTARTING to FAILED&lt;/p&gt;

&lt;p&gt;    A job can get stuck in FAILING if fail is called on a restarting job which has&lt;br/&gt;
    not yet reset its ExecutionJobVertices, because these vertices would not call&lt;br/&gt;
    jobVertexInFinalState. This method, however, must be called in order to transition&lt;br/&gt;
    from FAILING to FAILED.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15344169" author="githubbot" created="Wed, 22 Jun 2016 11:49:52 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to merge. Both the direct state transition and test are good.&lt;/p&gt;</comment>
                            <comment id="15344257" author="githubbot" created="Wed, 22 Jun 2016 12:46:44 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    PS: Should the early abort check for the `CANCELED` state in `ExecutionGraph.restart()` be extended to any terminal state? The `restart` method assumes that it&apos;s the only one transitioning away from `RESTARTING`, which is not the case any more. I think it&apos;s not  needed, but might lead to confusing log messages when `fail` and `restart` are called concurrently.&lt;/p&gt;
</comment>
                            <comment id="15346310" author="githubbot" created="Thu, 23 Jun 2016 11:54:31 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @uce. I think you&apos;re right and we should also accept the `FAILED` state when calling `restart` and simply print a log message instead of throwing the `IllegalStateException`. But I&apos;m not so sure for any terminal state because we should not have reached the state `FINISHED`. This usually indicates a failure and should not go unnoticed.&lt;/p&gt;

&lt;p&gt;    I will add the `FAILED` check and then merge the PR.&lt;/p&gt;</comment>
                            <comment id="15346315" author="till.rohrmann" created="Thu, 23 Jun 2016 12:00:13 +0000"  >&lt;p&gt;Fixed via cfe629340205586d54115143ee30428c1f772abc&lt;/p&gt;</comment>
                            <comment id="15346317" author="githubbot" created="Thu, 23 Jun 2016 12:00:50 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15346325" author="githubbot" created="Thu, 23 Jun 2016 12:13:16 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2095&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Agreed. I had the same thought regarding checking for any final state right after posting this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; +1 to merge.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 21 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z82f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>