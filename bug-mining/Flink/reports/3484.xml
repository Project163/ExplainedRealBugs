<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13438] Support date type in Hive</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13438</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Similar to JDBC connectors, Hive connectors communicate with Flink framework using TableSchema, which contains DataType. As the time data read from and write to Hive connectors must be java.sql.* types and the default conversion class of our time data types are java.time.*, we have to fix&#160;Hive connector with DataTypes.DATE/TIME/TIMESTAMP support.&lt;/p&gt;

&lt;p&gt;But currently when reading tables from Hive, the table schema is created using Hive&apos;s schema, so the time types in the created schema will be sql time type not local time type. If user specifies a local time type in the table schema when creating a table in Hive, he will get a different schema when reading it out. This is undesired.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13247264">FLINK-13438</key>
            <summary>Support date type in Hive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lirui">Rui Li</assignee>
                                    <reporter username="TsReaper">Caizhi Weng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 26 Jul 2019 09:58:54 +0000</created>
                <updated>Mon, 9 Dec 2019 12:29:35 +0000</updated>
                            <resolved>Mon, 9 Dec 2019 12:29:35 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Connectors / Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16893699" author="jark" created="Fri, 26 Jul 2019 10:00:59 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuefuz&quot; class=&quot;user-hover&quot; rel=&quot;xuefuz&quot;&gt;xuefuz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16893758" author="lirui" created="Fri, 26 Jul 2019 11:52:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=TsReaper&quot; class=&quot;user-hover&quot; rel=&quot;TsReaper&quot;&gt;TsReaper&lt;/a&gt; Not sure if I understand the issue correctly. When creating TableSchema for a Hive table, we map Hive&apos;s &lt;tt&gt;TIMESTAMP&lt;/tt&gt; type to &lt;tt&gt;DataTypes.TIMESTAMP()&lt;/tt&gt; in Flink. Do you mean there&apos;s something wrong with this type mapping? Or do you mean the records we get for a timestamp column are of wrong type? If it&apos;s the latter, we convert objects between Hive and Flink in &lt;tt&gt;HiveInspectors&lt;/tt&gt;, and we can add some conversion for date/timestamp type.&lt;/p&gt;</comment>
                            <comment id="16893796" author="jark" created="Fri, 26 Jul 2019 12:32:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, by default, &lt;tt&gt;DataTypes.TIMESTAMP()&lt;/tt&gt; bridge to the &lt;tt&gt;java.time.LocalDateTime&lt;/tt&gt; class. However, we are returning a &lt;tt&gt;java.sql.Timestamp&lt;/tt&gt; from Hive table?&lt;/p&gt;</comment>
                            <comment id="16894616" author="lirui" created="Sun, 28 Jul 2019 04:06:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; yes, Hive returns `java.sql.Timestamp` for timestamp columns (at least for the Hive versions we currently support). We can do some conversion between `Timestamp` and `LocalDateTime `. But I suppose there might be issues due to different semantics of these two. E.g. DST has an impact on the string presentation of `Timestamp`, but not `LocalDateTime`. I&apos;ll do some investigation to verify.&lt;/p&gt;</comment>
                            <comment id="16894690" author="lzljs3620320" created="Sun, 28 Jul 2019 12:46:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;&#160;, I think should add tests to&#160;DATE/TIME/TIMESTAMP type&#160;in Hive source, sink and udx using blink-planner (and maybe using flink-planner too).&lt;/p&gt;

&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=TsReaper&quot; class=&quot;user-hover&quot; rel=&quot;TsReaper&quot;&gt;TsReaper&lt;/a&gt;, I think you should explain which case and code will lead to this bug in Jira to let the problem more understandable.&lt;/p&gt;</comment>
                            <comment id="16894837" author="tsreaper" created="Mon, 29 Jul 2019 01:05:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;, sorry for the late response. I actually tried to&#160;add support for DataTypes.DATE/TIME/TIMESTAMP&#160;before submitting this issue, and my patch is provided in the attachment. In this patch, when running `HiveCatalogDataTypeTest`, two tests will fail due to this issue. Please take a look.&lt;/p&gt;</comment>
                            <comment id="16895025" author="jark" created="Mon, 29 Jul 2019 07:42:30 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, will you help to fix this issue? If yes, I can assign this to you.&lt;/p&gt;</comment>
                            <comment id="16895136" author="jark" created="Mon, 29 Jul 2019 10:34:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; will help to review this. &lt;/p&gt;</comment>
                            <comment id="16895612" author="xuefuz" created="Mon, 29 Jul 2019 21:51:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=TsReaper&quot; class=&quot;user-hover&quot; rel=&quot;TsReaper&quot;&gt;TsReaper&lt;/a&gt;, Thank you for reporting the issue and providing a fix. I think I understand the problem after reading the whole discussion and your patch. &lt;/p&gt;

&lt;p&gt;To help others understand the problem: Yes, Hive represents Date/TimeStamp data with  classes are in java.sql.*, while Flink expects java.time.LocalDate objects (by default). For this, conversions are needed. However, the current code assumes an identity conversion.&lt;/p&gt;

&lt;p&gt;Since you have already provided a patch here, I&apos;d suggest you convert it to a PR at github as that&apos;s how code is contributed in Flink. You might also want to rephrase the description here to better outline the problem. Your fix seems reasonable at my first glance. As critical as it can be, we&apos;d like to include a fix for this in 1.9.&lt;/p&gt;

&lt;p&gt;BTW, the new test cases about those types are missing in your patch (possibly in the new file HiveCatalogDataTypeTest.java which is not included).&lt;/p&gt;</comment>
                            <comment id="16991545" author="ykt836" created="Mon, 9 Dec 2019 12:29:35 +0000"  >&lt;p&gt;master:&#160;2994f0e44b53c85535f2f29fb43d320ace91f6f8&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13271843">FLINK-15020</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12976082" name="0001-hive.patch" size="37320" author="TsReaper" created="Mon, 29 Jul 2019 01:05:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0522o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>