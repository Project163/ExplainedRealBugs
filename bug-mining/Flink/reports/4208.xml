<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17553] Constant exists in group window key leads to  error:  Unsupported call: TUMBLE_END(TIMESTAMP(3) NOT NULL)</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17553</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Exception stack is as following:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13002266/13002266_temp.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;We can reproduce this problem by add following test in org.apache.flink.table.planner.runtime.stream.sql#TimeAttributeITCase&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Some comments here
&lt;/span&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; testWindowAggregateOnConstantValue(): Unit = {
    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; ddl1 =
      &quot;&quot;&quot;
        |CREATE TABLE src (
        |  log_ts STRING,
        |  ts TIMESTAMP(3),
        |  a INT,
        |  b DOUBLE,
        |  rowtime AS CAST(log_ts AS TIMESTAMP(3)),
        |  WATERMARK FOR rowtime AS rowtime - INTERVAL &apos;0.001&apos; SECOND
        |) WITH (
        |  &apos;connector&apos; = &apos;COLLECTION&apos;,
        |  &apos;is-bounded&apos; = &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;
        |)
      &quot;&quot;&quot;.stripMargin
    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; ddl2 =
      &quot;&quot;&quot;
        |CREATE TABLE dst (
        |  ts TIMESTAMP(3),
        |  a BIGINT,
        |  b DOUBLE
        |) WITH (
        |  &apos;connector.&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&apos; = &apos;filesystem&apos;,
        |  &apos;connector.path&apos; = &apos;/tmp/1&apos;,
        |  &apos;format.&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&apos; = &apos;csv&apos;
        |)
      &quot;&quot;&quot;.stripMargin
    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; query =
      &quot;&quot;&quot;
        |INSERT INTO dst
        |SELECT TUMBLE_END(rowtime, INTERVAL &apos;0.003&apos; SECOND), COUNT(ts), SUM(b)
        |FROM src
        | GROUP BY &apos;a&apos;, TUMBLE(rowtime, INTERVAL &apos;0.003&apos; SECOND)
        |-- GROUP BY TUMBLE(rowtime, INTERVAL &apos;0.003&apos; SECOND)
      &quot;&quot;&quot;.stripMargin
    tEnv.sqlUpdate(ddl1)
    tEnv.sqlUpdate(ddl2)
    tEnv.sqlUpdate(query)
    println(tEnv.explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;







&lt;p&gt;I spent lots of work digging into this bug, and found the problem may be caused by AggregateProjectPullUpConstantsRule which doesn&apos;t generate proper project items correctly.&lt;br/&gt;
After I remove AggregateProjectPullUpConstantsRule from FlinkStreamRuleSets#DEFAULT_REWRITE_RULES, the test passed as expect.&lt;/p&gt;

&lt;p&gt;The problem is that WindowPropertiesRule can not match RelNodeTree after the transformation of AggregateProjectPullUpConstantsRule, we also can add ProjectMergeRule.INSTANCE in FlinkStreamRuleSets#DEFAULT_REWRITE_RULES after AggregateProjectPullUpConstantsRule.INSTANCE to solve this problem.&lt;/p&gt;










</description>
                <environment></environment>
        <key id="13303337">FLINK-17553</key>
            <summary>Constant exists in group window key leads to  error:  Unsupported call: TUMBLE_END(TIMESTAMP(3) NOT NULL)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Terry1897">Terry Wang</assignee>
                                    <reporter username="Terry1897">Terry Wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 7 May 2020 09:57:50 +0000</created>
                <updated>Mon, 8 Jun 2020 09:46:06 +0000</updated>
                            <resolved>Fri, 5 Jun 2020 08:29:22 +0000</resolved>
                                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17102290" author="terry1897" created="Fri, 8 May 2020 06:12:01 +0000"  >&lt;p&gt;I open a PR &lt;a href=&quot;https://github.com/apache/flink/pull/12028&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/12028&lt;/a&gt; to help understanding and solving this bug.&lt;/p&gt;</comment>
                            <comment id="17111976" author="danny0405" created="Wed, 20 May 2020 09:24:30 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;, can you take a look for this PR ~&lt;/p&gt;</comment>
                            <comment id="17123488" author="danny0405" created="Tue, 2 Jun 2020 08:18:54 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; please help to merge this PR.&lt;/p&gt;</comment>
                            <comment id="17126532" author="jark" created="Fri, 5 Jun 2020 08:29:22 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master (1.12.0): c67109e99437d1dcca9fb6fca9f2741747c82a04&lt;/li&gt;
	&lt;li&gt;1.11.0: 3fe471ffaccadf674f310019db5ccdc9a3ae94e4&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13310070">FLINK-18179</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13228769">FLINK-12249</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13002266" name="temp.png" size="338196" author="Terry1897" created="Thu, 7 May 2020 10:02:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0egqg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>