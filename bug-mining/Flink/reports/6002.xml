<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24835] &quot;group by&quot; in the interval join will throw a exception</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24835</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Can reproduce this bug by the following code added into IntervalJoinTest.scala:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
def testSemiIntervalJoinWithSimpleConditionAndGroup(): Unit = {
  val sql =
    &quot;&quot;&quot;
      |SELECT t1.a FROM MyTable t1 WHERE t1.a IN (
      | SELECT t2.a FROM MyTable2 t2
      |   WHERE t1.b = t2.b AND t1.rowtime between t2.rowtime and t2.rowtime + INTERVAL &lt;span class=&quot;code-quote&quot;&gt;&apos;5&apos;&lt;/span&gt; MINUTE
      |   GROUP BY t2.a
      |)
    &quot;&quot;&quot;.stripMargin
  util.verifyExecPlan(sql)
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The exception is :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalStateException
&#160; &#160; at org.apache.flink.util.Preconditions.checkState(Preconditions.java:177)
&#160; &#160; at org.apache.flink.table.planner.plan.rules.physical.stream.StreamPhysicalJoinRule.matches(StreamPhysicalJoinRule.scala:64)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoRuleCall.matchRecurse(VolcanoRuleCall.java:284)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoRuleCall.matchRecurse(VolcanoRuleCall.java:411)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoRuleCall.matchRecurse(VolcanoRuleCall.java:411)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoRuleCall.match(VolcanoRuleCall.java:268)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.fireRules(VolcanoPlanner.java:985)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1245)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:84)
&#160; &#160; at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:268)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1132)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:84)
&#160; &#160; at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:268)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1132)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:84)
&#160; &#160; at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:268)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1132)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:84)
&#160; &#160; at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:268)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1132)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604)
&#160; &#160; at org.apache.calcite.plan.volcano.VolcanoPlanner.changeTraits(VolcanoPlanner.java:486)
&#160; &#160; at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:309)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:69)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.$anonfun$optimize$1(FlinkChainedProgram.scala:64)
&#160; &#160; at scala.collection.TraversableOnce.$anonfun$foldLeft$1(TraversableOnce.scala:156)
&#160; &#160; at scala.collection.TraversableOnce.$anonfun$foldLeft$1$adapted(TraversableOnce.scala:156)
&#160; &#160; at scala.collection.Iterator.foreach(Iterator.scala:937)
&#160; &#160; at scala.collection.Iterator.foreach$(Iterator.scala:937)
&#160; &#160; at scala.collection.AbstractIterator.foreach(Iterator.scala:1425)
&#160; &#160; at scala.collection.IterableLike.foreach(IterableLike.scala:70)
&#160; &#160; at scala.collection.IterableLike.foreach$(IterableLike.scala:69)
&#160; &#160; at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
&#160; &#160; at scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:156)
&#160; &#160; at scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:154)
&#160; &#160; at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.optimize(FlinkChainedProgram.scala:60)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.optimizeTree(StreamCommonSubGraphBasedOptimizer.scala:165)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.doOptimize(StreamCommonSubGraphBasedOptimizer.scala:83)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.CommonSubGraphBasedOptimizer.optimize(CommonSubGraphBasedOptimizer.scala:77)
&#160; &#160; at org.apache.flink.table.planner.delegation.PlannerBase.optimize(PlannerBase.scala:309)
&#160; &#160; at org.apache.flink.table.planner.utils.TableTestUtilBase.assertPlanEquals(TableTestBase.scala:894)
&#160; &#160; at org.apache.flink.table.planner.utils.TableTestUtilBase.doVerifyPlan(TableTestBase.scala:790)
&#160; &#160; at org.apache.flink.table.planner.utils.TableTestUtilBase.verifyExecPlan(TableTestBase.scala:591)
&#160; &#160; at org.apache.flink.table.planner.plan.stream.sql.join.IntervalJoinTest.testSemiIntervalJoinWithSimpleConditionAndGroup(IntervalJoinTest.scala:76) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is caused by that the agg casts the time indicator type to the common timestamp.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13410741">FLINK-24835</key>
            <summary>&quot;group by&quot; in the interval join will throw a exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jingzhang">Jing Zhang</assignee>
                                    <reporter username="xuyangzhong">Xuyang Zhong</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 9 Nov 2021 03:22:40 +0000</created>
                <updated>Wed, 15 Dec 2021 01:44:06 +0000</updated>
                            <resolved>Fri, 19 Nov 2021 03:03:42 +0000</resolved>
                                                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17440890" author="qingru zhang" created="Tue, 9 Nov 2021 04:07:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuyangzhong&quot; class=&quot;user-hover&quot; rel=&quot;xuyangzhong&quot;&gt;xuyangzhong&lt;/a&gt; Thanks for reporting this problem.&lt;/p&gt;

&lt;p&gt;The case is interesting, the sql looks like a interval join query at first glance, but it is a regular join because right side is a unbounded aggregate which has no time attribute field.&lt;/p&gt;

&lt;p&gt;In theory, the query would translated into regular join instead of interval join because the time attribute of right side would be materialized because it is an unbounded aggregate.&lt;/p&gt;

&lt;p&gt;For this case, both left side and right side of join&#160; should be materialized. But there is a bug in `RelTimeIndicatorConverter#visitJoin`. The bug would mistaken regard the join as interval join, so it skip materialized time attribute of left side which leads an exception in `StreamPhysicalJoinRule`.&lt;/p&gt;

&lt;p&gt;I would fix this bug soon, thanks again for reporting this bug.&lt;/p&gt;</comment>
                            <comment id="17446256" author="godfreyhe" created="Fri, 19 Nov 2021 03:03:42 +0000"  >&lt;p&gt;Fixed in &lt;br/&gt;
  1.15.0: 8aa74d5ad7026734bdd98eabbc9cbbb243bbe8b0&lt;br/&gt;
  1.14.1: d3df986a75e34e1ed475b2e1236b7770698e7bd1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wk3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>