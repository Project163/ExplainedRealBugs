<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:29:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7041] Deserialize StateBackend from JobCheckpointingSettings with user classloader</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7041</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user ran into the problem that the &lt;tt&gt;SubmitJob&lt;/tt&gt; message is not (de)serialisable if it contains custom RocksDB options (or a custom state backend): &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The problem is that &lt;tt&gt;SubmitJob&lt;/tt&gt; contains a &lt;tt&gt;JobGraph&lt;/tt&gt; which contains &lt;tt&gt;JobCheckpointingSettings&lt;/tt&gt; which contains a &lt;tt&gt;StateBackend&lt;/tt&gt;. This &lt;tt&gt;StateBackend&lt;/tt&gt; potentially has user code and therefore can only be deserialised with the user classloader.&lt;/p&gt;

&lt;p&gt;This issue is mostly identical to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6531&quot; title=&quot;Deserialize checkpoint hooks with user classloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6531&quot;&gt;&lt;del&gt;FLINK-6531&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://lists.apache.org/thread.html/69bb573787258ab34c3dc56ac155052f099d75e62d805f463bde5621@%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/69bb573787258ab34c3dc56ac155052f099d75e62d805f463bde5621@%3Cuser.flink.apache.org%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13083510">FLINK-7041</key>
            <summary>Deserialize StateBackend from JobCheckpointingSettings with user classloader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jun 2017 16:39:11 +0000</created>
                <updated>Thu, 6 Jul 2017 08:45:09 +0000</updated>
                            <resolved>Thu, 6 Jul 2017 04:31:21 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>1.3.1</version>
                                    <fixVersion>1.3.2</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>API / DataStream</component>
                    <component>Runtime / Coordination</component>
                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16069762" author="githubbot" created="Fri, 30 Jun 2017 09:22:14 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7041&quot; title=&quot;Deserialize StateBackend from JobCheckpointingSettings with user classloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7041&quot;&gt;&lt;del&gt;FLINK-7041&lt;/del&gt;&lt;/a&gt; Deserialize StateBackend from JobCheckpointingSettings with user classloader&lt;/p&gt;

&lt;p&gt;    R: @tzulitai &lt;/p&gt;

&lt;p&gt;    CC: @StephanEwen I noticed that the state backend that is in the configuration is never used anywhere. I&apos;m guessing this is for future work or is something missing in the code?&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; jira-7041-fix-state-backend-classloader&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4232&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5ed5300b510f1439ceb516b44592e433dbc46931&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-06-30T09:19:30Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7041&quot; title=&quot;Deserialize StateBackend from JobCheckpointingSettings with user classloader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7041&quot;&gt;&lt;del&gt;FLINK-7041&lt;/del&gt;&lt;/a&gt; Deserialize StateBackend from JobCheckpointingSettings with user classloader&lt;/p&gt;

&lt;p&gt;    This also adds a test for serializability with a class that&apos;s not in the&lt;br/&gt;
    default classloader.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16069793" author="githubbot" created="Fri, 30 Jun 2017 09:42:18 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the quick fix @aljoscha!&lt;/p&gt;

&lt;p&gt;    Regarding tests:&lt;br/&gt;
    Can we also have another test that verifies `JobGraphs` containing custom `StateBackend`s or `StateBackends` with custom classes can be submitted without exceptions?&lt;br/&gt;
    Looks like `org.apache.flink.runtime.jobmanager.JobSubmitTest` is a good place for that.&lt;/p&gt;</comment>
                            <comment id="16069803" author="githubbot" created="Fri, 30 Jun 2017 09:49:19 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah scratch that, perhaps the `CheckpointSettingsSerializableTest` is sufficient.&lt;/p&gt;</comment>
                            <comment id="16069822" author="githubbot" created="Fri, 30 Jun 2017 09:58:40 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232#discussion_r125004426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232#discussion_r125004426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraphBuilder.java &amp;#8212;&lt;br/&gt;
    @@ -223,19 +223,21 @@ public static ExecutionGraph buildGraph(&lt;br/&gt;
     			// if specified in the application, use from there, otherwise load from configuration&lt;br/&gt;
     			final StateBackend metadataBackend;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final StateBackend applicationConfiguredBackend = snapshotSettings.getDefaultStateBackend();&lt;br/&gt;
    +			final SerializedValue&amp;lt;StateBackend&amp;gt; applicationConfiguredBackend = snapshotSettings.getDefaultStateBackend();&lt;br/&gt;
     			if (applicationConfiguredBackend != null) {&lt;/li&gt;
	&lt;li&gt;metadataBackend = applicationConfiguredBackend;&lt;br/&gt;
    +				try 
{
    +					metadataBackend = applicationConfiguredBackend.deserializeValue(classLoader);
    +				}
&lt;p&gt; catch (IOException | ClassNotFoundException e) &lt;/p&gt;
{
    +					throw new JobExecutionException(jobId, &quot;Could not instantiate configured state backend.&quot;, e);
    +				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				log.info(&quot;Using application-defined state backend for checkpoint/savepoint metadata: {}.&quot;,&lt;br/&gt;
     						applicationConfiguredBackend);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Need to change the argument for this log to `metadataBackend`&lt;/p&gt;</comment>
                            <comment id="16070063" author="githubbot" created="Fri, 30 Jun 2017 13:07:03 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232#discussion_r125034182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232#discussion_r125034182&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraphBuilder.java &amp;#8212;&lt;br/&gt;
    @@ -223,19 +223,21 @@ public static ExecutionGraph buildGraph(&lt;br/&gt;
     			// if specified in the application, use from there, otherwise load from configuration&lt;br/&gt;
     			final StateBackend metadataBackend;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final StateBackend applicationConfiguredBackend = snapshotSettings.getDefaultStateBackend();&lt;br/&gt;
    +			final SerializedValue&amp;lt;StateBackend&amp;gt; applicationConfiguredBackend = snapshotSettings.getDefaultStateBackend();&lt;br/&gt;
     			if (applicationConfiguredBackend != null) {&lt;/li&gt;
	&lt;li&gt;metadataBackend = applicationConfiguredBackend;&lt;br/&gt;
    +				try 
{
    +					metadataBackend = applicationConfiguredBackend.deserializeValue(classLoader);
    +				}
&lt;p&gt; catch (IOException | ClassNotFoundException e) &lt;/p&gt;
{
    +					throw new JobExecutionException(jobId, &quot;Could not instantiate configured state backend.&quot;, e);
    +				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				log.info(&quot;Using application-defined state backend for checkpoint/savepoint metadata: {}.&quot;,&lt;br/&gt;
     						applicationConfiguredBackend);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Good catch!&lt;/p&gt;</comment>
                            <comment id="16073448" author="githubbot" created="Tue, 4 Jul 2017 10:34:47 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the fixups @aljoscha :-D&lt;br/&gt;
    The last Travis run was successful, the test name rename should not affect anything.&lt;br/&gt;
    Merging this ..&lt;/p&gt;</comment>
                            <comment id="16073525" author="githubbot" created="Tue, 4 Jul 2017 11:55:40 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks! &#128515; &lt;/p&gt;</comment>
                            <comment id="16075908" author="githubbot" created="Thu, 6 Jul 2017 04:24:52 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4232&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16075918" author="tzulitai" created="Thu, 6 Jul 2017 04:31:21 +0000"  >&lt;p&gt;Fixed for master via 64c6fa70f53425d09717e1560db88d5733601c24.&lt;br/&gt;
Fixed for 1.3 via 78bbb844a0b33d4297e9fa1044401a51e219fcfa.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gwjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>