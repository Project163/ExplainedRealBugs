<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9196] YARN: Flink binaries are not deleted from HDFS after cluster shutdown</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9196</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When deploying on YARN in flip6 mode, the Flink binaries are not deleted from HDFS after the cluster shuts down.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps to reproduce&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Submit job in YARN job mode, non-detached:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; HADOOP_CLASSPATH=`hadoop classpath` bin/flink run -m yarn-cluster -yjm 2048 -ytm 2048 ./examples/streaming/WordCount.jar &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Check contents of &lt;tt&gt;/user/hadoop/.flink/&amp;lt;application_id&amp;gt;&lt;/tt&gt; on HDFS after job is finished:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[hadoop@ip-172-31-43-78 flink-1.5.0]$ hdfs dfs -ls /user/hadoop/.flink/application_1523966184826_0016
Found 6 items
-rw-r--r--   1 hadoop hadoop        583 2018-04-17 14:54 /user/hadoop/.flink/application_1523966184826_0016/90cf5b3a-039e-4d52-8266-4e9563d74827-taskmanager-conf.yaml
-rw-r--r--   1 hadoop hadoop        332 2018-04-17 14:54 /user/hadoop/.flink/application_1523966184826_0016/application_1523966184826_0016-flink-conf.yaml3818971235442577934.tmp
-rw-r--r--   1 hadoop hadoop   89779342 2018-04-02 17:08 /user/hadoop/.flink/application_1523966184826_0016/flink-dist_2.11-1.5.0.jar
drwxrwxrwx   - hadoop hadoop          0 2018-04-17 14:54 /user/hadoop/.flink/application_1523966184826_0016/lib
-rw-r--r--   1 hadoop hadoop       1939 2018-04-02 15:37 /user/hadoop/.flink/application_1523966184826_0016/log4j.properties
-rw-r--r--   1 hadoop hadoop       2331 2018-04-02 15:37 /user/hadoop/.flink/application_1523966184826_0016/logback.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13153036">FLINK-9196</key>
            <summary>YARN: Flink binaries are not deleted from HDFS after cluster shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gjy">Gary Yao</assignee>
                                    <reporter username="gjy">Gary Yao</reporter>
                        <labels>
                            <label>flip-6</label>
                    </labels>
                <created>Tue, 17 Apr 2018 15:06:09 +0000</created>
                <updated>Wed, 2 May 2018 10:37:35 +0000</updated>
                            <resolved>Wed, 2 May 2018 10:37:30 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16441248" author="stephanewen" created="Tue, 17 Apr 2018 17:47:32 +0000"  >&lt;p&gt;I think this may explain parts of the error described here: &lt;a href=&quot;https://lists.apache.org/thread.html/73b652d2f4ba1167ff8166dc8260cf3458d5555f562c630f8f891eb3@%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/73b652d2f4ba1167ff8166dc8260cf3458d5555f562c630f8f891eb3@%3Cuser.flink.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16454295" author="yuqi" created="Thu, 26 Apr 2018 14:23:25 +0000"  >&lt;p&gt;As far as i see, The problem may due to the fact that Clifront forget to delete tmp files that lie in HDFS in normal mode.&lt;/p&gt;

&lt;p&gt;As the log says&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2018-04-26 17:44:18,049 INFO org.apache.flink.yarn.AbstractYarnClusterDescriptor - The Flink YARN client has been started in detached mode. In order to stop Flink on YARN, use the following command or a YARN web &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; to stop it:
yarn application -kill application_1520998295402_0099
Please also note that the temporary files of the YARN session in the home directory will not be removed.
Job has been submitted with JobID 3c78bf2c36a0ceceea5ae9c497f82732
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I wonder if we should delete tmp file in detached mode.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I make some change as blow.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12920808/12920808_0001-xxx.patch&quot; title=&quot;0001-xxx.patch attached to FLINK-9196&quot;&gt;0001-xxx.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Can one help to look if this is Ok?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16457508" author="githubbot" created="Sat, 28 Apr 2018 10:04:04 +0000"  >&lt;p&gt;GitHub user GJL opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9196&quot; title=&quot;YARN: Flink binaries are not deleted from HDFS after cluster shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9196&quot;&gt;&lt;del&gt;FLINK-9196&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;flip6, yarn&amp;#93;&lt;/span&gt; Cleanup application files when deregistering YARN AM&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;Ensure that YARN application files are removed if cluster is shutdown.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    cc: @StephanEwen @tillrohrmann &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Enable graceful cluster shut down via HTTP.&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;*Remove Flink application files from remote file system when the YarnResourceManager deregisters the YARN ApplicationMaster.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Manually verified that files are removed from HDFS when running stream (attached/detached) and batch jobs (attached).&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Manually verified that files are removed from HDFS when running stopping a yarn session gracefully.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (*&lt;b&gt;yes&lt;/b&gt;* / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/GJL/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/GJL/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9196&quot; title=&quot;YARN: Flink binaries are not deleted from HDFS after cluster shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9196&quot;&gt;&lt;del&gt;FLINK-9196&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5938&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6f0c0aed8a5b54814ed2e0fa761f06317592e4b3&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-19T08:29:43Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Replace String concatenation with Slf4j placeholders.&lt;/p&gt;

&lt;p&gt;commit 34b5b40fec62502579a3f3804839c1e9d1e95952&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-19T09:03:20Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Indent method parameters.&lt;/p&gt;

&lt;p&gt;commit bcb0f24ec587c15287c6144d1c088a5327d98c6d&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-19T09:04:27Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Remove unnecessary int cast.&lt;/p&gt;

&lt;p&gt;commit 264b3e664fe84583ab8e372824f6d4424627e6e1&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-19T09:05:05Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Fix raw types warning.&lt;/p&gt;

&lt;p&gt;commit 1b6eb96b3d287a20ea86606fd01b5e10564c3f5d&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-19T09:18:32Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Rename UtilsTest to YarnFlinkResourceManagerTest.&lt;/p&gt;

&lt;p&gt;    Test was misnamed.&lt;/p&gt;

&lt;p&gt;commit e8d43ff72a2861713db934fe42163fac6d9ecb8d&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-26T15:38:20Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;mesos&amp;#93;&lt;/span&gt; Delete unused class FlinkMesosSessionCli.&lt;/p&gt;

&lt;p&gt;commit a4f9a5c6a44f08aa5f4a8dbbfb28a0bdb562b8c5&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-26T15:44:56Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; Remove unused field appReport in YarnClusterClient.&lt;/p&gt;

&lt;p&gt;commit 1260dfac974670f325b21d175e1e29064530bb53&lt;br/&gt;
Author: gyao &amp;lt;gary@...&amp;gt;&lt;br/&gt;
Date:   2018-04-19T10:07:54Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9196&quot; title=&quot;YARN: Flink binaries are not deleted from HDFS after cluster shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9196&quot;&gt;&lt;del&gt;FLINK-9196&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;flip6, yarn&amp;#93;&lt;/span&gt; Cleanup application files when deregistering YARN AM&lt;/p&gt;

&lt;p&gt;    Enable graceful cluster shut down via HTTP.&lt;br/&gt;
    Remove Flink application files from remote file system when the&lt;br/&gt;
    YarnResourceManager deregisters the YARN ApplicationMaster.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16457510" author="githubbot" created="Sat, 28 Apr 2018 10:05:17 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938#discussion_r184848340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938#discussion_r184848340&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/test/java/org/apache/flink/yarn/UtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -18,227 +18,35 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.yarn;&lt;/p&gt;

&lt;p&gt;    -import org.apache.flink.configuration.Configuration;&lt;br/&gt;
    -import org.apache.flink.runtime.akka.AkkaUtils;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.ContaineredTaskManagerParameters;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.messages.NotifyResourceStarted;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.messages.RegisterResourceManager;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.messages.RegisterResourceManagerSuccessful;&lt;br/&gt;
    -import org.apache.flink.runtime.instance.AkkaActorGateway;&lt;br/&gt;
    -import org.apache.flink.runtime.leaderretrieval.SettableLeaderRetrievalService;&lt;br/&gt;
    -import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
    -import org.apache.flink.runtime.testingUtils.TestingUtils;&lt;br/&gt;
    -import org.apache.flink.util.TestLogger;&lt;br/&gt;
    -import org.apache.flink.yarn.messages.NotifyWhenResourcesRegistered;&lt;br/&gt;
    -import org.apache.flink.yarn.messages.RequestNumberOfRegisteredResources;&lt;br/&gt;
    -&lt;br/&gt;
    -import akka.actor.ActorRef;&lt;br/&gt;
    -import akka.actor.ActorSystem;&lt;br/&gt;
    -import akka.actor.PoisonPill;&lt;br/&gt;
    -import akka.actor.Props;&lt;br/&gt;
    -import akka.testkit.JavaTestKit;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ApplicationAttemptId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ApplicationId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.Container;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ContainerId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ContainerLaunchContext;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.NodeId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.client.api.AMRMClient;&lt;br/&gt;
    -import org.apache.hadoop.yarn.client.api.NMClient;&lt;br/&gt;
    -import org.apache.hadoop.yarn.client.api.async.AMRMClientAsync;&lt;br/&gt;
    -import org.apache.hadoop.yarn.conf.YarnConfiguration;&lt;br/&gt;
    -import org.junit.AfterClass;&lt;br/&gt;
    -import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Rule;&lt;br/&gt;
     import org.junit.Test;&lt;br/&gt;
    -import org.mockito.Matchers;&lt;br/&gt;
    -import org.mockito.invocation.InvocationOnMock;&lt;br/&gt;
    -import org.mockito.stubbing.Answer;&lt;br/&gt;
    +import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt;    -import java.util.ArrayList;&lt;br/&gt;
    +import java.nio.file.Files;&lt;br/&gt;
    +import java.nio.file.Path;&lt;br/&gt;
     import java.util.Collections;&lt;br/&gt;
    -import java.util.HashMap;&lt;br/&gt;
    -import java.util.List;&lt;br/&gt;
    -import java.util.UUID;&lt;br/&gt;
    -import java.util.concurrent.CompletableFuture;&lt;br/&gt;
    -import java.util.concurrent.TimeUnit;&lt;br/&gt;
    -&lt;br/&gt;
    -import scala.Option;&lt;br/&gt;
    -import scala.concurrent.Await;&lt;br/&gt;
    -import scala.concurrent.Future;&lt;br/&gt;
    -import scala.concurrent.duration.Deadline;&lt;br/&gt;
    -import scala.concurrent.duration.FiniteDuration;&lt;/p&gt;

&lt;p&gt;    -import static org.junit.Assert.assertEquals;&lt;br/&gt;
    -import static org.mockito.Mockito.doAnswer;&lt;br/&gt;
    -import static org.mockito.Mockito.mock;&lt;br/&gt;
    -import static org.mockito.Mockito.when;&lt;br/&gt;
    +import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
    +import static org.junit.Assert.assertThat;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tests for 
{@link Utils}
&lt;p&gt;.&lt;br/&gt;
      */&lt;br/&gt;
    -public class UtilsTest extends TestLogger {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Renamed class to `YarnFlinkResourceManagerTest`&lt;/p&gt;</comment>
                            <comment id="16457511" author="githubbot" created="Sat, 28 Apr 2018 10:05:45 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938#discussion_r184848354&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938#discussion_r184848354&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/test/java/org/apache/flink/yarn/UtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -18,227 +18,35 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.yarn;&lt;/p&gt;

&lt;p&gt;    -import org.apache.flink.configuration.Configuration;&lt;br/&gt;
    -import org.apache.flink.runtime.akka.AkkaUtils;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.ContaineredTaskManagerParameters;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.messages.NotifyResourceStarted;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.messages.RegisterResourceManager;&lt;br/&gt;
    -import org.apache.flink.runtime.clusterframework.messages.RegisterResourceManagerSuccessful;&lt;br/&gt;
    -import org.apache.flink.runtime.instance.AkkaActorGateway;&lt;br/&gt;
    -import org.apache.flink.runtime.leaderretrieval.SettableLeaderRetrievalService;&lt;br/&gt;
    -import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
    -import org.apache.flink.runtime.testingUtils.TestingUtils;&lt;br/&gt;
    -import org.apache.flink.util.TestLogger;&lt;br/&gt;
    -import org.apache.flink.yarn.messages.NotifyWhenResourcesRegistered;&lt;br/&gt;
    -import org.apache.flink.yarn.messages.RequestNumberOfRegisteredResources;&lt;br/&gt;
    -&lt;br/&gt;
    -import akka.actor.ActorRef;&lt;br/&gt;
    -import akka.actor.ActorSystem;&lt;br/&gt;
    -import akka.actor.PoisonPill;&lt;br/&gt;
    -import akka.actor.Props;&lt;br/&gt;
    -import akka.testkit.JavaTestKit;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ApplicationAttemptId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ApplicationId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.Container;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ContainerId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.ContainerLaunchContext;&lt;br/&gt;
    -import org.apache.hadoop.yarn.api.records.NodeId;&lt;br/&gt;
    -import org.apache.hadoop.yarn.client.api.AMRMClient;&lt;br/&gt;
    -import org.apache.hadoop.yarn.client.api.NMClient;&lt;br/&gt;
    -import org.apache.hadoop.yarn.client.api.async.AMRMClientAsync;&lt;br/&gt;
    -import org.apache.hadoop.yarn.conf.YarnConfiguration;&lt;br/&gt;
    -import org.junit.AfterClass;&lt;br/&gt;
    -import org.junit.BeforeClass;&lt;br/&gt;
    +import org.junit.Rule;&lt;br/&gt;
     import org.junit.Test;&lt;br/&gt;
    -import org.mockito.Matchers;&lt;br/&gt;
    -import org.mockito.invocation.InvocationOnMock;&lt;br/&gt;
    -import org.mockito.stubbing.Answer;&lt;br/&gt;
    +import org.junit.rules.TemporaryFolder;&lt;/p&gt;

&lt;p&gt;    -import java.util.ArrayList;&lt;br/&gt;
    +import java.nio.file.Files;&lt;br/&gt;
    +import java.nio.file.Path;&lt;br/&gt;
     import java.util.Collections;&lt;br/&gt;
    -import java.util.HashMap;&lt;br/&gt;
    -import java.util.List;&lt;br/&gt;
    -import java.util.UUID;&lt;br/&gt;
    -import java.util.concurrent.CompletableFuture;&lt;br/&gt;
    -import java.util.concurrent.TimeUnit;&lt;br/&gt;
    -&lt;br/&gt;
    -import scala.Option;&lt;br/&gt;
    -import scala.concurrent.Await;&lt;br/&gt;
    -import scala.concurrent.Future;&lt;br/&gt;
    -import scala.concurrent.duration.Deadline;&lt;br/&gt;
    -import scala.concurrent.duration.FiniteDuration;&lt;/p&gt;

&lt;p&gt;    -import static org.junit.Assert.assertEquals;&lt;br/&gt;
    -import static org.mockito.Mockito.doAnswer;&lt;br/&gt;
    -import static org.mockito.Mockito.mock;&lt;br/&gt;
    -import static org.mockito.Mockito.when;&lt;br/&gt;
    +import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
    +import static org.junit.Assert.assertThat;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tests for 
{@link Utils}
&lt;p&gt;.&lt;br/&gt;
      */&lt;br/&gt;
    -public class UtilsTest extends TestLogger {&lt;br/&gt;
    +public class UtilsTest {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `TestLogger` missing.&lt;/p&gt;</comment>
                            <comment id="16457513" author="githubbot" created="Sat, 28 Apr 2018 10:07:58 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938#discussion_r184848405&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938#discussion_r184848405&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -265,6 +264,20 @@ public void waitForClusterToBeReady() {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	@Override&lt;br/&gt;
    +	public void shutDownCluster() {&lt;br/&gt;
    +		LOG.info(&quot;Sending shutdown request to the Application Master&quot;);&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			final Future&amp;lt;Object&amp;gt; response = Patterns.ask(applicationClient.get(),&lt;br/&gt;
    +				new YarnMessages.LocalStopYarnSession(ApplicationStatus.SUCCEEDED,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Always `SUCCEEDED` because previous logic in 1.4.2 used&lt;br/&gt;
    ```&lt;br/&gt;
    YarnApplicationState appState = lastReport.getYarnApplicationState();&lt;br/&gt;
    			ApplicationStatus status =&lt;br/&gt;
    				(appState == YarnApplicationState.FAILED || appState == YarnApplicationState.KILLED) ?&lt;br/&gt;
    					ApplicationStatus.FAILED : ApplicationStatus.SUCCEEDED;&lt;br/&gt;
    			if (status != ApplicationStatus.SUCCEEDED) {&lt;br/&gt;
    				LOG.warn(&quot;YARN reported application state {}&quot;, appState);&lt;br/&gt;
    				LOG.warn(&quot;Diagnostics: {}&quot;, lastReport.getDiagnostics());&lt;br/&gt;
    			}&lt;br/&gt;
    			return status;&lt;br/&gt;
    ```&lt;br/&gt;
    which does not make sense imo.&lt;/p&gt;</comment>
                            <comment id="16458906" author="githubbot" created="Mon, 30 Apr 2018 19:17:55 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938#discussion_r185080370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938#discussion_r185080370&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/rest/RestClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -570,6 +571,21 @@ public LeaderConnectionInfo getClusterConnectionInfo() throws LeaderRetrievalExc&lt;br/&gt;
     			});&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	@Override&lt;br/&gt;
    +	public void shutDownCluster() {&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			sendRetryableRequest(
    +				ShutdownHeaders.getInstance(),
    +				EmptyMessageParameters.getInstance(),
    +				EmptyRequestBody.getInstance(),
    +				isConnectionProblemException()).get();
    +		}
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
    +			Thread.currentThread().interrupt();
    +		}
&lt;p&gt; catch (ExecutionException e) {&lt;br/&gt;
    +			log.error(&quot;Error while shutting down cluster&quot;, e);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Throw the cause of the `ExecutionException`?&lt;/p&gt;</comment>
                            <comment id="16458908" author="githubbot" created="Mon, 30 Apr 2018 19:18:06 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging this...&lt;/p&gt;</comment>
                            <comment id="16459077" author="githubbot" created="Mon, 30 Apr 2018 21:25:30 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5938&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5938&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16459439" author="gjy" created="Tue, 1 May 2018 04:33:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuqi&quot; class=&quot;user-hover&quot; rel=&quot;yuqi&quot;&gt;yuqi&lt;/a&gt; Your patch would not work if the application is submitted in detached mode. When working on tickets, please assign the tickets to yourself in future.&lt;/p&gt;</comment>
                            <comment id="16459665" author="yuqi" created="Tue, 1 May 2018 12:56:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt; I see, thanks for your suggestion.&lt;/p&gt;</comment>
                            <comment id="16460848" author="stephanewen" created="Wed, 2 May 2018 10:37:30 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.5.0 via d130f87822818ba6f5c9dbd77ab3a774fdc41e60&lt;/li&gt;
	&lt;li&gt;1.6.0 via 37df3c8720385da6393a7157654a963c03e9ebb3&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12920808" name="0001-xxx.patch" size="1753" author="yuqi" created="Thu, 26 Apr 2018 14:22:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3snif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>