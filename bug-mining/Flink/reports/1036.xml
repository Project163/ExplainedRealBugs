<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4091] flink-connector-cassandra has conflicting guava version</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4091</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The newly merged cassandra streaming connector has an issue with its guava dependency.&lt;/p&gt;

&lt;p&gt;The build-process for flink-connector-cassandra creates shaded JAR file which contains the connector, the datastax cassandra driver plus in org.apache.flink.shaded a shaded copy of guava. &lt;/p&gt;

&lt;p&gt;The datastax cassandra driver calls into Futures.withFallback (&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;) which is present in this guava version. This also works inside the flink-connector-cassandra jar.&lt;/p&gt;

&lt;p&gt;Now the actual build-process for Flink happens and builds another shaded JAR and creates the flink-dist.jar. Inside this JAR, there is also a shaded version of guava inside org.apache.flink.shaded.&lt;/p&gt;

&lt;p&gt;Now the issue: The guava version which is in the flink-dist.jar is not compatible and doesn&apos;t contain the Futures.withFallback which the datastax driver is using.&lt;/p&gt;

&lt;p&gt;This leads into the following issue: You can without any problems launch a flink task which uses the casandra driver locally (so through the mini-cluster) because that is never using the flink-dist.jar. &lt;/p&gt;

&lt;p&gt;BUT: As soon as you are trying to start this job on a flink cluster (which uses the flink-dist.jar), the job breaks with the following exception:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/theomega/5ab9b14ffb516b15814de28e499b040d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/theomega/5ab9b14ffb516b15814de28e499b040d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can inspect this by opening the flink-connector-cassandra_2.11-1.1-SNAPSHOT.jar and the flink-dist_2.11-1.1-SNAPSHOT.jar in a java decompiler.&lt;/p&gt;

&lt;p&gt;I don&apos;t know a good solution here: Perhaps it would be one solution to shade the guava for the cassandra-driver somewhere else than at org.apache.flink.shaded.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: &lt;a href=&quot;https://google.github.io/guava/releases/19.0/api/docs/com/google/common/util/concurrent/Futures.html#withFallback(com.google.common.util.concurrent.ListenableFuture&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://google.github.io/guava/releases/19.0/api/docs/com/google/common/util/concurrent/Futures.html#withFallback(com.google.common.util.concurrent.ListenableFuture&lt;/a&gt;, com.google.common.util.concurrent.FutureFallback, java.util.concurrent.Executor)&lt;/p&gt;</description>
                <environment>&lt;p&gt;MacOSX, 1.10-SNAPSHOT (head is 1a6bab3ef76805685044cf4521e32315169f9033)&lt;/p&gt;</environment>
        <key id="12980304">FLINK-4091</key>
            <summary>flink-connector-cassandra has conflicting guava version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="theomega">Dominik Bruhn</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jun 2016 20:35:52 +0000</created>
                <updated>Mon, 12 Dec 2016 21:44:17 +0000</updated>
                            <resolved>Wed, 22 Jun 2016 09:45:45 +0000</resolved>
                                    <version>1.1.0</version>
                                                    <component>Connectors / Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15336967" author="zentol" created="Fri, 17 Jun 2016 21:11:57 +0000"  >&lt;p&gt;this issue is a bit surprising. the cassandra connector was used extensively in cluster environments during development.&lt;/p&gt;

&lt;p&gt;does this only happen on a cluster, but not in a local setup (not mini-cluster)?&lt;/p&gt;</comment>
                            <comment id="15336986" author="theomega" created="Fri, 17 Jun 2016 21:22:06 +0000"  >&lt;p&gt;Ok, I think I was unspecific here:&lt;br/&gt;
1. I works when starting the job directly, so when executing it and when using the integrated flink server. &lt;br/&gt;
2. It doesn&apos;t work (as described above) if I use the server which is brought up with &quot;start_local.sh&quot; and then execute the job-jar through &quot;flink run &lt;span class=&quot;error&quot;&gt;&amp;#91;jar&amp;#93;&lt;/span&gt;&quot;&lt;br/&gt;
3. I just checked, even if I launch flink using the &quot;start_cluster.sh&quot; script the same exception is raised. &lt;/p&gt;

&lt;p&gt;Both, &quot;start_local.sh&quot; and &quot;start_cluster.sh&quot; use the flink-dist jar which is IMHO broken in the way described above.&lt;/p&gt;</comment>
                            <comment id="15337620" author="zentol" created="Sat, 18 Jun 2016 07:02:58 +0000"  >&lt;p&gt;thank your for the clarification. is there any chance you could upload the complete TaskManager log file? that might shed some light on the issue.&lt;/p&gt;</comment>
                            <comment id="15337750" author="theomega" created="Sat, 18 Jun 2016 10:50:25 +0000"  >&lt;p&gt;Here is the stdout of the run command:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/theomega/4d1a1b83de1bbf715dd60d17b0143714&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/theomega/4d1a1b83de1bbf715dd60d17b0143714&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And here is the log:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/theomega/33f7f5b8d772d17c9c071614c4a73525&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/theomega/33f7f5b8d772d17c9c071614c4a73525&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could it be related to how I package the job? Currently I&apos;m integrating the flink-connector-cassandra into my fat job jar. I didn&apos;t find any documentation if that is the right approach.&lt;/p&gt;</comment>
                            <comment id="15337971" author="zentol" created="Sat, 18 Jun 2016 15:17:58 +0000"  >&lt;p&gt;If i recall correctly that&apos;s just what we did, but it would be interesting to see what would happen if the cassandra jar is available under /lib and not contained in the far-jar.&lt;/p&gt;

&lt;p&gt;Shading it to a different namespace would be the easiest solution, but I&apos;m still curious why this popped up now.&lt;/p&gt;</comment>
                            <comment id="15338516" author="theomega" created="Sun, 19 Jun 2016 13:14:33 +0000"  >&lt;p&gt;I tried it out using a non-fat jar and putting all the dependencies into the libs folder of flink. I was then able to start the job. The difference might be the order in which the jars are loaded.&lt;/p&gt;

&lt;p&gt;Also one strange (but most likely unrelated thing): The rabbit-mq streaming connector itself is already in the dist-jar (whereas the cassandra streaming connector is not). But: the rabbit-mq-streaming connector itself is a plain jar (whereas the cassandra streaming connectors own jar is a fat-jar), which means that do get the rabbit-mq-streaming connector running, I need to copy its dependencies into the libs folder of flink as well. But again, that might be unrelated.&lt;/p&gt;

&lt;p&gt;I still think it is not satisfying like this: Either the streaming-connector for cassandra is in the dist-jar, which would allow people to exclude it from their job-jars, or it works if the users put the connector into their fat jar. The manual copying of jars doesn&apos;t scale on a cluster...&lt;/p&gt;</comment>
                            <comment id="15339201" author="githubbot" created="Mon, 20 Jun 2016 09:17:00 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4091&quot; title=&quot;flink-connector-cassandra has conflicting guava version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4091&quot;&gt;&lt;del&gt;FLINK-4091&lt;/del&gt;&lt;/a&gt; Fix Guava shading in Cassandra connector&lt;/p&gt;

&lt;p&gt;    This PR modifies the guava shading in the Cassandra connector. It no longer uses the same pattern as flink-dist which lead to version conflicts.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 4091&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2133&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6e8fdd150fd45e86c2d4df4bfc7384f26472d2c9&lt;br/&gt;
Author: zentol &amp;lt;chesnay@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-06-20T09:15:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4091&quot; title=&quot;flink-connector-cassandra has conflicting guava version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4091&quot;&gt;&lt;del&gt;FLINK-4091&lt;/del&gt;&lt;/a&gt; Fix Guava shading in Cassandra connector&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15339202" author="zentol" created="Mon, 20 Jun 2016 09:17:25 +0000"  >&lt;p&gt;I&apos;ve opened a PR to change the shading pattern here: &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you try it out and see if it fixes your issue?&lt;/p&gt;</comment>
                            <comment id="15339221" author="githubbot" created="Mon, 20 Jun 2016 09:22:45 +0000"  >&lt;p&gt;Github user theomega commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Are you sure that this fixes the problem (I haven&apos;t tried): The change only changes the references in the connectors-code to the new package. But someone needs to provide this package, or am I getting something wrong?&lt;/p&gt;</comment>
                            <comment id="15339262" author="githubbot" created="Mon, 20 Jun 2016 09:55:29 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    you are right, guava is not properly included and shaded under the new reference.&lt;/p&gt;</comment>
                            <comment id="15339263" author="githubbot" created="Mon, 20 Jun 2016 09:55:38 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    *now&lt;/p&gt;</comment>
                            <comment id="15341454" author="githubbot" created="Tue, 21 Jun 2016 09:42:34 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Just verified the fix.&lt;/p&gt;

&lt;p&gt;    +1 to merge&lt;/p&gt;</comment>
                            <comment id="15344012" author="githubbot" created="Wed, 22 Jun 2016 09:42:51 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging&lt;/p&gt;
</comment>
                            <comment id="15344016" author="githubbot" created="Wed, 22 Jun 2016 09:45:17 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2133&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15344018" author="zentol" created="Wed, 22 Jun 2016 09:45:45 +0000"  >&lt;p&gt;Fixed in 7e206f490e17c47101edeb6c0950b0d36042fe2f&lt;/p&gt;</comment>
                            <comment id="15634445" author="rehevkor5" created="Thu, 3 Nov 2016 22:06:19 +0000"  >&lt;p&gt;Flink&apos;s inclusion of altered Cassandra classes (though probably unavoidable) was causing a lot of problems for us when using a library with dependencies on cassandra-driver-core and cassandra-driver-mapping. When launching a Flink job locally from the IDE, the two different versions of Cassandra included on the classpath would cause runtime errors. Excluding the two dependencies with Maven seems to have fixed the issue, allowing us to run our Flink jobs from the IDE again. Just figured I&apos;d mention it here in case it helps anyone else. However, we do have to be careful in the library not to use methods that return Guava classes (such as asyncPrepare) because they&apos;ll be written against the non-shaded Guava. Relocating the Guava package with the shade plugin works when using the jar, but not when running Flink jobs from within the IDE (IntelliJ doesn&apos;t have full integration with the shade plugin).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2znc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>