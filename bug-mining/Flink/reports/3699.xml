<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15840] ClassCastException is thrown when use tEnv.from for temp/catalog table under Blink planner</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15840</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;ClassCastException is thrown when use ConnectorDescriptor under Blink planner.&lt;br/&gt;
The exception can be reproduced by the following test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
def testDescriptor(): Unit = {
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.env = StreamExecutionEnvironment.getExecutionEnvironment
 val setting = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build()
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tEnv = StreamTableEnvironment.create(env, setting)

 tEnv.connect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileSystem().path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/input&quot;&lt;/span&gt;))
 .withFormat(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OldCsv().field(&lt;span class=&quot;code-quote&quot;&gt;&quot;word&quot;&lt;/span&gt;, DataTypes.STRING()))
 .withSchema(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema().field(&lt;span class=&quot;code-quote&quot;&gt;&quot;word&quot;&lt;/span&gt;, DataTypes.STRING()))
 .createTemporaryTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;sourceTable&quot;&lt;/span&gt;)

 val sink = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestingAppendSink
 tEnv.from(&lt;span class=&quot;code-quote&quot;&gt;&quot;sourceTable&quot;&lt;/span&gt;).toAppendStream[Row].addSink(sink)
 env.execute()
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exceptions:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: org.apache.calcite.plan.ViewExpanders$2 cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.flink.table.planner.calcite.FlinkToRelContext

 at org.apache.flink.table.planner.plan.schema.CatalogSourceTable.toRel(CatalogSourceTable.scala:89)
 at org.apache.calcite.rel.rules.TableScanRule.onMatch(TableScanRule.java:55)
 at org.apache.calcite.plan.AbstractRelOptPlanner.fireRule(AbstractRelOptPlanner.java:319)
 at org.apache.calcite.plan.hep.HepPlanner.applyRule(HepPlanner.java:560)
 at org.apache.calcite.plan.hep.HepPlanner.applyRules(HepPlanner.java:419)
 at org.apache.calcite.plan.hep.HepPlanner.executeInstruction(HepPlanner.java:256)
 at org.apache.calcite.plan.hep.HepInstruction$RuleInstance.execute(HepInstruction.java:127)
 at org.apache.calcite.plan.hep.HepPlanner.executeProgram(HepPlanner.java:215)
 at org.apache.calcite.plan.hep.HepPlanner.findBestExp(HepPlanner.java:202)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkHepProgram.optimize(FlinkHepProgram.scala:69)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkHepRuleSetProgram.optimize(FlinkHepRuleSetProgram.scala:87)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1$$anonfun$apply$1.apply(FlinkGroupProgram.scala:63)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1$$anonfun$apply$1.apply(FlinkGroupProgram.scala:60)
 at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
 at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
 at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:891)
 at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)
 at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72)
 at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
 at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
 at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1.apply(FlinkGroupProgram.scala:60)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1.apply(FlinkGroupProgram.scala:55)
 at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
 at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
 at scala.collection.immutable.Range.foreach(Range.scala:160)
 at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
 at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram.optimize(FlinkGroupProgram.scala:55)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram$$anonfun$optimize$1.apply(FlinkChainedProgram.scala:62)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram$$anonfun$optimize$1.apply(FlinkChainedProgram.scala:58)
 at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
 at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
 at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:891)
 at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)
 at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72)
 at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
 at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
 at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
 at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.optimize(FlinkChainedProgram.scala:57)
 at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.optimizeTree(StreamCommonSubGraphBasedOptimizer.scala:167)
 at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.doOptimize(StreamCommonSubGraphBasedOptimizer.scala:89)
 at org.apache.flink.table.planner.plan.optimize.CommonSubGraphBasedOptimizer.optimize(CommonSubGraphBasedOptimizer.scala:77)
 at org.apache.flink.table.planner.delegation.PlannerBase.optimize(PlannerBase.scala:248)
 at org.apache.flink.table.planner.delegation.PlannerBase.translate(PlannerBase.scala:151)
 at org.apache.flink.table.api.scala.internal.StreamTableEnvironmentImpl.toDataStream(StreamTableEnvironmentImpl.scala:210)
 at org.apache.flink.table.api.scala.internal.StreamTableEnvironmentImpl.toAppendStream(StreamTableEnvironmentImpl.scala:107)
 at org.apache.flink.table.api.scala.TableConversions.toAppendStream(TableConversions.scala:101)
 at org.apache.flink.table.planner.runtime.stream.table.CalcITCase.testDescriptor(CalcITCase.scala:541)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems we should not cast `context` to `FlinkToRelContext` directly as it could also be an anonymous classes in `org.apache.calcite.plan.ViewExpanders`.&lt;/p&gt;

&lt;p&gt;What do you think? &lt;/p&gt;</description>
                <environment></environment>
        <key id="13282731">FLINK-15840</key>
            <summary>ClassCastException is thrown when use tEnv.from for temp/catalog table under Blink planner</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lzljs3620320">Jingsong Lee</assignee>
                                    <reporter username="sunjincheng121">sunjincheng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 1 Feb 2020 04:16:08 +0000</created>
                <updated>Mon, 3 Feb 2020 13:59:52 +0000</updated>
                            <resolved>Mon, 3 Feb 2020 13:59:51 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17027977" author="lzljs3620320" created="Sat, 1 Feb 2020 05:32:16 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sunjincheng121&quot; class=&quot;user-hover&quot; rel=&quot;sunjincheng121&quot;&gt;sunjincheng121&lt;/a&gt;&#160;for reporting.&lt;/p&gt;

&lt;p&gt;This ticket should&#160;be&#160;a&#160;blocker,&#160;lead&#160;to &quot;TableEnvironment.from/scan(string&#160;path)&quot;&#160;cannot&#160;be&#160;used&#160;for&#160;all temporaryTable&#160;and CatalogTable&#160;(not&#160;DataStreamTable and ConnectorCatalogTable).&#160;Of&#160;course,&#160;it&#160;can&#160;be bypassed&#160;by&#160;&quot;TableEnvironment.sqlQuery(&quot;select&#160;*&#160;from&#160;t&quot;)&quot;,&#160;but&#160;&quot;from/scan&quot; are&#160;very&#160;important&#160;api&#160;of&#160;TableEnvironment&#160;and&#160;pure&#160;TableApi&#160;can&apos;t&#160;be&#160;used seriously.&lt;/p&gt;</comment>
                            <comment id="17027978" author="sunjincheng121" created="Sat, 1 Feb 2020 05:38:34 +0000"  >&lt;p&gt;Thanks for the double check. do you want help to fix it? I would like to assign this issue to you? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17027980" author="lzljs3620320" created="Sat, 1 Feb 2020 05:39:42 +0000"  >&lt;p&gt;Yes, please assign to me.&lt;/p&gt;</comment>
                            <comment id="17027994" author="lzljs3620320" created="Sat, 1 Feb 2020 06:36:56 +0000"  >&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ykt836&quot; class=&quot;user-hover&quot; rel=&quot;ykt836&quot;&gt;ykt836&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17027997" author="lzljs3620320" created="Sat, 1 Feb 2020 06:48:20 +0000"  >&lt;p&gt;The problem is that CatalogSourceTable.toRel&#160;wants to get the translator of the compute column. At present, CatalogSourceTable.toRe has two places to call:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The parser stage, which passes the correct compute column translator.&lt;/li&gt;
	&lt;li&gt;In the rule optimization stage, the correct compute column translator is not passed in the TableScanRule, so an error is reported.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;There are two solutions:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Don&apos;t use ToRelContext to transfer the translators of compute column. Use FlinkContext&#160;to transfer so that we can get the correct translators of compute columns at any stage.&lt;/li&gt;
	&lt;li&gt;In CatalogSourceTable.toRel, when there is a compute column and the compute column translator cannot be obtained, an error is reported, and other cases pass normally. The disadvantage of this is that it is currently unable to support compute columns on TableApi.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Considering:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;No plan to support compute column on TableApi.&lt;/li&gt;
	&lt;li&gt;Solution #1 changed too much&lt;/li&gt;
	&lt;li&gt;Solution #1 is also an intermediate version. In the next version, it is considered to separate the compute column&#160;translation and complete translation in the parser stage.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We consider using solution #2.&lt;/p&gt;</comment>
                            <comment id="17028005" author="lzljs3620320" created="Sat, 1 Feb 2020 08:11:41 +0000"  >&lt;p&gt;Another bug is &lt;tt&gt;CatalogSourceTable&lt;/tt&gt; need override &lt;tt&gt;explainSourceAsString&lt;/tt&gt;. Otherwise hep rule optimizer can not distinguish &lt;tt&gt;CatalogSourceTable&lt;/tt&gt; and &lt;tt&gt;TableSourceTable&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17028969" author="jark" created="Mon, 3 Feb 2020 13:59:52 +0000"  >&lt;p&gt;Fixed in 1.11.0: 183c8d143bc3bb5a31747417355690adaba3d226&lt;br/&gt;
1.10.0: 9a8f15cba18d431550a2ec587d69b948b4bedabd&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b2ag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>