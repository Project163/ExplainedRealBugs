<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5055] Security feature crashes JM for certain Hadoop versions even though using no Kerberos</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5055</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user reported &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; that the &lt;tt&gt;JobManager&lt;/tt&gt; does not start when using Flink with Hadoop-2.7.0-mapr-1607 and no security activated because of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;javax.security.auth.login.LoginException: Unable to obtain Principal Name &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; authentication
        at com.sun.security.auth.module.Krb5LoginModule.promptForName(Krb5LoginModule.java:841)
        at com.sun.security.auth.module.Krb5LoginModule.attemptAuthentication(Krb5LoginModule.java:704)
        at com.sun.security.auth.module.Krb5LoginModule.login(Krb5LoginModule.java:617)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems that this Hadoop version always tries to login via Kerberos even though the user did not activate it and, thus, should use &lt;tt&gt;AuthenticationMode.SIMPLE&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m not really familiar with the security feature, but my understanding is that it should not have any effect on Flink when not activated. I might be wrong here, but if not, then we should fix this problem for 1.2.0 because it prevents people from using Flink.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://apache-flink-mailing-list-archive.1008284.n3.nabble.com/Flink-using-Yarn-on-MapR-td14484.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-mailing-list-archive.1008284.n3.nabble.com/Flink-using-Yarn-on-MapR-td14484.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13020111">FLINK-5055</key>
            <summary>Security feature crashes JM for certain Hadoop versions even though using no Kerberos</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Nov 2016 13:51:01 +0000</created>
                <updated>Thu, 28 Feb 2019 11:31:36 +0000</updated>
                            <resolved>Fri, 25 Nov 2016 14:01:15 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15657184" author="vijikarthi" created="Fri, 11 Nov 2016 14:23:53 +0000"  >&lt;p&gt;Flink security context gets initialized during the application start phase. As part of the initialization, the UserGroupInformation (UGI) instance is bootstrapped using the Hadoop configuration files (read: HADOOP_CONF_DIR or YARN_CONF_DIR environment variable is set). If the hadoop configuration (core-site) enables security, then the UGI context uses JAAS module to load/login through Kerberos. It appears in this case, the Hadoop configurations that got loaded somehow has the security configurations enabled and UGI is trying to obtain the identity using keytab cache.&lt;/p&gt;</comment>
                            <comment id="15693362" author="mxm" created="Thu, 24 Nov 2016 14:04:15 +0000"  >&lt;p&gt;That seems like a logical explanation. However, Till and me were able to reproduce the problem with a standard Hadoop config (security turned off). I&apos;m looking into the cause of the problem now.&lt;/p&gt;</comment>
                            <comment id="15693816" author="githubbot" created="Thu, 24 Nov 2016 17:19:12 +0000"  >&lt;p&gt;GitHub user mxm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2864&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5055&quot; title=&quot;Security feature crashes JM for certain Hadoop versions even though using no Kerberos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5055&quot;&gt;&lt;del&gt;FLINK-5055&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;security&amp;#93;&lt;/span&gt; skip Hadoop UGI login if unsecured&lt;/p&gt;

&lt;p&gt;    The new Kerberos authentication code in Flink assumed that it&apos;s running against vanilla Hadoop. Original Hadoop&apos;s behavior is to skip a secure login if security is not configured. This is different for other distributions, e.g. the MapR Hadoop distribution of Hadoop.&lt;/p&gt;

&lt;p&gt;    Thus, we need to make sure we don&apos;t perform any login action if security is not configured.&lt;/p&gt;

&lt;p&gt;    This also performs minor code cleanup.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mxm/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5055&quot; title=&quot;Security feature crashes JM for certain Hadoop versions even though using no Kerberos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5055&quot;&gt;&lt;del&gt;FLINK-5055&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2864.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2864.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2864&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8193024a6451dd2594348ac0f001ed39b80f7302&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-24T16:12:39Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5055&quot; title=&quot;Security feature crashes JM for certain Hadoop versions even though using no Kerberos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5055&quot;&gt;&lt;del&gt;FLINK-5055&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;security&amp;#93;&lt;/span&gt; skip Hadoop UGI login if unsecured&lt;/p&gt;

&lt;p&gt;    The new Kerberos authentication code in Flink assumed that it&apos;s running&lt;br/&gt;
    against vanilla Hadoop. Original Hadoop&apos;s behavior is to skip a secure&lt;br/&gt;
    login if security is not configured. This is different for other&lt;br/&gt;
    distributions, e.g. the MapR Hadoop distribution of Hadoop.&lt;/p&gt;

&lt;p&gt;    Thus, we need to make sure we don&apos;t perform any login action if security&lt;br/&gt;
    is not configured.&lt;/p&gt;

&lt;p&gt;    This also performs minor code cleanup.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15695931" author="githubbot" created="Fri, 25 Nov 2016 14:00:43 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2864&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15695933" author="mxm" created="Fri, 25 Nov 2016 14:01:17 +0000"  >&lt;p&gt;Fixed via 1b2f3c06d2296d5e628b66a3c13126a546958d74.&lt;/p&gt;</comment>
                            <comment id="15757752" author="githubbot" created="Sat, 17 Dec 2016 22:50:41 +0000"  >&lt;p&gt;Github user EronWright commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2864&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm I think the root cause was incorrectly diagnosed here, and as a result this PR did the wrong thing.   It is incorrect to bypass the UGI login methods when in &apos;SIMPLE&apos; auth mode.&lt;/p&gt;

&lt;p&gt;    For example, Flink uses the `HADOOP_USER_NAME` envvar to pass the client&apos;s username from CLI to AppMaster to TaskManager; the HadoopSecurityContext must be used to apply it.    This PR wrecks havoc on scenarios like this.&lt;/p&gt;

&lt;p&gt;    I think the root cause in the MapR case is that MapR seems to rely on an &lt;span class=&quot;error&quot;&gt;&amp;#91;actual JAAS config file&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://community.mapr.com/thread/9240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://community.mapr.com/thread/9240&lt;/a&gt;), rather than on stock Hadoop&apos;s in-memory JAAS configuration.   The true solution may be to merge the user-supplied JAAS with our in-memory defaults, thus obtaining the `hadoop_simple` entry from `maps.login.conf`.&lt;/p&gt;

&lt;p&gt;    CC @tillrohrmann @vijikarthi &lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13029028">FLINK-5364</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13028848">FLINK-5361</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 48 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3681j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>