<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-36688] table.optimizer.reuse-source-enabled may cause disordered metadata columns when reading from Kafka.  </title>
                <link>https://issues.apache.org/jira/browse/FLINK-36688</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Metadata columns in Kafka need to maintain a fixed order: The metadata for format needs to be at the beginning, while the metadata for Kafka itself(partition/offset and so on) needs to be at the end. Kafka connector will add fields of format first, and then add fields of Kafka later.&lt;br/&gt;
However, reused Source did not maintain this order, witch may cause&#160;&lt;br/&gt;
ClassCastException.&lt;/p&gt;

&lt;p&gt;How to product:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create temporary table `message_channel_task_record`
(
origin_ts TIMESTAMP(3) METADATA FROM &lt;span class=&quot;code-quote&quot;&gt;&apos;value.ingestion-timestamp&apos;&lt;/span&gt; VIRTUAL
,`partition` INT METADATA VIRTUAL
,`offset` BIGINT METADATA VIRTUAL
,id BIGINT comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#33258;&#22686;ID&apos;&lt;/span&gt;
,PRIMARY KEY (`id`) NOT ENFORCED
)
with (
&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;
xxx
)
;


create temporary table `sink`
(
origin_ts TIMESTAMP(3)
,`partition` INT
,`offset` BIGINT
,id BIGINT
)
WITH (
&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;print&apos;&lt;/span&gt;
)
;


create temporary table `sr_sink`
(
id BIGINT comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#33258;&#22686;ID&apos;&lt;/span&gt;
)
WITH (
&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;print&apos;&lt;/span&gt;
)
;


-- EXPLAIN STATEMENT SET BEGIN


BEGIN STATEMENT SET;


INSERT INTO sink
SELECT
origin_ts
,`partition`
,`offset`
,id
FROM message_channel_task_record
;


INSERT INTO `sr_sink`
SELECT
id
FROM `message_channel_task_record`
;


END
;
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Explained plan:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 [558]:TableSourceScan(table=[[vvp, &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, message_channel_task_record, project=[id], metadata=[partition, value.ingestion-timestamp, offset]]], fields=[id, partition, origin_ts, offset])
:- [559]:Calc(select=[CAST(origin_ts AS TIMESTAMP(3)) AS origin_ts, CAST(partition AS INTEGER) AS partition, CAST(offset AS BIGINT) AS offset, id])
:  +- [560]:Sink(table=[vvp.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.sink], fields=[origin_ts, partition, offset, id])
   +- [562]:Sink(table=[vvp.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.sr_sink], fields=[id]) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected metadata column order is: value.ingestion-timestamp(format), partition, offset;&lt;br/&gt;
The actual metadata column order is: partition, value.ingestion-timestamp(format), offset.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13598350">FLINK-36688</key>
            <summary>table.optimizer.reuse-source-enabled may cause disordered metadata columns when reading from Kafka.  </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kunni">Yanquan Lv</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 11 Nov 2024 09:05:27 +0000</created>
                <updated>Wed, 4 Dec 2024 22:04:35 +0000</updated>
                            <resolved>Wed, 4 Dec 2024 22:04:26 +0000</resolved>
                                    <version>1.20.0</version>
                    <version>1.19.1</version>
                    <version>2.0-preview</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17899969" author="xuyangzhong" created="Thu, 21 Nov 2024 09:07:38 +0000"  >&lt;p&gt;You&apos;re right. There is a bug in ScanReuser. I&apos;ll fix it.&lt;/p&gt;</comment>
                            <comment id="17903132" author="sergey nuyanzin" created="Wed, 4 Dec 2024 22:04:26 +0000"  >&lt;p&gt;Merged as &lt;a href=&quot;https://github.com/apache/flink/commit/5c87afeceffc52d2e0a24cf547bae6eda4075cfe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5c87afeceffc52d2e0a24cf547bae6eda4075cfe&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1shio:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>