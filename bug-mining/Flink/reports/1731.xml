<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6685] SafetyNetCloseableRegistry is closed prematurely in Task::triggerCheckpointBarrier</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6685</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;SafetyNetCloseableRegistry&lt;/tt&gt; is closed to early in &lt;tt&gt;triggerCheckpointBarrier(...)&lt;/tt&gt;. Right now, it seems like the code assumes that &lt;tt&gt;statefulTask.triggerCheckpoint(...)&lt;/tt&gt; is blocking - which it is not. Like this, the registry can be closed while the checkpoint is still running.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13074202">FLINK-6685</key>
            <summary>SafetyNetCloseableRegistry is closed prematurely in Task::triggerCheckpointBarrier</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 May 2017 13:34:17 +0000</created>
                <updated>Tue, 13 Jun 2017 09:48:25 +0000</updated>
                            <resolved>Tue, 13 Jun 2017 09:47:51 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16021192" author="srichter" created="Tue, 23 May 2017 13:36:26 +0000"  >&lt;p&gt;For the release, we can fix this by reusing the registry from the task scope and not closing it on a per-checkpoint scope.&lt;/p&gt;

&lt;p&gt;In the future, we should fix this properly by implementing the changes suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6684&quot; title=&quot;Remove AsyncCheckpointRunnable from StreamTask&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6684&quot;&gt;&lt;del&gt;FLINK-6684&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16022842" author="srichter" created="Wed, 24 May 2017 12:55:48 +0000"  >&lt;p&gt;fixed in 7639d49e03&lt;/p&gt;</comment>
                            <comment id="16023140" author="gyfora" created="Wed, 24 May 2017 16:03:14 +0000"  >&lt;p&gt;Thanks Stefan, awesome job! I can confirm that this solves our savepoint issues &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16046523" author="srichter" created="Mon, 12 Jun 2017 12:45:47 +0000"  >&lt;p&gt;Fix was incomplete.&lt;/p&gt;</comment>
                            <comment id="16046552" author="githubbot" created="Mon, 12 Jun 2017 13:25:11 +0000"  >&lt;p&gt;GitHub user StefanRRichter opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6685&quot; title=&quot;SafetyNetCloseableRegistry is closed prematurely in Task::triggerCheckpointBarrier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6685&quot;&gt;&lt;del&gt;FLINK-6685&lt;/del&gt;&lt;/a&gt; Adjust scopes of SafetyNetCloseableRegistry usage&lt;/p&gt;

&lt;p&gt;    This PR addresses remaining issues with the `SafetyNetCloseableregistry`:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;reset the registry to `null` after usage in `Task`.&lt;/li&gt;
	&lt;li&gt;use the registry in the scope of the async checkpointing thread.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StefanRRichter/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StefanRRichter/flink&lt;/a&gt; adjustSafetyNetScope&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4108.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4108.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4108&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e2031db5f9171d692a41f04d1f3d1ebf592ef6b1&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-06-12T09:48:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6685&quot; title=&quot;SafetyNetCloseableRegistry is closed prematurely in Task::triggerCheckpointBarrier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6685&quot;&gt;&lt;del&gt;FLINK-6685&lt;/del&gt;&lt;/a&gt; Adjust scopes of SafetyNetCloseableRegistry usage&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16047659" author="githubbot" created="Tue, 13 Jun 2017 09:46:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4108&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16047660" author="till.rohrmann" created="Tue, 13 Jun 2017 09:47:51 +0000"  >&lt;p&gt;1.4.0: 68ac96e16c09d7aee64d3dc0e5629cc308fb087f&lt;br/&gt;
1.3.1: 8de51f953421a30073d2ff57bf37daa81bdaa991&lt;/p&gt;</comment>
                            <comment id="16047661" author="githubbot" created="Tue, 13 Jun 2017 09:48:25 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann thanks for the review and the merge!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fcs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>