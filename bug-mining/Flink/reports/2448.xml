<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9416] Make job submission retriable operation in case of a ongoing leader election</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9416</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When starting a session cluster, it can happen that the job submission fails if the REST server endpoint has already gained leadership but if the leadership election for the &lt;tt&gt;Dispatcher&lt;/tt&gt; is still ongoing. In such a case, we receive a error response saying that the leader election is still ongoing and fail the job submission. I think it would be nicer to also make the submission step a retriable operation in order to avoid this race condition.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13161317">FLINK-9416</key>
            <summary>Make job submission retriable operation in case of a ongoing leader election</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 May 2018 07:19:39 +0000</created>
                <updated>Thu, 24 May 2018 14:53:44 +0000</updated>
                            <resolved>Thu, 24 May 2018 14:53:44 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Command Line Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16488629" author="githubbot" created="Thu, 24 May 2018 08:19:54 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9416&quot; title=&quot;Make job submission retriable operation in case of a ongoing leader election&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9416&quot;&gt;&lt;del&gt;FLINK-9416&lt;/del&gt;&lt;/a&gt; Make all RestClusterClient calls retriable&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This commit changes the RestClusterClient calls such that they are all retriable wrt&lt;br/&gt;
    to connection errors and if the service is currently unavailable (return code 503).&lt;/p&gt;

&lt;p&gt;    Moreover, it changes the retry behaviour for polling the JobResult such that it fails&lt;br/&gt;
    now if the cluster returns a NOT_FOUND code.&lt;/p&gt;

&lt;p&gt;    This PR is based on #6068.&lt;/p&gt;

&lt;p&gt;    cc @GJL &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added `RestClusterClientTest#testRetriableSendOperationIfConnectionErrorOrServiceUnavailable` and `testSendIsNotRetriableIfHttpNotFound`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; hardenRestClient&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6069&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4b4d82cc5a3bb9694fd19a37c21345cbe7928962&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-05-23T16:50:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9427&quot; title=&quot;Cannot download from BlobServer, because the server address is unknown.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9427&quot;&gt;&lt;del&gt;FLINK-9427&lt;/del&gt;&lt;/a&gt; Fix registration and request slot race condition in TaskExecutor&lt;/p&gt;

&lt;p&gt;    This commit fixes a race condition between the TaskExecutor and the ResourceManager. Before,&lt;br/&gt;
    it could happen that the ResourceManager sends requestSlots message before the TaskExecutor&lt;br/&gt;
    registration was completed. Due to this, the TaskExecutor did not have all information it needed&lt;br/&gt;
    to accept task submissions.&lt;/p&gt;

&lt;p&gt;    The problem was that the TaskExecutor sent the SlotReport at registration time. Due to this, t&lt;br/&gt;
    he SlotManager could already assign these slots to pending slot requests. With this commit, the&lt;br/&gt;
    registration protocol changes such that the TaskExecutor first registers at the ResourceManager&lt;br/&gt;
    and only after completing this step, it will announce the available slots to the SlotManager.&lt;/p&gt;

&lt;p&gt;commit 4d034edca41294e250c49807a3beecb2b419824d&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-05-23T21:48:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9421&quot; title=&quot;RunningJobsRegistry entries are not cleaned up after job termination&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9421&quot;&gt;&lt;del&gt;FLINK-9421&lt;/del&gt;&lt;/a&gt; Remove job from RunningJobsRegistry when it reaches a terminal state&lt;/p&gt;

&lt;p&gt;    This commit lets the Dispatcher remove the RunningJobsRegistry entry for a completed job&lt;br/&gt;
    when it is removed from the Dispatcher.&lt;/p&gt;

&lt;p&gt;commit 61817beea5dfa1fdf20dcd6266b5899769307f6b&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-05-24T08:01:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9416&quot; title=&quot;Make job submission retriable operation in case of a ongoing leader election&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9416&quot;&gt;&lt;del&gt;FLINK-9416&lt;/del&gt;&lt;/a&gt; Make all RestClusterClient calls retriable&lt;/p&gt;

&lt;p&gt;    This commit changes the RestClusterClient calls such that they are all retriable wrt&lt;br/&gt;
    to connection errors and if the service is currently unavailable (return code 503).&lt;/p&gt;

&lt;p&gt;    Moreover, it changes the retry behaviour for polling the JobResult such that it fails&lt;br/&gt;
    now if the cluster returns a NOT_FOUND code.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16489106" author="githubbot" created="Thu, 24 May 2018 14:30:21 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069#discussion_r190605113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069#discussion_r190605113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/rest/RestClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -274,11 +275,17 @@ public JobSubmissionResult submitJob(JobGraph jobGraph, ClassLoader classLoader)&lt;br/&gt;
     		final JobMessageParameters  params = new JobMessageParameters();&lt;br/&gt;
     		params.jobPathParameter.resolve(jobId);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CompletableFuture&amp;lt;JobDetailsInfo&amp;gt; responseFuture = sendRequest(detailsHeaders, params);&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobDetailsInfo&amp;gt; responseFuture = sendRequest(&lt;br/&gt;
    +			detailsHeaders,&lt;br/&gt;
    +			params);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return responseFuture.thenApply(JobDetailsInfo::getJobStatus);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private Predicate&amp;lt;Throwable&amp;gt; isConnectionProblemOrServiceUnavailable() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    nit: can be `static` and defined closer to `isConnectionProblemException` and `isServiceUnavailable`&lt;/p&gt;</comment>
                            <comment id="16489107" author="githubbot" created="Thu, 24 May 2018 14:30:22 +0000"  >&lt;p&gt;Github user GJL commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069#discussion_r190605670&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069#discussion_r190605670&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/rest/RestClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -314,7 +319,8 @@ public JobSubmissionResult submitJob(JobGraph jobGraph, ClassLoader classLoader)&lt;/p&gt;

&lt;p&gt;     		log.info(&quot;Requesting blob server port.&quot;);&lt;br/&gt;
     		CompletableFuture&amp;lt;BlobServerPortResponseBody&amp;gt; portFuture = sendRequest(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BlobServerPortHeaders.getInstance());&lt;br/&gt;
    +			BlobServerPortHeaders.getInstance(),&lt;br/&gt;
    +			EmptyMessageParameters.getInstance());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This is not needed. There should be an overload of `sendRequest` that does it.&lt;/p&gt;</comment>
                            <comment id="16489110" author="githubbot" created="Thu, 24 May 2018 14:34:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069#discussion_r190609681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069#discussion_r190609681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/rest/RestClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -274,11 +275,17 @@ public JobSubmissionResult submitJob(JobGraph jobGraph, ClassLoader classLoader)&lt;br/&gt;
     		final JobMessageParameters  params = new JobMessageParameters();&lt;br/&gt;
     		params.jobPathParameter.resolve(jobId);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CompletableFuture&amp;lt;JobDetailsInfo&amp;gt; responseFuture = sendRequest(detailsHeaders, params);&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobDetailsInfo&amp;gt; responseFuture = sendRequest(&lt;br/&gt;
    +			detailsHeaders,&lt;br/&gt;
    +			params);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return responseFuture.thenApply(JobDetailsInfo::getJobStatus);&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	private Predicate&amp;lt;Throwable&amp;gt; isConnectionProblemOrServiceUnavailable() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Good idea. Will change it.&lt;/p&gt;</comment>
                            <comment id="16489111" author="githubbot" created="Thu, 24 May 2018 14:34:24 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069#discussion_r190609755&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069#discussion_r190609755&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/rest/RestClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -314,7 +319,8 @@ public JobSubmissionResult submitJob(JobGraph jobGraph, ClassLoader classLoader)&lt;/p&gt;

&lt;p&gt;     		log.info(&quot;Requesting blob server port.&quot;);&lt;br/&gt;
     		CompletableFuture&amp;lt;BlobServerPortResponseBody&amp;gt; portFuture = sendRequest(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BlobServerPortHeaders.getInstance());&lt;br/&gt;
    +			BlobServerPortHeaders.getInstance(),&lt;br/&gt;
    +			EmptyMessageParameters.getInstance());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good point. Will change it.&lt;/p&gt;</comment>
                            <comment id="16489116" author="githubbot" created="Thu, 24 May 2018 14:37:16 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @GJL. I will address your comments and then merge this PR.&lt;/p&gt;</comment>
                            <comment id="16489141" author="githubbot" created="Thu, 24 May 2018 14:51:42 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6069&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16489149" author="till.rohrmann" created="Thu, 24 May 2018 14:53:44 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master: 88987ebb93b4d56cc5a2efd7ef47dedab9b9d3d9&lt;br/&gt;
1.5.0: 44467239ab264039b37fe5e608531ae1d60cb8a1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3u1kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>