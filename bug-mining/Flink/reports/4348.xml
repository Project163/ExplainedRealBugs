<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10213] Task managers cache a negative DNS lookup of the blob server indefinitely</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10213</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When the task manager establishes a connection with the resource manager, it gets the hostname and port of the blob server and uses that to create an instance of an &lt;tt&gt;InetSocketAddress&lt;/tt&gt;. Per the documentation of the constructor:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;An attempt will be made to resolve the hostname into an InetAddress. If that attempt fails, the address will be flagged as &lt;em&gt;unresolved&lt;/em&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Flink never checks to see if the address was unresolved. Later when executing a task that needs to download from the blob server, it will use that same &lt;tt&gt;InetSocketAddress&lt;/tt&gt; instance to attempt to connect a &lt;tt&gt;Socket&lt;/tt&gt;. This will result in an exception similar to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: Failed to fetch BLOB 97799b827ef073e04178a99f0f40b00e/p-6d8ec2ad31337110819c7c3641fdb18d3793a7fb-72bf00066308f4b4d2a9c5aea593b41f from jobmanager:6124 and store it under /tmp/blobStore-d135961a-03cb-4542-af6d-cf378ff83c12/incoming/temp-00018669
	at org.apache.flink.runtime.blob.BlobClient.downloadFromBlobServer(BlobClient.java:191) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.blob.AbstractBlobCache.getFileInternal(AbstractBlobCache.java:181) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.blob.PermanentBlobCache.getFile(PermanentBlobCache.java:206) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.execution.librarycache.BlobLibraryCacheManager.registerTask(BlobLibraryCacheManager.java:120) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.taskmanager.Task.createUserCodeClassloader(Task.java:863) [flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:579) [flink-dist_2.11-1.5.0.jar:1.5.0]
	at java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]
Caused by: java.io.IOException: Could not connect to BlobServer at address flink-jobmanager:6124
	at org.apache.flink.runtime.blob.BlobClient.&amp;lt;init&amp;gt;(BlobClient.java:124) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.blob.BlobClient.downloadFromBlobServer(BlobClient.java:165) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	... 6 more
Caused by: java.net.UnknownHostException: jobmanager
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:184) ~[?:1.8.0_171]
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392) ~[?:1.8.0_171]
	at java.net.Socket.connect(Socket.java:589) ~[?:1.8.0_171]
	at java.net.Socket.connect(Socket.java:538) ~[?:1.8.0_171]
	at org.apache.flink.runtime.blob.BlobClient.&amp;lt;init&amp;gt;(BlobClient.java:118) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	at org.apache.flink.runtime.blob.BlobClient.downloadFromBlobServer(BlobClient.java:165) ~[flink-dist_2.11-1.5.0.jar:1.5.0]
	... 6 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since the &lt;tt&gt;InetSocketAddress&lt;/tt&gt; is re-used, you&apos;ll have repeated failures of any tasks that are executed on that task manager and the only current workaround is to manually restart the task manager.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13181078">FLINK-10213</key>
            <summary>Task managers cache a negative DNS lookup of the blob server indefinitely</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fwiffo">Joey Echeverria</assignee>
                                    <reporter username="fwiffo">Joey Echeverria</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 24 Aug 2018 22:49:36 +0000</created>
                <updated>Sat, 20 Jun 2020 14:21:27 +0000</updated>
                            <resolved>Sat, 20 Jun 2020 13:08:25 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16592586" author="stephanewen" created="Sat, 25 Aug 2018 13:39:49 +0000"  >&lt;p&gt;Good point! What would be the best way to fix this?&lt;br/&gt;
Simply maintain the hostname:port string an re-resolve the InetSocketAddress each time?&lt;/p&gt;</comment>
                            <comment id="16592613" author="fwiffo" created="Sat, 25 Aug 2018 15:04:35 +0000"  >&lt;p&gt;Yes I think that&#8217;d be the easiest fix. Java and the OS will already cache the resolution based on the TTL of the DNS record and any settings for caching negative responses, so there&#8217;s no reason for Flink to effectively add its own name cache. &lt;/p&gt;</comment>
                            <comment id="16652566" author="githubbot" created="Tue, 16 Oct 2018 22:33:41 +0000"  >&lt;p&gt;joey opened a new pull request #6862: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10213&quot; title=&quot;Task managers cache a negative DNS lookup of the blob server indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10213&quot;&gt;&lt;del&gt;FLINK-10213&lt;/del&gt;&lt;/a&gt; Task managers cache a negative DNS lookup of the blob server indefinitely&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6862&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This pull request fixes a bug where a negative DNS resolution for the blob server address could be cached forever.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;Updated BlobClient to create the socket using the hostname and port rather than the InetSocketAddress.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Added a test case to BlobClientTest for unresolved InetSocketAddresses. The test fails without the implemented fix and passes with implemented fix.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704809" author="githubbot" created="Fri, 30 Nov 2018 14:32:12 +0000"  >&lt;p&gt;dawidwys commented on a change in pull request #6862: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10213&quot; title=&quot;Task managers cache a negative DNS lookup of the blob server indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10213&quot;&gt;&lt;del&gt;FLINK-10213&lt;/del&gt;&lt;/a&gt; Task managers cache a negative DNS lookup of the blob server indefinitely&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6862#discussion_r237876381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6862#discussion_r237876381&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/blob/BlobClientTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -487,4 +487,11 @@ private static void uploadJarFile(&lt;br/&gt;
 			validateGetAndClose(blobClient.getInternal(jobId, blobKeys.get(0)), testFile);&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testUnresolvedInetSocketAddress() throws Exception {&lt;br/&gt;
+		try (BlobClient client = new BlobClient(&lt;br/&gt;
+			InetSocketAddress.createUnresolved(&quot;localhost&quot;, getBlobServer().getPort()), getBlobClientConfig())) &lt;/p&gt;
{
+		}

&lt;p&gt; Review comment:&lt;br/&gt;
   Could you extend this test, so that it checks that it actually connects to the `BlobServer`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704810" author="githubbot" created="Fri, 30 Nov 2018 14:32:12 +0000"  >&lt;p&gt;dawidwys commented on a change in pull request #6862: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10213&quot; title=&quot;Task managers cache a negative DNS lookup of the blob server indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10213&quot;&gt;&lt;del&gt;FLINK-10213&lt;/del&gt;&lt;/a&gt; Task managers cache a negative DNS lookup of the blob server indefinitely&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6862#discussion_r237878535&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6862#discussion_r237878535&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobClient.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -87,12 +87,13 @@ public BlobClient(InetSocketAddress serverAddress, Configuration clientConfig) t&lt;br/&gt;
 				LOG.info(&quot;Using ssl connection to the blob server&quot;);&lt;/p&gt;

&lt;p&gt; 				socket = SSLUtils.createSSLClientSocketFactory(clientConfig).createSocket(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;serverAddress.getAddress(),&lt;br/&gt;
+					serverAddress.getHostName(),&lt;br/&gt;
 					serverAddress.getPort());&lt;br/&gt;
 			}&lt;br/&gt;
 			else {&lt;/li&gt;
	&lt;li&gt;socket = new Socket();&lt;/li&gt;
	&lt;li&gt;socket.connect(serverAddress);&lt;br/&gt;
+				// Establish the socket using the hostname and port. This avoids a potential issue where the&lt;br/&gt;
+				// InetSocketAddress can cache a failure in hostname resolution forever.&lt;br/&gt;
+				socket = new Socket(serverAddress.getHostName(), serverAddress.getPort());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   How about doing the lookup only if the `InetSocketAddress` was not resolved?&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   socket = new Socket();&lt;br/&gt;
   if (serverAddress.isUnresolved()) &lt;/p&gt;
{
   	socket.connect(new InetSocketAddress(serverAddress.getHostName(), serverAddress.getPort()));
   }
&lt;p&gt; else &lt;/p&gt;
{
   	socket.connect(serverAddress);
   }
&lt;p&gt;   ```&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16717406" author="githubbot" created="Tue, 11 Dec 2018 15:42:46 +0000"  >&lt;p&gt;joey commented on a change in pull request #6862: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10213&quot; title=&quot;Task managers cache a negative DNS lookup of the blob server indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10213&quot;&gt;&lt;del&gt;FLINK-10213&lt;/del&gt;&lt;/a&gt; Task managers cache a negative DNS lookup of the blob server indefinitely&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6862#discussion_r240664268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6862#discussion_r240664268&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/blob/BlobClientTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -487,4 +487,11 @@ private static void uploadJarFile(&lt;br/&gt;
 			validateGetAndClose(blobClient.getInternal(jobId, blobKeys.get(0)), testFile);&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testUnresolvedInetSocketAddress() throws Exception {&lt;br/&gt;
+		try (BlobClient client = new BlobClient(&lt;br/&gt;
+			InetSocketAddress.createUnresolved(&quot;localhost&quot;, getBlobServer().getPort()), getBlobClientConfig())) &lt;/p&gt;
{
+		}

&lt;p&gt; Review comment:&lt;br/&gt;
   I&apos;m adding a new method to BlobClient to check if the socket is connected and then adding an assert here.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16717414" author="githubbot" created="Tue, 11 Dec 2018 15:48:07 +0000"  >&lt;p&gt;joey commented on a change in pull request #6862: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10213&quot; title=&quot;Task managers cache a negative DNS lookup of the blob server indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10213&quot;&gt;&lt;del&gt;FLINK-10213&lt;/del&gt;&lt;/a&gt; Task managers cache a negative DNS lookup of the blob server indefinitely&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6862#discussion_r240666825&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6862#discussion_r240666825&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobClient.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -87,12 +87,13 @@ public BlobClient(InetSocketAddress serverAddress, Configuration clientConfig) t&lt;br/&gt;
 				LOG.info(&quot;Using ssl connection to the blob server&quot;);&lt;/p&gt;

&lt;p&gt; 				socket = SSLUtils.createSSLClientSocketFactory(clientConfig).createSocket(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;serverAddress.getAddress(),&lt;br/&gt;
+					serverAddress.getHostName(),&lt;br/&gt;
 					serverAddress.getPort());&lt;br/&gt;
 			}&lt;br/&gt;
 			else {&lt;/li&gt;
	&lt;li&gt;socket = new Socket();&lt;/li&gt;
	&lt;li&gt;socket.connect(serverAddress);&lt;br/&gt;
+				// Establish the socket using the hostname and port. This avoids a potential issue where the&lt;br/&gt;
+				// InetSocketAddress can cache a failure in hostname resolution forever.&lt;br/&gt;
+				socket = new Socket(serverAddress.getHostName(), serverAddress.getPort());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   We can do that, but I&apos;m not sure it&apos;s the best idea. Since the resolution in `InetSocketAddress` only happens when the object is instantiated, you could cache an old name resolution. The most likely reason for this to happen would be a deployment environment such as Kubernetes. If the JobManger pod is restarted, then a new pod will take over and will get assigned a new IP address. Kubernetes will automatically update the DNS entry using KubeDNS for the service name. I think that means you could have a situation where the `InetSocketAdress` says it&apos;s resolved, but it cached an old resolution. The safest thing is to force the DNS resolution when we make the connection. Both Java and the kernel will already cache the DNS entry based on the TTL in the DSN record, so I don&apos;t think we gain much by adding an additional caching layer in the `InetSocketAddress` itself.&lt;/p&gt;

&lt;p&gt;   Let me know if you agree or if we should still consider the change.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16717422" author="githubbot" created="Tue, 11 Dec 2018 15:51:18 +0000"  >&lt;p&gt;joey commented on issue #6862: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10213&quot; title=&quot;Task managers cache a negative DNS lookup of the blob server indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10213&quot;&gt;&lt;del&gt;FLINK-10213&lt;/del&gt;&lt;/a&gt; Task managers cache a negative DNS lookup of the blob server indefinitely&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6862#issuecomment-446251923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6862#issuecomment-446251923&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the feedback @dawidwys! I updated the test to confirm that the client is connected. See my comment for your other suggestion and let me know what you recommend.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16720037" author="dawidwys" created="Thu, 13 Dec 2018 10:51:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fwiffo&quot; class=&quot;user-hover&quot; rel=&quot;fwiffo&quot;&gt;fwiffo&lt;/a&gt;&lt;br/&gt;
I would like to follow up on discussion from PR:&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;We can do that, but I&apos;m not sure it&apos;s the best idea. Since the resolution in InetSocketAddress only happens when the object is instantiated, you could cache an old name resolution. The most likely reason for this to happen would be a deployment environment such as Kubernetes. If the JobManger pod is restarted, then a new pod will take over and will get assigned a new IP address. Kubernetes will automatically update the DNS entry using KubeDNS for the service name. I think that means you could have a situation where the InetSocketAdress says it&apos;s resolved, but it cached an old resolution. The safest thing is to force the DNS resolution when we make the connection. Both Java and the kernel will already cache the DNS entry based on the TTL in the DSN record, so I don&apos;t think we gain much by adding an additional caching layer in the InetSocketAddress itself.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;I think we should differentiate two situation:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;there was a temporary dns failure while resolving address of BlobServer&lt;/li&gt;
	&lt;li&gt;JobMaster(which is collocated with BlobServer) failed and was restored with a new IP&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In the second case the JobMaster should not transparently take over. As the new JobMaster should not have any Task executors registered, it shouldn&apos;t send heartbeats, which should result in task executors disassociation.&lt;br/&gt;
Once the TaskExecutor registers at the new JobMaster it will replace the InetSocketAddress with a new instance pointing to the new service. So eventually it all should come back to normal state. If it is not the case could you share your task executor logs with us?&lt;/p&gt;

&lt;p&gt; So to sum up I think we can add check to guard against situation when the address was not resolved at all (some temporary DNS problems). However we should not account here for case when the ip of the host changed.&lt;/p&gt;
</comment>
                            <comment id="16754729" author="dawidwys" created="Tue, 29 Jan 2019 08:31:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fwiffo&quot; class=&quot;user-hover&quot; rel=&quot;fwiffo&quot;&gt;fwiffo&lt;/a&gt;,&lt;br/&gt;
Does it make sense for you what I wrote in my previous comment?&lt;/p&gt;</comment>
                            <comment id="16766600" author="fwiffo" created="Wed, 13 Feb 2019 00:18:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Sorry for the delay responding. What you wrote makes sense, though I&apos;m still a little worried about adding an extra layer of caching of the DNS resolution in the InetSocketAddress. When the bug first hit the behavior was that the affected TaskManager never recovered. So I&apos;m worried we could run into another situation where the InetSocketAddress is resolved, but is for some reason stale. The main benefit I can see to not re-doing the look-up each time is to avoid an extra DNS lookup. However, both the JVM and the kernel maintains a DNS cache based on the TTL of the DNS entry. I trust those caches because they respect the TTL of the entry unlike the InetSocketAddress which caches indefinitely.&lt;/p&gt;

&lt;p&gt;If you feel strongly that we check the isResolved() status first, I&apos;ll disagree and commit to that solution. Let me know how you want me to proceed.&lt;/p&gt;</comment>
                            <comment id="16768104" author="stephanewen" created="Thu, 14 Feb 2019 11:22:22 +0000"  >&lt;p&gt;I agree with @Joey Echeverria here. Any caching of resolved results in Flink is a bit tricky.&lt;/p&gt;

&lt;p&gt;Simply always ging again with the host name would be safe. There is still caching done in the OS, so there not always DNS lookups, but these caches are invalidated properly.&lt;/p&gt;

&lt;p&gt;The solution of simply going with the hostname seems simple and should work. Unless we see a serious performance/overhead issue here, I would favor the simplicity of the approach.&lt;/p&gt;

&lt;p&gt;One thing that would be great is to have a test guarding this behavior. Otherwise I can see someone in the future wanting to optimize the code and thereby changing the behavior again.&lt;/p&gt;</comment>
                            <comment id="16775098" author="dawidwys" created="Fri, 22 Feb 2019 12:49:24 +0000"  >&lt;p&gt;I agree it would be better not to cache those results in &lt;tt&gt;InetSocketAddress&lt;/tt&gt; and I am absolutely ok with changing &lt;tt&gt;BlobClient&lt;/tt&gt; class so that it accepts (hostname, port).&lt;/p&gt;

&lt;p&gt;I disagree though this was the reason for TaskManager never recovering, which this ticket/bug is about. That&apos;s why I didn&apos;t want to just merge this change without fully understanding the root cause for such behavior.&lt;/p&gt;</comment>
                            <comment id="17141072" author="till.rohrmann" created="Sat, 20 Jun 2020 13:08:25 +0000"  >&lt;p&gt;Fixed via a5527e3b2ff4abea2ff8fa05cb755561549be06a&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xesn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>