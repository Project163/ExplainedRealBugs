<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15167] SQL CLI library option doesn&apos;t work for Hive connector</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15167</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Launch a standalone cluster. Put all Hive connector dependency jars in a folder and start sql cli like: &lt;tt&gt;sql-client.sh embedded -l &amp;lt;folder&amp;gt;&lt;/tt&gt;. Hit the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	at org.apache.flink.table.catalog.hive.HiveCatalog.open(HiveCatalog.java:186)
	at org.apache.flink.table.catalog.CatalogManager.registerCatalog(CatalogManager.java:102)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.registerCatalog(TableEnvironmentImpl.java:233)
	at java.util.LinkedHashMap.forEach(LinkedHashMap.java:684)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.initializeCatalogs(ExecutionContext.java:519)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.initializeTableEnvironment(ExecutionContext.java:463)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.&amp;lt;init&amp;gt;(ExecutionContext.java:156)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.&amp;lt;init&amp;gt;(ExecutionContext.java:115)
	at org.apache.flink.table.client.gateway.local.ExecutionContext$Builder.build(ExecutionContext.java:724)
	... 3 more
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.flink.table.catalog.hive.client.HiveShimV230.getHiveMetastoreClient(HiveShimV230.java:55)
	... 15 more
Caused by: MetaException(message:org.apache.hadoop.hive.metastore.HiveMetaStoreClient class not found)
	at org.apache.hadoop.hive.metastore.MetaStoreUtils.getClass(MetaStoreUtils.java:1676)
	at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:131)
	at org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:89)
	... 20 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13273533">FLINK-15167</key>
            <summary>SQL CLI library option doesn&apos;t work for Hive connector</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lirui">Rui Li</assignee>
                                    <reporter username="lirui">Rui Li</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 10 Dec 2019 06:46:18 +0000</created>
                <updated>Fri, 13 Dec 2019 09:21:29 +0000</updated>
                            <resolved>Fri, 13 Dec 2019 09:21:29 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Connectors / Hive</component>
                    <component>Table SQL / Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16992350" author="lirui" created="Tue, 10 Dec 2019 09:23:23 +0000"  >&lt;p&gt;Identified the following issues:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Both creating and registering catalogs should be done with user class loader as the context loader.&lt;/li&gt;
	&lt;li&gt;Need to set the dependent jars via &lt;tt&gt;PipelineOptions.JARS&lt;/tt&gt; in the configuration, so that our job graph carries these dependencies.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;After fixing the above issues, reading Hive tables works. But when I try to write to Hive tables, got the following problem:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NoClassDefFoundError: org/apache/hadoop/fs/FileSystem
	at org.apache.flink.runtime.fs.hdfs.HadoopFileSystem.&amp;lt;init&amp;gt;(HadoopFileSystem.java:54)
	at org.apache.flink.connectors.hive.HadoopFileSystemFactory.create(HadoopFileSystemFactory.java:46)
	at org.apache.flink.table.filesystem.PartitionTempFileManager.&amp;lt;init&amp;gt;(PartitionTempFileManager.java:73)
	at org.apache.flink.table.filesystem.FileSystemOutputFormat.open(FileSystemOutputFormat.java:104)
	at org.apache.flink.streaming.api.functions.sink.OutputFormatSinkFunction.open(OutputFormatSinkFunction.java:65)
	at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:36)
	at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:102)
	at org.apache.flink.streaming.api.operators.StreamSink.open(StreamSink.java:48)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.initializeStateAndOpen(StreamTask.java:986)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$beforeInvoke$0(StreamTask.java:453)
	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$SynchronizedStreamTaskActionExecutor.runThrowing(StreamTaskActionExecutor.java:94)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.beforeInvoke(StreamTask.java:448)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:460)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:702)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:527)
	at java.lang.Thread.run(Thread.java:748)
Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.fs.FileSystem
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is because &lt;tt&gt;HadoopFileSystem&lt;/tt&gt; is loaded by parent loader (in flink-dist jar), while &lt;tt&gt;org.apache.hadoop.fs.FileSystem&lt;/tt&gt; (a field of &lt;tt&gt;HadoopFileSystem&lt;/tt&gt;) needs to be loaded by child loader.&lt;br/&gt;
I think one option is to let Hive connector implement its own &lt;tt&gt;HadoopFileSystem&lt;/tt&gt;. Alternatively, we can remove &lt;tt&gt;HadoopFileSystem&lt;/tt&gt; from &lt;tt&gt;flink-dist&lt;/tt&gt;. Since &lt;tt&gt;flink-dist&lt;/tt&gt; doesn&apos;t contain &lt;tt&gt;org.apache.hadoop.fs.FileSystem&lt;/tt&gt;, I&apos;m not sure what&apos;s the point to pack &lt;tt&gt;HadoopFileSystem&lt;/tt&gt; in the jar.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ykt836&quot; class=&quot;user-hover&quot; rel=&quot;ykt836&quot;&gt;ykt836&lt;/a&gt; What do you think?&lt;/p&gt;</comment>
                            <comment id="16992372" author="lzljs3620320" created="Tue, 10 Dec 2019 09:44:22 +0000"  >&lt;p&gt;For the third problem, I think there is a simple way to fix:&lt;/p&gt;

&lt;p&gt;Add `flink-hadoop-fs` dependent to hive module. In this way, will use the child ClassLoader always.&lt;/p&gt;</comment>
                            <comment id="16992454" author="lirui" created="Tue, 10 Dec 2019 11:18:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; Unfortunately, that wouldn&apos;t work w/o removing &lt;tt&gt;HadoopFileSystem&lt;/tt&gt; from &lt;tt&gt;flink-dist&lt;/tt&gt;, because classes with &quot;org.apache.flink&quot; prefix will always be loaded by parent class loader &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16993162" author="lzljs3620320" created="Wed, 11 Dec 2019 03:28:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;, For the third problem,&#160;since it is an independent ticket, I created&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15185&quot; title=&quot;Hive sink can not run in standalone mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15185&quot;&gt;&lt;del&gt;FLINK-15185&lt;/del&gt;&lt;/a&gt;&#160;to summarize.&lt;/p&gt;</comment>
                            <comment id="16993175" author="lirui" created="Wed, 11 Dec 2019 04:01:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; Thanks for verifying the issue. Then this PR is ready for review.&lt;/p&gt;</comment>
                            <comment id="16995494" author="ykt836" created="Fri, 13 Dec 2019 09:21:29 +0000"  >&lt;p&gt;master:&#160;cd4c3ddf&lt;/p&gt;

&lt;p&gt;1.10.0:&#160;5a43907e&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09i9c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>