<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:17:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31628] ArrayIndexOutOfBoundsException in watermark processing</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31628</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;After upgrading a job from Flink 1.16.1 to 1.17.0, my task managers throw the following exception:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ArrayIndexOutOfBoundsException: Index -2147483648 out of bounds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; length 5
	at org.apache.flink.streaming.runtime.watermarkstatus.HeapPriorityQueue.removeInternal(HeapPriorityQueue.java:155)
	at org.apache.flink.streaming.runtime.watermarkstatus.HeapPriorityQueue.remove(HeapPriorityQueue.java:100)
	at org.apache.flink.streaming.runtime.watermarkstatus.StatusWatermarkValve$InputChannelStatus.removeFrom(StatusWatermarkValve.java:300)
	at org.apache.flink.streaming.runtime.watermarkstatus.StatusWatermarkValve$InputChannelStatus.access$200(StatusWatermarkValve.java:266)
	at org.apache.flink.streaming.runtime.watermarkstatus.StatusWatermarkValve.markWatermarkUnaligned(StatusWatermarkValve.java:222)
	at org.apache.flink.streaming.runtime.watermarkstatus.StatusWatermarkValve.inputWatermarkStatus(StatusWatermarkValve.java:140)
	at org.apache.flink.streaming.runtime.io.AbstractStreamTaskNetworkInput.processElement(AbstractStreamTaskNetworkInput.java:153)
	at org.apache.flink.streaming.runtime.io.AbstractStreamTaskNetworkInput.emitNext(AbstractStreamTaskNetworkInput.java:110)
	at org.apache.flink.streaming.runtime.io.StreamOneInputProcessor.processInput(StreamOneInputProcessor.java:65)
	at org.apache.flink.streaming.runtime.io.StreamMultipleInputProcessor.processInput(StreamMultipleInputProcessor.java:85)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.processInput(StreamTask.java:550)
	at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.runMailboxLoop(MailboxProcessor.java:231)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.runMailboxLoop(StreamTask.java:839)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:788)
	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:952)
	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:931)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:745)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:562)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I never saw this before. The job has multiple Kafka inputs, but doesn&apos;t use watermark alignment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Initially reported &lt;a href=&quot;https://apache-flink.slack.com/archives/C03G7LJTS2G/p1679908171461309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on Slack&lt;/a&gt;, where a relation to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-28853&quot; title=&quot;FLIP-217 Support watermark alignment of source splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-28853&quot;&gt;&lt;del&gt;FLINK-28853&lt;/del&gt;&lt;/a&gt; was suspected.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Kubernetes with Flink operator 1.4.0.&lt;/p&gt;</environment>
        <key id="13530214">FLINK-31628</key>
            <summary>ArrayIndexOutOfBoundsException in watermark processing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wanglijie">Lijie Wang</assignee>
                                    <reporter username="michael.helmling">Michael Helmling</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 27 Mar 2023 09:25:57 +0000</created>
                <updated>Thu, 13 Apr 2023 08:06:45 +0000</updated>
                            <resolved>Thu, 13 Apr 2023 08:06:45 +0000</resolved>
                                    <version>1.17.0</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.17.1</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17705262" author="martijnvisser" created="Mon, 27 Mar 2023 09:34:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; My initial thinking was that this might be caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-28853&quot; title=&quot;FLIP-217 Support watermark alignment of source splits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-28853&quot;&gt;&lt;del&gt;FLINK-28853&lt;/del&gt;&lt;/a&gt;, WDYT?&lt;/p&gt;</comment>
                            <comment id="17709580" author="wanglijie95" created="Fri, 7 Apr 2023 04:27:43 +0000"  >&lt;p&gt;This is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-30544&quot; title=&quot;Speed up finding minimum watermark across all channels by introducing heap-based algorithm&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-30544&quot;&gt;&lt;del&gt;FLINK-30544&lt;/del&gt;&lt;/a&gt;, in which we introduced a heap to help find the minimum watermark. This error occurs when the channel status changes like this:&lt;/p&gt;

&lt;p&gt;phase 1: channel becomes IDLE (receives WatermarkStatus.IDLE)&lt;br/&gt;
phase 2: channel becomes ACTIVE (receives WatermarkStatus.ACTIVE), but current watermark of the channel is less than the last output watermark (last watermark sent to downstream tasks)&lt;br/&gt;
phase 3: channel becomes IDLE again (receives WatermarkStatus.IDLE again)&lt;/p&gt;

&lt;p&gt;In phase 1, we remove the channel from the heap because it is idle, should no longer participate in the calculation of the minimum watermark. In phase 2, although the channel becomes active, but its watermark is expired(less than the last output watermark), so we don&apos;t add it back to the heap. And then in phase 3, we try to remove the channel again, but the channel is not in the heap, which causes the above problem.&lt;/p&gt;</comment>
                            <comment id="17709581" author="wanglijie95" created="Fri, 7 Apr 2023 04:30:35 +0000"  >&lt;p&gt;We should check if the channel is in the heap before removing it(or let the heap does not throw exception when trying to remove an absent element). I&apos;ll prepare a fix soon.&lt;/p&gt;</comment>
                            <comment id="17709583" author="wanglijie95" created="Fri, 7 Apr 2023 04:36:15 +0000"  >&lt;p&gt;This problem may occur when the source configures &lt;tt&gt;table.exec.source.idle-timeout&lt;/tt&gt; or uses the &lt;tt&gt;WatermarkStrategyWithIdleness&lt;/tt&gt; strategy&lt;/p&gt;</comment>
                            <comment id="17711735" author="wanglijie95" created="Thu, 13 Apr 2023 08:06:30 +0000"  >&lt;p&gt;Fixed via&#160;&lt;/p&gt;

&lt;p&gt;master: a9bc791abdff5bd8e4cb3d67bb1417b2f02c990a&lt;/p&gt;

&lt;p&gt;release-1.17: 508de2f41fcbd2a4d64a5e8dd291926e273b4f50&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13516252">FLINK-30544</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1gvig:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>