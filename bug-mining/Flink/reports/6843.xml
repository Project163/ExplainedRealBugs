<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30093] [Flink SQL][Protobuf] CompileException when querying Kafka topic using google.protobuf.Timestamp </title>
                <link>https://issues.apache.org/jira/browse/FLINK-30093</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I am encountering an issue when trying to use Flink SQL to query a Kafka topic that uses &lt;tt&gt;google.protobuf.Timestamp&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When attempting to use Flink SQL to query a protobuf serialized Kafka topic that uses&#160; &lt;tt&gt;google.protobuf.Timestamp&lt;/tt&gt;, a {{org.codehaus.commons.compiler.CompileException: Line 23, Column 5: Cannot determine simple type name &quot;com&quot; }}error occurs when trying to query the table.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Replication steps:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. Use a protobuf definition that contains a &lt;tt&gt;google.protobuf.Timestamp&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;syntax = &quot;proto3&quot;;
package example.message;

import &quot;google/protobuf/timestamp.proto&quot;;

option java_package = &quot;com.example.message&quot;;
option java_multiple_files = true;

message Test {
  int64 id = 1;
  google.protobuf.Timestamp created_at = 5;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. Use protobuf definition to produce message to topic&lt;/p&gt;

&lt;p&gt;3. Confirm message is deserializable by protoc:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kcat -C -t development.example.message -b localhost:9092 -o -1 -e -q -D &quot;&quot; | protoc --decode=example.message.Test --proto_path=/Users/jamesmcguire/repos/flink-proto-example/schemas/ example/message/test.proto 
id: 123
created_at {
  seconds: 456
  nanos: 789
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;4. Create table in Flink SQL using kafka connector and protobuf format&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE tests (
  id BIGINT,
  created_at row&amp;lt;seconds BIGINT, nanos INT&amp;gt;
)
COMMENT &apos;&apos;
WITH (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;protobuf&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;protobuf.message-&lt;span class=&quot;code-keyword&quot;&gt;class-&lt;/span&gt;name&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;com.example.message.Test&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.auto.offset.reset&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;earliest&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;host.docker.internal:9092&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;test-1&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;development.example.message&apos;&lt;/span&gt;
);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;5. Run query in Flink SQL and encounter error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Flink SQL&amp;gt; select * from tests;
[ERROR] Could not execute SQL statement. Reason:
org.codehaus.commons.compiler.CompileException: Line 23, Column 5: Cannot determine simple type name &lt;span class=&quot;code-quote&quot;&gt;&quot;com&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;NOTE&lt;/b&gt;: If you repeat steps 4-5 without &lt;tt&gt;created_at row&amp;lt;seconds BIGINT, nanos INT&amp;gt;&lt;/tt&gt; in the table, step 5 will complete successfully.&lt;/p&gt;

&lt;p&gt;6. Observe in attached log file, Flink appears to be using the incorrect namespace (should be &lt;tt&gt;google.protobuf.Timestamp):&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
com.example.message.Timestamp message3 = message0.getCreatedAt(); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Mac OS Ventura&lt;/p&gt;</environment>
        <key id="13503687">FLINK-30093</key>
            <summary>[Flink SQL][Protobuf] CompileException when querying Kafka topic using google.protobuf.Timestamp </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="laughingman7743">Tomoyuki NAKAMURA</assignee>
                                    <reporter username="jamesmcguirepro">James Mcguire</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 18 Nov 2022 18:36:24 +0000</created>
                <updated>Thu, 3 Apr 2025 06:27:01 +0000</updated>
                            <resolved>Thu, 19 Jan 2023 12:56:30 +0000</resolved>
                                    <version>1.16.0</version>
                                    <fixVersion>1.17.0</fixVersion>
                                    <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                    <component>Table SQL / Ecosystem</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17635995" author="rmetzger" created="Fri, 18 Nov 2022 19:02:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maosuhan&quot; class=&quot;user-hover&quot; rel=&quot;maosuhan&quot;&gt;maosuhan&lt;/a&gt; Sorry for pinging you directly, could you take a look at this?&lt;/p&gt;</comment>
                            <comment id="17636400" author="maosuhan" created="Mon, 21 Nov 2022 02:50:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; Thanks for your findings!&lt;/p&gt;

&lt;p&gt;I did not consider that user will use &lt;b&gt;google.protobuf.Timestamp&lt;/b&gt; in the proto file. So importing definition is not supported in current flink version, but it definitely should be supported in the future.&lt;/p&gt;

&lt;p&gt;`&lt;/p&gt;</comment>
                            <comment id="17640143" author="hdulay" created="Mon, 28 Nov 2022 17:12:34 +0000"  >&lt;p&gt;I may have found the solution to this. Basically the generated code doesn&apos;t compile and the error message originating from codehaus.janino is a terrible one. The line below is the culprit&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-formats/flink-protobuf/src/main/java/org/apache/flink/formats/protobuf/util/PbFormatUtils.java#L39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-formats/flink-protobuf/src/main/java/org/apache/flink/formats/protobuf/util/PbFormatUtils.java#L39&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Changing it from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; outerProtoName + descriptor.getName();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;to&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; descriptor.getFile().getOptions().getJavaPackage() + &lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt; + descriptor.getName();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Seemed to do the trick but I&apos;m still working through it.&lt;/p&gt;</comment>
                            <comment id="17651799" author="laughingman7743" created="Sat, 24 Dec 2022 16:20:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hdulay&quot; class=&quot;user-hover&quot; rel=&quot;hdulay&quot;&gt;hdulay&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am using Flink 1.14.x by porting the early version of the branch where the protobuf format feature was developed, and google.protobuf.Timestamp can be handled as row&amp;lt;seconds BIGINT, nanos INT&amp;gt; without problems.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/14376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/14376&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Perhaps you mey need to make sure that multiple_files is set and outer classes are defined as in the early version.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/maosuhan/flink/blob/888696df9507a0129c894b913b7828c836a95985/flink-formats/flink-protobuf/src/main/java/org/apache/flink/formats/protobuf/PbFormatUtils.java#L55-L90&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/maosuhan/flink/blob/888696df9507a0129c894b913b7828c836a95985/flink-formats/flink-protobuf/src/main/java/org/apache/flink/formats/protobuf/PbFormatUtils.java#L55-L90&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17652696" author="maosuhan" created="Thu, 29 Dec 2022 04:14:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;&#160; Since this issue can be solved by the way &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=laughingman7743&quot; class=&quot;user-hover&quot; rel=&quot;laughingman7743&quot;&gt;laughingman7743&lt;/a&gt;&#160; suggested. Can we close this issue?&lt;/p&gt;</comment>
                            <comment id="17652699" author="hdulay" created="Thu, 29 Dec 2022 04:28:00 +0000"  >&lt;p&gt;I think that would be best. Thanks&lt;/p&gt;

</comment>
                            <comment id="17652700" author="libenchao" created="Thu, 29 Dec 2022 04:45:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maosuhan&quot; class=&quot;user-hover&quot; rel=&quot;maosuhan&quot;&gt;maosuhan&lt;/a&gt; If this is the suggested way to handle&#160;&lt;tt&gt;google.protobuf.Timestamp&lt;/tt&gt; type, how about adding it to the document explicitly?&lt;/p&gt;</comment>
                            <comment id="17652848" author="laughingman7743" created="Thu, 29 Dec 2022 13:28:55 +0000"  >&lt;p&gt;I am not sure if 1.16 can handle the google.protobuf.Timestamp type. Since I am still using an early implementation of this Protobuf formatter.&lt;br/&gt;
If it is recommended to set multiple_files and define an outer class, it would help a lot of people if there is a description in the documentation.&lt;/p&gt;

&lt;p&gt;It would also be better if a unit test of type google.protobuf.Timestamp could be added. It is possible that the google.protobuf.Timestamp type may no longer be handled since the implementation seems to have been changed from earlier versions.&lt;/p&gt;</comment>
                            <comment id="17653556" author="rmetzger" created="Mon, 2 Jan 2023 10:19:52 +0000"  >&lt;p&gt;I&apos;m not a protobuf expert, so I can not decide what&apos;s best from a user experience perspective.&lt;/p&gt;

&lt;p&gt;Using &lt;tt&gt;row&amp;lt;seconds BIGINT, nanos INT&amp;gt;&lt;/tt&gt; sounds like a workaround to me? Wouldn&apos;t it be nicer if the Timestamp-type is handled out of the box by Flink? If you think this is an ok user experience, then I agree with Benchao, that we should at least document how how to use the timestamp type with Flink.&lt;/p&gt;</comment>
                            <comment id="17654125" author="JIRAUSER296472" created="Tue, 3 Jan 2023 18:08:41 +0000"  >&lt;p&gt;Using &#160;&lt;tt&gt;row&amp;lt;seconds BIGINT, nanos INT&amp;gt;&lt;/tt&gt; did not work with 1.16.0 for me.&#160; &#160;If you review the ticket, you can see that is how I had the table schema defined.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;+1 on updating the documentation no matter what.&lt;/p&gt;</comment>
                            <comment id="17654308" author="maosuhan" created="Wed, 4 Jan 2023 06:30:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamesmcguirepro&quot; class=&quot;user-hover&quot; rel=&quot;jamesmcguirepro&quot;&gt;jamesmcguirepro&lt;/a&gt; Thanks for your feedback, I&apos;ll update the documentation and try to find a better way to support this requirement.&lt;/p&gt;</comment>
                            <comment id="17654485" author="laughingman7743" created="Wed, 4 Jan 2023 14:24:07 +0000"  >&lt;p&gt;Unfortunately, Flink 1.16 can no longer handle the google.protobuf.Timestamp type. I have added a test case for the google.protobuf.Timestamp type to confirm this.&lt;br/&gt;
&lt;a href=&quot;https://github.com/laughingman7743/flink/pull/1/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/laughingman7743/flink/pull/1/files&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.formats.protobuf.PbCodegenException: org.apache.flink.api.common.InvalidProgramException: Program cannot be compiled. This is a bug. Please file an issue.

	at org.apache.flink.formats.protobuf.deserialize.ProtoToRowConverter.&amp;lt;init&amp;gt;(ProtoToRowConverter.java:126)
	at org.apache.flink.formats.protobuf.deserialize.PbRowDataDeserializationSchema.open(PbRowDataDeserializationSchema.java:64)
	at org.apache.flink.formats.protobuf.ProtobufTestHelper.pbBytesToRow(ProtobufTestHelper.java:118)
	at org.apache.flink.formats.protobuf.ProtobufTestHelper.pbBytesToRow(ProtobufTestHelper.java:102)
	at org.apache.flink.formats.protobuf.ProtobufTestHelper.pbBytesToRow(ProtobufTestHelper.java:97)
	at org.apache.flink.formats.protobuf.TimestampToRowTest.testSimple(TimestampToRowTest.java:22)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater$1.execute(IdeaTestRunner.java:38)
	at com.intellij.rt.execution.junit.TestsRepeater.repeat(TestsRepeater.java:11)
	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:35)
	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: org.apache.flink.api.common.InvalidProgramException: Program cannot be compiled. This is a bug. Please file an issue.
	at org.apache.flink.formats.protobuf.util.PbCodegenUtils.compileClass(PbCodegenUtils.java:265)
	at org.apache.flink.formats.protobuf.deserialize.ProtoToRowConverter.&amp;lt;init&amp;gt;(ProtoToRowConverter.java:118)
	... 32 more
Caused by: org.codehaus.commons.compiler.CompileException: Line 19, Column 5: Cannot determine simple type name &lt;span class=&quot;code-quote&quot;&gt;&quot;org&quot;&lt;/span&gt;
	at org.codehaus.janino.UnitCompiler.compileError(UnitCompiler.java:12211)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6833)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6594)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6607)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6607)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6607)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6607)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6607)
	at org.codehaus.janino.UnitCompiler.getReferenceType(UnitCompiler.java:6607)
	at org.codehaus.janino.UnitCompiler.getType2(UnitCompiler.java:6573)
	at org.codehaus.janino.UnitCompiler.access$13900(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$22$1.visitReferenceType(UnitCompiler.java:6481)
	at org.codehaus.janino.UnitCompiler$22$1.visitReferenceType(UnitCompiler.java:6476)
	at org.codehaus.janino.Java$ReferenceType.accept(Java.java:3928)
	at org.codehaus.janino.UnitCompiler$22.visitType(UnitCompiler.java:6476)
	at org.codehaus.janino.UnitCompiler$22.visitType(UnitCompiler.java:6469)
	at org.codehaus.janino.Java$ReferenceType.accept(Java.java:3927)
	at org.codehaus.janino.UnitCompiler.getType(UnitCompiler.java:6469)
	at org.codehaus.janino.UnitCompiler.getLocalVariable(UnitCompiler.java:2616)
	at org.codehaus.janino.UnitCompiler.buildLocalVariableMap(UnitCompiler.java:3662)
	at org.codehaus.janino.UnitCompiler.access$5800(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$12.visitLocalVariableDeclarationStatement(UnitCompiler.java:3545)
	at org.codehaus.janino.UnitCompiler$12.visitLocalVariableDeclarationStatement(UnitCompiler.java:3513)
	at org.codehaus.janino.Java$LocalVariableDeclarationStatement.accept(Java.java:3522)
	at org.codehaus.janino.UnitCompiler.buildLocalVariableMap(UnitCompiler.java:3512)
	at org.codehaus.janino.UnitCompiler.buildLocalVariableMap(UnitCompiler.java:3501)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3322)
	at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1357)
	at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1330)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:822)
	at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:432)
	at org.codehaus.janino.UnitCompiler.access$400(UnitCompiler.java:215)
	at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:411)
	at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:406)
	at org.codehaus.janino.Java$PackageMemberClassDeclaration.accept(Java.java:1414)
	at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:406)
	at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:378)
	at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:237)
	at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:465)
	at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:216)
	at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:207)
	at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:80)
	at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:75)
	at org.apache.flink.formats.protobuf.util.PbCodegenUtils.compileClass(PbCodegenUtils.java:262)
	... 33 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will try to check the difference of the implementation in Flink 1.16 from the earlier version.&lt;/p&gt;</comment>
                            <comment id="17654566" author="laughingman7743" created="Wed, 4 Jan 2023 17:39:00 +0000"  >&lt;p&gt;I fixed it in the following branch.&lt;br/&gt;
&lt;a href=&quot;https://github.com/laughingman7743/flink/pull/2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/laughingman7743/flink/pull/2&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/laughingman7743/flink/pull/2/commits/730b374b1056b5af9f39f21e2f83e8371e044948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/laughingman7743/flink/pull/2/commits/730b374b1056b5af9f39f21e2f83e8371e044948&lt;/a&gt;&lt;br/&gt;
Regardless of the user-defined protobuf option, the google.protobuf.Timestamp type always has multiple_files=true, in which case the best choice is to use the descriptor getJavaPackage or getPackage as the full name of the java class.&lt;br/&gt;
In other cases, it is best to use outerProtoName. A simple test has confirmed that this is not a problem.&lt;/p&gt;</comment>
                            <comment id="17654822" author="laughingman7743" created="Thu, 5 Jan 2023 07:30:30 +0000"  >&lt;p&gt;I have investigated the Flink 1.16 implementation in detail.&lt;br/&gt;
The current implementation does not take into consideration the case where another package is imported and used for a message, so it seems that the way getOuterProtoPrefix is determined needs to be improved.&lt;/p&gt;

&lt;p&gt;I made a fix in the following branch to try it out.&lt;br/&gt;
&lt;a href=&quot;https://github.com/laughingman7743/flink/pull/3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/laughingman7743/flink/pull/3&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/laughingman7743/flink/pull/3/commits/f8ad68c401279b5911687473940918465d797692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/laughingman7743/flink/pull/3/commits/f8ad68c401279b5911687473940918465d797692&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It also takes into consideration cases where the multiple_files and java_outer_classname options are not specified and the suffix OuterClass is added when the file name and message name are the same.&lt;br/&gt;
This should probably cover most cases of protobuf definitions.&lt;/p&gt;

&lt;p&gt;If this change is acceptable I will create a pull request in the Flink main repository.&lt;/p&gt;</comment>
                            <comment id="17655630" author="maosuhan" created="Sat, 7 Jan 2023 02:51:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=laughingman7743&quot; class=&quot;user-hover&quot; rel=&quot;laughingman7743&quot;&gt;laughingman7743&lt;/a&gt; Thanks for your code. It looks to me. You can go ahead and I will review the code when you&apos;re done.&lt;/p&gt;

&lt;p&gt;I think the core change is to use a new getOuterProtoPrefix method which handle different cases. I appreciate that you also consider OuterClass suffix in a special case.&#160; Maybe the reason it works in older version is that I wrote more codes to handle different options but deleted later for simplicity getting outer prefix name. But in fact this is an issue after probobuf is released, I think we should improve this logic.&lt;/p&gt;</comment>
                            <comment id="17655652" author="laughingman7743" created="Sat, 7 Jan 2023 05:42:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maosuhan&quot; class=&quot;user-hover&quot; rel=&quot;maosuhan&quot;&gt;maosuhan&lt;/a&gt;&lt;br/&gt;
I have created a pull request in the Flink main repository.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/pull/21613&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/21613&lt;/a&gt;&lt;br/&gt;
Please take a look at it when you have time.&lt;/p&gt;</comment>
                            <comment id="17678682" author="libenchao" created="Thu, 19 Jan 2023 12:56:30 +0000"  >&lt;p&gt;Fixed via &lt;a href=&quot;https://github.com/apache/flink/commit/7ea4476c0544e17798cbb1e39609827954f6c266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/7ea4476c0544e17798cbb1e39609827954f6c266&lt;/a&gt; (master)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=laughingman7743&quot; class=&quot;user-hover&quot; rel=&quot;laughingman7743&quot;&gt;laughingman7743&lt;/a&gt; Thanks for your PR, and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maosuhan&quot; class=&quot;user-hover&quot; rel=&quot;maosuhan&quot;&gt;maosuhan&lt;/a&gt; thanks for the review.&lt;/p&gt;</comment>
                            <comment id="17731015" author="baugarten" created="Fri, 9 Jun 2023 16:17:44 +0000"  >&lt;p&gt;Hey, thanks for the contribution. I&apos;m running into this same issue on Flink 1.16 and would like to backport the fix to the release-1.16 branch for a future patch release. I think this is a good candidate for backporting, and the commit against master applied cleanly to the release-1.16 branch.&lt;/p&gt;

&lt;p&gt;I opened up &lt;a href=&quot;https://github.com/apache/flink/pull/22752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this PR &lt;/a&gt; based on the original PR: &lt;a href=&quot;https://github.com/apache/flink/pull/21613&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/21613&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="17731148" author="libenchao" created="Sat, 10 Jun 2023 02:28:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=baugarten&quot; class=&quot;user-hover&quot; rel=&quot;baugarten&quot;&gt;baugarten&lt;/a&gt; Thanks for your work! &lt;/p&gt;

&lt;p&gt;However, I think this is more like a feature instead of bug, that&apos;s why we only merged it to &quot;master&quot; branch.&lt;/p&gt;</comment>
                            <comment id="17733211" author="baugarten" created="Thu, 15 Jun 2023 19:49:42 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;, at first I thought that this ticket might have been considered a bug.&lt;/p&gt;

&lt;p&gt;I couldn&apos;t find guidance in the &lt;a href=&quot;https://flink.apache.org/how-to-contribute/contribute-code/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;contributing&lt;/a&gt; &lt;a href=&quot;https://cwiki.apache.org/confluence/display/FLINK/Apache+Flink+Home&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;guidelines&lt;/a&gt; on what changes are eligible for backporting to patch releases. In the past, I know some features (ie HybridSource) ended up getting backported to a previous release&lt;/p&gt;</comment>
                            <comment id="17733285" author="libenchao" created="Fri, 16 Jun 2023 02:30:16 +0000"  >&lt;p&gt;Usually the &quot;bugfix&quot; which fixes the functionality which is advertised to users by documentation/release note, is a good candidate to back port. For this one, in the original implementation, &lt;tt&gt;Timestamp&lt;/tt&gt; is not considered as a supported type, and it&apos;s not tested/documented, hence supporting &lt;tt&gt;Timestamp&lt;/tt&gt; is more like an improvement to me. What do you guys think?&lt;/p&gt;</comment>
                            <comment id="17733317" author="laughingman7743" created="Fri, 16 Jun 2023 04:37:15 +0000"  >&lt;p&gt;I would like to see this change backported to 1.16, because without applying this change, we will not be able to use the imported portobuf definitions as well as google.protobuf.Timestamp.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13542626">FLINK-32547</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13052385" name="taskmanager_172.22.0 (1).4_46291-40eec2_log" size="71276" author="jamesmcguirepro" created="Fri, 18 Nov 2022 18:36:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1cce0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>