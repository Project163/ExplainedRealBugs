<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8331] FieldParsers do not correctly set EMPT_COLUMN error state</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8331</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Some &lt;tt&gt;FieldParser&lt;/tt&gt; do not correctly set the EMPTY_COLUMN error state if a field is empty.&lt;br/&gt;
Instead, they try to parse the field value from an empty String which fails, e.g., in case of the &lt;tt&gt;DoubleParser&lt;/tt&gt; with a &lt;tt&gt;NumberFormatException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;RowCsvInputFormat&lt;/tt&gt; has a flag to interpret empty fields as &lt;tt&gt;null&lt;/tt&gt; values. The implementation requires that all &lt;tt&gt;FieldParser&lt;/tt&gt; correctly return the EMPTY_COLUMN error state in case of an empty field.&lt;/p&gt;

&lt;p&gt;Affected &lt;tt&gt;FieldParser&lt;/tt&gt;:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BigDecParser&lt;/li&gt;
	&lt;li&gt;BigIntParser&lt;/li&gt;
	&lt;li&gt;DoubleParser&lt;/li&gt;
	&lt;li&gt;FloatParser&lt;/li&gt;
	&lt;li&gt;SqlDateParser&lt;/li&gt;
	&lt;li&gt;SqlTimeParser&lt;/li&gt;
	&lt;li&gt;SqlTimestampParser&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13127715">FLINK-8331</key>
            <summary>FieldParsers do not correctly set EMPT_COLUMN error state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunjincheng121">sunjincheng</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Dec 2017 21:25:59 +0000</created>
                <updated>Thu, 28 Feb 2019 13:21:27 +0000</updated>
                            <resolved>Fri, 5 Jan 2018 16:08:59 +0000</resolved>
                                    <version>1.4.1</version>
                    <version>1.5.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16306771" author="githubbot" created="Sat, 30 Dec 2017 13:39:47 +0000"  >&lt;p&gt;GitHub user sunjincheng121 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8331&quot; title=&quot;FieldParsers do not correctly set EMPT_COLUMN error state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8331&quot;&gt;&lt;del&gt;FLINK-8331&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;core&amp;#93;&lt;/span&gt; FieldParser do not correctly set EMPT_COLUMN error state.&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(In this PR fixed FieldParser do not correctly set EMPT_COLUMN error state bug, i.e. All FieldParser correctly return the EMPTY_COLUMN error state in case of an empty field.)&lt;/b&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*Change `nextStringEndPos` method set EMPT_COLUMN error state logic.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;br/&gt;
    This change added tests and can be verified as follows:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Add a `testNextStringEndPos` test case in `FieldParserTest`.&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Add a `testNullValueWithoutTrailingDelimiter` test casle in `RowCsvInputFormatTest`&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sunjincheng121/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sunjincheng121/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8331&quot; title=&quot;FieldParsers do not correctly set EMPT_COLUMN error state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8331&quot;&gt;&lt;del&gt;FLINK-8331&lt;/del&gt;&lt;/a&gt;-PR&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5218&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 32d22ab681c5292d23818012242a16db0a2d1a8e&lt;br/&gt;
Author: &#37329;&#31481; &amp;lt;jincheng.sunjc@...&amp;gt;&lt;br/&gt;
Date:   2017-12-30T03:10:18Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8331&quot; title=&quot;FieldParsers do not correctly set EMPT_COLUMN error state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8331&quot;&gt;&lt;del&gt;FLINK-8331&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;core&amp;#93;&lt;/span&gt; fix FieldParser do not correctly set EMPT_COLUMN error state bug&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16306920" author="githubbot" created="Sat, 30 Dec 2017 19:49:29 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159127955&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159127955&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/FieldParserTest.java &amp;#8212;&lt;br/&gt;
    @@ -43,4 +43,38 @@ public void testEndsWithDelimiter() throws Exception &lt;/p&gt;
{
     		assertFalse(FieldParser.endsWithDelimiter(bytes, 3, delim));
     	}

&lt;p&gt;    +	@Test&lt;br/&gt;
    +	public void testNextStringEndPos() throws Exception &lt;/p&gt;
{
    +		byte[] bytes = &quot;a|c&quot;.getBytes();
    +		byte[] delim = &quot;|&quot;.getBytes();
    +		FieldParser parser = new TestFieldParser&amp;lt;String&amp;gt;();
    +
    +		assertEquals(1, parser.nextStringEndPos(bytes, 0, 3, delim));
    +		assertEquals(-1, parser.nextStringEndPos(bytes, 3, 3, delim));
    +	}
&lt;p&gt;    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    remove line break&lt;/p&gt;</comment>
                            <comment id="16306921" author="githubbot" created="Sat, 30 Dec 2017 19:49:29 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159128212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159128212&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/FieldParserTest.java &amp;#8212;&lt;br/&gt;
    @@ -43,4 +43,38 @@ public void testEndsWithDelimiter() throws Exception &lt;/p&gt;
{
     		assertFalse(FieldParser.endsWithDelimiter(bytes, 3, delim));
     	}

&lt;p&gt;    +	@Test&lt;br/&gt;
    +	public void testNextStringEndPos() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It would be good if the test would cover more corner cases for `nextStringEndPos()`, such as&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;multi-char delimiter&lt;/li&gt;
	&lt;li&gt;field with trailing delimiter&lt;/li&gt;
	&lt;li&gt;field without training delimiter&lt;/li&gt;
	&lt;li&gt;empty field&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    For example with test date like this&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    byte[] bytes1 = &quot;field1|#|field2&quot;.getBytes();&lt;br/&gt;
    byte[] bytes2 = &quot;field3|#|&quot;.getBytes();&lt;/p&gt;

&lt;p&gt;    byte[] delim = &quot;|#|&quot;.getBytes();&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16306922" author="githubbot" created="Sat, 30 Dec 2017 19:49:29 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159127981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159127981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/FieldParserTest.java &amp;#8212;&lt;br/&gt;
    @@ -43,4 +43,38 @@ public void testEndsWithDelimiter() throws Exception &lt;/p&gt;
{
     		assertFalse(FieldParser.endsWithDelimiter(bytes, 3, delim));
     	}

&lt;p&gt;    +	@Test&lt;br/&gt;
    +	public void testNextStringEndPos() throws Exception {&lt;br/&gt;
    +		byte[] bytes = &quot;a|c&quot;.getBytes();&lt;br/&gt;
    +		byte[] delim = &quot;|&quot;.getBytes();&lt;br/&gt;
    +		FieldParser parser = new TestFieldParser&amp;lt;String&amp;gt;();&lt;br/&gt;
    +&lt;br/&gt;
    +		assertEquals(1, parser.nextStringEndPos(bytes, 0, 3, delim));&lt;br/&gt;
    +		assertEquals(-1, parser.nextStringEndPos(bytes, 3, 3, delim));&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    add an assertion that the error state was correctly set&lt;/p&gt;</comment>
                            <comment id="16306923" author="githubbot" created="Sat, 30 Dec 2017 19:49:29 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159128322&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159128322&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/io/RowCsvInputFormatTest.java &amp;#8212;&lt;br/&gt;
    @@ -61,6 +62,84 @@&lt;br/&gt;
     	private static final String FIRST_PART = &quot;That is the first part&quot;;&lt;br/&gt;
     	private static final String SECOND_PART = &quot;That is the second part&quot;;&lt;/p&gt;

&lt;p&gt;    +	@Test&lt;br/&gt;
    +	public void testNullValueWithoutTrailingDelimiter() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We should test the individual parsers by extending `ParserTestBase` with tests that check for correct empty field behavior (EMPTY_COLUMN error state) with and without a following delimiter.&lt;/p&gt;

&lt;p&gt;    IMO, the null field behavior of `RowCsvInputFormat` is sufficiently tested by `RowCsvInputFormatTest.testEmptyFields()` such that this test does not need to be extended.&lt;/p&gt;</comment>
                            <comment id="16307041" author="githubbot" created="Sun, 31 Dec 2017 02:17:38 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159132545&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159132545&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/io/RowCsvInputFormatTest.java &amp;#8212;&lt;br/&gt;
    @@ -61,6 +62,84 @@&lt;br/&gt;
     	private static final String FIRST_PART = &quot;That is the first part&quot;;&lt;br/&gt;
     	private static final String SECOND_PART = &quot;That is the second part&quot;;&lt;/p&gt;

&lt;p&gt;    +	@Test&lt;br/&gt;
    +	public void testNullValueWithoutTrailingDelimiter() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="16307125" author="githubbot" created="Sun, 31 Dec 2017 06:53:05 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159134590&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159134590&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/io/RowCsvInputFormatTest.java &amp;#8212;&lt;br/&gt;
    @@ -61,6 +62,84 @@&lt;br/&gt;
     	private static final String FIRST_PART = &quot;That is the first part&quot;;&lt;br/&gt;
     	private static final String SECOND_PART = &quot;That is the second part&quot;;&lt;/p&gt;

&lt;p&gt;    +	@Test&lt;br/&gt;
    +	public void testNullValueWithoutTrailingDelimiter() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    About `RowCsvInputFormatTest.testEmptyFields()`do not check the tailing empty field, And in  `RowCsvInputFormatTest.testTailingEmptyFields`, test tailing empty field for STRING type. I think we shoud add &lt;br/&gt;
    DOUBLE/FLOAT/BIGINT/BIGDEC/SQL_DATE/SQL_TIME/SQL_TIMESTAMP test case as well.&lt;br/&gt;
    What do you think?&lt;/p&gt;</comment>
                            <comment id="16307128" author="githubbot" created="Sun, 31 Dec 2017 07:02:27 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske Thanks for the review.&lt;br/&gt;
    I have updated the PR according your comments. And I have extended the `RowCsvInputFormatTest.testTailingEmptyFields` method for DOUBLE/FLOAT/BIGINT/BIGDEC/SQL_DATE/SQL_TIME/SQL_TIMESTAMP type. Please have a look at the change, And feel free to comments if there is any inappropriate logic.&lt;/p&gt;

&lt;p&gt;    Thanks, Jincheng&lt;/p&gt;</comment>
                            <comment id="16307153" author="githubbot" created="Sun, 31 Dec 2017 09:02:18 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159135908&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159135908&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/ParserTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -407,26 +407,47 @@ public void testStaticParseMethodWithInvalidValues() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testEmptyFieldInIsolation() {&lt;br/&gt;
     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String [] emptyStrings = new String[] 
{&quot;|&quot;}
&lt;p&gt;;&lt;br/&gt;
    +			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
    +&lt;br/&gt;
    +			byte[] bytes = &quot;|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +			int numRead = parser.parseField(bytes, 0, bytes.length, new byte[]&lt;/p&gt;
{&apos;|&apos;}, parser.createValue());&lt;br/&gt;
    +&lt;br/&gt;
    +			assertEquals(FieldParser.ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;br/&gt;
    +&lt;br/&gt;
    +			if (this.allowsEmptyField()) {
    +				assertTrue(&quot;Parser declared the empty string as invalid.&quot;, numRead != -1);
    +				assertEquals(&quot;Invalid number of bytes read returned.&quot;, bytes.length, numRead);
    +			} else {
    +				assertTrue(&quot;Parser accepted the empty string.&quot;, numRead == -1);
    +			}&lt;br/&gt;
    +		} catch (Exception e) {
    +			System.err.println(e.getMessage());
    +			e.printStackTrace();
    +			fail(&quot;Test erroneous: &quot; + e.getMessage());
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testTailingEmptyField() {&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			String[] tailingEmptyFieldStrings = new String[]{&quot;a|&quot;, &quot;a||&quot;};&lt;br/&gt;
     &lt;br/&gt;
     			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
     &lt;br/&gt;
    -			for (String emptyString : emptyStrings) {&lt;br/&gt;
    -				byte[] bytes = emptyString.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    -				int numRead = parser.parseField(bytes, 0, bytes.length, new byte[]{&apos;|&apos;}
&lt;p&gt;, parser.createValue());&lt;br/&gt;
    +			for (String tailingEmptyFieldString : tailingEmptyFieldStrings) {&lt;br/&gt;
    +				byte[] bytes = tailingEmptyFieldString.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +				int numRead = parser.parseField(bytes, 1, bytes.length, new byte[]&lt;/p&gt;
{&apos;|&apos;}
&lt;p&gt;, parser.createValue());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				assertEquals(FieldParser.ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if(this.allowsEmptyField()) {&lt;br/&gt;
    +				if (this.allowsEmptyField()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We should remove the `allowsEmptyField()` method from `ParserTestBase`. All parsers have to support empty fields.&lt;/p&gt;</comment>
                            <comment id="16307154" author="githubbot" created="Sun, 31 Dec 2017 09:02:18 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159135944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159135944&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/ParserTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -407,26 +407,47 @@ public void testStaticParseMethodWithInvalidValues() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testEmptyFieldInIsolation() {&lt;br/&gt;
     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String [] emptyStrings = new String[] 
{&quot;|&quot;}
&lt;p&gt;;&lt;br/&gt;
    +			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
    +&lt;br/&gt;
    +			byte[] bytes = &quot;|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    this is the same case as `&quot;a|&quot;` in `testTailingEmptyField()`. We only need one of these.&lt;/p&gt;</comment>
                            <comment id="16307155" author="githubbot" created="Sun, 31 Dec 2017 09:02:18 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159136001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159136001&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/io/RowCsvInputFormatTest.java &amp;#8212;&lt;br/&gt;
    @@ -362,61 +365,95 @@ public void readStringFieldsWithTrailingDelimiters() throws Exception {&lt;/p&gt;

&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testTailingEmptyFields() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String fileContent = &quot;abc|-def|-ghijk\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;abc|&lt;del&gt;def|&lt;/del&gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;abc|&lt;del&gt;|&lt;/del&gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;|&lt;del&gt;|&lt;/del&gt;|-\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;|&lt;del&gt;|&lt;/del&gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;abc|-def\n&quot;;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileInputSplit split = createTempFile(fileContent);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;TypeInformation[] fieldTypes = new TypeInformation[]
{
    -				BasicTypeInfo.STRING_TYPE_INFO,
    -				BasicTypeInfo.STRING_TYPE_INFO,
    -				BasicTypeInfo.STRING_TYPE_INFO}
&lt;p&gt;;&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;RowCsvInputFormat format = new RowCsvInputFormat(PATH, fieldTypes, &quot;\n&quot;, &quot;|&quot;);&lt;/li&gt;
	&lt;li&gt;format.setFieldDelimiter(&quot;|-&quot;);&lt;/li&gt;
	&lt;li&gt;format.configure(new Configuration());&lt;/li&gt;
	&lt;li&gt;format.open(split);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;Row result = new Row(3);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;result = format.nextRecord(result);&lt;/li&gt;
	&lt;li&gt;assertNotNull(result);&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;abc&quot;, result.getField(0));&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;def&quot;, result.getField(1));&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;ghijk&quot;, result.getField(2));&lt;br/&gt;
    +		List&amp;lt;Tuple4&amp;lt;TypeInformation, String, String, String&amp;gt;&amp;gt; dataList = new java.util.ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
    +&lt;br/&gt;
    +		// test String&lt;br/&gt;
    +		dataList.add(new Tuple4&amp;lt;&amp;gt;(BasicTypeInfo.STRING_TYPE_INFO, &quot;bdc&quot;, &quot;bdc&quot;, &quot;&quot;));&lt;br/&gt;
    +		// test BigInt&lt;br/&gt;
    +		dataList.add(new Tuple4&amp;lt;&amp;gt;(BasicTypeInfo.BIG_INT_TYPE_INFO,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we can extend this test but should not exhaustively test all types. It&apos;s the responsibility of the different `FieldParser` to implement the empty field logic correctly. Hence, this should be tested in the field parser tests and not here.&lt;/p&gt;</comment>
                            <comment id="16307162" author="githubbot" created="Sun, 31 Dec 2017 09:42:17 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159136839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159136839&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/ParserTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -407,26 +407,47 @@ public void testStaticParseMethodWithInvalidValues() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testEmptyFieldInIsolation() {&lt;br/&gt;
     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String [] emptyStrings = new String[] 
{&quot;|&quot;}
&lt;p&gt;;&lt;br/&gt;
    +			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
    +&lt;br/&gt;
    +			byte[] bytes = &quot;|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +			int numRead = parser.parseField(bytes, 0, bytes.length, new byte[]&lt;/p&gt;
{&apos;|&apos;}, parser.createValue());&lt;br/&gt;
    +&lt;br/&gt;
    +			assertEquals(FieldParser.ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;br/&gt;
    +&lt;br/&gt;
    +			if (this.allowsEmptyField()) {
    +				assertTrue(&quot;Parser declared the empty string as invalid.&quot;, numRead != -1);
    +				assertEquals(&quot;Invalid number of bytes read returned.&quot;, bytes.length, numRead);
    +			} else {
    +				assertTrue(&quot;Parser accepted the empty string.&quot;, numRead == -1);
    +			}&lt;br/&gt;
    +		} catch (Exception e) {
    +			System.err.println(e.getMessage());
    +			e.printStackTrace();
    +			fail(&quot;Test erroneous: &quot; + e.getMessage());
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testTailingEmptyField() {&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			String[] tailingEmptyFieldStrings = new String[]{&quot;a|&quot;, &quot;a||&quot;};&lt;br/&gt;
     &lt;br/&gt;
     			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
     &lt;br/&gt;
    -			for (String emptyString : emptyStrings) {&lt;br/&gt;
    -				byte[] bytes = emptyString.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    -				int numRead = parser.parseField(bytes, 0, bytes.length, new byte[]{&apos;|&apos;}
&lt;p&gt;, parser.createValue());&lt;br/&gt;
    +			for (String tailingEmptyFieldString : tailingEmptyFieldStrings) {&lt;br/&gt;
    +				byte[] bytes = tailingEmptyFieldString.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +				int numRead = parser.parseField(bytes, 1, bytes.length, new byte[]&lt;/p&gt;
{&apos;|&apos;}
&lt;p&gt;, parser.createValue());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				assertEquals(FieldParser.ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if(this.allowsEmptyField()) {&lt;br/&gt;
    +				if (this.allowsEmptyField()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Oh, I find you added 4 test file ( `QuotedStringParserTest` | `QuotedStringValueParserTest` |`UnquotedStringParserTest`|`UnquotedStringValueParserTest` ) `allowsEmptyField` is true. &lt;br/&gt;
    so i keep this `allowsEmptyField` in `ParserTestBase`. &lt;/p&gt;</comment>
                            <comment id="16307168" author="githubbot" created="Sun, 31 Dec 2017 10:12:05 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159137345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159137345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/ParserTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -407,26 +407,47 @@ public void testStaticParseMethodWithInvalidValues() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testEmptyFieldInIsolation() {&lt;br/&gt;
     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String [] emptyStrings = new String[] 
{&quot;|&quot;}
&lt;p&gt;;&lt;br/&gt;
    +			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
    +&lt;br/&gt;
    +			byte[] bytes = &quot;|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +			int numRead = parser.parseField(bytes, 0, bytes.length, new byte[]&lt;/p&gt;
{&apos;|&apos;}, parser.createValue());&lt;br/&gt;
    +&lt;br/&gt;
    +			assertEquals(FieldParser.ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;br/&gt;
    +&lt;br/&gt;
    +			if (this.allowsEmptyField()) {
    +				assertTrue(&quot;Parser declared the empty string as invalid.&quot;, numRead != -1);
    +				assertEquals(&quot;Invalid number of bytes read returned.&quot;, bytes.length, numRead);
    +			} else {
    +				assertTrue(&quot;Parser accepted the empty string.&quot;, numRead == -1);
    +			}&lt;br/&gt;
    +		} catch (Exception e) {
    +			System.err.println(e.getMessage());
    +			e.printStackTrace();
    +			fail(&quot;Test erroneous: &quot; + e.getMessage());
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testTailingEmptyField() {&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			String[] tailingEmptyFieldStrings = new String[]{&quot;a|&quot;, &quot;a||&quot;};&lt;br/&gt;
     &lt;br/&gt;
     			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
     &lt;br/&gt;
    -			for (String emptyString : emptyStrings) {&lt;br/&gt;
    -				byte[] bytes = emptyString.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    -				int numRead = parser.parseField(bytes, 0, bytes.length, new byte[]{&apos;|&apos;}
&lt;p&gt;, parser.createValue());&lt;br/&gt;
    +			for (String tailingEmptyFieldString : tailingEmptyFieldStrings) {&lt;br/&gt;
    +				byte[] bytes = tailingEmptyFieldString.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +				int numRead = parser.parseField(bytes, 1, bytes.length, new byte[]&lt;/p&gt;
{&apos;|&apos;}
&lt;p&gt;, parser.createValue());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				assertEquals(FieldParser.ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if(this.allowsEmptyField()) {&lt;br/&gt;
    +				if (this.allowsEmptyField()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, you are right. I misinterpreted the `allowsEmptyField()` method. We need to keep it.&lt;/p&gt;</comment>
                            <comment id="16307198" author="githubbot" created="Sun, 31 Dec 2017 12:20:48 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159139167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159139167&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/io/RowCsvInputFormatTest.java &amp;#8212;&lt;br/&gt;
    @@ -362,61 +365,95 @@ public void readStringFieldsWithTrailingDelimiters() throws Exception {&lt;/p&gt;

&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testTailingEmptyFields() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String fileContent = &quot;abc|-def|-ghijk\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;abc|&lt;del&gt;def|&lt;/del&gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;abc|&lt;del&gt;|&lt;/del&gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;|&lt;del&gt;|&lt;/del&gt;|-\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;|&lt;del&gt;|&lt;/del&gt;\n&quot; +&lt;/li&gt;
	&lt;li&gt;&quot;abc|-def\n&quot;;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileInputSplit split = createTempFile(fileContent);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;TypeInformation[] fieldTypes = new TypeInformation[]
{
    -				BasicTypeInfo.STRING_TYPE_INFO,
    -				BasicTypeInfo.STRING_TYPE_INFO,
    -				BasicTypeInfo.STRING_TYPE_INFO}
&lt;p&gt;;&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;RowCsvInputFormat format = new RowCsvInputFormat(PATH, fieldTypes, &quot;\n&quot;, &quot;|&quot;);&lt;/li&gt;
	&lt;li&gt;format.setFieldDelimiter(&quot;|-&quot;);&lt;/li&gt;
	&lt;li&gt;format.configure(new Configuration());&lt;/li&gt;
	&lt;li&gt;format.open(split);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;Row result = new Row(3);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;result = format.nextRecord(result);&lt;/li&gt;
	&lt;li&gt;assertNotNull(result);&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;abc&quot;, result.getField(0));&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;def&quot;, result.getField(1));&lt;/li&gt;
	&lt;li&gt;assertEquals(&quot;ghijk&quot;, result.getField(2));&lt;br/&gt;
    +		List&amp;lt;Tuple4&amp;lt;TypeInformation, String, String, String&amp;gt;&amp;gt; dataList = new java.util.ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
    +&lt;br/&gt;
    +		// test String&lt;br/&gt;
    +		dataList.add(new Tuple4&amp;lt;&amp;gt;(BasicTypeInfo.STRING_TYPE_INFO, &quot;bdc&quot;, &quot;bdc&quot;, &quot;&quot;));&lt;br/&gt;
    +		// test BigInt&lt;br/&gt;
    +		dataList.add(new Tuple4&amp;lt;&amp;gt;(BasicTypeInfo.BIG_INT_TYPE_INFO,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    ooh,you are right. make sense to me. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16307201" author="githubbot" created="Sun, 31 Dec 2017 12:22:46 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159139198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159139198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/ParserTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -407,26 +407,47 @@ public void testStaticParseMethodWithInvalidValues() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testEmptyFieldInIsolation() {&lt;br/&gt;
     		try {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String [] emptyStrings = new String[] 
{&quot;|&quot;}
&lt;p&gt;;&lt;br/&gt;
    +			FieldParser&amp;lt;T&amp;gt; parser = getParser();&lt;br/&gt;
    +&lt;br/&gt;
    +			byte[] bytes = &quot;|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, we can keep `testEmptyFieldInIsolation`.&lt;/p&gt;</comment>
                            <comment id="16307217" author="githubbot" created="Sun, 31 Dec 2017 13:58:03 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske thanks for your explanation, make sense to me. I updated the PR. The changes as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Revert the change of `RowCsvInputFormatTest.testTailingEmptyFields`.&lt;/li&gt;
	&lt;li&gt;Unity parseField behavior when startPos = limit, except StringParser,  that is `StringParser` set error state `EMPTY_COLUMN` and set empty string to `result`,return `limit` value as index, and other set error state `EMPTY_COLUMN`, return `-1` as index;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Best, Jincheng  &lt;/p&gt;</comment>
                            <comment id="16311495" author="githubbot" created="Thu, 4 Jan 2018 15:27:47 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159670229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159670229&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/StringParser.java &amp;#8212;&lt;br/&gt;
    @@ -42,6 +42,12 @@ public void enableQuotedStringParsing(byte quoteCharacter) {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, String reusable) {&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    +			setErrorState(ParseErrorState.EMPTY_COLUMN);&lt;br/&gt;
    +			this.result = new String(bytes, startPos, limit - startPos, getCharset());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    change to `this.result = &quot;&quot;;`&lt;/p&gt;

&lt;p&gt;    also this early out means that the later check `if (limit == startPos)` in line 93 will never be true and can be removed.&lt;/p&gt;
</comment>
                            <comment id="16311496" author="githubbot" created="Thu, 4 Jan 2018 15:27:47 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159667815&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159667815&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/LongParser.java &amp;#8212;&lt;br/&gt;
    @@ -86,6 +92,11 @@ public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, L&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Why do we need this additional check? &lt;br/&gt;
    This should never evaluate to `true` because the condition is checked before.&lt;/p&gt;

</comment>
                            <comment id="16311497" author="githubbot" created="Thu, 4 Jan 2018 15:27:47 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159670504&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159670504&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/StringValueParser.java &amp;#8212;&lt;br/&gt;
    @@ -45,6 +45,12 @@ public void enableQuotedStringParsing(byte quoteCharacter) {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, StringValue reusable) {&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    +			setErrorState(ParseErrorState.EMPTY_COLUMN);&lt;br/&gt;
    +			reusable.setValueAscii(bytes, startPos, limit - startPos);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    change to `reusable.setValueAscii(bytes, startPos, 0);`&lt;/p&gt;

&lt;p&gt;    also this early out means that the later check `if (limit == startPos)` in line 99 will never be true and can be removed.&lt;/p&gt;</comment>
                            <comment id="16311498" author="githubbot" created="Thu, 4 Jan 2018 15:27:47 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159667871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159667871&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/LongValueParser.java &amp;#8212;&lt;br/&gt;
    @@ -89,6 +95,11 @@ public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, L&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Why do we need this additional check? &lt;br/&gt;
    This should never evaluate to `true` because the condition is checked before.&lt;/p&gt;
</comment>
                            <comment id="16311499" author="githubbot" created="Thu, 4 Jan 2018 15:27:48 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159678062&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159678062&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/types/parser/FieldParserTest.java &amp;#8212;&lt;br/&gt;
    @@ -43,4 +46,100 @@ public void testEndsWithDelimiter() throws Exception &lt;/p&gt;
{
     		assertFalse(FieldParser.endsWithDelimiter(bytes, 3, delim));
     	}

&lt;p&gt;    -}&lt;br/&gt;
    \ No newline at end of file&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testNextStringEndPos() throws Exception {&lt;br/&gt;
    +&lt;br/&gt;
    +		FieldParser parser = new TestFieldParser&amp;lt;String&amp;gt;();&lt;br/&gt;
    +		// single-char delimiter&lt;br/&gt;
    +		byte[] singleCharDelim = &quot;|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +&lt;br/&gt;
    +		byte[] bytes1 = &quot;a|&quot;.getBytes(ConfigConstants.DEFAULT_CHARSET);&lt;br/&gt;
    +		assertEquals(1, parser.nextStringEndPos(bytes1, 0, bytes1.length, singleCharDelim));&lt;br/&gt;
    +		assertEquals(-1, parser.nextStringEndPos(bytes1, 1, bytes1.length, singleCharDelim));&lt;br/&gt;
    +		assertEquals(ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;br/&gt;
    +&lt;br/&gt;
    +		parser.resetParserState();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    please add &lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    parser.resetParserState();&lt;br/&gt;
    assertEquals(-1, parser.nextStringEndPos(bytes1, 2, bytes1.length, singleCharDelim));&lt;br/&gt;
    assertEquals(ParseErrorState.EMPTY_COLUMN, parser.getErrorState());&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16311525" author="githubbot" created="Thu, 4 Jan 2018 15:42:32 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159682488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159682488&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/StringParser.java &amp;#8212;&lt;br/&gt;
    @@ -42,6 +42,12 @@ public void enableQuotedStringParsing(byte quoteCharacter) {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, String reusable) {&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    +			setErrorState(ParseErrorState.EMPTY_COLUMN);&lt;br/&gt;
    +			this.result = new String(bytes, startPos, limit - startPos, getCharset());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I find new String will do some check.. but change to `this.result=&quot;&quot;` also make sense.&lt;/p&gt;</comment>
                            <comment id="16311535" author="githubbot" created="Thu, 4 Jan 2018 15:48:01 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159683964&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159683964&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/LongParser.java &amp;#8212;&lt;br/&gt;
    @@ -86,6 +92,11 @@ public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, L&lt;br/&gt;
     			}&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Good catch!&lt;/p&gt;</comment>
                            <comment id="16311554" author="githubbot" created="Thu, 4 Jan 2018 16:01:28 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske Thanks a lot for your review. I had updated the PR. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    Thanks, Jincheng&lt;/p&gt;</comment>
                            <comment id="16311577" author="githubbot" created="Thu, 4 Jan 2018 16:14:44 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159691114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159691114&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/StringParser.java &amp;#8212;&lt;br/&gt;
    @@ -42,6 +42,12 @@ public void enableQuotedStringParsing(byte quoteCharacter) {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, String reusable) {&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    +			setErrorState(ParseErrorState.EMPTY_COLUMN);&lt;br/&gt;
    +			this.result = new String(bytes, startPos, limit - startPos, getCharset());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We can also remove the condition in line 93.&lt;/p&gt;</comment>
                            <comment id="16311579" author="githubbot" created="Thu, 4 Jan 2018 16:15:08 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218#discussion_r159691205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218#discussion_r159691205&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/types/parser/StringValueParser.java &amp;#8212;&lt;br/&gt;
    @@ -45,6 +45,12 @@ public void enableQuotedStringParsing(byte quoteCharacter) {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public int parseField(byte[] bytes, int startPos, int limit, byte[] delimiter, StringValue reusable) {&lt;/p&gt;

&lt;p&gt;    +		if (startPos == limit) {&lt;br/&gt;
    +			setErrorState(ParseErrorState.EMPTY_COLUMN);&lt;br/&gt;
    +			reusable.setValueAscii(bytes, startPos, limit - startPos);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    we can also remove the condition in line 99.&lt;/p&gt;</comment>
                            <comment id="16311580" author="githubbot" created="Thu, 4 Jan 2018 16:15:46 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good, thanks. &lt;br/&gt;
    I made two more comments. Feel free to merge once these are resolved.&lt;/p&gt;

&lt;p&gt;    Thank you, Fabian&lt;/p&gt;</comment>
                            <comment id="16313078" author="githubbot" created="Fri, 5 Jan 2018 13:13:35 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     Thanks @fhueske, I&apos;ll fix it then merging.&lt;/p&gt;

&lt;p&gt;    Thanks, Jincheng&lt;/p&gt;</comment>
                            <comment id="16313356" author="githubbot" created="Fri, 5 Jan 2018 16:08:15 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5218&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16313357" author="sunjincheng121" created="Fri, 5 Jan 2018 16:08:59 +0000"  >&lt;p&gt;Fixed in 1.5.0 9dd3a859b1609d27ccc80a3da86456e533895b7a&lt;/p&gt;</comment>
                            <comment id="16313571" author="sunjincheng121" created="Fri, 5 Jan 2018 18:04:52 +0000"  >&lt;p&gt;Fixed in 1.4 1c7a7fa706e9b373bbe395398507378a61759190&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3odjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>