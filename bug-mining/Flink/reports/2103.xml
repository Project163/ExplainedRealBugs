<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8151] [Table] Map equality check to use entrySet equality</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8151</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Following up with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8038&quot; title=&quot;Support MAP value constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8038&quot;&gt;&lt;del&gt;FLINK-8038&lt;/del&gt;&lt;/a&gt;. The equality check currently is broken. Plan to support element-wise equality check by always using the base class: &quot;java.util.Map.equals&quot; method.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13120752">FLINK-8151</key>
            <summary>[Table] Map equality check to use entrySet equality</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rongr">Rong Rong</assignee>
                                    <reporter username="rongr">Rong Rong</reporter>
                        <labels>
                    </labels>
                <created>Sun, 26 Nov 2017 00:57:28 +0000</created>
                <updated>Thu, 19 Sep 2019 19:16:15 +0000</updated>
                            <resolved>Fri, 1 Dec 2017 16:40:34 +0000</resolved>
                                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16265891" author="githubbot" created="Sun, 26 Nov 2017 01:31:02 +0000"  >&lt;p&gt;GitHub user walterddr opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8151&quot; title=&quot;[Table] Map equality check to use entrySet equality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8151&quot;&gt;&lt;del&gt;FLINK-8151&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt;Remove Map type equality comparison.&lt;/p&gt;

&lt;p&gt;    Remove map type equality support as unlike java array, there&apos;s no element-wise equality check on Map type. &lt;/p&gt;

&lt;p&gt;    Also small clean up on map value constructor code.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/walterddr/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/walterddr/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8151&quot; title=&quot;[Table] Map equality check to use entrySet equality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8151&quot;&gt;&lt;del&gt;FLINK-8151&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5070&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 237032567847735db83fb5bf0b899a7ae7efb211&lt;br/&gt;
Author: Rong Rong &amp;lt;rongr@uber.com&amp;gt;&lt;br/&gt;
Date:   2017-11-26T01:17:14Z&lt;/p&gt;

&lt;p&gt;    fix map type object equality check&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16268514" author="githubbot" created="Tue, 28 Nov 2017 10:23:55 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070#discussion_r153448795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070#discussion_r153448795&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/calls/ScalarOperators.scala &amp;#8212;&lt;br/&gt;
    @@ -188,13 +188,6 @@ object ScalarOperators &lt;/p&gt;
{
             (leftTerm, rightTerm) =&amp;gt; s&quot;java.util.Arrays.equals($leftTerm, $rightTerm)&quot;
           }
&lt;p&gt;         }&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// map types&lt;/li&gt;
	&lt;li&gt;else if (isMap(left.resultType) &amp;amp;&amp;amp;&lt;/li&gt;
	&lt;li&gt;left.resultType.getTypeClass == right.resultType.getTypeClass) {&lt;/li&gt;
	&lt;li&gt;generateOperatorIfNotNull(nullCheck, BOOLEAN_TYPE_INFO, left, right) {&lt;/li&gt;
	&lt;li&gt;(leftTerm, rightTerm) =&amp;gt; s&quot;java.util.Map.equals($leftTerm, $rightTerm)&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Do we really need to remove the entire functionality? Wouldn&apos;t be `$leftTerm.equals($rightTerm)` be enough?&lt;/p&gt;</comment>
                            <comment id="16268515" author="githubbot" created="Tue, 28 Nov 2017 10:23:55 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070#discussion_r153449102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070#discussion_r153449102&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/expressions/MapTypeTest.scala &amp;#8212;&lt;br/&gt;
    @@ -139,13 +139,6 @@ class MapTypeTest extends MapTypeTestBase {&lt;br/&gt;
       @Test&lt;br/&gt;
       def testMapOperations(): Unit = {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// comparison&lt;/li&gt;
	&lt;li&gt;testAllApis(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why did this test ever worked?&lt;/p&gt;</comment>
                            <comment id="16269090" author="githubbot" created="Tue, 28 Nov 2017 17:31:19 +0000"  >&lt;p&gt;Github user walterddr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070#discussion_r153566038&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070#discussion_r153566038&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/expressions/MapTypeTest.scala &amp;#8212;&lt;br/&gt;
    @@ -139,13 +139,6 @@ class MapTypeTest extends MapTypeTestBase {&lt;br/&gt;
       @Test&lt;br/&gt;
       def testMapOperations(): Unit = {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// comparison&lt;/li&gt;
	&lt;li&gt;testAllApis(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    That was my bad, I was only testing the invalid equality case ( e.g. `MAP&lt;span class=&quot;error&quot;&gt;&amp;#91;STRING, INT&amp;#93;&lt;/span&gt; = MAP&lt;span class=&quot;error&quot;&gt;&amp;#91;STRING,STRING&amp;#93;&lt;/span&gt;` should throw ValidationException), I did not put in the valid equality test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16269092" author="githubbot" created="Tue, 28 Nov 2017 17:31:20 +0000"  >&lt;p&gt;Github user walterddr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070#discussion_r153566048&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070#discussion_r153566048&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/calls/ScalarOperators.scala &amp;#8212;&lt;br/&gt;
    @@ -188,13 +188,6 @@ object ScalarOperators &lt;/p&gt;
{
             (leftTerm, rightTerm) =&amp;gt; s&quot;java.util.Arrays.equals($leftTerm, $rightTerm)&quot;
           }
&lt;p&gt;         }&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// map types&lt;/li&gt;
	&lt;li&gt;else if (isMap(left.resultType) &amp;amp;&amp;amp;&lt;/li&gt;
	&lt;li&gt;left.resultType.getTypeClass == right.resultType.getTypeClass) {&lt;/li&gt;
	&lt;li&gt;generateOperatorIfNotNull(nullCheck, BOOLEAN_TYPE_INFO, left, right) {&lt;/li&gt;
	&lt;li&gt;(leftTerm, rightTerm) =&amp;gt; s&quot;java.util.Map.equals($leftTerm, $rightTerm)&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I tried to use this but this is an exact object match, which is very different from `Array.equals`, which is indexed element match. so there&apos;s a problem here: &lt;br/&gt;
    1. an object referred on both the left and right hand side originally might become different object depending on the ser/deser (and they still represent the same Map); &lt;br/&gt;
    2. if two Map objects with exact same key and value pairs, they should be considered equal, however they are not equal under object match;&lt;br/&gt;
    3. it is also a debate on whether `Map` should be considered as ordered or unordered map.&lt;/p&gt;

&lt;p&gt;    I think this worth another PR to address.&lt;/p&gt;</comment>
                            <comment id="16270498" author="githubbot" created="Wed, 29 Nov 2017 09:45:18 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    `Map` does not provide an implementation for `equals`. However, `java.util.AbstractMap` does which is the base class for the commonly used Java maps including `HashMap`. Maybe we can add a case for `AbstractMap`?&lt;/p&gt;</comment>
                            <comment id="16271238" author="githubbot" created="Wed, 29 Nov 2017 17:56:52 +0000"  >&lt;p&gt;Github user walterddr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah. I see. `AbstractMap.equals` look very much similar to `Arrays.equals`. I will add it in and some more testings. thanks @fhueske for the great tips&lt;/p&gt;</comment>
                            <comment id="16271417" author="githubbot" created="Wed, 29 Nov 2017 19:37:21 +0000"  >&lt;p&gt;Github user walterddr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @twalthr I think my previous unit test method was not correct. Since TableAPI always use `java.util.HashMap` per flink documentation. I think it is safe to directly use `$leftTerm.equals($rightTerm)` and it should always be using `java.util.AbstractMap.equals` implementation. Do you think I should add extra check or do you think the `isMap(resultType)` should be suffice? &lt;/p&gt;</comment>
                            <comment id="16274580" author="githubbot" created="Fri, 1 Dec 2017 16:20:12 +0000"  >&lt;p&gt;Github user twalthr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @walterddr I think the current solution is sufficient for now. I will merge this...&lt;/p&gt;</comment>
                            <comment id="16274595" author="githubbot" created="Fri, 1 Dec 2017 16:37:57 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5070&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16274604" author="twalthr" created="Fri, 1 Dec 2017 16:40:34 +0000"  >&lt;p&gt;Fixed in 1.5: deea4b32bab4160e2279e9f57d7272df2d91e434&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3n6sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>