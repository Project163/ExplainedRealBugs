<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4113] Always copy first value in ChainedAllReduceDriver</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4113</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;ChainedAllReduceDriver.collect&lt;/tt&gt; must copy the first record even when object reuse is enabled or &lt;tt&gt;base&lt;/tt&gt; may later point to the same object as &lt;tt&gt;record&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12982393">FLINK-4113</key>
            <summary>Always copy first value in ChainedAllReduceDriver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="greghogan">Greg Hogan</assignee>
                                    <reporter username="greghogan">Greg Hogan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2016 16:36:27 +0000</created>
                <updated>Tue, 28 Jun 2016 08:46:38 +0000</updated>
                            <resolved>Tue, 28 Jun 2016 08:46:37 +0000</resolved>
                                    <version>1.0.4</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.0.4</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15347023" author="githubbot" created="Thu, 23 Jun 2016 19:25:25 +0000"  >&lt;p&gt;GitHub user greghogan opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4113&quot; title=&quot;Always copy first value in ChainedAllReduceDriver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4113&quot;&gt;&lt;del&gt;FLINK-4113&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Always copy first value in ChainedAllReduceDriver&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/greghogan/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/greghogan/flink&lt;/a&gt; 4113_always_copy_first_value_in_chainedallreducedriver&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2156&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f5f162b591b38e890758dc65fee93749ac86a347&lt;br/&gt;
Author: Greg Hogan &amp;lt;code@greghogan.com&amp;gt;&lt;br/&gt;
Date:   2016-06-23T16:37:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4113&quot; title=&quot;Always copy first value in ChainedAllReduceDriver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4113&quot;&gt;&lt;del&gt;FLINK-4113&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Always copy first value in ChainedAllReduceDriver&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15348342" author="zentol" created="Fri, 24 Jun 2016 14:26:02 +0000"  >&lt;p&gt;under which circumstances can this occur and why is it a problem?&lt;/p&gt;</comment>
                            <comment id="15348356" author="greghogan" created="Fri, 24 Jun 2016 14:35:57 +0000"  >&lt;p&gt;I experienced the problem when verifying the &lt;a href=&quot;https://github.com/apache/flink/pull/1967/files#diff-5af706cf3a08013de4ff97a440d2845bR194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HITS&lt;/a&gt; algorithm. With object reuse enabled the &lt;tt&gt;ChainedAllReduceDriver&lt;/tt&gt; was saving a reference to the first record emitted by my map function. My map then overwrote the object and the same reference was passed as the second value to my reduce function.&lt;/p&gt;</comment>
                            <comment id="15350808" author="githubbot" created="Mon, 27 Jun 2016 11:22:40 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156#discussion_r68560241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156#discussion_r68560241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/operators/chaining/ChainedAllReduceDriver.java &amp;#8212;&lt;br/&gt;
    @@ -89,7 +89,7 @@ public void collect(IT record) {&lt;br/&gt;
     		numRecordsIn.inc();&lt;br/&gt;
     		try {&lt;br/&gt;
     			if (base == null) &lt;/p&gt;
{
    -				base = objectReuseEnabled ? record : serializer.copy(record);
    +				base = serializer.copy(record);
     			}
&lt;p&gt; else {&lt;br/&gt;
     				base = objectReuseEnabled ? reducer.reduce(base, record) : serializer.copy(reducer.reduce(base, record));&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    What if we return the `record` as the result of `reducer.reduce` (with `objectReuseEnabled == true`)? That would also be problematic, right?&lt;/p&gt;</comment>
                            <comment id="15350810" author="githubbot" created="Mon, 27 Jun 2016 11:23:52 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good fix @greghogan. We should definitely include it in the upcoming release. Would it be possible to write a test to guard the fix from future changes?&lt;/p&gt;</comment>
                            <comment id="15350900" author="githubbot" created="Mon, 27 Jun 2016 12:18:57 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156#discussion_r68566231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156#discussion_r68566231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/operators/chaining/ChainedAllReduceDriver.java &amp;#8212;&lt;br/&gt;
    @@ -89,7 +89,7 @@ public void collect(IT record) {&lt;br/&gt;
     		numRecordsIn.inc();&lt;br/&gt;
     		try {&lt;br/&gt;
     			if (base == null) &lt;/p&gt;
{
    -				base = objectReuseEnabled ? record : serializer.copy(record);
    +				base = serializer.copy(record);
     			}
&lt;p&gt; else {&lt;br/&gt;
     				base = objectReuseEnabled ? reducer.reduce(base, record) : serializer.copy(reducer.reduce(base, record));&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We fixed this in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3340&quot; title=&quot;Fix object juggling in drivers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3340&quot;&gt;&lt;del&gt;FLINK-3340&lt;/del&gt;&lt;/a&gt; for non-chained reduce drivers (where the driver chooses the object to deserialize into) but for chained drivers we cannot prevent one UDF from overwriting an object from a previous UDF. If you look in &lt;tt&gt;OverwriteObjects.java&lt;/tt&gt; you will see &lt;tt&gt;testReduce&lt;/tt&gt; fail.&lt;/p&gt;</comment>
                            <comment id="15351395" author="githubbot" created="Mon, 27 Jun 2016 16:51:51 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann just added a test for `ChainedAllReduceDriver`. I didn&apos;t see a way to build a lightweight test for chained drivers as we do with the unchained drivers.&lt;/p&gt;</comment>
                            <comment id="15352593" author="githubbot" created="Tue, 28 Jun 2016 08:40:22 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156#discussion_r68718332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156#discussion_r68718332&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/operators/chaining/ChainedAllReduceDriver.java &amp;#8212;&lt;br/&gt;
    @@ -89,7 +89,7 @@ public void collect(IT record) {&lt;br/&gt;
     		numRecordsIn.inc();&lt;br/&gt;
     		try {&lt;br/&gt;
     			if (base == null) &lt;/p&gt;
{
    -				base = objectReuseEnabled ? record : serializer.copy(record);
    +				base = serializer.copy(record);
     			}
&lt;p&gt; else {&lt;br/&gt;
     				base = objectReuseEnabled ? reducer.reduce(base, record) : serializer.copy(reducer.reduce(base, record));&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Alright. I guess users then have to live with that if they enable object reuse.&lt;/p&gt;</comment>
                            <comment id="15352598" author="githubbot" created="Tue, 28 Jun 2016 08:43:06 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan the tests looks good. Thanks for your work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; The failing test cases are unrelated. Will merge this PR.&lt;/p&gt;</comment>
                            <comment id="15352605" author="till.rohrmann" created="Tue, 28 Jun 2016 08:46:37 +0000"  >&lt;p&gt;Fixed via a6feea32a328f3f3216960298d6c8a5d3f30a234&lt;/p&gt;</comment>
                            <comment id="15352606" author="githubbot" created="Tue, 28 Jun 2016 08:46:38 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2156&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zzfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>