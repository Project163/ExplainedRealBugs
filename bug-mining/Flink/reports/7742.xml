<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-37232] FLIP-272 breaks some synchronization assumption on the AdaptiveScheduler&apos;s side</title>
                <link>https://issues.apache.org/jira/browse/FLINK-37232</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We noticed some unexpected behavior with the AdaptiveScheduler causing a job to reach FAILED state due to &lt;tt&gt;NoResourceAvailableException&lt;/tt&gt;. The cause was that some TaskManager shut down while the job was performing a rescaling operation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; did a bit of digging and identified an issue with the state transition short cut that was introduced in &lt;a href=&quot;https://cwiki.apache.org/confluence/display/FLINK/FLIP-472%3A+Aligning+timeout+logic+in+the+AdaptiveScheduler%27s+WaitingForResources+and+Executing+states&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FLIP-472&lt;/a&gt; (ignoring &lt;tt&gt;WaitingForResources&lt;/tt&gt; when moving from &lt;tt&gt;Restarting&lt;/tt&gt; to &lt;tt&gt;CreatingExecutionGraph&lt;/tt&gt; as part of the rescale operation.&lt;/p&gt;

&lt;p&gt;The cause is that determining the parallelism for triggering the state transition from &lt;tt&gt;WaitingForResources&lt;/tt&gt; into &lt;tt&gt;CreatingExecutionGraph&lt;/tt&gt; is done in a single synchronous operation. No TM shutdown event can be processed in between. That leads to the &lt;tt&gt;determineParallelism&lt;/tt&gt; call never failing.&lt;/p&gt;

&lt;p&gt;With the FLIP-472 approach, we call determineParallelism twice independently from each other:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;When coming up with the rescale decision&lt;/li&gt;
	&lt;li&gt;When creating the ExecutionGraph after the job was cancelled.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In between the two operations, anything can happen, i.e. also TM shutdown events can be processed. That could lead to the second &lt;tt&gt;determineParallelism&lt;/tt&gt; call in the &lt;tt&gt;CreatingExecutionGraph&lt;/tt&gt; state transition to fail (due to resources not being available) which is not properly handled in the &lt;tt&gt;CreatingExecutionGraph#handleExecutionGraphCreation&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Right now, the expected behavior is that the &lt;tt&gt;determineParallelism&lt;/tt&gt; call succeeds and the subsequent slot allocation might fail. If the slot allocation fails, transitioning back to &lt;tt&gt;WaitingForResources&lt;/tt&gt; is performed.&lt;/p&gt;

&lt;p&gt;This behavior can be resolved in two ways:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Handle the &lt;tt&gt;NoResourceAvailableException&lt;/tt&gt; in the &lt;tt&gt;CreatingExecutionGraph&lt;/tt&gt; state&lt;/li&gt;
	&lt;li&gt;Pass the available VertexParallelism that lead to the rescale decision to the &lt;tt&gt;Restarting&lt;/tt&gt; state and check when the job is cancelled whether that parallelism changed. If it didn&apos;t change, we could transition to the &lt;tt&gt;CreatingExecutionGraph&lt;/tt&gt;. If it did change in the mean time, we should transition to &lt;tt&gt;WaitingForResources&lt;/tt&gt; and try waiting for the resources in another round.&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="13606466">FLINK-37232</key>
            <summary>FLIP-272 breaks some synchronization assumption on the AdaptiveScheduler&apos;s side</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ztison">Zdenek Tison</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 28 Jan 2025 10:26:35 +0000</created>
                <updated>Wed, 5 Feb 2025 07:25:53 +0000</updated>
                            <resolved>Wed, 5 Feb 2025 07:25:01 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0-preview</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17923772" author="mapohl" created="Tue, 4 Feb 2025 16:22:52 +0000"  >&lt;p&gt;master: &lt;a href=&quot;https://github.com/apache/flink/commit/5b1d0081b47a05fdd67b2ed89e1cc85dff196c73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5b1d0081b47a05fdd67b2ed89e1cc85dff196c73&lt;/a&gt;&lt;br/&gt;
2.0: &lt;a href=&quot;https://github.com/apache/flink/commit/1ff7433bcca8b3a2792df2e5a3b0b421bfe4ba4c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1ff7433bcca8b3a2792df2e5a3b0b421bfe4ba4c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2.0-preview-rc1 was skipped because it&apos;s just a milestone version of 2.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tvag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>