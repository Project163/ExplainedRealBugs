<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5229] Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails </title>
                <link>https://issues.apache.org/jira/browse/FLINK-5229</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Due to chaining, a &lt;tt&gt;StreamTask&lt;/tt&gt; needs to checkpoint multiple operators. If the first operators succeed in creating a checkpoint but a subsequent operator in the chain fails, the &lt;tt&gt;StreamTask&lt;/tt&gt; has to clean up the already completed checkpoints. Otherwise we might end up with orphaned state data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13025087">FLINK-5229</key>
            <summary>Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Dec 2016 13:53:53 +0000</created>
                <updated>Sun, 29 Jan 2017 14:42:24 +0000</updated>
                            <resolved>Tue, 24 Jan 2017 10:38:47 +0000</resolved>
                                    <version>1.1.3</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15715228" author="aljoscha" created="Fri, 2 Dec 2016 14:12:45 +0000"  >&lt;p&gt;@Till, this is already covered in this PR: &lt;a href=&quot;https://github.com/apache/flink/pull/2857&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2857&lt;/a&gt;. It&apos;s not marked as this because it came up while fixing another thing. Could you maybe have a look at the &lt;tt&gt;StreamTask&lt;/tt&gt; changes in there, I think this completely covers this issue.&lt;/p&gt;

&lt;p&gt;When merging the PR I will split those changes into a separate commit and tag it with this issue number.&lt;/p&gt;</comment>
                            <comment id="15715231" author="aljoscha" created="Fri, 2 Dec 2016 14:14:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srichter&quot; class=&quot;user-hover&quot; rel=&quot;srichter&quot;&gt;srichter&lt;/a&gt;, please correct me if I&apos;m wrong.&lt;/p&gt;</comment>
                            <comment id="15715296" author="githubbot" created="Fri, 2 Dec 2016 14:39:53 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2924&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2924&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5229&quot; title=&quot;Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5229&quot;&gt;&lt;del&gt;FLINK-5229&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tm&amp;#93;&lt;/span&gt; Discard completed checkpoints if a subsequent operator&apos;s checkpoint fails&lt;/p&gt;

&lt;p&gt;    In case of a failure of any StreamOperator#snapshotState method, all up to this point created&lt;br/&gt;
    StreamTaskStates will be discarded. This ensures that a failing checkpoint operation of a chained&lt;br/&gt;
    operator won&apos;t leave orphaned checkpoint data behind.&lt;/p&gt;

&lt;p&gt;    cc @uce, @StephanEwen.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixCheckpointCleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2924.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2924.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2924&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3ce8cec2cb3dc0c4979ab2cbe30dc1db8d988111&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-02T14:33:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5229&quot; title=&quot;Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5229&quot;&gt;&lt;del&gt;FLINK-5229&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tm&amp;#93;&lt;/span&gt; Discard completed checkpoints if a subsequent operator&apos;s checkpoint fails&lt;/p&gt;

&lt;p&gt;    In case of a failure of any StreamOperator#snapshotState method, all up to this point created&lt;br/&gt;
    StreamTaskStates are discarded. This ensures that a failing checkpoint operation of a chained&lt;br/&gt;
    operator won&apos;t leave orphaned checkpoint data behind.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15715405" author="till.rohrmann" created="Fri, 2 Dec 2016 15:26:40 +0000"  >&lt;p&gt;Thanks for the pointer &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;. The PR I&apos;ve opened is for the release-1.1 branch.&lt;/p&gt;

&lt;p&gt;I&apos;ve checked the PR and it looks as if some of the work has been done. However, it is not yet exhaustive (e.g. the non partitionable state handles are not discarded properly and the error reporting can be improved). I&apos;ll base my work in this branch then. So please don&apos;t split the commit up. &lt;/p&gt;</comment>
                            <comment id="15715800" author="githubbot" created="Fri, 2 Dec 2016 17:53:51 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2924&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2924&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Tested this with a job that fails during checkpointing and it works like a charm for both chained and non chained state, but I found another issue with discarding pending checkpoints. The task states map is cleared although it is given the async discarder. +1 to fix this related issue and merge this.&lt;/p&gt;</comment>
                            <comment id="15715821" author="githubbot" created="Fri, 2 Dec 2016 18:01:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2924&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2924&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for testing it @uce and @StephanEwen. Really good finding with the bug. I&apos;ll fix it and then I will merge the branch.&lt;/p&gt;</comment>
                            <comment id="15716049" author="githubbot" created="Fri, 2 Dec 2016 19:37:29 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2924&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2924&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15831850" author="githubbot" created="Fri, 20 Jan 2017 14:45:59 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5229&quot; title=&quot;Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5229&quot;&gt;&lt;del&gt;FLINK-5229&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;state&amp;#93;&lt;/span&gt; Cleanup of operator snapshots if subsequent operator snapshots fail&lt;/p&gt;

&lt;p&gt;    This PR is based on #3178.&lt;/p&gt;

&lt;p&gt;    This PR adds operator state cleanup to the StreamTask class. If a stream task contains multiple&lt;br/&gt;
    stream operators, then every operator is checkpointed. In case that a snapshot operation fails&lt;br/&gt;
    all state handles and OperatorSnapshotResults belonging to previous operators have to be freed.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; streamTaskCheckpointCleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3179&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c1a597320dbe3c7f4514297d5ad7f2b8f416e287&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-01T12:25:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; Clean up checkpoint data in case of a failing checkpoint operation&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. A failing&lt;br/&gt;
    snapshot operation will trigger the clean up of all so far generated state resources.&lt;br/&gt;
    This will avoid that in case of a failing snapshot operation resources (e.g. files) are&lt;br/&gt;
    left behind.&lt;/p&gt;

&lt;p&gt;    Add test case for OperatorSnapshotResult&lt;/p&gt;

&lt;p&gt;    Add StateSnapshotContextSynchronousImplTest&lt;/p&gt;

&lt;p&gt;    Add AbstractStreamOperator failing snapshot tests&lt;/p&gt;

&lt;p&gt;commit b407e812ccb9c727ee0df8d130b54a50abee5b06&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-01-20T13:28:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5229&quot; title=&quot;Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5229&quot;&gt;&lt;del&gt;FLINK-5229&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;state&amp;#93;&lt;/span&gt; Cleanup of operator snapshots if subsequent operator snapshots fail&lt;/p&gt;

&lt;p&gt;    This PR adds operator state cleanup to the StreamTask class. If a stream task contains multiple&lt;br/&gt;
    stream operators, then every operator is checkpointed. In case that a snapshot operation fails&lt;br/&gt;
    all state handles and OperatorSnapshotResults belonging to previous operators have to be freed.&lt;/p&gt;

&lt;p&gt;    Add test cases for failing checkpoint operations in StreamTask&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15834202" author="githubbot" created="Mon, 23 Jan 2017 10:11:07 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179#discussion_r97285679&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179#discussion_r97285679&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -954,6 +954,27 @@ public void run() &lt;/p&gt;
{
     							owner.getName(), checkpointMetaData.getCheckpointId(), asyncDurationMillis);
     				}
&lt;p&gt;     			} catch (Exception e) {&lt;br/&gt;
    +				// clean up ongoing operator snapshot results and non partitioned state handles&lt;br/&gt;
    +				for (OperatorSnapshotResult operatorSnapshotResult : snapshotInProgressList) {&lt;br/&gt;
    +					if (operatorSnapshotResult != null) {&lt;br/&gt;
    +						try &lt;/p&gt;
{
    +							operatorSnapshotResult.cancel();
    +						}
&lt;p&gt; catch (Exception cancelException) &lt;/p&gt;
{
    +							e.addSuppressed(cancelException);
    +						}
&lt;p&gt;    +					}&lt;br/&gt;
    +				}&lt;br/&gt;
    +&lt;br/&gt;
    +				for (StreamStateHandle nonPartitionedStateHandle : nonPartitionedStateHandles) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You could use the utility method `StateUtil.bestEffortDiscardAllStateObjects(...)` to reduce code duplication a bit.&lt;/p&gt;

&lt;p&gt;    I think we should also discard other state objects that completed fuctures could have created, e.g. `StateUtil.bestEffortDiscardAllStateObjects(operatorStatesBackend);` etc. , what do you think?&lt;/p&gt;
</comment>
                            <comment id="15834477" author="githubbot" created="Mon, 23 Jan 2017 13:21:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179#discussion_r97315623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179#discussion_r97315623&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -954,6 +954,27 @@ public void run() &lt;/p&gt;
{
     							owner.getName(), checkpointMetaData.getCheckpointId(), asyncDurationMillis);
     				}
&lt;p&gt;     			} catch (Exception e) {&lt;br/&gt;
    +				// clean up ongoing operator snapshot results and non partitioned state handles&lt;br/&gt;
    +				for (OperatorSnapshotResult operatorSnapshotResult : snapshotInProgressList) {&lt;br/&gt;
    +					if (operatorSnapshotResult != null) {&lt;br/&gt;
    +						try &lt;/p&gt;
{
    +							operatorSnapshotResult.cancel();
    +						}
&lt;p&gt; catch (Exception cancelException) &lt;/p&gt;
{
    +							e.addSuppressed(cancelException);
    +						}
&lt;p&gt;    +					}&lt;br/&gt;
    +				}&lt;br/&gt;
    +&lt;br/&gt;
    +				for (StreamStateHandle nonPartitionedStateHandle : nonPartitionedStateHandles) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes you&apos;re absolutely right. Will address your comments.&lt;/p&gt;</comment>
                            <comment id="15834478" author="githubbot" created="Mon, 23 Jan 2017 13:22:11 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @StefanRRichter. Will address your comments.&lt;/p&gt;</comment>
                            <comment id="15834532" author="githubbot" created="Mon, 23 Jan 2017 13:57:14 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179#discussion_r97321764&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179#discussion_r97321764&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -954,6 +954,27 @@ public void run() &lt;/p&gt;
{
     							owner.getName(), checkpointMetaData.getCheckpointId(), asyncDurationMillis);
     				}
&lt;p&gt;     			} catch (Exception e) {&lt;br/&gt;
    +				// clean up ongoing operator snapshot results and non partitioned state handles&lt;br/&gt;
    +				for (OperatorSnapshotResult operatorSnapshotResult : snapshotInProgressList) {&lt;br/&gt;
    +					if (operatorSnapshotResult != null) {&lt;br/&gt;
    +						try &lt;/p&gt;
{
    +							operatorSnapshotResult.cancel();
    +						}
&lt;p&gt; catch (Exception cancelException) &lt;/p&gt;
{
    +							e.addSuppressed(cancelException);
    +						}
&lt;p&gt;    +					}&lt;br/&gt;
    +				}&lt;br/&gt;
    +&lt;br/&gt;
    +				for (StreamStateHandle nonPartitionedStateHandle : nonPartitionedStateHandles) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Having a second look, I think the other state objects don&apos;t have to be cleaned up, because they are still owned by the corresponding `OperatorSnapshotResult` which is cleaned up in case of a failure or `close` operation.&lt;/p&gt;</comment>
                            <comment id="15834537" author="githubbot" created="Mon, 23 Jan 2017 13:59:05 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179#discussion_r97322137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179#discussion_r97322137&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -954,6 +954,27 @@ public void run() &lt;/p&gt;
{
     							owner.getName(), checkpointMetaData.getCheckpointId(), asyncDurationMillis);
     				}
&lt;p&gt;     			} catch (Exception e) {&lt;br/&gt;
    +				// clean up ongoing operator snapshot results and non partitioned state handles&lt;br/&gt;
    +				for (OperatorSnapshotResult operatorSnapshotResult : snapshotInProgressList) {&lt;br/&gt;
    +					if (operatorSnapshotResult != null) {&lt;br/&gt;
    +						try &lt;/p&gt;
{
    +							operatorSnapshotResult.cancel();
    +						}
&lt;p&gt; catch (Exception cancelException) &lt;/p&gt;
{
    +							e.addSuppressed(cancelException);
    +						}
&lt;p&gt;    +					}&lt;br/&gt;
    +				}&lt;br/&gt;
    +&lt;br/&gt;
    +				for (StreamStateHandle nonPartitionedStateHandle : nonPartitionedStateHandles) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Agreed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15834538" author="githubbot" created="Mon, 23 Jan 2017 13:59:40 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve addressed your comments @StefanRRichter. Note that I did not add the additional state object cleanup, because it was already done by cancelling the `OperatorSnapshotResults`.&lt;/p&gt;</comment>
                            <comment id="15834842" author="githubbot" created="Mon, 23 Jan 2017 16:34:24 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3179&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15835933" author="aljoscha" created="Tue, 24 Jan 2017 09:56:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; can this be closed now or are you waiting until it&apos;s merged on release-1.2?&lt;/p&gt;</comment>
                            <comment id="15835987" author="till.rohrmann" created="Tue, 24 Jan 2017 10:38:47 +0000"  >&lt;p&gt;1.3.0: cfb95b9074a05686f5ad290b2aaa4be89536a35b&lt;br/&gt;
1.2.0: 840b779c542462cf7bd4bed40620dd68e90ec6bd&lt;br/&gt;
1.1.4: 020da2ce1c8be83789252d0db959896a761d7513&lt;/p&gt;</comment>
                            <comment id="15837735" author="rmetzger" created="Wed, 25 Jan 2017 13:30:31 +0000"  >&lt;p&gt;I&apos;m seeing the following exceptions in my 1.2.0 RC1 code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2017-01-25 12:47:48,775 WARN  org.apache.flink.streaming.runtime.tasks.StreamTask           - Could not properly clean up the async checkpoint runnable.
java.lang.Exception: Could not properly cancel managed &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; state &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.
        at org.apache.flink.streaming.api.operators.OperatorSnapshotResult.cancel(OperatorSnapshotResult.java:99)
        at org.apache.flink.streaming.runtime.tasks.StreamTask$AsyncCheckpointRunnable.cleanup(StreamTask.java:992)
        at org.apache.flink.streaming.runtime.tasks.StreamTask$AsyncCheckpointRunnable.close(StreamTask.java:979)
        at org.apache.flink.util.IOUtils.closeQuietly(IOUtils.java:224)
        at org.apache.flink.util.AbstractCloseableRegistry.close(AbstractCloseableRegistry.java:92)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.cancel(StreamTask.java:363)
        at org.apache.flink.runtime.taskmanager.Task$TaskCanceler.run(Task.java:1384)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.NullPointerException
        at org.apache.flink.runtime.state.StateUtil.discardStateFuture(StateUtil.java:81)
        at org.apache.flink.streaming.api.operators.OperatorSnapshotResult.cancel(OperatorSnapshotResult.java:97)
        ... 7 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m asking here because its code that has been touched while addressing this JIRA.&lt;/p&gt;

&lt;p&gt;How critical is this?&lt;/p&gt;</comment>
                            <comment id="15837740" author="till.rohrmann" created="Wed, 25 Jan 2017 13:32:51 +0000"  >&lt;p&gt;Should be fixed. Apparently, there are state handle futures which contain &lt;tt&gt;null&lt;/tt&gt; values.&lt;/p&gt;</comment>
                            <comment id="15837748" author="till.rohrmann" created="Wed, 25 Jan 2017 13:39:39 +0000"  >&lt;p&gt;Will be addressed with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5643&quot; title=&quot;StateUtil.discardStateFuture fails when state future contains null value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5643&quot;&gt;&lt;del&gt;FLINK-5643&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15837750" author="rmetzger" created="Wed, 25 Jan 2017 13:42:34 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i372rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>