<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5158] Handle ZooKeeperCompletedCheckpointStore exceptions in CheckpointCoordinator</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5158</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The checkpoint coordinator does not properly handle exceptions when trying to store completed checkpoints. As a result, completed checkpoints are not properly cleaned up and even worse, the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt; might get stuck stopping triggering checkpoints.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13023233">FLINK-5158</key>
            <summary>Handle ZooKeeperCompletedCheckpointStore exceptions in CheckpointCoordinator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Nov 2016 16:15:13 +0000</created>
                <updated>Fri, 9 Dec 2016 16:52:34 +0000</updated>
                            <resolved>Fri, 9 Dec 2016 16:51:54 +0000</resolved>
                                    <version>1.1.3</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15696175" author="githubbot" created="Fri, 25 Nov 2016 15:58:40 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2872&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5158&quot; title=&quot;Handle ZooKeeperCompletedCheckpointStore exceptions in CheckpointCoordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5158&quot;&gt;&lt;del&gt;FLINK-5158&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ckPtCoord&amp;#93;&lt;/span&gt; Handle exceptions from CompletedCheckpointStore in CheckpointCoordinator&lt;/p&gt;

&lt;p&gt;    Handle exceptions from the CompletedCheckpointStore properly in the CheckpointCoordinator. This&lt;br/&gt;
    means that in case of an exception, the completed checkpoint will be properly cleaned up and also&lt;br/&gt;
    the triggering of subsequent checkpoints will be started.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixCheckpointCoordinatorExceptionHandling&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2872.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2872.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2872&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 063a696b4eb5a259c714818c0b0ba5cc883a596d&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-24T17:16:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5158&quot; title=&quot;Handle ZooKeeperCompletedCheckpointStore exceptions in CheckpointCoordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5158&quot;&gt;&lt;del&gt;FLINK-5158&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ckPtCoord&amp;#93;&lt;/span&gt; Handle exceptions from CompletedCheckpointStore in CheckpointCoordinator&lt;/p&gt;

&lt;p&gt;    Handle exceptions from the CompletedCheckpointStore properly in the CheckpointCoordinator. This&lt;br/&gt;
    means that in case of an exception, the completed checkpoint will be properly cleaned up and also&lt;br/&gt;
    the triggering of subsequent checkpoints will be started.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15696217" author="githubbot" created="Fri, 25 Nov 2016 16:19:01 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;backport&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5158&quot; title=&quot;Handle ZooKeeperCompletedCheckpointStore exceptions in CheckpointCoordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5158&quot;&gt;&lt;del&gt;FLINK-5158&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ckPtCoord&amp;#93;&lt;/span&gt; Handle exceptions from CompletedCheckpointStore in CheckpointCoordinator&lt;/p&gt;

&lt;p&gt;    Backport of the #2872 for the release 1.1 branch.&lt;/p&gt;

&lt;p&gt;    Handle exceptions from the CompletedCheckpointStore properly in the CheckpointCoordinator. This&lt;br/&gt;
    means that in case of an exception, the completed checkpoint will be properly cleaned up and also&lt;br/&gt;
    the triggering of subsequent checkpoints will be started.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; backportFixCheckpointCoordinatorExceptionHandling&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2873&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c68c08f7b478f354a5c432f8640a344dcf553190&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-24T17:16:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5158&quot; title=&quot;Handle ZooKeeperCompletedCheckpointStore exceptions in CheckpointCoordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5158&quot;&gt;&lt;del&gt;FLINK-5158&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ckPtCoord&amp;#93;&lt;/span&gt; Handle exceptions from CompletedCheckpointStore in CheckpointCoordinator&lt;/p&gt;

&lt;p&gt;    Handle exceptions from the CompletedCheckpointStore properly in the CheckpointCoordinator. This&lt;br/&gt;
    means that in case of an exception, the completed checkpoint will be properly cleaned up and also&lt;br/&gt;
    the triggering of subsequent checkpoints will be started.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15702214" author="githubbot" created="Mon, 28 Nov 2016 15:23:19 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @uce if we want to include this into the release 1.1 branch, then we could merge it. The problem has been reported by Twitter.&lt;/p&gt;</comment>
                            <comment id="15708911" author="githubbot" created="Wed, 30 Nov 2016 15:46:09 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873#discussion_r90258796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873#discussion_r90258796&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -731,46 +700,100 @@ public boolean receiveAcknowledgeMessage(AcknowledgeCheckpoint message) throws E&lt;/p&gt;

&lt;p&gt;     						discardState(message.getState());&lt;br/&gt;
     				}&lt;br/&gt;
    +&lt;br/&gt;
    +				return true;&lt;br/&gt;
     			}&lt;br/&gt;
     			else if (checkpoint != null) &lt;/p&gt;
{
     				// this should not happen
     				throw new IllegalStateException(
     						&quot;Received message for discarded but non-removed checkpoint &quot; + checkpointId);
     			}
&lt;p&gt;     			else {&lt;br/&gt;
    +				boolean wasPendingCheckpoint;&lt;br/&gt;
    +&lt;br/&gt;
     				// message is for an unknown checkpoint, or comes too late (checkpoint disposed)&lt;br/&gt;
     				if (recentPendingCheckpoints.contains(checkpointId)) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;isPendingCheckpoint = true;&lt;br/&gt;
    +					wasPendingCheckpoint = true;&lt;br/&gt;
     					LOG.warn(&quot;Received late message for now expired checkpoint attempt {}.&quot;, checkpointId);&lt;br/&gt;
     				}&lt;br/&gt;
     				else {&lt;br/&gt;
     					LOG.debug(&quot;Received message for an unknown checkpoint {}.&quot;, checkpointId);&lt;/li&gt;
	&lt;li&gt;isPendingCheckpoint = false;&lt;br/&gt;
    +					wasPendingCheckpoint = false;&lt;br/&gt;
     				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				// try to discard the state so that we don&apos;t have lingering state lying around&lt;br/&gt;
     				discardState(message.getState());&lt;br/&gt;
    +&lt;br/&gt;
    +				return wasPendingCheckpoint;&lt;br/&gt;
    +			}&lt;br/&gt;
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private void completePendingCheckpoint(PendingCheckpoint pendingCheckpoint) throws CheckpointException {&lt;br/&gt;
    +		final long checkpointId = pendingCheckpoint.getCheckpointId();&lt;br/&gt;
    +		CompletedCheckpoint completedCheckpoint = null;&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			completedCheckpoint = pendingCheckpoint.finalizeCheckpoint();
    +
    +			completedCheckpointStore.addCheckpoint(completedCheckpoint);
    +
    +			rememberRecentCheckpointId(checkpointId);
    +			dropSubsumedCheckpoints(completedCheckpoint.getTimestamp());
    +
    +			onFullyAcknowledgedCheckpoint(completedCheckpoint);
    +		}
&lt;p&gt; catch (Exception exception) {&lt;br/&gt;
    +			// abort the current pending checkpoint if it has not been discarded yet&lt;br/&gt;
    +			if(!pendingCheckpoint.isDiscarded()) &lt;/p&gt;
{
    +				pendingCheckpoint.discard(userClassLoader);
    +			}
&lt;p&gt;    +&lt;br/&gt;
    +			if (completedCheckpoint != null) {&lt;br/&gt;
    +				// we failed to store the completed checkpoint. Let&apos;s clean up&lt;br/&gt;
    +				final CompletedCheckpoint cc = completedCheckpoint;&lt;br/&gt;
    +&lt;br/&gt;
    +				executor.execute(new Runnable() {&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public void run() {&lt;br/&gt;
    +						try &lt;/p&gt;
{
    +							cc.discard(userClassLoader);
    +						}
&lt;p&gt; catch (Exception nestedException) {&lt;br/&gt;
    +							LOG.warn(&quot;Could not properly discard completed checkpoint {}.&quot;, cc.getCheckpointID(), nestedException);&lt;br/&gt;
    +						}&lt;br/&gt;
    +					}&lt;br/&gt;
    +				});&lt;br/&gt;
     			}&lt;br/&gt;
    +&lt;br/&gt;
    +			throw new CheckpointException(&quot;Could not complete the pending checkpoint &quot; + checkpointId + &apos;.&apos;, exception);&lt;br/&gt;
    +		} finally &lt;/p&gt;
{
    +			pendingCheckpoints.remove(checkpointId);
    +
    +			triggerQueuedRequests();
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		LOG.info(&quot;Completed checkpoint {} (in {} ms).&quot;, checkpointId, completedCheckpoint.getDuration());&lt;br/&gt;
    +&lt;br/&gt;
    +		if (LOG.isDebugEnabled()) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    While rebasing you have to make sure to copy the updated string builder here&lt;/p&gt;</comment>
                            <comment id="15708912" author="githubbot" created="Wed, 30 Nov 2016 15:46:09 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873#discussion_r90258544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873#discussion_r90258544&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -731,46 +700,100 @@ public boolean receiveAcknowledgeMessage(AcknowledgeCheckpoint message) throws E&lt;/p&gt;

&lt;p&gt;     						discardState(message.getState());&lt;br/&gt;
     				}&lt;br/&gt;
    +&lt;br/&gt;
    +				return true;&lt;br/&gt;
     			}&lt;br/&gt;
     			else if (checkpoint != null) &lt;/p&gt;
{
     				// this should not happen
     				throw new IllegalStateException(
     						&quot;Received message for discarded but non-removed checkpoint &quot; + checkpointId);
     			}
&lt;p&gt;     			else {&lt;br/&gt;
    +				boolean wasPendingCheckpoint;&lt;br/&gt;
    +&lt;br/&gt;
     				// message is for an unknown checkpoint, or comes too late (checkpoint disposed)&lt;br/&gt;
     				if (recentPendingCheckpoints.contains(checkpointId)) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;isPendingCheckpoint = true;&lt;br/&gt;
    +					wasPendingCheckpoint = true;&lt;br/&gt;
     					LOG.warn(&quot;Received late message for now expired checkpoint attempt {}.&quot;, checkpointId);&lt;br/&gt;
     				}&lt;br/&gt;
     				else {&lt;br/&gt;
     					LOG.debug(&quot;Received message for an unknown checkpoint {}.&quot;, checkpointId);&lt;/li&gt;
	&lt;li&gt;isPendingCheckpoint = false;&lt;br/&gt;
    +					wasPendingCheckpoint = false;&lt;br/&gt;
     				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				// try to discard the state so that we don&apos;t have lingering state lying around&lt;br/&gt;
     				discardState(message.getState());&lt;br/&gt;
    +&lt;br/&gt;
    +				return wasPendingCheckpoint;&lt;br/&gt;
    +			}&lt;br/&gt;
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private void completePendingCheckpoint(PendingCheckpoint pendingCheckpoint) throws CheckpointException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Missing JavaDocs, maybe add that this needs to be called in checkpoint lock scope&lt;/p&gt;</comment>
                            <comment id="15708913" author="githubbot" created="Wed, 30 Nov 2016 15:46:09 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873#discussion_r90258638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873#discussion_r90258638&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -731,46 +700,100 @@ public boolean receiveAcknowledgeMessage(AcknowledgeCheckpoint message) throws E&lt;/p&gt;

&lt;p&gt;     						discardState(message.getState());&lt;br/&gt;
     				}&lt;br/&gt;
    +&lt;br/&gt;
    +				return true;&lt;br/&gt;
     			}&lt;br/&gt;
     			else if (checkpoint != null) &lt;/p&gt;
{
     				// this should not happen
     				throw new IllegalStateException(
     						&quot;Received message for discarded but non-removed checkpoint &quot; + checkpointId);
     			}
&lt;p&gt;     			else {&lt;br/&gt;
    +				boolean wasPendingCheckpoint;&lt;br/&gt;
    +&lt;br/&gt;
     				// message is for an unknown checkpoint, or comes too late (checkpoint disposed)&lt;br/&gt;
     				if (recentPendingCheckpoints.contains(checkpointId)) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;isPendingCheckpoint = true;&lt;br/&gt;
    +					wasPendingCheckpoint = true;&lt;br/&gt;
     					LOG.warn(&quot;Received late message for now expired checkpoint attempt {}.&quot;, checkpointId);&lt;br/&gt;
     				}&lt;br/&gt;
     				else {&lt;br/&gt;
     					LOG.debug(&quot;Received message for an unknown checkpoint {}.&quot;, checkpointId);&lt;/li&gt;
	&lt;li&gt;isPendingCheckpoint = false;&lt;br/&gt;
    +					wasPendingCheckpoint = false;&lt;br/&gt;
     				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				// try to discard the state so that we don&apos;t have lingering state lying around&lt;br/&gt;
     				discardState(message.getState());&lt;br/&gt;
    +&lt;br/&gt;
    +				return wasPendingCheckpoint;&lt;br/&gt;
    +			}&lt;br/&gt;
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private void completePendingCheckpoint(PendingCheckpoint pendingCheckpoint) throws CheckpointException {&lt;br/&gt;
    +		final long checkpointId = pendingCheckpoint.getCheckpointId();&lt;br/&gt;
    +		CompletedCheckpoint completedCheckpoint = null;&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			completedCheckpoint = pendingCheckpoint.finalizeCheckpoint();
    +
    +			completedCheckpointStore.addCheckpoint(completedCheckpoint);
    +
    +			rememberRecentCheckpointId(checkpointId);
    +			dropSubsumedCheckpoints(completedCheckpoint.getTimestamp());
    +
    +			onFullyAcknowledgedCheckpoint(completedCheckpoint);
    +		}
&lt;p&gt; catch (Exception exception) {&lt;br/&gt;
    +			// abort the current pending checkpoint if it has not been discarded yet&lt;br/&gt;
    +			if(!pendingCheckpoint.isDiscarded()) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    missing whitespace after if&lt;/p&gt;</comment>
                            <comment id="15708914" author="githubbot" created="Wed, 30 Nov 2016 15:46:09 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873#discussion_r90257889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873#discussion_r90257889&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -651,64 +651,33 @@ public boolean receiveDeclineMessage(DeclineCheckpoint message) {&lt;br/&gt;
     	 *&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@throws Exception If the checkpoint cannot be added to the completed checkpoint store.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public boolean receiveAcknowledgeMessage(AcknowledgeCheckpoint message) throws Exception {&lt;br/&gt;
    +	public boolean receiveAcknowledgeMessage(AcknowledgeCheckpoint message) throws CheckpointException {&lt;br/&gt;
     		if (shutdown || message == null) 
{
     			return false;
     		}
&lt;p&gt;     		if (!job.equals(message.getJob())) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;LOG.error(&quot;Received AcknowledgeCheckpoint message for wrong job: {}&quot;, message);&lt;br/&gt;
    +			LOG.error(&quot;Received wrong AcknowledgeCheckpoint message for job {}: {}&quot;, job, message);&lt;br/&gt;
     			return false;&lt;br/&gt;
     		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		final long checkpointId = message.getCheckpointId();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CompletedCheckpoint completed = null;&lt;/li&gt;
	&lt;li&gt;PendingCheckpoint checkpoint;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// Flag indicating whether the ack message was for a known pending&lt;/li&gt;
	&lt;li&gt;// checkpoint.&lt;/li&gt;
	&lt;li&gt;boolean isPendingCheckpoint;&lt;br/&gt;
    -&lt;br/&gt;
     		synchronized (lock) {&lt;br/&gt;
     			// we need to check inside the lock for being shutdown as well, otherwise we&lt;br/&gt;
     			// get races and invalid error log messages&lt;br/&gt;
     			if (shutdown) 
{
     				return false;
     			}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;checkpoint = pendingCheckpoints.get(checkpointId);&lt;br/&gt;
    +			final PendingCheckpoint checkpoint = pendingCheckpoints.get(checkpointId);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     			if (checkpoint != null &amp;amp;&amp;amp; !checkpoint.isDiscarded()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;isPendingCheckpoint = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				switch (checkpoint.acknowledgeTask(message.getTaskExecutionId(), message.getState(), message.getStateSize(), null)) {&lt;br/&gt;
     					case SUCCESS:&lt;br/&gt;
     						// TODO: Give KV-state to the acknowledgeTask method&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Unrelated, but could you remove this TODO since this has been addressed for 1.2, but probably won&apos;t be addressed in 1.1&lt;/p&gt;</comment>
                            <comment id="15712467" author="githubbot" created="Thu, 1 Dec 2016 16:56:53 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @uce. I have addressed your comments.&lt;/p&gt;</comment>
                            <comment id="15732764" author="githubbot" created="Thu, 8 Dec 2016 17:08:17 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2872&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Forwarding @uce&apos;s review from the backport to this PR.&lt;/p&gt;

&lt;p&gt;    Rebasing on the latest master and if Travis gives green light, then I will merge this PR.&lt;/p&gt;</comment>
                            <comment id="15735350" author="githubbot" created="Fri, 9 Dec 2016 13:44:19 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2872&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    `ScalaShellITCase` hung in the failing travis build. Merging...&lt;/p&gt;</comment>
                            <comment id="15735763" author="githubbot" created="Fri, 9 Dec 2016 16:48:21 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15735771" author="till.rohrmann" created="Fri, 9 Dec 2016 16:51:54 +0000"  >&lt;p&gt;Fixed in 1.2.0 via 0c42d258e9d9d30eeeee7d0f1487ef0ac8b90fa4&lt;br/&gt;
Fixed in 1.1.4 via 4b734d7b8726200e5293c32f2cb9e8c77db4d378&lt;/p&gt;</comment>
                            <comment id="15735774" author="githubbot" created="Fri, 9 Dec 2016 16:52:34 +0000"  >&lt;p&gt;Github user tillrohrmann closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2873&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36rbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>