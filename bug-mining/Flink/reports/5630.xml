<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:58:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23322] RMQSourceITCase.testStopWithSavepoint fails on azure due to timeout</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23322</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20196&amp;amp;view=logs&amp;amp;j=d44f43ce-542c-597d-bf94-b0718c71e5e8&amp;amp;t=03dca39c-73e8-5aaf-601d-328ae5c35f20&amp;amp;l=13696&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20196&amp;amp;view=logs&amp;amp;j=d44f43ce-542c-597d-bf94-b0718c71e5e8&amp;amp;t=03dca39c-73e8-5aaf-601d-328ae5c35f20&amp;amp;l=13696&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 41.237 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.streaming.connectors.rabbitmq.RMQSourceITCase
[ERROR] testStopWithSavepoint(org.apache.flink.streaming.connectors.rabbitmq.RMQSourceITCase)  Time elapsed: 7.609 s  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.util.concurrent.TimeoutException
	at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:77)
	at com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:120)
	at com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:36)
	at com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:502)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:326)
	at com.rabbitmq.client.impl.recovery.RecoveryAwareAMQConnectionFactory.newConnection(RecoveryAwareAMQConnectionFactory.java:64)
	at com.rabbitmq.client.impl.recovery.AutorecoveringConnection.init(AutorecoveringConnection.java:156)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:1130)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:1087)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:1045)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:1207)
	at org.apache.flink.streaming.connectors.rabbitmq.RMQSourceITCase.getRMQConnection(RMQSourceITCase.java:133)
	at org.apache.flink.streaming.connectors.rabbitmq.RMQSourceITCase.setUp(RMQSourceITCase.java:82)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:24)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.testcontainers.containers.FailureDetectingExternalResource$1.evaluate(FailureDetectingExternalResource.java:30)
at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13388514">FLINK-23322</key>
            <summary>RMQSourceITCase.testStopWithSavepoint fails on azure due to timeout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fpaul">Fabian Paul</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 9 Jul 2021 02:07:27 +0000</created>
                <updated>Wed, 15 Dec 2021 01:40:24 +0000</updated>
                            <resolved>Thu, 29 Jul 2021 15:31:10 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.13.1</version>
                    <version>1.12.4</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.3</fixVersion>
                    <fixVersion>1.12.8</fixVersion>
                                    <component>Connectors/ RabbitMQ</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17377701" author="xintongsong" created="Fri, 9 Jul 2021 02:08:36 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmick&quot; class=&quot;user-hover&quot; rel=&quot;cmick&quot;&gt;cmick&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17378038" author="cmick" created="Fri, 9 Jul 2021 12:31:43 +0000"  >&lt;p&gt;Most probably the RMQ container did not start on time, causing the connection init in the test to fail.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpaul&quot; class=&quot;user-hover&quot; rel=&quot;fpaul&quot;&gt;fpaul&lt;/a&gt; since you&apos;re the assignee - do you need any help on that matter?&lt;/p&gt;</comment>
                            <comment id="17378041" author="fabian.paul" created="Fri, 9 Jul 2021 12:45:17 +0000"  >&lt;p&gt;I briefly checked the logs found the following line.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 22:07:26,427 [AMQP Connection 172.17.0.1:59470] WARN  com.rabbitmq.client.impl.ForgivingExceptionHandler           [] - An unexpected connection driver error occured (Exception message: Socket closed)
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When reading through the RMQ connection code it seems that the default connection timeout should be 60 seconds which in general seems very fair. I enabled additional logging in the PR to see the output of the container. Currently, I do not have an immediate idea what is causing this problem otherwise.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmick&quot; class=&quot;user-hover&quot; rel=&quot;cmick&quot;&gt;cmick&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17378047" author="cmick" created="Fri, 9 Jul 2021 12:57:37 +0000"  >&lt;p&gt;I think it&apos;s 10 seconds by default in this case (com.rabbitmq.client.ConnectionFactory.DEFAULT_HANDSHAKE_TIMEOUT). I&apos;m able to get the same error locally when I set the handshakeTimeout (&lt;font color=&quot;#000000&quot;&gt;factory&lt;/font&gt;.setHandshakeTimeout) to some really low values (below 50ms in my case). Still 10s should be more than enough. I will try to look at more closely today.&lt;/p&gt;</comment>
                            <comment id="17378320" author="cmick" created="Fri, 9 Jul 2021 21:44:31 +0000"  >&lt;p&gt;I&apos;ve had a closer look and found out in com.rabbitmq.client.impl.AMQConnection.java#L326 (causing trouble here) that the timeout for a single RPC is actually set to half of the handshakeTimeout:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(AMQP.Connection.Start) connStartBlocker.getReply(handshakeTimeout/2).getMethod();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In result the timeout is actually 5 seconds (not 10 as I thought initially). Some more docs here: &lt;a href=&quot;https://www.rabbitmq.com/networking.html#handshake-timeout&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.rabbitmq.com/networking.html#handshake-timeout&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So probably it will not hurt to increase the default value from 10 seconds to 20 or 30 seconds. Just need to add &lt;tt&gt;factory.setHandshakeTimeout(20000);&lt;/tt&gt; in RMQSourceITCase.getRMQConnection.&lt;/p&gt;

&lt;p&gt;Of course, adding logging is a great idea. Without it, it is hard to say what had happened.&lt;/p&gt;
</comment>
                            <comment id="17383119" author="fabian.paul" created="Mon, 19 Jul 2021 07:55:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmick&quot; class=&quot;user-hover&quot; rel=&quot;cmick&quot;&gt;cmick&lt;/a&gt;&#160;thanks for your suggestion I updated the PR to increase the handshake timeout can you take a look?&lt;/p&gt;</comment>
                            <comment id="17389974" author="fabian.paul" created="Thu, 29 Jul 2021 15:31:11 +0000"  >&lt;p&gt;master:&#160;1562a211697aa200bbaf8f61511d44d6e4ee3c24&lt;/p&gt;

&lt;p&gt;release-1.13:&#160;8a7e53af959522082fc666b9e4cb7a3727c00524&lt;/p&gt;

&lt;p&gt;release-1.12:&#160;4e14b3f6bea21da0a24b62dbfda9c1b9459a11a9&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13379137">FLINK-22698</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0sr5s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>