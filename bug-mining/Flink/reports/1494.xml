<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5762] Protect initializeState() and open() by the same lock.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5762</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently the initializeState() of all operators in a task is called without the checkpoint lock, and before the open(). This may lead to problematic situations as the following:&lt;/p&gt;

&lt;p&gt;In the case that we retrieve timers from a checkpoint, e.g. WindowOperator and (future) CEP, if we re-register them in the initializeState(), then if they fire before the open() of the downstream operators is called, we will have a task failure, as the downstream channels are not open.&lt;/p&gt;

&lt;p&gt;To avoid this, we can put the initializeState() in the same lock as the open(), and the two operations will happen while being protected by the same lock, which also keeps timers from firing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13041730">FLINK-5762</key>
            <summary>Protect initializeState() and open() by the same lock.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkl0u">Kostas Kloudas</assignee>
                                    <reporter username="kkl0u">Kostas Kloudas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Feb 2017 15:01:20 +0000</created>
                <updated>Tue, 14 Feb 2017 14:52:52 +0000</updated>
                            <resolved>Tue, 14 Feb 2017 14:52:48 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15859634" author="aljoscha" created="Thu, 9 Feb 2017 15:12:36 +0000"  >&lt;p&gt;+1 &lt;/p&gt;</comment>
                            <comment id="15859763" author="githubbot" created="Thu, 9 Feb 2017 16:38:46 +0000"  >&lt;p&gt;GitHub user kl0u opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5762&quot; title=&quot;Protect initializeState() and open() by the same lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5762&quot;&gt;&lt;del&gt;FLINK-5762&lt;/del&gt;&lt;/a&gt; Protect initializeState() and open() by the same lock&lt;/p&gt;

&lt;p&gt;    The description is in the related jira: &lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5762&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-5762&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kl0u/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kl0u/flink&lt;/a&gt; init-state-lock&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3291.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3291.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3291&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3b2806895a433a1cf87bda43dd50fd102d2e9b6d&lt;br/&gt;
Author: kl0u &amp;lt;kkloudas@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-02-09T15:02:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5762&quot; title=&quot;Protect initializeState() and open() by the same lock.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5762&quot;&gt;&lt;del&gt;FLINK-5762&lt;/del&gt;&lt;/a&gt; Protect initializeState() and open() by the same lock&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15859874" author="githubbot" created="Thu, 9 Feb 2017 17:39:16 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think this works for now.&lt;/p&gt;

&lt;p&gt;    What would be great is in the long run to actually start the timer service only in/after open() so that timers that are registered cannot fire.&lt;/p&gt;

&lt;p&gt;    That way we can make all the state initialization more eager and avoid also all the misleading null errors logged when cancellation happens too early.&lt;/p&gt;</comment>
                            <comment id="15865560" author="githubbot" created="Tue, 14 Feb 2017 10:44:22 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging this...&lt;/p&gt;</comment>
                            <comment id="15865561" author="githubbot" created="Tue, 14 Feb 2017 10:45:10 +0000"  >&lt;p&gt;Github user kl0u commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks a lot @StephanEwen !&lt;/p&gt;</comment>
                            <comment id="15865880" author="githubbot" created="Tue, 14 Feb 2017 14:49:56 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3291&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15865893" author="stephanewen" created="Tue, 14 Feb 2017 14:52:48 +0000"  >&lt;p&gt;Fixed via a91b6ff05d8af870ad076f9bf0fc17886787bc46&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39uo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>