<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4485] Finished jobs in yarn session fill /tmp filesystem</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4485</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;On a Yarn cluster I start a yarn-session with a few containers and task slots.&lt;br/&gt;
Then I fire a &apos;large&apos; number of Flink batch jobs in sequence against this yarn session. It is the exact same job (java code) yet it gets different parameters.&lt;/p&gt;

&lt;p&gt;In this scenario it is exporting HBase tables to files in HDFS and the parameters are about which data from which tables and the name of the target directory.&lt;/p&gt;

&lt;p&gt;After running several dozen jobs the jobs submission started to fail and we investigated.&lt;/p&gt;

&lt;p&gt;We found that the cause was that on the Yarn node which was hosting the jobmanager the /tmp file system was full (4GB was 100% full).&lt;/p&gt;

&lt;p&gt;How ever the output of &lt;tt&gt;du -hcs /tmp&lt;/tt&gt; showed only 200MB in use.&lt;/p&gt;

&lt;p&gt;We found that a very large file (we guess it is the jar of the job) was put in /tmp , used, deleted yet the file handle was not closed by the jobmanager.&lt;/p&gt;

&lt;p&gt;As soon as we killed the jobmanager the disk space was freed.&lt;/p&gt;

&lt;p&gt;The summary of the impact of this is that a yarn-session that receives enough jobs brings down the Yarn node for all users.&lt;/p&gt;

&lt;p&gt;See parts of the output we got from &lt;tt&gt;lsof&lt;/tt&gt; below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COMMAND     PID      USER   FD      TYPE             DEVICE      SIZE       NODE NAME
java      15034   nbasjes  550r      REG             253,17  66219695        245 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000003 (deleted)
java      15034   nbasjes  551r      REG             253,17  66219695        252 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000007 (deleted)
java      15034   nbasjes  552r      REG             253,17  66219695        267 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000012 (deleted)
java      15034   nbasjes  553r      REG             253,17  66219695        250 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000005 (deleted)
java      15034   nbasjes  554r      REG             253,17  66219695        288 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000018 (deleted)
java      15034   nbasjes  555r      REG             253,17  66219695        298 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000025 (deleted)
java      15034   nbasjes  557r      REG             253,17  66219695        254 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000008 (deleted)
java      15034   nbasjes  558r      REG             253,17  66219695        292 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000019 (deleted)
java      15034   nbasjes  559r      REG             253,17  66219695        275 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000013 (deleted)
java      15034   nbasjes  560r      REG             253,17  66219695        159 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000002 (deleted)
java      15034   nbasjes  562r      REG             253,17  66219695        238 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000001 (deleted)
java      15034   nbasjes  568r      REG             253,17  66219695        246 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000004 (deleted)
java      15034   nbasjes  569r      REG             253,17  66219695        255 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000009 (deleted)
java      15034   nbasjes  571r      REG             253,17  66219695        299 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000026 (deleted)
java      15034   nbasjes  572r      REG             253,17  66219695        293 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000020 (deleted)
java      15034   nbasjes  574r      REG             253,17  66219695        256 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000010 (deleted)
java      15034   nbasjes  575r      REG             253,17  66219695        302 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000029 (deleted)
java      15034   nbasjes  576r      REG             253,17  66219695        294 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000021 (deleted)
java      15034   nbasjes  577r      REG             253,17  66219695        262 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000011 (deleted)
java      15034   nbasjes  578r      REG             253,17  66219695        251 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000006 (deleted)
java      15034   nbasjes  580r      REG             253,17  66219695        295 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000022 (deleted)
java      15034   nbasjes  581r      REG             253,17  66219695        300 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000027 (deleted)
java      15034   nbasjes  582r      REG             253,17  66219695        188 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/cache/blob_e318d1698aa6e7dc91e5f4a9f8ba29781aebd8c4 (deleted)
java      15034   nbasjes  585r      REG             253,17  66219695        279 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000014 (deleted)
java      15034   nbasjes  586r      REG             253,17  66219695        296 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000023 (deleted)
java      15034   nbasjes  588r      REG             253,17  66219695        301 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000028 (deleted)
java      15034   nbasjes  589r      REG             253,17  66219695        297 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000024 (deleted)
java      15034   nbasjes  598r      REG             253,17  66219695        280 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000015 (deleted)
java      15034   nbasjes  601r      REG             253,17  66219695        289 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000016 (deleted)
java      15034   nbasjes  604r      REG             253,17  66219695        284 /tmp/blobStore-fbe9c4cf-1f85-48cb-aad9-180e8d4ec7ce/incoming/temp-00000017 (deleted)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13000003">FLINK-4485</key>
            <summary>Finished jobs in yarn session fill /tmp filesystem</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="nielsbasjes">Niels Basjes</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Aug 2016 13:04:42 +0000</created>
                <updated>Thu, 28 Feb 2019 14:02:02 +0000</updated>
                            <resolved>Sat, 24 Sep 2016 11:58:59 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.3</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15436917" author="nielsbasjes" created="Thu, 25 Aug 2016 14:04:13 +0000"  >&lt;p&gt;I just reproduced the effect on a non-secure Yarn cluster.&lt;br/&gt;
After having run a few jobs I see this on the node where the jobmanager runs:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[root@node1 ~]# lsof | fgrep &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/blobStore&apos;&lt;/span&gt;
java      15358          yarn  mem       REG                8,3  70243224   25936270 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/cache/blob_501262b25ff9158ff07ee1f4264b5e3afeaaf69f
java      15358          yarn  DEL       REG                8,3             25936269 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000027
java      15358          yarn  DEL       REG                8,3             25936268 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000026
java      15358          yarn  DEL       REG                8,3             25936267 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000025
java      15358          yarn  DEL       REG                8,3             25936266 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000024
java      15358          yarn  DEL       REG                8,3             25936265 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000023
java      15358          yarn  DEL       REG                8,3             25936264 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000022
java      15358          yarn  DEL       REG                8,3             25936263 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000021
java      15358          yarn  DEL       REG                8,3             25936258 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000020
java      15358          yarn  DEL       REG                8,3             25936257 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000019
java      15358          yarn  DEL       REG                8,3             25936260 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000018
java      15358          yarn  DEL       REG                8,3             25936259 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000017
java      15358          yarn  DEL       REG                8,3             25936256 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000016
java      15358          yarn  DEL       REG                8,3             25936255 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000015
java      15358          yarn  DEL       REG                8,3             25936254 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000014
java      15358          yarn  DEL       REG                8,3             25936253 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000013
java      15358          yarn  DEL       REG                8,3             25936252 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000012
java      15358          yarn  DEL       REG                8,3             25936251 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000011
java      15358          yarn  DEL       REG                8,3             25936250 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000010
java      15358          yarn  DEL       REG                8,3             25936249 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000009
java      15358          yarn  DEL       REG                8,3             25936248 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000008
java      15358          yarn  DEL       REG                8,3             25936247 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000007
java      15358          yarn  DEL       REG                8,3             25936246 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000006
java      15358          yarn  DEL       REG                8,3             25936244 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000005
java      15358          yarn  DEL       REG                8,3             25936222 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000004
java      15358          yarn  DEL       REG                8,3             25936221 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000003
java      15358          yarn  DEL       REG                8,3             25936220 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000002
java      15358          yarn  DEL       REG                8,3             25936215 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000001
java      15358          yarn  422r      REG                8,3  70243224   25936222 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000004 (deleted)
java      15358          yarn  581u      REG                8,3  70243224   25936265 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000023 (deleted)
java      15358          yarn  582u      REG                8,3  70243224   25936267 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000025 (deleted)
java      15358          yarn  583r      REG                8,3  70243224   25936246 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000006 (deleted)
java      15358          yarn  584r      REG                8,3  70243224   25936215 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000001 (deleted)
java      15358          yarn  590u      REG                8,3  70243224   25936266 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000024 (deleted)
java      15358          yarn  591r      REG                8,3  70243224   25936220 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000002 (deleted)
java      15358          yarn  593r      REG                8,3  70243224   25936221 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000003 (deleted)
java      15358          yarn  594u      REG                8,3  70243224   25936268 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000026 (deleted)
java      15358          yarn  595u      REG                8,3  70243224   25936270 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/cache/blob_501262b25ff9158ff07ee1f4264b5e3afeaaf69f
java      15358          yarn  597r      REG                8,3  70243224   25936255 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000015 (deleted)
java      15358          yarn  598u      REG                8,3  70243224   25936269 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000027 (deleted)
java      15358          yarn  599r      REG                8,3  70243224   25936252 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000012 (deleted)
java      15358          yarn  600r      REG                8,3  70243224   25936250 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000010 (deleted)
java      15358          yarn  601r      REG                8,3  70243224   25936254 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000014 (deleted)
java      15358          yarn  602r      REG                8,3  70243224   25936244 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000005 (deleted)
java      15358          yarn  603r      REG                8,3  70243224   25936259 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000017 (deleted)
java      15358          yarn  604r      REG                8,3  70243224   25936248 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000008 (deleted)
java      15358          yarn  605r      REG                8,3  70243224   25936260 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000018 (deleted)
java      15358          yarn  607r      REG                8,3  70243224   25936257 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000019 (deleted)
java      15358          yarn  608r      REG                8,3  70243224   25936258 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000020 (deleted)
java      15358          yarn  609r      REG                8,3  70243224   25936263 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000021 (deleted)
java      15358          yarn  610r      REG                8,3  70243224   25936264 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000022 (deleted)
java      15358          yarn  613r      REG                8,3  70243224   25936247 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000007 (deleted)
java      15358          yarn  617r      REG                8,3  70243224   25936253 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000013 (deleted)
java      15358          yarn  618r      REG                8,3  70243224   25936251 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000011 (deleted)
java      15358          yarn  619r      REG                8,3  70243224   25936249 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000009 (deleted)
java      15358          yarn  631r      REG                8,3  70243224   25936256 /tmp/blobStore-0864a537-f6fa-4b27-9b7f-8cb5a3722c3e/incoming/temp-00000016 (deleted)
java      15454          yarn  mem       REG                8,3  70243224   25936219 /tmp/blobStore-087a0b08-ee59-4d21-8523-c78a79984a4a/cache/blob_501262b25ff9158ff07ee1f4264b5e3afeaaf69f
java      15454          yarn  490r      REG                8,3  70243224   25936219 /tmp/blobStore-087a0b08-ee59-4d21-8523-c78a79984a4a/cache/blob_501262b25ff9158ff07ee1f4264b5e3afeaaf69f
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The two process ids you see here are:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;yarn     15358  4.9  0.3 1362160 431128 ?      Sl   15:24   1:52  |       \_ /usr/lib/jvm/jre/bin/java -Xmx424M -Dlog.file=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/hadoop-yarn/containers/application_1464009968005_2639/container_1464009968005_2639_01_000001/jobmanager.log -Dlogback.configurationFile=file:logback.xml -Dlog4j.configuration=file:log4j.properties org.apache.flink.yarn.YarnApplicationMasterRunner&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;yarn     15454 10.1  0.6 1306404 801228 ?      Sl   15:24   3:51          \_ /usr/lib/jvm/jre/bin/java -Xms424m -Xmx424m -XX:MaxDirectMemorySize=424m -Dlog.file=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/hadoop-yarn/containers/application_1464009968005_2639/container_1464009968005_2639_01_000002/taskmanager.log -Dlogback.configurationFile=file:./logback.xml -Dlog4j.configuration=file:./log4j.properties org.apache.flink.yarn.YarnTaskManager --configDir .&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


</comment>
                            <comment id="15445296" author="stephanewen" created="Mon, 29 Aug 2016 08:56:45 +0000"  >&lt;p&gt;Thanks for opening this and analyzing it so thoroughly.&lt;br/&gt;
Do you have a patch ready? If not, we&apos;ll try to address this in the next days...&lt;/p&gt;</comment>
                            <comment id="15445374" author="nielsbasjes" created="Mon, 29 Aug 2016 09:33:02 +0000"  >&lt;p&gt;No, I had a quick look at the code and I could not find where the file handle was opened that should be closed along with the delete.&lt;/p&gt;</comment>
                            <comment id="15445385" author="mxm" created="Mon, 29 Aug 2016 09:39:36 +0000"  >&lt;p&gt;Thanks for reportig &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nielsbasjes&quot; class=&quot;user-hover&quot; rel=&quot;nielsbasjes&quot;&gt;nielsbasjes&lt;/a&gt;. It could have to do with Flink keeping the user classloader after job completion which we changed recently. The classloader probably holds a reference to all its supplied files. Did you make changes to the number of old jobs to keep? The default is 5 but it can be adjusted.&lt;/p&gt;</comment>
                            <comment id="15445493" author="rmetzger" created="Mon, 29 Aug 2016 10:28:12 +0000"  >&lt;p&gt;I looked a bit into the issue because I&apos;m wondering whether we want to include the fix into the 1.1.2 release.&lt;/p&gt;

&lt;p&gt;So to me it seems that the &lt;tt&gt;BlobLibraryCacheManager&lt;/tt&gt; is doing everything as expected.&lt;br/&gt;
I wonder whether we need to close the URLClassloader when removing the job from the JobManager.&lt;/p&gt;</comment>
                            <comment id="15445495" author="rmetzger" created="Mon, 29 Aug 2016 10:28:48 +0000"  >&lt;p&gt;Sorry, I didn&apos;t refresh before writing a comment.&lt;/p&gt;</comment>
                            <comment id="15446104" author="nielsbasjes" created="Mon, 29 Aug 2016 14:56:47 +0000"  >&lt;p&gt;I didn&apos;t change that setting.&lt;br/&gt;
In the web UI I see only the last 5 jobs that ran and it shows 26 jobs completed and 2 failed.&lt;/p&gt;

&lt;p&gt;When I look at the lsof output I see 28 open files with the status &apos;deleted&apos; (see previous comment).&lt;br/&gt;
The last of those jobs finished about 4 days ago (before the weekend) and the files are still open.&lt;/p&gt;</comment>
                            <comment id="15446231" author="mxm" created="Mon, 29 Aug 2016 15:46:07 +0000"  >&lt;p&gt;Thanks for the update. That&apos;s very important information. Have you ran a similar amount of jobs with 1.0.x and experienced this problem?&lt;/p&gt;

&lt;p&gt;In theory, the classloader of old jobs should be discarded when the ExecutionGraph is removed from the archive (after 5 new jobs have bee submitted). Perhaps we hold another reference to the Classloader in the Web UI which prevents it from getting garbage collected.&lt;/p&gt;</comment>
                            <comment id="15452155" author="nielsbasjes" created="Wed, 31 Aug 2016 12:51:17 +0000"  >&lt;p&gt;Today I tried to reproduce this problem with the wordcount example and there this problem does not occur.&lt;/p&gt;</comment>
                            <comment id="15452166" author="mxm" created="Wed, 31 Aug 2016 12:54:40 +0000"  >&lt;p&gt;Interesting. But it occurs consistently with your other jobs?&lt;/p&gt;</comment>
                            <comment id="15455755" author="nielsbasjes" created="Thu, 1 Sep 2016 15:22:54 +0000"  >&lt;p&gt;I have tried to create a minimal application that reproduces the problem I see.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Get flink 1.1.1 scala 2.10 binary for Linux.&lt;/li&gt;
	&lt;li&gt;Manually update yarn-session.sh to the latest in master to fix the HBase classpath issue.&lt;/li&gt;
	&lt;li&gt;Make sure you have HBase running and configured properly (i.e. HBASE_CONF_DIR and HADOOP_CONF_DIR are setup correctly in your environment).&lt;/li&gt;
	&lt;li&gt;Create a table called &lt;tt&gt;test&lt;/tt&gt; in HBase with at least 1 row in it.&lt;/li&gt;
	&lt;li&gt;Start &lt;tt&gt;./flink-1.1.1/bin/yarn-session.sh -n2 -s5 -d&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Get this test project and build it: &lt;a href=&quot;https://github.com/nielsbasjes/Reproduce-FLINK-4485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nielsbasjes/Reproduce-FLINK-4485&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Then run this jar file with something like &lt;tt&gt;./flink-1.1.1/bin/flink run target/&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4485&quot; title=&quot;Finished jobs in yarn session fill /tmp filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4485&quot;&gt;&lt;del&gt;FLINK-4485&lt;/del&gt;&lt;/a&gt;-1.0-SNAPSHOT.jar&lt;/tt&gt; several times.&lt;/li&gt;
	&lt;li&gt;Now when you do on the Hadoop node running the jobmanager &lt;tt&gt;lsof | fgrep blob&lt;/tt&gt; you should see the deleted files as shown before.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This reproduction path works on my machine ...&lt;/p&gt;

</comment>
                            <comment id="15457967" author="mxm" created="Fri, 2 Sep 2016 08:47:47 +0000"  >&lt;p&gt;Thanks a lot for the minimal example to reproduce the issue. We will reproduce and fix the issue as soon as possible.&lt;/p&gt;</comment>
                            <comment id="15490009" author="nielsbasjes" created="Wed, 14 Sep 2016 09:59:44 +0000"  >&lt;p&gt;Have you been able to reproduce the problem with the test application I wrote?&lt;/p&gt;</comment>
                            <comment id="15492595" author="mxm" created="Thu, 15 Sep 2016 07:03:31 +0000"  >&lt;p&gt;Yes, I was able to reproduce the problem with your test application yesterday. Checked out the relevant code and I think I&apos;m on to something.&lt;/p&gt;</comment>
                            <comment id="15493019" author="githubbot" created="Thu, 15 Sep 2016 11:04:15 +0000"  >&lt;p&gt;GitHub user mxm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4485&quot; title=&quot;Finished jobs in yarn session fill /tmp filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4485&quot;&gt;&lt;del&gt;FLINK-4485&lt;/del&gt;&lt;/a&gt; close and remove user class loader after job completion&lt;/p&gt;

&lt;p&gt;    Keeping the user class loader around after job completion may lead to&lt;br/&gt;
    excessive temp space usage because all user jars are kept until the&lt;br/&gt;
    class loader is garbage collected. Tests showed that garbage collection&lt;br/&gt;
    can be delayed for a long time after the class loader is not referenced&lt;br/&gt;
    anymore. Note that for the class loader to not be referenced anymore,&lt;br/&gt;
    its job has to be removed from the archive.&lt;/p&gt;

&lt;p&gt;    The fastest way to minimize temp space usage is to close and remove the&lt;br/&gt;
    URLClassloader after job completion. This requires us to keep a&lt;br/&gt;
    serializable copy of all data which needs the user class loader after&lt;br/&gt;
    job completion, e.g. to display data on the web interface.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mxm/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4485&quot; title=&quot;Finished jobs in yarn session fill /tmp filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4485&quot;&gt;&lt;del&gt;FLINK-4485&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2499&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6ed17b9f5b9c13c80200ccf3db82bbfe727830bb&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-09-15T09:00:58Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4485&quot; title=&quot;Finished jobs in yarn session fill /tmp filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4485&quot;&gt;&lt;del&gt;FLINK-4485&lt;/del&gt;&lt;/a&gt; close and remove user class loader after job completion&lt;/p&gt;

&lt;p&gt;    Keeping the user class loader around after job completion may lead to&lt;br/&gt;
    excessive temp space usage because all user jars are kept until the&lt;br/&gt;
    class loader is garbage collected. Tests showed that garbage collection&lt;br/&gt;
    can be delayed for a long time after the class loader is not referenced&lt;br/&gt;
    anymore. Note that for the class loader to not be referenced anymore,&lt;br/&gt;
    its job has to be removed from the archive.&lt;/p&gt;

&lt;p&gt;    The fastest way to minimize temp space usage is to close and remove the&lt;br/&gt;
    URLClassloader after job completion. This requires us to keep a&lt;br/&gt;
    serializable copy of all data which needs the user class loader after&lt;br/&gt;
    job completion, e.g. to display data on the web interface.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15494047" author="githubbot" created="Thu, 15 Sep 2016 17:39:31 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks food to me.&lt;/p&gt;

&lt;p&gt;    +1 to merge&lt;/p&gt;</comment>
                            <comment id="15495900" author="githubbot" created="Fri, 16 Sep 2016 10:00:07 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks! Just a few words to @nielsbasjes who reported the issue. I&apos;ve tested the fix using the test instructions you provided. Even before this fix, I could get rid of the temp files by forcing a manual garbage collection on the JVM, using `jcmd &amp;lt;pid&amp;gt; GC.run`. However, that only worked once the job meta data had been removed from the archive, i.e. it doesn&apos;t show up in the web interface anymore. With this fix, the class loader is cleared upon job completion and the files are immediately removed. `lsof | fgrep blob_` didn&apos;t show any of these files anymore.&lt;/p&gt;

&lt;p&gt;    Note, that we don&apos;t perform any cleanup on the TaskManager side. There we also wind up with some left over files but they don&apos;t seem to pile up. It must be that the garbage collector can figure out when to clean much earlier. Plus, we don&apos;t keep a reference to old Task instances like we do for the web interface on the JobManager side.&lt;/p&gt;

&lt;p&gt;    @StephanEwen I&apos;m thinking about adding a similar fix for the TaskManager side. What do you think?&lt;/p&gt;</comment>
                            <comment id="15495910" author="githubbot" created="Fri, 16 Sep 2016 10:05:57 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    What would the fix for the TaskManager look like? Simply explicitly closing the UserCodeClassloader, or does it need more?&lt;/p&gt;</comment>
                            <comment id="15495940" author="githubbot" created="Fri, 16 Sep 2016 10:21:03 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen Yes, it is simple. I just pushed a commit. This now releases all temp files after job completion.&lt;/p&gt;</comment>
                            <comment id="15503940" author="githubbot" created="Mon, 19 Sep 2016 16:39:50 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me.&lt;/p&gt;

&lt;p&gt;    +1 to merge when tests pass&lt;/p&gt;</comment>
                            <comment id="15513129" author="githubbot" created="Thu, 22 Sep 2016 12:17:47 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This needed another fix because in some tests we use the system class loader instead of a class loader instantiated by the BlobLibraryCacheManager. If we close that one, we cause tests to fail. The solution is to close only `FlinkUserCodeClassLoader`s.&lt;/p&gt;</comment>
                            <comment id="15513131" author="githubbot" created="Thu, 22 Sep 2016 12:18:05 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging after tests pass.&lt;/p&gt;</comment>
                            <comment id="15518924" author="githubbot" created="Sat, 24 Sep 2016 11:49:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2499&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15518937" author="mxm" created="Sat, 24 Sep 2016 11:58:59 +0000"  >&lt;p&gt;master: 4a8e94403fb48318561a3cf2da57ba9da280949e&lt;br/&gt;
release-1.1: 62c666f5794fa211bf570874b1b77044fd6840ac&lt;/p&gt;</comment>
                            <comment id="15518941" author="mxm" created="Sat, 24 Sep 2016 12:01:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nielsbasjes&quot; class=&quot;user-hover&quot; rel=&quot;nielsbasjes&quot;&gt;nielsbasjes&lt;/a&gt; Let me know if there are any more problems with the temp space.&lt;/p&gt;</comment>
                            <comment id="15549036" author="nielsbasjes" created="Wed, 5 Oct 2016 15:13:46 +0000"  >&lt;p&gt;I did a run with the latest &apos;master&apos; and I ran over 80 jobs on a secured cluster without any problems.&lt;br/&gt;
Looks fixed to me.&lt;/p&gt;</comment>
                            <comment id="15549140" author="mxm" created="Wed, 5 Oct 2016 15:56:02 +0000"  >&lt;p&gt;Great to hear! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32s7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>