<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30168] PyFlink Deserialization Error with Object Array</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30168</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When it is attempted to collect object array records from a DataStream in PyFlink, an exception like follows would be thrown&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
data = 0, field_type = DenseVectorTypeInfo
def pickled_bytes_to_python_converter(data, field_type):&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; isinstance(field_type, RowTypeInfo):
row_kind = RowKind(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;.from_bytes(data[0], &lt;span class=&quot;code-quote&quot;&gt;&apos;little&apos;&lt;/span&gt;))
data = zip(list(data[1:]), field_type.get_field_types())
fields = []&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; d, d_type in data:
fields.append(pickled_bytes_to_python_converter(d, d_type))
row = Row.of_kind(row_kind, *fields)&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rowelse:
&amp;gt; data = pickle.loads(data)
E TypeError: a bytes-like object is required, not &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I found that this error is invoked because PyFlink deals with object arrays differently on Java side and Python side.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;On Java side (org.apache.flink.api.common.python.PythonBridgeUtils.getPickledBytesFromJavaObject)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataType &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; BasicArrayTypeInfo || dataType &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PrimitiveArrayTypeInfo) {
# recursively deal with array elements
} ...
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
# ObjectArrayTypeInfo is here
TypeSerializer serializer = dataType.createSerializer(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;); ByteArrayOutputStreamWithPos baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStreamWithPos(); DataOutputViewStreamWrapper baosWrapper = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataOutputViewStreamWrapper(baos); serializer.serialize(obj, baosWrapper); &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pickler.dumps(baos.toByteArray());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;On python side(pyflink.datastream.utils.pickled_bytes_to_python_converter)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
elif isinstance(field_type,
(BasicArrayTypeInfo, PrimitiveArrayTypeInfo, ObjectArrayTypeInfo)):
  element_type = field_type._element_type
  elements = []
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; element_bytes in data:
    elements.append(pickled_bytes_to_python_converter(element_bytes, element_type))
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; elements&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thus a possible fix for this bug is to align PyFlink&apos;s behavior on Java side and Python side.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13505522">FLINK-30168</key>
            <summary>PyFlink Deserialization Error with Object Array</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianfu">Dian Fu</assignee>
                                    <reporter username="yunfengzhou">Yunfeng Zhou</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 23 Nov 2022 11:52:00 +0000</created>
                <updated>Mon, 16 Jan 2023 01:43:05 +0000</updated>
                            <resolved>Mon, 16 Jan 2023 01:43:05 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.15.2</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.16.1</fixVersion>
                    <fixVersion>1.15.4</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17641051" author="yunfengzhou" created="Wed, 30 Nov 2022 03:53:10 +0000"  >&lt;p&gt;Apart from the proposed solution mentioned in the Description section, PyFlink needs to modify its behavior against None values as well. For example, the following code in&#160;PythonBridgeUtils.getPickledBytesFromJavaObject&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[0];
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;might be modified into&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pickler.dumps(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17657083" author="dianfu" created="Wed, 11 Jan 2023 05:26:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunfengzhou&quot; class=&quot;user-hover&quot; rel=&quot;yunfengzhou&quot;&gt;yunfengzhou&lt;/a&gt; Could you share some code snippets which could reproduce the above issues?&lt;/p&gt;</comment>
                            <comment id="17675771" author="yunfengzhou" created="Thu, 12 Jan 2023 01:39:25 +0000"  >&lt;p&gt;Thanks for the reminding. Here are the code snippets that could be used to reproduce the above issues. I reproduced the errors with these codes in Flink 1.15.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; unittest

from pyflink.common &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Types
from pyflink.datastream &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamExecutionEnvironment
from pyflink.table &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamTableEnvironment


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PyFlinkTest(unittest.TestCase):
    def setUp(self) -&amp;gt; None:
        self.env = StreamExecutionEnvironment.get_execution_environment()
        self.t_env = StreamTableEnvironment.create(self.env)

    def test_object_array(self):
        double_arrays = [
            ([0.0, 0.0],),
            ([0.0, 1.0],),
        ]

        input_table = self.t_env.from_data_stream(
            self.env.from_collection(
                double_arrays,
                type_info=Types.ROW_NAMED(
                    [&lt;span class=&quot;code-quote&quot;&gt;&apos;f0&apos;&lt;/span&gt;],
                    [Types.OBJECT_ARRAY(Types.DOUBLE())]
                )
            )
        )

        input_table.print_schema()

        print([x &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; x in self.t_env.to_data_stream(input_table).execute_and_collect()])

    def test_none(self):
        string_array_with_none = [
            ([&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;], ),
            ([None, ], )
        ]

        input_table = self.t_env.from_data_stream(
            self.env.from_collection(
                string_array_with_none,
                type_info=Types.ROW_NAMED(
                    [&lt;span class=&quot;code-quote&quot;&gt;&apos;f0&apos;&lt;/span&gt;, ],
                    [Types.OBJECT_ARRAY(Types.STRING()), ]
                )
            )
        )

        input_table.print_schema()

        print([x &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; x in self.t_env.to_data_stream(input_table).execute_and_collect()])

 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17675779" author="dianfu" created="Thu, 12 Jan 2023 02:08:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunfengzhou&quot; class=&quot;user-hover&quot; rel=&quot;yunfengzhou&quot;&gt;yunfengzhou&lt;/a&gt; Thanks a lot &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17677112" author="dianfu" created="Mon, 16 Jan 2023 01:43:05 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via&#160;46757739cf50c1e7b7305a4bc9cf779bb1945a1f&lt;/li&gt;
	&lt;li&gt;release-1.16 via&#160;46c91ed4bc22e2de3a662d52b11ade8ed64dba0b&lt;/li&gt;
	&lt;li&gt;release-1.15 via&#160;cdecc21cad9f78b1555a0e2f5d7f1398949e7193&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1cnp4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>