<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:46:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17189] Table with processing time attribute can not be read from Hive catalog</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17189</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;DDL:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE PROD_LINEITEM (
  L_ORDERKEY       INTEGER,
  L_PARTKEY        INTEGER,
  L_SUPPKEY        INTEGER,
  L_LINENUMBER     INTEGER,
  L_QUANTITY       DOUBLE,
  L_EXTENDEDPRICE  DOUBLE,
  L_DISCOUNT       DOUBLE,
  L_TAX            DOUBLE,
  L_CURRENCY       STRING,
  L_RETURNFLAG     STRING,
  L_LINESTATUS     STRING,
  L_ORDERTIME      TIMESTAMP(3),
  L_SHIPINSTRUCT   STRING,
  L_SHIPMODE       STRING,
  L_COMMENT        STRING,
  WATERMARK FOR L_ORDERTIME AS L_ORDERTIME - INTERVAL &lt;span class=&quot;code-quote&quot;&gt;&apos;5&apos;&lt;/span&gt; MINUTE,
  L_PROCTIME       AS PROCTIME()
) WITH (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.version&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;universal&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;Lineitem&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.properties.zookeeper.connect&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;not-needed&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka:9092&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.startup-mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;earliest-offset&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format.type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;csv&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format.field-delimiter&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT * FROM prod_lineitem;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Could not execute SQL statement. Reason:
java.lang.AssertionError: Conversion to relational algebra failed to preserve datatypes:
validated type:
RecordType(INTEGER L_ORDERKEY, INTEGER L_PARTKEY, INTEGER L_SUPPKEY, INTEGER L_LINENUMBER, DOUBLE L_QUANTITY, DOUBLE L_EXTENDEDPRICE, DOUBLE L_DISCOUNT, DOUBLE L_TAX, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_CURRENCY, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_RETURNFLAG, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_LINESTATUS, TIME ATTRIBUTE(ROWTIME) L_ORDERTIME, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_SHIPINSTRUCT, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_SHIPMODE, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_COMMENT, TIMESTAMP(3) NOT NULL L_PROCTIME) NOT NULL
converted type:
RecordType(INTEGER L_ORDERKEY, INTEGER L_PARTKEY, INTEGER L_SUPPKEY, INTEGER L_LINENUMBER, DOUBLE L_QUANTITY, DOUBLE L_EXTENDEDPRICE, DOUBLE L_DISCOUNT, DOUBLE L_TAX, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_CURRENCY, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_RETURNFLAG, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_LINESTATUS, TIME ATTRIBUTE(ROWTIME) L_ORDERTIME, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_SHIPINSTRUCT, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_SHIPMODE, VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; L_COMMENT, TIME ATTRIBUTE(PROCTIME) NOT NULL L_PROCTIME) NOT NULL
rel:
LogicalProject(L_ORDERKEY=[$0], L_PARTKEY=[$1], L_SUPPKEY=[$2], L_LINENUMBER=[$3], L_QUANTITY=[$4], L_EXTENDEDPRICE=[$5], L_DISCOUNT=[$6], L_TAX=[$7], L_CURRENCY=[$8], L_RETURNFLAG=[$9], L_LINESTATUS=[$10], L_ORDERTIME=[$11], L_SHIPINSTRUCT=[$12], L_SHIPMODE=[$13], L_COMMENT=[$14], L_PROCTIME=[$15])
  LogicalWatermarkAssigner(rowtime=[L_ORDERTIME], watermark=[-($11, 300000:INTERVAL MINUTE)])
    LogicalProject(L_ORDERKEY=[$0], L_PARTKEY=[$1], L_SUPPKEY=[$2], L_LINENUMBER=[$3], L_QUANTITY=[$4], L_EXTENDEDPRICE=[$5], L_DISCOUNT=[$6], L_TAX=[$7], L_CURRENCY=[$8], L_RETURNFLAG=[$9], L_LINESTATUS=[$10], L_ORDERTIME=[$11], L_SHIPINSTRUCT=[$12], L_SHIPMODE=[$13], L_COMMENT=[$14], L_PROCTIME=[PROCTIME()])
      LogicalTableScan(table=[[hcat, &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, prod_lineitem, source: [KafkaTableSource(L_ORDERKEY, L_PARTKEY, L_SUPPKEY, L_LINENUMBER, L_QUANTITY, L_EXTENDEDPRICE, L_DISCOUNT, L_TAX, L_CURRENCY, L_RETURNFLAG, L_LINESTATUS, L_ORDERTIME, L_SHIPINSTRUCT, L_SHIPMODE, L_COMMENT)]]])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13298802">FLINK-17189</key>
            <summary>Table with processing time attribute can not be read from Hive catalog</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lzljs3620320">Jingsong Lee</assignee>
                                    <reporter username="twalthr">Timo Walther</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 16 Apr 2020 12:30:45 +0000</created>
                <updated>Fri, 16 Oct 2020 10:55:16 +0000</updated>
                            <resolved>Tue, 26 May 2020 05:35:40 +0000</resolved>
                                    <version>1.10.1</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Ecosystem</component>
                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17087390" author="lirui" created="Mon, 20 Apr 2020 05:59:42 +0000"  >&lt;p&gt;The root cause is that &lt;tt&gt;TimestampKind&lt;/tt&gt; is not encoded into the serializable string of &lt;tt&gt;TimestampType&lt;/tt&gt;, &lt;tt&gt;LocalZonedTimestampType&lt;/tt&gt; and &lt;tt&gt;ZonedTimestampType&lt;/tt&gt;. In &lt;tt&gt;HiveCatalog&lt;/tt&gt;, the table schema of a generic table is serialized using a &lt;tt&gt;DescriptorProperties&lt;/tt&gt; which in turn relies on the serializable strings of logical types. Now since &lt;tt&gt;TimestampKind&lt;/tt&gt; is missing, &lt;tt&gt;HiveCatalog&lt;/tt&gt; is unable to properly deserialize the table schema and thus the error.&lt;/p&gt;

&lt;p&gt;I tried including &lt;tt&gt;TimestampKind&lt;/tt&gt; in &lt;tt&gt;DescriptorProperties&lt;/tt&gt;, e.g. by calling &lt;tt&gt;LogicalType::asSummaryString&lt;/tt&gt; instead of &lt;tt&gt;LogicalType::asSerializableString&lt;/tt&gt; and that fixes the issue. But I&apos;m not sure whether that&apos;s the way to go, because it seems &lt;tt&gt;TimestampKind&lt;/tt&gt; is excluded from the serializable string by design.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; what do you think is the right way to fix the issue?&lt;/p&gt;</comment>
                            <comment id="17087431" author="twalthr" created="Mon, 20 Apr 2020 07:13:47 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;,  &lt;br/&gt;
yes, the &lt;tt&gt;TimestampKind&lt;/tt&gt; is excluded by design. The data types of the table schema should be only &lt;tt&gt;TIMESTAMP(3)&lt;/tt&gt; in Hive. The information whether a column is a time attribute is encoded in &lt;tt&gt;L_PROCTIME AS PROCTIME()&lt;/tt&gt; for processing time and &lt;tt&gt;WATERMARK FOR L_ORDERTIME AS L_ORDERTIME - INTERVAL &apos;5&apos; MINUTE&lt;/tt&gt; for event time. Those important schema parts should also be written out (but in properties) and used when reading in a table again. We should have the same logic already for event time. Just processing time seems to have issues.&lt;/p&gt;</comment>
                            <comment id="17087472" author="lirui" created="Mon, 20 Apr 2020 08:07:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, thanks for the explanations. Then I think we can store the &lt;tt&gt;PROCTIME&lt;/tt&gt; info in &lt;tt&gt;DescriptorProperties&lt;/tt&gt;, similar to how we store watermark specs. And I think we just need to store the names of fields which are processing time. When deserializing the table schema, we check whether a field is processing time and if it is, we update the filed type to set the &lt;tt&gt;TimestampKind&lt;/tt&gt;. Does that make sense to you?&lt;/p&gt;</comment>
                            <comment id="17087514" author="lzljs3620320" created="Mon, 20 Apr 2020 09:04:33 +0000"  >&lt;p&gt;This is not a new issue, actually&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16110&quot; title=&quot;LogicalTypeParser can&amp;#39;t parse &amp;quot;TIMESTAMP(3) *ROWTIME*&amp;quot; and &amp;quot;TIMESTAMP(3) *PROCTIME*&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16110&quot;&gt;&lt;del&gt;FLINK-16110&lt;/del&gt;&lt;/a&gt;&#160;is a similar issue. CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The thing is: DDL -&amp;gt;&#160;SqlCreateTable -&amp;gt;&#160;CreateTableOperation, the TableSchema in&#160;CreateTableOperation use TimestampKind in column types instead of a separate class field. So the&#160;DescriptorProperties ignore the TimestampKind information.&lt;/p&gt;

&lt;p&gt;I think this is a table/planner bug instead of hive bug, we should make TableSchema stronger with&#160;DescriptorProperties&#160;serialization. We can:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Store a separate class field in&#160;TableSchema like watermark&lt;/li&gt;
	&lt;li&gt;putTableSchema should serialize this proctime class field.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17087521" author="twalthr" created="Mon, 20 Apr 2020 09:16:21 +0000"  >&lt;p&gt;This might be a separate topic but I think the current property design to represent `TableSchema` has many shortcomings. I would rather vote for simply aligning the property design to the DDL itself:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
schema:
  - kind: watermark
    ...
  - kind: constaint
    ...
  - kind: column
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would solve also &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17158&quot; title=&quot;Watermark strategy property cannot be expressed in YAML&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17158&quot;&gt;&lt;del&gt;FLINK-17158&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17087800" author="jark" created="Mon, 20 Apr 2020 14:43:33 +0000"  >&lt;p&gt;Hi all, first of all, I admit it is a bug, but not a bug of TimestampKind serialization. The properties of DDL should only describe the information of the DDL, not include the derived DataType of the function. The DataType of the function should be inferred again by planner after deserialization from catalog. &lt;/p&gt;

&lt;p&gt;However, currently, we directly use the deserialized DataType of the function which will lose the TimestampKind information. I think we should fix that in &lt;tt&gt;DatabaseCalciteSchema&lt;/tt&gt; to re-calcuate the output DataType of functions when get the CatalogTable from CatalogManager. &lt;/p&gt;</comment>
                            <comment id="17111731" author="lzljs3620320" created="Wed, 20 May 2020 04:02:39 +0000"  >&lt;p&gt;&lt;tt&gt;TableSourceUtil.getSourceRowType&lt;/tt&gt;&#160;should not only adjust rowtime, but also adjust proctime fields. I will create a PR for fixing.&lt;/p&gt;</comment>
                            <comment id="17116446" author="lzljs3620320" created="Tue, 26 May 2020 05:35:40 +0000"  >&lt;p&gt;master:&#160;f08c8309738e519d246aeda163ef1b1f5e7855c7&lt;/p&gt;

&lt;p&gt;release-1.11:&#160;86d2777e89b87c842e9fc242757103656e807154&lt;/p&gt;</comment>
                            <comment id="17116449" author="lzljs3620320" created="Tue, 26 May 2020 05:36:07 +0000"  >&lt;p&gt;Feel free to re-open this if you think we need fix in release-1.10 too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13306497">FLINK-17868</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dpf4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>