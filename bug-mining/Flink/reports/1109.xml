<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4152] TaskManager registration exponential backoff doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4152</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;While testing Flink 1.1 I&apos;ve found that the TaskManagers are logging many messages when registering at the JobManager.&lt;/p&gt;

&lt;p&gt;This is the log file: &lt;a href=&quot;https://gist.github.com/rmetzger/0cebe0419cdef4507b1e8a42e33ef294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/rmetzger/0cebe0419cdef4507b1e8a42e33ef294&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Its logging more than 3000 messages in less than a minute. I don&apos;t think that this is the expected behavior.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12986799">FLINK-4152</key>
            <summary>TaskManager registration exponential backoff doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jul 2016 12:33:10 +0000</created>
                <updated>Sun, 29 Jan 2017 14:42:16 +0000</updated>
                            <resolved>Tue, 26 Jul 2016 14:44:45 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Deployment / YARN</component>
                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15362433" author="rmetzger" created="Tue, 5 Jul 2016 12:40:43 +0000"  >&lt;p&gt;The full aggregated YARN log is more than 300 MB ...&lt;br/&gt;
I&apos;m not sure what the root cause of this issue is. Somewhere there seems to be a retry mechanism not using any backoff.&lt;br/&gt;
In the JobManager, there are many messages like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-07-05 09:57:10,032 INFO  org.apache.flink.yarn.YarnFlinkResourceManager                - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TaskManager container with 1024 megabytes memory. Pending requests: 1
2016-07-05 09:57:10,033 INFO  org.apache.flink.yarn.YarnFlinkResourceManager                - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TaskManager container with 1024 megabytes memory. Pending requests: 2
2016-07-05 09:57:10,033 INFO  org.apache.flink.yarn.YarnFlinkResourceManager                - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TaskManager container with 1024 megabytes memory. Pending requests: 3
2016-07-05 09:57:10,033 INFO  org.apache.flink.yarn.YarnFlinkResourceManager                - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TaskManager container with 1024 megabytes memory. Pending requests: 4
2016-07-05 09:57:10,054 WARN  org.apache.flink.yarn.YarnFlinkResourceManager                - TaskManager resource registration failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000003&apos;&lt;/span&gt;}
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000003&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
2016-07-05 09:57:10,058 WARN  org.apache.flink.yarn.YarnFlinkResourceManager                - TaskManager resource registration failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000004&apos;&lt;/span&gt;}
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000004&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
2016-07-05 09:57:10,059 WARN  org.apache.flink.yarn.YarnJobManager                          - TaskManager&lt;span class=&quot;code-quote&quot;&gt;&apos;s resource id ResourceID{resourceId=&apos;&lt;/span&gt;container_1467643389376_0026_01_000003&apos;} failed to register at ResourceManager. Refusing registration because of
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000003&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
.
2016-07-05 09:57:10,059 WARN  org.apache.flink.yarn.YarnFlinkResourceManager                - TaskManager resource registration failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000005&apos;&lt;/span&gt;}
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000005&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
2016-07-05 09:57:10,059 WARN  org.apache.flink.yarn.YarnJobManager                          - TaskManager&lt;span class=&quot;code-quote&quot;&gt;&apos;s resource id ResourceID{resourceId=&apos;&lt;/span&gt;container_1467643389376_0026_01_000004&apos;} failed to register at ResourceManager. Refusing registration because of
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000004&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
.
2016-07-05 09:57:10,060 WARN  org.apache.flink.yarn.YarnFlinkResourceManager                - TaskManager resource registration failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000002&apos;&lt;/span&gt;}
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000002&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
2016-07-05 09:57:10,060 WARN  org.apache.flink.yarn.YarnJobManager                          - TaskManager&lt;span class=&quot;code-quote&quot;&gt;&apos;s resource id ResourceID{resourceId=&apos;&lt;/span&gt;container_1467643389376_0026_01_000005&apos;} failed to register at ResourceManager. Refusing registration because of
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000005&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
.
2016-07-05 09:57:10,061 WARN  org.apache.flink.yarn.YarnJobManager                          - TaskManager&lt;span class=&quot;code-quote&quot;&gt;&apos;s resource id ResourceID{resourceId=&apos;&lt;/span&gt;container_1467643389376_0026_01_000002&apos;} failed to register at ResourceManager. Refusing registration because of
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000002&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
.
2016-07-05 09:57:10,543 WARN  org.apache.flink.yarn.YarnFlinkResourceManager                - TaskManager resource registration failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000004&apos;&lt;/span&gt;}
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000004&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
2016-07-05 09:57:10,544 WARN  org.apache.flink.yarn.YarnFlinkResourceManager                - TaskManager resource registration failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000002&apos;&lt;/span&gt;}
java.lang.Exception: Cannot register Worker - unknown resource id ResourceID{resourceId=&lt;span class=&quot;code-quote&quot;&gt;&apos;container_1467643389376_0026_01_000002&apos;&lt;/span&gt;}
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:329)
	at org.apache.flink.yarn.YarnFlinkResourceManager.workerRegistered(YarnFlinkResourceManager.java:66)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleRegisterResource(FlinkResourceManager.java:362)
	at org.apache.flink.runtime.clusterframework.FlinkResourceManager.handleMessage(FlinkResourceManager.java:235)
	at org.apache.flink.yarn.YarnFlinkResourceManager.handleMessage(YarnFlinkResourceManager.java:169)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.handleLeaderSessionID(FlinkUntypedActor.java:90)
	at org.apache.flink.runtime.akka.FlinkUntypedActor.onReceive(FlinkUntypedActor.java:70)
	at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:167)
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:465)
	at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:97)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:254)
	at akka.dispatch.Mailbox.run(Mailbox.scala:221)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:231)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15364328" author="zentol" created="Wed, 6 Jul 2016 13:52:43 +0000"  >&lt;p&gt;it looks like the Registration is restarted several times. You can see a lot of info messages where attempt=1.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-07-05 09:57:30,126 INFO org.apache.flink.yarn.YarnTaskManager - Trying to register at JobManager akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@10.240.0.5:56147/user/jobmanager (attempt 1, timeout: 500 milliseconds)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The backoff for the following attempts does seem to work.&lt;/p&gt;</comment>
                            <comment id="15375296" author="till.rohrmann" created="Wed, 13 Jul 2016 16:24:32 +0000"  >&lt;p&gt;The restarted registration attempts are the observable symptoms caused by a different problem. &lt;/p&gt;

&lt;p&gt;The actual problem is that the &lt;tt&gt;YarnFlinkRessourceManager&lt;/tt&gt; forgets about the registered task managers if the job manager loses its leadership. Each task manager has a resource ID with which it registers at the resource manager. The &lt;tt&gt;YarnFlinkResourceManager&lt;/tt&gt; has two states for allocated resources: &lt;tt&gt;containersInLaunch&lt;/tt&gt; and &lt;tt&gt;registeredWorkers&lt;/tt&gt;. A container can only go from &lt;tt&gt;containersInLaunch&lt;/tt&gt; to &lt;tt&gt;registeredWorkers&lt;/tt&gt;. This also works for the initial registration. However, when the job manager loses its leadership and the &lt;tt&gt;registeredWorkers&lt;/tt&gt; list is cleared, there is no longer an container in launch associated with the respective resource ID. Consequently, when the old task manager is being re-registered by the new leader, the registration is rejected.&lt;/p&gt;

&lt;p&gt;This rejection is then sent to the task manager. Upon receiving a rejection, the task manager reschedules another registration attempt after waiting for some time. Here the problem is that the old registration attempts are not cancelled. Consequently, one will have multiple registration attempts taking place at the &quot;same&quot; time/concurrently. That&apos;s the reason why you observe many registration attempt messages in the log.&lt;/p&gt;

&lt;p&gt;I think the symptom can be fixed by cancelling all currently active registration attempts when you want to restart the registration.&lt;/p&gt;

&lt;p&gt;It is a bit unclear to me what the expected behaviour of the FlinkYarnResourceManager should be. In the &lt;tt&gt;jobManagerLostLeadership&lt;/tt&gt; method where the &lt;tt&gt;registeredWorkers&lt;/tt&gt; list is cleared, a comment says &quot;all currently registered TaskManagers are put under &quot;awaiting registration&quot;&quot;. But there is no such state. Furthermore, I&apos;m not sure whether registered TaskManagers have to re-register if only the job manager has failed.&lt;/p&gt;

&lt;p&gt;Thus, I see two solutions. Either not clearing &lt;tt&gt;registeredWorkers&lt;/tt&gt; or introducing a new state &quot;awaiting registration&quot; which keeps all formerly registered task managers which can be re-registered.&lt;/p&gt;

&lt;p&gt;Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; can give some input.&lt;/p&gt;</comment>
                            <comment id="15379396" author="githubbot" created="Fri, 15 Jul 2016 13:54:55 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4152&quot; title=&quot;TaskManager registration exponential backoff doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4152&quot;&gt;&lt;del&gt;FLINK-4152&lt;/del&gt;&lt;/a&gt; Allow re-registration of TMs at resource manager&lt;/p&gt;

&lt;p&gt;    The `YarnFlinkResourceManager` does not allow the `JobManager` to re-register task managers have had been registered at the resource manager before. The consequence of the refusal is that the job manager rejects the registrations of these task managers. &lt;/p&gt;

&lt;p&gt;    Such a scenario can happen if a `JobManager` loses leadership in an HA setting after it registered &lt;br/&gt;
    some TMs. The old behaviour was that the resource manager clears the list of registered workers and only accepts new registrations of task manager which have been started in a fresh container. However, in case that the previously registered TMs didn&apos;t die, they will try to reconnect to the new leader. The new leader will then ask the resource manager whether the TMs represent valid resources. Since the resource manager forgot about the already started containers, it rejects the TMs.&lt;/p&gt;

&lt;p&gt;    This PR changes the behaviour of the resource manager such that it can no longer reject TMs. Instead of being asked it will simply be informed about the registered TMs by the JM. If the TM happens to be running in a container which was started by the RM, then it will monitor this container. In case that this container dies, the RM will notify the JM about the death of the TM.&lt;/p&gt;

&lt;p&gt;    In that sense, the RM has no longer the authority to interfere with the JM-TM interactions and instead it is simply used as an additional monitoring service to detect dead TMs as a result of a failed container.&lt;/p&gt;

&lt;p&gt;    Furthermore, the PR adds a de-duplication method to filter out concurrent registration runs on the task manager. Before, it happened that a `RefusedRegistration` triggers a new registration run without cancelling the old registration run. This could lead to a massive amount of registration messages if the TaskManager&apos;s registration was refused multiple times.&lt;/p&gt;

&lt;p&gt;    The mechanism to de-duplicate `TriggerTaskManagerRegistration` works by assigning a registration run id which is changed whenever a new registration run is started. `TriggerTaskManagerRegistration` messages which have an outdated registration run id are then filtered out.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4152&quot; title=&quot;TaskManager registration exponential backoff doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4152&quot;&gt;&lt;del&gt;FLINK-4152&lt;/del&gt;&lt;/a&gt;_YarnResourceManager&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2257&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2a29fa4df98fd63a7f27e1607152cd6e54d25ad1&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-07-15T08:51:59Z&lt;/p&gt;

&lt;p&gt;    Add YarnFlinkResourceManager test to reaccept task manager registrations from a re-elected job manager&lt;/p&gt;

&lt;p&gt;commit 6462d4750d79512fc93bbc60ca754c99142d1794&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-07-15T09:50:35Z&lt;/p&gt;

&lt;p&gt;    Remove unnecessary sync logic between JobManager and ResourceManager&lt;/p&gt;

&lt;p&gt;commit 55ce0c01783d9c4927a9f4677309c805e2b624e7&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-07-15T10:12:12Z&lt;/p&gt;

&lt;p&gt;    Avoid duplicate reigstration attempts in case of a refused registration&lt;/p&gt;

&lt;p&gt;commit aeb6ae5435dd88c640dc314b9ec31357815d080c&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-07-15T13:04:54Z&lt;/p&gt;

&lt;p&gt;    Add test case to check that not an excessive amount of RegisterTaskManager messages are sent&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15382014" author="githubbot" created="Mon, 18 Jul 2016 09:51:32 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71122579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71122579&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What if this message gets lost? This message needs to be delivered, otherwise the RM won&apos;t function properly. The RM may not run on the same node as the JobManager, making message loss even more likely.&lt;/p&gt;</comment>
                            <comment id="15382036" author="githubbot" created="Mon, 18 Jul 2016 10:11:43 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you for the pull request! Looking at the changes, it looks like it could have been broken up into two pull requests and jira issues. 1) Avoiding duplicate RegisterTaskManager messages 2) Changing core behavior of the ResourceManager.&lt;/p&gt;

&lt;p&gt;    Concerning 2, I would like to understand why it was necessary to change so much code. It seems like it would have sufficed to change one line of code (not clearing the bookkeeping on leader ship change). I&apos;m not saying your changes don&apos;t make sense but I don&apos;t think they are backed by the original JIRA issue.&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure about the role change of the RM in this PR. The RM should be the authority for allocating new resources. If those resources are not properly reported back to the RM (e.g. message loss), the resource allocation won&apos;t work properly. &lt;/p&gt;
</comment>
                            <comment id="15382258" author="githubbot" created="Mon, 18 Jul 2016 13:13:30 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It is true that the duplicate RegisterTaskManager messages fix could have been a separate PR. Since it surfaces as a symptom of the registration problem, I thought about fixing it in the same PR. The separation should be clear (TaskManager vs. RM changes).&lt;/p&gt;

&lt;p&gt;    The reason why I had to change more code than this single line is that the RM shouldn&apos;t interfere with the TaskManager registration to be on the safe side. As far as I&apos;ve understood, the RM should tell you about a dying TM but it should not forbid the registration of a TM at the JM. I think that this conservative behaviour is more robust wrt the old behaviour and helps us to not overlook other corner cases.&lt;/p&gt;

&lt;p&gt;    Furthermore, some of the changes were necessary to make the YARN RM component more easily testable.&lt;/p&gt;</comment>
                            <comment id="15382267" author="githubbot" created="Mon, 18 Jul 2016 13:21:03 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71145235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71145235&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    How would a lost message interfere with the behaviour of the RM? I thought that in the worst case the JM won&apos;t be notified about the death of a TM (if the container dies). However, this should also be recognized by the JM via the Akka&apos;s death watch.&lt;/p&gt;</comment>
                            <comment id="15382486" author="githubbot" created="Mon, 18 Jul 2016 15:51:59 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71173613&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71173613&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Why this map? There is already a map in the base class which holds the registered resources.&lt;/p&gt;</comment>
                            <comment id="15382487" author="githubbot" created="Mon, 18 Jul 2016 15:52:22 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It was just a surprise to me that we&apos;re breaking the original ResourceManager role. If the ResourceManager doesn&apos;t get eventually notified about new TaskManagers, then it is not guaranteed anymore that the ResourceManager can fulfill pool size requests. The JobManager will have to deal with the pool size and the logic to ensure enough resources are available. Thus, the JobManager will be more concerned with managing resources. &lt;/p&gt;</comment>
                            <comment id="15382493" author="githubbot" created="Mon, 18 Jul 2016 15:56:37 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71174483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71174483&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;    If containers die, then the ResourceManager will always be notified by Yarn and is able to pass this information to the JobManager. The advantage of ensuring that this message gets delivered upon TaskManager registration is that the ResourceManager can actually guarantee resources. On the other hand, if messages can be lost, the ResourceManager is just a tool to say &quot;give me more&quot;, &quot;give me less&quot; with no actual guarantees how much you will get.&lt;/p&gt;
</comment>
                            <comment id="15384005" author="githubbot" created="Tue, 19 Jul 2016 11:48:18 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71322624&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71322624&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It is true that it holds the registered resources but it does not hold the launched containers. When a `JobManager` loses its leadership the list of registered workers will be cleared. In order to reconstruct the mapping `ResourceID --&amp;gt; Container`, you need this new map.&lt;/p&gt;</comment>
                            <comment id="15384014" author="githubbot" created="Tue, 19 Jul 2016 11:59:25 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71323898&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71323898&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    If I&apos;m not mistaken then there is hardly any difference between a registered worker and a container in launch. So in the current implementation it shouldn&apos;t matter much whether a container is in state &quot;being launched&quot; or &quot;launched&quot;. Thus, it does not make much of a difference whether this message arrives or not.&lt;/p&gt;

&lt;p&gt;    Given that the `JobManager` does not yet use the RM to allocate new resources, it might actually be a good idea to regard the RM as a tool to notify the JM about TM failures. Everything else can be added once we actually need it.&lt;/p&gt;</comment>
                            <comment id="15384026" author="githubbot" created="Tue, 19 Jul 2016 12:09:19 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71325133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71325133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I just don&apos;t understand why you remove this functionality. It was not broken in any way. Of course, we can always add features later (that is true for any component) but it changes the original RM design. If we want to add monitoring of the pool size later on, we will have to re-add the proper registration at the RM.&lt;/p&gt;</comment>
                            <comment id="15384029" author="githubbot" created="Tue, 19 Jul 2016 12:09:53 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71325200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71325200&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    But it might be necessary to add the number of launched containers to the number of containers in launch in the `YarnFlinkResourceManager#getNumWorkersPendingRegistration`. Then the `checkWorkersPool` should behave correctly.&lt;/p&gt;</comment>
                            <comment id="15384030" author="githubbot" created="Tue, 19 Jul 2016 12:10:16 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71325247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71325247&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    What would be the drawback of not cleaning this list?&lt;/p&gt;</comment>
                            <comment id="15384069" author="githubbot" created="Tue, 19 Jul 2016 12:23:26 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think by imposing this contract we actually introduced problems we didn&apos;t have before. Thus, in order to remedy these problems for the upcoming release and go back a bit in the direction of the pre-RM age, I loosened the contract of the RM so that it can no longer reject TM registrations. This makes sense in my opinion, since we don&apos;t have a mean to shut down orphaned TMs anyway.&lt;/p&gt;

&lt;p&gt;    So in this version, the RM&apos;s task is to ensure that at least a predefined set of resources is allocated and to notify the JM about a TM death (not strictly mandatory).&lt;/p&gt;

&lt;p&gt;    What we could actually do is to also register orphaned TMs (or ones registered by a different RM). Then we wouldn&apos;t have the problem that we allocate too many resources for a JM.&lt;/p&gt;</comment>
                            <comment id="15384077" author="githubbot" created="Tue, 19 Jul 2016 12:30:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71327721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71327721&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +374,13 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;t match 
{
    -                case _: TimeoutException =&amp;gt;
    -                  log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
    -                case _ =&amp;gt;
    -                  log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
    -              }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new ReconnectResourceManager(rm))&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    -&lt;br/&gt;
    +          log.info(s&quot;Register task manager $resourceId at the resource manager.&quot;)&lt;br/&gt;
    +          rm ! decorateMessage(new RegisterResource(msg))
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Because it added complexity which is no longer needed. The current design still allows to change it later on. Therefore I don&apos;t see a problem in removing it. Just because we might need it in the future, is imho not a good reason to keep unused code around.&lt;/p&gt;</comment>
                            <comment id="15384094" author="githubbot" created="Tue, 19 Jul 2016 12:48:30 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t feel particularly great about breaking the contract between JobManager and ResourceManager but it is a path we can go until we expand the ResourceManager capabilities. The figures here would have to be updated as well: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3543&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-3543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Overall, the changes look good to me. I don&apos;t think we can reach consensus on the registration matter. As of now, I don&apos;t want to block release fixes. So +1 to merge if you feel like it.&lt;/p&gt;</comment>
                            <comment id="15384103" author="githubbot" created="Tue, 19 Jul 2016 12:55:38 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71331665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71331665&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You tell me, since you&apos;ve authored this component. I guess there was a reason why you clear the list of registered resources when a JM loses its leadership.&lt;/p&gt;</comment>
                            <comment id="15384104" author="githubbot" created="Tue, 19 Jul 2016 12:56:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71331743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71331743&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I basically introduced this map to not break the semantic contract of the `FlinkResourceManager` component.&lt;/p&gt;</comment>
                            <comment id="15384133" author="githubbot" created="Tue, 19 Jul 2016 13:22:45 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    My main concern is actually that the JM-RM interaction is not well tested. Thus, I fear the more complex the code is the more possibility for mistakes there are. For example, I couldn&apos;t find a test where we test the `ReconnectResourceManager` functionality. Given that we&apos;re about to release 1.1 shortly, I would go for the simplest approach. &lt;/p&gt;</comment>
                            <comment id="15384234" author="githubbot" created="Tue, 19 Jul 2016 14:35:04 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71350758&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71350758&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    &amp;gt;You tell me, since you&apos;ve authored this component. &lt;/p&gt;

&lt;p&gt;    I think there is a misunderstanding. I did author this component but it is not mine. I know you spend some time working on this and I just want to understand your motives. I thought actually you had tried this fix since you mentioned it in the JIRA.&lt;/p&gt;

&lt;p&gt;    I think clearing the list is simply a bug and artifact of an old code design where the ResourceManager would be the central instance for TaskManager registration. &lt;/p&gt;</comment>
                            <comment id="15384291" author="githubbot" created="Tue, 19 Jul 2016 14:59:03 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71355929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71355929&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnFlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -78,6 +79,9 @@&lt;br/&gt;
     	/** The containers where a TaskManager is starting and we are waiting for it to register */&lt;br/&gt;
     	private final Map&amp;lt;ResourceID, YarnContainerInLaunch&amp;gt; containersInLaunch;&lt;/p&gt;

&lt;p&gt;    +	/** The container where a TaskManager has been started and is running in */&lt;br/&gt;
    +	private final Map&amp;lt;ResourceID, Container&amp;gt; containersLaunched;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I never said that it&apos;s yours but you&apos;ve been much more involved in the design of this component than I was. Thus, I assumed that you know more than I do what the semantics of the `registeredWorkers` fields is. For example, does this field represent currently registered TMs at a JM or does this field represents the TMs which were registered at the RM by the JM?&lt;/p&gt;

&lt;p&gt;    I didn&apos;t know about it and couldn&apos;t deduce it from the code. Consequently, I chose the safest approach to leave it as it is and introduce a new container state in the `YarnFlinkResourceManager` implementation.&lt;/p&gt;

&lt;p&gt;    But if you think that clearing is just a bug and that the corresponding JavaDoc comment is outdated, then it might be a good option to change it.&lt;/p&gt;</comment>
                            <comment id="15384333" author="githubbot" created="Tue, 19 Jul 2016 15:18:39 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 Let&apos;s get it out of the way for the 1.1 release.&lt;/p&gt;</comment>
                            <comment id="15385711" author="githubbot" created="Wed, 20 Jul 2016 11:41:17 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @mxm, I&apos;ve changed the implementation such that we no longer need the `containersLaunched` map in the `YarnFlinkResourceManager`. Instead we&apos;re not clearing the `registeredWorkers` map in the `FlinkResourceManager` when the `JobManager` loses leadership. Thus, the `registeredWorkers` field denotes the successfully started task managers (and the containers they are running in).&lt;/p&gt;

&lt;p&gt;    Additionally I reintroduced the reconnect resource manager functionality in the job manager. This should make sure that the resource manager is eventually notified about newly registered resources. In the current implementation, however, the resource manager will always accept the register resource messages. So only if the message gets lost and thus triggers a timeout exception, the reconnect resource manager message is sent.&lt;/p&gt;

&lt;p&gt;    Would be great if you could take another look at the changes.&lt;/p&gt;</comment>
                            <comment id="15385799" author="githubbot" created="Wed, 20 Jul 2016 12:51:38 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71517956&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71517956&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +405,23 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;br/&gt;
    +          val future = (rm ? decorateMessage(new RegisterResource(msg)))(timeout)&lt;br/&gt;
    +          future.onFailure {&lt;br/&gt;
    +            case t: Throwable =&amp;gt;&lt;br/&gt;
                   t match 
{
                     case _: TimeoutException =&amp;gt;
                       log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
                     case _ =&amp;gt;
                       log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
                   }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
                   self ! decorateMessage(new ReconnectResourceManager(rm))&lt;br/&gt;
               }(context.dispatcher)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             case None =&amp;gt;&lt;br/&gt;
               log.info(&quot;Task Manager Registration but not connected to ResourceManager&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// ResourceManager not yet available&lt;/li&gt;
	&lt;li&gt;// sending task manager information later upon ResourceManager registration&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
           }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case msg: RegisterResourceSuccessful =&amp;gt;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;val originalMsg = msg.getRegistrationMessage&lt;/li&gt;
	&lt;li&gt;val taskManager = msg.getTaskManager&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// ResourceManager knows about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
    +      // ResourceManager is told about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
           if (instanceManager.isRegistered(taskManager)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Would it make sense to attempt registration of the task manager at the JobManager first and then, if successful, notify the ResourceManager? That&apos;s what the comment for `registeredWorkers` states now and I think it would make sense.&lt;/p&gt;</comment>
                            <comment id="15385823" author="githubbot" created="Wed, 20 Jul 2016 13:06:33 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71520071&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71520071&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +405,23 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;br/&gt;
    +          val future = (rm ? decorateMessage(new RegisterResource(msg)))(timeout)&lt;br/&gt;
    +          future.onFailure {&lt;br/&gt;
    +            case t: Throwable =&amp;gt;&lt;br/&gt;
                   t match 
{
                     case _: TimeoutException =&amp;gt;
                       log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
                     case _ =&amp;gt;
                       log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
                   }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
                   self ! decorateMessage(new ReconnectResourceManager(rm))&lt;br/&gt;
               }(context.dispatcher)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             case None =&amp;gt;&lt;br/&gt;
               log.info(&quot;Task Manager Registration but not connected to ResourceManager&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// ResourceManager not yet available&lt;/li&gt;
	&lt;li&gt;// sending task manager information later upon ResourceManager registration&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
           }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case msg: RegisterResourceSuccessful =&amp;gt;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;val originalMsg = msg.getRegistrationMessage&lt;/li&gt;
	&lt;li&gt;val taskManager = msg.getTaskManager&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// ResourceManager knows about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
    +      // ResourceManager is told about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
           if (instanceManager.isRegistered(taskManager)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes that&apos;s a good idea.&lt;/p&gt;

&lt;p&gt;    The `registeredWorkers` field can also contain TMs which were registered at a JM but now are not due to leadership loss or death watch. That&apos;s because the JM does not unregister resources at the moment. Maybe I should add this to the comment for `registeredWorkers`.&lt;/p&gt;</comment>
                            <comment id="15385845" author="githubbot" created="Wed, 20 Jul 2016 13:24:50 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71522922&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71522922&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/FlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -113,7 +111,8 @@&lt;br/&gt;
     	/** The service to find the right leader JobManager (to support high availability) */&lt;br/&gt;
     	private final LeaderRetrievalService leaderRetriever;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** The currently registered resources */&lt;br/&gt;
    +	/** The resources which have been registered at the ResourceManager. This indicates the set&lt;br/&gt;
    +	 * of containers where a TaskManager has been started and registered at a JobManager.  */
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We should think about whether it denotes the startup and registration or simply the startup of a TaskManager process. This depends on whether we send the RegisterResource message before or after TaskManager registration at the JobManager.&lt;/p&gt;</comment>
                            <comment id="15385847" author="githubbot" created="Wed, 20 Jul 2016 13:25:11 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you for taking the time to revise some parts of the PR! I like the changes. The eventual resource registration has been re-introduced but simplified to only acknowledge the registration of TaskManagers at the JobManager. We could think about moving the acknowledgment of resources after the TaskManager registration at the JobManager. That would guarantee the full startup of the &quot;worker&quot;. Actually, thinking about it again, it would break the semantics of the `registeredWorkers` map when the leader changes (because TaskManagers disconnect then). We may just leave it as it is. &lt;/p&gt;</comment>
                            <comment id="15385854" author="githubbot" created="Wed, 20 Jul 2016 13:30:26 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71523881&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71523881&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +405,23 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;br/&gt;
    +          val future = (rm ? decorateMessage(new RegisterResource(msg)))(timeout)&lt;br/&gt;
    +          future.onFailure {&lt;br/&gt;
    +            case t: Throwable =&amp;gt;&lt;br/&gt;
                   t match 
{
                     case _: TimeoutException =&amp;gt;
                       log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
                     case _ =&amp;gt;
                       log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
                   }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
                   self ! decorateMessage(new ReconnectResourceManager(rm))&lt;br/&gt;
               }(context.dispatcher)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             case None =&amp;gt;&lt;br/&gt;
               log.info(&quot;Task Manager Registration but not connected to ResourceManager&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// ResourceManager not yet available&lt;/li&gt;
	&lt;li&gt;// sending task manager information later upon ResourceManager registration&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
           }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case msg: RegisterResourceSuccessful =&amp;gt;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;val originalMsg = msg.getRegistrationMessage&lt;/li&gt;
	&lt;li&gt;val taskManager = msg.getTaskManager&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// ResourceManager knows about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
    +      // ResourceManager is told about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
           if (instanceManager.isRegistered(taskManager)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We could also add an additional message to remove registered resources (upon Disconnect or Terminate). For most situations, the ResourceManager will probably detect a failed container anyways.&lt;/p&gt;</comment>
                            <comment id="15386150" author="githubbot" created="Wed, 20 Jul 2016 16:30:41 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71559335&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71559335&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +405,23 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;br/&gt;
    +          val future = (rm ? decorateMessage(new RegisterResource(msg)))(timeout)&lt;br/&gt;
    +          future.onFailure {&lt;br/&gt;
    +            case t: Throwable =&amp;gt;&lt;br/&gt;
                   t match 
{
                     case _: TimeoutException =&amp;gt;
                       log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
                     case _ =&amp;gt;
                       log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
                   }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
                   self ! decorateMessage(new ReconnectResourceManager(rm))&lt;br/&gt;
               }(context.dispatcher)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             case None =&amp;gt;&lt;br/&gt;
               log.info(&quot;Task Manager Registration but not connected to ResourceManager&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// ResourceManager not yet available&lt;/li&gt;
	&lt;li&gt;// sending task manager information later upon ResourceManager registration&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
           }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case msg: RegisterResourceSuccessful =&amp;gt;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;val originalMsg = msg.getRegistrationMessage&lt;/li&gt;
	&lt;li&gt;val taskManager = msg.getTaskManager&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// ResourceManager knows about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
    +      // ResourceManager is told about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
           if (instanceManager.isRegistered(taskManager)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes we could do this, but then we would have to introduce a kind of waiting state for the containers because the de-registration does not necessarily imply that the TM died. I think this would exceed the scope of this PR a little bit.&lt;/p&gt;</comment>
                            <comment id="15386152" author="githubbot" created="Wed, 20 Jul 2016 16:31:11 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71559450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71559450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/FlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -113,7 +111,8 @@&lt;br/&gt;
     	/** The service to find the right leader JobManager (to support high availability) */&lt;br/&gt;
     	private final LeaderRetrievalService leaderRetriever;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** The currently registered resources */&lt;br/&gt;
    +	/** The resources which have been registered at the ResourceManager. This indicates the set&lt;br/&gt;
    +	 * of containers where a TaskManager has been started and registered at a JobManager.  */
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes as you&apos;ve said it in another comment, it does not represent TMs which are currently registered but TMs which are started and have at least once been registered. For the sake of simplicity, we could rename the field into `startedWorkers`.&lt;/p&gt;</comment>
                            <comment id="15387352" author="githubbot" created="Thu, 21 Jul 2016 08:22:39 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71664748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71664748&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/FlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -113,7 +111,8 @@&lt;br/&gt;
     	/** The service to find the right leader JobManager (to support high availability) */&lt;br/&gt;
     	private final LeaderRetrievalService leaderRetriever;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** The currently registered resources */&lt;br/&gt;
    +	/** The resources which have been registered at the ResourceManager. This indicates the set&lt;br/&gt;
    +	 * of containers where a TaskManager has been started and registered at a JobManager.  */
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes and we should change the comment to not state that they have been registered at the JobManager because currently they are registered at the ResourceManager before JobManager registration.&lt;/p&gt;</comment>
                            <comment id="15387353" author="githubbot" created="Thu, 21 Jul 2016 08:23:10 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71664833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71664833&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -405,36 +405,23 @@ class JobManager(&lt;/p&gt;

&lt;p&gt;           currentResourceManager match {&lt;br/&gt;
             case Some(rm) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val future = (rm ? decorateMessage(new RegisterResource(taskManager, msg)))(timeout)&lt;/li&gt;
	&lt;li&gt;future.onComplete {&lt;/li&gt;
	&lt;li&gt;case scala.util.Success(response) =&amp;gt;&lt;/li&gt;
	&lt;li&gt;// the resource manager is available and answered&lt;/li&gt;
	&lt;li&gt;self ! response&lt;/li&gt;
	&lt;li&gt;case scala.util.Failure(t) =&amp;gt;&lt;br/&gt;
    +          val future = (rm ? decorateMessage(new RegisterResource(msg)))(timeout)&lt;br/&gt;
    +          future.onFailure {&lt;br/&gt;
    +            case t: Throwable =&amp;gt;&lt;br/&gt;
                   t match 
{
                     case _: TimeoutException =&amp;gt;
                       log.info(&quot;Attempt to register resource at ResourceManager timed out. Retrying&quot;)
                     case _ =&amp;gt;
                       log.warn(&quot;Failure while asking ResourceManager for RegisterResource. Retrying&quot;, t)
                   }&lt;/li&gt;
	&lt;li&gt;// slow or unreachable resource manager, register anyway and let the rm reconnect&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
                   self ! decorateMessage(new ReconnectResourceManager(rm))&lt;br/&gt;
               }(context.dispatcher)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             case None =&amp;gt;&lt;br/&gt;
               log.info(&quot;Task Manager Registration but not connected to ResourceManager&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// ResourceManager not yet available&lt;/li&gt;
	&lt;li&gt;// sending task manager information later upon ResourceManager registration&lt;/li&gt;
	&lt;li&gt;self ! decorateMessage(new RegisterResourceSuccessful(taskManager, msg))&lt;br/&gt;
           }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case msg: RegisterResourceSuccessful =&amp;gt;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;val originalMsg = msg.getRegistrationMessage&lt;/li&gt;
	&lt;li&gt;val taskManager = msg.getTaskManager&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// ResourceManager knows about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
    +      // ResourceManager is told about the resource, now let&apos;s try to register TaskManager&lt;br/&gt;
           if (instanceManager.isRegistered(taskManager)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I agree, it&apos;s out of the scope of this PR.&lt;/p&gt;</comment>
                            <comment id="15387357" author="githubbot" created="Thu, 21 Jul 2016 08:26:37 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r71665307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r71665307&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/FlinkResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -113,7 +111,8 @@&lt;br/&gt;
     	/** The service to find the right leader JobManager (to support high availability) */&lt;br/&gt;
     	private final LeaderRetrievalService leaderRetriever;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** The currently registered resources */&lt;br/&gt;
    +	/** The resources which have been registered at the ResourceManager. This indicates the set&lt;br/&gt;
    +	 * of containers where a TaskManager has been started and registered at a JobManager.  */
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes that is true. Will change it accordingly.&lt;/p&gt;</comment>
                            <comment id="15387616" author="githubbot" created="Thu, 21 Jul 2016 12:45:38 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @mxm, I&apos;ve added the changes to rename `registeredWorkers` into `startedWorkers` and in the same wake I renamed the `RegisterResource` message into a `NotifyResourceStarted` message which reflects better its current usage. If you want, then you can take another look.&lt;/p&gt;

&lt;p&gt;    There is still some travis issue with the `YarnFlinkResourceManagerTest` case. Somehow the `YarnFlinkResourceManager` is not being started properly. I&apos;m investigating.&lt;/p&gt;</comment>
                            <comment id="15387859" author="githubbot" created="Thu, 21 Jul 2016 15:06:45 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @tillrohrmann! Your changes look good. I would say this is good to merge once we have fixed the issue with the `YarnFlinkResourceManagerTest` on Travis.&lt;/p&gt;</comment>
                            <comment id="15389874" author="githubbot" created="Fri, 22 Jul 2016 17:27:55 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    At the moment I&apos;m a little bit clueless why the test case errors occur. One test case error is probably related to concurrency issues in the `TestingLeaderRetrievalService`. I&apos;ve fixed them but the error is still occurring in my local builds on Travis. Here the problem is that maven does not use the installed flink-runtim_2.10-tests.jar which contains the updated `TestingLeaderRetrievalService` but instead it downloads the the flink-runtime test jar from the snapshot repository which contains the code with the concurrency issue.&lt;/p&gt;

&lt;p&gt;    The other test issue I&apos;ve seen is that the `flink-yarn-tests` sometimes fail because they contain no a&lt;br/&gt;
    ```&lt;br/&gt;
    2016-07-22 12:01:31,308 ERROR akka.remote.EndpointWriter                                    - AssociationError &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@172.17.2.124:57922&amp;#93;&lt;/span&gt; &amp;lt;- &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@172.17.2.124:36043&amp;#93;&lt;/span&gt;: Error &lt;span class=&quot;error&quot;&gt;&amp;#91;Shut down address: akka.tcp://flink@172.17.2.124:36043&amp;#93;&lt;/span&gt; [&lt;br/&gt;
    akka.remote.ShutDownAssociation: Shut down address: akka.tcp://flink@172.17.2.124:36043&lt;br/&gt;
    Caused by: akka.remote.transport.Transport$InvalidAssociationException: The remote system terminated the association because it is shutting down.&lt;br/&gt;
    ]&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    in the logs. Since the test checks for exception as a word, it fails. I cannot yet explain why this association error now occurs but apparently didn&apos;t occur before.&lt;/p&gt;
</comment>
                            <comment id="15389887" author="githubbot" created="Fri, 22 Jul 2016 17:35:27 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The latter problem apparently only occurred in my local branch because I set `akka.remote.log-remote-lifecycle-events=on` for debugging purposes. The former problem with the downloading of the flink-runtime test jar did not seem to occur here.&lt;/p&gt;

&lt;p&gt;    Let&apos;s see what the next Travis run says.&lt;/p&gt;</comment>
                            <comment id="15390557" author="githubbot" created="Sat, 23 Jul 2016 05:43:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The problem that maven downloads the flink-runtime_2.10-tests.jar from the snapshot repository instead of using the one from the local repository still remains.&lt;/p&gt;</comment>
                            <comment id="15391616" author="githubbot" created="Mon, 25 Jul 2016 09:46:48 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for investigating! Let me see if I can further debug the problem and find out why Maven doesn&apos;t use the installed `flink-runtime` artifact instead of the snapshot artifact.&lt;/p&gt;</comment>
                            <comment id="15393025" author="githubbot" created="Tue, 26 Jul 2016 01:48:21 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @mxm. Maybe this &lt;a href=&quot;http://stackoverflow.com/questions/38021248/multi-module-maven-dependency-using-repository-not-local-on-travis-ci&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/38021248/multi-module-maven-dependency-using-repository-not-local-on-travis-ci&lt;/a&gt; can help you.&lt;/p&gt;</comment>
                            <comment id="15393601" author="githubbot" created="Tue, 26 Jul 2016 10:32:05 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/146612227/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/146612227/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    After checking the logs again, I know why Maven isn&apos;t using the installed `flink-runtime` artifact. It tries to download the `flink-runtime_2.11` artifact when, in fact, it should try to download `flink-runtime-2.10`. Note, that the build is a Scala 2.11 build but this should only set the Scala version of dependencies but not change any Flink artifact names (we have a another script for that). When flink-runtime is built, it is built with Scala 2.11 although named flink-runtime_2.10. Still, `flink-yarn` attempts to download `flink-runtime_2.11`.&lt;/p&gt;

&lt;p&gt;    Trying to dig deeper, why this could be the case. &lt;/p&gt;</comment>
                            <comment id="15393716" author="githubbot" created="Tue, 26 Jul 2016 12:26:57 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257#discussion_r72238490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257#discussion_r72238490&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/pom.xml &amp;#8212;&lt;br/&gt;
    @@ -85,8 +85,20 @@ under the License.&lt;br/&gt;
     			&amp;lt;artifactId&amp;gt;guava&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
     			&amp;lt;version&amp;gt;${guava.version}&amp;lt;/version&amp;gt;&lt;br/&gt;
     		&amp;lt;/dependency&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +		&amp;lt;dependency&amp;gt;&lt;br/&gt;
    +			&amp;lt;groupId&amp;gt;com.typesafe.akka&amp;lt;/groupId&amp;gt;&lt;br/&gt;
    +			&amp;lt;artifactId&amp;gt;akka-testkit_${scala.binary.version}&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
    +			&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
    +		&amp;lt;/dependency&amp;gt;&lt;br/&gt;
    +&lt;br/&gt;
    +		&amp;lt;dependency&amp;gt;&lt;br/&gt;
    +			&amp;lt;groupId&amp;gt;org.apache.flink&amp;lt;/groupId&amp;gt;&lt;br/&gt;
    +			&amp;lt;artifactId&amp;gt;flink-runtime_${scala.binary.version}&amp;lt;/artifactId&amp;gt;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Here&apos;s the culprit. This has to be `flink-runtime_2.10` because it is a Flink artifact. The `scala-2.11` property only affects Scala dependencies of Flink artifacts. The Flink artifacts names remain the sames unless changed via the `change-scala-version.sh` script.&lt;/p&gt;

&lt;p&gt;    If I remember correctly we don&apos;t use properties in artifact names because they are not resolved by Maven.&lt;/p&gt;</comment>
                            <comment id="15393730" author="githubbot" created="Tue, 26 Jul 2016 12:36:02 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Found the culprit. We must not use the `scala.binary.version` property in flink artifact names. The property is only for switching Scala dependencies. It is not resolved by Maven in artifact names during deployment which would give us artifact names of the form `flink-runtime_${scala.binary.version}`. The problem is that we set the property in the root pom which can only be deployed one time. Otherwise all artifacts would depend on Scala...a bit nasty.&lt;/p&gt;

&lt;p&gt;    The build failures occurred because Maven tried to use the `flink-runtime_2.11` dependency instead of `flink-runtime_2.10` (which is in fact the Scala 2.11 version if you use `-Dscala-2.11`). `flink-runtime_2.11` hadn&apos;t been installed previously, causing Maven to download it from the snapshot repository...&lt;/p&gt;

&lt;p&gt;    I think we&apos;re done with this PR after this. I&apos;m going to run the changes on Travis and will merge to the master then.&lt;/p&gt;
</comment>
                            <comment id="15393885" author="githubbot" created="Tue, 26 Jul 2016 14:44:26 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15393886" author="mxm" created="Tue, 26 Jul 2016 14:44:45 +0000"  >&lt;p&gt;Fixed via 2648bc1a5a5faed8c2061bcab40a8949fd02751c&lt;/p&gt;</comment>
                            <comment id="15395002" author="githubbot" created="Wed, 27 Jul 2016 03:37:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @mxm for resolving the issue. That was definitely a tricky one.&lt;/p&gt;</comment>
                            <comment id="15395444" author="githubbot" created="Wed, 27 Jul 2016 10:54:47 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Glad we figured it out &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks for your PR!&lt;/p&gt;</comment>
                            <comment id="15396190" author="githubbot" created="Wed, 27 Jul 2016 19:14:19 +0000"  >&lt;p&gt;Github user EronWright commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann @mxm I&apos;ll try to incorporate these changes into the &lt;span class=&quot;error&quot;&gt;&amp;#91;MesosFlinkResourceManager&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/EronWright/flink/blob/feature-MESOS-1984-T1/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosFlinkResourceManager.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/EronWright/flink/blob/feature-MESOS-1984-T1/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosFlinkResourceManager.java&lt;/a&gt;).   I deliberately kept the code as similar as possible to simplify future refactoring.&lt;/p&gt;

&lt;p&gt;    I too noticed the TM re-registration problem - that by removing items from registeredWorkers, a subsequent re-accept would fail.   Thanks for addressing it!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12816181" name="logs.tgz" size="3004136" author="rmetzger" created="Tue, 5 Jul 2016 12:46:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30j9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>