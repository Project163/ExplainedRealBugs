<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19401] Job stuck in restart loop due to excessive checkpoint recoveries which block the JobMaster</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19401</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Flink job sometimes got into a restart loop for many hours and can&apos;t recover until redeployed. We had some issue with Kafka that initially caused the job to restart. &lt;/p&gt;

&lt;p&gt;Below is the first of the many exceptions for &quot;ResourceManagerException: Could not find registered job manager&quot; error.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-09-19 00:03:31,614 INFO  org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl     [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35973]  - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot [SlotRequestId{171f1df017dab3a42c032abd07908b9b}] and profile ResourceP
rofile{UNKNOWN} from resource manager.
2020-09-19 00:03:31,615 INFO  org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl     [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35973]  - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot [SlotRequestId{cc7d136c4ce1f32285edd4928e3ab2e2}] and profile ResourceProfile{UNKNOWN} from resource manager.
2020-09-19 00:03:31,615 INFO  org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl     [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35973]  - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot [SlotRequestId{024c8a48dafaf8f07c49dd4320d5cc94}] and profile ResourceProfile{UNKNOWN} from resource manager.
2020-09-19 00:03:31,615 INFO  org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl     [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35973]  - Requesting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot [SlotRequestId{a591eda805b3081ad2767f5641d0db06}] and profile ResourceProfile{UNKNOWN} from resource manager.
2020-09-19 00:03:31,620 INFO  org.apache.flink.runtime.executiongraph.ExecutionGraph       [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35973]  - Source: k2-csevpc -&amp;gt; k2-csevpcRaw -&amp;gt; (vhsPlaybackEvents -&amp;gt; Flat Map, merchImpressionsClientLog -&amp;gt; Flat Map) (56/640) (1b0d3dd1f19890886ff373a3f08809e8) switched from SCHEDULED to FAILED.
java.util.concurrent.CompletionException: java.util.concurrent.CompletionException: org.apache.flink.runtime.jobmanager.scheduler.NoResourceAvailableException: No pooled slot available and request to ResourceManager &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot failed
        at org.apache.flink.runtime.jobmaster.slotpool.SlotSharingManager$MultiTaskSlot.lambda$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$0(SlotSharingManager.java:433)
        at java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:836)
        at java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:811)
        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)
        at org.apache.flink.runtime.concurrent.FutureUtils.lambda$forward$21(FutureUtils.java:1065)
        at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)
        at java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:792)
        at java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2153)
        at org.apache.flink.runtime.concurrent.FutureUtils.forward(FutureUtils.java:1063)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotSharingManager.createRootSlot(SlotSharingManager.java:155)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.allocateMultiTaskSlot(SchedulerImpl.java:511)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.allocateSharedSlot(SchedulerImpl.java:311)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.internalAllocateSlot(SchedulerImpl.java:160)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.allocateSlotInternal(SchedulerImpl.java:143)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.allocateSlot(SchedulerImpl.java:113)
        at org.apache.flink.runtime.executiongraph.SlotProviderStrategy$NormalSlotProviderStrategy.allocateSlot(SlotProviderStrategy.java:115)
        at org.apache.flink.runtime.scheduler.DefaultExecutionSlotAllocator.lambda$allocateSlotsFor$0(DefaultExecutionSlotAllocator.java:104)
        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:995)
        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2137)
        at org.apache.flink.runtime.scheduler.DefaultExecutionSlotAllocator.allocateSlotsFor(DefaultExecutionSlotAllocator.java:102)
        at org.apache.flink.runtime.scheduler.DefaultScheduler.allocateSlots(DefaultScheduler.java:342)
        at org.apache.flink.runtime.scheduler.DefaultScheduler.allocateSlotsAndDeploy(DefaultScheduler.java:311)
        at org.apache.flink.runtime.scheduler.strategy.EagerSchedulingStrategy.allocateSlotsAndDeploy(EagerSchedulingStrategy.java:76)
        at org.apache.flink.runtime.scheduler.strategy.EagerSchedulingStrategy.restartTasks(EagerSchedulingStrategy.java:57)
        at org.apache.flink.runtime.scheduler.DefaultScheduler.lambda$restartTasks$1(DefaultScheduler.java:268)
        at java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:719)
        at java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:701)
        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:456)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRunAsync(AkkaRpcActor.java:402)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:195)
        at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:74)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleMessage(AkkaRpcActor.java:152)
        at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26)
        at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21)
        at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123)
        at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21)
        at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:170)
        at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171)
        at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171)
        at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:517)
        at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225)
        at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592)
        at akka.actor.ActorCell.invoke(ActorCell.scala:561)
        at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258)
        at akka.dispatch.Mailbox.run(Mailbox.scala:225)
        at akka.dispatch.Mailbox.exec(Mailbox.scala:235)
        at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
        at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
        at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
        at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
Caused by: java.util.concurrent.CompletionException: org.apache.flink.runtime.jobmanager.scheduler.NoResourceAvailableException: No pooled slot available and request to ResourceManager &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot failed
        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
        at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
        at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:607)
        at java.util.concurrent.CompletableFuture.uniApplyStage(CompletableFuture.java:628)
        at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:1996)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.requestNewAllocatedSlot(SlotPoolImpl.java:438)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.requestNewAllocatedSlot(SchedulerImpl.java:236)
        at org.apache.flink.runtime.jobmaster.slotpool.SchedulerImpl.allocateMultiTaskSlot(SchedulerImpl.java:506)
        ... 39 more
Caused by: org.apache.flink.runtime.jobmanager.scheduler.NoResourceAvailableException: No pooled slot available and request to ResourceManager &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; slot failed
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.slotRequestToResourceManagerFailed(SlotPoolImpl.java:360)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.lambda$requestSlotFromResourceManager$1(SlotPoolImpl.java:348)
        at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)
        at java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:792)
        at java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2153)
        at org.apache.flink.runtime.concurrent.FutureUtils.whenCompleteAsyncIfNotDone(FutureUtils.java:941)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.requestSlotFromResourceManager(SlotPoolImpl.java:342)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.requestNewAllocatedSlotInternal(SlotPoolImpl.java:309)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.requestNewAllocatedSlot(SlotPoolImpl.java:437)
        ... 41 more
Caused by: java.util.concurrent.CompletionException: org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException: Could not find registered job manager &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
        at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
        at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:607)
        at java.util.concurrent.CompletableFuture.uniApplyStage(CompletableFuture.java:628)
        at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:1996)
        at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.invokeRpc(AkkaInvocationHandler.java:214)
        at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.invoke(AkkaInvocationHandler.java:129)
        at org.apache.flink.runtime.rpc.akka.FencedAkkaInvocationHandler.invoke(FencedAkkaInvocationHandler.java:78)
        at com.sun.proxy.$Proxy94.requestSlot(Unknown Source)
        at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.requestSlotFromResourceManager(SlotPoolImpl.java:337)
        ... 43 more
Caused by: org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException: Could not find registered job manager &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
        at org.apache.flink.runtime.resourcemanager.ResourceManager.requestSlot(ResourceManager.java:443)
        at sun.reflect.GeneratedMethodAccessor135.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcInvocation(AkkaRpcActor.java:284)
        at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:199)
        ... 20 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Grepped through our log.  job manager registration happened once when the job was deployed a few days ago.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-09-16 17:23:28,081 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-60]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then there were a flurry of 9 registrations in the same milli-seconds that happened ~30 mins after the first error of &quot; Could not find registered job manager&quot;. The issue persisted many hours after this. Because this is a pre-prod job, so we didn&apos;t have alert on it.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,827 INFO  com.netflix.spaas.runtime.resourcemanager.TitusResourceManager [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35963]  - Registered job manager a7263fdf0cd75d4d6481858f89894876@akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@100.118.253.133:43917/user/jobmanager_0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 70216adbeed914b35d77717c4b7b13ea.
&lt;/span&gt;2020-09-19 00:33:07,828 INFO  org.apache.flink.runtime.jobmaster.JobMaster                 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-35968]  - JobManager successfully registered at ResourceManager, leader id: bf239dac186bc8ba901a8702f4bb42e3.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have the job manager logs for the hour with INFO level that I can share offline if needed.&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13329255">FLINK-19401</key>
            <summary>Job stuck in restart loop due to excessive checkpoint recoveries which block the JobMaster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="stevenz3wu">Steven Zhen Wu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 24 Sep 2020 16:21:34 +0000</created>
                <updated>Thu, 5 Aug 2021 13:24:24 +0000</updated>
                            <resolved>Thu, 22 Oct 2020 08:11:58 +0000</resolved>
                                    <version>1.10.1</version>
                    <version>1.11.2</version>
                                    <fixVersion>1.10.3</fixVersion>
                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="17203250" author="till.rohrmann" created="Mon, 28 Sep 2020 14:05:38 +0000"  >&lt;p&gt;Thanks for reporting this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt;. Could you share the JM logs with me privately? They might show us what&apos;s going on on the JM side during this time.&lt;/p&gt;

&lt;p&gt;Is the problem reproducible? If yes, then the DEBUG logs would be very helpful as well.&lt;/p&gt;</comment>
                            <comment id="17203298" author="stevenz3wu" created="Mon, 28 Sep 2020 15:29:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; emailed you the JM logs with INFO level logging.&lt;/p&gt;

&lt;p&gt;It is not easily reproducible, maybe it happens once every 1-2 weeks for a high-parallelism (~1,500) and large state (TBs) job. If DEBUG is required, we can try to enable the DEBUG level logging and wait for it to happen again.&lt;/p&gt;</comment>
                            <comment id="17203916" author="till.rohrmann" created="Tue, 29 Sep 2020 13:06:23 +0000"  >&lt;p&gt;Thanks for providing me with the logs &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt;. I think the debug logs are not necessary. What I found is the following:&lt;/p&gt;

&lt;p&gt;First of all the &lt;tt&gt;ResourceManager&lt;/tt&gt; behaviour seems to be justified. What happens is that the &lt;tt&gt;JobMaster&lt;/tt&gt; connects to the &lt;tt&gt;ResourceManager&lt;/tt&gt; but then fails to respond to the heartbeats (for the reason see further below). Due to this timeout, the &lt;tt&gt;ResourceManager&lt;/tt&gt; disconnects from the &lt;tt&gt;JobMaster&lt;/tt&gt; and rejects future slot requests.&lt;/p&gt;

&lt;p&gt;The reason why the &lt;tt&gt;JobMaster&lt;/tt&gt; fails to respond to the heartbeats is because of an excessive amount of checkpoint recoveries which are happening in the &lt;tt&gt;JobMaster&apos;s&lt;/tt&gt; main thread and are blocking it. The excessive amount of checkpoint recoveries is caused by the embarrassingly parallel nature of the job. After the first failure, I believe that each embarrassingly parallel component of the job will be recovered individually by the &lt;tt&gt;RestartPipelinedRegionFailoverStrategy&lt;/tt&gt;. Each of these pipelined regions will then ask the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt; to restore its state. This operation, however, triggers a recovery of the latest completed checkpoints which causes over and over again the same reads to s3.&lt;/p&gt;

&lt;p&gt;I think there are two problems here:&lt;/p&gt;

&lt;p&gt;1) Checkpoint recovery operations are being executed from within the &lt;tt&gt;JobMaster&apos;s&lt;/tt&gt; main thread. Since these operations can be blocking, we should not do it. I think this problem should be solved with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13698&quot; title=&quot;Rework threading model of CheckpointCoordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13698&quot;&gt;FLINK-13698&lt;/a&gt;.&lt;br/&gt;
2) Each restore operation &lt;tt&gt;CheckpointCoordinator.restoreLatestCheckpointedStateInternal&lt;/tt&gt; will try to recover the latest completed checkpoints. For successive failovers, this is prohibitively expensive and should be avoided.&lt;/p&gt;

&lt;p&gt;Since 1) will be dealt with in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13698&quot; title=&quot;Rework threading model of CheckpointCoordinator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13698&quot;&gt;FLINK-13698&lt;/a&gt;, I think that this issue can concentrate on 2). &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; are you aware of this problem?&lt;/p&gt;</comment>
                            <comment id="17203919" author="till.rohrmann" created="Tue, 29 Sep 2020 13:07:16 +0000"  >&lt;p&gt;Since the problem seems to be caused by the &lt;tt&gt;CheckpointCoordintor&lt;/tt&gt;, I will update the component accordingly.&lt;/p&gt;</comment>
                            <comment id="17204031" author="stevenz3wu" created="Tue, 29 Sep 2020 15:27:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; thanks a lot for looking into the problem. Just a small clarification on the job, it is a stream join job with keyBy and co-process functions.&lt;/p&gt;</comment>
                            <comment id="17204503" author="till.rohrmann" created="Wed, 30 Sep 2020 07:12:17 +0000"  >&lt;p&gt;In the logs it looks as if you also have an embarrassingly parallel part: Several sources which are chained with a flat map and then two filters which are chained with a process function and sinks. I believe that this part causes the repeated checkpoint recoveries.&lt;/p&gt;</comment>
                            <comment id="17204732" author="stevenz3wu" created="Wed, 30 Sep 2020 13:27:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; just to clarify, do you mean operator chain caused the repeated checkpoint recoveries? i.e.  if an operator chain has 3 operators, we are repeating checkpoint recoveries 3 times no matter the 3 operators has state or not.&lt;/p&gt;

&lt;p&gt;In this job, only two Kafka sources and the co-process functions have state. It has 3 operator chains as Till described (two operator chains for source, one operator chain for co-process+sink).&lt;/p&gt;

</comment>
                            <comment id="17204827" author="till.rohrmann" created="Wed, 30 Sep 2020 15:43:18 +0000"  >&lt;p&gt;No, the 3 operator chains are recovered together. However, we do this operation for every subtask index which means that we read the checkpoints &lt;tt&gt;parallelism&lt;/tt&gt; times.&lt;/p&gt;</comment>
                            <comment id="17208335" author="roman_khachatryan" created="Mon, 5 Oct 2020 21:28:30 +0000"  >&lt;p&gt;I do see that the same data is downloaded over and over, but I&apos;m not sure whether it&apos;s the root cause.&lt;br/&gt;
 From the logs I see that heartbeats&#160;&lt;b&gt;on JM&lt;/b&gt; from TMs are expired first, and heartbeats&#160;&lt;b&gt;on TMs&lt;/b&gt;&#160;from JM expire two minutes later:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
flink-19401 $ grep -ah -B1 &lt;span class=&quot;code-quote&quot;&gt;&apos;Heartbeat of Task&apos;&lt;/span&gt; *.log | grep &lt;span class=&quot;code-quote&quot;&gt;&apos;^2020&apos;&lt;/span&gt; | cut -c-16 | sort | uniq -c
     66 2020-09-18 23:57
     11 2020-09-19 01:06
flink-19401 $ grep -ah -B1 &lt;span class=&quot;code-quote&quot;&gt;&apos;heartbeat of Job&apos;&lt;/span&gt; *.log | grep &lt;span class=&quot;code-quote&quot;&gt;&apos;^2020&apos;&lt;/span&gt; | cut -c-16 | sort | uniq -c
    509 2020-09-18 23:59
      2 2020-09-19 00:03
      2 2020-09-19 00:32
      2 2020-09-19 00:37
      2 2020-09-19 01:06
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(77 vs 517 is due to parallelism level I think)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Furthermore, the first 8 recoveries start after failures in Kafka: NPE in NetworkClient and &quot;SSLProtocolException: Handshake message sequence violation, 2&quot;.&lt;/p&gt;

&lt;p&gt;Then they happen after Kafka failures and the aforementioned TM heartbeat timeouts on JM.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So it looks like that the root cause is misconfiguration and/or network.&lt;/p&gt;

&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Steven, can you please also explain what Titus is doing here?&lt;br/&gt;
 (looks like it&apos;is adding and then removing the task every minute - does it ring any bell?)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ grep 72cc604b-dcd5-4c75-a466-0321d7c51c3e *.log

2020-09-18 23:55:43,804 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60067 ms.
2020-09-18 23:56:11,256 - Deploying Source: ee_clevent_presentation -&amp;gt; ee_clevent_presentationRaw -&amp;gt; cleventPresentation -&amp;gt; Flat Map (510/640) (attempt #1) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:56:11,256 - Deploying Source: k2-logtracevpc -&amp;gt; k2-logtracevpcRaw -&amp;gt; (Filter -&amp;gt; cybertronLogReplicated, Filter -&amp;gt; cybertronLogReplicatedCrossRegion, gpsRequestPivotAudit, gpsRequestPivotAuditCrossRegion) (510/640) (attempt #1) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:56:11,261 - Deploying Source: k2-ee_clevent -&amp;gt; k2-ee_cleventRaw -&amp;gt; (cleventAddToPlaylistCommand -&amp;gt; Flat Map, cleventThumbRating -&amp;gt; Flat Map) (510/640) (attempt #1) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:56:11,261 - Deploying Source: k2-defaultvpc -&amp;gt; k2-defaultvpcRaw -&amp;gt; (PssiPlaybackEvents -&amp;gt; Flat Map, Filter -&amp;gt; cybertronLogUnreplicated) (510/640) (attempt #1) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:56:11,261 - Deploying Filter -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; -&amp;gt; (Sink: cybertron_joiner_client_input_0, Sink: cybertron_joiner_client_input_1) (510/640) (attempt #1) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:56:11,261 - Deploying Filter -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; -&amp;gt; (Sink: cybertron_joiner_server_input_0, Sink: cybertron_joiner_server_input_1) (510/640) (attempt #1) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:56:43,872 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
2020-09-18 23:57:43,940 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60068 ms.
2020-09-18 23:58:44,008 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
2020-09-18 23:59:11,794 - Deploying Source: k2-defaultvpc -&amp;gt; k2-defaultvpcRaw -&amp;gt; (PssiPlaybackEvents -&amp;gt; Flat Map, Filter -&amp;gt; cybertronLogUnreplicated) (488/640) (attempt #3) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:59:27,101 - Deploying Source: k2-defaultvpc -&amp;gt; k2-defaultvpcRaw -&amp;gt; (PssiPlaybackEvents -&amp;gt; Flat Map, Filter -&amp;gt; cybertronLogUnreplicated) (478/640) (attempt #2) to 1273fbc6edbab45548807742b2db6c4e @ 72cc604b-dcd5-4c75-a466-0321d7c51c3e (dataPort=39833)
2020-09-18 23:59:44,075 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60066 ms.
2020-09-19 00:00:44,144 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
2020-09-19 00:01:44,634 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60489 ms.
2020-09-19 00:02:44,710 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
2020-09-19 00:03:44,799 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60088 ms.
2020-09-19 00:04:44,871 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
2020-09-19 00:05:44,938 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60067 ms.
2020-09-19 00:06:45,023 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
2020-09-19 00:07:45,427 - Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e is being removed from TM termination pool after 60404 ms.
2020-09-19 00:08:45,506 - Adding Titus task 72cc604b-dcd5-4c75-a466-0321d7c51c3e to TM termination pool because TM is not registered.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17208437" author="stevenz3wu" created="Tue, 6 Oct 2020 00:42:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; I don&apos;t know if repeated checkpoint recovery is the root/main cause or not. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; identified two problems during his investigation. This is one of the identified problem. &lt;/p&gt;

&lt;p&gt;Regarding the logs related to Titus, please ignore them. They are just noise. We haven&apos;t cleaned up our logs yet.&lt;/p&gt;</comment>
                            <comment id="17208502" author="roman_khachatryan" created="Tue, 6 Oct 2020 06:19:36 +0000"  >&lt;p&gt;Thanks for the clarification &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I looked at the code again and I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&#160;is right. The order of heartbeat timeouts is because TMs don&apos;t request heartbeats, only respond.&lt;/p&gt;</comment>
                            <comment id="17218541" author="arvid" created="Wed, 21 Oct 2020 19:35:23 +0000"  >&lt;p&gt;Added to master as be448ecbd97ff9f79daac9ec7b6ec022d8c4e18d.&lt;/p&gt;</comment>
                            <comment id="17218851" author="arvid" created="Thu, 22 Oct 2020 08:11:39 +0000"  >&lt;p&gt;Merged into release-1.11 as bff79f5efffccd1793e09a5e08d0ceb9fe90cf2&lt;br/&gt;
Merged into release-1.10 as 88c06e38d4eff06ac09e4141b988f9a561f286a4&lt;br/&gt;
Closing as resolved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13335128">FLINK-19596</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13335128">FLINK-19596</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13250244">FLINK-13698</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0iw40:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>