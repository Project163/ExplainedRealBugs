<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10465] Jepsen: runit supervised sshd is stopped on tear down</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10465</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When tearing down the &lt;em&gt;DB&lt;/em&gt;, we tear down all services supervised by runit. However when running the tests in Docker, sshd is under supervision by runit. When sshd is stopped, the tests cannot be continued because the control node cannot interact with the DB nodes anymore.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;How to reproduce&lt;/b&gt;&lt;br/&gt;
Run command below in control-node container:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./docker/run-tests.sh 1 [...]/flink/flink-1.6.1/flink-1.6.1-bin-hadoop28-scala_2.11.tgz
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Expected behavior&lt;/b&gt;&lt;br/&gt;
sshd should never be stopped&lt;/p&gt;</description>
                <environment></environment>
        <key id="13188323">FLINK-10465</key>
            <summary>Jepsen: runit supervised sshd is stopped on tear down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gjy">Gary Yao</assignee>
                                    <reporter username="gjy">Gary Yao</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 29 Sep 2018 12:28:50 +0000</created>
                <updated>Tue, 9 Oct 2018 19:46:32 +0000</updated>
                            <resolved>Tue, 9 Oct 2018 19:46:32 +0000</resolved>
                                    <version>1.6.2</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16632981" author="githubbot" created="Sat, 29 Sep 2018 12:38:46 +0000"  >&lt;p&gt;GJL opened a new pull request #6779: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; title=&quot;Jepsen: runit supervised sshd is stopped on tear down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10465&quot;&gt;&lt;del&gt;FLINK-10465&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Do not stop sshd if it is supervised by runit.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6779&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   *See &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; title=&quot;Jepsen: runit supervised sshd is stopped on tear down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10465&quot;&gt;&lt;del&gt;FLINK-10465&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-10465&lt;/a&gt;)&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Do not stop sshd if it is supervised by runit.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Tested manually.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   cc: @igalshilman&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16641817" author="githubbot" created="Mon, 8 Oct 2018 13:16:42 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6779: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; title=&quot;Jepsen: runit supervised sshd is stopped on tear down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10465&quot;&gt;&lt;del&gt;FLINK-10465&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Do not stop sshd if it is supervised by runit.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6779#discussion_r223358568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6779#discussion_r223358568&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-jepsen/src/jepsen/flink/utils.clj&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -86,4 +86,7 @@&lt;br/&gt;
   []&lt;br/&gt;
   (info &quot;Stop all supervised services.&quot;)&lt;br/&gt;
   (c/su&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(c/exec :rm :-f (c/lit (str &quot;/etc/service/*&quot;)))))&lt;br/&gt;
+    ;; HACK:&lt;br/&gt;
+    ;; Remove all symlinks in /etc/service except sshd.&lt;br/&gt;
+    ;; This is only relevant when tests are run in Docker because there sshd is started using runit.&lt;br/&gt;
+    (c/exec :find (c/lit (str &quot;/etc/service -maxdepth 1 -type l ! -name &apos;sshd&apos; -delete&quot;)))))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I wonder if excluding by name is not already good enough?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643250" author="githubbot" created="Tue, 9 Oct 2018 12:25:23 +0000"  >&lt;p&gt;GJL commented on a change in pull request #6779: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; title=&quot;Jepsen: runit supervised sshd is stopped on tear down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10465&quot;&gt;&lt;del&gt;FLINK-10465&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Do not stop sshd if it is supervised by runit.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6779#discussion_r223677409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6779#discussion_r223677409&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-jepsen/src/jepsen/flink/utils.clj&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -86,4 +86,7 @@&lt;br/&gt;
   []&lt;br/&gt;
   (info &quot;Stop all supervised services.&quot;)&lt;br/&gt;
   (c/su&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(c/exec :rm :-f (c/lit (str &quot;/etc/service/*&quot;)))))&lt;br/&gt;
+    ;; HACK:&lt;br/&gt;
+    ;; Remove all symlinks in /etc/service except sshd.&lt;br/&gt;
+    ;; This is only relevant when tests are run in Docker because there sshd is started using runit.&lt;br/&gt;
+    (c/exec :find (c/lit (str &quot;/etc/service -maxdepth 1 -type l ! -name &apos;sshd&apos; -delete&quot;)))))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I prefer to leave `-maxdepth` to avoid accidental recursive traversal. Without `-l` it tries to delete the directory.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643251" author="githubbot" created="Tue, 9 Oct 2018 12:25:37 +0000"  >&lt;p&gt;GJL commented on issue #6779: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; title=&quot;Jepsen: runit supervised sshd is stopped on tear down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10465&quot;&gt;&lt;del&gt;FLINK-10465&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Do not stop sshd if it is supervised by runit.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6779#issuecomment-428171839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6779#issuecomment-428171839&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the review. Merging.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643265" author="githubbot" created="Tue, 9 Oct 2018 12:31:34 +0000"  >&lt;p&gt;GJL closed pull request #6779: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10465&quot; title=&quot;Jepsen: runit supervised sshd is stopped on tear down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10465&quot;&gt;&lt;del&gt;FLINK-10465&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Do not stop sshd if it is supervised by runit.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6779&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-jepsen/src/jepsen/flink/utils.clj b/flink-jepsen/src/jepsen/flink/utils.clj&lt;br/&gt;
index 50d0075ca35..5f96f8c00b7 100644&lt;br/&gt;
&amp;#8212; a/flink-jepsen/src/jepsen/flink/utils.clj&lt;br/&gt;
+++ b/flink-jepsen/src/jepsen/flink/utils.clj&lt;br/&gt;
@@ -86,4 +86,7 @@&lt;br/&gt;
   []&lt;br/&gt;
   (info &quot;Stop all supervised services.&quot;)&lt;br/&gt;
   (c/su&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(c/exec :rm :-f (c/lit (str &quot;/etc/service/*&quot;)))))&lt;br/&gt;
+    ;; HACK:&lt;br/&gt;
+    ;; Remove all symlinks in /etc/service except sshd.&lt;br/&gt;
+    ;; This is only relevant when tests are run in Docker because there sshd is started using runit.&lt;br/&gt;
+    (c/exec :find (c/lit (str &quot;/etc/service -maxdepth 1 -type l ! -name &apos;sshd&apos; -delete&quot;)))))&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643266" author="gjy" created="Tue, 9 Oct 2018 12:32:36 +0000"  >&lt;p&gt;fixed via&lt;/p&gt;

&lt;p&gt;1.6: &lt;br/&gt;
	f3865aa6e61aaed27cfbb7ff89cd29d945981247&lt;br/&gt;
	34430be7458d70be3916441698b8fc466899064b&lt;/p&gt;

&lt;p&gt;1.7: &lt;br/&gt;
	02d1057794de9f4868886c08f1abeeb7fd31f9cf&lt;br/&gt;
	d376f1e1f9880c18d137db414099ffb6833e07f&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yn4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>