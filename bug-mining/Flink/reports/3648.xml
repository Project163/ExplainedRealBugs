<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15434] testResourceManagerConnectionAfterRegainingLeadership test fail when run  azure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15434</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Error message&lt;br/&gt;
Expected: &amp;lt;b65797325db6323dd5f8bdfeeaa18467&amp;gt;&lt;br/&gt;
 but: was &amp;lt;57f975298d116a9d7623f5a844ce6502&amp;gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
Stack trace&lt;br/&gt;
java.lang.AssertionError: Expected: &amp;lt;b65797325db6323dd5f8bdfeeaa18467&amp;gt; but: was &amp;lt;57f975298d116a9d7623f5a844ce6502&amp;gt; at org.apache.flink.runtime.jobmaster.JobMasterTest.testResourceManagerConnectionAfterRegainingLeadership(JobMasterTest.java:1033)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13276721">FLINK-15434</key>
            <summary>testResourceManagerConnectionAfterRegainingLeadership test fail when run  azure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hailong wang">hailong wang</assignee>
                                    <reporter username="hailong wang">hailong wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 28 Dec 2019 23:48:55 +0000</created>
                <updated>Wed, 15 Jan 2020 09:13:33 +0000</updated>
                            <resolved>Wed, 15 Jan 2020 09:13:33 +0000</resolved>
                                    <version>1.9.1</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17006260" author="hailong wang" created="Tue, 31 Dec 2019 23:54:38 +0000"  >&lt;p&gt;I reproduced this problem on my laptop, and the debug log as follow:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; akka.event.slf4j.Slf4jLogger&#160; - Slf4jLogger started0&#160; &#160; [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; akka.event.slf4j.Slf4jLogger&#160; - Slf4jLogger started72&#160; &#160;[flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG akka.event.EventStream&#160; - logger log1-Slf4jLogger started79&#160; &#160;[flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG akka.event.EventStream&#160; - Default Loggers started1165 [main] INFO&#160; org.apache.flink.runtime.jobmaster.JobMasterTest&#160; -&#160;================================================================================Test testResourceManagerConnectionAfterRegainingLeadership(org.apache.flink.runtime.jobmaster.JobMasterTest) is running.--------------------------------------------------------------------------------4106 [main] INFO&#160; org.apache.flink.runtime.rpc.akka.AkkaRpcService&#160; - Starting RPC endpoint &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.flink.runtime.jobmaster.JobMaster at akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/jobmanager_0 .4171 [main] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Initializing job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4268 [main] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Using restart strategy NoRestartStrategy &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4362 [main] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job recovers via failover strategy: full graph restart4433 [main] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Running initialization on master &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4433 [main] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Successfully ran initialization on master in 0 ms.4439 [main] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Adding 0 vertices from job graph (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4439 [main] DEBUG org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Attaching 0 topologically sorted vertices to existing job graph with 0 vertices and 0 intermediate results.4484 [main] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Successfully created execution graph from job graph (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4518 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Starting execution of job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6) under job master id 5b6d296cfdedc261c4bbd525aea971b3.4521 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6) switched from state CREATED to RUNNING.4533 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4537 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4543 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Connecting to ResourceManager localhost/cc67ffdf-cb14-4f8a-bf85-ddd6f11327b2(5421d4878888c36920c6ee4eb0136801)4556 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Resolved ResourceManager address, beginning registration4557 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Registration at ResourceManager attempt 1 (timeout=100ms)4565 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4594 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.into 5b6d296cfdedc261c4bbd525aea971b3, f781d92dbe44f52505eff1b144e45bb64619 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - JobManager successfully registered at ResourceManager, leader id: 5421d4878888c36920c6ee4eb0136801.4629 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4656 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4657 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - The heartbeat of ResourceManager with id 4cce21c1eac0cad2675e364a1d0f41c1 timed out.4668 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Close ResourceManager connection 4cce21c1eac0cad2675e364a1d0f41c1.org.apache.flink.runtime.jobmaster.JobMasterException: The heartbeat of ResourceManager with id 4cce21c1eac0cad2675e364a1d0f41c1 timed out. at org.apache.flink.runtime.jobmaster.JobMaster$ResourceManagerHeartbeatListener.notifyHeartbeatTimeout(JobMaster.java:1179) at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl$HeartbeatMonitor.run(HeartbeatManagerImpl.java:318) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRunAsync(AkkaRpcActor.java:397) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:190) at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:74) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleMessage(AkkaRpcActor.java:152) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21) at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123) at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:170) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:517) at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225) at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592) at akka.actor.ActorCell.invoke(ActorCell.scala:561) at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258) at akka.dispatch.Mailbox.run(Mailbox.scala:225) at akka.dispatch.Mailbox.exec(Mailbox.scala:235) at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)4679 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Connecting to ResourceManager localhost/cc67ffdf-cb14-4f8a-bf85-ddd6f11327b2(5421d4878888c36920c6ee4eb0136801)4682 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-6] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Resolved ResourceManager address, beginning registration4683 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-6] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Registration at ResourceManager attempt 1 (timeout=100ms)into 5b6d296cfdedc261c4bbd525aea971b3, f781d92dbe44f52505eff1b144e45bb64682 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4685 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - JobManager successfully registered at ResourceManager, leader id: 5421d4878888c36920c6ee4eb0136801.4686 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4713 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6) switched from state RUNNING to SUSPENDED.org.apache.flink.util.FlinkException: Test exception. at org.apache.flink.runtime.jobmaster.JobMasterTest.testResourceManagerConnectionAfterRegainingLeadership(JobMasterTest.java:1025) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.junit.runner.JUnitCore.run(JUnitCore.java:137) at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68) at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33) at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230) at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)4730 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job f781d92dbe44f52505eff1b144e45bb6 has been suspended.4731 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl&#160; - Suspending SlotPool.4731 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Close ResourceManager connection 4cce21c1eac0cad2675e364a1d0f41c1.org.apache.flink.util.FlinkException: Test exception. at org.apache.flink.runtime.jobmaster.JobMasterTest.testResourceManagerConnectionAfterRegainingLeadership(JobMasterTest.java:1025) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.junit.runner.JUnitCore.run(JUnitCore.java:137) at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68) at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33) at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230) at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)4733 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor&#160; - Fencing token not set: Ignoring message LocalFencedMessage(5b6d296cfdedc261c4bbd525aea971b3, org.apache.flink.runtime.rpc.messages.RunAsync@4826bb87) because the fencing token is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.4739 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor&#160; - Fencing token not set: Ignoring message LocalFencedMessage(5b6d296cfdedc261c4bbd525aea971b3, org.apache.flink.runtime.rpc.messages.RunAsync@5ebd3007) because the fencing token is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.4740 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor&#160; - Fencing token not set: Ignoring message LocalFencedMessage(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, org.apache.flink.runtime.rpc.messages.RunAsync@53eb8b7a) because the fencing token is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.4744 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Starting execution of job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6) under job master id 8db9e94add813aacf2794eb6881a1573.4747 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Using restart strategy NoRestartStrategy &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4749 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job recovers via failover strategy: full graph restart4749 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Running initialization on master &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4749 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Successfully ran initialization on master in 0 ms.4749 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Adding 0 vertices from job graph (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4750 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Attaching 0 topologically sorted vertices to existing job graph with 0 vertices and 0 intermediate results.4750 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Successfully created execution graph from job graph (unnamed job) (f781d92dbe44f52505eff1b144e45bb6).4755 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6) switched from state CREATED to RUNNING.4756 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.5b6d296cfdedc261c4bbd525aea971b34758 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Connecting to ResourceManager localhost/cc67ffdf-cb14-4f8a-bf85-ddd6f11327b2(5421d4878888c36920c6ee4eb0136801)4758 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4758 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Resolved ResourceManager address, beginning registration4758 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Registration at ResourceManager attempt 1 (timeout=100ms)5b6d296cfdedc261c4bbd525aea971b3into 8db9e94add813aacf2794eb6881a1573, f781d92dbe44f52505eff1b144e45bb64760 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-4] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - JobManager successfully registered at ResourceManager, leader id: 5421d4878888c36920c6ee4eb0136801.4787 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - The heartbeat of ResourceManager with id 4cce21c1eac0cad2675e364a1d0f41c1 timed out.4787 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Close ResourceManager connection 4cce21c1eac0cad2675e364a1d0f41c1.org.apache.flink.runtime.jobmaster.JobMasterException: The heartbeat of ResourceManager with id 4cce21c1eac0cad2675e364a1d0f41c1 timed out. at org.apache.flink.runtime.jobmaster.JobMaster$ResourceManagerHeartbeatListener.notifyHeartbeatTimeout(JobMaster.java:1179) at org.apache.flink.runtime.heartbeat.HeartbeatManagerImpl$HeartbeatMonitor.run(HeartbeatManagerImpl.java:318) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRunAsync(AkkaRpcActor.java:397) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:190) at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:74) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleMessage(AkkaRpcActor.java:152) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21) at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123) at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:170) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:517) at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225) at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592) at akka.actor.ActorCell.invoke(ActorCell.scala:561) at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258) at akka.dispatch.Mailbox.run(Mailbox.scala:225) at akka.dispatch.Mailbox.exec(Mailbox.scala:235) at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)4788 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Connecting to ResourceManager localhost/cc67ffdf-cb14-4f8a-bf85-ddd6f11327b2(5421d4878888c36920c6ee4eb0136801)4790 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Trigger heartbeat request.4790 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-7] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Resolved ResourceManager address, beginning registration4793 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-7] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Registration at ResourceManager attempt 1 (timeout=100ms)into 8db9e94add813aacf2794eb6881a1573, f781d92dbe44f52505eff1b144e45bb64796 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - JobManager successfully registered at ResourceManager, leader id: 5421d4878888c36920c6ee4eb0136801.4796 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.jobmaster.JobMaster&#160; - Stopping the JobMaster &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job (unnamed job)(f781d92dbe44f52505eff1b144e45bb6).4798 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job (unnamed job) (f781d92dbe44f52505eff1b144e45bb6) switched from state RUNNING to SUSPENDED.org.apache.flink.util.FlinkException: JobManager is shutting down. at org.apache.flink.runtime.jobmaster.JobMaster.onStop(JobMaster.java:347) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor$StartedState.terminate(AkkaRpcActor.java:509) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleControlMessage(AkkaRpcActor.java:175) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21) at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123) at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:170) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:517) at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225) at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592) at akka.actor.ActorCell.invoke(ActorCell.scala:561) at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258) at akka.dispatch.Mailbox.run(Mailbox.scala:225) at akka.dispatch.Mailbox.exec(Mailbox.scala:235) at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)4803 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.executiongraph.ExecutionGraph&#160; - Job f781d92dbe44f52505eff1b144e45bb6 has been suspended.4803 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl&#160; - Suspending SlotPool.4804 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] DEBUG org.apache.flink.runtime.jobmaster.JobMaster&#160; - Close ResourceManager connection 4cce21c1eac0cad2675e364a1d0f41c1.org.apache.flink.util.FlinkException: JobManager is shutting down. at org.apache.flink.runtime.jobmaster.JobMaster.onStop(JobMaster.java:347) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor$StartedState.terminate(AkkaRpcActor.java:509) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleControlMessage(AkkaRpcActor.java:175) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26) at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21) at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123) at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:170) at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:517) at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225) at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592) at akka.actor.ActorCell.invoke(ActorCell.scala:561) at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258) at akka.dispatch.Mailbox.run(Mailbox.scala:225) at akka.dispatch.Mailbox.exec(Mailbox.scala:235) at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)4805 [flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] INFO&#160; org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl&#160; - Stopping SlotPool.4916 [main] ERROR org.apache.flink.runtime.jobmaster.JobMasterTest&#160; -&#160;--------------------------------------------------------------------------------Test testResourceManagerConnectionAfterRegainingLeadership(org.apache.flink.runtime.jobmaster.JobMasterTest) failed with:java.lang.AssertionError:&#160;Expected: &amp;lt;8db9e94add813aacf2794eb6881a1573&amp;gt;&#160; &#160; &#160;but: was &amp;lt;5b6d296cfdedc261c4bbd525aea971b3&amp;gt; at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20) at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:8) at org.apache.flink.runtime.jobmaster.JobMasterTest.testResourceManagerConnectionAfterRegainingLeadership(JobMasterTest.java:1034) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.junit.runner.JUnitCore.run(JUnitCore.java:137) at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68) at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33) at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230) at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)
&lt;/span&gt;================================================================================4942 [main] INFO&#160; org.apache.flink.runtime.rpc.akka.AkkaRpcService&#160; - Stopping Akka RPC service.
java.lang.AssertionError:&#160;Expected: &amp;lt;8db9e94add813aacf2794eb6881a1573&amp;gt;&#160; &#160; &#160;but: was &amp;lt;5b6d296cfdedc261c4bbd525aea971b3&amp;gt;Expected :&amp;lt;8db9e94add813aacf2794eb6881a1573&amp;gt;Actual&#160; &#160;:&amp;lt;5b6d296cfdedc261c4bbd525aea971b3&amp;gt;&amp;lt;Click to see difference&amp;gt; at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20) at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:8) at org.apache.flink.runtime.jobmaster.JobMasterTest.testResourceManagerConnectionAfterRegainingLeadership(JobMasterTest.java:1034) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26) at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27) at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.junit.runner.JUnitCore.run(JUnitCore.java:137) at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68) at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33) at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230) at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; finished with exit code 255&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;According to the log, for the lost&#160;heartbeat of&#160;ResourceManager, It will reconnect. So the&#160;registrationQueue&apos;s element will be old&#160;JobMasterId.&lt;/p&gt;

&lt;p&gt;So I think we can look if&#160;registrationQueue is empty, if so, we delete&#160; it and&#160;offer new value then.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testingResourceManagerGateway.setRegisterJobManagerConsumer(
   jobMasterIdResourceIDStringJobIDTuple4 -&amp;gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!registrationQueue.isEmpty()) {
         registrationQueue.poll();
      }
      registrationQueue.offer(jobMasterIdResourceIDStringJobIDTuple4.f0);
   });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17006533" author="hailong wang" created="Thu, 2 Jan 2020 01:51:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;, Could you help me to have a look? Thank you.&lt;/p&gt;</comment>
                            <comment id="17009888" author="gjy" created="Tue, 7 Jan 2020 16:42:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hailong+wang&quot; class=&quot;user-hover&quot; rel=&quot;hailong wang&quot;&gt;hailong wang&lt;/a&gt; Can you explain how you reproduced the issue locally? I ran this test more than 10000 times without failure.&lt;/p&gt;

&lt;p&gt;If I understand correctly, this is only a problem with the test. Your solution would work but it could also mask out other bugs. Moreover, I think that an AtomicReference would be more suited. Do we know why the heartbeat times out? From what I can see, the timeout is set to only 10 ms, which seems quite low.&lt;/p&gt;

&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17009902" author="gjy" created="Tue, 7 Jan 2020 17:00:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hailong+wang&quot; class=&quot;user-hover&quot; rel=&quot;hailong wang&quot;&gt;hailong wang&lt;/a&gt; After talking to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;, we think it&apos;s best to create the jobmaster with &lt;tt&gt;heartbeatServices&lt;/tt&gt; instead of &lt;tt&gt;fastHeartbeatServices&lt;/tt&gt;. One can use JobMasterBuilder for that. Do you want to work on this issue?&lt;/p&gt;</comment>
                            <comment id="17011503" author="hailong wang" created="Thu, 9 Jan 2020 07:18:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt;&#160;, Thank you for assigning this ticket to me. I will change&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JobMaster jobMaster = createJobMaster(
   configuration,
   jobGraph,
   haServices,
   &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestingJobManagerSharedServicesBuilder().build());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JobMaster jobMaster = createJobMaster(
   configuration,
   jobGraph,
   haServices,
   &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestingJobManagerSharedServicesBuilder().build(),
   heartbeatServices);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;BTW, should we do the same&#160; in&#160;testReconnectionAfterDisconnect() method?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17011613" author="gjy" created="Thu, 9 Jan 2020 09:35:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hailong+wang&quot; class=&quot;user-hover&quot; rel=&quot;hailong wang&quot;&gt;hailong wang&lt;/a&gt; I assigned you to the issue. We should fix all misusages of the fast heartbeat timeout in JobMasterTest.&lt;/p&gt;</comment>
                            <comment id="17011772" author="hailong wang" created="Thu, 9 Jan 2020 12:38:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt;&#160;OK, I have open a PR.&lt;/p&gt;</comment>
                            <comment id="17015746" author="gjy" created="Wed, 15 Jan 2020 09:13:33 +0000"  >&lt;p&gt;1.10: efe266fa9143446a33072a3cdece52c64b83f185&lt;br/&gt;
master: e1ad65b3a511fb81425ab5a9364db5661eac1a84&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0a1xs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>