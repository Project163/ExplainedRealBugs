<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-35833] ArtifactFetchManager always creates artifact dir</title>
                <link>https://issues.apache.org/jira/browse/FLINK-35833</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-28915&quot; title=&quot;Make application mode could support remote DFS schema(e.g. S3, OSS, HDFS, etc.)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-28915&quot;&gt;&lt;del&gt;FLINK-28915&lt;/del&gt;&lt;/a&gt; added support for remote job jar fetching (HTTPS, S3, etc) but broke the default behavior of local jar when running application on non-writable filesystems. ArtifactFetchManager always attempts to create an artifact directory, even when jar is using &quot;local&quot; protocol.&lt;/p&gt;

&lt;p&gt;Running application on non-writable filesystem is a common scenario in environments when jar is published with the Docker container image.&lt;/p&gt;

&lt;p&gt;A local jar has no need to be fetched to an intermediate directory, since it&apos;s already available on the local filesytem. The LocalArtifactFetcher does not write to the filesystem. However, the ArtifactFetchManager always attempts to create a directory before fetching, regardless of which fetcher would do the work. On non-writable filesystem and environments lacking permissions, the outcome is a runtime exception:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;java.lang.RuntimeException: org.apache.flink.util.FlinkRuntimeException: Failed&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;to create parent(s) for given base dir:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;/opt/flink/artifacts/&amp;lt;namesapce&amp;gt;/&amp;lt;job name&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.fetchArtifacts(KubernetesApplicationClusterEntrypoint.java:158) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.getPackagedProgramRetriever(KubernetesApplicationClusterEntrypoint.java:129) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.getPackagedProgram(KubernetesApplicationClusterEntrypoint.java:111) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.lambda$main$0(KubernetesApplicationClusterEntrypoint.java:85) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:28) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.main(KubernetesApplicationClusterEntrypoint.java:85) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Caused by: org.apache.flink.util.FlinkRuntimeException: Failed to create parent(s) for given base dir: /opt/flink/artifacts/app07772/sample-app-flink-1-19&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.client.program.artifact.ArtifactUtils.createMissingParents(ArtifactUtils.java:50) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.client.program.artifact.ArtifactFetchManager.fetchArtifacts(ArtifactFetchManager.java:123) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.fetchArtifacts(KubernetesApplicationClusterEntrypoint.java:156) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; ... 5 more&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Caused by: java.io.IOException: Cannot create directory &apos;/opt/flink/artifacts/&amp;lt;namespace&amp;gt;&apos;.&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.commons.io.FileUtils.mkdirs(FileUtils.java:2289) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.commons.io.FileUtils.forceMkdir(FileUtils.java:1376) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.commons.io.FileUtils.forceMkdirParent(FileUtils.java:1394) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.client.program.artifact.ArtifactUtils.createMissingParents(ArtifactUtils.java:46) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.client.program.artifact.ArtifactFetchManager.fetchArtifacts(ArtifactFetchManager.java:123) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.flink.kubernetes.entrypoint.KubernetesApplicationClusterEntrypoint.fetchArtifacts(KubernetesApplicationClusterEntrypoint.java:156) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist-1.19.1.jar:1.19.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; ... 5 more&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;A workaround is to always specify a location using configuration that allows the process to create directories e.g., user.artifacts.base-dir: /tmp/foo.&lt;/p&gt;

&lt;p&gt;A solution proposal is to enable each fetcher to decide whether to create the intermediate directory or fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13585766">FLINK-35833</key>
            <summary>ArtifactFetchManager always creates artifact dir</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fcsaky">Ferenc Csaky</assignee>
                                    <reporter username="dylanmei">Dylan Meissner</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 14 Jul 2024 18:58:41 +0000</created>
                <updated>Mon, 14 Oct 2024 17:49:32 +0000</updated>
                            <resolved>Mon, 14 Oct 2024 17:49:32 +0000</resolved>
                                    <version>1.20.0</version>
                    <version>1.19.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.19.2</fixVersion>
                    <fixVersion>1.20.1</fixVersion>
                                    <component>Client / Job Submission</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17888190" author="JIRAUSER298834" created="Thu, 10 Oct 2024 08:02:50 +0000"  >&lt;p&gt;I have looked into this yesterday, and I think we could move the call to ArtifactUtils.createMissingParents to HttpArtifactFetcher and FsArtifactFetcher as advised here. Or we could leave it like this, and don&apos;t crash the program upon any IO exceptions during creating that directory, just log it.&lt;/p&gt;

&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fcsaky&quot; class=&quot;user-hover&quot; rel=&quot;fcsaky&quot;&gt;fcsaky&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17888318" author="JIRAUSER306586" created="Thu, 10 Oct 2024 15:22:04 +0000"  >&lt;p&gt;Thanks for the analysis &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dylanmei&quot; class=&quot;user-hover&quot; rel=&quot;dylanmei&quot;&gt;dylanmei&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mateczagany&quot; class=&quot;user-hover&quot; rel=&quot;mateczagany&quot;&gt;mateczagany&lt;/a&gt;! Skip trying to create the base parents for the &quot;local://&quot; fetcher, sounds good to me, opened the PR with the relevant changes.&lt;/p&gt;</comment>
                            <comment id="17889289" author="JIRAUSER306586" created="Mon, 14 Oct 2024 17:49:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/8aceaaa8d42c1d8d3ea32750db6d346e24c2c3e6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;8aceaaa&lt;/tt&gt;&lt;/a&gt; in master&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/commit/1691a4e4a335072a9ce085c49909fcf9d4e24858&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;1691a4e&lt;/tt&gt;&lt;/a&gt; in release-1.20&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/commit/61cd5f4999b34ece5f67113b9c4de56df018d776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;61cd5f4&lt;/tt&gt;&lt;/a&gt; in release-1.19&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13594870">FLINK-36464</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13476291">FLINK-28915</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qc0g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>