<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-16198] FileUtilsTest fails on Mac OS</title>
                <link>https://issues.apache.org/jira/browse/FLINK-16198</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The following tests fail if run on Mac OS (IDE/maven).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;FileUtilsTest.testCompressionOnRelativePath:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.nio.file.NoSuchFileException: ../../../../../&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/67/v4yp_42d21j6_n8k1h556h0c0000gn/T/junit6496651678375117676/compressDir/rootDirjava.nio.file.NoSuchFileException: ../../../../../&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/67/v4yp_42d21j6_n8k1h556h0c0000gn/T/junit6496651678375117676/compressDir/rootDir
 at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86) at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102) at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107) at sun.nio.fs.UnixFileSystemProvider.createDirectory(UnixFileSystemProvider.java:384) at java.nio.file.Files.createDirectory(Files.java:674) at org.apache.flink.util.FileUtilsTest.verifyDirectoryCompression(FileUtilsTest.java:440) at org.apache.flink.util.FileUtilsTest.testCompressionOnRelativePath(FileUtilsTest.java:261) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48) at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55) at org.junit.rules.RunRules.evaluate(RunRules.java:20) at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) at org.junit.runners.ParentRunner.run(ParentRunner.java:363) at org.junit.runner.JUnitCore.run(JUnitCore.java:137) at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68) at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47) at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242) at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;FileUtilsTest.testDeleteDirectoryConcurrently:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.nio.file.FileSystemException: /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/67/v4yp_42d21j6_n8k1h556h0c0000gn/T/junit7558825557740784886/junit3566161583262218465/ab1fa0bde8b22cad58b717508c7a7300/121fdf5f7b057183843ed2e1298f9b66/6598025f390d3084d69c98b36e542fe2/8db7cd9c063396a19a86f5b63ce53f66: Invalid argument	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:91)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
	at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:244)
	at sun.nio.fs.AbstractFileSystemProvider.deleteIfExists(AbstractFileSystemProvider.java:108)
	at java.nio.file.Files.deleteIfExists(Files.java:1165)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:324)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:320)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:320)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:320)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteDirectory(FileUtils.java:276)
	at org.apache.flink.util.FileUtilsTest$Deleter.go(FileUtilsTest.java:515)
	at org.apache.flink.core.testutils.CheckedThread.run(CheckedThread.java:74)java.nio.file.FileSystemException: /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/67/v4yp_42d21j6_n8k1h556h0c0000gn/T/junit7558825557740784886/junit3566161583262218465/ab1fa0bde8b22cad58b717508c7a7300/121fdf5f7b057183843ed2e1298f9b66/6598025f390d3084d69c98b36e542fe2/8db7cd9c063396a19a86f5b63ce53f66: Invalid argument

	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:91)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
	at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:244)
	at sun.nio.fs.AbstractFileSystemProvider.deleteIfExists(AbstractFileSystemProvider.java:108)
	at java.nio.file.Files.deleteIfExists(Files.java:1165)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:324)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:320)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:320)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectoryInternal(FileUtils.java:320)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteFileOrDirectory(FileUtils.java:258)
	at org.apache.flink.util.FileUtils.cleanDirectoryInternal(FileUtils.java:376)
	at org.apache.flink.util.FileUtils.deleteDirectoryInternal(FileUtils.java:335)
	at org.apache.flink.util.FileUtils.guardIfWindows(FileUtils.java:391)
	at org.apache.flink.util.FileUtils.deleteDirectory(FileUtils.java:276)
	at org.apache.flink.util.FileUtilsTest$Deleter.go(FileUtilsTest.java:515)
	at org.apache.flink.core.testutils.CheckedThread.run(CheckedThread.java:74)%MCEPASTEBIN%&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13286736">FLINK-16198</key>
            <summary>FileUtilsTest fails on Mac OS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fishzhe">Zhe Yu</assignee>
                                    <reporter username="azagrebin">Andrey Zagrebin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>starter</label>
                    </labels>
                <created>Fri, 21 Feb 2020 11:20:27 +0000</created>
                <updated>Wed, 10 Jun 2020 08:54:48 +0000</updated>
                            <resolved>Wed, 10 Jun 2020 08:54:27 +0000</resolved>
                                                    <fixVersion>1.12.0</fixVersion>
                                    <component>FileSystems</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17088449" author="rmetzger" created="Tue, 21 Apr 2020 09:00:14 +0000"  >&lt;p&gt;I ran into this issue as well today. It&apos;s a bit dissatisfying that the tests are not passing on macs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="17094297" author="frank wang" created="Tue, 28 Apr 2020 08:38:45 +0000"  >&lt;p&gt;I test the example,&lt;br/&gt;
1. i delete the some code, the test is ok&#160;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&#160;@Test&lt;br/&gt;
	public void testCompressionOnRelativePath() throws IOException &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
		final java.nio.file.Path compressDir = tmp.newFolder(&amp;quot;compressDir&amp;quot;).toPath();
                 delete this code
		/*final java.nio.file.Path relativeCompressDir =
			Paths.get(new File(&amp;quot;&amp;quot;).getAbsolutePath()).relativize(compressDir);
*/
		verifyDirectoryCompression(compressDir);
	}&lt;/span&gt; &lt;/div&gt;&lt;/blockquote&gt;

&lt;p&gt;2. i think the problems is duing to concurrency, in FileUtils.java, the guardIfWindows method&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;private static void guardIfWindows(ThrowingConsumer&amp;lt;File, IOException&amp;gt; toRun, File file) throws IOException {&lt;br/&gt;
		if (!OperatingSystem.isWindows()) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
			toRun.accept(file);
		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;		else {&lt;br/&gt;
			// for windows, we synchronize on a global lock, to prevent concurrent delete issues&lt;br/&gt;
			// &amp;gt;&lt;br/&gt;
			// in the future, we may want to find either a good way of working around file visibility&lt;br/&gt;
			// in Windows under concurrent operations (the behavior seems completely unpredictable)&lt;br/&gt;
			// or  make this locking more fine grained, for example  on directory path prefixes&lt;br/&gt;
			synchronized (WINDOWS_DELETE_LOCK) {&lt;br/&gt;
				for (int attempt = 1; attempt &amp;lt;= 10; attempt++) {&lt;br/&gt;
					try &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
						toRun.accept(file);
						break;
					}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;					catch (AccessDeniedException e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
						// ah, windows...
					}&lt;/span&gt; &lt;/div&gt;

&lt;p&gt;					// briefly wait and fall through the loop&lt;br/&gt;
					try &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
						Thread.sleep(1);
					}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
						// restore the interruption flag and error out of the method
						Thread.currentThread().interrupt();
						throw new IOException(&amp;quot;operation interrupted&amp;quot;);
					}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;				}&lt;br/&gt;
			}&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;because it hasnot concurrency control on mac or linux, may be we can modify some code to follow&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;private static void guardIfWindows(ThrowingConsumer&amp;lt;File, IOException&amp;gt; toRun, File file) throws IOException {&lt;br/&gt;
		// for windows, we synchronize on a global lock, to prevent concurrent delete issues&lt;br/&gt;
		// &amp;gt;&lt;br/&gt;
		// in the future, we may want to find either a good way of working around file visibility&lt;br/&gt;
		// in Windows under concurrent operations (the behavior seems completely unpredictable)&lt;br/&gt;
		// or  make this locking more fine grained, for example  on directory path prefixes&lt;br/&gt;
		synchronized (WINDOWS_DELETE_LOCK) {&lt;br/&gt;
			for (int attempt = 1; attempt &amp;lt;= 10; attempt++) {&lt;br/&gt;
				try &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
					toRun.accept(file);
					break;
				}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;				catch (AccessDeniedException e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
					// ah, windows...
				}&lt;/span&gt; &lt;/div&gt;

&lt;p&gt;				// briefly wait and fall through the loop&lt;br/&gt;
				try &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
					Thread.sleep(1);
				}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
					// restore the interruption flag and error out of the method
					Thread.currentThread().interrupt();
					throw new IOException(&amp;quot;operation interrupted&amp;quot;);
				}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;			}&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17098164" author="fishzhe" created="Sun, 3 May 2020 01:48:10 +0000"  >&lt;h3&gt;&lt;a name=&quot;Failedtestcase1%3A%C2%A0FileUtilsTest.testCompressionOnRelativePath&quot;&gt;&lt;/a&gt;Failed test case 1:&#160;FileUtilsTest.testCompressionOnRelativePath&lt;/h3&gt;

&lt;p&gt;&lt;b&gt;Root cause&lt;/b&gt;: failed to create directory using relative path when preparing file for testing.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution&lt;/b&gt;: Since goal of this test case is to verify correctness of&#160;FileUtils.compressDirectory&#160;and&#160;FileUtils.expandDirectory&lt;br/&gt;
 Thus refactor&#160;verifyDirectoryCompression to prepare test data using absolute path while we will still use relative path to test FileUtils method will be sufficient.&#160;&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Failedtestcase2%3A%C2%A0FileUtilsTest.testDeleteDirectoryConcurrently&quot;&gt;&lt;/a&gt;Failed test case 2:&#160;FileUtilsTest.testDeleteDirectoryConcurrently&lt;/h3&gt;

&lt;p&gt;&lt;b&gt;Root cause:&lt;/b&gt;&#160;FileUtils.deleteDirectory is not thread safe. This test case is not always failing. In my local env(MacOS), it failed 7,8 times out of 10. The test case is creating 3 level file&#160;hierarchy like below:&lt;/p&gt;

&lt;p&gt;&#160;a&lt;/p&gt;

&lt;p&gt;&#160;&#160; - b&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; - e&lt;/p&gt;

&lt;p&gt;&#160; &#160;- c&#160;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; - d&lt;/p&gt;

&lt;p&gt;Then the test case started 3 threads. All of them are trying to iterate from root directory: a. Thus, race condition will happen. There will be a chance 2 threads trying to delete /a/b/e/ at the same time. When this happens the test will file. Maybe I&apos;m missing something given &lt;a href=&quot;#L248&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;this comment&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution:&lt;/b&gt;&#160;make &lt;a href=&quot;#L317&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;deleteFileOrDirectoryInternal&lt;/a&gt;&#160;synchronized will protect the test from failing and &lt;a href=&quot;#L389]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;guardIfWindows&lt;/a&gt; can be removed. But it also means concurrent deletion is disabled if 2 threads trying to delete from the same root.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If above proposal sounds reasonable to you, feel free to assign this issue to me. I&apos;m also more than glad to talk about both of them.&#160;&lt;/p&gt;</comment>
                            <comment id="17117961" author="aljoscha" created="Wed, 27 May 2020 17:56:53 +0000"  >&lt;p&gt;Something seems to be wrong with this util. If I change &lt;tt&gt;guardIfWindows()&lt;/tt&gt; to also synchronize this on mac &lt;tt&gt;testDeleteDirectoryConcurrently&lt;/tt&gt; succeeds but now &lt;tt&gt;testDeleteDirectory&lt;/tt&gt; fails. I think the solution is not to make this synchronized for all operating systems, since the original intent of the method is exactly to be safe with concurrency.&lt;/p&gt;

&lt;p&gt;Regarding the relative paths: I would also not simply delete it because there was an original intent with this and the tests do fail so something seems wrong.&lt;/p&gt;</comment>
                            <comment id="17118517" author="stephanewen" created="Thu, 28 May 2020 10:02:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; I believe that. But try building it on windows, even WSL. It is even worse, no chance to pass a build.&lt;/p&gt;

</comment>
                            <comment id="17118620" author="aljoscha" created="Thu, 28 May 2020 12:39:16 +0000"  >&lt;p&gt;I have downgraded to major since this behaviour has existed since Flink 1.2 (when this util was added). We should definitely fix this but not block the release.&lt;/p&gt;

&lt;p&gt;To summarise what I said earlier:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the problem is that file deletion is not thread safe on MacOS (like on windows), we can add an additional guard like for windows&lt;/li&gt;
	&lt;li&gt;we should not make the test serialized because then it wouldn&apos;t test what it is supposed to test anymore&lt;/li&gt;
	&lt;li&gt;the relative paths test doesn&apos;t work on MacOS, we shouldn&apos;t remove the test but find out why it doesn&apos;t work&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17118627" author="till.rohrmann" created="Thu, 28 May 2020 12:49:42 +0000"  >&lt;p&gt;Does it make sense to disable this test for MacOS and Windows until we have (if ever) a proper solution for it (if this hasn&apos;t been done already) &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17118633" author="zentol" created="Thu, 28 May 2020 13:03:03 +0000"  >&lt;p&gt;FileUtilsTest does not fail on Windows at the moment (I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; was referring to Flink as a whole; with many tests failing on Windows/WSL).&lt;/p&gt;

&lt;p&gt;We should not just disable it. It is used by too many components; if this test fails on MacOS then chances are high that others tests fail to.&lt;/p&gt;</comment>
                            <comment id="17118838" author="aljoscha" created="Thu, 28 May 2020 15:40:19 +0000"  >&lt;p&gt;The test was only recently un-ignored:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16065&quot; title=&quot;Unignore FileUtilsTest.testDeleteDirectoryConcurrently()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16065&quot;&gt;&lt;del&gt;FLINK-16065&lt;/del&gt;&lt;/a&gt;. I think the solution is to extend the same guard we have for windows to macOS, because the method just is not thread safe on macOS.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fishzhe&quot; class=&quot;user-hover&quot; rel=&quot;fishzhe&quot;&gt;fishzhe&lt;/a&gt; Would you be interested in doing this?&lt;/p&gt;</comment>
                            <comment id="17118848" author="stephanewen" created="Thu, 28 May 2020 15:52:41 +0000"  >&lt;p&gt;I agree with Aljoscha and Chesnay: Keep all tests, they all serve an important purpose.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;serialize cleanup on MaxOS just like on Windows&lt;/li&gt;
	&lt;li&gt;Diagnose and adjust the relative path directory zipping test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I assume support for parallel cleanup is most important on Unix/Linux where most of the production stuff runs.&lt;/p&gt;</comment>
                            <comment id="17119295" author="fishzhe" created="Fri, 29 May 2020 06:10:42 +0000"  >&lt;p&gt;Hi,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&#160;I&apos;m more than happy to take this.&#160;&lt;/p&gt;


&lt;p&gt;Since this is about two test cases, I&apos;m planning to create 2 sub issues for them. But I&apos;m also OK to deal with them together in this ticket. Let me know which way you prefer. Feel free to assign this issue to me.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Besides, for the zipping test. I think it&apos;s also easy to fix, because the test trying to prepare data using relative path, which break the test. We can just use absolute path to prepare data, when test&#160;compressDirectory method feed relative path.&#160;&lt;/p&gt;

&lt;p&gt;Please let me know if this makes sense to you.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17119391" author="aljoscha" created="Fri, 29 May 2020 08:28:50 +0000"  >&lt;p&gt;I think we can keep only this one issue. I&apos;m assigning it to you.&lt;/p&gt;</comment>
                            <comment id="17126385" author="fishzhe" created="Fri, 5 Jun 2020 04:49:24 +0000"  >&lt;p&gt;PR:&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/12413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/12413&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17130427" author="aljoscha" created="Wed, 10 Jun 2020 08:54:27 +0000"  >&lt;p&gt;master: 20e82afbb36d42be5b18f8e8a0fe45b122e645e9&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13286927">FLINK-16229</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bqps:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>