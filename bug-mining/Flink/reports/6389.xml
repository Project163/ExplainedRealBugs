<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:10:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-26920] Job executes failed with &quot;The configured managed memory fraction for Python worker process must be within (0, 1], was: %s.&quot;</title>
                <link>https://issues.apache.org/jira/browse/FLINK-26920</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; numpy as np
from pyflink.common &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Row
from pyflink.common.typeinfo &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Types
from pyflink.datastream &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamExecutionEnvironment
from pyflink.datastream.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; KeyedProcessFunction, RuntimeContext
from pyflink.table &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamTableEnvironment
from sklearn &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; svm, datasets

env = StreamExecutionEnvironment.get_execution_environment()
t_env = StreamTableEnvironment.create(stream_execution_environment=env)

# Table Source
t_env.execute_sql(&quot;&quot;&quot;
    CREATE TABLE my_source (
        a FLOAT,
        key STRING
    ) WITH (
        &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&apos;rows-per-second&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&apos;fields.a.min&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;4.3&apos;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&apos;fields.a.max&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;7.9&apos;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&apos;fields.key.length&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;
    )
&quot;&quot;&quot;)


def process_type():
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Types.ROW_NAMED(
        [&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;],
        [Types.FLOAT(), Types.STRING()]
    )


# append only datastream
ds = t_env.to_append_stream(
    t_env.from_path(&lt;span class=&quot;code-quote&quot;&gt;&apos;my_source&apos;&lt;/span&gt;),
    process_type())


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyKeyedProcessFunction(KeyedProcessFunction):

    def open(self, runtime_context: RuntimeContext):
        clf = svm.SVC()
        X, y= datasets.load_iris(return_X_y=True)
        clf.fit(X, y)

        self.model = clf


    def process_element(self, value: Row, ctx: &lt;span class=&quot;code-quote&quot;&gt;&apos;KeyedProcessFunction.Context&apos;&lt;/span&gt;):

        # &#26681;&#25454;role_id + space&#21435;redis&#26597;&#35810;&#22238;&#21512;&#32467;&#31639;&#26085;&#24535;

        features = np.array([value[&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;], 3.5, 1.4, 0.2]).reshape(1, -1)
        predict = &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;(self.model.predict(features)[0])

        yield Row(predict=predict, role_id=value[&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt;])


        
ds = ds.key_by(lambda a: a[&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt;], key_type=Types.STRING()) \
    .process(
        MyKeyedProcessFunction(), 
        output_type=Types.ROW_NAMED(
            [&lt;span class=&quot;code-quote&quot;&gt;&quot;hit&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;role_id&quot;&lt;/span&gt;],
            [Types.INT(), Types.STRING()]
    ))


# &#37319;&#29992;table sink
t_env.execute_sql(&quot;&quot;&quot;
        CREATE TABLE my_sink (
          hit INT,
          role_id STRING
        ) WITH (
          &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;print&apos;&lt;/span&gt;
        )
    &quot;&quot;&quot;)

t_env.create_temporary_view(&lt;span class=&quot;code-quote&quot;&gt;&quot;predict&quot;&lt;/span&gt;, ds)
t_env.execute_sql(&quot;&quot;&quot;
    INSERT INTO my_sink
    SELECT * FROM predict
&quot;&quot;&quot;).wait()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It reported the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.IllegalArgumentException: The configured managed memory fraction &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Python worker process must be within (0, 1], was: %s. It may be because the consumer type &lt;span class=&quot;code-quote&quot;&gt;&quot;Python&quot;&lt;/span&gt; was missing or set to 0 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the config option &lt;span class=&quot;code-quote&quot;&gt;&quot;taskmanager.memory.managed.consumer-weights&quot;&lt;/span&gt;.0.0
	at org.apache.flink.util.Preconditions.checkArgument(Preconditions.java:138)
	at org.apache.flink.streaming.api.runners.python.beam.BeamPythonFunctionRunner.open(BeamPythonFunctionRunner.java:233)
	at org.apache.flink.streaming.api.operators.python.AbstractExternalPythonFunctionOperator.open(AbstractExternalPythonFunctionOperator.java:56)
	at org.apache.flink.streaming.api.operators.python.AbstractOneInputPythonFunctionOperator.open(AbstractOneInputPythonFunctionOperator.java:116)
	at org.apache.flink.streaming.api.operators.python.PythonKeyedProcessOperator.open(PythonKeyedProcessOperator.java:121)
	at org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:107)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreGates(StreamTask.java:712)
	at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:688)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:655)
	at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:948)
	at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:917)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:741)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:563)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13436574">FLINK-26920</key>
            <summary>Job executes failed with &quot;The configured managed memory fraction for Python worker process must be within (0, 1], was: %s.&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianfu">Dian Fu</assignee>
                                    <reporter username="dianfu">Dian Fu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 30 Mar 2022 06:39:32 +0000</created>
                <updated>Fri, 1 Apr 2022 11:42:40 +0000</updated>
                            <resolved>Fri, 1 Apr 2022 11:42:30 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.5</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17515881" author="dianfu" created="Fri, 1 Apr 2022 11:42:30 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via 39854d1b70c2234f4079f2e7c846eef81902aec4&lt;/li&gt;
	&lt;li&gt;release-1.15 via 4a3d6e52fe820e53b7f3d9bf301b4a1c7d14ab41&lt;/li&gt;
	&lt;li&gt;release-1.14 via 73d140e3544f65f759bf6c7ca3a7163702386bfc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10ygg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>