<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9381] BlobServer data for a job is not getting cleaned up at JM</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9381</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We are running Flink 1.5.0 rc3 with YARN as cluster manager and found&lt;br/&gt;
 Job Manager is getting killed due to out of disk error.&lt;/p&gt;

&lt;p&gt; Upon further analysis, we found blob server data for a job is not&lt;br/&gt;
 getting cleaned up.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Flink 1.5.0 RC3 Commit&#160;e725269&lt;/p&gt;</environment>
        <key id="13159706">FLINK-9381</key>
            <summary>BlobServer data for a job is not getting cleaned up at JM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="amit.jain">Amit Jain</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 May 2018 12:09:20 +0000</created>
                <updated>Thu, 28 Feb 2019 14:00:56 +0000</updated>
                            <resolved>Thu, 17 May 2018 09:35:57 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16477313" author="zentol" created="Wed, 16 May 2018 12:11:58 +0000"  >&lt;p&gt;Searching for &lt;tt&gt;BlobServer#cleanupJob&lt;/tt&gt; only yields results in the legacy &lt;tt&gt;JobManager&lt;/tt&gt;; it is never called by the &lt;tt&gt;JobMaster&lt;/tt&gt; or &lt;tt&gt;Dispatcher&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; Is this simply missing or are we cleaning up things in another way?&lt;/p&gt;</comment>
                            <comment id="16477600" author="till.rohrmann" created="Wed, 16 May 2018 15:49:39 +0000"  >&lt;p&gt;I think we don&apos;t properly clean up the job resources after the job has finished. I think this is indeed a release blocker. &lt;/p&gt;

&lt;p&gt;I will fix the problem.&lt;/p&gt;</comment>
                            <comment id="16478670" author="githubbot" created="Thu, 17 May 2018 07:38:46 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6030&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9381&quot; title=&quot;BlobServer data for a job is not getting cleaned up at JM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9381&quot;&gt;&lt;del&gt;FLINK-9381&lt;/del&gt;&lt;/a&gt; Release blobs after job termination&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Properly remove job blobs from BlobServer after the job terminates. If the job reaches a globally terminal&lt;br/&gt;
    state, then the HA blob store files will also be cleared. In case of a suspension or that the job is not&lt;br/&gt;
    finished (e.g. another process finsihes the job concurrently), we only remove the local blob server files.&lt;/p&gt;

&lt;p&gt;    Additionally, we properly release the user code class loader registered in the JobManagerRunner when it closes.&lt;/p&gt;

&lt;p&gt;    Moreover, this commit extends the `BlobServer#cleanupJob` method to take a second argument which specifies whether the `BlobStore` files shall be cleaned up or not.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Properly deregister user code class loader from `LibraryCacheManager` in `JobManagerRunner`&lt;/li&gt;
	&lt;li&gt;Remove BlobServer files if the job is removed from the `Dispatcher` in the `removeJob` method&lt;/li&gt;
	&lt;li&gt;Remove HA `BlobStore` files if the job reached a globally terminal state&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added `JobManagerRunnerTest#testLibraryCacheManagerRegistration`&lt;/li&gt;
	&lt;li&gt;Added `DispatcherResourceCleanupTest`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixBlobRelease&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6030.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6030.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6030&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7b77fc85010c8831ecc3704a773f0f944da838a5&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-05-17T06:58:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9381&quot; title=&quot;BlobServer data for a job is not getting cleaned up at JM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9381&quot;&gt;&lt;del&gt;FLINK-9381&lt;/del&gt;&lt;/a&gt; Release blobs after job termination&lt;/p&gt;

&lt;p&gt;    Properly remove job blobs from BlobServer after the job terminates. If the job reaches a globally terminal&lt;br/&gt;
    state, then the HA blob store files will also be cleared. In case of a suspension or that the job is not&lt;br/&gt;
    finished (e.g. another process finsihes the job concurrently), we only remove the local blob server files.&lt;/p&gt;

&lt;p&gt;    Additionally, we properly release the user code class loader registered in the JobManagerRunner when it&lt;br/&gt;
    closes.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16478808" author="githubbot" created="Thu, 17 May 2018 09:34:42 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6030&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16478810" author="till.rohrmann" created="Thu, 17 May 2018 09:35:57 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master: 2735c852b4648ae6f3e8f1e6169ef9ed6ec481d2&lt;br/&gt;
1.5.0: 7fded5f4ed20fb3622ed9bcccab8484c534f12e5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ts1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>