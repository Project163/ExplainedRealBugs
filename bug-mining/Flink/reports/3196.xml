<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13593] Prevent failing the wrong execution attempt in CheckpointFailureManager</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13593</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Due to the asynchronously handling of checkpoint decline message in &lt;tt&gt;LegacyScheduler#declineCheckpoint&lt;/tt&gt;, it&apos;s possible that the message is handled before job status transition thus &lt;tt&gt;receiveDeclineMessage&lt;/tt&gt; grabbed the lock in &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt; before &lt;tt&gt;pendingCheckpoints&lt;/tt&gt; got cleared by &lt;tt&gt;stopCheckpointScheduler&lt;/tt&gt; (as triggered by the job status listener &lt;tt&gt;CheckpointCoordinatorDeActivator&lt;/tt&gt;). And if the job/tasks restarts quickly enough, the &lt;tt&gt;FailJobCallback&lt;/tt&gt; in &lt;tt&gt;CheckpointFailureManager&lt;/tt&gt; might unexpectedly fail the job again, as observed in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13527&quot; title=&quot;Instable KafkaProducerExactlyOnceITCase due to CheckpointFailureManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13527&quot;&gt;&lt;del&gt;FLINK-13527&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To resolve the issue, we need to add a safe guard when failing the job, passing through the &lt;tt&gt;ExecutionAttemptID&lt;/tt&gt; and checking against the current executions to make sure the to-be-failed one is still running, so we won&apos;t fail the newly restarted one by accident.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13249025">FLINK-13593</key>
            <summary>Prevent failing the wrong execution attempt in CheckpointFailureManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyu">Yu Li</assignee>
                                    <reporter username="liyu">Yu Li</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 6 Aug 2019 05:55:05 +0000</created>
                <updated>Mon, 12 Aug 2019 09:59:21 +0000</updated>
                            <resolved>Fri, 9 Aug 2019 12:50:05 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16900670" author="yanghua" created="Tue, 6 Aug 2019 06:12:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;carp84&lt;/a&gt; I think there are several contributors discussed the solution in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497&quot; title=&quot;Checkpoints can complete after CheckpointFailureManager fails job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13497&quot;&gt;&lt;del&gt;FLINK-13497&lt;/del&gt;&lt;/a&gt;. We do not need to create a new issue to describe the issue again. And besides the reason you described, we also need to think about how to stop the new checkpoint been triggered.&lt;/p&gt;

&lt;p&gt;IMO, it&apos;s better to keep more discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497&quot; title=&quot;Checkpoints can complete after CheckpointFailureManager fails job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13497&quot;&gt;&lt;del&gt;FLINK-13497&lt;/del&gt;&lt;/a&gt;. It just needs more&#160;opinion from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;. And &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497&quot; title=&quot;Checkpoints can complete after CheckpointFailureManager fails job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13497&quot;&gt;&lt;del&gt;FLINK-13497&lt;/del&gt;&lt;/a&gt; is not a blocker issue,&#160;IMO &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13527&quot; title=&quot;Instable KafkaProducerExactlyOnceITCase due to CheckpointFailureManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13527&quot;&gt;&lt;del&gt;FLINK-13527&lt;/del&gt;&lt;/a&gt; also could not be a blocker issue.&lt;/p&gt;</comment>
                            <comment id="16900734" author="carp84" created="Tue, 6 Aug 2019 07:57:38 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanghua&quot; class=&quot;user-hover&quot; rel=&quot;yanghua&quot;&gt;yanghua&lt;/a&gt;, the issue described here is dedicated to resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13527&quot; title=&quot;Instable KafkaProducerExactlyOnceITCase due to CheckpointFailureManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13527&quot;&gt;&lt;del&gt;FLINK-13527&lt;/del&gt;&lt;/a&gt; and relatively a different issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497&quot; title=&quot;Checkpoints can complete after CheckpointFailureManager fails job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13497&quot;&gt;&lt;del&gt;FLINK-13497&lt;/del&gt;&lt;/a&gt;. And sure will move to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497&quot; title=&quot;Checkpoints can complete after CheckpointFailureManager fails job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13497&quot;&gt;&lt;del&gt;FLINK-13497&lt;/del&gt;&lt;/a&gt; later for further discussion.&lt;/p&gt;</comment>
                            <comment id="16900739" author="pnowojski" created="Tue, 6 Aug 2019 08:02:14 +0000"  >&lt;p&gt;Creating a separate ticket for this might make sense, since this bug can cause multiple test failures, not only this reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13527&quot; title=&quot;Instable KafkaProducerExactlyOnceITCase due to CheckpointFailureManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13527&quot;&gt;&lt;del&gt;FLINK-13527&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think we can treat this as a release blocker, since the hot fix should be fairly simple. Proper fix would come with removing multi threading here (as I described &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13497?focusedCommentId=16900732&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16900732&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="16903856" author="till.rohrmann" created="Fri, 9 Aug 2019 12:50:05 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.10.0: 7a1222f354499a78e7047db47b403f73460207b1&lt;br/&gt;
1.9.0: 1e22e641e4185e1964459d2486e676526990d719&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13248276">FLINK-13527</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13248276">FLINK-13527</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13250237">FLINK-13695</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05cx4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>