<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:46:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17721] AbstractHadoopFileSystemITTest .cleanupDirectoryWithRetry fails with AssertionError </title>
                <link>https://issues.apache.org/jira/browse/FLINK-17721</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;CI: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1343&amp;amp;view=logs&amp;amp;j=961f8f81-6b52-53df-09f6-7291a2e4af6a&amp;amp;t=2f99feaa-7a9b-5916-4c1c-5e61f395079e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1343&amp;amp;view=logs&amp;amp;j=961f8f81-6b52-53df-09f6-7291a2e4af6a&amp;amp;t=2f99feaa-7a9b-5916-4c1c-5e61f395079e&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 3, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 34.079 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.fs.s3hadoop.HadoopS3FileSystemITCase
[ERROR] org.apache.flink.fs.s3hadoop.HadoopS3FileSystemITCase  Time elapsed: 21.334 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError
	at org.junit.Assert.fail(Assert.java:86)
	at org.junit.Assert.assertTrue(Assert.java:41)
	at org.junit.Assert.assertFalse(Assert.java:64)
	at org.junit.Assert.assertFalse(Assert.java:74)
	at org.apache.flink.runtime.fs.hdfs.AbstractHadoopFileSystemITTest.cleanupDirectoryWithRetry(AbstractHadoopFileSystemITTest.java:162)
	at org.apache.flink.runtime.fs.hdfs.AbstractHadoopFileSystemITTest.teardown(AbstractHadoopFileSystemITTest.java:149)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:33)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13305132">FLINK-17721</key>
            <summary>AbstractHadoopFileSystemITTest .cleanupDirectoryWithRetry fails with AssertionError </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xtsong">Xintong Song</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 15 May 2020 07:44:23 +0000</created>
                <updated>Fri, 16 Oct 2020 10:54:48 +0000</updated>
                            <resolved>Mon, 25 May 2020 12:18:58 +0000</resolved>
                                                    <fixVersion>1.11.0</fixVersion>
                                    <component>FileSystems</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17110927" author="rmetzger" created="Tue, 19 May 2020 07:30:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1713&amp;amp;view=logs&amp;amp;j=d44f43ce-542c-597d-bf94-b0718c71e5e8&amp;amp;t=34f486e1-e1e4-5dd2-9c06-bfdd9b9c74a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1713&amp;amp;view=logs&amp;amp;j=d44f43ce-542c-597d-bf94-b0718c71e5e8&amp;amp;t=34f486e1-e1e4-5dd2-9c06-bfdd9b9c74a8&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17112493" author="rmetzger" created="Wed, 20 May 2020 18:00:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1956&amp;amp;view=logs&amp;amp;j=d44f43ce-542c-597d-bf94-b0718c71e5e8&amp;amp;t=34f486e1-e1e4-5dd2-9c06-bfdd9b9c74a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1956&amp;amp;view=logs&amp;amp;j=d44f43ce-542c-597d-bf94-b0718c71e5e8&amp;amp;t=34f486e1-e1e4-5dd2-9c06-bfdd9b9c74a8&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17112726" author="xintongsong" created="Thu, 21 May 2020 02:16:49 +0000"  >&lt;p&gt;The test failure is caused by &lt;tt&gt;cleanupDirectoryWithRetry&lt;/tt&gt; not deleting the files if the deadline is already reached.&lt;/p&gt;

&lt;p&gt;Deleting files from a remote file system might fail due to, e.g., network problems. Therefore, &lt;tt&gt;cleanupDirectoryWithRetry&lt;/tt&gt; keeps trying to delete the files until success or reaching a deadline. The deadline is defined in &lt;tt&gt;setup&lt;/tt&gt; before executing all test cases. If executing tests takes too long, that the deadline is reached before calling &lt;tt&gt;cleanupDirectoryWithRetry&lt;/tt&gt;, the files will not be deleted leading to the reported failure.&lt;/p&gt;

&lt;p&gt;To fix the problem, we have several options.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The easiest way is to make sure &lt;tt&gt;cleanupDirectoryWithRetry&lt;/tt&gt; at least try to delete the files once, no matter the deadline is reached or not. The shortcoming is that, we may still suffer from the deletion failures due to network issues or asynchronism (which &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13483&quot; title=&quot;PrestoS3FileSystemITCase.testDirectoryListing fails on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13483&quot;&gt;&lt;del&gt;FLINK-13483&lt;/del&gt;&lt;/a&gt; tries to solve). So practically, this test case might be still unstable, just less unstable than now.&lt;/li&gt;
	&lt;li&gt;We can also set a separate timeout or retry limit for &lt;tt&gt;cleanupDirectoryWithRetry&lt;/tt&gt;. This decouples the handling of each potential deletion failure apart from the overall test execution time.&lt;/li&gt;
	&lt;li&gt;The cleanest solution, IMO, is to get rid of the deadlines. Currently, the deadline is used in &lt;tt&gt;checkPathExistence&lt;/tt&gt; and &lt;tt&gt;cleanupDirectoryWithRetry&lt;/tt&gt; as a timeout for verifying the FS status. However, it does not make good sense to me that all the checks in the class share a common deadline. We should have an independent timeout for each check.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;m in favor of option 3. My only concern is that, this change might affect all the subclasses of &lt;tt&gt;AbstractHadoopFileSystemITTest&lt;/tt&gt;. Currently, Flink integrate file systems with its plugin mechanism. That means users may provide their custom FS plugins. If a user extended &lt;tt&gt;AbstractHadoopFileSystemITTest&lt;/tt&gt; for testing his custom plugin, our change might lead to compatibility problems. So the questions is, &lt;b&gt;do we want to maintain backwards compatibility for the testing base class of the FS framework?&lt;/b&gt; From my side, I would not consider &lt;tt&gt;AbstractHadoopFileSystemITTest&lt;/tt&gt; as public interface, thus would be ok with any modification to it. But I think it would be good to collect more opinions.&lt;/p&gt;</comment>
                            <comment id="17112740" author="xintongsong" created="Thu, 21 May 2020 02:47:35 +0000"  >&lt;p&gt;One more comment on option 3.&lt;br/&gt;
&lt;tt&gt;AbstractHadoopFileSystemITTest&lt;/tt&gt; is not annotated with &lt;tt&gt;@Public&lt;/tt&gt; or &lt;tt&gt;@PublicEvolving&lt;/tt&gt;. So practically we have not promise any kind of compatibility on it.&lt;/p&gt;</comment>
                            <comment id="17113680" author="xintongsong" created="Fri, 22 May 2020 02:07:20 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17113997" author="aljoscha" created="Fri, 22 May 2020 12:43:28 +0000"  >&lt;p&gt;Yes, I think option 3) is the best option. I recently increased the deadline for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16911&quot; title=&quot;PrestoS3FileSystemITCase#testSimpleFileWriteAndRead fails on checkPathExistence&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16911&quot;&gt;&lt;del&gt;FLINK-16911&lt;/del&gt;&lt;/a&gt; but I also thought that it&apos;s a bit weird how it&apos;s used in the tests.&lt;/p&gt;</comment>
                            <comment id="17115627" author="xintongsong" created="Mon, 25 May 2020 02:15:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&lt;br/&gt;
Thanks for the feedback. I&apos;ve opened a PR for option 3). Could you help take a look?&lt;/p&gt;</comment>
                            <comment id="17115980" author="aljoscha" created="Mon, 25 May 2020 12:18:58 +0000"  >&lt;p&gt;release-1.11:&#160;6215e1166aa44ce178ae8c068159eb7efeb53041&lt;br/&gt;
master:&#160;e92b2bf19bdf03ad3bae906dc5fa3781aeddb3ee&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0erso:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>