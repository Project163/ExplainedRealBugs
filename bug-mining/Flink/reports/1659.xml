<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6394] GroupCombine reuses instances even though object reuse is disabled</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6394</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I am using group combiner in DataSet API with disabled object reuse.&lt;/p&gt;

&lt;p&gt;In code it may be expressed as follows: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tuples.groupBy(1)
      .combineGroup((it, collector) -&amp;gt; {
         &lt;span class=&quot;code-comment&quot;&gt;// store first item &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; use
&lt;/span&gt;         Pojo stored = it.next();
         &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (it.hasNext()) {
           ....
         }
      })
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems even the object reuse feature is disabled, my instance is actually replaced when &lt;tt&gt;.next()&lt;/tt&gt; is called on the iterator. It leads to very confusing and wrong results.&lt;/p&gt;

&lt;p&gt;I checked the Flink codebase and it seems &lt;tt&gt;CombiningUnilateralSortMerger&lt;/tt&gt; is actually reusing object instances even though object reuse is explicitly disabled.&lt;br/&gt;
In spilling phase user&apos;s combiner is called with instance of &lt;tt&gt;CombineValueIterator&lt;/tt&gt; that actually reuses instances without any warning.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://github.com/apache/flink/blob/d7b59d761601baba6765bb4fc407bcd9fd6a9387/flink-runtime/src/main/java/org/apache/flink/runtime/operators/sort/CombiningUnilateralSortMerger.java#L550&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/d7b59d761601baba6765bb4fc407bcd9fd6a9387/flink-runtime/src/main/java/org/apache/flink/runtime/operators/sort/CombiningUnilateralSortMerger.java#L550&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When I disable combiner and use &lt;tt&gt;groupReduce&lt;/tt&gt; only with the same reduce function, results are fine.&lt;/p&gt;

&lt;p&gt;Please let me know if you can confirm this as a bug. From my point of view it&apos;s highly critical as I am getting unpredictable results.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13067338">FLINK-6394</key>
            <summary>GroupCombine reuses instances even though object reuse is disabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ykt836">Kurt Young</assignee>
                                    <reporter username="vanekjar">Jaromir Vanek</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Apr 2017 11:45:34 +0000</created>
                <updated>Mon, 8 May 2017 12:24:45 +0000</updated>
                            <resolved>Mon, 8 May 2017 12:24:45 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>API / DataSet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15987991" author="ykt836" created="Fri, 28 Apr 2017 01:24:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanekjar&quot; class=&quot;user-hover&quot; rel=&quot;vanekjar&quot;&gt;vanekjar&lt;/a&gt;, thanks for reporting this, i will take a look at it soon.&lt;/p&gt;</comment>
                            <comment id="15990543" author="githubbot" created="Mon, 1 May 2017 02:18:06 +0000"  >&lt;p&gt;GitHub user KurtYoung opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6394&quot; title=&quot;GroupCombine reuses instances even though object reuse is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6394&quot;&gt;&lt;del&gt;FLINK-6394&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Respect object reuse configuration when execut&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ing group combining function&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/KurtYoung/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/KurtYoung/flink&lt;/a&gt; flink-6394&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3803&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3f81f60603940ec2b26e81814224b69ae40afcc0&lt;br/&gt;
Author: Kurt Young &amp;lt;ykt836@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-04-30T08:56:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6394&quot; title=&quot;GroupCombine reuses instances even though object reuse is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6394&quot;&gt;&lt;del&gt;FLINK-6394&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Respect object reuse configuration when executing group combining function&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15992957" author="vanekjar" created="Tue, 2 May 2017 14:04:15 +0000"  >&lt;p&gt;Hi Kurt,&lt;/p&gt;

&lt;p&gt;thank you very much for your fix. It seems it resolves this issue. It is totally correct.&lt;/p&gt;

&lt;p&gt;But generally, in Flink codebase there are tens of spots using &lt;tt&gt;if (objectReuseEnabled)&lt;/tt&gt; branching. How do we know there are no other occurrences of this bug? I am afraid this style of dealing with &lt;tt&gt;object reuse&lt;/tt&gt; is not sustainable for future development. There may always appear a new issue related to missed &lt;tt&gt;if (objectReuseEnabled)&lt;/tt&gt; check.&lt;/p&gt;</comment>
                            <comment id="15998741" author="githubbot" created="Fri, 5 May 2017 18:31:39 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good catch and good changes. Thanks @KurtYoung &lt;/p&gt;

&lt;p&gt;    +1 to merge these&lt;/p&gt;</comment>
                            <comment id="16000645" author="githubbot" created="Mon, 8 May 2017 12:01:20 +0000"  >&lt;p&gt;Github user KurtYoung commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sorry i wasn&apos;t available in the last couple days, it seems the 1.3 branch has been created, should i merge this PR in to 1.3 branch too?&lt;/p&gt;</comment>
                            <comment id="16000649" author="githubbot" created="Mon, 8 May 2017 12:07:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16000653" author="githubbot" created="Mon, 8 May 2017 12:10:40 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, 1.3 and 1.2 as well. Thank you!&lt;/p&gt;</comment>
                            <comment id="16000658" author="githubbot" created="Mon, 8 May 2017 12:15:04 +0000"  >&lt;p&gt;Github user KurtYoung commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3803&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ok, do it right way.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3e6hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>