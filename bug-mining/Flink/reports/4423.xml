<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:48:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17789] DelegatingConfiguration should remove prefix instead of add prefix in toMap</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17789</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Configuration conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration();
conf.setString(&lt;span class=&quot;code-quote&quot;&gt;&quot;k0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v0&quot;&lt;/span&gt;);
conf.setString(&lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.k1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;);
DelegatingConfiguration dc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingConfiguration(conf, &lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;k0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;empty&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// empty
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;k1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;empty&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// v1
&lt;/span&gt;
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.toMap().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;k1&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// should be v1, but &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.toMap().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.prefix.k1&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// should be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, but v1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13305600">FLINK-17789</key>
            <summary>DelegatingConfiguration should remove prefix instead of add prefix in toMap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liufangliang">Fangliang Liu</assignee>
                                    <reporter username="lzljs3620320">Jingsong Lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 18 May 2020 06:50:18 +0000</created>
                <updated>Wed, 22 Jul 2020 07:39:37 +0000</updated>
                            <resolved>Wed, 22 Jul 2020 07:39:36 +0000</resolved>
                                                    <fixVersion>1.12.0</fixVersion>
                                    <component>API / Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17109957" author="zentol" created="Mon, 18 May 2020 07:08:50 +0000"  >&lt;p&gt;I disagree. The current behavior is simple; take an option, apply prefix, look it up in the backing config.&lt;/p&gt;

&lt;p&gt;If you now start removing trimming stuff that &lt;em&gt;happens&lt;/em&gt; to match the configured prefix you just introduce additional edge-cases.&lt;/p&gt;

&lt;p&gt;Following your example, an option `k0.prefix.prefix.v1` would never work since you&apos;re removing the second `prefix`.&lt;/p&gt;</comment>
                            <comment id="17109970" author="lzljs3620320" created="Mon, 18 May 2020 07:21:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;, thanks for quick response.&lt;/p&gt;

&lt;p&gt;&amp;gt;&#160;an option `k0.prefix.prefix.v1` would never work since you&apos;re removing the second `prefix`.&lt;/p&gt;

&lt;p&gt;What do you mean?&#160;`prefix.k0.prefix.v1` will be removed to `k0.prefix.v1`, but&#160;`k0.prefix.prefix.v1` will be filtered. The logical should be like `DelegatingConfiguration.addAllToProperties`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Actually, I think the `toMap` should be consistent with `addAllToProperties`, but now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.toMap()); &lt;span class=&quot;code-comment&quot;&gt;// {prefix.k0=v0, prefix.prefix.k1=v1}
&lt;/span&gt;
Properties properties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
dc.addAllToProperties(properties);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(properties); &lt;span class=&quot;code-comment&quot;&gt;// {k1=v1}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17110000" author="zentol" created="Mon, 18 May 2020 07:56:17 +0000"  >&lt;p&gt;I&apos;d argue that the behavior of &lt;tt&gt;DelegatingConfiguration.addAllToProperties&lt;/tt&gt; is wrong.&lt;/p&gt;

&lt;p&gt;But fair enough, my example was bad.&lt;br/&gt;
Let&apos;s say &quot;prefix.prefix.v1&quot; instead; we set &quot;prefix&quot; as the prefix (duh), and add &quot;prefix.v1&quot; as an option.&lt;br/&gt;
You are then removing &quot;prefix&quot;, assuming it to be an error, but then the look will fail since you check &quot;prefix.v1&quot;, instead of the supposed &quot;prefix.prefix.v1&quot; .&lt;/p&gt;</comment>
                            <comment id="17110018" author="lzljs3620320" created="Mon, 18 May 2020 08:08:04 +0000"  >&lt;p&gt;If there is an option = ConfigOptions.key(&quot;prefix.v1&quot;), DelegatingConfiguration.get(option) -&amp;gt; should contains this key.&lt;/p&gt;

&lt;p&gt;But I want to say is modify &lt;tt&gt;toMap&lt;/tt&gt; ,&#160;DelegatingConfiguration.toMap().get(options) -&amp;gt; should also contains this key.&lt;/p&gt;</comment>
                            <comment id="17110051" author="zentol" created="Mon, 18 May 2020 08:50:33 +0000"  >&lt;p&gt;Alright hold on, this is getting really confusing.&lt;/p&gt;

&lt;p&gt;Let&apos;s clarify the behaviors a bit.&lt;/p&gt;

&lt;p&gt;For a DelegatingConfiguration with prefix P:&lt;/p&gt;

&lt;p&gt;1) get(X) reads P.X from the backing configuration&lt;br/&gt;
1) set(X) writes P.X to the backing configuration&lt;br/&gt;
2) addAllToProperties() writes all options starting with P into the properties, such that properties.get(X) works.&lt;br/&gt;
3) toMap() writes all options of the backing configuration, with an added prefix P. map.get(X) will not work, but map.get(P.X) will.&lt;/p&gt;

&lt;p&gt;It is not a problem that toMap() behaves differently to addAllToProperties() in general, as they actually serve very different purposes.&lt;br/&gt;
I can see that the behavior can be surprising, but currently it is necessary and we would break code if we were to change anything.&lt;br/&gt;
Change addAllToProperties() and the metric system breaks (reporters look up options by suffix, since the prefix contains the reporter name and is hence dynamic), change toMap() and the configuration of formats is broken (because suddenly the options are no longer fully qualified.&lt;/p&gt;

&lt;p&gt;However, one problem I do have with  3) is the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Configuration conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration();
conf.setString(&lt;span class=&quot;code-quote&quot;&gt;&quot;k0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v0&quot;&lt;/span&gt;);
conf.setString(&lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.k1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;);

DelegatingConfiguration dc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingConfiguration(conf, &lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.&quot;&lt;/span&gt;);

&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;k1&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;//v1
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(dc.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;k0&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;
Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; map = dc.toMap();
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(map.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.k1&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;//v1
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(map.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;prefix.k0&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;//v0&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically, toMap() conjures settings out of thin air, where it should be an accurate representation of the configuration.&lt;/p&gt;</comment>
                            <comment id="17110781" author="lzljs3620320" created="Tue, 19 May 2020 02:27:50 +0000"  >&lt;p&gt;Thanks for your detailed analysis.&lt;/p&gt;

&lt;p&gt;Now only &lt;tt&gt;map.get(&quot;&lt;/tt&gt;&lt;tt&gt;prefix.&lt;/tt&gt;&lt;tt&gt;prefix.k1&quot;)&lt;/tt&gt;&#160; can get v1.&lt;/p&gt;

&lt;p&gt;I got your point, but I don&apos;t think it is good design.&#160;DelegatingConfiguration is&#160;Configuration, and the&#160;toMap should be consistent with&#160;addAllToProperties in Configuration. And for toMap, it should be consistent with get too. I mean, DelegatingConfiguration override&#160;these methods from base class Configuration.&lt;/p&gt;</comment>
                            <comment id="17158039" author="liufangliang" created="Wed, 15 Jul 2020 10:09:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Can i pick this issue ?&#160;&lt;/p&gt;

&lt;p&gt;I have understood your intentions through your dialogue, I will make `toMap` consistent with `addAllToProperties`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17158047" author="zentol" created="Wed, 15 Jul 2020 10:21:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; I&apos;m not saying it is good design (of course the behaviors &lt;em&gt;should&lt;/em&gt; be consistent and unsurprising), but I don&apos;t see a way to change this behavior without breaking stuff.&lt;/p&gt;
</comment>
                            <comment id="17158843" author="lzljs3620320" created="Thu, 16 Jul 2020 02:16:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&#160;I see what you mean.&lt;/p&gt;

&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liufangliang&quot; class=&quot;user-hover&quot; rel=&quot;liufangliang&quot;&gt;liufangliang&lt;/a&gt;, thank you for your participation, for this issue, there is no clear answer to change it or not,&#160;It seems that the community has not yet reached an agreement.&#160;&lt;/p&gt;</comment>
                            <comment id="17158859" author="liufangliang" created="Thu, 16 Jul 2020 03:08:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&#160;,&lt;/p&gt;

&lt;p&gt;Sorry for my irregular behavior, I will pay attention next time.&lt;/p&gt;

&lt;p&gt;I also think `toMap` should be consistent with `addAllToProperties`. So my PR is to keep them consistent, no more.&lt;/p&gt;</comment>
                            <comment id="17162564" author="lzljs3620320" created="Wed, 22 Jul 2020 07:39:37 +0000"  >&lt;p&gt;master:&#160;3ebf0d94c8c0131cd56c34536312fad19b534cf9&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0euoo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>