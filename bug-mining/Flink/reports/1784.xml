<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6948] EnumValueSerializer cannot handle removed enum values</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6948</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;EnumValueSerializer&lt;/tt&gt; cannot handle removed enum values or enum values whose ordinal value have been changed. We should try to detect these cases and require migration. The problem is that we take the values of the new enum and iterate over them without checking that all old enum values contained in the config snapshot are actually contained.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13080784">FLINK-6948</key>
            <summary>EnumValueSerializer cannot handle removed enum values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Jun 2017 10:48:57 +0000</created>
                <updated>Tue, 20 Jun 2017 12:46:52 +0000</updated>
                            <resolved>Tue, 20 Jun 2017 12:46:52 +0000</resolved>
                                    <version>1.3.1</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.3.1</fixVersion>
                                    <component>API / Type Serialization System</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16053790" author="githubbot" created="Mon, 19 Jun 2017 10:53:24 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6948&quot; title=&quot;EnumValueSerializer cannot handle removed enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6948&quot;&gt;&lt;del&gt;FLINK-6948&lt;/del&gt;&lt;/a&gt; Harden EnumValueSerializer to detect changed enum indices&lt;/p&gt;

&lt;p&gt;    This PR changes the seriailization format of the ScalaEnumSerializerConfigSnapshot to also include the&lt;br/&gt;
    ordinal value of an enum value when being deserialized. This allows to detect if the ordinal values&lt;br/&gt;
    have been changed and, thus, if migration is required.&lt;/p&gt;

&lt;p&gt;    IMPORTANT: This PR changes the serialization format of ScalaEnumSerializerConfigSnapshot.&lt;/p&gt;

&lt;p&gt;    cc @tzulitai &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; hardenEnumValueSerializerTest&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4142&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 80b2d61b58be06f9e3f40b35f0b215421ad86890&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-06-13T21:26:10Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6836&quot; title=&quot;Failing YARNSessionCapacitySchedulerITCase.testTaskManagerFailure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6836&quot;&gt;&lt;del&gt;FLINK-6836&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Fix YARNSessionCapacitySchedulerITCase to work with Hadoop 2.6.5, 2.7.3 and 2.8.0&lt;/p&gt;

&lt;p&gt;    Due to &lt;a href=&quot;https://issues.apache.org/jira/browse/MNG-5899&quot; title=&quot;Reactor is no longer using the dependency reduced pom created by maven-shade-plugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MNG-5899&quot;&gt;&lt;del&gt;MNG-5899&lt;/del&gt;&lt;/a&gt;, maven cannot resolve dependency reduced poms in a multi project build. Therefore,&lt;br/&gt;
    flink-yarn-tests pulls in a wrong version of org.apache.httpcomponents.httpclient which does not work&lt;br/&gt;
    with Hadoop&apos;s ServletUtils together. As a solution we have to move the dependency management for the&lt;br/&gt;
    httpclient and httpcore version into the parent pom.xml.&lt;/p&gt;

&lt;p&gt;    Another problem is the version of these libraries which has been recently bumped. In 4.4, httpclient&lt;br/&gt;
    changed its behaviour such that URLEncodedUtils#parse(String, Charset) now throws a NPE if the first&lt;br/&gt;
    parameter is null. In 4.2.6, an empty list was returned instead. Due to this incompatibility, we reverted&lt;br/&gt;
    the change and set the version to its previous value.&lt;/p&gt;

&lt;p&gt;    Bump httpclient to 4.5.3 and httpcore to 4.4.6&lt;/p&gt;

&lt;p&gt;    This closes #4120.&lt;/p&gt;

&lt;p&gt;commit 7c7fe493f2dd766a8ddf3de240f9447f857b423a&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-06-14T14:53:49Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6921&quot; title=&quot;EnumValueSerializer cannot properly handle appended enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6921&quot;&gt;&lt;del&gt;FLINK-6921&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;serializer&amp;#93;&lt;/span&gt; Allow EnumValueSerializer to deal with appended enum values&lt;/p&gt;

&lt;p&gt;    The problem was that we don&apos;t check the bounds of the array with the enum names contained&lt;br/&gt;
    in the ScalaEnumSerializerConfigSnapshot.&lt;/p&gt;

&lt;p&gt;    This PR also adds an Enumeration upgrade test which makes sure that appended fields are&lt;br/&gt;
    supported without migration. Moreover, it checks that a field removal and an order change&lt;br/&gt;
    leads to a required migration.&lt;/p&gt;

&lt;p&gt;    This closes #4126.&lt;/p&gt;

&lt;p&gt;commit 9576530a0c5c3fe866bf87f126b29eb5acb56ba2&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-06-19T10:49:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6948&quot; title=&quot;EnumValueSerializer cannot handle removed enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6948&quot;&gt;&lt;del&gt;FLINK-6948&lt;/del&gt;&lt;/a&gt; Harden EnumValueSerializer to detect changed enum indices&lt;/p&gt;

&lt;p&gt;    This PR changes the seriailization format of the ScalaEnumSerializerConfigSnapshot to also include the&lt;br/&gt;
    ordinal value of an enum value when being deserialized. This allows to detect if the ordinal values&lt;br/&gt;
    have been changed and, thus, if migration is required.&lt;/p&gt;

&lt;p&gt;    IMPORTANT: This PR changes the serialization format of ScalaEnumSerializerConfigSnapshot.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16053882" author="githubbot" created="Mon, 19 Jun 2017 12:12:05 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142#discussion_r122682551&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142#discussion_r122682551&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializer.scala &amp;#8212;&lt;br/&gt;
    @@ -150,8 +162,29 @@ object EnumValueSerializer {&lt;br/&gt;
                 enumClass = InstantiationUtil.deserializeObject(&lt;br/&gt;
                   inViewWrapper, getUserCodeClassLoader)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Since we&apos;re changing the serialization format, we might as well also exclude Java serialization here for good now. Otherwise we&apos;ll need to bump the version again afterwards.&lt;/p&gt;</comment>
                            <comment id="16053883" author="githubbot" created="Mon, 19 Jun 2017 12:12:05 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142#discussion_r122684692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142#discussion_r122684692&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerTest.scala &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.api.scala.typeutils&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io._&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.scala.typeutils.EnumValueSerializer.ScalaEnumSerializerConfigSnapshot&lt;br/&gt;
    +import org.apache.flink.core.testutils.CommonTestUtils&lt;br/&gt;
    +import org.apache.flink.runtime.util.&lt;/p&gt;
{DataInputDeserializer, DataOutputSerializer}
&lt;p&gt;    +import org.apache.flink.util.TestLogger&lt;br/&gt;
    +import org.junit.&lt;/p&gt;
{Ignore, Test}
&lt;p&gt;    +import org.junit.Assert._&lt;br/&gt;
    +import org.scalatest.junit.JUnitSuiteLike&lt;br/&gt;
    +&lt;br/&gt;
    +class EnumValueSerializerTest extends TestLogger with JUnitSuiteLike {&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Tests that the snapshot configuration can be created and that the serializer&lt;br/&gt;
    +    * is compatible when being called with the created serializer snapshot&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6914&quot; title=&quot;TrySerializer#ensureCompatibility causes StackOverflowException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6914&quot;&gt;&lt;del&gt;FLINK-6914&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    nit: I would use `@see` for this&lt;/p&gt;</comment>
                            <comment id="16053884" author="githubbot" created="Mon, 19 Jun 2017 12:12:05 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142#discussion_r122687300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142#discussion_r122687300&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerUpgradeTest.scala &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,219 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.api.scala.typeutils&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io._&lt;br/&gt;
    +import java.net.&lt;/p&gt;
{URL, URLClassLoader}
&lt;p&gt;    +&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.&lt;/p&gt;
{CompatibilityResult, TypeSerializerSerializationUtil}
&lt;p&gt;    +import org.apache.flink.core.memory.&lt;/p&gt;
{DataInputViewStreamWrapper, DataOutputViewStreamWrapper}
&lt;p&gt;    +import org.apache.flink.util.TestLogger&lt;br/&gt;
    +import org.junit.rules.TemporaryFolder&lt;br/&gt;
    +import org.junit.&lt;/p&gt;
{Rule, Test}
&lt;p&gt;    +import org.junit.Assert._&lt;br/&gt;
    +import org.scalatest.junit.JUnitSuiteLike&lt;br/&gt;
    +&lt;br/&gt;
    +import scala.reflect.NameTransformer&lt;br/&gt;
    +import scala.tools.nsc.reporters.ConsoleReporter&lt;br/&gt;
    +import scala.tools.nsc.&lt;/p&gt;
{GenericRunnerSettings, Global}
&lt;p&gt;    +&lt;br/&gt;
    +class EnumValueSerializerUpgradeTest extends TestLogger with JUnitSuiteLike {&lt;br/&gt;
    +&lt;br/&gt;
    +  private val _tempFolder = new TemporaryFolder()&lt;br/&gt;
    +&lt;br/&gt;
    +  @Rule&lt;br/&gt;
    +  def tempFolder = _tempFolder&lt;br/&gt;
    +&lt;br/&gt;
    +  val enumName = &quot;EnumValueSerializerUpgradeTestEnum&quot;&lt;br/&gt;
    +&lt;br/&gt;
    +  val enumA =&lt;br/&gt;
    +    s&quot;&quot;&quot;&lt;br/&gt;
    +      |@SerialVersionUID(1L)&lt;br/&gt;
    +      |object $enumName extends Enumeration &lt;/p&gt;
{
    +      |  val A, B, C = Value
    +      |}
&lt;p&gt;    +    &quot;&quot;&quot;.stripMargin&lt;br/&gt;
    +&lt;br/&gt;
    +  val enumB =&lt;br/&gt;
    +    s&quot;&quot;&quot;&lt;br/&gt;
    +       |@SerialVersionUID(1L)&lt;br/&gt;
    +       |object $enumName extends Enumeration &lt;/p&gt;
{
    +       |  val A, B, C, D = Value
    +       |}
&lt;p&gt;    +    &quot;&quot;&quot;.stripMargin&lt;br/&gt;
    +&lt;br/&gt;
    +  val enumC =&lt;br/&gt;
    +    s&quot;&quot;&quot;&lt;br/&gt;
    +       |@SerialVersionUID(1L)&lt;br/&gt;
    +       |object $enumName extends Enumeration &lt;/p&gt;
{
    +       |  val A, C = Value
    +       |}
&lt;p&gt;    +    &quot;&quot;&quot;.stripMargin&lt;br/&gt;
    +&lt;br/&gt;
    +  val enumD =&lt;br/&gt;
    +    s&quot;&quot;&quot;&lt;br/&gt;
    +       |@SerialVersionUID(1L)&lt;br/&gt;
    +       |object $enumName extends Enumeration &lt;/p&gt;
{
    +       |  val A, C, B = Value
    +       |}
&lt;p&gt;    +    &quot;&quot;&quot;.stripMargin&lt;br/&gt;
    +&lt;br/&gt;
    +  val enumE =&lt;br/&gt;
    +    s&quot;&quot;&quot;&lt;br/&gt;
    +       |@SerialVersionUID(1L)&lt;br/&gt;
    +       |object $enumName extends Enumeration &lt;/p&gt;
{
    +       |  val A = Value(42)
    +       |  val B = Value(5)
    +       |  val C = Value(1337)
    +       |}
&lt;p&gt;    +    &quot;&quot;&quot;.stripMargin&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Check that identical enums don&apos;t require migration&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def checkIdenticalEnums(): Unit = &lt;/p&gt;
{
    +    assertFalse(checkCompatibility(enumA, enumA).isRequiresMigration)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Check that appending fields to the enum does not require migration&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def checkAppendedField(): Unit = &lt;/p&gt;
{
    +    assertFalse(checkCompatibility(enumA, enumB).isRequiresMigration)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Check that removing enum fields requires migration&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def checkRemovedField(): Unit = &lt;/p&gt;
{
    +    assertTrue(checkCompatibility(enumA, enumC).isRequiresMigration)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Check that changing the enum field order requires migration&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def checkDifferentFieldOrder(): Unit = &lt;/p&gt;
{
    +    assertTrue(checkCompatibility(enumA, enumD).isRequiresMigration)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Check that changing the enum ids causes a migration&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def checkDifferentIds(): Unit = &lt;/p&gt;
{
    +    assertTrue(
    +      &quot;Different ids should cause a migration.&quot;,
    +      checkCompatibility(enumA, enumE).isRequiresMigration)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  def checkCompatibility(enumSourceA: String, enumSourceB: String)&lt;br/&gt;
    +    : CompatibilityResult&lt;a href=&quot;#Value&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Enumeration#Value&lt;/a&gt; = &lt;/p&gt;
{
    +    import EnumValueSerializerUpgradeTest._
    +
    +    val classLoader = compileAndLoadEnum(tempFolder.newFolder(), s&quot;$enumName.scala&quot;, enumSourceA)
    +
    +    val enum = instantiateEnum[Enumeration](classLoader, enumName)
    +
    +    val enumValueSerializer = new EnumValueSerializer(enum)
    +    val snapshot = enumValueSerializer.snapshotConfiguration()
    +
    +    val baos = new ByteArrayOutputStream()
    +    val output = new DataOutputViewStreamWrapper(baos)
    +    TypeSerializerSerializationUtil.writeSerializerConfigSnapshot(output, snapshot)
    +
    +    output.close()
    +    baos.close()
    +
    +    val bais = new ByteArrayInputStream(baos.toByteArray)
    +    val input=  new DataInputViewStreamWrapper(bais)
    +
    +    val classLoader2 = compileAndLoadEnum(tempFolder.newFolder(), s&quot;$enumName.scala&quot;, enumSourceB)
    +
    +    val snapshot2 = TypeSerializerSerializationUtil.readSerializerConfigSnapshot(
    +      input,
    +      classLoader2)
    +    val enum2 = instantiateEnum[Enumeration](classLoader2, enumName)
    +
    +    val enumValueSerializer2 = new EnumValueSerializer(enum2)
    +    enumValueSerializer2.ensureCompatibility(snapshot2)
    +  }
&lt;p&gt;    +}&lt;br/&gt;
    +&lt;br/&gt;
    +object EnumValueSerializerUpgradeTest {&lt;br/&gt;
    +  def compileAndLoadEnum(root: File, filename: String, source: String): ClassLoader = &lt;/p&gt;
{
    +    val file = writeSourceFile(root, filename, source)
    +
    +    compileScalaFile(file)
    +
    +    new URLClassLoader(
    +      Array[URL](root.toURI.toURL),
    +      Thread.currentThread().getContextClassLoader)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  def instantiateEnum&lt;span class=&quot;error&quot;&gt;&amp;#91;T &amp;lt;: Enumeration&amp;#93;&lt;/span&gt;(classLoader: ClassLoader, enumName: String): T = &lt;/p&gt;
{
    +    val clazz = classLoader.loadClass(enumName + &quot;$&quot;).asInstanceOf[Class[_ &amp;lt;: Enumeration]]
    +    val field = clazz.getField(NameTransformer.MODULE_INSTANCE_NAME)
    +
    +    field.get(null).asInstanceOf[T]
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  def writeSourceFile(root: File, filename: String, source: String): File = &lt;/p&gt;
{
    +    val file = new File(root, filename)
    +    val fileWriter = new FileWriter(file)
    +
    +    fileWriter.write(source)
    +
    +    fileWriter.close()
    +
    +    file
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  def compileScalaFile(file: File): Unit = {&lt;br/&gt;
    +    val in = new BufferedReader(new StringReader(&quot;&quot;))&lt;br/&gt;
    +    val out = new PrintWriter(new BufferedWriter(&lt;br/&gt;
    +      new OutputStreamWriter(System.out)))&lt;br/&gt;
    +&lt;br/&gt;
    +    val settings = new GenericRunnerSettings(out.println _)&lt;br/&gt;
    +&lt;br/&gt;
    +    val classLoader = Thread.currentThread().getContextClassLoader&lt;br/&gt;
    +&lt;br/&gt;
    +    val urls = classLoader match &lt;/p&gt;
{
    +      case urlClassLoader: URLClassLoader =&amp;gt;
    +        urlClassLoader.getURLs
    +      case x =&amp;gt; throw new IllegalStateException(s&quot;Not possible to extract URLs &quot; +
    +        s&quot;from class loader $x.&quot;)
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    settings.classpath.value = urls.map(_.toString).mkString(java.io.File.pathSeparator)&lt;br/&gt;
    +    settings.outdir.value = file.getParent&lt;br/&gt;
    +&lt;br/&gt;
    +    val reporter = new ConsoleReporter(settings)&lt;br/&gt;
    +    val global = new Global(settings, reporter)&lt;br/&gt;
    +    val run = new global.Run&lt;br/&gt;
    +&lt;br/&gt;
    +    run.compile(List(file.getAbsolutePath))&lt;br/&gt;
    +&lt;br/&gt;
    +    reporter.printSummary()&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Would this add too much unnecessary output to the test log?&lt;/p&gt;</comment>
                            <comment id="16053885" author="githubbot" created="Mon, 19 Jun 2017 12:12:05 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142#discussion_r122686133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142#discussion_r122686133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EnumValueSerializerTest.scala &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.api.scala.typeutils&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io._&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.scala.typeutils.EnumValueSerializer.ScalaEnumSerializerConfigSnapshot&lt;br/&gt;
    +import org.apache.flink.core.testutils.CommonTestUtils&lt;br/&gt;
    +import org.apache.flink.runtime.util.&lt;/p&gt;
{DataInputDeserializer, DataOutputSerializer}
&lt;p&gt;    +import org.apache.flink.util.TestLogger&lt;br/&gt;
    +import org.junit.&lt;/p&gt;
{Ignore, Test}
&lt;p&gt;    +import org.junit.Assert._&lt;br/&gt;
    +import org.scalatest.junit.JUnitSuiteLike&lt;br/&gt;
    +&lt;br/&gt;
    +class EnumValueSerializerTest extends TestLogger with JUnitSuiteLike {&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Tests that the snapshot configuration can be created and that the serializer&lt;br/&gt;
    +    * is compatible when being called with the created serializer snapshot&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6914&quot; title=&quot;TrySerializer#ensureCompatibility causes StackOverflowException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6914&quot;&gt;&lt;del&gt;FLINK-6914&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +    */&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def testEnumValueSerializerEnsureCompatibilityIdempotency() &lt;/p&gt;
{
    +    val enumSerializer = new EnumValueSerializer(Letters)
    +
    +    val snapshot = enumSerializer.snapshotConfiguration()
    +
    +    assertFalse(enumSerializer.ensureCompatibility(snapshot).isRequiresMigration)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  @Ignore(&quot;This test case is only used to create a &quot; +&lt;br/&gt;
    +    &quot;TypeSerializerConfigurationSnapshot for the EnumValueSerializer&quot;)&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def createEnumValueSerializerConfigSnapshot(): Unit = {&lt;br/&gt;
    +    val enumValueSerializer = new EnumValueSerializer(Letters)&lt;br/&gt;
    +&lt;br/&gt;
    +    val snapshot = enumValueSerializer.snapshotConfiguration()&lt;br/&gt;
    +&lt;br/&gt;
    +    val out = new DataOutputSerializer(128)&lt;br/&gt;
    +&lt;br/&gt;
    +    snapshot.write(out)&lt;br/&gt;
    +    val buffer = out.getCopyOfBuffer&lt;br/&gt;
    +&lt;br/&gt;
    +    val tmpDir = CommonTestUtils.getTempDir&lt;br/&gt;
    +    val configFile = new File(tmpDir, &quot;EnumValueSerializerConfigSnapshot-1.3.1&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +    log.info(s&quot;Writing EnumValueSerializerConfigSnapshot-1.3.1 to $configFile&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +    val outputStream = new DataOutputStream(new FileOutputStream(configFile))&lt;br/&gt;
    +&lt;br/&gt;
    +    try &lt;/p&gt;
{
    +      outputStream.writeInt(buffer.length)
    +      outputStream.write(buffer)
    +    }
&lt;p&gt; finally &lt;/p&gt;
{
    +      outputStream.close()
    +    }
&lt;p&gt;    +  }&lt;br/&gt;
    +&lt;br/&gt;
    +  /**&lt;br/&gt;
    +    * Check backwards compatibility between 1.3.1 and 1.3.2 since the&lt;br/&gt;
    +    * ScalaEnumSerializerConfigSnapshot format changed.&lt;br/&gt;
    +    *&lt;br/&gt;
    +    * &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-694&quot; title=&quot;Defining TypeInformation with a String&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-694&quot;&gt;&lt;del&gt;FLINK-694&lt;/del&gt;&lt;/a&gt;X&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    nit: I would use `@see` for this.&lt;br/&gt;
    Also, directly refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6948&quot; title=&quot;EnumValueSerializer cannot handle removed enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6948&quot;&gt;&lt;del&gt;FLINK-6948&lt;/del&gt;&lt;/a&gt;, because that&apos;s the exact issue that required the format change.&lt;/p&gt;</comment>
                            <comment id="16055221" author="githubbot" created="Tue, 20 Jun 2017 06:40:22 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The tests are failing due to checkstyle.&lt;br/&gt;
    I&apos;ll fix that and address my comments, and run tests locally. If green, will proceed to merge this for `master` and `release-1.3`&lt;/p&gt;</comment>
                            <comment id="16055685" author="githubbot" created="Tue, 20 Jun 2017 12:39:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4142&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16055698" author="tzulitai" created="Tue, 20 Jun 2017 12:46:52 +0000"  >&lt;p&gt;Fixed for master via 228faf8c2a113de0dea366668e87484dbe7ec8b5.&lt;br/&gt;
Fixed for 1.3.1 via c10fb2bbb42f255dc14ded16d754db395385d441.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gfr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>