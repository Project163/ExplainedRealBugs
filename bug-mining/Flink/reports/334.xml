<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:19:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-1710] Expression API Tests take very long</title>
                <link>https://issues.apache.org/jira/browse/FLINK-1710</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The tests of the Expression API take an immense amount of time, compared to the other API tests.&lt;/p&gt;

&lt;p&gt;Is that because they execute on large (generated) data sets, because the program compilation overhead is high, or because there is an inefficiency in the execution still?&lt;/p&gt;

&lt;p&gt;Running org.apache.flink.api.scala.expressions.AggregationsITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.SelectITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.AsITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.StringExpressionsITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.CastingITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.JoinITCase&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 34.652 sec - in org.apache.flink.api.scala.expressions.AsITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.GroupedAggreagationsITCase&lt;br/&gt;
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 55.797 sec - in org.apache.flink.api.scala.expressions.StringExpressionsITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.PageRankExpressionITCase&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 63.072 sec - in org.apache.flink.api.scala.expressions.SelectITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.ExpressionsITCase&lt;br/&gt;
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 65.628 sec - in org.apache.flink.api.scala.expressions.CastingITCase&lt;br/&gt;
Running org.apache.flink.api.scala.expressions.FilterITCase&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 74.174 sec - in org.apache.flink.api.scala.expressions.AggregationsITCase&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 93.878 sec - in org.apache.flink.api.scala.expressions.JoinITCase&lt;br/&gt;
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 63.4 sec - in org.apache.flink.api.scala.expressions.GroupedAggreagationsITCase&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 4, Time elapsed: 44.179 sec - in org.apache.flink.api.scala.expressions.FilterITCase&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 53.801 sec - in org.apache.flink.api.scala.expressions.ExpressionsITCase&lt;br/&gt;
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 124.365 sec - in org.apache.flink.api.scala.expressions.PageRankExpressionITCase&lt;/p&gt;</description>
                <environment></environment>
        <key id="12782267">FLINK-1710</key>
            <summary>Expression API Tests take very long</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Mar 2015 16:47:48 +0000</created>
                <updated>Mon, 13 Apr 2015 13:40:05 +0000</updated>
                            <resolved>Mon, 13 Apr 2015 13:40:05 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14366933" author="aljoscha" created="Wed, 18 Mar 2015 10:28:09 +0000"  >&lt;p&gt;It is executed on the same data sets as the other tests. The problem is, that the expressions are compiled to byte code at runtime, this takes time.&lt;/p&gt;

&lt;p&gt;For these short tests, where the data size is very small we notice the additional compilation overhead. For real jobs there is no difference in runtime. I ran tests for that.&lt;/p&gt;</comment>
                            <comment id="14366939" author="stephanewen" created="Wed, 18 Mar 2015 10:32:30 +0000"  >&lt;p&gt;This compilation overhead is pretty massive. Two minutes for the page rank test that otherwise takes 5 seconds or so is huge. I think that this means we need to invest in making this a bit better.&lt;/p&gt;

&lt;p&gt;If I understand it correctly, the code is currently compiled in every serializer and comparator? What about compiling it on the client (with reusing the compiler instance) and then shipping the code?&lt;/p&gt;</comment>
                            <comment id="14367213" author="aljoscha" created="Wed, 18 Mar 2015 14:46:16 +0000"  >&lt;p&gt;It is currently being compiled in one of ExpressionJoinFunction, ExpressionFilterFunction or ExpressionSelectFunction. Compiling on the client is quite hard, since that would require a way of shipping the compiled code. This means finding out what files are generated by the Scala compiler, packing them into a jar and then shipping it along with the user-code-jar.&lt;/p&gt;</comment>
                            <comment id="14367273" author="aljoscha" created="Wed, 18 Mar 2015 15:10:00 +0000"  >&lt;p&gt;The more important problem could be that the Scala Code Generation stuff is not thread-safe in 2.10, I have to use a lock to protect all code-generation-code. I will look into whether this can be solved.&lt;/p&gt;</comment>
                            <comment id="14370979" author="stephanewen" created="Fri, 20 Mar 2015 08:52:43 +0000"  >&lt;p&gt;Would be good to get a bit of input from the Scala folks there.&lt;/p&gt;

&lt;p&gt;Can you ask for pointers / best practices, for example on their mailing list?&lt;/p&gt;</comment>
                            <comment id="14371131" author="aljoscha" created="Fri, 20 Mar 2015 10:54:13 +0000"  >&lt;p&gt;But what should I ask? The Scala reflection API is simply not thread-safe in 2.10.&lt;/p&gt;</comment>
                            <comment id="14371133" author="stephanewen" created="Fri, 20 Mar 2015 10:56:28 +0000"  >&lt;p&gt;Maybe there are some known tweaks / best practices to&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;speed up compilation&lt;/li&gt;
	&lt;li&gt;serialize generated code and integrate it into class loaders&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14371518" author="aljoscha" created="Fri, 20 Mar 2015 15:54:58 +0000"  >&lt;p&gt;This might sound a bit crazy, but we could switch to using Janino (&lt;a href=&quot;http://docs.codehaus.org/display/JANINO/Home&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.codehaus.org/display/JANINO/Home&lt;/a&gt;) as the compiler backend and completely remove the use of Scala Reflection.&lt;/p&gt;</comment>
                            <comment id="14371543" author="stephanewen" created="Fri, 20 Mar 2015 16:09:23 +0000"  >&lt;p&gt;That would be a major rewrite, I guess?&lt;/p&gt;

&lt;p&gt;Is this part not dependent on certain Scala compiler features?&lt;/p&gt;</comment>
                            <comment id="14374836" author="aljoscha" created="Sun, 22 Mar 2015 08:31:12 +0000"  >&lt;p&gt;It would not be too major, I think.&lt;/p&gt;</comment>
                            <comment id="14487285" author="githubbot" created="Thu, 9 Apr 2015 12:28:57 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-1710&quot; title=&quot;Expression API Tests take very long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-1710&quot;&gt;&lt;del&gt;FLINK-1710&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Switch compile backend to Janino&lt;/p&gt;

&lt;p&gt;    This greatly reduces compile time while still supporting the same&lt;br/&gt;
    feature set.&lt;/p&gt;

&lt;p&gt;    I added Janino in flink-bin/LICENSE and flink-bin/NOTICE. I hope this is correct. Can someone comment on this?&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; table-janino&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #584&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 21d85679b4b8fb47c8b0200cc06d7a39b188be69&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-04-07T16:11:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-1710&quot; title=&quot;Expression API Tests take very long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-1710&quot;&gt;&lt;del&gt;FLINK-1710&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Switch compile backend to Janino&lt;/p&gt;

&lt;p&gt;    This greatly reduces compile time while still supporting the same&lt;br/&gt;
    feature set.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14487952" author="githubbot" created="Thu, 9 Apr 2015 18:49:26 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584#issuecomment-91325622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584#issuecomment-91325622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good!&lt;br/&gt;
    Any concrete numbers in how the compile time changes? I assume this is now shipping java code strings which get compiled in each function / serializer / comparator?&lt;/p&gt;
</comment>
                            <comment id="14489156" author="githubbot" created="Fri, 10 Apr 2015 08:22:26 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584#issuecomment-91475335&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584#issuecomment-91475335&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Correct, we ship java code in a String that is then compiled and invoked by proxy functions.&lt;/p&gt;

&lt;p&gt;    On my machine, the time spent in mvn verify on flink-table goes down from about 2:45 to 45 seconds. On travis it goes down from 7 min to about 2 min.&lt;/p&gt;</comment>
                            <comment id="14489601" author="githubbot" created="Fri, 10 Apr 2015 13:15:23 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584#issuecomment-91553317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584#issuecomment-91553317&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Do we have a breakdown on how much time gets spent in what parts?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Client&lt;/li&gt;
	&lt;li&gt;execution&lt;/li&gt;
	&lt;li&gt;compilation inside the runtime&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14489606" author="githubbot" created="Fri, 10 Apr 2015 13:18:33 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584#issuecomment-91554708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584#issuecomment-91554708&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    What do you mean by execution? I would imagine that all of these are a couple of milliseconds only. When you run all the Table API tests and IT cases in your IDE the tests fly by in about 5 seconds.&lt;/p&gt;</comment>
                            <comment id="14492352" author="githubbot" created="Mon, 13 Apr 2015 12:46:30 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/584&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14492401" author="aljoscha" created="Mon, 13 Apr 2015 13:40:05 +0000"  >&lt;p&gt;Fixed by switching compile backend to janino: &lt;a href=&quot;https://github.com/apache/flink/commit/f81d9f02212b05ea7770dc08743c866878f1364c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/f81d9f02212b05ea7770dc08743c866878f1364c&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26tf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>