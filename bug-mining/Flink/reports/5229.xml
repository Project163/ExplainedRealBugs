<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:55:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22003] UnalignedCheckpointITCase fail</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22003</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=15601&amp;amp;view=logs&amp;amp;j=119bbba7-f5e3-5e08-e72d-09f1529665de&amp;amp;t=7dc1f5a9-54e1-502e-8b02-c7df69073cfc&amp;amp;l=4142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=15601&amp;amp;view=logs&amp;amp;j=119bbba7-f5e3-5e08-e72d-09f1529665de&amp;amp;t=7dc1f5a9-54e1-502e-8b02-c7df69073cfc&amp;amp;l=4142&lt;/a&gt;&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] execute[parallel pipeline with remote channels, p = 5](org.apache.flink.test.checkpointing.UnalignedCheckpointITCase)  Time elapsed: 60.018 s  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.junit.runners.model.TestTimedOutException: test timed out after 60000 milliseconds
	at sun.misc.Unsafe.park(Native Method)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
	at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1707)
	at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)
	at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1742)
	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.java:1859)
	at org.apache.flink.streaming.api.environment.LocalStreamEnvironment.execute(LocalStreamEnvironment.java:69)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.java:1839)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.java:1822)
	at org.apache.flink.test.checkpointing.UnalignedCheckpointTestBase.execute(UnalignedCheckpointTestBase.java:138)
	at org.apache.flink.test.checkpointing.UnalignedCheckpointITCase.execute(UnalignedCheckpointITCase.java:184)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:298)
	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:292)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13368267">FLINK-22003</key>
            <summary>UnalignedCheckpointITCase fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="maguowei">Guowei Ma</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 29 Mar 2021 03:10:42 +0000</created>
                <updated>Tue, 22 Jun 2021 13:55:41 +0000</updated>
                            <resolved>Tue, 6 Apr 2021 16:00:08 +0000</resolved>
                                    <version>1.13.0</version>
                                    <fixVersion>1.13.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17312302" author="arvid" created="Wed, 31 Mar 2021 12:03:36 +0000"  >&lt;p&gt;This one is really strange:&lt;/p&gt;

&lt;p&gt;Usually, when we trigger a checkpoint, we see some actions on the source&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;22:24:51,290 [    Checkpoint Timer] INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator    [] - Triggering checkpoint 1 (type=CHECKPOINT) @ 1616883891289 for job bb1c23aad807944d0a54775098106574.
22:24:51,290 [SourceCoordinator-Source: source] INFO  org.apache.flink.test.checkpointing.UnalignedCheckpointTestBase [] - snapshotState EnumeratorState{unassignedSplits=[], numRestarts=0, numCompletedCheckpoints=0}
22:24:51,291 [Flink Netty Server (0) Thread 0] TRACE org.apache.flink.runtime.io.network.logger.NetworkActionsLogger [] - [Source: source (2/5)#0 (8f1ca6eb04b6e2341c658cc0b1ac7c6c)] PipelinedSubpartition#pollBuffer Buffer{size=38, hash=924008396} @ ResultSubpartitionInfo{partitionIdx=0, subPartitionIdx=0}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, after checkpoint 11 is triggered nothing happens. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;22:24:54,694 [    Checkpoint Timer] INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator    [] - Triggering checkpoint 11 (type=CHECKPOINT) @ 1616883893885 for job bb1c23aad807944d0a54775098106574.
22:24:54,694 [ failing-map (5/5)#4] INFO  org.apache.flink.runtime.taskmanager.Task                    [] - failing-map (5/5)#4 (7c0e288b2cd57831596d58e8ce31e435) switched from CREATED to DEPLOYING.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Actually, it should have been canceled, as obviously not all tasks are running similar to&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;22:24:51,044 [    Checkpoint Timer] WARN  org.apache.flink.runtime.checkpoint.CheckpointCoordinator    [] - Failed to trigger checkpoint for job bb1c23aad807944d0a54775098106574.)
org.apache.flink.runtime.checkpoint.CheckpointException: Checkpoint triggering task Source: source (1/5) of job bb1c23aad807944d0a54775098106574 has not being executed at the moment. Aborting checkpoint. Failure reason: Not all required tasks are currently running.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m currently assuming that there is a race condition in the code of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21067&quot; title=&quot;Modify the logic of computing tasks to trigger/wait/commit to consider finished tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21067&quot;&gt;&lt;del&gt;FLINK-21067&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17312510" author="roman_khachatryan" created="Wed, 31 Mar 2021 16:09:44 +0000"  >&lt;p&gt;I think that checkpoint 11 should not be aborted. A checkpoint (triggering) is aborted if:&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;any of the tasks are not even CREATED (executionAttemp == null on JM) - not the case here&lt;/li&gt;
	&lt;li&gt;any of triggering tasks (sources) hasn&apos;t been started - but failing-map is not the source&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But probably the issue is in the network/task - if non-source task in CREATED/DEPLOYING state doesn&apos;t reject the checkpoint.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After increasing test timeout from 1 to 5 minutes I don&apos;t see this issue on AWS (haven&apos;t parsed all the logs yet).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And probably we should decrease checkpoint timeout in UC IT case settings? IIUC, the default is currently used, which is 10 minutes.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="17312550" author="arvid" created="Wed, 31 Mar 2021 17:12:37 +0000"  >&lt;p&gt;In general, I have seen long recovery times in these tests from time to time, so it&apos;s quite possible that it&apos;s indeed just a test-issue. I have wrongly assumed that all tasks need to be running for the checkpoints to be triggered.&lt;/p&gt;

&lt;p&gt;I already removed the timeout - it&apos;s rather arbitrary and we should never add it to master. I&apos;m also positive that &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17012&quot; title=&quot;Expose stage of task initialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17012&quot;&gt;&lt;del&gt;FLINK-17012&lt;/del&gt;&lt;/a&gt; would alleviate a bit of the pain if we abort all checkpoints if the source is still in recovery.&lt;/p&gt;</comment>
                            <comment id="17312877" author="gaoyunhaii" created="Thu, 1 Apr 2021 05:51:10 +0000"  >&lt;p&gt;Hi, I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt;&#160;is exactly right for the conditions of successfully triggering, but I read the log and found there might be still some issues since the source task 3/5, 4/5 and 5/5 are transited to RUNNING in JM side after the checkpoint 11 is triggered.&#160;&lt;/p&gt;

&lt;p&gt;After analyzed the log, I think it is very likely due to that when computing the tasks to trigger, the failover is still not done yet, thus some sources might acquired and checked against their prior execution. And it seems &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21067&quot; title=&quot;Modify the logic of computing tasks to trigger/wait/commit to consider finished tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21067&quot;&gt;&lt;del&gt;FLINK-21067&lt;/del&gt;&lt;/a&gt;&#160;indeed&#160;has problem in that it ignores the tasks in CANCELING/CANCELED state, which is different from the prior logic. If this case happens, the prior execution would fail triggering and cause the checkpoint would have to wait for timeout to be canceled.&#160;Very sorry for introducing the bug and I&apos;ll open a PR for it today to change the condition to only allows for RUNNING status (Although we would also trigger checkpoint after tasks finished, but the finished tasks should not be in the list of tasks to trigger).&#160;&lt;/p&gt;

&lt;p&gt;But it also comes to me that there &lt;em&gt;might be&lt;/em&gt; another case: when we compute tasks to trigger and checking status, the failover might not happen yet, then all the tasks are running and then the checkpoint would be triggered. The triggering would also fail due to the prior execution is gone and cause the checkpoint to wait for timeout. This behavior should already exists before&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21067&quot; title=&quot;Modify the logic of computing tasks to trigger/wait/commit to consider finished tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21067&quot;&gt;&lt;del&gt;FLINK-21067&lt;/del&gt;&lt;/a&gt;&#160;if the case did exist. I&apos;ll have a double confirmation about this case.&lt;/p&gt;</comment>
                            <comment id="17313069" author="gaoyunhaii" created="Thu, 1 Apr 2021 10:21:44 +0000"  >&lt;p&gt;I checked the case of tasks are all running when computes tasks to trigger, but tasks are failover during actually trigger, the current implementation has considered the case, but there might be some corner case that the checkpoint could still get actually triggered: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22088&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;FLINK-22088&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, even if we fixed the above two issues, there might still be cases that if failover happens during checkpoint triggering, the trigger still get success but the execution get gone before trigger success. For example, the failover might happen right before the checkpoint coordinator going to trigger the source tasks, and when the trigger happen the tasks get gone. In this case, the checkpoint would still have to wait for timeout, which might cause the test fail.  Therefore, I think we may still need to set timeout explicitly for this test. &lt;/p&gt;</comment>
                            <comment id="17313181" author="roman_khachatryan" created="Thu, 1 Apr 2021 13:41:41 +0000"  >&lt;p&gt;Thanks for your analysis &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;, I completely agree with it.&lt;/p&gt;

&lt;p&gt;Would you like to provide a fix? (I can also do that).&lt;/p&gt;</comment>
                            <comment id="17313211" author="gaoyunhaii" created="Thu, 1 Apr 2021 14:38:42 +0000"  >&lt;p&gt;Yes, no problem, I&apos;ll open the PR soon today.&lt;/p&gt;</comment>
                            <comment id="17313217" author="roman_khachatryan" created="Thu, 1 Apr 2021 14:47:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;, I went ahead and opened a &lt;a href=&quot;https://github.com/apache/flink/pull/15466&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;Please feel free to open yours and I&apos;ll close mine.&lt;/p&gt;</comment>
                            <comment id="17313229" author="gaoyunhaii" created="Thu, 1 Apr 2021 15:03:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt;&#160;Very thanks for fixing the issue! I think we do not need to repeat the work as long as we have already have one fix, and I could also help with the review~&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17315684" author="roman_khachatryan" created="Tue, 6 Apr 2021 16:00:08 +0000"  >&lt;p&gt;Merged into master as a40dfe0438afe04d1ac68c30bb8d238be45232cf..9cb161005861365b9dadfd016fcc321475c3d890.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13369076">FLINK-22087</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13369079">FLINK-22088</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13369076">FLINK-22087</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pb3s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>