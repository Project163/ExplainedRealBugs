<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-36549] Using the ignore-parse-errors parameter in Debezium/Canal/Maxwell/Ogg JSON results in unexpected data loss.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-36549</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In Debezium/Canal/Maxwell/Ogg JSON, setting&#160;&lt;tt&gt;ignore-parse-errors&lt;/tt&gt; would cause data loss if an operator chained with a format-related operator encounters an exception. The reason is that in the deserialization implementation of Debezium/Canal/Maxwell/Ogg JSON, enabling the &lt;tt&gt;ignore-parse-errors&lt;/tt&gt;&#160;parameter skips exceptions related to the format&apos;s emitted data. For example, in Canal&apos;s JSON code, enabling the&#160;&lt;tt&gt;ignore-parse-errors&lt;/tt&gt;&#160;parameter catches and skips exceptions for&#160;&lt;tt&gt;emitRow&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void deserialize(@Nullable &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] message, Collector&amp;lt;RowData&amp;gt; out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (message == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || message.length == 0) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JsonNode root = jsonDeserializer.deserializeToJsonNode(message);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (database != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!databasePattern
                    .matcher(root.get(ReadableMetadata.DATABASE.key).asText())
                    .matches()) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (table != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!tablePattern
                    .matcher(root.get(ReadableMetadata.TABLE.key).asText())
                    .matches()) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GenericRowData row = (GenericRowData) jsonDeserializer.convertToRowData(root);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; type = row.getString(2).toString(); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; field
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (OP_INSERT.equals(type)) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt; field is an array of row, contains inserted rows
&lt;/span&gt;            ArrayData data = row.getArray(0);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; data.size(); i++) {
                GenericRowData insert = (GenericRowData) data.getRow(i, fieldCount);
                insert.setRowKind(RowKind.INSERT);
                emitRow(row, insert, out);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (OP_UPDATE.equals(type)) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt; field is an array of row, contains &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; rows
&lt;/span&gt;            ArrayData data = row.getArray(0);
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;old&quot;&lt;/span&gt; field is an array of row, contains old values
&lt;/span&gt;            ArrayData old = row.getArray(1);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; data.size(); i++) {
                &lt;span class=&quot;code-comment&quot;&gt;// the underlying JSON deserialization schema always produce GenericRowData.
&lt;/span&gt;                GenericRowData after = (GenericRowData) data.getRow(i, fieldCount);
                GenericRowData before = (GenericRowData) old.getRow(i, fieldCount);
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JsonNode oldField = root.get(FIELD_OLD);
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; f = 0; f &amp;lt; fieldCount; f++) {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (before.isNullAt(f) &amp;amp;&amp;amp; oldField.findValue(fieldNames.get(f)) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                        &lt;span class=&quot;code-comment&quot;&gt;// fields in &lt;span class=&quot;code-quote&quot;&gt;&quot;old&quot;&lt;/span&gt; (before) means the fields are changed
&lt;/span&gt;                        &lt;span class=&quot;code-comment&quot;&gt;// fields not in &lt;span class=&quot;code-quote&quot;&gt;&quot;old&quot;&lt;/span&gt; (before) means the fields are not changed
&lt;/span&gt;                        &lt;span class=&quot;code-comment&quot;&gt;// so we just copy the not changed fields into before
&lt;/span&gt;                        before.setField(f, after.getField(f));
                    }
                }
                before.setRowKind(RowKind.UPDATE_BEFORE);
                after.setRowKind(RowKind.UPDATE_AFTER);
                emitRow(row, before, out);
                emitRow(row, after, out);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (OP_DELETE.equals(type)) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt; field is an array of row, contains deleted rows
&lt;/span&gt;            ArrayData data = row.getArray(0);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; data.size(); i++) {
                GenericRowData insert = (GenericRowData) data.getRow(i, fieldCount);
                insert.setRowKind(RowKind.DELETE);
                emitRow(row, insert, out);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (OP_CREATE.equals(type)) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt; field is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; is &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE&quot;&lt;/span&gt; which means
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a DDL change event, and we should skip it.
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!ignoreParseErrors) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(
                        format(
                                &lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown \&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot; value \&quot;&lt;/span&gt;%s\&lt;span class=&quot;code-quote&quot;&gt;&quot;. The Canal JSON message is &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;&quot;&lt;/span&gt;,
                                type, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(message)));
            }
        }
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
        &lt;span class=&quot;code-comment&quot;&gt;// a big &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; to protect the processing.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!ignoreParseErrors) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(
                    format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Corrupt Canal JSON message &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;.&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(message)), t);
        }
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void emitRow(
        GenericRowData rootRow, GenericRowData physicalRow, Collector&amp;lt;RowData&amp;gt; out) {
    &lt;span class=&quot;code-comment&quot;&gt;// shortcut in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; no output projection is required
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!hasMetadata) {
        out.collect(physicalRow);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; physicalArity = physicalRow.getArity();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; metadataArity = metadataConverters.length;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GenericRowData producedRow =
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericRowData(physicalRow.getRowKind(), physicalArity + metadataArity);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; physicalPos = 0; physicalPos &amp;lt; physicalArity; physicalPos++) {
        producedRow.setField(physicalPos, physicalRow.getField(physicalPos));
    }
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; metadataPos = 0; metadataPos &amp;lt; metadataArity; metadataPos++) {
        producedRow.setField(
                physicalArity + metadataPos, metadataConverters[metadataPos].convert(rootRow));
    }
    out.collect(producedRow);
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The solution to this issue is to reimplement the deserialize(byte[] message, Collector&amp;lt;T&amp;gt; out) method of the corresponding DeserializationSchema in Debezium/Canal/Maxwell/Ogg JSON by referring to the default implementation of the deserialize(byte[] message, Collector&amp;lt;T&amp;gt; out) method in the DeserializationSchema interface.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13595599">FLINK-36549</key>
            <summary>Using the ignore-parse-errors parameter in Debezium/Canal/Maxwell/Ogg JSON results in unexpected data loss.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xiaoyu1995">xiaoyu</assignee>
                                    <reporter username="jiangyu">jiangyu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 16 Oct 2024 03:48:32 +0000</created>
                <updated>Thu, 20 Feb 2025 11:29:36 +0000</updated>
                            <resolved>Thu, 20 Feb 2025 11:29:36 +0000</resolved>
                                    <version>1.17.2</version>
                    <version>1.18.1</version>
                    <version>1.19.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.19.3</fixVersion>
                    <fixVersion>1.20.2</fixVersion>
                                    <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17889958" author="wangminchao" created="Wed, 16 Oct 2024 06:34:40 +0000"  >&lt;p&gt;Ditto&#65292; me too.&lt;/p&gt;</comment>
                            <comment id="17889960" author="lvheyang" created="Wed, 16 Oct 2024 06:38:35 +0000"  >&lt;p&gt;+1&lt;br/&gt;
I have also encountered the same problem. Currently, our solution here is to turn off this parameter. However, sometimes it cannot be turned off, and in such cases, there is a risk of data loss.&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17928053" author="libenchao" created="Tue, 18 Feb 2025 11:52:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaoyu1995&quot; class=&quot;user-hover&quot; rel=&quot;xiaoyu1995&quot;&gt;xiaoyu1995&lt;/a&gt; Thanks for volunteering to fix this. could you also create PRs for 1.20 and 1.19 release branch?&lt;/p&gt;</comment>
                            <comment id="17928054" author="JIRAUSER308732" created="Tue, 18 Feb 2025 12:03:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt; Sure, I can create PRs for the 1.20 and 1.19 release branches as well. I&apos;ll get started on those and let you know once they&apos;re ready for review.&lt;/p&gt;</comment>
                            <comment id="17928717" author="JIRAUSER308732" created="Thu, 20 Feb 2025 10:19:23 +0000"  >&lt;p&gt;The PRs for versions 1.19 and 1.20 have been created. Here are the links for your reference:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/26172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/26172&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/26173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/26173&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When you have some time, I&#8217;d really appreciate it if you could help review them. Thank you in advance for your time and support!&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17928754" author="libenchao" created="Thu, 20 Feb 2025 11:29:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaoyu1995&quot; class=&quot;user-hover&quot; rel=&quot;xiaoyu1995&quot;&gt;xiaoyu1995&lt;/a&gt; for your contribution!&lt;/p&gt;

&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;2.0.0 (b7841fea103361ca49ec0a13d5485fa109a8df70)&lt;/li&gt;
	&lt;li&gt;1.20.2 (0b6b0431d8c9def5c3087e6887e7674026db0b2d)&lt;/li&gt;
	&lt;li&gt;1.19.3 (9e2907df1dc08e4f721f3e59e7000059a09d6f9f)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1s0m8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>