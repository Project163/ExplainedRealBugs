<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5218] Eagerly close checkpoint streams on cancellation</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5218</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Some output streams perform blocking operations that cannot be properly interrupted. This causes cancellations to take very long when happening concurrently to large synchronous state snapshot operations.&lt;/p&gt;

&lt;p&gt;Closing the streams concurrently helps to abort these blocking operations.&lt;/p&gt;

&lt;p&gt;This might already be fixed in 1.2 by the &lt;tt&gt;CloseableRegistry&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13024744">FLINK-5218</key>
            <summary>Eagerly close checkpoint streams on cancellation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sewen">Stephan Ewen</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2016 11:22:51 +0000</created>
                <updated>Fri, 2 Dec 2016 12:23:17 +0000</updated>
                            <resolved>Fri, 2 Dec 2016 12:23:06 +0000</resolved>
                                    <version>1.1.3</version>
                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15711763" author="aljoscha" created="Thu, 1 Dec 2016 11:48:57 +0000"  >&lt;p&gt;This seems to be a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5215&quot; title=&quot;Close checkpoint streams upon cancellation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5215&quot;&gt;&lt;del&gt;FLINK-5215&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15711988" author="stephanewen" created="Thu, 1 Dec 2016 13:36:20 +0000"  >&lt;p&gt;True, will close one of the issues.&lt;/p&gt;</comment>
                            <comment id="15712693" author="stephanewen" created="Thu, 1 Dec 2016 18:35:59 +0000"  >&lt;p&gt;Fixed in 1.1.4 via 59f61bf6cb8351cec9369e2de39c6eeffbda10ea&lt;/p&gt;</comment>
                            <comment id="15712704" author="githubbot" created="Thu, 1 Dec 2016 18:41:34 +0000"  >&lt;p&gt;GitHub user StephanEwen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5218&quot; title=&quot;Eagerly close checkpoint streams on cancellation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5218&quot;&gt;&lt;del&gt;FLINK-5218&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;state backends&amp;#93;&lt;/span&gt; Eagerly close checkpoint streams on cancellation&lt;/p&gt;

&lt;p&gt;    When a task is canceled during a checkpoint operation, the operation needs to cancel fast.&lt;/p&gt;

&lt;p&gt;    This is a forward fis from version 1.1, where checkpoints could get stuck when the state output streams did not handle interruptions correctly (HDFS has that problem).&lt;/p&gt;

&lt;p&gt;    Most of this is already handled in version 1.2 via the &lt;b&gt;CloseableRegistry&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;    This adds a test to validate this case is handled correctly and adds minor changes to make it work reliably, like:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fail fast on `write()` on closed checkpoint streams&lt;/li&gt;
	&lt;li&gt;fail fast on `flush()` on closed checkpoint streams&lt;/li&gt;
	&lt;li&gt;slight optimization to save a flag in the checkpoint streams&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StephanEwen/incubator-flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StephanEwen/incubator-flink&lt;/a&gt; closing_validation&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2920&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e592c098f25f97b223f07ff84cd2fd9233e36dc4&lt;br/&gt;
Author: Stephan Ewen &amp;lt;sewen@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-01T16:12:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5218&quot; title=&quot;Eagerly close checkpoint streams on cancellation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5218&quot;&gt;&lt;del&gt;FLINK-5218&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;state backends&amp;#93;&lt;/span&gt; Add test that validates that Checkpoint Streams are eagerly closed on cancellation.&lt;/p&gt;

&lt;p&gt;    This is important for some stream implementations (such as HDFS) that do not properly&lt;br/&gt;
    handle thread interruption.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15712711" author="githubbot" created="Thu, 1 Dec 2016 18:43:22 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StefanRRichter There is one change of semantics that would be good to get your input on: A checkpoint stream to which a `byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;` array was written is now actually empty and returns a `null` state handle in the same way as if nothing was ever written. Before this change, it would have created a state of zero bytes.&lt;/p&gt;</comment>
                            <comment id="15714603" author="githubbot" created="Fri, 2 Dec 2016 09:33:31 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think the changed semantics makes actually more sense. It should also be fine for all callers, as returning null to them was also previously possible and IRC there should be no special meaning to an empty handle in 1.1.&lt;/p&gt;</comment>
                            <comment id="15714869" author="githubbot" created="Fri, 2 Dec 2016 11:27:41 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review, merging this...&lt;/p&gt;</comment>
                            <comment id="15714989" author="githubbot" created="Fri, 2 Dec 2016 12:22:03 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Manually merged in cc006ff18cc7032de3be3fdd9ef7ad383e88bba0&lt;/p&gt;</comment>
                            <comment id="15714990" author="githubbot" created="Fri, 2 Dec 2016 12:22:03 +0000"  >&lt;p&gt;Github user StephanEwen closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2920&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15714993" author="stephanewen" created="Fri, 2 Dec 2016 12:23:07 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.1.4 via 59f61bf6cb8351cec9369e2de39c6eeffbda10ea&lt;/li&gt;
	&lt;li&gt;1.2.0 via cc006ff18cc7032de3be3fdd9ef7ad383e88bba0&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i370n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>