<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14899] can not be translated to StreamExecDeduplicate when PROCTIME() is defined in query</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14899</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;CREATE TABLE user_log (&lt;br/&gt;
    user_id VARCHAR,&lt;br/&gt;
    item_id VARCHAR,&lt;br/&gt;
    category_id VARCHAR,&lt;br/&gt;
    behavior VARCHAR,&lt;br/&gt;
    ts TIMESTAMP&lt;br/&gt;
) WITH (&lt;br/&gt;
    &apos;connector.type&apos; = &apos;kafka&apos;,&lt;br/&gt;
    &apos;connector.version&apos; = &apos;universal&apos;,&lt;br/&gt;
    &apos;connector.topic&apos; = &apos;user_behavior&apos;,&lt;br/&gt;
    &apos;connector.startup-mode&apos; = &apos;earliest-offset&apos;,&lt;br/&gt;
    &apos;connector.properties.0.key&apos; = &apos;zookeeper.connect&apos;,&lt;br/&gt;
    &apos;connector.properties.0.value&apos; = &apos;localhost:2181&apos;,&lt;br/&gt;
    &apos;connector.properties.1.key&apos; = &apos;bootstrap.servers&apos;,&lt;br/&gt;
    &apos;connector.properties.1.value&apos; = &apos;localhost:9092&apos;,&lt;br/&gt;
    &apos;update-mode&apos; = &apos;append&apos;,&lt;br/&gt;
    &apos;format.type&apos; = &apos;json&apos;,&lt;br/&gt;
    &apos;format.derive-schema&apos; = &apos;true&apos;&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;CREATE TABLE user_dist (&lt;br/&gt;
    dt VARCHAR,&lt;br/&gt;
    user_id VARCHAR,&lt;br/&gt;
    behavior VARCHAR&lt;br/&gt;
) WITH (&lt;br/&gt;
    &apos;connector.type&apos; = &apos;jdbc&apos;,&lt;br/&gt;
    &apos;connector.url&apos; = &apos;jdbc:mysql://localhost:3306/flink-test&apos;,&lt;br/&gt;
    &apos;connector.table&apos; = &apos;user_behavior_dup&apos;,&lt;br/&gt;
    &apos;connector.username&apos; = &apos;root&apos;,&lt;br/&gt;
    &apos;connector.password&apos; = &#8216;******&apos;,&lt;br/&gt;
    &apos;connector.write.flush.max-rows&apos; = &apos;1&apos;&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;INSERT INTO user_dist&lt;br/&gt;
SELECT&lt;br/&gt;
  dt,&lt;br/&gt;
  user_id,&lt;br/&gt;
  behavior&lt;br/&gt;
FROM (&lt;br/&gt;
   SELECT&lt;br/&gt;
      dt,&lt;br/&gt;
      user_id,&lt;br/&gt;
      behavior,&lt;br/&gt;
     ROW_NUMBER() OVER (PARTITION BY dt, user_id, behavior ORDER BY proc asc ) AS rownum&lt;br/&gt;
   FROM (select DATE_FORMAT(ts, &apos;yyyy-MM-dd HH:00&apos;) as dt,user_id,behavior,PROCTIME() as proc&lt;br/&gt;
            from user_log) )&lt;br/&gt;
WHERE rownum = 1;&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; org.apache.flink.table.api.TableException: UpsertStreamTableSink requires that Table has a full primary keys if it is updated.&lt;br/&gt;
at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecSink.translateToPlanInternal(StreamExecSink.scala:114)&lt;br/&gt;
at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecSink.translateToPlanInternal(StreamExecSink.scala:50)&lt;br/&gt;
at org.apache.flink.table.planner.plan.nodes.exec.ExecNode$class.translateToPlan(ExecNode.scala:54)&lt;br/&gt;
at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecSink.translateToPlan(StreamExecSink.scala:50)&lt;br/&gt;
at org.apache.flink.table.planner.delegation.StreamPlanner$$anonfun$translateToPlan$1.apply(StreamPlanner.scala:61)&lt;br/&gt;
at org.apache.flink.table.planner.delegation.StreamPlanner$$anonfun$translateToPlan$1.apply(StreamPlanner.scala:60)&lt;br/&gt;
at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)&lt;br/&gt;
at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)&lt;br/&gt;
at scala.collection.Iterator$class.foreach(Iterator.scala:891)&lt;br/&gt;
at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)&lt;br/&gt;
at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)&lt;br/&gt;
at scala.collection.AbstractIterable.foreach(Iterable.scala:54)&lt;br/&gt;
at scala.collection.TraversableLike$class.map(TraversableLike.scala:234)&lt;br/&gt;
at scala.collection.AbstractTraversable.map(Traversable.scala:104)&lt;br/&gt;
at org.apache.flink.table.planner.delegation.StreamPlanner.translateToPlan(StreamPlanner.scala:60)&lt;br/&gt;
at org.apache.flink.table.planner.delegation.PlannerBase.translate(PlannerBase.scala:149)&lt;br/&gt;
at org.apache.flink.table.api.internal.TableEnvironmentImpl.translate(TableEnvironmentImpl.java:439)&lt;br/&gt;
at org.apache.flink.table.api.internal.TableEnvironmentImpl.sqlUpdate(TableEnvironmentImpl.java:348)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13269857">FLINK-14899</key>
            <summary>can not be translated to StreamExecDeduplicate when PROCTIME() is defined in query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="godfreyhe">godfrey he</assignee>
                                    <reporter username="godfreyhe">godfrey he</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 21 Nov 2019 13:56:34 +0000</created>
                <updated>Tue, 17 Dec 2019 12:16:06 +0000</updated>
                            <resolved>Tue, 17 Dec 2019 12:16:06 +0000</resolved>
                                    <version>1.9.0</version>
                    <version>1.9.1</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16979795" author="godfreyhe" created="Fri, 22 Nov 2019 03:02:27 +0000"  >&lt;p&gt;the reason is:  &lt;tt&gt;PROCTIME&lt;/tt&gt; type is materialized to &lt;tt&gt;Timestamp&lt;/tt&gt; type in &lt;tt&gt;RelTimeIndicatorConverter&lt;/tt&gt;, and that is an unintended behavior.&lt;/p&gt;</comment>
                            <comment id="16979796" author="godfreyhe" created="Fri, 22 Nov 2019 03:02:48 +0000"  >&lt;p&gt;I would like to fix this.&lt;/p&gt;</comment>
                            <comment id="16979816" author="ykt836" created="Fri, 22 Nov 2019 03:49:27 +0000"  >&lt;p&gt;assigned to you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16979851" author="yesorno" created="Fri, 22 Nov 2019 05:01:16 +0000"  >&lt;p&gt;I change DML to below, also get the same exception. just change &lt;em&gt;ORDER BY proc asc&lt;/em&gt;&#160;to&#160;&lt;em&gt;ORDER BY mytime asc&lt;/em&gt;&#160;&lt;em&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;INSERT INTO user_dist
SELECT
 dt,
 user_id,
 behavior
FROM (
 SELECT
 dt,
 user_id,
 behavior,
 ROW_NUMBER() OVER (PARTITION BY user_id, behavior ORDER BY mytime asc ) AS rownum
 FROM (select DATE_FORMAT(ts, &lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd HH:00&apos;&lt;/span&gt;) as dt, user_id, behavior, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(ts as timestamp) as mytime
 from user_log) )
WHERE rownum = 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16979862" author="godfreyhe" created="Fri, 22 Nov 2019 05:21:49 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yesorno&quot; class=&quot;user-hover&quot; rel=&quot;yesorno&quot;&gt;yesorno&lt;/a&gt;, the following sql will be supported after this issue is fixed. (here requires &lt;tt&gt;PROCTIME()&lt;/tt&gt; instead of &lt;tt&gt;Timestamp&lt;/tt&gt; type)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT
dt,
user_id,
behavior
FROM (
SELECT
dt,
user_id,
behavior,
ROW_NUMBER() OVER (PARTITION BY dt, user_id, behavior ORDER BY proc asc ) AS rownum
FROM (select DATE_FORMAT(ts, &lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd HH:00&apos;&lt;/span&gt;) as dt,user_id,behavior,PROCTIME() as proc
from user_log) )
WHERE rownum = 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="16998130" author="jark" created="Tue, 17 Dec 2019 12:16:06 +0000"  >&lt;p&gt;1.11.0: 15f7cdae533bdee5652ddfa2677d670c77eefa29&lt;br/&gt;
1.10.0: c19496a7fd3eee48e2e31784b6a77c314571ba16&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08vko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>