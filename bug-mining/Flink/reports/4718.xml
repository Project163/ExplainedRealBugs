<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19740] Error in to_pandas for table containing event time: class java.time.LocalDateTime cannot be cast to class java.sql.Timestamp</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19740</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In a nutshell, if I create a table with an event time column:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;CREATE TABLE simple_table (&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160; &#160;ts TIMESTAMP(3),&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160; &#160;WATERMARK FOR ts AS ts - INTERVAL &apos;5&apos; SECOND&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;then it fails to serialize with&#160;.to_pandas(). This only happens with the watermark line and in streaming mode.&lt;/p&gt;

&lt;p&gt;Full code:&lt;/p&gt;

&lt;p&gt;from pyflink.table import EnvironmentSettings, StreamTableEnvironment&lt;/p&gt;

&lt;p&gt;env_settings = (&lt;br/&gt;
 EnvironmentSettings.new_instance().in_streaming_mode().use_blink_planner().build()&lt;br/&gt;
)&lt;br/&gt;
table_env = StreamTableEnvironment.create(environment_settings=env_settings)&lt;br/&gt;
table_env.execute_sql(&lt;br/&gt;
 &quot;&quot;&quot;&lt;br/&gt;
 CREATE TABLE simple_table (&lt;br/&gt;
 ts TIMESTAMP(3),&lt;br/&gt;
 WATERMARK FOR ts AS ts - INTERVAL &apos;5&apos; SECOND&lt;br/&gt;
 ) WITH (&lt;br/&gt;
 &apos;connector.type&apos; = &apos;filesystem&apos;,&lt;br/&gt;
 &apos;format.type&apos; = &apos;csv&apos;,&lt;br/&gt;
 &apos;connector.path&apos; = &apos;/home/alex/.config/JetBrains/PyCharm2020.2/scratches/scratch_2.csv&apos;&lt;br/&gt;
 )&lt;br/&gt;
&quot;&quot;&quot;&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;print(table_env.from_path(&quot;simple_table&quot;).to_pandas())&lt;/p&gt;

&lt;p&gt;Output:&lt;br/&gt;
 &#160;&lt;br/&gt;
 WARNING: An illegal reflective access operation has occurred&lt;br/&gt;
 WARNING: Illegal reflective access by org.apache.flink.api.python.shaded.io.netty.util.internal.ReflectionUtil (&lt;a href=&quot;file:///home/alex/work/flink/flink-dist/target/flink-1.12-SNAPSHOT-bin/flink-1.12-SNAPSHOT/opt/flink-python_2.11-1.12-SNAPSHOT.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/home/alex/work/flink/flink-dist/target/flink-1.12-SNAPSHOT-bin/flink-1.12-SNAPSHOT/opt/flink-python_2.11-1.12-SNAPSHOT.jar&lt;/a&gt;) to constructor java.nio.DirectByteBuffer(long,int)&lt;br/&gt;
 WARNING: Please consider reporting this to the maintainers of org.apache.flink.api.python.shaded.io.netty.util.internal.ReflectionUtil&lt;br/&gt;
 WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations&lt;br/&gt;
 WARNING: All illegal access operations will be denied in a future release&lt;br/&gt;
 Traceback (most recent call last):&lt;br/&gt;
 File &quot;/home/alex/.config/JetBrains/PyCharm2020.2/scratches/scratch_903.py&quot;, line 20, in &amp;lt;module&amp;gt;&lt;br/&gt;
 print(table_env.from_path(&quot;simple_table&quot;).to_pandas())&lt;br/&gt;
 File &quot;/home/alex/work/flink/flink-python/pyflink/table/table.py&quot;, line 839, in to_pandas&lt;br/&gt;
 table = pa.Table.from_batches(serializer.load_from_iterator(batches))&lt;br/&gt;
 File &quot;pyarrow/table.pxi&quot;, line 1576, in pyarrow.lib.Table.from_batches&lt;br/&gt;
 File &quot;/home/alex/work/flink/flink-python/pyflink/table/serializers.py&quot;, line 76, in load_from_iterator&lt;br/&gt;
 reader = pa.ipc.open_stream(&lt;br/&gt;
 File &quot;/home/alex/.cache/pypoetry/virtualenvs/relycomply-WA1zLZ2n-py3.8/lib/python3.8/site-packages/pyarrow/ipc.py&quot;, line 146, in open_stream&lt;br/&gt;
 return RecordBatchStreamReader(source)&lt;br/&gt;
 File &quot;/home/alex/.cache/pypoetry/virtualenvs/relycomply-WA1zLZ2n-py3.8/lib/python3.8/site-packages/pyarrow/ipc.py&quot;, line 62, in _&lt;em&gt;init&lt;/em&gt;_&lt;br/&gt;
 self._open(source)&lt;br/&gt;
 File &quot;pyarrow/ipc.pxi&quot;, line 360, in pyarrow.lib._RecordBatchStreamReader._open&lt;br/&gt;
 File &quot;pyarrow/error.pxi&quot;, line 123, in pyarrow.lib.pyarrow_internal_check_status&lt;br/&gt;
 File &quot;/home/alex/work/flink/flink-python/pyflink/table/serializers.py&quot;, line 69, in readinto&lt;br/&gt;
 input = self.leftover or (self.itor.next() if self.itor.hasNext() else None)&lt;br/&gt;
 File &quot;/home/alex/.cache/pypoetry/virtualenvs/relycomply-WA1zLZ2n-py3.8/lib/python3.8/site-packages/py4j/java_gateway.py&quot;, line 1285, in _&lt;em&gt;call&lt;/em&gt;_&lt;br/&gt;
 return_value = get_return_value(&lt;br/&gt;
 File &quot;/home/alex/work/flink/flink-python/pyflink/util/exceptions.py&quot;, line 147, in deco&lt;br/&gt;
 return f(*a, **kw)&lt;br/&gt;
 File &quot;/home/alex/.cache/pypoetry/virtualenvs/relycomply-WA1zLZ2n-py3.8/lib/python3.8/site-packages/py4j/protocol.py&quot;, line 326, in get_return_value&lt;br/&gt;
 raise Py4JJavaError(&lt;br/&gt;
 py4j.protocol.Py4JJavaError: An error occurred while calling o39.next.&lt;br/&gt;
 : java.lang.RuntimeException: Failed to serialize the data of the table&lt;br/&gt;
 at org.apache.flink.table.runtime.arrow.ArrowUtils$2.next(ArrowUtils.java:683)&lt;br/&gt;
 at org.apache.flink.table.runtime.arrow.ArrowUtils$2.next(ArrowUtils.java:663)&lt;br/&gt;
 at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
 at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
 at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
 at java.base/java.lang.reflect.Method.invoke(Method.java:566)&lt;br/&gt;
 at org.apache.flink.api.python.shaded.py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)&lt;br/&gt;
 at org.apache.flink.api.python.shaded.py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)&lt;br/&gt;
 at org.apache.flink.api.python.shaded.py4j.Gateway.invoke(Gateway.java:282)&lt;br/&gt;
 at org.apache.flink.api.python.shaded.py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)&lt;br/&gt;
 at org.apache.flink.api.python.shaded.py4j.commands.CallCommand.execute(CallCommand.java:79)&lt;br/&gt;
 at org.apache.flink.api.python.shaded.py4j.GatewayConnection.run(GatewayConnection.java:238)&lt;br/&gt;
 at java.base/java.lang.Thread.run(Thread.java:834)&lt;br/&gt;
 Caused by: java.lang.ClassCastException: class java.time.LocalDateTime cannot be cast to class java.sql.Timestamp (java.time.LocalDateTime is in module java.base of loader &apos;bootstrap&apos;; java.sql.Timestamp is in module java.sql of loader &apos;platform&apos;)&lt;br/&gt;
 at org.apache.flink.table.data.util.DataFormatConverters$TimestampConverter.toInternalImpl(DataFormatConverters.java:897)&lt;br/&gt;
 at org.apache.flink.table.data.util.DataFormatConverters$DataFormatConverter.toInternal(DataFormatConverters.java:381)&lt;br/&gt;
 at org.apache.flink.table.data.util.DataFormatConverters$RowConverter.toInternalImpl(DataFormatConverters.java:1426)&lt;br/&gt;
 at org.apache.flink.table.data.util.DataFormatConverters$RowConverter.toInternalImpl(DataFormatConverters.java:1414)&lt;br/&gt;
 at org.apache.flink.table.data.util.DataFormatConverters$DataFormatConverter.toInternal(DataFormatConverters.java:381)&lt;br/&gt;
 at org.apache.flink.table.runtime.arrow.ArrowUtils$1.next(ArrowUtils.java:655)&lt;br/&gt;
 at org.apache.flink.table.runtime.arrow.ArrowUtils$1.next(ArrowUtils.java:641)&lt;br/&gt;
 at org.apache.flink.table.runtime.arrow.ArrowUtils$2.next(ArrowUtils.java:675)&lt;br/&gt;
 ... 12 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 18.04&lt;/p&gt;

&lt;p&gt;Python 3.8,&#160;jar built from master yesterday.&lt;/p&gt;

&lt;p&gt;Or Python 3.7, installed latest version from pip.&lt;/p&gt;</environment>
        <key id="13336329">FLINK-19740</key>
            <summary>Error in to_pandas for table containing event time: class java.time.LocalDateTime cannot be cast to class java.sql.Timestamp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hxbks2ks">Huang Xingbo</assignee>
                                    <reporter username="alexmojaki">Alex Hall</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 20 Oct 2020 15:51:42 +0000</created>
                <updated>Tue, 3 Nov 2020 14:09:24 +0000</updated>
                            <resolved>Tue, 3 Nov 2020 11:21:52 +0000</resolved>
                                    <version>1.11.2</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>API / Python</component>
                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17218090" author="nicholasjiang" created="Wed, 21 Oct 2020 03:45:09 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dian.fu&quot; class=&quot;user-hover&quot; rel=&quot;dian.fu&quot;&gt;dian.fu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17224599" author="hxbks2ks" created="Mon, 2 Nov 2020 11:26:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexmojaki&quot; class=&quot;user-hover&quot; rel=&quot;alexmojaki&quot;&gt;alexmojaki&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt; Thanks a lot for reporting this error. I will take a look.&lt;/p&gt;</comment>
                            <comment id="17224644" author="dian.fu" created="Mon, 2 Nov 2020 12:52:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hxbks2ks&quot; class=&quot;user-hover&quot; rel=&quot;hxbks2ks&quot;&gt;hxbks2ks&lt;/a&gt; Thanks for taking this issue. I will assign it to you~&lt;/p&gt;</comment>
                            <comment id="17225307" author="dian.fu" created="Tue, 3 Nov 2020 11:21:52 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via&#160;c7154214cd4996472178ed7091ee8cf4be864816&lt;/li&gt;
	&lt;li&gt;release-1.11 via&#160;5333fbfe48542aceda3b6d21e76b48f7bde002ef&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jus8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>