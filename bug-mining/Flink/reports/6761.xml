<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-29927] AkkaUtils#getAddress may cause memory leak</title>
                <link>https://issues.apache.org/jira/browse/FLINK-29927</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We found a slow memory leak in JM. When MetricFetcherImpl tries to retrieve metrics, it always call MetricQueryServiceRetriever#retrieveService first. And the method will acquire the address of a task manager, which will use AkkaUtil#getAddress internally. While the getAddress method is implemented like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Address getAddress(ActorSystem system) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RemoteAddressExtension().apply(system).getAddress();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the RemoteAddressExtension#apply is like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; apply(system: ActorSystem): T = {
    java.util.Objects.requireNonNull(system, &lt;span class=&quot;code-quote&quot;&gt;&quot;system must not be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;!&quot;&lt;/span&gt;).registerExtension(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This means every call of AkkaUtils#getAddress will register a new extension to the ActorSystem, and can never be released until the ActorSystem exits.&lt;/p&gt;

&lt;p&gt;Most of the usage of the method are called only once while initializing, but as described above, MetricFetcherImpl will also use the method. It can happens periodically while users open the WebUI, or happens when the users call the RESTful API directly to get metrics. This means the memory may keep leaking. &lt;/p&gt;

&lt;p&gt;The leak may be introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23662&quot; title=&quot;Port Scala code in flink-rpc-akka to Java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-23662&quot;&gt;&lt;del&gt;FLINK-23662&lt;/del&gt;&lt;/a&gt; when porting the scala version of AkkaUtils to the java one, while I&apos;m not sure if the scala version has the same issue.&lt;/p&gt;

&lt;p&gt;The leak seems very slow. We observed it on a job running for more than one month with only 1G memory for job manager. So I suppose it&apos;s not an emergency one but still needs to fix.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13499637">FLINK-29927</key>
            <summary>AkkaUtils#getAddress may cause memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="pltbkd">Gen Luo</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 8 Nov 2022 09:20:41 +0000</created>
                <updated>Wed, 9 Nov 2022 09:40:23 +0000</updated>
                            <resolved>Wed, 9 Nov 2022 09:40:23 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.15.2</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.15.3</fixVersion>
                    <fixVersion>1.16.1</fixVersion>
                                    <component>Runtime / RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17630326" author="zentol" created="Tue, 8 Nov 2022 10:25:51 +0000"  >&lt;p&gt;Unless I&apos;m several underestimating Scala magic this leak should&apos;ve been there for a long time.&lt;/p&gt;

&lt;p&gt;Should be easy to fix though; I&apos;ve opened a PR.&lt;/p&gt;</comment>
                            <comment id="17630879" author="zentol" created="Wed, 9 Nov 2022 09:40:23 +0000"  >&lt;p&gt;master: 304122eadc52dd6ee8c04d9777d97eb66aec5e0e&lt;br/&gt;
1.16: 313e30483e9770d18461b5dc655da423d465b7e3&lt;br/&gt;
1.15: 6feaa440ffce2afc6b0222c49de598b94e60c825&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13051936" name="RemoteAddressExtensionLeaking.png" size="189936" author="pltbkd" created="Tue, 8 Nov 2022 09:26:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1bnfk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>