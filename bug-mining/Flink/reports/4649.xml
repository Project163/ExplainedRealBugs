<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:49:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18915] FIXED_PATH(dummy Hadoop Path) with WriterImpl may cause ORC writer OOM</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18915</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;ol&gt;
	&lt;li&gt;OrcBulkWriterFactory
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; BulkWriter&amp;lt;T&amp;gt; create(FSDataOutputStream out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
   OrcFile.WriterOptions opts = getWriterOptions();
   opts.physicalWriter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PhysicalWriterImpl(out, opts));

   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OrcBulkWriter&amp;lt;&amp;gt;(vectorizer, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WriterImpl(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, FIXED_PATH, opts));
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;#&#160;MemoryManagerImpl&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addWriter(Path path, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; requestedAllocation,
                            Callback callback) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  checkOwner();
  WriterInfo oldVal = writerList.get(path);
  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; should always be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, but we handle the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; where the memory
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// manager wasn&lt;span class=&quot;code-quote&quot;&gt;&apos;t told that a writer wasn&apos;&lt;/span&gt;t still in use and the task
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// starts writing to the same path.
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldVal == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    oldVal = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WriterInfo(requestedAllocation, callback);
    writerList.put(path, oldVal);
    totalAllocation += requestedAllocation;
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-comment&quot;&gt;// handle a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; writer that is writing to the same path
&lt;/span&gt;    totalAllocation += requestedAllocation - oldVal.allocation;
    oldVal.allocation = requestedAllocation;
    oldVal.callback = callback;
  }
  updateScale(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;SinkTask may have multi&#160;BulkWriter create, FIXED_PATH will cause overlay the last writer callback&#65307;Last writer&apos;s&#160;WriterImpl#checkMemory will never called;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13322445">FLINK-18915</key>
            <summary>FIXED_PATH(dummy Hadoop Path) with WriterImpl may cause ORC writer OOM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gaoyunhaii">Yun Gao</assignee>
                                    <reporter username="wei.wei">wei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 13 Aug 2020 04:52:05 +0000</created>
                <updated>Sat, 17 Oct 2020 18:20:10 +0000</updated>
                            <resolved>Fri, 16 Oct 2020 17:59:49 +0000</resolved>
                                    <version>1.11.0</version>
                    <version>1.11.1</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17188106" author="lzljs3620320" created="Tue, 1 Sep 2020 02:46:17 +0000"  >&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17188158" author="gaoyunhaii" created="Tue, 1 Sep 2020 06:01:49 +0000"  >&lt;p&gt;Very thanks for reporting this issue! I&apos;ll have a look, and I think&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zenfenan&quot; class=&quot;user-hover&quot; rel=&quot;zenfenan&quot;&gt;zenfenan&lt;/a&gt;&#160;should also could help on this issue.&#160;&lt;/p&gt;</comment>
                            <comment id="17212187" author="gaoyunhaii" created="Mon, 12 Oct 2020 07:23:57 +0000"  >&lt;p&gt;Very thansk &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wei.wei&quot; class=&quot;user-hover&quot; rel=&quot;wei.wei&quot;&gt;wei.wei&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; for reporting and analyzing this issue! I checked the implementation and the issue should do exists. Since a sink task should always create its own OrcBulkWriterFactory on startup and it should not create duplicate writer for the same target path, I think we should simply change the FIX_PATH to a random path ? &lt;/p&gt;</comment>
                            <comment id="17212194" author="lzljs3620320" created="Mon, 12 Oct 2020 07:34:32 +0000"  >&lt;p&gt;I think yes, a UUID path can help.&lt;/p&gt;</comment>
                            <comment id="17212195" author="lzljs3620320" created="Mon, 12 Oct 2020 07:34:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;Do you want to contribute this?&lt;/p&gt;</comment>
                            <comment id="17212197" author="lzljs3620320" created="Mon, 12 Oct 2020 07:36:47 +0000"  >&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17212198" author="gaoyunhaii" created="Mon, 12 Oct 2020 07:38:12 +0000"  >&lt;p&gt;OK, no problem, I would open a PR for it.&lt;/p&gt;</comment>
                            <comment id="17215569" author="kkl0u" created="Fri, 16 Oct 2020 17:59:50 +0000"  >&lt;p&gt;Merged on master  with 3a9a93053903dfefc3fb651e47800afc00d13a9e&lt;br/&gt;
and on release-1.11 with 393b13cfd103896e0cb60c6c7230101bef9a956f&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hq5c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>