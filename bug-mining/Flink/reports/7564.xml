<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:20:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-35318] incorrect timezone handling for TIMESTAMP_WITH_LOCAL_TIME_ZONE type during predicate pushdown</title>
                <link>https://issues.apache.org/jira/browse/FLINK-35318</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In our scenario, we have an Iceberg table that contains a column named &apos;time&apos; of the&#160;&lt;tt&gt;timestamptz&lt;/tt&gt;&#160;data type. This column has 10 rows of data where the &apos;time&apos; value is&#160;&lt;tt&gt;&apos;2024-04-30 07:00:00&apos;&lt;/tt&gt;&#160;expressed in the &quot;Asia/Shanghai&quot; timezone.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068753/13068753_image-2024-05-09-14-06-58-007.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We encountered a strange phenomenon when accessing the table using Iceberg-flink.&lt;/p&gt;

&lt;p&gt;When the&#160;&lt;tt&gt;WHERE&lt;/tt&gt;&#160;clause includes the&#160;&lt;tt&gt;time&lt;/tt&gt;&#160;column, the results are incorrect.&lt;/p&gt;

&lt;p&gt;ZoneId.&lt;em&gt;systemDefault&lt;/em&gt;() = &quot;Asia/Shanghai&quot;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068770/13068770_image-2024-05-09-18-52-03-741.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;When there is no&#160;&lt;tt&gt;WHERE&lt;/tt&gt;&#160;clause, the results are correct.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068771/13068771_image-2024-05-09-18-52-28-584.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;During debugging, we found that when a&#160;&lt;tt&gt;WHERE&lt;/tt&gt;&#160;clause is present, a&#160;&lt;tt&gt;FilterPushDownSpec&lt;/tt&gt;&#160;is generated, and this&#160;&lt;tt&gt;FilterPushDownSpec&lt;/tt&gt;&#160;utilizes&#160;&lt;tt&gt;RexNodeToExpressionConverter&lt;/tt&gt;&#160;for translation.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068751/13068751_image-2024-05-09-14-11-38-476.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13068755/13068755_image-2024-05-09-14-22-59-370.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;When&#160;&lt;tt&gt;RexNodeToExpressionConverter#visitLiteral&lt;/tt&gt;&#160;encounters a&#160;&lt;tt&gt;TIMESTAMP_WITH_LOCAL_TIME_ZONE&lt;/tt&gt;&#160;type, it uses the specified timezone &quot;Asia/Shanghai&quot; to convert the&#160;&lt;tt&gt;TimestampString&lt;/tt&gt;&#160;type to an&#160;&lt;tt&gt;Instant&lt;/tt&gt;&#160;type. However, the upstream&#160;&lt;tt&gt;TimestampString&lt;/tt&gt;&#160;data has already been processed in UTC timezone. By applying the local timezone processing here, an error occurs due to the mismatch in timezones.&lt;/p&gt;

&lt;p&gt;Whether the handling of&#160;&lt;tt&gt;TIMESTAMP_WITH_LOCAL_TIME_ZONE&lt;/tt&gt;&#160;type of data in&#160;&lt;tt&gt;RexNodeToExpressionConverter#visitLiteral&lt;/tt&gt; is a bug, and whether it should process the data in UTC timezone.&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
Please help confirm if this is the issue, and if so, we can submit a patch to fix it.&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;flink version 1.18.1&lt;/p&gt;

&lt;p&gt;iceberg version 1.15.1&lt;/p&gt;</environment>
        <key id="13578701">FLINK-35318</key>
            <summary>incorrect timezone handling for TIMESTAMP_WITH_LOCAL_TIME_ZONE type during predicate pushdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="linshangquan">linshangquan</assignee>
                                    <reporter username="linshangquan">linshangquan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 9 May 2024 06:18:02 +0000</created>
                <updated>Mon, 2 Sep 2024 09:35:43 +0000</updated>
                            <resolved>Wed, 24 Jul 2024 08:35:19 +0000</resolved>
                                    <version>1.18.1</version>
                                    <fixVersion>1.20.0</fixVersion>
                    <fixVersion>1.19.2</fixVersion>
                    <fixVersion>2.0-preview</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17844904" author="linshangquan" created="Thu, 9 May 2024 07:52:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt; &#160;Please take a look at this issue when you have time. Thanks&lt;/p&gt;</comment>
                            <comment id="17845408" author="qingyue" created="Fri, 10 May 2024 16:04:04 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=linshangquan&quot; class=&quot;user-hover&quot; rel=&quot;linshangquan&quot;&gt;linshangquan&lt;/a&gt;, thanks for reporting this issue. Your understanding is correct.&#160;&lt;br/&gt;
RexNodeToExpressionConverter#visitLiteral should not convert the literal to UTC again since this has been done before at the SQL to Rel phase.&lt;/p&gt;</comment>
                            <comment id="17846785" author="linshangquan" created="Thu, 16 May 2024 02:15:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/24787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/24787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt; , Could you possibly review this PR. Thank you very much!&lt;/p&gt;</comment>
                            <comment id="17848071" author="qingyue" created="Tue, 21 May 2024 06:45:33 +0000"  >&lt;p&gt;Thanks for your contribution &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=linshangquan&quot; class=&quot;user-hover&quot; rel=&quot;linshangquan&quot;&gt;linshangquan&lt;/a&gt;, I&apos;ll take a look as quickly as I can.&lt;/p&gt;</comment>
                            <comment id="17854773" author="linshangquan" created="Thu, 13 Jun 2024 14:55:18 +0000"  >&lt;p&gt;Thanks,&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt; , do you have time to help review this PR ?&lt;/p&gt;</comment>
                            <comment id="17865881" author="leonard xu" created="Mon, 15 Jul 2024 06:24:48 +0000"  >&lt;p&gt;master(2.0-SNAPSHOT) via: 94c48f428bedcc07840d243ccf3f0c31e5831794&lt;/p&gt;

&lt;p&gt;release-1.20: 681760de8c6a7e14a2e418ecfb545c1363cca67c&lt;/p&gt;

&lt;p&gt;release-1.19: 562a53fb179e444ff3a53b7436ddf09b3017adfd&lt;/p&gt;</comment>
                            <comment id="17866362" author="linshangquan" created="Tue, 16 Jul 2024 11:30:54 +0000"  >&lt;p&gt;cherry-pick to release-1.19 &lt;a href=&quot;https://github.com/apache/flink/pull/25093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/25093&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;cherry-pick to release-1.20 &lt;a href=&quot;https://github.com/apache/flink/pull/25094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/25094&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leonard&quot; class=&quot;user-hover&quot; rel=&quot;leonard&quot;&gt;leonard&lt;/a&gt; Could you please take a look when you have time?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13068753" name="image-2024-05-09-14-06-58-007.png" size="53217" author="linshangquan" created="Thu, 9 May 2024 06:06:58 +0000"/>
                            <attachment id="13068752" name="image-2024-05-09-14-09-38-453.png" size="80753" author="linshangquan" created="Thu, 9 May 2024 06:09:39 +0000"/>
                            <attachment id="13068751" name="image-2024-05-09-14-11-38-476.png" size="171156" author="linshangquan" created="Thu, 9 May 2024 06:11:40 +0000"/>
                            <attachment id="13068754" name="image-2024-05-09-14-22-14-417.png" size="118776" author="linshangquan" created="Thu, 9 May 2024 06:22:15 +0000"/>
                            <attachment id="13068755" name="image-2024-05-09-14-22-59-370.png" size="41669" author="linshangquan" created="Thu, 9 May 2024 06:23:00 +0000"/>
                            <attachment id="13068770" name="image-2024-05-09-18-52-03-741.png" size="109921" author="linshangquan" created="Thu, 9 May 2024 10:52:05 +0000"/>
                            <attachment id="13068771" name="image-2024-05-09-18-52-28-584.png" size="104185" author="linshangquan" created="Thu, 9 May 2024 10:52:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 17 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1p4hk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>