<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17788] scala shell in yarn mode is broken</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17788</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When I start scala shell in yarn mode, one yarn app will be launched, and after I write some flink code and trigger a flink job, another yarn app will be launched but would failed to launch due to some conflicts.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13305594">FLINK-17788</key>
            <summary>scala shell in yarn mode is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkl0u">Kostas Kloudas</assignee>
                                    <reporter username="zjffdu">Jeff Zhang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 18 May 2020 06:17:09 +0000</created>
                <updated>Thu, 11 Jun 2020 18:57:41 +0000</updated>
                            <resolved>Thu, 11 Jun 2020 18:57:12 +0000</resolved>
                                    <version>1.10.1</version>
                    <version>1.11.0</version>
                                    <fixVersion>1.10.2</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Scala Shell</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17116780" author="kkl0u" created="Tue, 26 May 2020 14:25:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjffdu&quot; class=&quot;user-hover&quot; rel=&quot;zjffdu&quot;&gt;zjffdu&lt;/a&gt; can you be more specific on what you see as error? Also do you launch the Yarn cluster from the Flink Shell? Or you expect to find a running Yarn Cluster? And if the second is the case, how do you specify the &lt;tt&gt;ApplicationId&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;In addition, you mean that the Yarn cluster is launched and then the first job fails, or that the first job works fine, and then the second fails?&lt;/p&gt;

&lt;p&gt;The reason I am asking is because the &lt;tt&gt;DeploymentOptions.TARGET&lt;/tt&gt; that you remove in the PR has to be set to something. If you launch the yarn cluster from the FlinkYarnSessionCLI, then Flink will find the &quot;properties&quot; file that contains the &lt;tt&gt;ApplicationId&lt;/tt&gt; of the cluster and it will know where to submit the job.&lt;/p&gt;</comment>
                            <comment id="17116822" author="zjffdu" created="Tue, 26 May 2020 15:22:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt; The phenomenon I see is that when I launch scala-shell in yarn mode, it would launch one yarn app for flink yarn session cluster. Then I type some flink code to trigger one flink, then it would launch another yarn app. The root cause is that the deployment option is set to yarn-per-job which is incorrect. Actually deployment option would be set 2 times which cause the wrong setting. &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-scala-shell/src/main/scala/org/apache/flink/api/scala/FlinkShell.scala#L248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-scala-shell/src/main/scala/org/apache/flink/api/scala/FlinkShell.scala#L248&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-scala-shell/src/main/scala/org/apache/flink/api/scala/FlinkShell.scala#L287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-scala-shell/src/main/scala/org/apache/flink/api/scala/FlinkShell.scala#L287&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is not a clean fix, I think the whole flink scala shell module need to be refactoring to make the code clean. &lt;/p&gt;
</comment>
                            <comment id="17116946" author="kkl0u" created="Tue, 26 May 2020 18:09:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjffdu&quot; class=&quot;user-hover&quot; rel=&quot;zjffdu&quot;&gt;zjffdu&lt;/a&gt; I think that setting the Deployment target twice is not a problem. I agree though that the Scala Shell could use a little refactoring. So you mean that each time you call &lt;tt&gt;execute()&lt;/tt&gt;, the shell will create a new cluster, right? Will it execute the job and then kill the cluster? &lt;/p&gt;</comment>
                            <comment id="17118249" author="zjffdu" created="Thu, 28 May 2020 02:45:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt; Yes&#65292;each time when I call execute(), scala shell will create a new flink session cluster. But actually the session cluster will fail to launch, I havn&apos;t digger into it further, I suspect it  is due to some conflict with the previous flink session cluster.&lt;/p&gt;</comment>
                            <comment id="17118479" author="kkl0u" created="Thu, 28 May 2020 09:18:16 +0000"  >&lt;p&gt;Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjffdu&quot; class=&quot;user-hover&quot; rel=&quot;zjffdu&quot;&gt;zjffdu&lt;/a&gt; for the clarification. Let me know if you find anything and I will also have a look.&lt;/p&gt;</comment>
                            <comment id="17120871" author="zjffdu" created="Mon, 1 Jun 2020 09:12:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt; The second yarn app fail to launch due to port conflict, here&apos;s what I see. But anyway, scala shell should not launch another yarn app, instead it should use only one yarn session cluster.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-06-01 17:09:18,860 INFO  org.apache.flink.runtime.entrypoint.ClusterEntrypoint        [] - Shutting YarnJobClusterEntrypoint down with application status FAILED. Diagnostics org.apache.flink.util.FlinkException: Could not create the DispatcherResourceManagerComponent.
	at org.apache.flink.runtime.entrypoint.component.DefaultDispatcherResourceManagerComponentFactory.create(DefaultDispatcherResourceManagerComponentFactory.java:255)
	at org.apache.flink.runtime.entrypoint.ClusterEntrypoint.runCluster(ClusterEntrypoint.java:216)
	at org.apache.flink.runtime.entrypoint.ClusterEntrypoint.lambda$startCluster$0(ClusterEntrypoint.java:169)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1762)
	at org.apache.flink.runtime.security.contexts.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)
	at org.apache.flink.runtime.entrypoint.ClusterEntrypoint.startCluster(ClusterEntrypoint.java:168)
	at org.apache.flink.runtime.entrypoint.ClusterEntrypoint.runClusterEntrypoint(ClusterEntrypoint.java:516)
	at org.apache.flink.yarn.entrypoint.YarnJobClusterEntrypoint.main(YarnJobClusterEntrypoint.java:89)
Caused by: java.net.BindException: Could not start &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; endpoint on any port in port range 57574
	at org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RestServerEndpoint.start(RestServerEndpoint.java:222)
	at org.apache.flink.runtime.entrypoint.component.DefaultDispatcherResourceManagerComponentFactory.create(DefaultDispatcherResourceManagerComponentFactory.java:163)
	... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17133591" author="kkl0u" created="Thu, 11 Jun 2020 18:57:12 +0000"  >&lt;p&gt;Fixed on master with 6744033e1c05f51c8213d06f1fe4488c9673ed57&lt;br/&gt;
on release-1.11 with 3d0853035c1a70522bf239ced4b17c0f67c5e025&lt;br/&gt;
and on release-1.10 with a5de333d20fd56dfd77243f0a43ed4803309bfda&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0eunc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>