<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:58:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21928] DuplicateJobSubmissionException after JobManager failover</title>
                <link>https://issues.apache.org/jira/browse/FLINK-21928</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Consider the following scenario:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Environment:&#160;StandaloneApplicationClusterEntryPoint using a fixed job ID, high availability enabled&lt;/li&gt;
	&lt;li&gt;Flink job reaches a globally terminal state&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Flink job is marked as finished in the high-availability service&apos;s RunningJobsRegistry&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The JobManager fails over&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On recovery, the &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.12.2/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java#L332-L340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Dispatcher throws DuplicateJobSubmissionException, because the job is marked as done in the RunningJobsRegistry&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When this happens, users cannot get out of the situation without manually redeploying the JobManager process and changing the job ID^1^.&lt;/p&gt;

&lt;p&gt;The desired semantics are that we don&apos;t want to re-execute a job that has reached a globally terminal state. In this particular case, we know that the job has already reached such a state (as it has been marked in the registry). Therefore,&#160;we could handle this case by executing the regular termination sequence instead of throwing a DuplicateJobSubmission.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt; With ZooKeeper HA, the respective node is not ephemeral. In Kubernetes HA, there is no &#160;notion of ephemeral data that is tied to a session in the first place afaik.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;StandaloneApplicationClusterEntryPoint using a fixed job ID,&#160;High Availability enabled&lt;/p&gt;</environment>
        <key id="13366926">FLINK-21928</key>
            <summary>DuplicateJobSubmissionException after JobManager failover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dmvk">David Mor&#225;vek</assignee>
                                    <reporter username="uce">Ufuk Celebi</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>stale-critical</label>
                    </labels>
                <created>Tue, 23 Mar 2021 08:37:21 +0000</created>
                <updated>Mon, 28 Feb 2022 12:48:59 +0000</updated>
                            <resolved>Thu, 15 Jul 2021 09:28:50 +0000</resolved>
                                    <version>1.10.3</version>
                    <version>1.11.3</version>
                    <version>1.12.2</version>
                    <version>1.13.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17308739" author="till.rohrmann" created="Thu, 25 Mar 2021 14:57:43 +0000"  >&lt;p&gt;What would be the desired return value for the client as the response to the submit call? If we say that we have the job already executed then we might not have the final result of the job which we can tell the client?&lt;/p&gt;

&lt;p&gt;In general, I think the &lt;tt&gt;RunningJobsRegistry&lt;/tt&gt; does not properly work. The underlying problem is that the registry needs to contain information which can outlive the lifetime of a &lt;tt&gt;Dispatcher&lt;/tt&gt; in order to work. See &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11813&quot; title=&quot;Standby per job mode Dispatchers don&amp;#39;t know job&amp;#39;s JobSchedulingStatus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11813&quot;&gt;&lt;del&gt;FLINK-11813&lt;/del&gt;&lt;/a&gt; for more details. &lt;/p&gt;

&lt;p&gt;One idea to fix it could be that the registry is owned by the deployer of a Flink cluster and, hence, the cluster no longer clears the entries of the registry. The user of the Flink cluster is then responsible for cleaning up the registry after the cluster has been shut down. Moreover, we could say that this feature needs to be explicitly activated and is actually only useful for guarding against standby &lt;tt&gt;JobManagers&lt;/tt&gt; which should not execute the job after it has been completed by another &lt;tt&gt;JobManager&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As a kind of a quick fix, we could think about simply removing the registry since it is broken anyway.&lt;/p&gt;</comment>
                            <comment id="17328996" author="flink-jira-bot" created="Thu, 22 Apr 2021 12:23:59 +0000"  >&lt;p&gt;This critical issue is unassigned and itself and all of its Sub-Tasks have not been updated for 7 days. So, it has been labeled &quot;stale-critical&quot;. If this ticket is indeed critical, please either assign yourself or give an update. Afterwards, please remove the label. In 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17336935" author="flink-jira-bot" created="Thu, 29 Apr 2021 23:49:02 +0000"  >&lt;p&gt;This issue was labeled &quot;stale-critical&quot; 7 ago and has not received any updates so it is being deprioritized. If this ticket is actually Critical, please raise the priority and ask a committer to assign you the issue or revive the public discussion.&lt;/p&gt;</comment>
                            <comment id="17347962" author="flink-jira-bot" created="Wed, 19 May 2021 22:56:21 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17352862" author="flink-jira-bot" created="Thu, 27 May 2021 23:05:17 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17358939" author="flink-jira-bot" created="Mon, 7 Jun 2021 22:53:57 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17363973" author="flink-jira-bot" created="Tue, 15 Jun 2021 22:41:15 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17368517" author="flink-jira-bot" created="Wed, 23 Jun 2021 22:39:24 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17373097" author="flink-jira-bot" created="Thu, 1 Jul 2021 22:38:18 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17381204" author="till.rohrmann" created="Thu, 15 Jul 2021 09:24:49 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;f483008db867364adc66acbf0d207ca3a50e75e5&lt;br/&gt;
172b9e322151c079cb1c31323ec6697da48e67de&lt;br/&gt;
4a78097d0385749daceafd8326930c8cc5f26f1a&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13430198">FLINK-26333</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13367670">FLINK-21979</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13367714">FLINK-21980</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13219310">FLINK-11813</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p2v4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The fix for this problem only works if the ApplicationMode is used with a single job submission and if the user code does not access the `JobExecutionResult`. If any of these conditions is violated, then Flink cannot guarantee that the whole Flink application is executed.&lt;br/&gt;
&lt;br/&gt;
Additionally, it is still required that the user cleans up the corresponding HA entries for the running jobs registry because these entries won&amp;#39;t be reliably cleaned up when encountering the situation described by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21928&quot; title=&quot;DuplicateJobSubmissionException after JobManager failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21928&quot;&gt;&lt;strike&gt;FLINK-21928&lt;/strike&gt;&lt;/a&gt;.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>