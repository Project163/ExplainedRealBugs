<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9201] same merge window will be fired twice if watermark already passed the merge window</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9201</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;sum with session window,.suppose the session gap is 3 seconds and allowedlateness is 60 seconds&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;w1,TimeWindow&lt;span class=&quot;error&quot;&gt;&amp;#91;1,9&amp;#93;&lt;/span&gt; had elements,1,2,3,6,will be fired if watermark reached 9&lt;/li&gt;
	&lt;li&gt;&#160;if a late element (w2,TimeWindow&lt;span class=&quot;error&quot;&gt;&amp;#91;7,10&amp;#93;&lt;/span&gt;) had come but the watermark already at 11.&lt;/li&gt;
	&lt;li&gt;w1,w2 will be merged a new window w3 TimeWindow&lt;span class=&quot;error&quot;&gt;&amp;#91;1,10&amp;#93;&lt;/span&gt; and will be register a new timer by call triggerContext.onMerge(mergedWindows),w3 will be fired first time by call&#160;triggerContext.onElement(element) because of the watermark pass the w3. w3 will be fired second times because of the timer &amp;lt; current watermark.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;that mean w3 will be fired&#160; twice because of watermark pass the new merge window w3.&lt;/p&gt;

&lt;p&gt;Examples&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
@SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testSessionWindowsFiredTwice() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
 closeCalled.set(0);

 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sessionSize = 3;

 TypeInformation&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; inputType = TypeInfoParser.parse(&lt;span class=&quot;code-quote&quot;&gt;&quot;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&quot;&lt;/span&gt;);

 ListStateDescriptor&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; stateDesc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ListStateDescriptor&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;window-contents&quot;&lt;/span&gt;,
 inputType.createSerializer(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecutionConfig()));

 WindowOperator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, Iterable&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt;, Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;, TimeWindow&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WindowOperator&amp;lt;&amp;gt;(
 EventTimeSessionWindows.withGap(Time.seconds(sessionSize)),
 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TimeWindow.Serializer(),
 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TupleKeySelector(),
 BasicTypeInfo.STRING_TYPE_INFO.createSerializer(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecutionConfig()),
 stateDesc,
 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InternalIterableWindowFunction&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SessionWindowFunction()),
 EventTimeTrigger.create(),
 60000,
 &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;/* late data output tag */&lt;/span&gt;);

 OneInputStreamOperatorTestHarness&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;, Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;&amp;gt; testHarness =
 createTestHarness(&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;);

 ConcurrentLinkedQueue&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; expectedOutput = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConcurrentLinkedQueue&amp;lt;&amp;gt;();

 testHarness.open();

 &lt;span class=&quot;code-comment&quot;&gt;// add elements out-of-order
&lt;/span&gt; testHarness.processElement(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2&quot;&lt;/span&gt;, 1), 0));
 testHarness.processElement(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2&quot;&lt;/span&gt;, 2), 1000));
 testHarness.processElement(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2&quot;&lt;/span&gt;, 3), 2500));

 testHarness.processElement(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key1&quot;&lt;/span&gt;, 1), 10));
 testHarness.processElement(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key1&quot;&lt;/span&gt;, 2), 1000));
 testHarness.processWatermark(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watermark(5500));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple3&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2-6&quot;&lt;/span&gt;, 0L, 5500L), 5499));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple3&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key1-3&quot;&lt;/span&gt;, 10L, 4000L), 3999));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watermark(5500));
 &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; a snapshot, close and restore again
&lt;/span&gt; OperatorSubtaskState snapshot = testHarness.snapshot(0L, 0L);

 TestHarnessUtil.assertOutputEqualsSorted(&lt;span class=&quot;code-quote&quot;&gt;&quot;Output was not correct.&quot;&lt;/span&gt;, expectedOutput, testHarness.getOutput(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple3ResultSortComparator());
 testHarness.close();

 testHarness = createTestHarness(&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;);
 testHarness.setup();
 testHarness.initializeState(snapshot);
 testHarness.open();
 expectedOutput.clear();
 &lt;span class=&quot;code-comment&quot;&gt;//suppose the watermark alread arrived 10000
&lt;/span&gt; testHarness.processWatermark(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watermark(10000));
 &lt;span class=&quot;code-comment&quot;&gt;//late element with timestamp 4500 had arrived,the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session window[0, 7500] is still a valid window becase of maxtimestamp &amp;lt; cleantime
&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;//and fired immediately
&lt;/span&gt; testHarness.processElement(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2&quot;&lt;/span&gt;, 6), 4500));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watermark(10000));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple3&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2-12&quot;&lt;/span&gt;, 0L, 7500L), 7499));
 &lt;span class=&quot;code-comment&quot;&gt;//when a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; watermark had arrived,the same TimeWindow[0, 7500] will fired again becase of a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; timer had rigstered by call triggerOnMerge
&lt;/span&gt; testHarness.processWatermark(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watermark(11000));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamRecord&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple3&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;key2-12&quot;&lt;/span&gt;, 0L, 7500L), 7499));
 expectedOutput.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watermark(11000));
 TestHarnessUtil.assertOutputEqualsSorted(&lt;span class=&quot;code-quote&quot;&gt;&quot;Output was not correct.&quot;&lt;/span&gt;, expectedOutput, testHarness.getOutput(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple3ResultSortComparator());
 testHarness.close();
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13153303">FLINK-9201</key>
            <summary>same merge window will be fired twice if watermark already passed the merge window</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuemeng">yuemeng</assignee>
                                    <reporter username="yuemeng">yuemeng</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Apr 2018 09:26:07 +0000</created>
                <updated>Wed, 2 Oct 2019 17:42:34 +0000</updated>
                            <resolved>Mon, 14 May 2018 08:11:59 +0000</resolved>
                                    <version>1.3.3</version>
                                    <fixVersion>1.5.0</fixVersion>
                                        <due>Wed, 18 Apr 2018 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16453752" author="githubbot" created="Thu, 26 Apr 2018 09:30:07 +0000"  >&lt;p&gt;GitHub user hzyuemeng1 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9201&quot; title=&quot;same merge window will be fired twice if watermark already passed the merge window&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9201&quot;&gt;&lt;del&gt;FLINK-9201&lt;/del&gt;&lt;/a&gt; Fixed the same merge window will be fired twice if water&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;mark already passed the merge window&lt;/p&gt;


&lt;p&gt;    &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Contribution Checklist&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the pull request corresponds to a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/FLINK/issues&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/FLINK/issues&lt;/a&gt;). Exceptions are made for typos in JavaDoc or documentation files, which need no JIRA issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Name the pull request in the form &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXXX&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;component&amp;#93;&lt;/span&gt; Title of the pull request&quot;, where &lt;b&gt;FLINK-XXXX&lt;/b&gt; should be replaced by the actual issue number. Skip &lt;b&gt;component&lt;/b&gt; if you are unsure about which is the best component.&lt;br/&gt;
      Typo fixes that have no associated JIRA issue should be named following this pattern: `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Fix typo in event time introduction` or `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;javadocs&amp;#93;&lt;/span&gt; Expand JavaDoc for PuncuatedWatermarkGenerator`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fill out the template below to describe the changes contributed by the pull request. That will give reviewers the context they need to do the review.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the change passes the automated tests, i.e., `mvn clean verify` passes. You can set up Travis CI to do that following &lt;span class=&quot;error&quot;&gt;&amp;#91;this guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/contribute-code.html#best-practices&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/contribute-code.html#best-practices&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each pull request should address only one issue, not mix up code from multiple issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each commit in the pull request has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Once all items of the checklist are addressed, remove the above text and this checklist, leaving only the filled out template below.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;    *&lt;b&gt;(The sections below can be removed for hotfixes of typos)&lt;/b&gt;*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(For example: This pull request makes task deployment go through the blob server, rather than through RPC. That way we avoid re-transferring them on each deployment (during recovery).)&lt;/b&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(for example&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;The TaskInfo is stored in the blob store on job creation time as a persistent artifact&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Deployments RPC transmits only the blob storage reference&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;TaskManagers retrieve the TaskInfo from the blob cache&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(Please pick either of the following options)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;(or)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    This change is already covered by existing tests, such as &lt;b&gt;(please describe tests)&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;(or)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;(example&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Added integration tests for end-to-end deployment with large payloads (100MB)&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Extended integration test for recovery after master (JobManager) failure&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Added test that validates that TaskInfo is transferred only once across recoveries&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Manually verified the change by running a 4 node cluser with 2 JobManagers and 4 TaskManagers, a stateful streaming program, and killing one JobManager and two TaskManagers during the execution, verifying that recovery happens correctly.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / no)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / no / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hzyuemeng1/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hzyuemeng1/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9201&quot; title=&quot;same merge window will be fired twice if watermark already passed the merge window&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9201&quot;&gt;&lt;del&gt;FLINK-9201&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5917&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 177860e0d6441049c9681c5bfb9535d389c5f25e&lt;br/&gt;
Author: yuemeng &amp;lt;hzyuemeng1@...&amp;gt;&lt;br/&gt;
Date:   2018-04-26T08:55:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9201&quot; title=&quot;same merge window will be fired twice if watermark already passed the merge window&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9201&quot;&gt;&lt;del&gt;FLINK-9201&lt;/del&gt;&lt;/a&gt; Fixed the same merge window will be fired twice if watermark already passed the merge window&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16453759" author="yuemeng" created="Thu, 26 Apr 2018 09:40:06 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;can you help me to check this issue?&lt;/p&gt;

&lt;p&gt;thanks a lot&lt;/p&gt;</comment>
                            <comment id="16460606" author="yuemeng" created="Wed, 2 May 2018 06:59:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#65292;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;can you&#160; check this issue&#65311;&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16465568" author="githubbot" created="Mon, 7 May 2018 07:43:14 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @hzyuemeng1 The fix looks good. However, it&apos;s a bug in the Trigger and I think therefore the test for this should also go into `EventTimeTriggerTest`.&lt;/p&gt;</comment>
                            <comment id="16468219" author="yuemeng" created="Wed, 9 May 2018 01:58:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thanks for your&#160;suggest&lt;/p&gt;

&lt;p&gt;i will add a new test case&#160; to&#160;EventTimeTriggerTest,but still keep the old test in WindowOpertatorTest because of olny merge window will occur the probelm now&lt;/p&gt;</comment>
                            <comment id="16473891" author="githubbot" created="Mon, 14 May 2018 08:07:29 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917#discussion_r187865922&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917#discussion_r187865922&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/windowing/triggers/ProcessingTimeTrigger.java &amp;#8212;&lt;br/&gt;
    @@ -60,7 +60,12 @@ public boolean canMerge() {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public void onMerge(TimeWindow window,&lt;br/&gt;
     			OnMergeContext ctx) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ctx.registerProcessingTimeTimer(window.maxTimestamp());&lt;br/&gt;
    +		//only current wartermark less than a merge window maxtimestamp that we regsiter a new timer for fire&lt;br/&gt;
    +		//otherwise if will fired immediately by call onElement&lt;br/&gt;
    +		long windowMaxTimestamp = window.maxTimestamp();&lt;br/&gt;
    +		if (windowMaxTimestamp &amp;gt; ctx.getCurrentWatermark()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    this should use `ctx.currentProcessingTime()`. I&apos;ll fix while merging.&lt;/p&gt;</comment>
                            <comment id="16473900" author="aljoscha" created="Mon, 14 May 2018 08:11:59 +0000"  >&lt;p&gt;release-1.5:&lt;br/&gt;
038eb1d02f720ddfda1854dcfb04789088c7c823&lt;br/&gt;
a809a2650b44c00e4c25058fce439b1051033cf3&lt;/p&gt;

&lt;p&gt;master:&lt;br/&gt;
3afb7b3512353e28cd2fb7f49cd88c8caaa0da0c&lt;br/&gt;
64f32f9299bfdb7e7b1fcd759618c37638a6a5b7&lt;/p&gt;</comment>
                            <comment id="16473902" author="githubbot" created="Mon, 14 May 2018 08:12:32 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @hzyuemeng1 for finding and fixing this. &#128077; &lt;/p&gt;</comment>
                            <comment id="16473903" author="githubbot" created="Mon, 14 May 2018 08:12:33 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16473966" author="githubbot" created="Mon, 14 May 2018 09:26:04 +0000"  >&lt;p&gt;Github user hzyuemeng1 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5917#discussion_r187887606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5917#discussion_r187887606&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/windowing/triggers/ProcessingTimeTrigger.java &amp;#8212;&lt;br/&gt;
    @@ -60,7 +60,12 @@ public boolean canMerge() {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public void onMerge(TimeWindow window,&lt;br/&gt;
     			OnMergeContext ctx) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ctx.registerProcessingTimeTimer(window.maxTimestamp());&lt;br/&gt;
    +		//only current wartermark less than a merge window maxtimestamp that we regsiter a new timer for fire&lt;br/&gt;
    +		//otherwise if will fired immediately by call onElement&lt;br/&gt;
    +		long windowMaxTimestamp = window.maxTimestamp();&lt;br/&gt;
    +		if (windowMaxTimestamp &amp;gt; ctx.getCurrentWatermark()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    thanks for your review and merge&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sp5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>