<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-25022] ClassLoader leak with ThreadLocals on the JM when submitting a job through the REST API</title>
                <link>https://issues.apache.org/jira/browse/FLINK-25022</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If a job is submitted using the REST API&apos;s &lt;tt&gt;/jars/:jarid/run&lt;/tt&gt; endpoint, user code has to be executed on the JobManager and it is doing this in a couple of (pooled) dispatcher threads like &lt;tt&gt;Flink-DispatcherRestEndpoint-thread-*&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If the user code is using thread locals (and not cleaning them up), they may remain in the thread with references to the &lt;tt&gt;ChildFirstClassloader&lt;/tt&gt; of the job and thus leaking that.&lt;/p&gt;

&lt;p&gt;We saw this for the &lt;tt&gt;jsoniter&lt;/tt&gt; scala library at the JM which &lt;a href=&quot;https://github.com/plokhotnyuk/jsoniter-scala/blob/95c7053cfaa558877911f3448382f10d53c4fcbf/jsoniter-scala-core/jvm/src/main/scala/com/github/plokhotnyuk/jsoniter_scala/core/package.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;creates ThreadLocal instances&lt;/a&gt; but doesn&apos;t remove them, but it can actually happen with any user code or (worse) library used in user code.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;There are a few &lt;b&gt;workarounds&lt;/b&gt; a user can use, e.g. putting the library in Flink&apos;s lib/ folder or submitting via the Flink CLI, but these may actually not be possible to use, depending on the circumstances.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A &lt;b&gt;proper fix&lt;/b&gt; should happen in Flink by guarding against any of these things in the dispatcher threads. We could, for example, spawn a separate thread for executing the user&apos;s &lt;tt&gt;main()&lt;/tt&gt; method and once the job is submitted exit that thread and destroy all thread locals along with it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13413425">FLINK-25022</key>
            <summary>ClassLoader leak with ThreadLocals on the JM when submitting a job through the REST API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 23 Nov 2021 16:55:06 +0000</created>
                <updated>Thu, 7 Apr 2022 18:21:37 +0000</updated>
                            <resolved>Tue, 7 Dec 2021 15:13:13 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.12.5</version>
                    <version>1.13.3</version>
                                    <fixVersion>1.12.8</fixVersion>
                    <fixVersion>1.13.6</fixVersion>
                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / REST</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17453396" author="zentol" created="Sat, 4 Dec 2021 13:24:42 +0000"  >&lt;p&gt;master: 1f212f2ef04e36e0248098a26e7db43a6d65796a&lt;br/&gt;
1.14: 5207fe560dc6a054beb0eb0a25af009215ca9f23&lt;br/&gt;
1.13: 59d19caf3687dfd3dcaadc14cc11c6bbdf33198e&lt;br/&gt;
1.12: fdd52a787260e2d4dd97473a74e7e45222dbd099&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13411489">FLINK-24888</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x0mw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>