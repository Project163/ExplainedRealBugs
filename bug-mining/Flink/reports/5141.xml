<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:54:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21523] ArrayIndexOutOfBoundsException occurs while run a hive streaming job with partitioned table source </title>
                <link>https://issues.apache.org/jira/browse/FLINK-21523</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;we have two hive table, the ddl as below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//test_tbl5
&lt;/span&gt;create table test.test_5
 (dpi &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,     
  uid bigint) 
partitioned by( day string, hour string) stored as parquet;

&lt;span class=&quot;code-comment&quot;&gt;//test_tbl3
&lt;/span&gt;create table test.test_3(
  dpi &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
 uid bigint,    
 itime timestamp) stored as parquet;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;then add a partiton to test_tbl5,&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
alter table test_tbl5 add partition(day=&lt;span class=&quot;code-quote&quot;&gt;&apos;2021-02-27&apos;&lt;/span&gt;,hour=&lt;span class=&quot;code-quote&quot;&gt;&apos;12&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we start a flink streaming job to read hive table test_tbl5 , and write the data into test_tbl3, the job&apos;s&#160; sql as&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set test_tbl5.streaming-source.enable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
insert into hive.test.test_tbl3 select dpi, uid, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(to_timestamp(&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-08-09 00:00:00&apos;&lt;/span&gt;) as timestamp(9)) from hive.test.test_tbl5 where `day` = &lt;span class=&quot;code-quote&quot;&gt;&apos;2021-02-27&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and we seen the exception throws&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-02-28 22:33:16,553 ERROR org.apache.flink.runtime.source.coordinator.SourceCoordinatorContext - Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; handling result from async call in SourceCoordinator-Source: HiveSource-test.test_tbl5. Triggering job failover.org.apache.flink.connectors.hive.FlinkHiveException: Failed to enumerate files    at org.apache.flink.connectors.hive.ContinuousHiveSplitEnumerator.handleNewSplits(ContinuousHiveSplitEnumerator.java:152) ~[flink-connector-hive_2.12-1.12.1.jar:1.12.1]    at org.apache.flink.runtime.source.coordinator.ExecutorNotifier.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$4(ExecutorNotifier.java:136) ~[flink-dist_2.12-1.12.1.jar:1.12.1]    at org.apache.flink.util.ThrowableCatchingRunnable.run(ThrowableCatchingRunnable.java:40) [flink-dist_2.12-1.12.1.jar:1.12.1]    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_60]    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_60]    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [?:1.8.0_60]Caused by: java.lang.ArrayIndexOutOfBoundsException: -1    at org.apache.flink.connectors.hive.util.HivePartitionUtils.toHiveTablePartition(HivePartitionUtils.java:184) ~[flink-connector-hive_2.12-1.12.1.jar:1.12.1]    at org.apache.flink.connectors.hive.HiveTableSource$HiveContinuousPartitionFetcherContext.toHiveTablePartition(HiveTableSource.java:417) ~[flink-connector-hive_2.12-1.12.1.jar:1.12.1]    at org.apache.flink.connectors.hive.ContinuousHiveSplitEnumerator$PartitionMonitor.call(ContinuousHiveSplitEnumerator.java:237) ~[flink-connector-hive_2.12-1.12.1.jar:1.12.1]    at org.apache.flink.connectors.hive.ContinuousHiveSplitEnumerator$PartitionMonitor.call(ContinuousHiveSplitEnumerator.java:177) ~[flink-connector-hive_2.12-1.12.1.jar:1.12.1]    at org.apache.flink.runtime.source.coordinator.ExecutorNotifier.lambda$notifyReadyAsync$5(ExecutorNotifier.java:133) ~[flink-dist_2.12-1.12.1.jar:1.12.1]    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_60]    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) ~[?:1.8.0_60]    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) ~[?:1.8.0_60]    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) ~[?:1.8.0_60]    ... 3 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it seems the partitoned field is not found in the source table field list.&lt;br/&gt;
 &#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13361443">FLINK-21523</key>
            <summary>ArrayIndexOutOfBoundsException occurs while run a hive streaming job with partitioned table source </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zouyunhe">KevinyhZou</assignee>
                                    <reporter username="zouyunhe">KevinyhZou</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 28 Feb 2021 15:23:09 +0000</created>
                <updated>Sat, 13 Mar 2021 06:19:14 +0000</updated>
                            <resolved>Fri, 12 Mar 2021 10:28:47 +0000</resolved>
                                    <version>1.12.1</version>
                                    <fixVersion>1.13.0</fixVersion>
                    <fixVersion>1.12.3</fixVersion>
                                    <component>Connectors / Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17292571" author="zouyunhe" created="Mon, 1 Mar 2021 02:39:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160; hello, please take a look at this issue&#12290;&#160;&lt;/p&gt;</comment>
                            <comment id="17294292" author="lirui" created="Wed, 3 Mar 2021 05:47:30 +0000"  >&lt;p&gt;I guess it&apos;s because the projection pushdown doesn&apos;t include the partition column so that we don&apos;t have it in the field name/type arrays.&lt;/p&gt;</comment>
                            <comment id="17294296" author="zouyunhe" created="Wed, 3 Mar 2021 06:05:57 +0000"  >&lt;p&gt;I print some debug log , the partition field is not found in the projected fields. just like you said &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17294299" author="lirui" created="Wed, 3 Mar 2021 06:14:48 +0000"  >&lt;p&gt;So if &lt;tt&gt;HivePartitionFetcherContextBase&lt;/tt&gt; needs the full field names/types, we should call &lt;tt&gt;HiveTableSource::getTableSchema&lt;/tt&gt; rather than &lt;tt&gt;getProducedTableSchema&lt;/tt&gt; when constructing the context. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="17295085" author="leonard xu" created="Thu, 4 Mar 2021 08:34:01 +0000"  >&lt;p&gt;Make sense to me&lt;/p&gt;</comment>
                            <comment id="17300210" author="jark" created="Fri, 12 Mar 2021 10:28:47 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 63a6aba6722ae0e3d17381aaeb2fa464ea15d2f5&lt;/li&gt;
	&lt;li&gt;release-1.12: 621d7c223c5e8044ecb7965faf086431500f7d63&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0o55s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>