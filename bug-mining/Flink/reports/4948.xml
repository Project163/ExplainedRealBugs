<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19435] Deadlock when loading different driver classes concurrently using Class.forName</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19435</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;when we sink data to multi jdbc outputformat ,&#160;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void establishConnection() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException, ClassNotFoundException {
 &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(drivername);
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (username == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
 connection = DriverManager.getConnection(dbURL);
 } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
 connection = DriverManager.getConnection(dbURL, username, password);
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;may cause jdbc driver deadlock. it need to change to synchronized function.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13329622">FLINK-19435</key>
            <summary>Deadlock when loading different driver classes concurrently using Class.forName</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kezhuw">Kezhu Wang</assignee>
                                    <reporter username="xiaodao">xiaodao</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 27 Sep 2020 12:25:15 +0000</created>
                <updated>Wed, 13 Jan 2021 12:28:57 +0000</updated>
                            <resolved>Tue, 22 Dec 2020 02:55:48 +0000</resolved>
                                    <version>1.10.2</version>
                                    <fixVersion>1.12.1</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Connectors / JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17203615" author="jark" created="Tue, 29 Sep 2020 03:44:55 +0000"  >&lt;p&gt;You mean &lt;tt&gt;Class.forName()&lt;/tt&gt; is not thread safe? &lt;/p&gt;</comment>
                            <comment id="17210907" author="xiaodao" created="Fri, 9 Oct 2020 12:49:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160; yes.&lt;/p&gt;

&lt;p&gt;this is my test program.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13013314/13013314_image-2020-10-09-20-48-48-261.png&quot; height=&quot;392&quot; width=&quot;1015&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;and this is jstack info:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13013315/13013315_image-2020-10-09-20-49-23-644.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17244654" author="kezhuw" created="Sun, 6 Dec 2020 05:13:08 +0000"  >&lt;p&gt;Seems that this problem still exist. I have pushed &lt;a href=&quot;https://github.com/kezhuw/flink/commits/flink-19435-sql-driver-class-loading-deadlock-test-case&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a branch&lt;/a&gt; with &lt;a href=&quot;https://github.com/kezhuw/flink/commit/a732d30093073e1e5bcdbed13290cef3f9a00d69#diff-0dafd910621d60887021215d320c2a9fc5b12305825c6776de8a307483920a52R110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hang test case&lt;/a&gt; in my repository to demonstrate this. One could use command &lt;tt&gt;mvn -Dcheckstyle.skip=true -Dtest=JdbcDriverClassConcurrentLoadingTest -DfailIfNoTests=false -pl &quot;flink-connectors/flink-connector-jdbc&quot; -am test -Pskip-webui-build&lt;/tt&gt; or IDE to reproduce this hang. Please rerun if it does not, it is near 100% in my local environment. After hang, you will see similar threads in thread stack dumps:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;Sink: Postgres Jdbc Sink (1/1)#0&quot;&lt;/span&gt; #102 prio=5 os_prio=31 tid=0x00007f8fae050800 nid=0xd703 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x000070000fb6c000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.newInstance(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:442)
        at java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:380)
        at java.util.ServiceLoader$LazyIterator.next(ServiceLoader.java:404)
        at java.util.ServiceLoader$1.next(ServiceLoader.java:480)
        at java.sql.DriverManager$2.run(DriverManager.java:603)
        at java.sql.DriverManager$2.run(DriverManager.java:583)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.sql.DriverManager.loadInitialDrivers(DriverManager.java:583)
        at java.sql.DriverManager.&amp;lt;clinit&amp;gt;(DriverManager.java:101)
        at org.postgresql.Driver.register(Driver.java:721)
        at org.postgresql.Driver.&amp;lt;clinit&amp;gt;(Driver.java:73)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:264)
        at org.apache.flink.connector.jdbc.internal.connection.SimpleJdbcConnectionProvider.getConnection(SimpleJdbcConnectionProvider.java:52)
        - locked &amp;lt;0x000000074cf7c3e8&amp;gt; (a org.apache.flink.connector.jdbc.internal.connection.SimpleJdbcConnectionProvider)
        at org.apache.flink.connector.jdbc.internal.AbstractJdbcOutputFormat.establishConnection(AbstractJdbcOutputFormat.java:66)
        at org.apache.flink.connector.jdbc.internal.AbstractJdbcOutputFormat.open(AbstractJdbcOutputFormat.java:59)
        at org.apache.flink.connector.jdbc.internal.JdbcBatchingOutputFormat.open(JdbcBatchingOutputFormat.java:114)
        at org.apache.flink.connector.jdbc.internal.GenericJdbcSinkFunction.open(GenericJdbcSinkFunction.java:50)
        at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:36)
        at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:102)
        at org.apache.flink.streaming.api.operators.StreamSink.open(StreamSink.java:48)
        at org.apache.flink.streaming.runtime.tasks.OperatorChain.initializeStateAndOpenOperators(OperatorChain.java:401)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$beforeInvoke$2(StreamTask.java:507)
        at org.apache.flink.streaming.runtime.tasks.StreamTask$$Lambda$641/1400119541.run(Unknown Source)
        at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.runThrowing(StreamTaskActionExecutor.java:47)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.beforeInvoke(StreamTask.java:501)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:531)
        at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:722)
        at org.apache.flink.runtime.taskmanager.Task.run(Task.java:547)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

&lt;span class=&quot;code-quote&quot;&gt;&quot;Sink: MySQL Jdbc Sink (1/1)#0&quot;&lt;/span&gt; #101 prio=5 os_prio=31 tid=0x00007f8fae37b000 nid=0x12603 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x000070000fa6a000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
        at com.mysql.cj.jdbc.Driver.&amp;lt;clinit&amp;gt;(Driver.java:55)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:264)
        at org.apache.flink.connector.jdbc.internal.connection.SimpleJdbcConnectionProvider.getConnection(SimpleJdbcConnectionProvider.java:52)
        - locked &amp;lt;0x000000074d0a5368&amp;gt; (a org.apache.flink.connector.jdbc.internal.connection.SimpleJdbcConnectionProvider)
        at org.apache.flink.connector.jdbc.internal.AbstractJdbcOutputFormat.establishConnection(AbstractJdbcOutputFormat.java:66)
        at org.apache.flink.connector.jdbc.internal.AbstractJdbcOutputFormat.open(AbstractJdbcOutputFormat.java:59)
        at org.apache.flink.connector.jdbc.internal.JdbcBatchingOutputFormat.open(JdbcBatchingOutputFormat.java:114)
        at org.apache.flink.connector.jdbc.internal.GenericJdbcSinkFunction.open(GenericJdbcSinkFunction.java:50)
        at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:36)
        at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:102)
        at org.apache.flink.streaming.api.operators.StreamSink.open(StreamSink.java:48)
        at org.apache.flink.streaming.runtime.tasks.OperatorChain.initializeStateAndOpenOperators(OperatorChain.java:401)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$beforeInvoke$2(StreamTask.java:507)
        at org.apache.flink.streaming.runtime.tasks.StreamTask$$Lambda$641/1400119541.run(Unknown Source)
        at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.runThrowing(StreamTaskActionExecutor.java:47)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.beforeInvoke(StreamTask.java:501)
        at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:531)
        at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:722)
        at org.apache.flink.runtime.taskmanager.Task.run(Task.java:547)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two threads are deadlock due to &lt;a href=&quot;https://github.com/openjdk/jdk/blob/jdk8-b120/hotspot/src/share/vm/oops/instanceKlass.cpp#L794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;wait on each other&apos;s initializing static block in JVM&lt;/a&gt;. Restricted to above dump, thread &lt;tt&gt;Sink: Postgres Jdbc Sink (1/1)#0&lt;/tt&gt; is waiting on &lt;tt&gt;com.mysql.cj.jdbc.Driver&lt;/tt&gt;&apos;s static block in &lt;tt&gt;java.sql.DriverManager&lt;/tt&gt;&apos;s static block, thread &lt;tt&gt;Sink: MySQL Jdbc Sink (1/1)#0&lt;/tt&gt; is waiting on &lt;tt&gt;java.sql.DriverManager&lt;/tt&gt;&apos;s static block in &lt;tt&gt;com.mysql.cj.jdbc.Driver&lt;/tt&gt;&apos;s static block.&lt;/p&gt;

&lt;p&gt;To trigger this deadlock, one could load different driver classes concurrently using &lt;tt&gt;Class.forName&lt;/tt&gt; before &lt;tt&gt;java.sql.DriverManager&lt;/tt&gt; is loaded. Here is &lt;a href=&quot;https://medium.com/@priyaaggarwal24/avoiding-deadlock-when-using-multiple-jdbc-drivers-in-an-application-ce0b9464ecdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a relatively detailed article&lt;/a&gt; on this problem, there are should be more on internet. This is a JDK 8 specific problem, it has been solved in jdk 9 and above with &lt;a href=&quot;https://github.com/openjdk/jdk/commit/7e500d532492437658e6736d6279809f3fa40406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-8060068&lt;/a&gt; and &lt;a href=&quot;https://github.com/openjdk/jdk/commit/ddcbf6138900d2f3a6c550ceea5a01e096819323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-8067904&lt;/a&gt; by moving driver loading out of &lt;tt&gt;java.sql.DriverManager&lt;/tt&gt;&apos;s static block.&lt;/p&gt;

&lt;p&gt;There are probably several ways to circumvent this, such as ensuring &lt;tt&gt;java.sql.DriverManager&lt;/tt&gt; is loaded before &lt;tt&gt;Class.forName&lt;/tt&gt; and locking on a global enough object before &lt;tt&gt;Class.forName&lt;/tt&gt;. But I think a more elegant way is not using &lt;tt&gt;Class.forName&lt;/tt&gt; for driver class loading. &lt;tt&gt;DriverManager.getConnection&lt;/tt&gt; will do this automatically for us. It is value of &lt;tt&gt;java.sql.Driver&lt;/tt&gt; and &lt;tt&gt;java.util.ServiceLoader&lt;/tt&gt;: care about promise not implementation. I think we should drop required field &lt;tt&gt;driverName&lt;/tt&gt; from &lt;tt&gt;JdbcConnectionOptions&lt;/tt&gt; in long term as it force clients care about driver class in addition to driver jar.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt; What do you think ?&lt;/p&gt;</comment>
                            <comment id="17244920" author="jark" created="Mon, 7 Dec 2020 03:12:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt; for the detailed anaylisis. I reproduced the problem using your code. Your proposal makes sense to me. Currently, &lt;tt&gt;driverName&lt;/tt&gt; is optional, I think we can drop it if necessary. &lt;br/&gt;
Do you want to take this issue?&lt;/p&gt;</comment>
                            <comment id="17245245" author="kezhuw" created="Mon, 7 Dec 2020 14:48:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; I am willing to take over this.&lt;/p&gt;

&lt;p&gt;Currently, &lt;tt&gt;driverName&lt;/tt&gt; plays nothing except class loading, I think it is ok to omit &lt;tt&gt;Class.forName&lt;/tt&gt; without breaking existing code.&lt;/p&gt;

&lt;p&gt;But I saw &lt;tt&gt;JdbcDialect.defaultDriverName&lt;/tt&gt;, I am wondering whether we proposed to provide a strong guarantee to clients that a driver with class name &lt;tt&gt;driverName&lt;/tt&gt; will be used to handle jdbc connection if provided. If this is the case, simply dropping &lt;tt&gt;driverName&lt;/tt&gt; may cause rollback in future. This could be useful if clients want to switch between different drivers for one database. But this will also complicate things much because of reasons: 1), all connection-establishing code will need to take care of this, for example &lt;tt&gt;PostgresCatalog&lt;/tt&gt; may need handle this well; 2), jdbc connector need be driver-agnostic(or support all possible drivers) to achieve this. I am not sure whether this is an reasonable use case to keep &lt;tt&gt;driverName&lt;/tt&gt;. If this driver level customization is not desired, then &lt;tt&gt;JdbcDialect.defaultDriverName&lt;/tt&gt; is useless.&lt;/p&gt;

&lt;p&gt;Besides this, though &lt;tt&gt;driverName&lt;/tt&gt; is not direct accessible from sql clients, but it is an required field in &lt;tt&gt;JdbcConnectionOptions&lt;/tt&gt; which is &lt;tt&gt;PublicEvolving&lt;/tt&gt;. And if we want make that field optional, we need change signature of &lt;tt&gt;getDriverName&lt;/tt&gt; according to &lt;a href=&quot;https://flink.apache.org/contributing/code-style-and-quality-java.html#java-optional&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;coding style&lt;/a&gt; which is an API breaking operation.&lt;/p&gt;</comment>
                            <comment id="17245317" author="jark" created="Mon, 7 Dec 2020 16:13:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;&quot;This could be useful if clients want to switch between different drivers for one database.&quot;&lt;br/&gt;
Do you have use cases that show switching different drivers is useful?&lt;/p&gt;

&lt;p&gt;&quot;but it is an required field in JdbcConnectionOptions which is PublicEvolving.&quot;&lt;br/&gt;
I just noticed this. Well, this is sad. &lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; do you know why we require the driverName in JdbcConnectionOptions? Is there any strong use cases depends on this?&lt;/p&gt;</comment>
                            <comment id="17245399" author="roman_khachatryan" created="Mon, 7 Dec 2020 18:10:11 +0000"  >&lt;p&gt;I guess Class.forName is there only for historical reasons (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;might know better). I agree that DriverManager should be able to find the driver (the same class loaders are used).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;However, I see that&#160;SimpleJdbcConnectionProvider calls&#160;DriverManager.getConnection which internally can also call&#160;Class.forName.&lt;/p&gt;

&lt;p&gt;So simply removing&#160;Class.forName from Flink code might not solve the problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17245593" author="kezhuw" created="Tue, 8 Dec 2020 00:50:28 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Do you have use cases that show switching different drivers is useful?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, just a paranoid hypothesis that client may use different drivers for one dialect in one stream, I am not sure whether this is an reasonable use case. Personally, I tend to drop &lt;tt&gt;driverName&lt;/tt&gt; as the de-facto one-to-one binding among dialect and driver implementation, it will also simplify things. But I am kind of worry about whether driver class customization was desired in current design as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; checked in.&lt;/p&gt;</comment>
                            <comment id="17245594" author="kezhuw" created="Tue, 8 Dec 2020 00:52:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; Inside &lt;tt&gt;DriverManager.getConnection&lt;/tt&gt;, &lt;tt&gt;DriverManager&lt;/tt&gt; has been loaded, no one will block on its static block.&lt;/p&gt;</comment>
                            <comment id="17245624" author="jark" created="Tue, 8 Dec 2020 02:32:30 +0000"  >&lt;p&gt;What do you think about this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;? I found the original discussion about the driverName: &lt;a href=&quot;https://github.com/apache/flink/pull/8867#discussion_r298877518&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/8867#discussion_r298877518&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17245632" author="lzljs3620320" created="Tue, 8 Dec 2020 03:02:18 +0000"  >&lt;p&gt;Thanks all for your discussions.&lt;/p&gt;

&lt;p&gt;I prefer to keep the&#160;driver class customization.&#160;I think customized&#160;driver is needed since JDBC has exposed the ability of driver.&lt;/p&gt;

&lt;p&gt;There is another way to solve this&#160;deadlock problem, we can initialize DriverManager first before loading JDBC Drivers like Storm and Spark do:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/STORM-2527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/STORM-2527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23186&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-23186&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="17245646" author="jark" created="Tue, 8 Dec 2020 03:41:29 +0000"  >&lt;p&gt;I&apos;m also fine with the Spark way: &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/jdbc/DriverRegistry.scala#L41&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/jdbc/DriverRegistry.scala#L41&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;which looks like not change a lot. &lt;/p&gt;</comment>
                            <comment id="17245898" author="kezhuw" created="Tue, 8 Dec 2020 13:55:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; From capability side, it is nice to have driver class customization. But current implementation has margin to support this:&lt;br/&gt;
1. &lt;tt&gt;driverName&lt;/tt&gt; is not used to filter &lt;tt&gt;Driver&lt;/tt&gt; now.&lt;br/&gt;
2. &lt;tt&gt;PostgresCatalog&lt;/tt&gt; and &lt;tt&gt;JdbcCatalog&lt;/tt&gt; does not take &lt;tt&gt;driverName&lt;/tt&gt; into account.&lt;br/&gt;
3. &lt;tt&gt;PostgresDialect.getRowConverter&lt;/tt&gt; is tied to &lt;tt&gt;org.postgresql:postgresql&lt;/tt&gt;.&lt;br/&gt;
4. Which driver should be default for jdbc dialect/connection if no &lt;tt&gt;driverName&lt;/tt&gt; specified ? I prefer to driver selected by &lt;tt&gt;DriverManager.getConnection&lt;/tt&gt;, it make &lt;tt&gt;JdbcDialect&lt;/tt&gt; a step to driver-agnostic and free clients from caring about concrete driver class. But we may meet api compatibility issue as &lt;tt&gt;JdbcConnectionOptions&lt;/tt&gt; has its own exposing path besides sql.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; I think we may need steps to solve all discussions in this jira:&lt;br/&gt;
1. Fix deadlock issue by ensuring &lt;tt&gt;DriverManager&lt;/tt&gt; is loaded before &lt;tt&gt;Class.forName(driverName)&lt;/tt&gt;. We need touch &lt;tt&gt;JdbcInputFormat&lt;/tt&gt;, &lt;tt&gt;JdbcLookupFunction&lt;/tt&gt;, &lt;tt&gt;JdbcRowDataLookupFunction&lt;/tt&gt; and &lt;tt&gt;SimpleJdbcConnectionProvider&lt;/tt&gt;.&lt;br/&gt;
2. Migrate &lt;tt&gt;JdbcInputFormat&lt;/tt&gt;, &lt;tt&gt;JdbcLookupFunction&lt;/tt&gt;, &lt;tt&gt;JdbcRowDataLookupFunction&lt;/tt&gt; to &lt;tt&gt;SimpleJdbcConnectionProvider&lt;/tt&gt;.&lt;br/&gt;
3. Support driver class filter in &lt;tt&gt;SimpleJdbcConnectionProvider&lt;/tt&gt;. We could assert this support in test with fake driver classes.&lt;br/&gt;
4. Solve rest concerns, such as: should &lt;tt&gt;JdbcConnectionOptions.driverName&lt;/tt&gt; be optional from &lt;tt&gt;JdbcSink&lt;/tt&gt; and sql ? &lt;/p&gt;

&lt;p&gt;What do you think ?&lt;/p&gt;</comment>
                            <comment id="17246309" author="jark" created="Wed, 9 Dec 2020 06:34:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt;, you are right. The current &lt;tt&gt;PostgresDialect&lt;/tt&gt; implementation is tied to the specific driver and I think we have to do this if we want to have better integration with external databases. &lt;/p&gt;

&lt;p&gt;Your steps sound good to me. I have assigned this issue to you. Feel free to create other related issues if needed. &lt;/p&gt;

&lt;p&gt;&amp;gt; should JdbcConnectionOptions.driverName be optional from JdbcSink and sql?&lt;/p&gt;

&lt;p&gt;I think we can make them optional, at least it is optional for SQL connectors (by using the default driver name defined in &lt;tt&gt;JdbcDialect&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="17252580" author="jark" created="Mon, 21 Dec 2020 02:44:23 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 7ca2dd311a2e5dc3b30a99ce56ad384f267b6c4f, 84ed65356fe61e6ba74a7e4c4aef0dbd3c63f44a&lt;/li&gt;
	&lt;li&gt;release-1.12: 6ed1a28cb196042c5ba229821cd63cdf71633c22,39b53f672d7fa745c331012643a8de28b02b2821&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13013314" name="image-2020-10-09-20-48-48-261.png" size="157033" author="xiaodao" created="Fri, 9 Oct 2020 12:48:51 +0000"/>
                            <attachment id="13013315" name="image-2020-10-09-20-49-23-644.png" size="94790" author="xiaodao" created="Fri, 9 Oct 2020 12:49:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0iydc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>