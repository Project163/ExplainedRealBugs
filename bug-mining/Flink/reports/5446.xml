<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:57:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22719] WindowJoinUtil.containsWindowStartEqualityAndEndEquality should not throw exception</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22719</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This will broke regular join sql.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13379420">FLINK-22719</key>
            <summary>WindowJoinUtil.containsWindowStartEqualityAndEndEquality should not throw exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jingzhang">Jing Zhang</assignee>
                                    <reporter username="lzljs3620320">Jingsong Lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 20 May 2021 03:32:04 +0000</created>
                <updated>Sat, 28 Aug 2021 12:12:13 +0000</updated>
                            <resolved>Mon, 24 May 2021 02:12:27 +0000</resolved>
                                                    <fixVersion>1.14.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17348032" author="qingru zhang" created="Thu, 20 May 2021 03:35:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;I agree with you, If join has two window nodes as input nodes, however join condition does not satisfy window join condition restrict,&#160; it could fall back to regular join.&lt;/p&gt;</comment>
                            <comment id="17348084" author="qingru zhang" created="Thu, 20 May 2021 06:10:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;, There exists multiple cases in WindowJoinTest to test those cases which window join condition is not valid. After I remove the exception thrown logical in WindowJoinUtil.containsWindowStartEqualityAndEndEquality, those cases also thrown a Exception,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
aused by: org.apache.flink.table.api.TableException: Rowtime attributes must not be in the input rows of a regular join. As a workaround you can &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; the time attributes of input tables to TIMESTAMP before.aused by: org.apache.flink.table.api.TableException: Rowtime attributes must not be in the input rows of a regular join. As a workaround you can &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; the time attributes of input tables to TIMESTAMP before. at org.apache.flink.table.planner.plan.rules.physical.stream.StreamPhysicalJoinRule.matches(StreamPhysicalJoinRule.scala:78) at org.apache.calcite.plan.volcano.VolcanoRuleCall.matchRecurse(VolcanoRuleCall.java:284) at org.apache.calcite.plan.volcano.VolcanoRuleCall.matchRecurse(VolcanoRuleCall.java:411) at org.apache.calcite.plan.volcano.VolcanoRuleCall.matchRecurse(VolcanoRuleCall.java:411) at org.apache.calcite.plan.volcano.VolcanoRuleCall.match(VolcanoRuleCall.java:268) at org.apache.calcite.plan.volcano.VolcanoPlanner.fireRules(VolcanoPlanner.java:985) at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1245) at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589) at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604) at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:84) at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:268) at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1132) at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:589) at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:604) at org.apache.calcite.plan.volcano.VolcanoPlanner.changeTraits(VolcanoPlanner.java:486) at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:309) at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:64) ... 45 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17348087" author="qingru zhang" created="Thu, 20 May 2021 06:13:46 +0000"  >&lt;p&gt;Now there is no possible to do a regular join directly after two window operations because of the above exception. Is there any need to remove thrown exception in `WindowJoinUtil` to let those cases fall back to regular join?&#160;&lt;/p&gt;</comment>
                            <comment id="17348091" author="lzljs3620320" created="Thu, 20 May 2021 06:32:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingru+zhang&quot; class=&quot;user-hover&quot; rel=&quot;qingru zhang&quot;&gt;qingru zhang&lt;/a&gt;&#160;Do not select row time field, we just need window start or window end.&lt;/p&gt;</comment>
                            <comment id="17348096" author="qingru zhang" created="Thu, 20 May 2021 06:41:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;Thanks for point out the root cause , I would update these cases to remove row time.&lt;/p&gt;</comment>
                            <comment id="17350210" author="lzljs3620320" created="Mon, 24 May 2021 02:12:27 +0000"  >&lt;p&gt;Fixed via master:&#160;5ec4755def4f7705b45e2ea154ed8e2857cceda0&lt;/p&gt;</comment>
                            <comment id="17350889" author="twalthr" created="Tue, 25 May 2021 07:56:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160;I&apos;m not sure if the issue has been fixed properly. I haven&apos;t looked into the PR yet but I worked on this issue before as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt; before the Blink merge interrupted a complete fix. Can we guarantee that the downstream operators still receive a valid rowtime attribute when removing this check?&#160;&lt;/p&gt;</comment>
                            <comment id="17365839" author="qingru zhang" created="Sat, 19 Jun 2021 03:24:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;&#160;Sorry for late response.&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22719&quot; title=&quot;WindowJoinUtil.containsWindowStartEqualityAndEndEquality should not throw exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22719&quot;&gt;&lt;del&gt;FLINK-22719&lt;/del&gt;&lt;/a&gt;&#160;aims to fallback to&#160;regular join if the logicalJoin does not satisfy the requirements to convert to WindowJoin. It does not aim to fix the problems describe in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt;. We just avoid the exception in the unit test of previous WindowJoinTest by updating SQL query in unit test not select row time field. It means &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt;&#160; is still present if we keep the previous&#160;unit test of WindowJoinTest.&lt;/p&gt;

&lt;p&gt;About&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt;, I totally agree with you moving the time indicator materialization closely before the physical optimization.&lt;/p&gt;</comment>
                            <comment id="17366337" author="lzljs3620320" created="Mon, 21 Jun 2021 02:22:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingru+zhang&quot; class=&quot;user-hover&quot; rel=&quot;qingru zhang&quot;&gt;qingru zhang&lt;/a&gt;&#160;is right, they are different problems. In some cases(select rowtime field in downstream join), &#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt; is the blocker of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22719&quot; title=&quot;WindowJoinUtil.containsWindowStartEqualityAndEndEquality should not throw exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22719&quot;&gt;&lt;del&gt;FLINK-22719&lt;/del&gt;&lt;/a&gt;. But in other cases(select window start/end and not select rowtime field in downstream join), &#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt; is not the blocker of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22719&quot; title=&quot;WindowJoinUtil.containsWindowStartEqualityAndEndEquality should not throw exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22719&quot;&gt;&lt;del&gt;FLINK-22719&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But yes, it is good to fix&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10211&quot; title=&quot;Time indicators are not correctly materialized for LogicalJoin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10211&quot;&gt;&lt;del&gt;FLINK-10211&lt;/del&gt;&lt;/a&gt;&#160;too~&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0r76g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>