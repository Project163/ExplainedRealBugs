<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-12602] Correct the flink pom `artifactId` config and scala-free check logic</title>
                <link>https://issues.apache.org/jira/browse/FLINK-12602</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I find a shell issue in `verify_scala_suffixes.sh`(line 145) as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grep &lt;span class=&quot;code-quote&quot;&gt;&quot;${module}_\d\+\.\d\+&amp;lt;/artifactId&amp;gt;&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;{}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This code want to find out all modules that the module&apos;s `artifactId` &#160;with a `scala_binary_version` suffix.&#160;&lt;br/&gt;
but the problem is our all `artifactId` value is in the pattern of `XXX_${scala.binary.version}`, such as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;artifactId&amp;gt;flink-tests_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then the result always empty, so this check did not take effect.&lt;/p&gt;

&lt;p&gt;I have already initiated a discussion of the issue. Please check the Mail thread here for details.&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/flink-dev/201905.mbox/%3CCAJSjTKw+8McSC0FvNeyaOVL_TTrr_UUOsX-TFGxj5GfQp1AUtQ@mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/flink-dev/201905.mbox/%3CCAJSjTKw+8McSC0FvNeyaOVL_TTrr_UUOsX-TFGxj5GfQp1AUtQ@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13235106">FLINK-12602</key>
            <summary>Correct the flink pom `artifactId` config and scala-free check logic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunjincheng121">sunjincheng</assignee>
                                    <reporter username="sunjincheng121">sunjincheng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 23 May 2019 10:47:59 +0000</created>
                <updated>Wed, 2 Oct 2019 17:48:00 +0000</updated>
                            <resolved>Sun, 18 Aug 2019 13:25:49 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>Build System</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16846627" author="zentol" created="Thu, 23 May 2019 10:51:32 +0000"  >&lt;p&gt;Mirroring my comment from the ML; there&apos;s no reason to keep that thread going now that we have a JIRA.&lt;/p&gt;

&lt;p&gt;There are 3 modules that have a suffix, which don&apos;t need it:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;flink-connector-hive&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;flink-queryable-state-client-java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;flink-table-api-scala&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All other modules do need it since they have dependencies with a scala-suffix (mostly on runtime and streaming-java).&lt;/p&gt;

&lt;p&gt;Your change does make sense to me, but there&apos;s likely another issue in the preceding logic that determines which module is scala-free.&lt;br/&gt;
flink-tests for example should not be considered scala-free, since it relies on flink-runtime which contains scala and hence the scala-lang dependencies, but it apparently is given that your change detects something. &lt;/p&gt;</comment>
                            <comment id="16846636" author="sunjincheng121" created="Thu, 23 May 2019 11:05:17 +0000"  >&lt;p&gt;Thank you for confirming this is an issue&#65292;and thanks a lot for your double check. Due to the script check logic is incorrect, most of the outputs are incorrect.&lt;/p&gt;

&lt;p&gt;You are right and I just pointed out the problem of the scala-free check and not mentioned the final solution which I think we should discuss it. &lt;/p&gt;

&lt;p&gt;I tried to understand you and have modified the script a bit and have got the same results as you mentioned(In my local).&lt;br/&gt;
The main changes are as follows: &lt;br/&gt;
1) Adds test modules which should be checked: !flink-fs-tests,!flink-yarn-tests,!flink-tests&lt;br/&gt;
2) Marks the modules as infected which depend on scala trasitively or depend on modules suffixed with `_&lt;/p&gt;
{scala_version}`&lt;br/&gt;
&lt;br/&gt;
I think we should discuss the rule of how to check whether a module is scala-free or not.&lt;br/&gt;
If I understand you correctly, the rule in your mind may be as follows:&lt;br/&gt;
&lt;br/&gt;
1) All the modules should check the dependencies(excluding the dependencies introduced by the test code). Regarding to modules flink-fs-tests,&lt;br/&gt;
   flink-yarn-tests and flink-tests, the dependencies introduced by the test code should also be checked.&lt;br/&gt;
2) The checking rule is whether a module depends on scala trasitively or depends on modules suffixed with `_{scala_version}
&lt;p&gt;`.&lt;br/&gt;
Following the above rules, we can get results you mentioned(Only 3 modules with incorrect artifact id).&lt;/p&gt;

&lt;p&gt;Open question:&lt;/p&gt;

&lt;p&gt;Currently, all the test code are also released into the repository, such as &lt;a href=&quot;http://central.maven.org/maven2/org/apache/flink/flink-avro/1.8.0/flink-avro-1.8.0-tests.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://central.maven.org/maven2/org/apache/flink/flink-avro/1.8.0/flink-avro-1.8.0-tests.jar&lt;/a&gt;.&lt;br/&gt;
Users can also depend on these jars. My question is why we need to check the test dependencies for modules flink-fs-tests, flink-yarn-tests and flink-tests, &lt;br/&gt;
but not check the test dependencies for other modules?&lt;/p&gt;

&lt;p&gt;The solution:&lt;br/&gt;
If we follow the rule you mentioned, the change is as follows:&lt;br/&gt;
1) Correct the check logic for the script&lt;br/&gt;
2) Correct the artifact id for modules:  flink-connector-hive, flink-queryable-state-client-java&lt;br/&gt;
3) Add the scala dependencies for the module flink-table-api-scala due we plan to add the scala code(I discussed with Timo and Aljoscha)&lt;/p&gt;

&lt;p&gt;If we should check other test code for other modules, maybe we need more changes. But it depends on the above open question.&lt;/p&gt;</comment>
                            <comment id="16846661" author="zentol" created="Thu, 23 May 2019 11:55:43 +0000"  >&lt;p&gt;Ha, you got me there. flink-tests, flink-fs-tests and flink-yarn-tests also don&apos;t need a suffix.&lt;/p&gt;

&lt;p&gt;The purpose of the scala-suffix is to ensure that &lt;em&gt;users&lt;/em&gt; depending on a module do not inadvertently pull in scala dependencies.&lt;br/&gt;
So, if you depend on module &quot;MyModule&quot;, then there should be no transitive dependency pulled in that depends on a specific scala version.&lt;br/&gt;
If it did you&apos;d have no control over which version is actually pulled in.&lt;/p&gt;

&lt;p&gt;Dependencies that have a &lt;tt&gt;test&lt;/tt&gt; scope however are &lt;em&gt;not&lt;/em&gt; transitive and never pulled in by the user.&lt;br/&gt;
That&apos;s why we can ignore those. This is why flink-avro does not have a suffix, and why flink-tests in fact does not need one.&lt;/p&gt;

&lt;p&gt;Now, let&apos;s consider what is wrong with the script.&lt;br/&gt;
As you laid out correctly, we do not check correctly for the scala suffix in scala-free modules. With this change alone 11 modules are marked as having wrong suffixes:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;flink-connector-hive&lt;/li&gt;
	&lt;li&gt;flink-fs-tests&lt;/li&gt;
	&lt;li&gt;flink-queryable-state-client-java&lt;/li&gt;
	&lt;li&gt;flink-sql-connector-elasticsearch6&lt;/li&gt;
	&lt;li&gt;flink-sql-connector-kafka&lt;/li&gt;
	&lt;li&gt;flink-sql-connector-kafka-0.10&lt;/li&gt;
	&lt;li&gt;flink-sql-connector-kafka-0.11&lt;/li&gt;
	&lt;li&gt;flink-sql-connector-kafka-0.9&lt;/li&gt;
	&lt;li&gt;flink-table-api-scala&lt;/li&gt;
	&lt;li&gt;flink-tests&lt;/li&gt;
	&lt;li&gt;flink-yarn-tests&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;fs-tests, tests, yarn-tests do not need a suffix because they only have test dependencies.&lt;/p&gt;

&lt;p&gt;table-api-scala does not need a suffix &lt;em&gt;right now&lt;/em&gt; but will obviously need it in the future since it is supposed to contain scala code. As you pointed out correctly, let&apos;s add the scala dependencies now to future-proof this puppy.&lt;/p&gt;

&lt;p&gt;connector-hive and queryable-state-client-java are genuinely free of scala dependencies, and we can remove the suffix as is.&lt;/p&gt;

&lt;p&gt;The sql-connectors &lt;em&gt;do&lt;/em&gt; all need a suffix since they all rely on connectors which also have one, which need it themselves since they rely on runtime/streaming-java.&lt;br/&gt;
My suspicion is that these are tagged because the script works against dependency-reduced poms, where provided dependencies are removed. runtime/streaming-java are usually marked as provided, so they and their transitive dependencies, including scala, are omitted from the pom.&lt;br/&gt;
As a result, as you pointed out, we not only have to check for scala dependencies but for any (compile) dependencies with a scala-suffix.&lt;/p&gt;</comment>
                            <comment id="16848836" author="sunjincheng121" created="Mon, 27 May 2019 11:02:23 +0000"  >&lt;p&gt;Sounds good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I have a few updates on the handling of the connector, we have two ways to deal with it:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Improve the script to check&#160;any (compile) dependencies with a scala-suffix(which we mentioned above).&lt;/li&gt;
	&lt;li&gt;Add the `flink-streaming-java`&#160;dependency wich&#160; `provided`&#160; scope for the corresponding connectors.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For approach 1, we should add&#160;check logic:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The command of `dependency:tree` should add an option: ` -Dincludes=org.apache.flink:&lt;b&gt;_2.1&lt;/b&gt;::&#160; ` such as `org.apache.flink:flink-streaming-java_2.11`.&lt;/li&gt;
	&lt;li&gt;The command of `grep ` also need to add the logic: `&lt;del&gt;E &quot;org.scala-lang|&lt;/del&gt; org.apache.flink:&lt;span class=&quot;error&quot;&gt;&amp;#91;^:&amp;#93;&lt;/span&gt;+_2\.1&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&quot;` , also for test `grep --invert-match &quot;org.apache.flink:&lt;span class=&quot;error&quot;&gt;&amp;#91;^:&amp;#93;&lt;/span&gt;&lt;b&gt;_2\.1&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;:.&lt;/b&gt;:.*:test&quot;`.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For&#160;approach 2, we should add the dependency of `link-streaming-java` for&#160;`flink-sql-connector-elasticsearch6 flink-sql-connector-kafka flink-sql-connector-kafka-0.10 flink-sql-connector-kafka-0.11 flink-sql-connector-kafka-0.9`.&#160; And I have prepared the changs &lt;a href=&quot;https://github.com/sunjincheng121/flink/pull/96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For now, I think the change logic in approach 1 is a bit complex(a lot of filtering processing logic). So, I prefer the&#160;approach 2, due to even we add some new module in the future we should well know whether we should add the scala-suffix for the `artifactId`, then manually add dependencies on for the scala in the pom.&#160;&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="16850721" author="sunjincheng121" created="Wed, 29 May 2019 10:12:01 +0000"  >&lt;p&gt;I have open the PR, I appreciate if you can have a look at it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16909965" author="till.rohrmann" created="Sun, 18 Aug 2019 13:25:49 +0000"  >&lt;p&gt;Fixed via &lt;a href=&quot;https://github.com/apache/flink/commit/57621703b7342442f3a0ec62315ce1cefa0a8287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/57621703b7342442f3a0ec62315ce1cefa0a8287&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02zsw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>