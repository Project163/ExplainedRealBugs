<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-29849] Event time temporal join on an upsert source may produce incorrect execution plan</title>
                <link>https://issues.apache.org/jira/browse/FLINK-29849</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For current implementation, the execution plan is incorrect when do event time temporal join on an upsert source. There&apos;s two problems:&lt;br/&gt;
1.  for an upsert source, we should not add a ChangelogNormalize node under a temporal join input, or it will damage the versions of the version table. For versioned tables, we use a single-temporal mechanism which relies sequencial records of a same key to ensure the valid period of each version, so if the ChangelogNormalize was added then an UB message will be produced based on the previous  UA or Insert message, and all the columns are totally same include event time, e.g., &lt;br/&gt;
original upsert input&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+I (key1, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;, a1)
+U (key1, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:01:03&apos;&lt;/span&gt;, a2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the versioned data should be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
v1  [~, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;)
v2  [&lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:01:03&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;after ChangelogNormalize&apos;s processing, will output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+I (key1, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;, a1)
-U (key1, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;, a1)
+U (key1, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:01:03&apos;&lt;/span&gt;, a2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;versions are incorrect:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
v1  [&lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;)  &lt;span class=&quot;code-comment&quot;&gt;// invalid period
&lt;/span&gt;v2  [&lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:00:00&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2022-11-02 10:01:03&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. semantically, a filter cannot be pushed into an event time temporal join, otherwise, the filter may also corrupt the versioned table&lt;/p&gt;</description>
                <environment></environment>
        <key id="13494261">FLINK-29849</key>
            <summary>Event time temporal join on an upsert source may produce incorrect execution plan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lincoln.86xy">lincoln lee</assignee>
                                    <reporter username="lincoln.86xy">lincoln lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 2 Nov 2022 08:27:11 +0000</created>
                <updated>Tue, 21 Feb 2023 06:21:08 +0000</updated>
                            <resolved>Wed, 21 Dec 2022 07:23:41 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.15.3</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.16.1</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17650120" author="godfrey" created="Wed, 21 Dec 2022 07:23:41 +0000"  >&lt;p&gt;Fixed in master: eb44ac01c9969cb22ab832b6b2155b109f015b06&lt;/p&gt;

&lt;p&gt;1.16.1: dbb6654c9d211e0944a0a1f58921c12bda6916cf&lt;/p&gt;</comment>
                            <comment id="17691399" author="lincoln.86xy" created="Tue, 21 Feb 2023 06:17:19 +0000"  >&lt;p&gt;Just for record: the conclusions of reviewing the semantic impact of filter-related optimizations/rewrites on streaming scenarios(filter pushdown disturb time attributes). The following releated operations were checked:&lt;/p&gt;

&lt;p&gt;1. temporal join, including eventtime and proctime(proctime temporal join is unsupported yet, one similar solution is lookup join), the essence is that filter should not go through snapshot to pre-filter data which may destroy the data version (corresponding to the original data may be changed over time), otherwise it affects the result. &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-28988&quot; title=&quot;Incorrect result for filter after temporal join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-28988&quot;&gt;&lt;del&gt;FLINK-28988&lt;/del&gt;&lt;/a&gt; prevent the filter push down through an eventime temporal join.&#160;&lt;br/&gt;
2. window related, does not affect the result, but only affects the density of watermark generation and the timing of the output result&lt;/p&gt;

&lt;p&gt;3. interval join, does not affect the result(the on condition in left join can be pushdown, the post where condition can change join to inner join)&lt;br/&gt;
4. deduplication, does not affect the result, the current filter push down already consider the &apos;containsOver&apos; protection judgment&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1aq9c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This resolves the correctness issue when do event time temporal join with a versioned table backed by an upsert source. When the right input of the join is an upsert source, it no longer generates a ChangelogNormalize node for it.&lt;br/&gt;
Note this is an incompatible plan change compare to 1.16.0</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>