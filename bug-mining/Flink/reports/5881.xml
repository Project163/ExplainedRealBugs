<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:06:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24156] BlobServer crashes due to SocketTimeoutException in Java 11</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24156</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Overview&quot;&gt;&lt;/a&gt;Overview&lt;/h3&gt;

&lt;p&gt;We have seen the BlobServer crash due to a &lt;b&gt;SocketTimeoutException&lt;/b&gt; while running on JRE 11. This is likely caused by a &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8237858&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK bug present in JDK 11&lt;/a&gt;&#160;(fixed in version 16) that erroneously throws &lt;em&gt;SocketTimeoutException&lt;/em&gt; when &lt;em&gt;ServerSocket.accept()&lt;/em&gt; is interrupted by any UNIX signal. The BlobServer calls &lt;em&gt;accept()&lt;/em&gt; when establishing connections with clients and is expected to block indefinitely. &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobServer.java#L267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The BlobServer currently shuts down when it catches a Throwable&lt;/a&gt;. We do not see this behavior when running the same steps in JRE 8.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Reproducingtheissue&quot;&gt;&lt;/a&gt;Reproducing the issue&lt;/h3&gt;

&lt;p&gt;To reproduce, send a &lt;em&gt;SIGPIPE&lt;/em&gt; to the BlobServer &lt;em&gt;PID&lt;/em&gt;. You will need to be running a Flink cluster on JRE 11 and have tools &lt;em&gt;jps&lt;/em&gt; and &lt;em&gt;jstack&lt;/em&gt; available to find the relevant pid.&lt;/p&gt;

&lt;p&gt;One-liner:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
kill -SIGPIPE $(jstack $(jps -v | grep StandaloneApplicationClusterEntryPoint | cut -f 1 -d &lt;span class=&quot;code-quote-red&quot;&gt;&apos; &apos;&lt;/span&gt;) | grep BLOB | awk &lt;span class=&quot;code-quote-red&quot;&gt;&apos;\{print &lt;span class=&quot;code-object&quot;&gt;$13&lt;/span&gt;}&apos;&lt;/span&gt; | awk -F&lt;span class=&quot;code-quote-red&quot;&gt;&apos;[=]&apos;&lt;/span&gt; &lt;span class=&quot;code-quote-red&quot;&gt;&apos;\{print &lt;span class=&quot;code-object&quot;&gt;$2&lt;/span&gt;}&apos;&lt;/span&gt; | xargs printf &lt;span class=&quot;code-quote-red&quot;&gt;&quot;%d&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Run
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
jstack [PID] | grep BLOB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where &lt;b&gt;PID&lt;/b&gt; is the process ID of the job manager.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Find the &lt;b&gt;nid=&lt;span class=&quot;error&quot;&gt;&amp;#91;HEX&amp;#93;&lt;/span&gt;&lt;/b&gt; value and convert the HEX to decimal.&lt;/li&gt;
	&lt;li&gt;Run
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
kill -SIGPIPE [DNID]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where &lt;b&gt;DNID&lt;/b&gt; is the converted decimal value of &lt;b&gt;HEX nid&lt;/b&gt; from the previous step.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Observe the following error in the job manager logs:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2021-09-03 09:56:12.517 [BLOB Server listener at 6124] ERROR org.apache.flink.runtime.blob.BlobServer&#160; - BLOB server stopped working. Shutting down
  at java.base/java.net.PlainSocketImpl.socketAccept
  at java.base/java.net.AbstractPlainSocketImpl.accept
  &#160;&#160;&#160;&#160;&#160;at java.base/java.net.ServerSocket.implAccept
  at java.base/java.net.ServerSocket.accept
  at org.apache.flink.runtime.blob.BlobServer.run(BlobServer.java:266)
2021-09-03 09:56:12.527 [BLOB Server listener at 6124] INFO&#160; org.apache.flink.runtime.blob.BlobServer&#160; - Stopped BLOB server at 0.0.0.0:6124
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;h3&gt;&lt;a name=&quot;ProposedFix&quot;&gt;&lt;/a&gt;Proposed Fix&lt;/h3&gt;

&lt;p&gt;To protect ourselves from this JDK bug, we propose the workaround of catching &lt;em&gt;SocketTimeoutException&lt;/em&gt; and retrying the &lt;em&gt;ServerSocket.accept()&lt;/em&gt; call indefinitely.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bsanders-wf&quot; class=&quot;user-hover&quot; rel=&quot;bsanders-wf&quot;&gt;bsanders-wf&lt;/a&gt;&#160;for helping track this down.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 11&lt;/p&gt;

&lt;p&gt;CentOS 7.6&lt;/p&gt;</environment>
        <key id="13399325">FLINK-24156</key>
            <summary>BlobServer crashes due to SocketTimeoutException in Java 11</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="scudellari">Ryan Scudellari</assignee>
                                    <reporter username="scudellari">Ryan Scudellari</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 3 Sep 2021 19:27:40 +0000</created>
                <updated>Thu, 2 Mar 2023 10:01:42 +0000</updated>
                            <resolved>Mon, 20 Sep 2021 08:48:28 +0000</resolved>
                                    <version>1.12.4</version>
                    <version>1.13.2</version>
                                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17410577" author="zentol" created="Mon, 6 Sep 2021 12:32:27 +0000"  >&lt;p&gt;This sounds reasonable. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scudellari&quot; class=&quot;user-hover&quot; rel=&quot;scudellari&quot;&gt;scudellari&lt;/a&gt; Would you like to provide a fix for the issue?&lt;/p&gt;

&lt;p&gt;I guess all we need is a new utility method in the &lt;tt&gt;NetUtils&lt;/tt&gt; to handle this case, to which we migrate all usages of &lt;tt&gt;ServerSocker#accept()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17410678" author="scudellari" created="Mon, 6 Sep 2021 15:21:44 +0000"  >&lt;p&gt;Yes, I can provide a fix.&lt;/p&gt;

&lt;p&gt;A utility method in &lt;tt&gt;NetUtils&lt;/tt&gt; sounds good. Should I migrate the &lt;tt&gt;ServerSocker#accept()&lt;/tt&gt; calls in the integration tests or can we assume they are only ever run using Java 8?&lt;/p&gt;</comment>
                            <comment id="17410751" author="zentol" created="Mon, 6 Sep 2021 17:27:42 +0000"  >&lt;p&gt;We should also migrate tests, because they are also run on Java 11 and for consistency.&lt;/p&gt;</comment>
                            <comment id="17410753" author="scudellari" created="Mon, 6 Sep 2021 17:31:36 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17415574" author="scudellari" created="Wed, 15 Sep 2021 14:56:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; [ &lt;a href=&quot;https://github.com/apache/flink/pull/17227&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/17227&lt;/a&gt;|https://github.com/apache/flink/pull/17227]&#160;should be ready for review. I believe I have addressed all comments. Let me know if you have questions!&lt;/p&gt;</comment>
                            <comment id="17417529" author="zentol" created="Mon, 20 Sep 2021 08:48:28 +0000"  >&lt;p&gt;master: 5ae8cb0503449b07f76d0ab621c3e81734496b26&lt;br/&gt;
1.14: 685bd8f9b917d567f5876a58355b9a947614806a &lt;/p&gt;</comment>
                            <comment id="17422356" author="scudellari" created="Wed, 29 Sep 2021 19:32:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&#160;- would it be possible to backport this into the `1.14.x` line? I see that `1.14.0` was just released. What are the policies around including these sorts of fixes in a patch release?&lt;/p&gt;</comment>
                            <comment id="17422596" author="zentol" created="Thu, 30 Sep 2021 08:06:21 +0000"  >&lt;p&gt;For this change in particular I would like to give it some more time on master to see if anyone runs into issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13417616">FLINK-25316</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13526830">FLINK-31298</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ults:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>