<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7943] OptionalDataException when launching Flink jobs concurrently</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7943</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user reported that he is getting a &lt;tt&gt;OptionalDataException&lt;/tt&gt; when he launches multiple Flink jobs from the same program concurrently. The problem seems to appear if one sets the &lt;tt&gt;GlobalJobParameters&lt;/tt&gt;. The stack trace can be found below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed to submit job 60f4da5cf76836fe52ceba5cebdae412 (Union4a:14:15)
java.io.OptionalDataException
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1588)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:428)
        at java.util.HashMap.readObject(HashMap.java:1407)
        at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1158)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2173)
        at
java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2064)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1568)
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2282)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2206)
        at
java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2064)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1568)
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2282)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2206)
        at
java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2064)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1568)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:428)
        at
org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:290)
        at
org.apache.flink.util.SerializedValue.deserializeValue(SerializedValue.java:58)
        at
org.apache.flink.runtime.jobmanager.JobManager.org$apache$flink$runtime$jobmanager$JobManager$$submitJob(JobManager.scala:1283)
        at
org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1.applyOrElse(JobManager.scala:495)
        at
scala.runtime.AbstractPartialFunction.apply(AbstractPartialFunction.scala:36)
        at
org.apache.flink.runtime.LeaderSessionMessageFilter$$anonfun$receive$1.applyOrElse(LeaderSessionMessageFilter.scala:38)
        at
scala.runtime.AbstractPartialFunction.apply(AbstractPartialFunction.scala:36)
        at org.apache.flink.runtime.LogMessages$$anon$1.apply(LogMessages.scala:33)
        at org.apache.flink.runtime.LogMessages$$anon$1.apply(LogMessages.scala:28)
        at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123)
        at
org.apache.flink.runtime.LogMessages$$anon$1.applyOrElse(LogMessages.scala:28)
        at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:467)
        at
org.apache.flink.runtime.jobmanager.JobManager.aroundReceive(JobManager.scala:125)
        at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
        at akka.actor.ActorCell.invoke(ActorCell.scala:487)
        at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:238)
        at akka.dispatch.Mailbox.run(Mailbox.scala:220)
        at
akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397)
        at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
        at
scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
        at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
        at
scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The user code causing the problem is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;serial&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;UnionThreaded {

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ThreadPoolSize = 3;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; JobsPerThread = 2;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ParameterTool params;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RunSubset &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; {

        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; start = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end = 0;


        RunSubset(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; start, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.start = start;
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.end = end;
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            &lt;span class=&quot;code-comment&quot;&gt;// set up the execution environment
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

            &lt;span class=&quot;code-comment&quot;&gt;// make parameters available in the web &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;
&lt;/span&gt;            env.getConfig().setGlobalJobParameters(params);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;left&quot;&lt;/span&gt;) &amp;amp;&amp;amp; params.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;right&quot;&lt;/span&gt;)) {
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = start; i &amp;lt; end; i++) {
                    DataSet&amp;lt;DeviceRecord&amp;gt; l, r;
                    DataSet&amp;lt;DeviceRecord1&amp;gt; j;
                    DataSet&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; c1, c2;
                    r = env.readCsvFile(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;right&quot;&lt;/span&gt;) + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(i))
                        .pojoType(DeviceRecord.class, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;)
                        .setParallelism(1)
                        .filter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyFilter())
                        .setParallelism(1);
                    &lt;span class=&quot;code-comment&quot;&gt;// read the text file from given input path
&lt;/span&gt;                    j = env.readCsvFile(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;left&quot;&lt;/span&gt;) + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(i))
                        .pojoType(DeviceRecord.class, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;)
                        .setParallelism(1)
                        .leftOuterJoin(r)
                        .where(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;)
                        .equalTo(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;)
                        .with(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyFlatJoinFunction()).setParallelism(1);
                    j.flatMap(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Mapper(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;))
                        .groupBy(0)
                        .sum(1).setParallelism(1)
                        .writeAsCsv(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;output&quot;&lt;/span&gt;) + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(i), &lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
                    j.flatMap(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Mapper2(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
                        .groupBy(0)
                        .sum(1).setParallelism(1)
                        .writeAsCsv(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;output2&quot;&lt;/span&gt;) + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(i), &lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;calling env.execute()&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// + Calendar.getInstance().getTime();
&lt;/span&gt;
                env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;Union4a&quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(start) + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(end));
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;env.execute exception: &quot;&lt;/span&gt; + e.getMessage());
            }

        }

    }

    &lt;span class=&quot;code-comment&quot;&gt;// *************************************************************************
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//     PROGRAM
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// *************************************************************************
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        params = ParameterTool.fromArgs(args);
        &lt;span class=&quot;code-comment&quot;&gt;// set up the execution environment
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        &lt;span class=&quot;code-comment&quot;&gt;// make parameters available in the web &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;
&lt;/span&gt;        env.getConfig().setGlobalJobParameters(params);

        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; total_to_do = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.decode(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;filecount&quot;&lt;/span&gt;));
        &lt;span class=&quot;code-comment&quot;&gt;// number of threads should be &amp;lt;= number of slots
&lt;/span&gt;        ThreadPoolExecutor executor = (ThreadPoolExecutor) Executors.newFixedThreadPool(ThreadPoolSize);
        &lt;span class=&quot;code-comment&quot;&gt;// assumes an even number of jobs
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; total_to_do; i += JobsPerThread) {
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end = i + JobsPerThread;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (end &amp;gt; total_to_do) {
                end = total_to_do;
            }
            executor.execute(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RunSubset(i, end));
        }
        executor.shutdown();
        &lt;span class=&quot;code-comment&quot;&gt;// Many ways of waiting.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            executor.awaitTermination(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE, TimeUnit.DAYS);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Execution interrupted&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(-1);
        }

        &lt;span class=&quot;code-comment&quot;&gt;// get input data
&lt;/span&gt;        DataSet&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; counts;
        DataSet&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; counts2;

        counts = env.readCsvFile(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;output&quot;&lt;/span&gt;))
            .types(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class);
        counts2 = env.readCsvFile(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;output2&quot;&lt;/span&gt;))
            .types(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class);
        &lt;span class=&quot;code-comment&quot;&gt;// Count by C
&lt;/span&gt;        counts = counts
            .groupBy(0)
            .sum(1);
        &lt;span class=&quot;code-comment&quot;&gt;// Count by device
&lt;/span&gt;        counts2 = counts2
            .groupBy(0)
            .sum(1);

        &lt;span class=&quot;code-comment&quot;&gt;// emit result
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;output&quot;&lt;/span&gt;)) {
            counts.writeAsCsv(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;output3&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-comment&quot;&gt;// emit result
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;output2&quot;&lt;/span&gt;)) {
            counts2.writeAsCsv(params.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;output4&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-comment&quot;&gt;// execute program
&lt;/span&gt;        env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;Union4b&quot;&lt;/span&gt;);

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Execute-multiple-jobs-in-parallel-threading-java-io-OptionalDataException-td16441.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Execute-multiple-jobs-in-parallel-threading-java-io-OptionalDataException-td16441.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13112963">FLINK-7943</key>
            <summary>OptionalDataException when launching Flink jobs concurrently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Oct 2017 08:01:59 +0000</created>
                <updated>Mon, 20 Nov 2017 14:53:14 +0000</updated>
                            <resolved>Mon, 20 Nov 2017 14:53:14 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Command Line Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16224611" author="till.rohrmann" created="Mon, 30 Oct 2017 10:13:07 +0000"  >&lt;p&gt;The problem has most likely to do with serializing a &lt;tt&gt;HashMap&lt;/tt&gt; (&lt;tt&gt;ParameterTool&lt;/tt&gt;) concurrently. I couldn&apos;t reproduce the problem locally, thought.&lt;/p&gt;

&lt;p&gt;An easy fix should be to copy the &lt;tt&gt;ParameterTool&lt;/tt&gt; map before assigning it to the &lt;tt&gt;ExecutionConfig&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16224663" author="till.rohrmann" created="Mon, 30 Oct 2017 11:00:57 +0000"  >&lt;p&gt;I actually could reproduce the problem. The problem is that calls to &lt;tt&gt;ParameterTool#get&lt;/tt&gt; have side effects and change the underlying &lt;tt&gt;HashMap&lt;/tt&gt;. This is of course not thread safe.&lt;/p&gt;</comment>
                            <comment id="16224909" author="githubbot" created="Mon, 30 Oct 2017 13:20:41 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7943&quot; title=&quot;OptionalDataException when launching Flink jobs concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7943&quot;&gt;&lt;del&gt;FLINK-7943&lt;/del&gt;&lt;/a&gt; Make ParameterTool thread safe&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This commit changes the serialization of the ParameterTool such that only the&lt;br/&gt;
    data map is contained. The defaultData and the unrequestedParameters maps are&lt;br/&gt;
    not serialized because they are only used on the client side. Additionally, the&lt;br/&gt;
    defaultData and unrequestedParameters map are being made thread safe by using&lt;br/&gt;
    ConcurrentHashMaps.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added `ParameterToolTest#testConcurrentExecutionConfigSerialization`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; copyParameterTool&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4921&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="16233961" author="githubbot" created="Wed, 1 Nov 2017 11:44:02 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Travis failure:&lt;br/&gt;
    ```&lt;br/&gt;
    Tests run: 17, Failures: 0, Errors: 6, Skipped: 0, Time elapsed: 0.029 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.api.java.utils.RequiredParametersTest&lt;br/&gt;
    testApplyToWithOptionWithLongAndShortNameAndDefaultValue(org.apache.flink.api.java.utils.RequiredParametersTest)  Time elapsed: 0.012 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.lang.UnsupportedOperationException: null&lt;br/&gt;
    	at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.hasNoDefaultValueAndNoValuePassedOnAlternativeName(RequiredParameters.java:147)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.checkAndApplyDefaultValue(RequiredParameters.java:116)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.applyTo(RequiredParameters.java:94)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParametersTest.testApplyToWithOptionWithLongAndShortNameAndDefaultValue(RequiredParametersTest.java:195)&lt;/p&gt;

&lt;p&gt;    testApplyToWithMultipleTypes(org.apache.flink.api.java.utils.RequiredParametersTest)  Time elapsed: 0.002 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.lang.UnsupportedOperationException: null&lt;br/&gt;
    	at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.hasNoDefaultValueAndNoValuePassedOnAlternativeName(RequiredParameters.java:147)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.applyTo(RequiredParameters.java:103)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParametersTest.testApplyToWithMultipleTypes(RequiredParametersTest.java:228)&lt;/p&gt;

&lt;p&gt;    testApplyToWithOptionMultipleOptionsAndOneDefaultValue(org.apache.flink.api.java.utils.RequiredParametersTest)  Time elapsed: 0.001 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.lang.UnsupportedOperationException: null&lt;br/&gt;
    	at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.hasNoDefaultValueAndNoValuePassedOnAlternativeName(RequiredParameters.java:147)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.applyTo(RequiredParameters.java:103)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParametersTest.testApplyToWithOptionMultipleOptionsAndOneDefaultValue(RequiredParametersTest.java:210)&lt;/p&gt;

&lt;p&gt;    testApplyToWithOptionAndDefaultValue(org.apache.flink.api.java.utils.RequiredParametersTest)  Time elapsed: 0 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.lang.UnsupportedOperationException: null&lt;br/&gt;
    	at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.hasNoDefaultValueAndNoValuePassedOnAlternativeName(RequiredParameters.java:147)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.checkAndApplyDefaultValue(RequiredParameters.java:116)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.applyTo(RequiredParameters.java:94)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParametersTest.testApplyToWithOptionAndDefaultValue(RequiredParametersTest.java:182)&lt;/p&gt;

&lt;p&gt;    testApplyToMovesValuePassedOnShortNameToLongNameIfLongNameIsUndefined(org.apache.flink.api.java.utils.RequiredParametersTest)  Time elapsed: 0.001 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.lang.UnsupportedOperationException: null&lt;br/&gt;
    	at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.hasNoDefaultValueAndNoValuePassedOnAlternativeName(RequiredParameters.java:144)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.applyTo(RequiredParameters.java:103)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParametersTest.testApplyToMovesValuePassedOnShortNameToLongNameIfLongNameIsUndefined(RequiredParametersTest.java:127)&lt;/p&gt;

&lt;p&gt;    testDefaultValueDoesNotOverrideValuePassedOnShortKeyIfLongKeyIsNotPassedButPresent(org.apache.flink.api.java.utils.RequiredParametersTest)  Time elapsed: 0.001 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.lang.UnsupportedOperationException: null&lt;br/&gt;
    	at java.util.Collections$UnmodifiableMap.put(Collections.java:1457)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.hasNoDefaultValueAndNoValuePassedOnAlternativeName(RequiredParameters.java:144)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.checkAndApplyDefaultValue(RequiredParameters.java:116)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParameters.applyTo(RequiredParameters.java:94)&lt;br/&gt;
    	at org.apache.flink.api.java.utils.RequiredParametersTest.testDefaultValueDoesNotOverrideValuePassedOnShortKeyIfLongKeyIsNotPassedButPresent(RequiredParametersTest.java:142)&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16233968" author="githubbot" created="Wed, 1 Nov 2017 11:52:17 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148240608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148240608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/ParameterTool.java &amp;#8212;&lt;br/&gt;
    @@ -560,9 +591,13 @@ protected Object clone() throws CloneNotSupportedException {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return The Merged 
{@link ParameterTool}
&lt;p&gt;     	 */&lt;br/&gt;
     	public ParameterTool mergeWith(ParameterTool other) {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ParameterTool ret = new ParameterTool(this.data);&lt;/li&gt;
	&lt;li&gt;ret.data.putAll(other.data);&lt;/li&gt;
	&lt;li&gt;ret.unrequestedParameters.addAll(other.unrequestedParameters);&lt;br/&gt;
    +		Map&amp;lt;String, String&amp;gt; resultData = new HashMap&amp;lt;&amp;gt;(data.size() + other.data.size());&lt;br/&gt;
    +		resultData.putAll(data);&lt;br/&gt;
    +		resultData.putAll(other.data);&lt;br/&gt;
    +&lt;br/&gt;
    +		ParameterTool ret = new ParameterTool(resultData);&lt;br/&gt;
    +&lt;br/&gt;
    +		ret.unrequestedParameters.putAll(other.unrequestedParameters);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    what about `this.unrequestedParameters`?&lt;/p&gt;</comment>
                            <comment id="16233969" author="githubbot" created="Wed, 1 Nov 2017 11:52:17 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148241001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148241001&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/utils/ParameterToolTest.java &amp;#8212;&lt;br/&gt;
    @@ -454,124 +469,196 @@ public void testUnrequestedDoubleWithMissingValue() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testUnrequestedString() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-string&quot;, &quot;&#8734;&quot;});&lt;br/&gt;
    -		Assert.assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
     &lt;br/&gt;
     		// test parameter access&lt;br/&gt;
    -		Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    -		Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     &lt;br/&gt;
     		// test repeated access&lt;br/&gt;
    -		Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    -		Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;br/&gt;
     &lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testUnrequestedStringWithDefaultValue() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]{&quot;-string&quot;, &quot;&#8734;&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test parameter access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test repeated access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedStringWithMissingValue() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-string&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		parameter.get(&quot;string&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// Additional methods&lt;/p&gt;

&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedHas() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-boolean&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;boolean&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;boolean&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test parameter access&lt;br/&gt;
     		Assert.assertTrue(parameter.has(&quot;boolean&quot;));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test repeated access&lt;br/&gt;
     		Assert.assertTrue(parameter.has(&quot;boolean&quot;));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedRequired() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-required&quot;, &quot;&#8734;&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;required&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;required&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test parameter access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test repeated access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedMultiple() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-boolean&quot;, &quot;true&quot;, &quot;-byte&quot;, &quot;1&quot;,
     			&quot;-short&quot;, &quot;2&quot;, &quot;-int&quot;, &quot;4&quot;, &quot;-long&quot;, &quot;8&quot;, &quot;-float&quot;, &quot;4.0&quot;, &quot;-double&quot;, &quot;8.0&quot;, &quot;-string&quot;, &quot;&#8734;&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;boolean&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;boolean&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		Assert.assertTrue(parameter.getBoolean(&quot;boolean&quot;));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(1, parameter.getByte(&quot;byte&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(1, parameter.getByte(&quot;byte&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(2, parameter.getShort(&quot;short&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(2, parameter.getShort(&quot;short&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(4, parameter.getInt(&quot;int&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(4, parameter.getInt(&quot;int&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(8, parameter.getLong(&quot;long&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(8, parameter.getLong(&quot;long&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(4.0, parameter.getFloat(&quot;float&quot;), 0.00001);&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(4.0, parameter.getFloat(&quot;float&quot;), 0.00001);&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(8.0, parameter.getDouble(&quot;double&quot;), 0.00001);&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;string&quot;),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    unnecessary changes.&lt;/p&gt;</comment>
                            <comment id="16233970" author="githubbot" created="Wed, 1 Nov 2017 11:52:17 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148240611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148240611&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/ParameterTool.java &amp;#8212;&lt;br/&gt;
    @@ -210,15 +212,44 @@ public static ParameterTool fromSystemProperties() &lt;/p&gt;
{
     		return fromMap((Map) System.getProperties());
     	}

&lt;p&gt;    +	private static final Object placeholder = new Object();&lt;br/&gt;
    +&lt;br/&gt;
     	// ------------------ ParameterUtil  ------------------------&lt;br/&gt;
     	protected final Map&amp;lt;String, String&amp;gt; data;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected final Map&amp;lt;String, String&amp;gt; defaultData;&lt;/li&gt;
	&lt;li&gt;protected final Set&amp;lt;String&amp;gt; unrequestedParameters;&lt;br/&gt;
    +&lt;br/&gt;
    +	// data which is only used on the client and does not need to be transmitted&lt;br/&gt;
    +	protected transient Map&amp;lt;String, String&amp;gt; defaultData;&lt;br/&gt;
    +	protected transient Map&amp;lt;String, Object&amp;gt; unrequestedParameters;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private ParameterTool(Map&amp;lt;String, String&amp;gt; data) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.data = new HashMap&amp;lt;&amp;gt;(data);&lt;/li&gt;
	&lt;li&gt;this.defaultData = new HashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;this.unrequestedParameters = new HashSet&amp;lt;&amp;gt;(data.keySet());&lt;br/&gt;
    +		this.data = Collections.unmodifiableMap(new HashMap&amp;lt;&amp;gt;(data));&lt;br/&gt;
    +&lt;br/&gt;
    +		this.defaultData = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());&lt;br/&gt;
    +&lt;br/&gt;
    +		this.unrequestedParameters = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    why not `... = Collections.setFromMap(new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());`&lt;/p&gt;</comment>
                            <comment id="16234005" author="githubbot" created="Wed, 1 Nov 2017 12:29:12 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148247266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148247266&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/ParameterTool.java &amp;#8212;&lt;br/&gt;
    @@ -210,15 +212,44 @@ public static ParameterTool fromSystemProperties() &lt;/p&gt;
{
     		return fromMap((Map) System.getProperties());
     	}

&lt;p&gt;    +	private static final Object placeholder = new Object();&lt;br/&gt;
    +&lt;br/&gt;
     	// ------------------ ParameterUtil  ------------------------&lt;br/&gt;
     	protected final Map&amp;lt;String, String&amp;gt; data;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected final Map&amp;lt;String, String&amp;gt; defaultData;&lt;/li&gt;
	&lt;li&gt;protected final Set&amp;lt;String&amp;gt; unrequestedParameters;&lt;br/&gt;
    +&lt;br/&gt;
    +	// data which is only used on the client and does not need to be transmitted&lt;br/&gt;
    +	protected transient Map&amp;lt;String, String&amp;gt; defaultData;&lt;br/&gt;
    +	protected transient Map&amp;lt;String, Object&amp;gt; unrequestedParameters;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private ParameterTool(Map&amp;lt;String, String&amp;gt; data) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.data = new HashMap&amp;lt;&amp;gt;(data);&lt;/li&gt;
	&lt;li&gt;this.defaultData = new HashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;this.unrequestedParameters = new HashSet&amp;lt;&amp;gt;(data.keySet());&lt;br/&gt;
    +		this.data = Collections.unmodifiableMap(new HashMap&amp;lt;&amp;gt;(data));&lt;br/&gt;
    +&lt;br/&gt;
    +		this.defaultData = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());&lt;br/&gt;
    +&lt;br/&gt;
    +		this.unrequestedParameters = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good idea. Didn&apos;t know that this existed.&lt;/p&gt;</comment>
                            <comment id="16234009" author="githubbot" created="Wed, 1 Nov 2017 12:32:23 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148247868&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148247868&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/ParameterTool.java &amp;#8212;&lt;br/&gt;
    @@ -560,9 +591,13 @@ protected Object clone() throws CloneNotSupportedException {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return The Merged 
{@link ParameterTool}
&lt;p&gt;     	 */&lt;br/&gt;
     	public ParameterTool mergeWith(ParameterTool other) {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ParameterTool ret = new ParameterTool(this.data);&lt;/li&gt;
	&lt;li&gt;ret.data.putAll(other.data);&lt;/li&gt;
	&lt;li&gt;ret.unrequestedParameters.addAll(other.unrequestedParameters);&lt;br/&gt;
    +		Map&amp;lt;String, String&amp;gt; resultData = new HashMap&amp;lt;&amp;gt;(data.size() + other.data.size());&lt;br/&gt;
    +		resultData.putAll(data);&lt;br/&gt;
    +		resultData.putAll(other.data);&lt;br/&gt;
    +&lt;br/&gt;
    +		ParameterTool ret = new ParameterTool(resultData);&lt;br/&gt;
    +&lt;br/&gt;
    +		ret.unrequestedParameters.putAll(other.unrequestedParameters);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Forgot to add it.&lt;/p&gt;</comment>
                            <comment id="16234011" author="githubbot" created="Wed, 1 Nov 2017 12:33:55 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148248128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148248128&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/test/java/org/apache/flink/api/java/utils/ParameterToolTest.java &amp;#8212;&lt;br/&gt;
    @@ -454,124 +469,196 @@ public void testUnrequestedDoubleWithMissingValue() {&lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testUnrequestedString() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-string&quot;, &quot;&#8734;&quot;});&lt;br/&gt;
    -		Assert.assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
     &lt;br/&gt;
     		// test parameter access&lt;br/&gt;
    -		Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    -		Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     &lt;br/&gt;
     		// test repeated access&lt;br/&gt;
    -		Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    -		Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;br/&gt;
     &lt;br/&gt;
     	@Test&lt;br/&gt;
     	public void testUnrequestedStringWithDefaultValue() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]{&quot;-string&quot;, &quot;&#8734;&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test parameter access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test repeated access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.get(&quot;string&quot;, &quot;0.0&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedStringWithMissingValue() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-string&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;string&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		parameter.get(&quot;string&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// Additional methods&lt;/p&gt;

&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedHas() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-boolean&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;boolean&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;boolean&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test parameter access&lt;br/&gt;
     		Assert.assertTrue(parameter.has(&quot;boolean&quot;));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test repeated access&lt;br/&gt;
     		Assert.assertTrue(parameter.has(&quot;boolean&quot;));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedRequired() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-required&quot;, &quot;&#8734;&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;required&quot;), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;required&quot;), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test parameter access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		// test repeated access&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
    +		assertEquals(&quot;&#8734;&quot;, parameter.getRequired(&quot;required&quot;));&lt;br/&gt;
    +		assertEquals(Collections.emptySet(), parameter.getUnrequestedParameters());&lt;br/&gt;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Test&lt;br/&gt;
     	public void testUnrequestedMultiple() {&lt;br/&gt;
     		ParameterTool parameter = ParameterTool.fromArgs(new String[]&lt;/p&gt;
{&quot;-boolean&quot;, &quot;true&quot;, &quot;-byte&quot;, &quot;1&quot;,
     			&quot;-short&quot;, &quot;2&quot;, &quot;-int&quot;, &quot;4&quot;, &quot;-long&quot;, &quot;8&quot;, &quot;-float&quot;, &quot;4.0&quot;, &quot;-double&quot;, &quot;8.0&quot;, &quot;-string&quot;, &quot;&#8734;&quot;}
&lt;p&gt;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;boolean&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;boolean&quot;, &quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		Assert.assertTrue(parameter.getBoolean(&quot;boolean&quot;));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;byte&quot;, &quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(1, parameter.getByte(&quot;byte&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(1, parameter.getByte(&quot;byte&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;short&quot;, &quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(2, parameter.getShort(&quot;short&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(2, parameter.getShort(&quot;short&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;int&quot;, &quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(4, parameter.getInt(&quot;int&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(4, parameter.getInt(&quot;int&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;long&quot;, &quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(8, parameter.getLong(&quot;long&quot;));&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(8, parameter.getLong(&quot;long&quot;));&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;float&quot;, &quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(4.0, parameter.getFloat(&quot;float&quot;), 0.00001);&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
    +		assertEquals(4.0, parameter.getFloat(&quot;float&quot;), 0.00001);&lt;br/&gt;
    +		assertEquals(createHashSet(&quot;double&quot;, &quot;string&quot;),&lt;br/&gt;
     			parameter.getUnrequestedParameters());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Assert.assertEquals(8.0, parameter.getDouble(&quot;double&quot;), 0.00001);&lt;/li&gt;
	&lt;li&gt;Assert.assertEquals(createHashSet(&quot;string&quot;),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    True, I guess that was done due to auto reformatting when writing the `testConcurrentExecutionConfigSerialization`.&lt;/p&gt;</comment>
                            <comment id="16234021" author="githubbot" created="Wed, 1 Nov 2017 12:38:02 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @zentol. Yes you&apos;re right that this PR has failing test cases. I wasn&apos;t aware that the `ParameterTool` is so messy (getters with side effects, storing default values for future gets, counting which parameters have been accessed, sending this whole thing over to the cluster) and that the `RequiredParameters` change the `ParameterTool` directly. I&apos;m currently thinking about letting the `RequiredParameters` create a new `ParameterTool` if they have to change a value. Ideally, I would like to remove `RequiredParameters` and do not send the `ParameterTool` to the cluster.&lt;/p&gt;</comment>
                            <comment id="16234186" author="githubbot" created="Wed, 1 Nov 2017 15:05:43 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fixed the `RequiredParametersTest` by making `RequiredParameters#applyTo` create a new `ParameterTool` whenever changes are needed. Note, however, that this code is not very performant since we copy `ParameterTool` every time we apply a change.&lt;/p&gt;</comment>
                            <comment id="16234191" author="githubbot" created="Wed, 1 Nov 2017 15:09:29 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148286896&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148286896&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/RequiredParameters.java &amp;#8212;&lt;br/&gt;
    @@ -83,82 +82,100 @@ public void add(Option option) throws RequiredParametersException {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;If any check fails, a RequiredParametersException is thrown&lt;br/&gt;
     	 *&lt;/li&gt;
	&lt;li&gt;@param parameterTool - parameters supplied by the user.&lt;br/&gt;
    +	 * @return New ParameterTool instance with default values set&lt;/li&gt;
	&lt;li&gt;@throws RequiredParametersException if any of the specified checks fail&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void applyTo(ParameterTool parameterTool) throws RequiredParametersException {&lt;br/&gt;
    +	public ParameterTool applyTo(ParameterTool parameterTool) throws RequiredParametersException {&lt;br/&gt;
     		List&amp;lt;String&amp;gt; missingArguments = new LinkedList&amp;lt;&amp;gt;();&lt;br/&gt;
    +&lt;br/&gt;
    +		ParameterTool resultParameterTool = parameterTool;&lt;br/&gt;
     		for (Option o : data.values()) {&lt;/li&gt;
	&lt;li&gt;if (parameterTool.data.containsKey(o.getName())) {&lt;/li&gt;
	&lt;li&gt;if (Objects.equals(parameterTool.data.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {&lt;br/&gt;
    +			if (resultParameterTool.has(o.getName())) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				if (Objects.equals(resultParameterTool.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {
     					// the parameter has been passed, but no value, check if there is a default value
    -					checkAndApplyDefaultValue(o, parameterTool.data);
    +					resultParameterTool = checkAndApplyDefaultValue(o, resultParameterTool);
     				} else {
     					// a value has been passed in the parameterTool, now check if it adheres to all constraints
    -					checkAmbiguousValues(o, parameterTool.data);
    -					checkIsCastableToDefinedType(o, parameterTool.data);
    -					checkChoices(o, parameterTool.data);
    +					checkAmbiguousValues(o, resultParameterTool);
    +					checkIsCastableToDefinedType(o, resultParameterTool);
    +					checkChoices(o, resultParameterTool);
     				}     			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else {&lt;br/&gt;
     				// check if there is a default name or a value passed for a possibly defined alternative name.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (hasNoDefaultValueAndNoValuePassedOnAlternativeName(o, parameterTool.data)) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				resultParameterTool = synchronizeAlternativeName(o, resultParameterTool);    +    +				if (!resultParameterTool.has(o.getName()) || Objects.equals(resultParameterTool.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {
     					missingArguments.add(o.getName());
     				}     			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     		}&lt;br/&gt;
     		if (!missingArguments.isEmpty()) &lt;/p&gt;
{
     			throw new RequiredParametersException(this.missingArgumentsText(missingArguments), missingArguments);
     		}
&lt;p&gt;    +&lt;br/&gt;
    +		return resultParameterTool;&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// check if the given parameter has a default value and add it to the passed map if that is the case&lt;br/&gt;
     	// else throw an exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void checkAndApplyDefaultValue(Option o, Map&amp;lt;String, String&amp;gt; data) throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (hasNoDefaultValueAndNoValuePassedOnAlternativeName(o, data)) {&lt;br/&gt;
    +	private ParameterTool checkAndApplyDefaultValue(Option o, ParameterTool parameterTool) throws RequiredParametersException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		final ParameterTool resultParameterTool = synchronizeAlternativeName(o, parameterTool);    +    +		if (!resultParameterTool.has(o.getName()) || Objects.equals(resultParameterTool.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {
     			throw new RequiredParametersException(&quot;No default value for undefined parameter &quot; + o.getName());
    +		} else {
    +			return resultParameterTool;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// check if the value in the given map which corresponds to the name of the given option&lt;br/&gt;
     	// is castable to the type of the option (if any is defined)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void checkIsCastableToDefinedType(Option o, Map&amp;lt;String, String&amp;gt; data) throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (o.hasType() &amp;amp;&amp;amp; !o.isCastableToDefinedType(data.get(o.getName()))) {&lt;br/&gt;
    +	private void checkIsCastableToDefinedType(Option o, ParameterTool parameterTool) throws RequiredParametersException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		if (o.hasType() &amp;amp;&amp;amp; !o.isCastableToDefinedType(parameterTool.get(o.getName()))) {
     			throw new RequiredParametersException(&quot;Value for parameter &quot; + o.getName() +
     					&quot; cannot be cast to type &quot; + o.getType());
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// check if the value in the given map which corresponds to the name of the given option&lt;br/&gt;
     	// adheres to the list of given choices for the param in the options (if any are defined)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void checkChoices(Option o, Map&amp;lt;String, String&amp;gt; data) throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (o.getChoices().size() &amp;gt; 0 &amp;amp;&amp;amp; !o.getChoices().contains(data.get(o.getName()))) {&lt;/li&gt;
	&lt;li&gt;throw new RequiredParametersException(&quot;Value &quot; + data.get(o.getName()) +&lt;br/&gt;
    +	private void checkChoices(Option o, ParameterTool parameterTool) throws RequiredParametersException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		if (o.getChoices().size() &amp;gt; 0 &amp;amp;&amp;amp; !o.getChoices().contains(parameterTool.get(o.getName()))) {
    +			throw new RequiredParametersException(&quot;Value &quot; + parameterTool.get(o.getName()) +
     					&quot; is not in the list of valid choices for key &quot; + o.getName());
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// move value passed on alternative name to standard name or apply default value if any defined&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// else return true to indicate parameter is &apos;really&apos; missing&lt;/li&gt;
	&lt;li&gt;private boolean hasNoDefaultValueAndNoValuePassedOnAlternativeName(Option o, Map&amp;lt;String, String&amp;gt; data)&lt;/li&gt;
	&lt;li&gt;throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (o.hasAlt() &amp;amp;&amp;amp; data.containsKey(o.getAlt())) {&lt;/li&gt;
	&lt;li&gt;data.put(o.getName(), data.get(o.getAlt()));&lt;br/&gt;
    +	// if any change was applied, then this method returns a new ParameterTool instance with these&lt;br/&gt;
    +	// changes. If not, then the passed ParameterTool instance will be returned.&lt;br/&gt;
    +	private ParameterTool synchronizeAlternativeName(Option o, ParameterTool parameterTool) {&lt;br/&gt;
    +		// TODO: Throw this all away!!!&lt;br/&gt;
    +		if (o.hasAlt() &amp;amp;&amp;amp; parameterTool.has(o.getAlt())) 
{
    +			HashMap&amp;lt;String, String&amp;gt; newData = new HashMap&amp;lt;&amp;gt;(parameterTool.toMap());
    +			newData.put(o.getName(), parameterTool.get(o.getAlt()));
    +
    +			return ParameterTool.fromMap(newData);
     		}
&lt;p&gt; else {&lt;br/&gt;
     			if (o.hasDefaultValue()) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;data.put(o.getName(), o.getDefaultValue());&lt;br/&gt;
    +				HashMap&amp;lt;String, String&amp;gt; newData = new HashMap&amp;lt;&amp;gt;(parameterTool.toMap());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    could we not instead create a copy at the start of applyTo and modify that?&lt;/p&gt;</comment>
                            <comment id="16234836" author="githubbot" created="Wed, 1 Nov 2017 22:10:00 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r148398599&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r148398599&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/RequiredParameters.java &amp;#8212;&lt;br/&gt;
    @@ -83,82 +82,100 @@ public void add(Option option) throws RequiredParametersException {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;If any check fails, a RequiredParametersException is thrown&lt;br/&gt;
     	 *&lt;/li&gt;
	&lt;li&gt;@param parameterTool - parameters supplied by the user.&lt;br/&gt;
    +	 * @return New ParameterTool instance with default values set&lt;/li&gt;
	&lt;li&gt;@throws RequiredParametersException if any of the specified checks fail&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void applyTo(ParameterTool parameterTool) throws RequiredParametersException {&lt;br/&gt;
    +	public ParameterTool applyTo(ParameterTool parameterTool) throws RequiredParametersException {&lt;br/&gt;
     		List&amp;lt;String&amp;gt; missingArguments = new LinkedList&amp;lt;&amp;gt;();&lt;br/&gt;
    +&lt;br/&gt;
    +		ParameterTool resultParameterTool = parameterTool;&lt;br/&gt;
     		for (Option o : data.values()) {&lt;/li&gt;
	&lt;li&gt;if (parameterTool.data.containsKey(o.getName())) {&lt;/li&gt;
	&lt;li&gt;if (Objects.equals(parameterTool.data.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {&lt;br/&gt;
    +			if (resultParameterTool.has(o.getName())) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				if (Objects.equals(resultParameterTool.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {
     					// the parameter has been passed, but no value, check if there is a default value
    -					checkAndApplyDefaultValue(o, parameterTool.data);
    +					resultParameterTool = checkAndApplyDefaultValue(o, resultParameterTool);
     				} else {
     					// a value has been passed in the parameterTool, now check if it adheres to all constraints
    -					checkAmbiguousValues(o, parameterTool.data);
    -					checkIsCastableToDefinedType(o, parameterTool.data);
    -					checkChoices(o, parameterTool.data);
    +					checkAmbiguousValues(o, resultParameterTool);
    +					checkIsCastableToDefinedType(o, resultParameterTool);
    +					checkChoices(o, resultParameterTool);
     				}     			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else {&lt;br/&gt;
     				// check if there is a default name or a value passed for a possibly defined alternative name.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (hasNoDefaultValueAndNoValuePassedOnAlternativeName(o, parameterTool.data)) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				resultParameterTool = synchronizeAlternativeName(o, resultParameterTool);    +    +				if (!resultParameterTool.has(o.getName()) || Objects.equals(resultParameterTool.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {
     					missingArguments.add(o.getName());
     				}     			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     		}&lt;br/&gt;
     		if (!missingArguments.isEmpty()) &lt;/p&gt;
{
     			throw new RequiredParametersException(this.missingArgumentsText(missingArguments), missingArguments);
     		}
&lt;p&gt;    +&lt;br/&gt;
    +		return resultParameterTool;&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// check if the given parameter has a default value and add it to the passed map if that is the case&lt;br/&gt;
     	// else throw an exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void checkAndApplyDefaultValue(Option o, Map&amp;lt;String, String&amp;gt; data) throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (hasNoDefaultValueAndNoValuePassedOnAlternativeName(o, data)) {&lt;br/&gt;
    +	private ParameterTool checkAndApplyDefaultValue(Option o, ParameterTool parameterTool) throws RequiredParametersException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		final ParameterTool resultParameterTool = synchronizeAlternativeName(o, parameterTool);    +    +		if (!resultParameterTool.has(o.getName()) || Objects.equals(resultParameterTool.get(o.getName()), ParameterTool.NO_VALUE_KEY)) {
     			throw new RequiredParametersException(&quot;No default value for undefined parameter &quot; + o.getName());
    +		} else {
    +			return resultParameterTool;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// check if the value in the given map which corresponds to the name of the given option&lt;br/&gt;
     	// is castable to the type of the option (if any is defined)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void checkIsCastableToDefinedType(Option o, Map&amp;lt;String, String&amp;gt; data) throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (o.hasType() &amp;amp;&amp;amp; !o.isCastableToDefinedType(data.get(o.getName()))) {&lt;br/&gt;
    +	private void checkIsCastableToDefinedType(Option o, ParameterTool parameterTool) throws RequiredParametersException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		if (o.hasType() &amp;amp;&amp;amp; !o.isCastableToDefinedType(parameterTool.get(o.getName()))) {
     			throw new RequiredParametersException(&quot;Value for parameter &quot; + o.getName() +
     					&quot; cannot be cast to type &quot; + o.getType());
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// check if the value in the given map which corresponds to the name of the given option&lt;br/&gt;
     	// adheres to the list of given choices for the param in the options (if any are defined)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void checkChoices(Option o, Map&amp;lt;String, String&amp;gt; data) throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (o.getChoices().size() &amp;gt; 0 &amp;amp;&amp;amp; !o.getChoices().contains(data.get(o.getName()))) {&lt;/li&gt;
	&lt;li&gt;throw new RequiredParametersException(&quot;Value &quot; + data.get(o.getName()) +&lt;br/&gt;
    +	private void checkChoices(Option o, ParameterTool parameterTool) throws RequiredParametersException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		if (o.getChoices().size() &amp;gt; 0 &amp;amp;&amp;amp; !o.getChoices().contains(parameterTool.get(o.getName()))) {
    +			throw new RequiredParametersException(&quot;Value &quot; + parameterTool.get(o.getName()) +
     					&quot; is not in the list of valid choices for key &quot; + o.getName());
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// move value passed on alternative name to standard name or apply default value if any defined&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// else return true to indicate parameter is &apos;really&apos; missing&lt;/li&gt;
	&lt;li&gt;private boolean hasNoDefaultValueAndNoValuePassedOnAlternativeName(Option o, Map&amp;lt;String, String&amp;gt; data)&lt;/li&gt;
	&lt;li&gt;throws RequiredParametersException {&lt;/li&gt;
	&lt;li&gt;if (o.hasAlt() &amp;amp;&amp;amp; data.containsKey(o.getAlt())) {&lt;/li&gt;
	&lt;li&gt;data.put(o.getName(), data.get(o.getAlt()));&lt;br/&gt;
    +	// if any change was applied, then this method returns a new ParameterTool instance with these&lt;br/&gt;
    +	// changes. If not, then the passed ParameterTool instance will be returned.&lt;br/&gt;
    +	private ParameterTool synchronizeAlternativeName(Option o, ParameterTool parameterTool) {&lt;br/&gt;
    +		// TODO: Throw this all away!!!&lt;br/&gt;
    +		if (o.hasAlt() &amp;amp;&amp;amp; parameterTool.has(o.getAlt())) 
{
    +			HashMap&amp;lt;String, String&amp;gt; newData = new HashMap&amp;lt;&amp;gt;(parameterTool.toMap());
    +			newData.put(o.getName(), parameterTool.get(o.getAlt()));
    +
    +			return ParameterTool.fromMap(newData);
     		}
&lt;p&gt; else {&lt;br/&gt;
     			if (o.hasDefaultValue()) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;data.put(o.getName(), o.getDefaultValue());&lt;br/&gt;
    +				HashMap&amp;lt;String, String&amp;gt; newData = new HashMap&amp;lt;&amp;gt;(parameterTool.toMap());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes we could. But I didn&apos;t want to touch more than necessary. I think that this actually dead code and should be removed.&lt;/p&gt;</comment>
                            <comment id="16234877" author="githubbot" created="Wed, 1 Nov 2017 22:35:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @zentol. I&apos;ve changed the `RequiredParameters#applyTo` method as you suggested and it was a less impacting change.&lt;/p&gt;</comment>
                            <comment id="16240245" author="githubbot" created="Mon, 6 Nov 2017 12:58:13 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r149071909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r149071909&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/ParameterTool.java &amp;#8212;&lt;br/&gt;
    @@ -210,15 +212,44 @@ public static ParameterTool fromSystemProperties() &lt;/p&gt;
{
     		return fromMap((Map) System.getProperties());
     	}

&lt;p&gt;    +	private static final Object placeholder = new Object();&lt;br/&gt;
    +&lt;br/&gt;
     	// ------------------ ParameterUtil  ------------------------&lt;br/&gt;
     	protected final Map&amp;lt;String, String&amp;gt; data;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected final Map&amp;lt;String, String&amp;gt; defaultData;&lt;/li&gt;
	&lt;li&gt;protected final Set&amp;lt;String&amp;gt; unrequestedParameters;&lt;br/&gt;
    +&lt;br/&gt;
    +	// data which is only used on the client and does not need to be transmitted&lt;br/&gt;
    +	protected transient Map&amp;lt;String, String&amp;gt; defaultData;&lt;br/&gt;
    +	protected transient Map&amp;lt;String, Object&amp;gt; unrequestedParameters;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private ParameterTool(Map&amp;lt;String, String&amp;gt; data) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.data = new HashMap&amp;lt;&amp;gt;(data);&lt;/li&gt;
	&lt;li&gt;this.defaultData = new HashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;this.unrequestedParameters = new HashSet&amp;lt;&amp;gt;(data.keySet());&lt;br/&gt;
    +		this.data = Collections.unmodifiableMap(new HashMap&amp;lt;&amp;gt;(data));&lt;br/&gt;
    +&lt;br/&gt;
    +		this.defaultData = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());&lt;br/&gt;
    +&lt;br/&gt;
    +		this.unrequestedParameters = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    IIRC you already switched to a `Set`, did you revert something?&lt;/p&gt;</comment>
                            <comment id="16243997" author="githubbot" created="Wed, 8 Nov 2017 14:12:07 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921#discussion_r149678385&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921#discussion_r149678385&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-java/src/main/java/org/apache/flink/api/java/utils/ParameterTool.java &amp;#8212;&lt;br/&gt;
    @@ -210,15 +212,44 @@ public static ParameterTool fromSystemProperties() &lt;/p&gt;
{
     		return fromMap((Map) System.getProperties());
     	}

&lt;p&gt;    +	private static final Object placeholder = new Object();&lt;br/&gt;
    +&lt;br/&gt;
     	// ------------------ ParameterUtil  ------------------------&lt;br/&gt;
     	protected final Map&amp;lt;String, String&amp;gt; data;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected final Map&amp;lt;String, String&amp;gt; defaultData;&lt;/li&gt;
	&lt;li&gt;protected final Set&amp;lt;String&amp;gt; unrequestedParameters;&lt;br/&gt;
    +&lt;br/&gt;
    +	// data which is only used on the client and does not need to be transmitted&lt;br/&gt;
    +	protected transient Map&amp;lt;String, String&amp;gt; defaultData;&lt;br/&gt;
    +	protected transient Map&amp;lt;String, Object&amp;gt; unrequestedParameters;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private ParameterTool(Map&amp;lt;String, String&amp;gt; data) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.data = new HashMap&amp;lt;&amp;gt;(data);&lt;/li&gt;
	&lt;li&gt;this.defaultData = new HashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;this.unrequestedParameters = new HashSet&amp;lt;&amp;gt;(data.keySet());&lt;br/&gt;
    +		this.data = Collections.unmodifiableMap(new HashMap&amp;lt;&amp;gt;(data));&lt;br/&gt;
    +&lt;br/&gt;
    +		this.defaultData = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());&lt;br/&gt;
    +&lt;br/&gt;
    +		this.unrequestedParameters = new ConcurrentHashMap&amp;lt;&amp;gt;(data.size());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes I must have changed something. Don&apos;t know really what. Will re-address your feedback.&lt;/p&gt;</comment>
                            <comment id="16244027" author="githubbot" created="Wed, 8 Nov 2017 14:31:51 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve addressed your comments @zentol. Additionally I&apos;ve rebased onto the latest master and did a force push. Sorry for that.&lt;/p&gt;</comment>
                            <comment id="16253001" author="githubbot" created="Wed, 15 Nov 2017 06:09:51 +0000"  >&lt;p&gt;Github user bowenli86 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    LGTM +1&lt;/p&gt;</comment>
                            <comment id="16253226" author="githubbot" created="Wed, 15 Nov 2017 10:19:35 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="16253424" author="githubbot" created="Wed, 15 Nov 2017 13:13:22 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging.&lt;/p&gt;</comment>
                            <comment id="16259320" author="githubbot" created="Mon, 20 Nov 2017 14:52:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4921&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16259323" author="zentol" created="Mon, 20 Nov 2017 14:52:51 +0000"  >&lt;p&gt;1.4: 2b4f1b1168e074be7ec6f57800877cccd1aef28e&lt;br/&gt;
1.5: 90b3b4cfd2f0769e23a768061023f912d1a0cf50&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13113020">FLINK-7947</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lutr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>