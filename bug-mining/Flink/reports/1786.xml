<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6652] Problem with DelimitedInputFormat</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6652</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;After upgrading from Flink 1.2.0 to 1.2.1 I got the following error&lt;br/&gt;
```&lt;br/&gt;
07:54:52,395 ERROR org.apache.flink.api.common.io.DelimitedInputFormat           - Unexpected problen while getting the file statistics for file &apos;mytestfile&apos;: -1&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: -1&lt;br/&gt;
	at org.apache.flink.api.common.io.DelimitedInputFormat.readLine(DelimitedInputFormat.java:572)&lt;br/&gt;
	at org.apache.flink.api.common.io.DelimitedInputFormat.getStatistics(DelimitedInputFormat.java:423)&lt;br/&gt;
	at org.apache.flink.api.common.io.DelimitedInputFormat.getStatistics(DelimitedInputFormat.java:48)&lt;br/&gt;
	at org.apache.flink.optimizer.dag.DataSourceNode.computeOperatorSpecificDefaultEstimates(DataSourceNode.java:166)&lt;br/&gt;
```&lt;br/&gt;
I have created a test repo to isolate the issue here&lt;br/&gt;
&lt;a href=&quot;https://github.com/physikerwelt/flinkReadTest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/physikerwelt/flinkReadTest&lt;/a&gt;&lt;br/&gt;
and reproduced the bug using travis&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/physikerwelt/flinkReadTest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/physikerwelt/flinkReadTest&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13073679">FLINK-6652</key>
            <summary>Problem with DelimitedInputFormat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fhueske">Fabian Hueske</assignee>
                                    <reporter username="physikerwelt">Moritz Schubotz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 21 May 2017 07:25:30 +0000</created>
                <updated>Thu, 28 Feb 2019 13:46:02 +0000</updated>
                            <resolved>Tue, 20 Jun 2017 15:13:30 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>API / DataSet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16019376" author="aljoscha" created="Mon, 22 May 2017 09:39:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt; Could you please look at this? I think it could be caused by the changes around &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5771&quot; title=&quot;DelimitedInputFormat does not correctly handle multi-byte delimiters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5771&quot;&gt;&lt;del&gt;FLINK-5771&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16042612" author="githubbot" created="Thu, 8 Jun 2017 12:16:47 +0000"  >&lt;p&gt;GitHub user fhueske opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6652&quot; title=&quot;Problem with DelimitedInputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6652&quot;&gt;&lt;del&gt;FLINK-6652&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;core&amp;#93;&lt;/span&gt; Fix handling of delimiters split by buffers in DelimitedInputFormat&lt;/p&gt;

&lt;p&gt;    This PR fixes a bug introduced by fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5771&quot; title=&quot;DelimitedInputFormat does not correctly handle multi-byte delimiters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5771&quot;&gt;&lt;del&gt;FLINK-5771&lt;/del&gt;&lt;/a&gt; / PR #3316. That fix resets the read position if a character sequence matches a prefix of a multi char delimiter. This will yield an `IndexOutOfBoundsException` if prefix spans the boundaries of the read buffer.&lt;/p&gt;

&lt;p&gt;    This fix moves the prefix of the multi char delimiter to the beginning of the read buffer if the read buffer was completely read. In case the read position has to be reset, the prefix is still in the read buffer and can be parsed again.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/fhueske/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fhueske/flink&lt;/a&gt; fixDelimIF&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4088&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 740a2f42788e1cb957ab1e79b9b67dcfb06b875d&lt;br/&gt;
Author: Fabian Hueske &amp;lt;fhueske@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-06-07T21:01:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6652&quot; title=&quot;Problem with DelimitedInputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6652&quot;&gt;&lt;del&gt;FLINK-6652&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;core&amp;#93;&lt;/span&gt; Fix handling of delimiters split by buffers in DelimitedInputFormat&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16051959" author="githubbot" created="Fri, 16 Jun 2017 14:20:03 +0000"  >&lt;p&gt;Github user alpinegizmo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    FYI, the reference solutions to the batch training exercises are failing, and it looks to me like it&apos;s because of this issue.&lt;/p&gt;</comment>
                            <comment id="16055534" author="githubbot" created="Tue, 20 Jun 2017 10:34:19 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088#discussion_r122929197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088#discussion_r122929197&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/io/DelimitedInputFormat.java &amp;#8212;&lt;br/&gt;
    @@ -246,6 +246,9 @@ public void setDelimiter(String delimiter) &lt;/p&gt;
{
     			throw new IllegalArgumentException(&quot;Delimiter must not be null&quot;);
     		}
&lt;p&gt;     		this.delimiter = delimiter.getBytes(getCharset());&lt;br/&gt;
    +		if (this.bufferSize &amp;gt; 0 &amp;amp;&amp;amp; this.delimiter.length &amp;gt;= this.bufferSize) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    since the initial value for `bufferSize` is `-1` doesn&apos;t this mean that the delimiter can never be set without calling `setBufferSize`? Would it make sense to move this check into `open()`?&lt;/p&gt;</comment>
                            <comment id="16055535" author="githubbot" created="Tue, 20 Jun 2017 10:34:19 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088#discussion_r122929860&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088#discussion_r122929860&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/io/DelimitedInputFormat.java &amp;#8212;&lt;br/&gt;
    @@ -269,6 +272,9 @@ public void setBufferSize(int bufferSize) {&lt;br/&gt;
     		if (bufferSize &amp;lt; 1) &lt;/p&gt;
{
     			throw new IllegalArgumentException(&quot;Buffer size must be at least 1.&quot;);
     		}
&lt;p&gt;    +		if (bufferSize &amp;lt;= delimiter.length) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    we should also adjust the condition above that `bufferSize` must be be greater than one.&lt;/p&gt;</comment>
                            <comment id="16055717" author="githubbot" created="Tue, 20 Jun 2017 13:05:47 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @zentol!&lt;br/&gt;
    I moved the check to `initBuffers()` which is called from `open()`.&lt;/p&gt;</comment>
                            <comment id="16055781" author="githubbot" created="Tue, 20 Jun 2017 13:51:24 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1.&lt;/p&gt;</comment>
                            <comment id="16055894" author="githubbot" created="Tue, 20 Jun 2017 15:01:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4088&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16055917" author="fhueske" created="Tue, 20 Jun 2017 15:13:30 +0000"  >&lt;p&gt;Fixed for 1.2.2 with c709dce63d27ad06658aeba356f851b832f4d093&lt;br/&gt;
Fixed for 1.3.1 with 088232c2e715f0ba49785c0e1168a93430668caa&lt;br/&gt;
Fixed for 1.4.0 with be662bf7ebcefb289988a24392104c3385029568&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f9jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>