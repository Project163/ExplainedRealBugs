<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:48:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18336] CheckpointFailureManager forgets failed checkpoints after a successful one</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18336</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;To my understanding, failure shouldn&apos;t be counted more than once for a single checkpoint.&lt;/p&gt;

&lt;p&gt;However, after a successful checkpoint, all previous failures are cleared.&lt;/p&gt;

&lt;p&gt;So this test will currently fail:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TestFailJobCallback callback = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestFailJobCallback();
CheckpointFailureManager failureManager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CheckpointFailureManager(2, callback);

failureManager.handleJobLevelCheckpointException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CheckpointException(CHECKPOINT_EXPIRED), 1L);
failureManager.handleJobLevelCheckpointException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CheckpointException(CHECKPOINT_EXPIRED), 2L);

failureManager.handleCheckpointSuccess(2L);
failureManager.handleJobLevelCheckpointException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CheckpointException(CHECKPOINT_EXPIRED), 3L);
failureManager.handleJobLevelCheckpointException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CheckpointException(CHECKPOINT_EXPIRED), 4L);

&lt;span class=&quot;code-comment&quot;&gt;// shouldn&apos;t be counted because 1L has already failed:
&lt;/span&gt;failureManager.handleJobLevelCheckpointException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CheckpointException(CHECKPOINT_EXPIRED), 1L); 

assertEquals(0, callback.getInvokeCounter());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13311755">FLINK-18336</key>
            <summary>CheckpointFailureManager forgets failed checkpoints after a successful one</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="roman">Roman Khachatryan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 16 Jun 2020 15:36:40 +0000</created>
                <updated>Thu, 2 Jul 2020 09:53:36 +0000</updated>
                            <resolved>Thu, 2 Jul 2020 09:53:35 +0000</resolved>
                                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17138848" author="stephanewen" created="Wed, 17 Jun 2020 21:34:28 +0000"  >&lt;p&gt;What is the problem exactly? So far it was always the expected behavior that after a successful checkpoint, the failed ones are forgotton (failure counter reset).&lt;/p&gt;</comment>
                            <comment id="17139193" author="roman_khachatryan" created="Thu, 18 Jun 2020 08:03:41 +0000"  >&lt;p&gt;What if after a successful checkpoint, failureManager is notified about a failure that it&#160;has already seen?&lt;/p&gt;

&lt;p&gt;I&apos;ve added&#160;an example unit test in the description to demonstrate this better.&lt;/p&gt;</comment>
                            <comment id="17139352" author="stephanewen" created="Thu, 18 Jun 2020 11:49:49 +0000"  >&lt;p&gt;This means a failure for a checkpoint that is already subsumed by a newer checkpoint (higher checkpoint ID) ?&lt;/p&gt;

&lt;p&gt;In that case, should the failure manager maintain something like &quot;latest successful checkpoint&quot; and ignore all failures / messages from older (subsumed) checkpoint attempts?&lt;/p&gt;

&lt;p&gt;That way we would preserve the notion of tracking &quot;consecutive checkpoint failures&quot; and we would not need to keep a lot of information from earlier checkpoints.&lt;/p&gt;</comment>
                            <comment id="17139418" author="roman_khachatryan" created="Thu, 18 Jun 2020 13:26:49 +0000"  >&lt;p&gt;&amp;gt; This means a failure for a checkpoint that is already subsumed by a newer checkpoint (higher checkpoint ID) ?&lt;/p&gt;

&lt;p&gt;Yes, and the other case is decline of an older savepoint (which I believe are not subsumed).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; In that case, should the failure manager maintain something like &quot;latest successful checkpoint&quot; and ignore all failures / messages from older (subsumed) checkpoint attempts?&lt;/p&gt;

&lt;p&gt;It should work and it&apos;s&#160;quite simple and efficient.&lt;/p&gt;</comment>
                            <comment id="17143155" author="roman_khachatryan" created="Tue, 23 Jun 2020 17:37:34 +0000"  >&lt;p&gt;I published a PR with this change:&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/12751&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/12751&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17150138" author="zjwang" created="Thu, 2 Jul 2020 09:53:35 +0000"  >&lt;p&gt;Merged in master: 06af98a6e0247dbf1b08f5caf6ca67f2a56dd8e5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fwk0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>