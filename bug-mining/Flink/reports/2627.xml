<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10314] Blocking calls in Execution Graph creation bring down cluster</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10314</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When the execution graph creation has long calls (or blocking calls), it brings down the cluster. It seems to block the main actor thread of the dispatcher, making the entire cluster unresponsive (web UI, etc.)&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Reproducing&quot;&gt;&lt;/a&gt;Reproducing&lt;/h3&gt;

&lt;p&gt;One way to reproduce this is to use a FileSystem that blocks on initialization or on opening a stream.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;FullExceptionLog&quot;&gt;&lt;/a&gt;Full Exception Log&lt;/h3&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
at com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemBase.initialize(GoogleHadoopFileSystemBase.java:1022)
	at com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemBase.initialize(GoogleHadoopFileSystemBase.java:985)
	at org.apache.flink.runtime.fs.hdfs.HadoopFsFactory.create(HadoopFsFactory.java:159)
	at org.apache.flink.core.fs.FileSystem.getUnguardedFileSystem(FileSystem.java:399)
	at org.apache.flink.core.fs.FileSystem.get(FileSystem.java:318)
	at org.apache.flink.core.fs.Path.getFileSystem(Path.java:298)
	at org.apache.flink.runtime.state.filesystem.FsCheckpointStorage.&amp;lt;init&amp;gt;(FsCheckpointStorage.java:61)
	at org.apache.flink.runtime.state.filesystem.FsStateBackend.createCheckpointStorage(FsStateBackend.java:443)
	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.&amp;lt;init&amp;gt;(CheckpointCoordinator.java:248)
	at org.apache.flink.runtime.executiongraph.ExecutionGraph.enableCheckpointing(ExecutionGraph.java:495)
	at org.apache.flink.runtime.executiongraph.ExecutionGraphBuilder.buildGraph(ExecutionGraphBuilder.java:345)
	at org.apache.flink.runtime.executiongraph.ExecutionGraphBuilder.buildGraph(ExecutionGraphBuilder.java:100)
	at org.apache.flink.runtime.jobmaster.JobMaster.createExecutionGraph(JobMaster.java:1152)
	at org.apache.flink.runtime.jobmaster.JobMaster.createAndRestoreExecutionGraph(JobMaster.java:1132)
	at org.apache.flink.runtime.jobmaster.JobMaster.&amp;lt;init&amp;gt;(JobMaster.java:295)
	at org.apache.flink.runtime.jobmaster.JobManagerRunner.&amp;lt;init&amp;gt;(JobManagerRunner.java:157)
	at org.apache.flink.runtime.dispatcher.Dispatcher$DefaultJobManagerRunnerFactory.createJobManagerRunner(Dispatcher.java:936)
	at org.apache.flink.runtime.dispatcher.Dispatcher.createJobManagerRunner(Dispatcher.java:291)
	at org.apache.flink.runtime.dispatcher.Dispatcher.runJob(Dispatcher.java:281)
	at org.apache.flink.runtime.dispatcher.Dispatcher.persistAndRunJob(Dispatcher.java:266)
	at org.apache.flink.runtime.dispatcher.Dispatcher$$Lambda$108/1800332159.acceptWithException(Unknown Source)
	at org.apache.flink.util.function.ConsumerWithException.accept(ConsumerWithException.java:38)
	at org.apache.flink.runtime.dispatcher.Dispatcher.lambda$waitForTerminatingJobManager$29(Dispatcher.java:820)
	at org.apache.flink.runtime.dispatcher.Dispatcher$$Lambda$110/1318857678.run(Unknown Source)
	at java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:705)
	at java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:687)
	at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:442)


As a result, everything becomes unresponsive and breaks, and log is full of these errors:

java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:06:58,679 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:08,629 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:08,663 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:08,679 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:08,700 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:18,712 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:18,729 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:28,739 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:28,749 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:38,709 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:38,729 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:38,769 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:38,778 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:48,788 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobsOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
2018-08-24 17:07:48,799 ERROR org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.cluster.ClusterOverviewHandler  - Could not retrieve the redirect address.
java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:593)
	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
	at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:770)
	at akka.dispatch.OnComplete.internal(Future.scala:258)
	at akka.dispatch.OnComplete.internal(Future.scala:256)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)
	at akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)
	at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:36)
	at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:83)
	at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:44)
	at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:252)
	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:603)
	at akka.actor.Scheduler$$anon$4.run(Scheduler.scala:126)
	at scala.concurrent.Future$InternalCallbackExecutor$.unbatchedExecute(Future.scala:601)
	at scala.concurrent.BatchingExecutor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;execute(BatchingExecutor.scala:109)
	at scala.concurrent.Future$InternalCallbackExecutor$.execute(Future.scala:599)
	at akka.actor.LightArrayRevolverScheduler$TaskHolder.executeTask(LightArrayRevolverScheduler.scala:329)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.executeBucket$1(LightArrayRevolverScheduler.scala:280)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.nextTick(LightArrayRevolverScheduler.scala:284)
	at akka.actor.LightArrayRevolverScheduler$$anon$4.run(LightArrayRevolverScheduler.scala:236)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/dispatcher#146546706]] after [10000 ms]. Sender[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] sent message of type &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;&lt;/span&gt;.
&lt;/span&gt;	at akka.pattern.PromiseActorRef$$anonfun$1.apply$mcV$sp(AskSupport.scala:604)
	... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13183972">FLINK-10314</key>
            <summary>Blocking calls in Execution Graph creation bring down cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 10 Sep 2018 08:31:35 +0000</created>
                <updated>Thu, 28 Feb 2019 14:00:49 +0000</updated>
                            <resolved>Fri, 14 Sep 2018 22:04:44 +0000</resolved>
                                    <version>1.5.2</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16614952" author="githubbot" created="Fri, 14 Sep 2018 15:01:19 +0000"  >&lt;p&gt;tillrohrmann opened a new pull request #6699: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10314&quot; title=&quot;Blocking calls in Execution Graph creation bring down cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10314&quot;&gt;&lt;del&gt;FLINK-10314&lt;/del&gt;&lt;/a&gt; Making JobManagerRunner creation non-blocking in Dispatcher&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6699&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   The JobManagerRunner creation can be a blocking operation, e.g. if the CheckpointCoordinator&lt;br/&gt;
   needs to access a FileSystem. Therefore, this operation should not be executed in the main thread&lt;br/&gt;
   of the Dispatcher in order to not block this component.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Store `CompletableFuture&amp;lt;JobManagerRunner&amp;gt;` in `Dispatcher#jobManagerRunnerFutures`&lt;/li&gt;
	&lt;li&gt;Made the creation of the `JobManagerRunner` asynchronous&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added `DispatcherTest#testBlockingJobManagerRunner` and `DispatcherTest#testFailingJobManagerRunnerCleanup`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16615310" author="githubbot" created="Fri, 14 Sep 2018 19:53:06 +0000"  >&lt;p&gt;asfgit closed pull request #6699: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10314&quot; title=&quot;Blocking calls in Execution Graph creation bring down cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10314&quot;&gt;&lt;del&gt;FLINK-10314&lt;/del&gt;&lt;/a&gt; Making JobManagerRunner creation non-blocking in Dispatcher&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6699&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-core/src/main/java/org/apache/flink/util/function/FunctionUtils.java b/flink-core/src/main/java/org/apache/flink/util/function/FunctionUtils.java&lt;br/&gt;
index 678ef9f78b6..83846a62b64 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/main/java/org/apache/flink/util/function/FunctionUtils.java&lt;br/&gt;
+++ b/flink-core/src/main/java/org/apache/flink/util/function/FunctionUtils.java&lt;br/&gt;
@@ -32,6 +32,19 @@ private FunctionUtils() &lt;/p&gt;
{
 		throw new UnsupportedOperationException(&quot;This class should never be instantiated.&quot;);
 	}

&lt;p&gt;+	private static final Function&amp;lt;Object, Void&amp;gt; NULL_FN = ignored -&amp;gt; null;&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Function which returns &lt;/p&gt;
{@code null} (type: Void).&lt;br/&gt;
+	 *&lt;br/&gt;
+	 * @param &amp;lt;T&amp;gt; input type&lt;br/&gt;
+	 * @return Function which returns {@code null}
&lt;p&gt;.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@SuppressWarnings(&quot;unchecked&quot;)&lt;br/&gt;
+	public static &amp;lt;T&amp;gt; Function&amp;lt;T, Void&amp;gt; nullFn() &lt;/p&gt;
{
+		return (Function&amp;lt;T, Void&amp;gt;) NULL_FN;
+	}
&lt;p&gt;+&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Convert at 
{@link FunctionWithException}
&lt;p&gt; into a &lt;/p&gt;
{@link Function}
&lt;p&gt;.&lt;br/&gt;
 	 *&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
index 5279e502a93..a1da2131e48 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
@@ -63,10 +63,11 @@&lt;br/&gt;
 import org.apache.flink.util.ExceptionUtils;&lt;br/&gt;
 import org.apache.flink.util.FlinkException;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
+import org.apache.flink.util.function.BiConsumerWithException;&lt;br/&gt;
 import org.apache.flink.util.function.BiFunctionWithException;&lt;br/&gt;
+import org.apache.flink.util.function.CheckedSupplier;&lt;br/&gt;
 import org.apache.flink.util.function.FunctionUtils;&lt;br/&gt;
-import org.apache.flink.util.function.ThrowingConsumer;&lt;br/&gt;
-import org.apache.flink.util.function.ThrowingRunnable;&lt;br/&gt;
+import org.apache.flink.util.function.FunctionWithException;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import javax.annotation.Nonnull;&lt;br/&gt;
 import javax.annotation.Nullable;&lt;br/&gt;
@@ -110,7 +111,7 @@&lt;/p&gt;

&lt;p&gt; 	private final FatalErrorHandler fatalErrorHandler;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final Map&amp;lt;JobID, JobManagerRunner&amp;gt; jobManagerRunners;&lt;br/&gt;
+	private final Map&amp;lt;JobID, CompletableFuture&amp;lt;JobManagerRunner&amp;gt;&amp;gt; jobManagerRunnerFutures;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final LeaderElectionService leaderElectionService;&lt;/p&gt;

&lt;p&gt;@@ -166,7 +167,7 @@ public Dispatcher(&lt;/p&gt;

&lt;p&gt; 		this.runningJobsRegistry = highAvailabilityServices.getRunningJobsRegistry();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jobManagerRunners = new HashMap&amp;lt;&amp;gt;(16);&lt;br/&gt;
+		jobManagerRunnerFutures = new HashMap&amp;lt;&amp;gt;(16);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		leaderElectionService = highAvailabilityServices.getDispatcherLeaderElectionService();&lt;/p&gt;

&lt;p&gt;@@ -248,7 +249,7 @@ public void start() throws Exception &lt;/p&gt;
{
 			return FutureUtils.completedExceptionally(new FlinkException(String.format(&quot;Failed to retrieve job scheduling status for job %s.&quot;, jobId), e));
 		}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jobSchedulingStatus == RunningJobsRegistry.JobSchedulingStatus.DONE || jobManagerRunners.containsKey(jobId)) {&lt;br/&gt;
+		if (jobSchedulingStatus == RunningJobsRegistry.JobSchedulingStatus.DONE || jobManagerRunnerFutures.containsKey(jobId)) 
{
 			return FutureUtils.completedExceptionally(
 				new JobSubmissionException(jobId, String.format(&quot;Job has already been submitted and is in state %s.&quot;, jobSchedulingStatus)));
 		}
&lt;p&gt; else {&lt;br/&gt;
@@ -257,58 +258,72 @@ public void start() throws Exception {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			return persistAndRunFuture.exceptionally(&lt;br/&gt;
 				(Throwable throwable) -&amp;gt; {&lt;br/&gt;
+					final Throwable strippedThrowable = ExceptionUtils.stripCompletionException(throwable);&lt;br/&gt;
+					log.error(&quot;Failed to submit job {}.&quot;, jobId, strippedThrowable);&lt;br/&gt;
 					throw new CompletionException(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new JobSubmissionException(jobId, &quot;Failed to submit job.&quot;, throwable));&lt;br/&gt;
+						new JobSubmissionException(jobId, &quot;Failed to submit job.&quot;, strippedThrowable));&lt;br/&gt;
 				});&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void persistAndRunJob(JobGraph jobGraph) throws Exception {&lt;br/&gt;
+	private CompletableFuture&amp;lt;Void&amp;gt; persistAndRunJob(JobGraph jobGraph) throws Exception {&lt;br/&gt;
 		submittedJobGraphStore.putJobGraph(new SubmittedJobGraph(jobGraph, null));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
-			runJob(jobGraph);
-		}
&lt;p&gt; catch (Exception e) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;try {&lt;br/&gt;
+		final CompletableFuture&amp;lt;Void&amp;gt; runJobFuture = runJob(jobGraph);&lt;br/&gt;
+&lt;br/&gt;
+		return runJobFuture.whenComplete(BiConsumerWithException.unchecked((Object ignored, Throwable throwable) -&amp;gt; {&lt;br/&gt;
+			if (throwable != null) 
{
 				submittedJobGraphStore.removeJobGraph(jobGraph.getJobID());
-			}
&lt;p&gt; catch (Exception ie) &lt;/p&gt;
{
-				e.addSuppressed(ie);
 			}
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;throw e;&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
+		}));&lt;br/&gt;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void runJob(JobGraph jobGraph) throws Exception {&lt;/li&gt;
	&lt;li&gt;Preconditions.checkState(!jobManagerRunners.containsKey(jobGraph.getJobID()));&lt;br/&gt;
+	private CompletableFuture&amp;lt;Void&amp;gt; runJob(JobGraph jobGraph) {&lt;br/&gt;
+		Preconditions.checkState(!jobManagerRunnerFutures.containsKey(jobGraph.getJobID()));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final JobManagerRunner jobManagerRunner = createJobManagerRunner(jobGraph);&lt;br/&gt;
+		final CompletableFuture&amp;lt;JobManagerRunner&amp;gt; jobManagerRunnerFuture = createJobManagerRunner(jobGraph);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jobManagerRunner.start();&lt;br/&gt;
+		jobManagerRunnerFutures.put(jobGraph.getJobID(), jobManagerRunnerFuture);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;jobManagerRunners.put(jobGraph.getJobID(), jobManagerRunner);&lt;br/&gt;
+		return jobManagerRunnerFuture&lt;br/&gt;
+			.thenApply(FunctionUtils.nullFn())&lt;br/&gt;
+			.whenCompleteAsync(&lt;br/&gt;
+				(ignored, throwable) -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+					if (throwable != null) {
+						jobManagerRunnerFutures.remove(jobGraph.getJobID());
+					}+				}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;,&lt;br/&gt;
+				getMainThreadExecutor());&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private JobManagerRunner createJobManagerRunner(JobGraph jobGraph) throws Exception {&lt;/li&gt;
	&lt;li&gt;final JobID jobId = jobGraph.getJobID();&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;final JobManagerRunner jobManagerRunner = jobManagerRunnerFactory.createJobManagerRunner(&lt;/li&gt;
	&lt;li&gt;ResourceID.generate(),&lt;/li&gt;
	&lt;li&gt;jobGraph,&lt;/li&gt;
	&lt;li&gt;configuration,&lt;/li&gt;
	&lt;li&gt;getRpcService(),&lt;/li&gt;
	&lt;li&gt;highAvailabilityServices,&lt;/li&gt;
	&lt;li&gt;heartbeatServices,&lt;/li&gt;
	&lt;li&gt;blobServer,&lt;/li&gt;
	&lt;li&gt;jobManagerSharedServices,&lt;/li&gt;
	&lt;li&gt;new DefaultJobManagerJobMetricGroupFactory(jobManagerMetricGroup),&lt;/li&gt;
	&lt;li&gt;fatalErrorHandler);&lt;br/&gt;
+	private CompletableFuture&amp;lt;JobManagerRunner&amp;gt; createJobManagerRunner(JobGraph jobGraph) 
{
+		final RpcService rpcService = getRpcService();
+
+		final CompletableFuture&amp;lt;JobManagerRunner&amp;gt; jobManagerRunnerFuture = CompletableFuture.supplyAsync(
+			CheckedSupplier.unchecked(() -&amp;gt;
+				jobManagerRunnerFactory.createJobManagerRunner(
+					ResourceID.generate(),
+					jobGraph,
+					configuration,
+					rpcService,
+					highAvailabilityServices,
+					heartbeatServices,
+					blobServer,
+					jobManagerSharedServices,
+					new DefaultJobManagerJobMetricGroupFactory(jobManagerMetricGroup),
+					fatalErrorHandler)),
+			rpcService.getExecutor());
+
+		return jobManagerRunnerFuture.thenApply(FunctionUtils.uncheckedFunction(this::startJobManagerRunner));
+	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+	private JobManagerRunner startJobManagerRunner(JobManagerRunner jobManagerRunner) throws Exception {&lt;br/&gt;
+		final JobID jobId = jobManagerRunner.getJobGraph().getJobID();&lt;br/&gt;
 		jobManagerRunner.getResultFuture().whenCompleteAsync(&lt;br/&gt;
 			(ArchivedExecutionGraph archivedExecutionGraph, Throwable throwable) -&amp;gt; {&lt;br/&gt;
 				// check if we are still the active JobManagerRunner by checking the identity&lt;br/&gt;
 				//noinspection ObjectEquality&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jobManagerRunner == jobManagerRunners.get(jobId)) {&lt;br/&gt;
+				if (jobManagerRunner == jobManagerRunnerFutures.get(jobId).getNow(null)) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { 					if (archivedExecutionGraph != null) {
 						jobReachedGloballyTerminalState(archivedExecutionGraph);
 					} else {
@@ -325,13 +340,15 @@ private JobManagerRunner createJobManagerRunner(JobGraph jobGraph) throws Except
 				} 			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;, getMainThreadExecutor());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+		jobManagerRunner.start();&lt;br/&gt;
+&lt;br/&gt;
 		return jobManagerRunner;&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	@Override&lt;br/&gt;
 	public CompletableFuture&amp;lt;Collection&amp;lt;JobID&amp;gt;&amp;gt; listJobs(Time timeout) &lt;/p&gt;
{
 		return CompletableFuture.completedFuture(
-			Collections.unmodifiableSet(new HashSet&amp;lt;&amp;gt;(jobManagerRunners.keySet())));
+			Collections.unmodifiableSet(new HashSet&amp;lt;&amp;gt;(jobManagerRunnerFutures.keySet())));
 	}

&lt;p&gt; 	@Override&lt;br/&gt;
@@ -481,9 +498,9 @@ private JobManagerRunner createJobManagerRunner(JobGraph jobGraph) throws Except&lt;/p&gt;

&lt;p&gt; 	@Override&lt;br/&gt;
 	public CompletableFuture&amp;lt;JobResult&amp;gt; requestJobResult(JobID jobId, Time timeout) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final JobManagerRunner jobManagerRunner = jobManagerRunners.get(jobId);&lt;br/&gt;
+		final CompletableFuture&amp;lt;JobManagerRunner&amp;gt; jobManagerRunnerFuture = jobManagerRunnerFutures.get(jobId);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jobManagerRunner == null) {&lt;br/&gt;
+		if (jobManagerRunnerFuture == null) {&lt;br/&gt;
 			final ArchivedExecutionGraph archivedExecutionGraph = archivedExecutionGraphStore.get(jobId);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			if (archivedExecutionGraph == null) &lt;/p&gt;
{
@@ -492,7 +509,7 @@ private JobManagerRunner createJobManagerRunner(JobGraph jobGraph) throws Except
 				return CompletableFuture.completedFuture(JobResult.createFrom(archivedExecutionGraph));
 			}
&lt;p&gt; 		} else &lt;/p&gt;
{
-			return jobManagerRunner.getResultFuture().thenApply(JobResult::createFrom);
+			return jobManagerRunnerFuture.thenCompose(JobManagerRunner::getResultFuture).thenApply(JobResult::createFrom);
 		}
&lt;p&gt; 	}&lt;/p&gt;

&lt;p&gt;@@ -566,11 +583,11 @@ private void registerJobManagerRunnerTerminationFuture(JobID jobId, CompletableF&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	private CompletableFuture&amp;lt;Void&amp;gt; removeJob(JobID jobId, boolean cleanupHA) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JobManagerRunner jobManagerRunner = jobManagerRunners.remove(jobId);&lt;br/&gt;
+		CompletableFuture&amp;lt;JobManagerRunner&amp;gt; jobManagerRunnerFuture = jobManagerRunnerFutures.remove(jobId);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		final CompletableFuture&amp;lt;Void&amp;gt; jobManagerRunnerTerminationFuture;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jobManagerRunner != null) {&lt;/li&gt;
	&lt;li&gt;jobManagerRunnerTerminationFuture = jobManagerRunner.closeAsync();&lt;br/&gt;
+		if (jobManagerRunnerFuture != null) 
{
+			jobManagerRunnerTerminationFuture = jobManagerRunnerFuture.thenCompose(JobManagerRunner::closeAsync);
 		}
&lt;p&gt; else &lt;/p&gt;
{
 			jobManagerRunnerTerminationFuture = CompletableFuture.completedFuture(null);
 		}
&lt;p&gt;@@ -616,7 +633,7 @@ private void cleanUpJobData(JobID jobId, boolean cleanupHA) {&lt;br/&gt;
 	private void terminateJobManagerRunners() {&lt;br/&gt;
 		log.info(&quot;Stopping all currently running jobs of dispatcher {}.&quot;, getAddress());&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final HashSet&amp;lt;JobID&amp;gt; jobsToRemove = new HashSet&amp;lt;&amp;gt;(jobManagerRunners.keySet());&lt;br/&gt;
+		final HashSet&amp;lt;JobID&amp;gt; jobsToRemove = new HashSet&amp;lt;&amp;gt;(jobManagerRunnerFutures.keySet());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		for (JobID jobId : jobsToRemove) {&lt;br/&gt;
 			removeJobAndRegisterTerminationFuture(jobId, false);&lt;br/&gt;
@@ -739,16 +756,16 @@ private void jobMasterFailed(JobID jobId, Throwable cause) {&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	private CompletableFuture&amp;lt;JobMasterGateway&amp;gt; getJobMasterGatewayFuture(JobID jobId) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final JobManagerRunner jobManagerRunner = jobManagerRunners.get(jobId);&lt;br/&gt;
+		final CompletableFuture&amp;lt;JobManagerRunner&amp;gt; jobManagerRunnerFuture = jobManagerRunnerFutures.get(jobId);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jobManagerRunner == null) {&lt;br/&gt;
+		if (jobManagerRunnerFuture == null) 
{
 			return FutureUtils.completedExceptionally(new FlinkJobNotFoundException(jobId));
 		}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;final CompletableFuture&amp;lt;JobMasterGateway&amp;gt; leaderGatewayFuture = jobManagerRunner.getLeaderGatewayFuture();&lt;br/&gt;
+			final CompletableFuture&amp;lt;JobMasterGateway&amp;gt; leaderGatewayFuture = jobManagerRunnerFuture.thenCompose(JobManagerRunner::getLeaderGatewayFuture);&lt;br/&gt;
 			return leaderGatewayFuture.thenApplyAsync(&lt;br/&gt;
 				(JobMasterGateway jobMasterGateway) -&amp;gt; {&lt;br/&gt;
 					// check whether the retrieved JobMasterGateway belongs still to a running JobMaster&lt;/li&gt;
	&lt;li&gt;if (jobManagerRunners.containsKey(jobId)) {&lt;br/&gt;
+					if (jobManagerRunnerFutures.containsKey(jobId)) 
{
 						return jobMasterGateway;
 					}
&lt;p&gt; else {&lt;br/&gt;
 						throw new CompletionException(new FlinkJobNotFoundException(jobId));&lt;br/&gt;
@@ -764,12 +781,12 @@ private void jobMasterFailed(JobID jobId, Throwable cause) {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Nonnull&lt;br/&gt;
 	private &amp;lt;T&amp;gt; List&amp;lt;CompletableFuture&amp;lt;Optional&amp;lt;T&amp;gt;&amp;gt;&amp;gt; queryJobMastersForInformation(Function&amp;lt;JobMasterGateway, CompletableFuture&amp;lt;T&amp;gt;&amp;gt; queryFunction) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int numberJobsRunning = jobManagerRunners.size();&lt;br/&gt;
+		final int numberJobsRunning = jobManagerRunnerFutures.size();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		ArrayList&amp;lt;CompletableFuture&amp;lt;Optional&amp;lt;T&amp;gt;&amp;gt;&amp;gt; optionalJobInformation = new ArrayList&amp;lt;&amp;gt;(&lt;br/&gt;
 			numberJobsRunning);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (JobID jobId : jobManagerRunners.keySet()) {&lt;br/&gt;
+		for (JobID jobId : jobManagerRunnerFutures.keySet()) {&lt;br/&gt;
 			final CompletableFuture&amp;lt;JobMasterGateway&amp;gt; jobMasterGatewayFuture = getJobMasterGatewayFuture(jobId);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			final CompletableFuture&amp;lt;Optional&amp;lt;T&amp;gt;&amp;gt; optionalRequest = jobMasterGatewayFuture&lt;br/&gt;
@@ -836,10 +853,10 @@ public void grantLeadership(final UUID newLeaderSessionID) {&lt;br/&gt;
 			log.debug(&quot;Dispatcher {} accepted leadership with fencing token {}. Start recovered jobs.&quot;, getAddress(), dispatcherId);&lt;br/&gt;
 			setNewFencingToken(dispatcherId);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Collection&amp;lt;CompletableFuture&amp;lt;Void&amp;gt;&amp;gt; runFutures = new ArrayList&amp;lt;&amp;gt;(recoveredJobs.size());&lt;br/&gt;
+			Collection&amp;lt;CompletableFuture&amp;lt;?&amp;gt;&amp;gt; runFutures = new ArrayList&amp;lt;&amp;gt;(recoveredJobs.size());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			for (JobGraph recoveredJob : recoveredJobs) &lt;/p&gt;
{
-				final CompletableFuture&amp;lt;Void&amp;gt; runFuture = waitForTerminatingJobManager(recoveredJob.getJobID(), recoveredJob, this::runJob);
+				final CompletableFuture&amp;lt;?&amp;gt; runFuture = waitForTerminatingJobManager(recoveredJob.getJobID(), recoveredJob, this::runJob);
 				runFutures.add(runFuture);
 			}

&lt;p&gt;@@ -850,7 +867,7 @@ public void grantLeadership(final UUID newLeaderSessionID) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private CompletableFuture&amp;lt;Void&amp;gt; waitForTerminatingJobManager(JobID jobId, JobGraph jobGraph, ThrowingConsumer&amp;lt;JobGraph, ?&amp;gt; action) {&lt;br/&gt;
+	private CompletableFuture&amp;lt;Void&amp;gt; waitForTerminatingJobManager(JobID jobId, JobGraph jobGraph, FunctionWithException&amp;lt;JobGraph, CompletableFuture&amp;lt;Void&amp;gt;, ?&amp;gt; action) {&lt;br/&gt;
 		final CompletableFuture&amp;lt;Void&amp;gt; jobManagerTerminationFuture = getJobTerminationFuture(jobId)&lt;br/&gt;
 			.exceptionally((Throwable throwable) -&amp;gt; {&lt;br/&gt;
 				throw new CompletionException(&lt;br/&gt;
@@ -858,16 +875,16 @@ public void grantLeadership(final UUID newLeaderSessionID) 
{
 						String.format(&quot;Termination of previous JobManager for job %s failed. Cannot submit job under the same job id.&quot;, jobId),
 						throwable)); }
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return jobManagerTerminationFuture.thenRunAsync(&lt;/li&gt;
	&lt;li&gt;ThrowingRunnable.unchecked(() -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+		return jobManagerTerminationFuture.thenComposeAsync(+			FunctionUtils.uncheckedFunction((ignored) -&amp;gt; {
 				jobManagerTerminationFutures.remove(jobId);
-				action.accept(jobGraph);
+				return action.apply(jobGraph);
 			}), 			getMainThreadExecutor()); 	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	CompletableFuture&amp;lt;Void&amp;gt; getJobTerminationFuture(JobID jobId) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jobManagerRunners.containsKey(jobId)) {&lt;br/&gt;
+		if (jobManagerRunnerFutures.containsKey(jobId)) 
{
 			return FutureUtils.completedExceptionally(new DispatcherException(String.format(&quot;Job with job id %s is still running.&quot;, jobId)));
 		}
&lt;p&gt; else {&lt;br/&gt;
 			return jobManagerTerminationFutures.getOrDefault(jobId, CompletableFuture.completedFuture(null));&lt;br/&gt;
@@ -923,7 +940,7 @@ public void handleError(final Exception exception) {&lt;br/&gt;
 	public void onAddedJobGraph(final JobID jobId) {&lt;br/&gt;
 		runAsync(&lt;br/&gt;
 			() -&amp;gt; {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (!jobManagerRunners.containsKey(jobId)) {&lt;br/&gt;
+				if (!jobManagerRunnerFutures.containsKey(jobId)) {&lt;br/&gt;
 					// IMPORTANT: onAddedJobGraph can generate false positives and, thus, we must expect that&lt;br/&gt;
 					// the specified job is already removed from the SubmittedJobGraphStore. In this case,&lt;br/&gt;
 					// SubmittedJobGraphStore.recoverJob returns null.&lt;br/&gt;
@@ -962,7 +979,7 @@ public void onAddedJobGraph(final JobID jobId) {&lt;br/&gt;
 	private CompletableFuture&amp;lt;Boolean&amp;gt; tryRunRecoveredJobGraph(JobGraph jobGraph, DispatcherId dispatcherId) throws Exception {&lt;br/&gt;
 		if (leaderElectionService.hasLeadership(dispatcherId.toUUID())) {&lt;br/&gt;
 			final JobID jobId = jobGraph.getJobID();&lt;/li&gt;
	&lt;li&gt;if (jobManagerRunners.containsKey(jobId)) {&lt;br/&gt;
+			if (jobManagerRunnerFutures.containsKey(jobId)) 
{
 				// we must not release the job graph lock since it can only be locked once and
 				// is currently being executed. Once we support multiple locks, we must release
 				// the JobGraph here
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherHATest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherHATest.java
index 335199a2807..c825451d946 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherHATest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherHATest.java
@@ -163,7 +163,7 @@ private HATestingDispatcher createHADispatcher(TestingHighAvailabilityServices h
 			UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup(),
 			null,
 			new MemoryArchivedExecutionGraphStore(),
-			new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;()),
+			new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;(), CompletableFuture.completedFuture(null)),
 			testingFatalErrorHandler,
 			fencingTokens);
 	}
&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherResourceCleanupTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherResourceCleanupTest.java&lt;br/&gt;
index d09ab8df728..5c4ac34a314 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherResourceCleanupTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherResourceCleanupTest.java&lt;br/&gt;
@@ -29,26 +29,19 @@&lt;br/&gt;
 import org.apache.flink.runtime.blob.PermanentBlobKey;&lt;br/&gt;
 import org.apache.flink.runtime.blob.TestingBlobStore;&lt;br/&gt;
 import org.apache.flink.runtime.blob.TestingBlobStoreBuilder;&lt;br/&gt;
-import org.apache.flink.runtime.clusterframework.types.ResourceID;&lt;br/&gt;
 import org.apache.flink.runtime.executiongraph.ArchivedExecutionGraph;&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
-import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.RunningJobsRegistry;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.TestingHighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
 import org.apache.flink.runtime.jobgraph.JobStatus;&lt;br/&gt;
 import org.apache.flink.runtime.jobgraph.JobVertex;&lt;br/&gt;
-import org.apache.flink.runtime.jobmaster.JobManagerRunner;&lt;br/&gt;
-import org.apache.flink.runtime.jobmaster.JobManagerSharedServices;&lt;br/&gt;
 import org.apache.flink.runtime.jobmaster.JobNotFinishedException;&lt;br/&gt;
-import org.apache.flink.runtime.jobmaster.factories.JobManagerJobMetricGroupFactory;&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.TestingLeaderElectionService;&lt;br/&gt;
 import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.utils.TestingResourceManagerGateway;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.legacy.utils.ArchivedExecutionGraphBuilder;&lt;br/&gt;
-import org.apache.flink.runtime.rpc.FatalErrorHandler;&lt;br/&gt;
-import org.apache.flink.runtime.rpc.RpcService;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.TestingRpcService;&lt;br/&gt;
 import org.apache.flink.runtime.testtasks.NoOpInvokable;&lt;br/&gt;
 import org.apache.flink.runtime.util.TestingFatalErrorHandler;&lt;br/&gt;
@@ -79,8 +72,6 @@&lt;br/&gt;
 import static org.hamcrest.Matchers.is;&lt;br/&gt;
 import static org.junit.Assert.assertThat;&lt;br/&gt;
 import static org.junit.Assert.fail;&lt;br/&gt;
-import static org.mockito.Mockito.mock;&lt;br/&gt;
-import static org.mockito.Mockito.when;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tests the resource cleanup by the 
{@link Dispatcher}.&lt;br/&gt;
@@ -188,7 +179,7 @@ public void setup() throws Exception {
 			UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup(),
 			null,
 			new MemoryArchivedExecutionGraphStore(),
-			new TestingJobManagerRunnerFactory(resultFuture, terminationFuture),
+			new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), resultFuture, terminationFuture),
 			fatalErrorHandler);
 
 		dispatcher.start();
@@ -447,28 +438,6 @@ public void testHABlobsAreRemovedIfHAJobGraphRemovalSucceeds() throws Exception
 		assertThat(deleteAllHABlobsFuture.get(), equalTo(jobId));
 	}&lt;br/&gt;
 &lt;br/&gt;
-	private static final class TestingJobManagerRunnerFactory implements Dispatcher.JobManagerRunnerFactory {&lt;br/&gt;
-&lt;br/&gt;
-		private final CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt; resultFuture;&lt;br/&gt;
-&lt;br/&gt;
-		private final CompletableFuture&amp;lt;Void&amp;gt; terminationFuture;&lt;br/&gt;
-&lt;br/&gt;
-		private TestingJobManagerRunnerFactory(CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt; resultFuture, CompletableFuture&amp;lt;Void&amp;gt; terminationFuture) {
-			this.resultFuture = resultFuture;
-			this.terminationFuture = terminationFuture;
-		}&lt;br/&gt;
-&lt;br/&gt;
-		@Override&lt;br/&gt;
-		public JobManagerRunner createJobManagerRunner(ResourceID resourceId, JobGraph jobGraph, Configuration configuration, RpcService rpcService, HighAvailabilityServices highAvailabilityServices, HeartbeatServices heartbeatServices, BlobServer blobServer, JobManagerSharedServices jobManagerServices, JobManagerJobMetricGroupFactory jobManagerJobMetricGroupFactory, FatalErrorHandler fatalErrorHandler) {
-			final JobManagerRunner jobManagerRunnerMock = mock(JobManagerRunner.class);
-
-			when(jobManagerRunnerMock.getResultFuture()).thenReturn(resultFuture);
-			when(jobManagerRunnerMock.closeAsync()).thenReturn(terminationFuture);
-
-			return jobManagerRunnerMock;
-		}&lt;br/&gt;
-	}&lt;br/&gt;
-&lt;br/&gt;
 	private static final class TestingBlobServer extends BlobServer {&lt;br/&gt;
 &lt;br/&gt;
 		private final CompletableFuture&amp;lt;JobID&amp;gt; cleanupJobFuture;&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java&lt;br/&gt;
index 1af10b8c598..24426761b2e 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;br/&gt;
 import org.apache.flink.api.common.time.Time;&lt;br/&gt;
 import org.apache.flink.configuration.BlobServerOptions;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.OneShotLatch;&lt;br/&gt;
 import org.apache.flink.runtime.blob.BlobServer;&lt;br/&gt;
 import org.apache.flink.runtime.blob.VoidBlobStore;&lt;br/&gt;
 import org.apache.flink.runtime.checkpoint.Checkpoints;&lt;br/&gt;
@@ -64,6 +65,7 @@&lt;br/&gt;
 import org.apache.flink.util.ExceptionUtils;&lt;br/&gt;
 import org.apache.flink.util.FlinkException;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;br/&gt;
+import org.apache.flink.util.function.ThrowingRunnable;&lt;br/&gt;
 &lt;br/&gt;
 import org.junit.After;&lt;br/&gt;
 import org.junit.AfterClass;&lt;br/&gt;
@@ -86,7 +88,9 @@&lt;br/&gt;
 import java.util.Collection;&lt;br/&gt;
 import java.util.Collections;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
+import java.util.Optional;&lt;br/&gt;
 import java.util.UUID;&lt;br/&gt;
+import java.util.concurrent.ArrayBlockingQueue;&lt;br/&gt;
 import java.util.concurrent.CompletableFuture;&lt;br/&gt;
 import java.util.concurrent.CountDownLatch;&lt;br/&gt;
 import java.util.concurrent.ExecutionException;&lt;br/&gt;
@@ -144,6 +148,10 @@&lt;br/&gt;
 	/** Instance under test. */&lt;br/&gt;
 	private TestingDispatcher dispatcher;&lt;br/&gt;
 &lt;br/&gt;
+	private TestingHighAvailabilityServices haServices;&lt;br/&gt;
+&lt;br/&gt;
+	private HeartbeatServices heartbeatServices;&lt;br/&gt;
+&lt;br/&gt;
 	@BeforeClass&lt;br/&gt;
 	public static void setupClass() {&lt;br/&gt;
 		rpcService = new TestingRpcService();&lt;br/&gt;
@@ -166,13 +174,13 @@ public void setUp() throws Exception {&lt;br/&gt;
 		jobGraph.setAllowQueuedScheduling(true);&lt;br/&gt;
 &lt;br/&gt;
 		fatalErrorHandler = new TestingFatalErrorHandler();&lt;br/&gt;
-		final HeartbeatServices heartbeatServices = new HeartbeatServices(1000L, 10000L);&lt;br/&gt;
+		heartbeatServices = new HeartbeatServices(1000L, 10000L);&lt;br/&gt;
 		submittedJobGraphStore = new FaultySubmittedJobGraphStore();&lt;br/&gt;
 &lt;br/&gt;
 		dispatcherLeaderElectionService = new TestingLeaderElectionService();&lt;br/&gt;
 		jobMasterLeaderElectionService = new TestingLeaderElectionService();&lt;br/&gt;
 &lt;br/&gt;
-		final TestingHighAvailabilityServices haServices = new TestingHighAvailabilityServices();&lt;br/&gt;
+		haServices = new TestingHighAvailabilityServices();&lt;br/&gt;
 		haServices.setDispatcherLeaderElectionService(dispatcherLeaderElectionService);&lt;br/&gt;
 		haServices.setSubmittedJobGraphStore(submittedJobGraphStore);&lt;br/&gt;
 		haServices.setJobMasterLeaderElectionService(TEST_JOB_ID, jobMasterLeaderElectionService);&lt;br/&gt;
@@ -188,14 +196,18 @@ public void setUp() throws Exception {
 
 		createdJobManagerRunnerLatch = new CountDownLatch(2);
 		blobServer = new BlobServer(configuration, new VoidBlobStore());
+	}&lt;br/&gt;
 &lt;br/&gt;
-		dispatcher = createDispatcher(heartbeatServices, haServices);&lt;br/&gt;
-&lt;br/&gt;
+	@Nonnull&lt;br/&gt;
+	private TestingDispatcher createAndStartDispatcher(HeartbeatServices heartbeatServices, TestingHighAvailabilityServices haServices, Dispatcher.JobManagerRunnerFactory jobManagerRunnerFactory) throws Exception {
+		final TestingDispatcher dispatcher = createDispatcher(heartbeatServices, haServices, jobManagerRunnerFactory);
 		dispatcher.start();
+
+		return dispatcher;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	@Nonnull&lt;br/&gt;
-	private TestingDispatcher createDispatcher(HeartbeatServices heartbeatServices, TestingHighAvailabilityServices haServices) throws Exception {&lt;br/&gt;
+	private TestingDispatcher createDispatcher(HeartbeatServices heartbeatServices, TestingHighAvailabilityServices haServices, Dispatcher.JobManagerRunnerFactory jobManagerRunnerFactory) throws Exception {
 		return new TestingDispatcher(
 			rpcService,
 			Dispatcher.DISPATCHER_NAME + &apos;_&apos; + name.getMethodName(),
@@ -207,7 +219,7 @@ private TestingDispatcher createDispatcher(HeartbeatServices heartbeatServices,
 			UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup(),
 			null,
 			new MemoryArchivedExecutionGraphStore(),
-			new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch),
+			jobManagerRunnerFactory,
 			fatalErrorHandler);
 	}&lt;br/&gt;
 &lt;br/&gt;
@@ -216,7 +228,13 @@ public void tearDown() throws Exception {&lt;br/&gt;
 		try {
 			fatalErrorHandler.rethrowError();
 		} finally {&lt;br/&gt;
-			RpcUtils.terminateRpcEndpoint(dispatcher, TIMEOUT);&lt;br/&gt;
+			if (dispatcher != null) {
+				RpcUtils.terminateRpcEndpoint(dispatcher, TIMEOUT);
+			}&lt;br/&gt;
+		}&lt;br/&gt;
+&lt;br/&gt;
+		if (haServices != null) {
+			haServices.closeAndCleanupAllData();
 		}&lt;br/&gt;
 &lt;br/&gt;
 		if (blobServer != null) {&lt;br/&gt;
@@ -230,6 +248,8 @@ public void tearDown() throws Exception {&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testJobSubmission() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		CompletableFuture&amp;lt;UUID&amp;gt; leaderFuture = dispatcherLeaderElectionService.isLeader(UUID.randomUUID());&lt;br/&gt;
 &lt;br/&gt;
 		// wait for the leader to be elected&lt;br/&gt;
@@ -251,6 +271,8 @@ public void testJobSubmission() throws Exception {&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testLeaderElection() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		CompletableFuture&amp;lt;Void&amp;gt; jobIdsFuture = new CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;
 		submittedJobGraphStore.setJobIdsFunction(&lt;br/&gt;
 			(Collection&amp;lt;JobID&amp;gt; jobIds) -&amp;gt; {&lt;br/&gt;
@@ -270,6 +292,8 @@ public void testLeaderElection() throws Exception {&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testSubmittedJobGraphListener() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
 &lt;br/&gt;
 		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
@@ -294,6 +318,8 @@ public void testSubmittedJobGraphListener() throws Exception {&lt;br/&gt;
 &lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testOnAddedJobGraphRecoveryFailure() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final FlinkException expectedFailure = new FlinkException(&quot;Expected failure&quot;);&lt;br/&gt;
 		submittedJobGraphStore.setRecoveryFailure(expectedFailure);&lt;br/&gt;
 &lt;br/&gt;
@@ -313,6 +339,8 @@ public void testOnAddedJobGraphRecoveryFailure() throws Exception {&lt;br/&gt;
 &lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testOnAddedJobGraphWithFinishedJob() throws Throwable {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
 &lt;br/&gt;
 		submittedJobGraphStore.putJobGraph(new SubmittedJobGraph(jobGraph, null));&lt;br/&gt;
@@ -333,6 +361,8 @@ public void testOnAddedJobGraphWithFinishedJob() throws Throwable {&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testCacheJobExecutionResult() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
 &lt;br/&gt;
 		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
@@ -358,6 +388,8 @@ public void testCacheJobExecutionResult() throws Exception {&lt;br/&gt;
 &lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testThrowExceptionIfJobExecutionResultNotFound() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
 &lt;br/&gt;
 		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
@@ -374,6 +406,8 @@ public void testThrowExceptionIfJobExecutionResultNotFound() throws Exception {&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testJobRecovery() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
 &lt;br/&gt;
 		// elect the initial dispatcher as the leader&lt;br/&gt;
@@ -413,6 +447,8 @@ public void testSavepointDisposal() throws Exception {&lt;br/&gt;
 		final URI externalPointer = createTestingSavepoint();&lt;br/&gt;
 		final Path savepointPath = Paths.get(externalPointer);&lt;br/&gt;
 &lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
 &lt;br/&gt;
 		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
@@ -447,7 +483,9 @@ private URI createTestingSavepoint() throws IOException, URISyntaxException {&lt;br/&gt;
 	 * to it. See &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8887&quot; title=&quot;ClusterClient.getJobStatus can throw FencingTokenException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8887&quot;&gt;&lt;del&gt;FLINK-8887&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
-	public void testWaitingForJobMasterLeadership() throws ExecutionException, InterruptedException {&lt;br/&gt;
+	public void testWaitingForJobMasterLeadership() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
 &lt;br/&gt;
 		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
@@ -476,6 +514,8 @@ public void testWaitingForJobMasterLeadership() throws ExecutionException, Inter&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testFatalErrorAfterJobIdRecoveryFailure() throws Exception {&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final FlinkException testException = new FlinkException(&quot;Test exception&quot;);&lt;br/&gt;
 		submittedJobGraphStore.setJobIdsFunction(&lt;br/&gt;
 			(Collection&amp;lt;JobID&amp;gt; jobIds) -&amp;gt; {&lt;br/&gt;
@@ -500,6 +540,8 @@ public void testFatalErrorAfterJobIdRecoveryFailure() throws Exception {&lt;br/&gt;
 	public void testFatalErrorAfterJobRecoveryFailure() throws Exception {&lt;br/&gt;
 		final FlinkException testException = new FlinkException(&quot;Test exception&quot;);&lt;br/&gt;
 &lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final SubmittedJobGraph submittedJobGraph = new SubmittedJobGraph(jobGraph, null);&lt;br/&gt;
 		submittedJobGraphStore.putJobGraph(submittedJobGraph);&lt;br/&gt;
 &lt;br/&gt;
@@ -526,6 +568,8 @@ public void testFatalErrorAfterJobRecoveryFailure() throws Exception {&lt;br/&gt;
 	public void testJobSubmissionErrorAfterJobRecovery() throws Exception {&lt;br/&gt;
 		final FlinkException testException = new FlinkException(&quot;Test exception&quot;);&lt;br/&gt;
 &lt;br/&gt;
+		dispatcher = createAndStartDispatcher(heartbeatServices, haServices, new ExpectedJobIdJobManagerRunnerFactory(TEST_JOB_ID, createdJobManagerRunnerLatch));&lt;br/&gt;
+&lt;br/&gt;
 		final JobGraph failingJobGraph = createFailingJobGraph(testException);&lt;br/&gt;
 &lt;br/&gt;
 		final SubmittedJobGraph submittedJobGraph = new SubmittedJobGraph(failingJobGraph, null);&lt;br/&gt;
@@ -540,6 +584,102 @@ public void testJobSubmissionErrorAfterJobRecovery() throws Exception {
 		fatalErrorHandler.clearError();
 	}&lt;br/&gt;
 &lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Tests that a blocking {@link JobManagerRunner} creation, e.g. due to blocking FileSystem access,&lt;br/&gt;
+	 * does not block the {@link Dispatcher}
&lt;p&gt;.&lt;br/&gt;
+	 *&lt;br/&gt;
+	 * &amp;lt;p&amp;gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10314&quot; title=&quot;Blocking calls in Execution Graph creation bring down cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10314&quot;&gt;&lt;del&gt;FLINK-10314&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testBlockingJobManagerRunner() throws Exception &lt;/p&gt;
{
+		final OneShotLatch jobManagerRunnerCreationLatch = new OneShotLatch();
+		dispatcher = createAndStartDispatcher(
+			heartbeatServices,
+			haServices,
+			new BlockingJobManagerRunnerFactory(jobManagerRunnerCreationLatch::await));
+
+		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();
+
+		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);
+
+		final CompletableFuture&amp;lt;Acknowledge&amp;gt; submissionFuture = dispatcherGateway.submitJob(jobGraph, TIMEOUT);
+
+		assertThat(submissionFuture.isDone(), is(false));
+
+		final CompletableFuture&amp;lt;Collection&amp;lt;String&amp;gt;&amp;gt; metricQueryServicePathsFuture = dispatcherGateway.requestMetricQueryServicePaths(Time.seconds(5L));
+
+		assertThat(metricQueryServicePathsFuture.get(), is(empty()));
+
+		assertThat(submissionFuture.isDone(), is(false));
+
+		jobManagerRunnerCreationLatch.trigger();
+
+		submissionFuture.get();
+	}
&lt;p&gt;+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Tests that a failing &lt;/p&gt;
{@link JobManagerRunner}
&lt;p&gt; will be properly cleaned up.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testFailingJobManagerRunnerCleanup() throws Exception {&lt;br/&gt;
+		final FlinkException testException = new FlinkException(&quot;Test exception.&quot;);&lt;br/&gt;
+		final ArrayBlockingQueue&amp;lt;Optional&amp;lt;Exception&amp;gt;&amp;gt; queue = new ArrayBlockingQueue&amp;lt;&amp;gt;(2);&lt;br/&gt;
+&lt;br/&gt;
+		dispatcher = createAndStartDispatcher(&lt;br/&gt;
+			heartbeatServices,&lt;br/&gt;
+			haServices,&lt;br/&gt;
+			new BlockingJobManagerRunnerFactory(() -&amp;gt; &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+				final Optional&amp;lt;Exception&amp;gt; take = queue.take();+				final Exception exception = take.orElse(null);++				if (exception != null) {
+					throw exception;
+				}+			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;));&lt;br/&gt;
+&lt;br/&gt;
+		dispatcherLeaderElectionService.isLeader(UUID.randomUUID()).get();&lt;br/&gt;
+&lt;br/&gt;
+		final DispatcherGateway dispatcherGateway = dispatcher.getSelfGateway(DispatcherGateway.class);&lt;br/&gt;
+&lt;br/&gt;
+		CompletableFuture&amp;lt;Acknowledge&amp;gt; submissionFuture = dispatcherGateway.submitJob(jobGraph, TIMEOUT);&lt;br/&gt;
+&lt;br/&gt;
+		assertThat(submissionFuture.isDone(), is(false));&lt;br/&gt;
+&lt;br/&gt;
+		queue.offer(Optional.of(testException));&lt;br/&gt;
+&lt;br/&gt;
+		try &lt;/p&gt;
{
+			submissionFuture.get();
+			fail(&quot;Should fail because we could not instantiate the JobManagerRunner.&quot;);
+		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
+			assertThat(ExceptionUtils.findThrowable(e, t -&amp;gt; t.equals(testException)).isPresent(), is(true));
+		}
&lt;p&gt;+&lt;br/&gt;
+		submissionFuture = dispatcherGateway.submitJob(jobGraph, TIMEOUT);&lt;br/&gt;
+&lt;br/&gt;
+		queue.offer(Optional.empty());&lt;br/&gt;
+&lt;br/&gt;
+		submissionFuture.get();&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private final class BlockingJobManagerRunnerFactory extends TestingJobManagerRunnerFactory &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {++		@Nonnull+		private final ThrowingRunnable&amp;lt;Exception&amp;gt; jobManagerRunnerCreationLatch;++		BlockingJobManagerRunnerFactory(@Nonnull ThrowingRunnable&amp;lt;Exception&amp;gt; jobManagerRunnerCreationLatch) {
+			super(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;(), CompletableFuture.completedFuture(null));
+
+			this.jobManagerRunnerCreationLatch = jobManagerRunnerCreationLatch;
+		}++		@Override+		public JobManagerRunner createJobManagerRunner(ResourceID resourceId, JobGraph jobGraph, Configuration configuration, RpcService rpcService, HighAvailabilityServices highAvailabilityServices, HeartbeatServices heartbeatServices, BlobServer blobServer, JobManagerSharedServices jobManagerSharedServices, JobManagerJobMetricGroupFactory jobManagerJobMetricGroupFactory, FatalErrorHandler fatalErrorHandler) throws Exception {
+			jobManagerRunnerCreationLatch.run();
+
+			return super.createJobManagerRunner(resourceId, jobGraph, configuration, rpcService, highAvailabilityServices, heartbeatServices, blobServer, jobManagerSharedServices, jobManagerJobMetricGroupFactory, fatalErrorHandler);
+		}+	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
 	private void electDispatcher() {&lt;br/&gt;
 		UUID expectedLeaderSessionId = UUID.randomUUID();&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/MiniDispatcherTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/MiniDispatcherTest.java&lt;br/&gt;
index 39c06f36ecf..eed23ed7179 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/MiniDispatcherTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/MiniDispatcherTest.java&lt;br/&gt;
@@ -125,7 +125,7 @@ public void setup() throws Exception &lt;/p&gt;
{
 		jobGraphFuture = new CompletableFuture&amp;lt;&amp;gt;();
 		resultFuture = new CompletableFuture&amp;lt;&amp;gt;();
 
-		testingJobManagerRunnerFactory = new TestingJobManagerRunnerFactory(jobGraphFuture, resultFuture);
+		testingJobManagerRunnerFactory = new TestingJobManagerRunnerFactory(jobGraphFuture, resultFuture, CompletableFuture.completedFuture(null));
 	}

&lt;p&gt; 	@After&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/TestingJobManagerRunnerFactory.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/TestingJobManagerRunnerFactory.java&lt;br/&gt;
index f9be8883589..992f08713c6 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/TestingJobManagerRunnerFactory.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/TestingJobManagerRunnerFactory.java&lt;br/&gt;
@@ -40,14 +40,16 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;{@link org.apache.flink.runtime.dispatcher.Dispatcher.JobManagerRunnerFactory}
&lt;p&gt; implementation for&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;testing purposes.&lt;br/&gt;
  */&lt;br/&gt;
-final class TestingJobManagerRunnerFactory implements Dispatcher.JobManagerRunnerFactory {&lt;br/&gt;
+class TestingJobManagerRunnerFactory implements Dispatcher.JobManagerRunnerFactory {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final CompletableFuture&amp;lt;JobGraph&amp;gt; jobGraphFuture;&lt;br/&gt;
 	private final CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt; resultFuture;&lt;br/&gt;
+	private final CompletableFuture&amp;lt;Void&amp;gt; terminationFuture;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TestingJobManagerRunnerFactory(CompletableFuture&amp;lt;JobGraph&amp;gt; jobGraphFuture, CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt; resultFuture) {&lt;br/&gt;
+	TestingJobManagerRunnerFactory(CompletableFuture&amp;lt;JobGraph&amp;gt; jobGraphFuture, CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt; resultFuture, CompletableFuture&amp;lt;Void&amp;gt; terminationFuture) 
{
 		this.jobGraphFuture = jobGraphFuture;
 		this.resultFuture = resultFuture;
+		this.terminationFuture = terminationFuture;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
@@ -66,7 +68,8 @@ public JobManagerRunner createJobManagerRunner(&lt;/p&gt;

&lt;p&gt; 		final JobManagerRunner mock = mock(JobManagerRunner.class);&lt;br/&gt;
 		when(mock.getResultFuture()).thenReturn(resultFuture);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;when(mock.closeAsync()).thenReturn(CompletableFuture.completedFuture(null));&lt;br/&gt;
+		when(mock.closeAsync()).thenReturn(terminationFuture);&lt;br/&gt;
+		when(mock.getJobGraph()).thenReturn(jobGraph);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		return mock;&lt;br/&gt;
 	}&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/ZooKeeperHADispatcherTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/ZooKeeperHADispatcherTest.java&lt;br/&gt;
index b5662c064e8..9c23f9d7aa2 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/ZooKeeperHADispatcherTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/ZooKeeperHADispatcherTest.java&lt;br/&gt;
@@ -154,7 +154,7 @@ public void testSubmittedJobGraphRelease() throws Exception {&lt;/p&gt;

&lt;p&gt; 			final TestingDispatcher dispatcher = createDispatcher(&lt;br/&gt;
 				testingHighAvailabilityServices,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;()));&lt;br/&gt;
+				new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;(), CompletableFuture.completedFuture(null)));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			dispatcher.start();&lt;/p&gt;

&lt;p&gt;@@ -223,11 +223,11 @@ public void testStandbyDispatcherJobExecution() throws Exception {&lt;br/&gt;
 			final CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt; resultFuture = new CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;
 			final TestingDispatcher dispatcher1 = createDispatcher(&lt;br/&gt;
 				haServices1,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new TestingJobManagerRunnerFactory(jobGraphFuture, resultFuture));&lt;br/&gt;
+				new TestingJobManagerRunnerFactory(jobGraphFuture, resultFuture, CompletableFuture.completedFuture(null)));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			final TestingDispatcher dispatcher2 = createDispatcher(&lt;br/&gt;
 				haServices2,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;()));&lt;br/&gt;
+				new TestingJobManagerRunnerFactory(new CompletableFuture&amp;lt;&amp;gt;(), new CompletableFuture&amp;lt;&amp;gt;(), CompletableFuture.completedFuture(null)));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			try {&lt;br/&gt;
 				dispatcher1.start();&lt;br/&gt;
@@ -285,11 +285,11 @@ public void testStandbyDispatcherJobRecovery() throws Exception {&lt;br/&gt;
 				final CompletableFuture&amp;lt;JobGraph&amp;gt; jobGraphFuture1 = new CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;
 				dispatcher1 = createDispatcher(&lt;br/&gt;
 					haServices,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new TestingJobManagerRunnerFactory(jobGraphFuture1, new CompletableFuture&amp;lt;&amp;gt;()));&lt;br/&gt;
+					new TestingJobManagerRunnerFactory(jobGraphFuture1, new CompletableFuture&amp;lt;&amp;gt;(), CompletableFuture.completedFuture(null)));&lt;br/&gt;
 				final CompletableFuture&amp;lt;JobGraph&amp;gt; jobGraphFuture2 = new CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;
 				dispatcher2 = createDispatcher(&lt;br/&gt;
 					haServices,&lt;/li&gt;
	&lt;li&gt;new TestingJobManagerRunnerFactory(jobGraphFuture2, new CompletableFuture&amp;lt;&amp;gt;()));&lt;br/&gt;
+					new TestingJobManagerRunnerFactory(jobGraphFuture2, new CompletableFuture&amp;lt;&amp;gt;(), CompletableFuture.completedFuture(null)));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				dispatcher1.start();&lt;br/&gt;
 				dispatcher2.start();&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/utils/TestingResourceManagerGateway.java b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/utils/TestingResourceManagerGateway.java&lt;br/&gt;
index c38ea5d99c0..950a4e13674 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/utils/TestingResourceManagerGateway.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/utils/TestingResourceManagerGateway.java&lt;br/&gt;
@@ -298,7 +298,7 @@ public void disconnectJobManager(JobID jobId, Exception cause) {&lt;/p&gt;

&lt;p&gt; 	@Override&lt;br/&gt;
 	public CompletableFuture&amp;lt;ResourceOverview&amp;gt; requestResourceOverview(Time timeout) &lt;/p&gt;
{
-		return FutureUtils.completedExceptionally(new UnsupportedOperationException(&quot;Not yet implemented&quot;));
+		return CompletableFuture.completedFuture(new ResourceOverview(1, 1, 1));
 	}

&lt;p&gt; 	@Override&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16615449" author="till.rohrmann" created="Fri, 14 Sep 2018 22:04:44 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
1.7.0: 199f1758e9bdbdc316ec7168791a8e95373159a6&lt;br/&gt;
1.6.1: 6002945cef7c041f9742b860f3243dba263807ac&lt;br/&gt;
1.5.4: d092fd75ee89043bac4c004acd1acf3082c9daf1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xwg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>