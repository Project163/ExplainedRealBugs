<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-37605] SinkWriter may incorrectly infer end of input during rescale</title>
                <link>https://issues.apache.org/jira/browse/FLINK-37605</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-25920&quot; title=&quot;Allow receiving updates of CommittableSummary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-25920&quot;&gt;&lt;del&gt;FLINK-25920&lt;/del&gt;&lt;/a&gt; introduced an EOI check that uses state to ensure that no data is lost after fail over during final checkpoint. The respective error message reads&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Received element after endOfInput: ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, the check is too strict and can trigger in other occasions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Consider a simple pipeline DataGeneratorSource -&amp;gt; Sink&lt;/li&gt;
	&lt;li&gt;Start run with parallelism 3, the source generates 3 splits&lt;/li&gt;
	&lt;li&gt;Checkpoint 1&lt;/li&gt;
	&lt;li&gt;Upscale to 5, the source still only has 3 splits, subtask 4, 5 finish&lt;/li&gt;
	&lt;li&gt;EOI arrives sink subtask 4, 5&lt;/li&gt;
	&lt;li&gt;Checkpoint 2 includes EOI for those subtasks&lt;/li&gt;
	&lt;li&gt;Downscale back to 3&lt;/li&gt;
	&lt;li&gt;All source subtasks have active splits&lt;/li&gt;
	&lt;li&gt;Sink subtasks get the following EOI states 1=&lt;span class=&quot;error&quot;&gt;&amp;#91;false, false&amp;#93;&lt;/span&gt;, 2=&lt;span class=&quot;error&quot;&gt;&amp;#91;false, true&amp;#93;&lt;/span&gt;, 3=&lt;span class=&quot;error&quot;&gt;&amp;#91;true&amp;#93;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;So sink 3 assumes that it doesn&apos;t receive any more input and fails the assertion&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The assertion is not salvageable and we need to get rid of it entirely. The sink needs to deal with &quot;duplicate&quot; EOIs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The writer will simply emit duplicate EOI committables/summary&lt;/li&gt;
	&lt;li&gt;The committer needs to merge them. It already does since &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-25920&quot; title=&quot;Allow receiving updates of CommittableSummary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-25920&quot;&gt;&lt;del&gt;FLINK-25920&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13614005">FLINK-37605</key>
            <summary>SinkWriter may incorrectly infer end of input during rescale</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arvid">Arvid Heise</assignee>
                                    <reporter username="arvid">Arvid Heise</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 2 Apr 2025 20:18:13 +0000</created>
                <updated>Wed, 17 Sep 2025 08:54:19 +0000</updated>
                            <resolved>Tue, 29 Apr 2025 13:14:43 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.19.2</version>
                    <version>1.20.1</version>
                                    <fixVersion>1.19.3</fixVersion>
                    <fixVersion>1.20.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                                    <component>API / Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17940559" author="arvid" created="Thu, 3 Apr 2025 06:36:25 +0000"  >&lt;p&gt;On a second look, there is a deeper issue buried (that&apos;s why added the assertion in the first place): What is the interaction between committables generated during EOI and those that follow afterwards? Specifically how does it interact with the checkpoint subsumption contract?&lt;/p&gt;

&lt;p&gt;Picking up the example from above. Let&apos;s assume that subtask 4, 5 emit data before sending EOI for some reason (unbalanced splits?). We are running exactly once, so each checkpoint has a unique transaction per subtask, which is forwarded to the committer.&lt;/p&gt;

&lt;p&gt;Then on checkpoint 1, we simple have 3 transactions being forwarded to the committer; one for each subtask. These need to be remembered by checkpoint id so for committer subtask X, we have the committer state committables={1=&lt;span class=&quot;error&quot;&gt;&amp;#91;transaction-X&amp;#93;&lt;/span&gt;}.&lt;/p&gt;

&lt;p&gt;On upscaling during recovery, we are recommitting all of those so the committer states will be {}.&lt;/p&gt;

&lt;p&gt;Now on EOI, we are already forwarding committables of subtask 4, 5, such that the committer state is committables={EOI=&lt;span class=&quot;error&quot;&gt;&amp;#91;transaction-X&amp;#93;&lt;/span&gt;} for subtask 4, 5.&lt;/p&gt;

&lt;p&gt;On checkpoint 2, subtask 1,2,3 result in committables={2=&lt;span class=&quot;error&quot;&gt;&amp;#91;transaction-X&amp;#93;&lt;/span&gt;}&lt;/p&gt;

&lt;p&gt;On downscaling during recovery, states are folded such that subtask 2 will have committables={2=&lt;span class=&quot;error&quot;&gt;&amp;#91;transaction-3&amp;#93;&lt;/span&gt;, EOI=&lt;span class=&quot;error&quot;&gt;&amp;#91;transaction-4&amp;#93;&lt;/span&gt;}. We are recommiting everything resulting in committer state {}.&lt;/p&gt;

&lt;p&gt;For checkpoint 3, subtask 2 would have a new state committables={3=&lt;span class=&quot;error&quot;&gt;&amp;#91;transaction-2&amp;#93;&lt;/span&gt;}.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So I guess it kinda works because we are sure to recommit everything before accepting new committables in recovery. So we will never have the situation where a committable of checkpoint Y comes after EOI committable.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17944398" author="arvid" created="Mon, 14 Apr 2025 15:48:55 +0000"  >&lt;p&gt;Merged into master as 3342c231a2877f48540322f577527ec8bb765b08..93025452714570a4d461519510375dd72af3a2c0.&lt;/p&gt;</comment>
                            <comment id="17945173" author="arvid" created="Wed, 16 Apr 2025 21:40:13 +0000"  >&lt;p&gt;Merged into 2.0 as bf77238ea0ec918e01d19ada2ee8ead818356e4d..645a0734b33b159a6169cb12c49194aefb9b017f.&lt;/p&gt;</comment>
                            <comment id="17948160" author="arvid" created="Tue, 29 Apr 2025 13:01:35 +0000"  >&lt;p&gt;Merged into 1.20 as 0b6da412cc33b25f9f1ab812c0b1dc77e8329f99..044ad25150143bdaf6e8070ccbb5f655ad0564fd.&lt;/p&gt;</comment>
                            <comment id="17948164" author="arvid" created="Tue, 29 Apr 2025 13:14:28 +0000"  >&lt;p&gt;Merged into 1.19 as f869ae8e7ccd2d257f7cb5b2d2e0d32136359ed3..ad4857e49b35c756c8a800a13fc74f8770381d1b.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13629139">FLINK-38370</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1v5c0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>