<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20798] Using PVC as high-availability.storageDir could not work</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20798</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>
&lt;p&gt;When deploying standalone Flink on Kubernetes and configure the &lt;tt&gt;high-availability.storageDir&lt;/tt&gt; to a mounted PVC directory, the Flink webui could not be visited normally. It shows that &quot;Service temporarily unavailable due to an ongoing leader election. Please refresh&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;


&lt;p&gt;The following is related logs from JobManager.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-12-29T06:45:54.177850394Z 2020-12-29 14:45:54,177 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Leader election started
 2020-12-29T06:45:54.177855303Z 2020-12-29 14:45:54,177 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Attempting to acquire leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-resourcemanager-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;...
 2020-12-29T06:45:54.178668055Z 2020-12-29 14:45:54,178 DEBUG io.fabric8.kubernetes.client.dsl.internal.WatchConnectionManager [] - WebSocket successfully opened
 2020-12-29T06:45:54.178895963Z 2020-12-29 14:45:54,178 INFO org.apache.flink.runtime.leaderretrieval.DefaultLeaderRetrievalService [] - Starting DefaultLeaderRetrievalService with KubernetesLeaderRetrievalDriver\{configMapName=&lt;span class=&quot;code-quote&quot;&gt;&apos;mta-flink-resourcemanager-leader&apos;&lt;/span&gt;}.
 2020-12-29T06:45:54.179327491Z 2020-12-29 14:45:54,179 DEBUG io.fabric8.kubernetes.client.dsl.internal.WatchConnectionManager [] - Connecting websocket ... io.fabric8.kubernetes.client.dsl.internal.WatchConnectionManager@6d303498
 2020-12-29T06:45:54.230081993Z 2020-12-29 14:45:54,229 DEBUG io.fabric8.kubernetes.client.dsl.internal.WatchConnectionManager [] - WebSocket successfully opened
 2020-12-29T06:45:54.230202329Z 2020-12-29 14:45:54,230 INFO org.apache.flink.runtime.leaderretrieval.DefaultLeaderRetrievalService [] - Starting DefaultLeaderRetrievalService with KubernetesLeaderRetrievalDriver\{configMapName=&lt;span class=&quot;code-quote&quot;&gt;&apos;mta-flink-dispatcher-leader&apos;&lt;/span&gt;}.
 2020-12-29T06:45:54.230219281Z 2020-12-29 14:45:54,229 DEBUG io.fabric8.kubernetes.client.dsl.internal.WatchConnectionManager [] - WebSocket successfully opened
 2020-12-29T06:45:54.230353912Z 2020-12-29 14:45:54,230 INFO org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Starting DefaultLeaderElectionService with KubernetesLeaderElectionDriver\{configMapName=&lt;span class=&quot;code-quote&quot;&gt;&apos;mta-flink-resourcemanager-leader&apos;&lt;/span&gt;}.
 2020-12-29T06:45:54.237004177Z 2020-12-29 14:45:54,236 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Leader changed from &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; to 6f6479c6-86cc-4d62-84f9-37ff968bd0e5
 2020-12-29T06:45:54.237024655Z 2020-12-29 14:45:54,236 INFO org.apache.flink.kubernetes.kubeclient.resources.KubernetesLeaderElector [] - New leader elected 6f6479c6-86cc-4d62-84f9-37ff968bd0e5 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; mta-flink-restserver-leader.
 2020-12-29T06:45:54.237027811Z 2020-12-29 14:45:54,236 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Successfully Acquired leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-restserver-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;
 2020-12-29T06:45:54.237297376Z 2020-12-29 14:45:54,237 DEBUG org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Grant leadership to contender [http:&lt;span class=&quot;code-comment&quot;&gt;//mta-flink-jobmanager:8081|http://mta-flink-jobmanager:8081/] with session ID 9587e13f-322f-4cd5-9fff-b4941462be0f.
&lt;/span&gt; 2020-12-29T06:45:54.237353551Z 2020-12-29 14:45:54,237 INFO org.apache.flink.runtime.dispatcher.DispatcherRestEndpoint [] - [http:&lt;span class=&quot;code-comment&quot;&gt;//mta-flink-jobmanager:8081|http://mta-flink-jobmanager:8081/] was granted leadership with leaderSessionID=9587e13f-322f-4cd5-9fff-b4941462be0f
&lt;/span&gt; 2020-12-29T06:45:54.237440354Z 2020-12-29 14:45:54,237 DEBUG org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Confirm leader session ID 9587e13f-322f-4cd5-9fff-b4941462be0f &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; leader [http:&lt;span class=&quot;code-comment&quot;&gt;//mta-flink-jobmanager:8081|http://mta-flink-jobmanager:8081/].
&lt;/span&gt; 2020-12-29T06:45:54.254555127Z 2020-12-29 14:45:54,254 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Leader changed from &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; to 6f6479c6-86cc-4d62-84f9-37ff968bd0e5
 2020-12-29T06:45:54.254588299Z 2020-12-29 14:45:54,254 INFO org.apache.flink.kubernetes.kubeclient.resources.KubernetesLeaderElector [] - New leader elected 6f6479c6-86cc-4d62-84f9-37ff968bd0e5 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; mta-flink-resourcemanager-leader.
 2020-12-29T06:45:54.254628053Z 2020-12-29 14:45:54,254 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Successfully Acquired leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-resourcemanager-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;
 2020-12-29T06:45:54.254871569Z 2020-12-29 14:45:54,254 DEBUG org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Grant leadership to contender LeaderContender: StandaloneResourceManager with session ID b1730dc6-0f94-49f4-b519-56917f3027b7.
 2020-12-29T06:45:54.256608291Z 2020-12-29 14:45:54,256 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Attempting to renew leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-resourcemanager-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;...
 2020-12-29T06:45:54.259155793Z 2020-12-29 14:45:54,258 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Leader changed from &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; to 6f6479c6-86cc-4d62-84f9-37ff968bd0e5
 2020-12-29T06:45:54.259176091Z 2020-12-29 14:45:54,258 INFO org.apache.flink.kubernetes.kubeclient.resources.KubernetesLeaderElector [] - New leader elected 6f6479c6-86cc-4d62-84f9-37ff968bd0e5 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; mta-flink-dispatcher-leader.
 2020-12-29T06:45:54.25918096Z 2020-12-29 14:45:54,259 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Successfully Acquired leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-dispatcher-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;
 2020-12-29T06:45:54.259362149Z 2020-12-29 14:45:54,259 DEBUG org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Grant leadership to contender LeaderContender: DefaultDispatcherRunner with session ID fbbaa883-69f6-43df-9ca0-c646bc1baad1.
 2020-12-29T06:45:54.260301799Z 2020-12-29 14:45:54,260 DEBUG org.apache.flink.runtime.dispatcher.runner.DefaultDispatcherRunner [] - Create &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DispatcherLeaderProcess with leader session id fbbaa883-69f6-43df-9ca0-c646bc1baad1.
 2020-12-29T06:45:54.266724597Z 2020-12-29 14:45:54,266 INFO org.apache.flink.runtime.dispatcher.runner.SessionDispatcherLeaderProcess [] - Start SessionDispatcherLeaderProcess.
 2020-12-29T06:45:54.267718418Z 2020-12-29 14:45:54,267 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Attempting to renew leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-dispatcher-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;...
 2020-12-29T06:45:54.26786349Z 2020-12-29 14:45:54,267 INFO org.apache.flink.runtime.dispatcher.runner.SessionDispatcherLeaderProcess [] - Recover all persisted job graphs.
 2020-12-29T06:45:54.267976912Z 2020-12-29 14:45:54,267 DEBUG org.apache.flink.runtime.jobmanager.DefaultJobGraphStore [] - Retrieving all stored job ids from KubernetesStateHandleStore\{configMapName=&lt;span class=&quot;code-quote&quot;&gt;&apos;mta-flink-dispatcher-leader&apos;&lt;/span&gt;}.
 2020-12-29T06:45:54.277681598Z 2020-12-29 14:45:54,277 INFO org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - ResourceManager akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@mta-flink-jobmanager:6123/user/rpc/resourcemanager_0 was granted leadership with fencing token b51956917f3027b7b1730dc60f9449f4
&lt;/span&gt; 2020-12-29T06:45:54.280411279Z 2020-12-29 14:45:54,280 INFO org.apache.flink.runtime.resourcemanager.slotmanager.SlotManagerImpl [] - Starting the SlotManager.
 2020-12-29T06:45:54.281367931Z 2020-12-29 14:45:54,281 DEBUG org.apache.flink.kubernetes.highavailability.KubernetesLeaderElectionDriver [] - Successfully wrote leader information: Leader=[http:&lt;span class=&quot;code-comment&quot;&gt;//mta-flink-jobmanager:8081|http://mta-flink-jobmanager:8081/], session ID=9587e13f-322f-4cd5-9fff-b4941462be0f.
&lt;/span&gt; 2020-12-29T06:45:54.281528772Z 2020-12-29 14:45:54,281 DEBUG io.fabric8.kubernetes.client.extended.leaderelection.LeaderElector [] - Attempting to renew leader lease &lt;span class=&quot;code-quote&quot;&gt;&apos;ConfigMapLock: &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; - mta-flink-restserver-leader (6f6479c6-86cc-4d62-84f9-37ff968bd0e5)&apos;&lt;/span&gt;...
 2020-12-29T06:45:54.286191344Z 2020-12-29 14:45:54,286 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:45:54.286304807Z 2020-12-29 14:45:54,286 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:45:54.286438227Z 2020-12-29 14:45:54,286 DEBUG org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Confirm leader session ID b1730dc6-0f94-49f4-b519-56917f3027b7 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; leader akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@mta-flink-jobmanager:6123/user/rpc/resourcemanager_0.
&lt;/span&gt; 2020-12-29T06:45:54.309361096Z 2020-12-29 14:45:54,309 DEBUG org.apache.flink.kubernetes.highavailability.KubernetesLeaderElectionDriver [] - Successfully wrote leader information: Leader=akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@mta-flink-jobmanager:6123/user/rpc/resourcemanager_0, session ID=b1730dc6-0f94-49f4-b519-56917f3027b7.
&lt;/span&gt; 2020-12-29T06:45:54.320673232Z 2020-12-29 14:45:54,320 INFO org.apache.flink.runtime.jobmanager.DefaultJobGraphStore [] - Retrieved job ids [] from KubernetesStateHandleStore\{configMapName=&lt;span class=&quot;code-quote&quot;&gt;&apos;mta-flink-dispatcher-leader&apos;&lt;/span&gt;}
 2020-12-29T06:45:54.3206989Z 2020-12-29 14:45:54,320 INFO org.apache.flink.runtime.dispatcher.runner.SessionDispatcherLeaderProcess [] - Successfully recovered 0 persisted job graphs.
 2020-12-29T06:45:54.324829616Z 2020-12-29 14:45:54,324 DEBUG org.apache.flink.runtime.rpc.akka.SupervisorActor [] - Starting FencedAkkaRpcActor with name dispatcher_1.
 2020-12-29T06:45:54.325343659Z 2020-12-29 14:45:54,325 INFO org.apache.flink.runtime.rpc.akka.AkkaRpcService [] - Starting RPC endpoint &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.flink.runtime.dispatcher.StandaloneDispatcher at akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/rpc/dispatcher_1 .
&lt;/span&gt; 2020-12-29T06:45:54.33778039Z 2020-12-29 14:45:54,337 DEBUG org.apache.flink.runtime.leaderelection.DefaultLeaderElectionService [] - Confirm leader session ID fbbaa883-69f6-43df-9ca0-c646bc1baad1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; leader akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@mta-flink-jobmanager:6123/user/rpc/dispatcher_1.
&lt;/span&gt; 2020-12-29T06:45:54.36249763Z 2020-12-29 14:45:54,362 DEBUG org.apache.flink.kubernetes.highavailability.KubernetesLeaderElectionDriver [] - Successfully wrote leader information: Leader=akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@mta-flink-jobmanager:6123/user/rpc/dispatcher_1, session ID=fbbaa883-69f6-43df-9ca0-c646bc1baad1.
&lt;/span&gt; 2020-12-29T06:46:04.298366262Z 2020-12-29 14:46:04,297 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:46:04.298442695Z 2020-12-29 14:46:04,298 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:46:14.318174464Z 2020-12-29 14:46:14,317 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:46:14.318256849Z 2020-12-29 14:46:14,318 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:46:24.337694477Z 2020-12-29 14:46:24,337 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:46:24.337816516Z 2020-12-29 14:46:24,337 DEBUG org.apache.flink.runtime.resourcemanager.StandaloneResourceManager [] - Trigger heartbeat request.
 2020-12-29T06:46:26.044624193Z 2020-12-29 14:46:26,044 DEBUG org.apache.flink.shaded.netty4.io.netty.buffer.AbstractByteBuf [] - -Dorg.apache.flink.shaded.netty4.io.netty.buffer.checkAccessible: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;FLINK 1.12.0&lt;/p&gt;</environment>
        <key id="13348239">FLINK-20798</key>
            <summary>Using PVC as high-availability.storageDir could not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hayden zhou">hayden zhou</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 29 Dec 2020 06:58:18 +0000</created>
                <updated>Fri, 28 May 2021 07:02:49 +0000</updated>
                            <resolved>Mon, 11 Jan 2021 15:31:16 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Deployment / Kubernetes</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17256254" author="fly_in_gis" created="Wed, 30 Dec 2020 03:26:27 +0000"  >&lt;p&gt;Could you share the complete logs for JobManager? From the pieces of logs you provided, it seems that the rest endpoint is granted leadership successfully.&lt;/p&gt;</comment>
                            <comment id="17256280" author="hayden zhou" created="Wed, 30 Dec 2020 04:35:24 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13017871/13017871_flink.log&quot; title=&quot;flink.log attached to FLINK-20798&quot;&gt;flink.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;this is the log&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;my flink-conf.yaml&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;kubernetes.cluster-id: mta-flink&lt;br/&gt;
 high-availability: org.apache.flink.kubernetes.highavailability. KubernetesHaServicesFactory&lt;br/&gt;
 high-availability.storageDir: &lt;a href=&quot;file:///opt/flink/nfs/ha&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///opt/flink/nfs/ha&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;can I just use&#160; FileSystemHaServiceFactory to replace the&#160;KubernetesHaServicesFactory in the configMap&#65311;&#160;&lt;/p&gt;</comment>
                            <comment id="17256281" author="hayden zhou" created="Wed, 30 Dec 2020 04:36:30 +0000"  >&lt;p&gt;can we chat on wechat&#65311; my wechat account `zmfk2009`&lt;/p&gt;</comment>
                            <comment id="17256365" author="fly_in_gis" created="Wed, 30 Dec 2020 07:55:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayden+zhou&quot; class=&quot;user-hover&quot; rel=&quot;hayden zhou&quot;&gt;hayden zhou&lt;/a&gt;&#160;I do not find any&#160;suspicious logs in the attached log file. The rest endpoint &quot;http://mta-flink-jobmanager:8081&quot; is granted leadership successfully. After the leadership is granted, I believe that if you visit the webui normally.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For &lt;tt&gt;FileSystemHaServiceFactory&lt;/tt&gt;, it is not supported in Flink right now. But I think you could have your own implementation and configure the HA mode. Please remember to replace the deployment with statefulset for JobManager.&lt;/p&gt;</comment>
                            <comment id="17256396" author="fly_in_gis" created="Wed, 30 Dec 2020 09:34:17 +0000"  >&lt;p&gt;After offline discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayden+zhou&quot; class=&quot;user-hover&quot; rel=&quot;hayden zhou&quot;&gt;hayden zhou&lt;/a&gt;, we find the root cause is &lt;tt&gt;kubernetes.namespace&lt;/tt&gt; is not configured correctly.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayden+zhou&quot; class=&quot;user-hover&quot; rel=&quot;hayden zhou&quot;&gt;hayden zhou&lt;/a&gt;&#160;would you like to update the K8s HA document&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. I believe it could help other users a lot.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&#160;&lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-master/deployment/ha/kubernetes_ha.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci.apache.org/projects/flink/flink-docs-master/deployment/ha/kubernetes_ha.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17256416" author="hayden zhou" created="Wed, 30 Dec 2020 10:01:04 +0000"  >&lt;p&gt;great thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt;, so patiently to help me debug then find the problem&#160;&lt;/p&gt;</comment>
                            <comment id="17256494" author="till.rohrmann" created="Wed, 30 Dec 2020 12:21:27 +0000"  >&lt;p&gt;Does the wrongly configured &lt;tt&gt;kubernetes.namespace&lt;/tt&gt; explains why the &lt;tt&gt;DefaultLeaderRetrievalService.notifyLeaderAddress&lt;/tt&gt; is not being called (differently said &lt;tt&gt;KubernetesLeaderRetrievalDriver&lt;/tt&gt; not seing the ConfigMap change)?&lt;/p&gt;</comment>
                            <comment id="17258934" author="fly_in_gis" created="Tue, 5 Jan 2021 13:56:10 +0000"  >&lt;p&gt;I am going to reopen this ticket. After a deep dive into the codes and logs, I believe this is a bug. The root cause is we do not set the namespace when creating a watch on the ConfigMap&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayden+zhou&quot; class=&quot;user-hover&quot; rel=&quot;hayden zhou&quot;&gt;hayden zhou&lt;/a&gt;&apos;s use case, he deploys the JobManager/TaskManager to namespace flink. But the leader ConfigMaps are created in the namespace default. The JobManager/TaskManager pods are using the same namespace as they are running in(aka default). So they could not retrieve the leader address even though the leaders have been granted.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Currently for standalone Flink on K8s, we could set the &lt;tt&gt;kubernetes.namespace&lt;/tt&gt; same as the namespace we are deploying the JobManager and TaskManager pods to work around. For native Flink on K8s, we do not have this issue. Because we are always creating the HA ConfigMaps in the same namespace as the JobManager/TaskManager pods.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&#160;&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/Fabric8FlinkKubeClient.java#L344&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-kubernetes/src/main/java/org/apache/flink/kubernetes/kubeclient/Fabric8FlinkKubeClient.java#L344&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17258975" author="till.rohrmann" created="Tue, 5 Jan 2021 14:53:35 +0000"  >&lt;p&gt;Thanks for the explanation. The fix should be easy for this problem, right? We need to set the proper namespace for the ConfigMap watch.&lt;/p&gt;</comment>
                            <comment id="17259673" author="fly_in_gis" created="Wed, 6 Jan 2021 12:31:13 +0000"  >&lt;p&gt;Yes. It is easy to fix. Instead of directly set the namespace for ConfigMap watch, I prefer to use a namespaced Kubernetes client when creating&#160;&lt;tt&gt;FlinkKubeClient&lt;/tt&gt; in &lt;tt&gt;DefaultKubeClientFactory&lt;/tt&gt;. After then, we will not need to always set the namespace when creating kubernetes resources(e.g. deployment, pods, configmap, watch, etc.).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will attach a PR soon.&lt;/p&gt;</comment>
                            <comment id="17260269" author="oceanxie" created="Thu, 7 Jan 2021 06:50:04 +0000"  >&lt;p&gt;The HA configmap would&apos;t be deleted when I delete the flink cluster(sts and configmap). I don&apos;t think this is appropriate. They were generated automatically, not created by me.&lt;/p&gt;</comment>
                            <comment id="17260321" author="till.rohrmann" created="Thu, 7 Jan 2021 08:52:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=oceanxie&quot; class=&quot;user-hover&quot; rel=&quot;oceanxie&quot;&gt;oceanxie&lt;/a&gt; I think this is intended behaviour as described in the &lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.12/deployment/ha/kubernetes_ha.html#high-availability-data-clean-up&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;K8s HA documentation&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17262727" author="till.rohrmann" created="Mon, 11 Jan 2021 15:31:16 +0000"  >&lt;p&gt;Fixed via &lt;/p&gt;

&lt;p&gt;1.13.0: 460e1799d2b9069835ecae295c75f571c7d6b65a&lt;br/&gt;
1.12.2: 8d29d8873b00df983917257c1e577f4f25b3baa2&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13348226">FLINK-20797</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13017871" name="flink.log" size="100845" author="hayden zhou" created="Wed, 30 Dec 2020 04:35:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0lw6w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>