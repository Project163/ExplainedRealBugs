<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19790] Writing MAP&lt;STRING, STRING&gt; to Kafka with JSON format produces incorrect data.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19790</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Running the following SQL script writes incorrect data to Kafka:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TEMPORARY TABLE tmp_1 (m MAP&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;) WITH (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;...&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;...&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;tmp-1&apos;&lt;/span&gt;
);

CREATE TEMPORARY TABLE gen (k STRING, v STRING) WITH (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;
);

CREATE TEMPORARY VIEW gen_short AS
SELECT SUBSTR(k, 0, 4) AS k, SUBSTR(v, 0, 4) AS v FROM gen;

INSERT INTO tmp_1
SELECT MAP[k, v] FROM gen_short; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Printing the content of the &lt;tt&gt;tmp-1&lt;/tt&gt; topics results in the following output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ kafka-console-consumer --bootstrap-server ... --from-beginning --topic tmp-1 | head -n 5
{&lt;span class=&quot;code-quote&quot;&gt;&quot;m&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;8a93&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;6102&quot;&lt;/span&gt;}}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;m&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;8a93&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;6102&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;7922&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;f737&quot;&lt;/span&gt;}}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;m&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;8a93&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;6102&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;7922&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;f737&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;9b63&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;15b0&quot;&lt;/span&gt;}}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;m&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;8a93&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;6102&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;7922&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;f737&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;9b63&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;15b0&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;c38b&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;b55c&quot;&lt;/span&gt;}}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;m&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;8a93&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;6102&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;7922&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;f737&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;9b63&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;15b0&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;c38b&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;b55c&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;222c&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;f3e2&quot;&lt;/span&gt;}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see, the map is not correctly encoded as JSON and written to Kafka.&lt;/p&gt;

&lt;p&gt;I&apos;ve run the query with the Blink planner with object reuse and operator pipelining disabled.&lt;br/&gt;
Writing with Avro works as expected.&lt;/p&gt;

&lt;p&gt;Hence I assume that the JSON encoder/serializer reuses the Map object when encoding the JSON.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13336919">FLINK-19790</key>
            <summary>Writing MAP&lt;STRING, STRING&gt; to Kafka with JSON format produces incorrect data.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="libenchao">Benchao Li</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 23 Oct 2020 12:48:05 +0000</created>
                <updated>Thu, 5 Nov 2020 02:31:29 +0000</updated>
                            <resolved>Thu, 5 Nov 2020 02:31:29 +0000</resolved>
                                    <version>1.11.2</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Table SQL / Ecosystem</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17219674" author="libenchao" created="Fri, 23 Oct 2020 13:22:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;&#160;Sure, this is a bug in the map converter for JSON format, I&apos;ll fix it.&lt;/p&gt;</comment>
                            <comment id="17219675" author="fhueske" created="Fri, 23 Oct 2020 13:26:36 +0000"  >&lt;p&gt;Thanks for the quick response and working on a fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17226033" author="libenchao" created="Wed, 4 Nov 2020 12:49:12 +0000"  >&lt;p&gt;Fixed via&#160;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;b7487bd85bedea8bd50e706c253a61ebbcf8a8bc (1.12.0)&lt;/li&gt;
	&lt;li&gt;b50fc62e5b08363932815e0c68fbea3f08f0011f(1.11.3)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jyew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>