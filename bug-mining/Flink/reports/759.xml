<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2586] Unstable Storm Compatibility Tests</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2586</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The Storm Compatibility tests frequently fail.&lt;/p&gt;

&lt;p&gt;The reason is that they kill the topologies after a certain time interval. That may fail on CI infrastructure when certain steps are delayed beyond usual. Trying to guarantee progress by time is inherently problematic:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Waiting too short makes tests unstable&lt;/li&gt;
	&lt;li&gt;Waiting too long makes tests slow&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The right way to go is letting the program decide when to terminate, for example by throwing a special &lt;tt&gt;SuccessException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Have a look at the Kafka connector tests, they do this a lot and hence run exactly as short or as long as they need to.&lt;/p&gt;

&lt;p&gt;Here is an example of a failed run: &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/77499577/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/77499577/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2801&quot; title=&quot;Rework Storm Compatibility Tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2801&quot;&gt;&lt;del&gt;FLINK-2801&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The tests for the storm compatibiliy layer are all working with timeouts (running the program for 10 seconds) and then checking whether teh expected result has been written.&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;That is inherently unstable and slow (long delays). They should be rewritten in a similar manner like for example the KafkaITCase tests, where the streaming jobs terminate themselves with a &quot;SuccessException&quot;, which can be recognized as successful completion when thrown by the job client.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12859650">FLINK-2586</key>
            <summary>Unstable Storm Compatibility Tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mjsax">Matthias J. Sax</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Thu, 27 Aug 2015 16:53:46 +0000</created>
                <updated>Tue, 19 Jan 2016 14:45:20 +0000</updated>
                            <resolved>Fri, 15 Jan 2016 08:57:49 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Legacy Components / Storm Compatibility</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14717104" author="mjsax" created="Thu, 27 Aug 2015 17:21:44 +0000"  >&lt;p&gt;This is a know problem. The reasons why the call to `killTopology` is non-blocking is that in Storm this call does not block either. I think we should preserve the behavior as much as possible to maximize user experience. However, we could extend `KillOptions` as `FlinkKillOptions` and add a new Flink specific flag that make the call blocking. We can use this flag in test to make them stable. The same holds for `SubmitOptions`. If all Spouts implement `FiniteSpoutInterface` we could allow for a blocking submit option to bridge between Storm and Flink behavior.&lt;/p&gt;</comment>
                            <comment id="14717109" author="stephanewen" created="Thu, 27 Aug 2015 17:23:42 +0000"  >&lt;p&gt;That is not really the problem here.&lt;/p&gt;

&lt;p&gt;The problem is that the test sleeps 10 seconds and thinks that this is enough time to produce the output that it verifies after the sleep. But it sometimes is not, if the container in the CI infrastructure stalls for some reason.&lt;/p&gt;</comment>
                            <comment id="14717198" author="mjsax" created="Thu, 27 Aug 2015 18:10:08 +0000"  >&lt;p&gt;You are right. It&apos;s not the kill thing. However the problem is basically the same. (1) `submitToplogy()` is an non-blocking call; (2) in Storm, topologies run forever. Thus, there is no way to determine when `killTopology` should be called (without very mean hacks). We could only add a Flink specific blocking flag, that make the call to `submitTopology()` blocking. Furthermore, we need to ensure, that the Spouts terminate by themselves (via implement `FiniteSpoutInterface`). So far, the test passed all the time, so I though it should be fine as is. Obviously, I was wrong (and I have to confess, that I don&apos;t like the current implementation either &amp;#8211; I only did it this way to be as close to Storm semantics as possible).&lt;/p&gt;</comment>
                            <comment id="14717222" author="stephanewen" created="Thu, 27 Aug 2015 18:21:38 +0000"  >&lt;p&gt;Okay, I see. Is there a way to check the status of a topology? To check whether it is still running or it failed, and if it failed, with what exception?&lt;/p&gt;

&lt;p&gt;If that is possible, you can loop-sleep-wait until the job has failed, check that the exception is the &quot;SuccessException&quot; and then validate the output in the test driver. That should make the tests robust.&lt;/p&gt;</comment>
                            <comment id="14737135" author="sachingoel0101" created="Wed, 9 Sep 2015 16:29:18 +0000"  >&lt;p&gt;Observed the same failure albeit on a different test. &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/79483292/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/79483292/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14737168" author="mjsax" created="Wed, 9 Sep 2015 16:45:48 +0000"  >&lt;p&gt;Thanks for reporting. Can be resolved after &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2111&quot; title=&quot;Add &amp;quot;stop&amp;quot; signal to cleanly shutdown streaming jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2111&quot;&gt;&lt;del&gt;FLINK-2111&lt;/del&gt;&lt;/a&gt; is merged. Should be only a couple of days.&lt;/p&gt;</comment>
                            <comment id="15096579" author="githubbot" created="Wed, 13 Jan 2016 17:13:42 +0000"  >&lt;p&gt;GitHub user mjsax opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2586&quot; title=&quot;Unstable Storm Compatibility Tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2586&quot;&gt;&lt;del&gt;FLINK-2586&lt;/del&gt;&lt;/a&gt; Unstable Storm Compatibility Tests&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added BLOCKING flag to FlinkLocalCluster&lt;/li&gt;
	&lt;li&gt;added NullTerminatingSpout and SpoutOutputCollectorObserver plus tests&lt;/li&gt;
	&lt;li&gt;reworked test accordingly&lt;/li&gt;
	&lt;li&gt;set BLOCKING flag for ITCases&lt;/li&gt;
	&lt;li&gt;make infinite spouts finite using NullTerminatingSpout&lt;/li&gt;
	&lt;li&gt;removed sleep time to get stable&lt;/li&gt;
	&lt;li&gt;fixed bug in BoltSplitITCase and SpoutSplitITCase&lt;/li&gt;
	&lt;li&gt;exception in VerifyAndEnrichBolt is swallowed and test would not fail (replaced by errorFlag)&lt;/li&gt;
	&lt;li&gt;reduced sleep-time in BoltSplitITCase and SpoutSplitITCase to reduce testing time&lt;/li&gt;
	&lt;li&gt;fixed WrapperSetupHelperTest&lt;/li&gt;
	&lt;li&gt;reworked to origianl version with more than two inputs&lt;br/&gt;
         (was limite to two inputs because more the two inputs per bolt was not supported in between, which is now fixed)&lt;br/&gt;
    minor code cleanup (removed unused imports, indenting, etc.)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mjsax/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mjsax/flink&lt;/a&gt; flink-2586-unstable-storm-tests&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1502&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ee830a62ae77e808b442e28acdd2a71b04758362&lt;br/&gt;
Author: mjsax &amp;lt;mjsax@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-01-13T16:47:32Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2586&quot; title=&quot;Unstable Storm Compatibility Tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2586&quot;&gt;&lt;del&gt;FLINK-2586&lt;/del&gt;&lt;/a&gt; Unstable Storm Compatibility Tests&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added BLOCKING flag to FlinkLocalCluster&lt;/li&gt;
	&lt;li&gt;added NullTerminatingSpout and SpoutOutputCollectorObserver plus tests&lt;/li&gt;
	&lt;li&gt;reworked test accordingly&lt;/li&gt;
	&lt;li&gt;set BLOCKING flag for ITCases&lt;/li&gt;
	&lt;li&gt;make infinite spouts finite using NullTerminatingSpout&lt;/li&gt;
	&lt;li&gt;removed sleep time to get stable&lt;/li&gt;
	&lt;li&gt;fixed bug in BoltSplitITCase and SpoutSplitITCase&lt;/li&gt;
	&lt;li&gt;exception in VerifyAndEnrichBolt is swallowed and test would not fail (replaced by errorFlag)&lt;/li&gt;
	&lt;li&gt;reduced sleep-time in BoltSplitITCase and SpoutSplitITCase to reduce testing time&lt;/li&gt;
	&lt;li&gt;fixed WrapperSetupHelperTest&lt;/li&gt;
	&lt;li&gt;reworked to origianl version with more than two inputs&lt;br/&gt;
         (was limite to two inputs because more the two inputs per bolt was not supported in between, which is now fixed)&lt;br/&gt;
    minor code cleanup (removed unused imports, indenting, etc.)&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="15098842" author="githubbot" created="Thu, 14 Jan 2016 20:56:53 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502#issuecomment-171777377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502#issuecomment-171777377&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you for addressing this.&lt;/p&gt;

&lt;p&gt;    Looks good to me, +1 to merge this&lt;/p&gt;</comment>
                            <comment id="15098849" author="githubbot" created="Thu, 14 Jan 2016 21:00:25 +0000"  >&lt;p&gt;Github user mjsax commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502#issuecomment-171778290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502#issuecomment-171778290&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks. Will merge this.&lt;/p&gt;</comment>
                            <comment id="15098864" author="githubbot" created="Thu, 14 Jan 2016 21:09:16 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15101497" author="mjsax" created="Fri, 15 Jan 2016 08:57:37 +0000"  >&lt;p&gt;Fixed via d1c93d286b95f069f6ba0a4e60e3a34655a395e3&lt;/p&gt;</comment>
                            <comment id="15106799" author="githubbot" created="Tue, 19 Jan 2016 14:37:31 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502#issuecomment-172871995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502#issuecomment-172871995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mjsax, most likely it happened by accident but it&apos;s good practice to separate the git commit subject from the body by inserting a line break. That way, git can show you a nice one line git history `git log --oneline` without seeing the body of the commit message. Also some other tools format the git log nicely if one follows this rule.&lt;/p&gt;</comment>
                            <comment id="15106810" author="githubbot" created="Tue, 19 Jan 2016 14:45:20 +0000"  >&lt;p&gt;Github user mjsax commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1502#issuecomment-172873995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1502#issuecomment-172873995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann I was not aware of that. Thanks for letting me know. Will do so in the future.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12902067">FLINK-2801</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12903924">FLINK-2847</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jggf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>