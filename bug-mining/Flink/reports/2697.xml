<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10693] Fix Scala EitherSerializer duplication</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10693</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The Scala Either Serializer has buggy duplication logic, resulting in sharing and incorrect concurrent use when the nested serializers are not thread safe.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194421">FLINK-10693</key>
            <summary>Fix Scala EitherSerializer duplication</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sewen">Stephan Ewen</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 26 Oct 2018 14:02:53 +0000</created>
                <updated>Thu, 1 Nov 2018 08:43:07 +0000</updated>
                            <resolved>Thu, 1 Nov 2018 08:41:40 +0000</resolved>
                                    <version>1.6.1</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>API / Scala</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16666114" author="githubbot" created="Sat, 27 Oct 2018 14:49:33 +0000"  >&lt;p&gt;StephanEwen opened a new pull request #6951: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10693&quot; title=&quot;Fix Scala EitherSerializer duplication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10693&quot;&gt;&lt;del&gt;FLINK-10693&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Scala API&amp;#93;&lt;/span&gt; Fix incorrect duplication in EitherSerializer&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6951&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change / Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Fixes the duplication of the Scala `EitherSerialzer` that never deep copies, even though the nested serializers might require it.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adds a self-contained unit test&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;yes&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;not applicable&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16666411" author="githubbot" created="Sun, 28 Oct 2018 14:18:39 +0000"  >&lt;p&gt;StephanEwen commented on issue #6951: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10693&quot; title=&quot;Fix Scala EitherSerializer duplication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10693&quot;&gt;&lt;del&gt;FLINK-10693&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Scala API&amp;#93;&lt;/span&gt; Fix incorrect duplication in EitherSerializer&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6951#issuecomment-433709503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6951#issuecomment-433709503&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   CI test failure is unrelated:&lt;br/&gt;
   `FlinkKafkaProducerITCase.testFlinkKafkaProducer10FailTransactionCoordinatorBeforeNotify -Timeout`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16669874" author="githubbot" created="Wed, 31 Oct 2018 10:10:40 +0000"  >&lt;p&gt;tillrohrmann commented on issue #6951: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10693&quot; title=&quot;Fix Scala EitherSerializer duplication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10693&quot;&gt;&lt;del&gt;FLINK-10693&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Scala API&amp;#93;&lt;/span&gt; Fix incorrect duplication in EitherSerializer&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6951#issuecomment-434631198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6951#issuecomment-434631198&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I&apos;ll backport this PR to `release-1.5` and `release-1.6`. If Travis passes, then I&apos;ll merge it.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16671270" author="till.rohrmann" created="Thu, 1 Nov 2018 08:41:40 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
1.7.0: 68df7f969c898bbc7ca348e917fd5fc40a123faf&lt;br/&gt;
1.6.3: 5aa07cd277bad087bbcf901afaac6133c87b6812&lt;br/&gt;
1.5.6: 26fa2e5f75f25ab5723fe79ce1a938ba94a6337b&lt;/p&gt;</comment>
                            <comment id="16671272" author="githubbot" created="Thu, 1 Nov 2018 08:43:07 +0000"  >&lt;p&gt;asfgit closed pull request #6951: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10693&quot; title=&quot;Fix Scala EitherSerializer duplication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10693&quot;&gt;&lt;del&gt;FLINK-10693&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Scala API&amp;#93;&lt;/span&gt; Fix incorrect duplication in EitherSerializer&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6951&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-scala/src/main/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerConfigSnapshot.java b/flink-scala/src/main/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerConfigSnapshot.java&lt;br/&gt;
index 9566a663169..8ad4e09a1e2 100644&lt;br/&gt;
&amp;#8212; a/flink-scala/src/main/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerConfigSnapshot.java&lt;br/&gt;
+++ b/flink-scala/src/main/java/org/apache/flink/api/scala/typeutils/ScalaEitherSerializerConfigSnapshot.java&lt;br/&gt;
@@ -27,8 +27,8 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Configuration snapshot for serializers of Scala&apos;s 
{@link Either}
&lt;p&gt; type,&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;containing configuration snapshots of the Left and Right serializers.&lt;br/&gt;
  */&lt;br/&gt;
-public class ScalaEitherSerializerConfigSnapshot&amp;lt;E extends Either&amp;lt;L, R&amp;gt;, L, R&amp;gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;extends CompositeTypeSerializerConfigSnapshot&amp;lt;E&amp;gt; {&lt;br/&gt;
+public class ScalaEitherSerializerConfigSnapshot&amp;lt;L, R&amp;gt;&lt;br/&gt;
+		extends CompositeTypeSerializerConfigSnapshot&amp;lt;Either&amp;lt;L, R&amp;gt;&amp;gt; {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private static final int VERSION = 1;&lt;/p&gt;

&lt;p&gt;diff --git a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherSerializer.scala b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherSerializer.scala&lt;br/&gt;
index 82637befdcd..14f2196b9cc 100644&lt;br/&gt;
&amp;#8212; a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherSerializer.scala&lt;br/&gt;
+++ b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherSerializer.scala&lt;br/&gt;
@@ -27,15 +27,24 @@ import org.apache.flink.core.memory.&lt;/p&gt;
{DataInputView, DataOutputView}
&lt;p&gt;  */&lt;br/&gt;
 @Internal&lt;br/&gt;
 @SerialVersionUID(9219995873023657525L)&lt;br/&gt;
-class EitherSerializer[A, B, T &amp;lt;: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;](&lt;br/&gt;
+class EitherSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;(&lt;br/&gt;
     val leftSerializer: TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;A&amp;#93;&lt;/span&gt;,&lt;br/&gt;
     val rightSerializer: TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;B&amp;#93;&lt;/span&gt;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;extends TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; {&lt;br/&gt;
+  extends TypeSerializer[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;] {&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def duplicate: EitherSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;A,B,T&amp;#93;&lt;/span&gt; = this&lt;br/&gt;
+  override def duplicate: EitherSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;A,B&amp;#93;&lt;/span&gt; = {&lt;br/&gt;
+    val leftDup = leftSerializer.duplicate()&lt;br/&gt;
+    val rightDup = rightSerializer.duplicate()&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def createInstance: T = {&lt;/li&gt;
	&lt;li&gt;Left(null).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;br/&gt;
+    if (leftDup.eq(leftSerializer) &amp;amp;&amp;amp; rightDup.eq(rightSerializer)) 
{
+      this
+    }
&lt;p&gt; else &lt;/p&gt;
{
+      new EitherSerializer[A, B](leftDup, rightDup)
+    }
&lt;p&gt;+  }&lt;br/&gt;
+&lt;br/&gt;
+  override def createInstance: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; = &lt;/p&gt;
{
+    Left(null).asInstanceOf[Left[A, B]]
   }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   override def isImmutableType: Boolean = {&lt;br/&gt;
@@ -45,12 +54,12 @@ class EitherSerializer[A, B, T &amp;lt;: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;](&lt;/p&gt;

&lt;p&gt;   override def getLength: Int = -1&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def copy(from: T): T = from match {&lt;/li&gt;
	&lt;li&gt;case Left(a) =&amp;gt; Left(leftSerializer.copy(a)).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;case Right(b) =&amp;gt; Right(rightSerializer.copy(b)).asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;&lt;br/&gt;
+  override def copy(from: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;): Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; = from match 
{
+    case Left(a) =&amp;gt; Left(leftSerializer.copy(a))
+    case Right(b) =&amp;gt; Right(rightSerializer.copy(b))
   }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def copy(from: T, reuse: T): T = copy(from)&lt;br/&gt;
+  override def copy(from: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;, reuse: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;): Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; = copy(from)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   override def copy(source: DataInputView, target: DataOutputView): Unit = &lt;/p&gt;
{
     val isLeft = source.readBoolean()
@@ -62,7 +71,7 @@ class EitherSerializer[A, B, T &amp;lt;: Either[A, B]](
     }
&lt;p&gt;   }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def serialize(either: T, target: DataOutputView): Unit = either match {&lt;br/&gt;
+  override def serialize(either: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;, target: DataOutputView): Unit = either match 
{
     case Left(a) =&amp;gt;
       target.writeBoolean(true)
       leftSerializer.serialize(a, target)
@@ -71,27 +80,27 @@ class EitherSerializer[A, B, T &amp;lt;: Either[A, B]](
       rightSerializer.serialize(b, target)
   }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def deserialize(source: DataInputView): T = {&lt;br/&gt;
+  override def deserialize(source: DataInputView): Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; = 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {     val isLeft = source.readBoolean()     if (isLeft) {
-      Left(leftSerializer.deserialize(source)).asInstanceOf[T]
+      Left(leftSerializer.deserialize(source))
     } else {
-      Right(rightSerializer.deserialize(source)).asInstanceOf[T]
+      Right(rightSerializer.deserialize(source))
     }&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
-  override def deserialize(reuse: T, source: DataInputView): T = {&lt;br/&gt;
+  override def deserialize(reuse: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;, source: DataInputView): Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; = {&lt;br/&gt;
     val isLeft = source.readBoolean()&lt;br/&gt;
     if (isLeft) {-      Left(leftSerializer.deserialize(source)).asInstanceOf[T]+      Left(leftSerializer.deserialize(source))     } else {
-      Right(rightSerializer.deserialize(source)).asInstanceOf[T]
+      Right(rightSerializer.deserialize(source))
     }   }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   override def equals(obj: Any): Boolean = {&lt;br/&gt;
     obj match &lt;/p&gt;
{
-      case eitherSerializer: EitherSerializer[_, _, _] =&amp;gt;
+      case eitherSerializer: EitherSerializer[_, _] =&amp;gt;
         eitherSerializer.canEqual(this) &amp;amp;&amp;amp;
         leftSerializer.equals(eitherSerializer.leftSerializer) &amp;amp;&amp;amp;
         rightSerializer.equals(eitherSerializer.rightSerializer)
@@ -100,7 +109,7 @@ class EitherSerializer[A, B, T &amp;lt;: Either[A, B]](
   }

&lt;p&gt;   override def canEqual(obj: Any): Boolean = &lt;/p&gt;
{
-    obj.isInstanceOf[EitherSerializer[_, _, _]]
+    obj.isInstanceOf[EitherSerializer[_, _]]
   }

&lt;p&gt;   override def hashCode(): Int = {&lt;br/&gt;
@@ -111,15 +120,15 @@ class EitherSerializer[A, B, T &amp;lt;: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;](&lt;br/&gt;
   // Serializer configuration snapshotting &amp;amp; compatibility&lt;br/&gt;
   // --------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def snapshotConfiguration(): ScalaEitherSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;T, A, B&amp;#93;&lt;/span&gt; = {&lt;/li&gt;
	&lt;li&gt;new ScalaEitherSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;T, A, B&amp;#93;&lt;/span&gt;(leftSerializer, rightSerializer)&lt;br/&gt;
+  override def snapshotConfiguration(): ScalaEitherSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; = 
{
+    new ScalaEitherSerializerConfigSnapshot[A, B](leftSerializer, rightSerializer)
   }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   override def ensureCompatibility(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;configSnapshot: TypeSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;_&amp;#93;&lt;/span&gt;): CompatibilityResult&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; = {&lt;br/&gt;
+      configSnapshot: TypeSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;_&amp;#93;&lt;/span&gt;): CompatibilityResult[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;] = {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     configSnapshot match {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case eitherSerializerConfig: ScalaEitherSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;T, A, B&amp;#93;&lt;/span&gt; =&amp;gt;&lt;br/&gt;
+      case eitherSerializerConfig: ScalaEitherSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt; =&amp;gt;&lt;br/&gt;
         checkCompatibility(eitherSerializerConfig)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       // backwards compatibility path;&lt;br/&gt;
@@ -134,7 +143,7 @@ class EitherSerializer[A, B, T &amp;lt;: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;](&lt;/p&gt;

&lt;p&gt;   private def checkCompatibility(&lt;br/&gt;
       configSnapshot: CompositeTypeSerializerConfigSnapshot&lt;span class=&quot;error&quot;&gt;&amp;#91;_&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;): CompatibilityResult&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; = {&lt;br/&gt;
+    ): CompatibilityResult[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;] = {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     val previousLeftRightSerWithConfigs =&lt;br/&gt;
       configSnapshot.getNestedSerializersAndConfigs&lt;br/&gt;
diff --git a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherTypeInfo.scala b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherTypeInfo.scala&lt;br/&gt;
index e89730951be..b2a055e5efc 100644&lt;br/&gt;
&amp;#8212; a/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherTypeInfo.scala&lt;br/&gt;
+++ b/flink-scala/src/main/scala/org/apache/flink/api/scala/typeutils/EitherTypeInfo.scala&lt;br/&gt;
@@ -52,18 +52,18 @@ class EitherTypeInfo[A, B, T &amp;lt;: Either&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;](&lt;/p&gt;

&lt;p&gt;   @PublicEvolving&lt;br/&gt;
   def createSerializer(executionConfig: ExecutionConfig): TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; = {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val leftSerializer = if (leftTypeInfo != null) {&lt;br/&gt;
+    val leftSerializer: TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;A&amp;#93;&lt;/span&gt; = if (leftTypeInfo != null) 
{
       leftTypeInfo.createSerializer(executionConfig)
     }
&lt;p&gt; else &lt;/p&gt;
{
-      new NothingSerializer
+      (new NothingSerializer).asInstanceOf[TypeSerializer[A]]
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val rightSerializer = if (rightTypeInfo != null) {&lt;br/&gt;
+    val rightSerializer: TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;B&amp;#93;&lt;/span&gt; = if (rightTypeInfo != null) 
{
       rightTypeInfo.createSerializer(executionConfig)
     }
&lt;p&gt; else &lt;/p&gt;
{
-      new NothingSerializer
+      (new NothingSerializer).asInstanceOf[TypeSerializer[B]]
     }&lt;/li&gt;
	&lt;li&gt;new EitherSerializer(leftSerializer, rightSerializer)&lt;br/&gt;
+    new EitherSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;A, B&amp;#93;&lt;/span&gt;(leftSerializer, rightSerializer).asInstanceOf[TypeSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;]&lt;br/&gt;
   }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   override def equals(obj: Any): Boolean = {&lt;br/&gt;
diff --git a/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EitherSerializerTest.scala b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EitherSerializerTest.scala&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..f62d9a95ebb&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-scala/src/test/scala/org/apache/flink/api/scala/typeutils/EitherSerializerTest.scala&lt;br/&gt;
@@ -0,0 +1,90 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.api.scala.typeutils&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.api.common.ExecutionConfig&lt;br/&gt;
+import org.apache.flink.api.common.typeutils.SerializerTestBase&lt;br/&gt;
+import org.apache.flink.api.common.typeutils.base.&lt;/p&gt;
{IntSerializer, StringSerializer}
&lt;p&gt;+import org.apache.flink.api.java.typeutils.runtime.kryo.KryoSerializer&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Test&lt;br/&gt;
+import org.junit.Assert.assertNotSame&lt;br/&gt;
+import org.junit.Assert.assertSame&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+  * Test suite for the [&lt;span class=&quot;error&quot;&gt;&amp;#91;EitherSerializer&amp;#93;&lt;/span&gt;]&lt;br/&gt;
+  */&lt;br/&gt;
+class EitherSerializerTest extends SerializerTestBase[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;String, Integer&amp;#93;&lt;/span&gt;] {&lt;br/&gt;
+&lt;br/&gt;
+  // --------------------------------------------------------------------------&lt;br/&gt;
+  //  test suite&lt;br/&gt;
+  // --------------------------------------------------------------------------&lt;br/&gt;
+&lt;br/&gt;
+  override protected def createSerializer() =&lt;br/&gt;
+    new EitherSerializer&lt;span class=&quot;error&quot;&gt;&amp;#91;String, Integer&amp;#93;&lt;/span&gt;(&lt;br/&gt;
+      StringSerializer.INSTANCE,&lt;br/&gt;
+      IntSerializer.INSTANCE)&lt;br/&gt;
+&lt;br/&gt;
+  override protected def getLength: Int = -1&lt;br/&gt;
+&lt;br/&gt;
+  override protected def getTypeClass: Class[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;String, Integer&amp;#93;&lt;/span&gt;] =&lt;br/&gt;
+    classOf[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;String, Integer&amp;#93;&lt;/span&gt;]&lt;br/&gt;
+&lt;br/&gt;
+  override protected def getTestData: Array[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;String, Integer&amp;#93;&lt;/span&gt;] =&lt;br/&gt;
+    Array[Either&lt;span class=&quot;error&quot;&gt;&amp;#91;String, Integer&amp;#93;&lt;/span&gt;](&lt;br/&gt;
+      Left(&quot;hello&quot;),&lt;br/&gt;
+      Right(17),&lt;br/&gt;
+      Right(0),&lt;br/&gt;
+      Left(&quot;friend&quot;),&lt;br/&gt;
+      Right(200),&lt;br/&gt;
+      Right(100),&lt;br/&gt;
+      Left(&quot;foo&quot;),&lt;br/&gt;
+      Right(1060876234),&lt;br/&gt;
+      Left(&quot;bar&quot;)&lt;br/&gt;
+    )&lt;br/&gt;
+&lt;br/&gt;
+  // --------------------------------------------------------------------------&lt;br/&gt;
+  //  either serializer specific tests&lt;br/&gt;
+  // --------------------------------------------------------------------------&lt;br/&gt;
+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  def testDuplication(): Unit = &lt;/p&gt;
{
+    val serializerSS: EitherSerializer[String, String] =
+      new EitherSerializer[String, String](
+        StringSerializer.INSTANCE,
+        StringSerializer.INSTANCE
+      )
+
+    val serializerSO: EitherSerializer[String, Object] =
+      new EitherSerializer[String, Object](
+        StringSerializer.INSTANCE,
+        new KryoSerializer[Object](classOf[Object], new ExecutionConfig())
+      )
+
+    val serializerOS: EitherSerializer[Object, String] =
+      new EitherSerializer[Object, String](
+        new KryoSerializer[Object](classOf[Object], new ExecutionConfig()),
+        StringSerializer.INSTANCE
+      )
+
+    assertSame(serializerSS, serializerSS.duplicate())
+    assertNotSame(serializerSO, serializerSO.duplicate())
+    assertNotSame(serializerOS, serializerOS.duplicate())
+  }
&lt;p&gt;+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zojz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>