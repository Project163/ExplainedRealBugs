<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:56:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22493] AdaptiveSchedulerITCase.testStopWithSavepointFailOnFirstSavepointSucceedOnSecond found unexpected files</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22493</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=17285&amp;amp;view=logs&amp;amp;j=a57e0635-3fad-5b08-57c7-a4142d7d6fa9&amp;amp;t=5360d54c-8d94-5d85-304e-a89267eb785a&amp;amp;l=9340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=17285&amp;amp;view=logs&amp;amp;j=a57e0635-3fad-5b08-57c7-a4142d7d6fa9&amp;amp;t=5360d54c-8d94-5d85-304e-a89267eb785a&amp;amp;l=9340&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Apr 27 11:10:07 [INFO] Running org.apache.flink.test.scheduling.AdaptiveSchedulerITCase
Apr 27 11:10:24 [ERROR] Tests run: 5, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 17.177 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.test.scheduling.AdaptiveSchedulerITCase
Apr 27 11:10:24 [ERROR] testStopWithSavepointFailOnFirstSavepointSucceedOnSecond(org.apache.flink.test.scheduling.AdaptiveSchedulerITCase)  Time elapsed: 0.305 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
Apr 27 11:10:24 java.lang.AssertionError: Found unexpected files: /tmp/junit3745203124457058148/savepoint/savepoint-8596b1-b3046c9bcf40
Apr 27 11:10:24 	at org.junit.Assert.fail(Assert.java:88)
Apr 27 11:10:24 	at org.apache.flink.test.scheduling.AdaptiveSchedulerITCase.testStopWithSavepointFailOnFirstSavepointSucceedOnSecond(AdaptiveSchedulerITCase.java:226)
Apr 27 11:10:24 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
Apr 27 11:10:24 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
Apr 27 11:10:24 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
Apr 27 11:10:24 	at java.lang.reflect.Method.invoke(Method.java:498)
Apr 27 11:10:24 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
Apr 27 11:10:24 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
Apr 27 11:10:24 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
Apr 27 11:10:24 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
Apr 27 11:10:24 	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
Apr 27 11:10:24 	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
Apr 27 11:10:24 	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
Apr 27 11:10:24 	at org.apache.flink.util.TestNameProvider$1.evaluate(TestNameProvider.java:45)
Apr 27 11:10:24 	at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
Apr 27 11:10:24 	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
Apr 27 11:10:24 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
Apr 27 11:10:24 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
Apr 27 11:10:24 	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
Apr 27 11:10:24 	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
Apr 27 11:10:24 	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
Apr 27 11:10:24 	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
Apr 27 11:10:24 	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
Apr 27 11:10:24 	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
Apr 27 11:10:24 	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
Apr 27 11:10:24 	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
Apr 27 11:10:24 	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
Apr 27 11:10:24 	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
Apr 27 11:10:24 	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
Apr 27 11:10:24 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13375357">FLINK-22493</key>
            <summary>AdaptiveSchedulerITCase.testStopWithSavepointFailOnFirstSavepointSucceedOnSecond found unexpected files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rmetzger">Robert Metzger</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 27 Apr 2021 14:09:27 +0000</created>
                <updated>Fri, 28 May 2021 11:07:18 +0000</updated>
                            <resolved>Thu, 29 Apr 2021 18:35:07 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.1</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17333292" author="till.rohrmann" created="Tue, 27 Apr 2021 14:25:21 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; could you validate whether this is a problem with the adaptive scheduler?&lt;/p&gt;</comment>
                            <comment id="17334657" author="rmetzger" created="Wed, 28 Apr 2021 11:15:22 +0000"  >&lt;p&gt;Yes, I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="17335270" author="till.rohrmann" created="Thu, 29 Apr 2021 09:06:33 +0000"  >&lt;p&gt;Why did you upgrade the priority &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;? Did you have found something?&lt;/p&gt;</comment>
                            <comment id="17335306" author="rmetzger" created="Thu, 29 Apr 2021 09:45:18 +0000"  >&lt;p&gt;I upgraded the priority because we usually mark test instabilities as critical issues. I have not found anything. I have no reason to believe that AdaptiveScheduler or the stop with savepoint logic is doing anything wrong here, it&apos;s rather the cleanup of failed savepoints in the checkpoint coordinator. I will post my findings here once I understood the problem.&lt;/p&gt;</comment>
                            <comment id="17335336" author="rmetzger" created="Thu, 29 Apr 2021 10:29:50 +0000"  >&lt;p&gt;I believe the problem is the following here:&lt;/p&gt;

&lt;p&gt;Once all tasks are running, the test triggers a savepoint, which intentionally fails, because of a test exception in a Task&apos;s checkpointing method. The test then waits for the savepoint future to fail, and the scheduler to restart the tasks. Once they are running again, it performs a sanity check whether the savepoint directory has been properly removed. In the reported run, there was still the savepoint directory around.&lt;/p&gt;

&lt;p&gt;The savepoint directory is removed via the PendingCheckpoint.discard() method. This method is executed using the i/o executor pool of the CheckpointCoordinator. There is no guarantee that this discard method has been executed when the job is running again (and the executor shuts down with the dispatcher, hence it is not bound to job restarts).&lt;/p&gt;

&lt;p&gt;I&apos;ll open a small PR to harden the test.&lt;/p&gt;</comment>
                            <comment id="17335749" author="rmetzger" created="Thu, 29 Apr 2021 18:35:07 +0000"  >&lt;p&gt;master &lt;a href=&quot;https://github.com/apache/flink/commit/00584d3180890e91c6dc8457bd45d98ec11c6652&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/00584d3180890e91c6dc8457bd45d98ec11c6652&lt;/a&gt;&lt;br/&gt;
release-1.13 &lt;a href=&quot;https://github.com/apache/flink/commit/229669cf16883b80c00c2b3aad75effc962d16d6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/229669cf16883b80c00c2b3aad75effc962d16d6&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13024790" name="AdaptiveSchedulerITCase.testStopWithSavepointFailOnFirstSavepointSucceedOnSecond.log" size="114103" author="rmetzger" created="Thu, 29 Apr 2021 07:36:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qi54:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>