<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:36:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10946] Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10946</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The test failed 3 times in total during the overall night build, but succeeded 2 times after restart. It&#160;did not fail locally for me.&lt;/p&gt;

&lt;p&gt;Here is a travis build to run it 500 times (reproducable):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/azagrebin/flink/builds/457375100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/azagrebin/flink/builds/457375100&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2018-11-20 11:59:54,673 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code ArtificalKeyedStateMapper_Avro -&amp;gt; ArtificalOperatorStateMapper (2/2) (e06b7022f2f2154f2a84206f068ff1fd).
2018-11-20 11:59:54,701 INFO  org.apache.flink.streaming.api.operators.AbstractStreamOperator  - Could not complete snapshot 12 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; ArtificalKeyedStateMapper_Avro -&amp;gt; ArtificalOperatorStateMapper (1/2).
java.io.IOException: Cannot register Closeable, registry is already closed. Closing argument.
	at org.apache.flink.util.AbstractCloseableRegistry.registerCloseable(AbstractCloseableRegistry.java:85)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable$AsyncSnapshotTask.&amp;lt;init&amp;gt;(AsyncSnapshotCallable.java:123)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable$AsyncSnapshotTask.&amp;lt;init&amp;gt;(AsyncSnapshotCallable.java:111)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable.toAsyncSnapshotFutureTask(AsyncSnapshotCallable.java:105)
	at org.apache.flink.contrib.streaming.state.snapshot.RocksIncrementalSnapshotStrategy.doSnapshot(RocksIncrementalSnapshotStrategy.java:164)
	at org.apache.flink.contrib.streaming.state.snapshot.RocksDBSnapshotStrategyBase.snapshot(RocksDBSnapshotStrategyBase.java:128)
	at org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend.snapshot(RocksDBKeyedStateBackend.java:496)
	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.snapshotState(AbstractStreamOperator.java:407)
	at org.apache.flink.streaming.runtime.tasks.StreamTask$CheckpointingOperation.checkpointStreamOperator(StreamTask.java:1113)
	at org.apache.flink.streaming.runtime.tasks.StreamTask$CheckpointingOperation.executeCheckpointing(StreamTask.java:1055)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.checkpointState(StreamTask.java:729)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.performCheckpoint(StreamTask.java:641)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.triggerCheckpointOnBarrier(StreamTask.java:586)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.notifyCheckpoint(BarrierBuffer.java:396)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.processBarrier(BarrierBuffer.java:292)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.getNextNonBlocked(BarrierBuffer.java:200)
	at org.apache.flink.streaming.runtime.io.StreamInputProcessor.processInput(StreamInputProcessor.java:209)
	at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.run(OneInputStreamTask.java:105)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:300)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:704)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2018-11-20 11:59:54,702 INFO  org.apache.flink.runtime.taskmanager.Task                     - Ensuring all FileSystem streams are closed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task Source: Custom Source -&amp;gt; Timestamps/Watermarks (2/2) (09528d6ab0e1ee87ed21e78139682b18) [CANCELED]
2018-11-20 11:59:54,703 INFO  org.apache.flink.runtime.taskmanager.Task                     - Ensuring all FileSystem streams are closed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task Source: Custom Source -&amp;gt; Timestamps/Watermarks (1/2) (c98146380e7f559ca18a183f4c0ef12d) [CANCELED]
2018-11-20 11:59:54,721 INFO  org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend  - Deleting existing instance base directory /tmp/flink-io-71851605-f8f2-4d4e-83e7-9b69e0a879ef/job_41e7002f55a128f646117fc14cf858a1_op_StreamMap_7d23c6ceabda05a587f0217e44f21301__2_2__uuid_59f43f20-768f-4117-9a3f-4a101a32b1d2.
2018-11-20 11:59:54,724 INFO  org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend  - Deleting existing instance base directory /tmp/flink-io-71851605-f8f2-4d4e-83e7-9b69e0a879ef/job_41e7002f55a128f646117fc14cf858a1_op_StreamMap_7d23c6ceabda05a587f0217e44f21301__1_2__uuid_f3ce6abc-52dc-4fa1-820e-e015daca418c.
2018-11-20 11:59:54,732 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task TumblingWindowOperator (1/2) (3ea121867a218e10137c9bfe9ef991b8).
2018-11-20 11:59:54,732 INFO  org.apache.flink.runtime.taskmanager.Task                     - TumblingWindowOperator (1/2) (3ea121867a218e10137c9bfe9ef991b8) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,732 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code TumblingWindowOperator (1/2) (3ea121867a218e10137c9bfe9ef991b8).
2018-11-20 11:59:54,769 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task TumblingWindowOperator (2/2) (7a117e9804f71c6a995e31616ee05ec9).
2018-11-20 11:59:54,770 INFO  org.apache.flink.runtime.taskmanager.Task                     - TumblingWindowOperator (2/2) (7a117e9804f71c6a995e31616ee05ec9) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,770 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code TumblingWindowOperator (2/2) (7a117e9804f71c6a995e31616ee05ec9).
2018-11-20 11:59:54,789 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task SemanticsCheckMapper -&amp;gt; Sink: Unnamed (1/2) (0a53c5fdd36dffde33ef032b6ffb5307).
2018-11-20 11:59:54,789 INFO  org.apache.flink.runtime.taskmanager.Task                     - SemanticsCheckMapper -&amp;gt; Sink: Unnamed (1/2) (0a53c5fdd36dffde33ef032b6ffb5307) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,789 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code SemanticsCheckMapper -&amp;gt; Sink: Unnamed (1/2) (0a53c5fdd36dffde33ef032b6ffb5307).
2018-11-20 11:59:54,813 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task SemanticsCheckMapper -&amp;gt; Sink: Unnamed (2/2) (a9b08ced9d0d0ed0fb130336340b1a7a).
2018-11-20 11:59:54,813 INFO  org.apache.flink.runtime.taskmanager.Task                     - SemanticsCheckMapper -&amp;gt; Sink: Unnamed (2/2) (a9b08ced9d0d0ed0fb130336340b1a7a) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,813 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code SemanticsCheckMapper -&amp;gt; Sink: Unnamed (2/2) (a9b08ced9d0d0ed0fb130336340b1a7a).
2018-11-20 11:59:54,824 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task SlidingWindowOperator (1/2) (0f6b13316bcfe13e46972d4dd0bc5939).
2018-11-20 11:59:54,824 INFO  org.apache.flink.runtime.taskmanager.Task                     - SlidingWindowOperator (1/2) (0f6b13316bcfe13e46972d4dd0bc5939) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,824 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code SlidingWindowOperator (1/2) (0f6b13316bcfe13e46972d4dd0bc5939).
2018-11-20 11:59:54,831 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task SlidingWindowOperator (2/2) (4b0e279fcf1ce9afb5833731a3844319).
2018-11-20 11:59:54,831 INFO  org.apache.flink.runtime.taskmanager.Task                     - SlidingWindowOperator (2/2) (4b0e279fcf1ce9afb5833731a3844319) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,831 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code SlidingWindowOperator (2/2) (4b0e279fcf1ce9afb5833731a3844319).
2018-11-20 11:59:54,844 INFO  org.apache.flink.runtime.taskmanager.Task                     - Attempting to cancel task SlidingWindowCheckMapper -&amp;gt; Sink: Unnamed (1/2) (f269b77a22ea33b41d58a276154fff75).
2018-11-20 11:59:54,844 INFO  org.apache.flink.runtime.taskmanager.Task                     - SlidingWindowCheckMapper -&amp;gt; Sink: Unnamed (1/2) (f269b77a22ea33b41d58a276154fff75) switched from RUNNING to CANCELING.
2018-11-20 11:59:54,844 INFO  org.apache.flink.runtime.taskmanager.Task                     - Triggering cancellation of task code SlidingWindowCheckMapper -&amp;gt; Sink: Unnamed (1/2) (f269b77a22ea33b41d58a276154fff75).
2018-11-20 11:59:54,857 INFO  org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend  - Deleting existing instance base directory /tmp/flink-io-71851605-f8f2-4d4e-83e7-9b69e0a879ef/job_41e7002f55a128f646117fc14cf858a1_op_WindowOperator_0b63e7dd9fb1948bf052174673e64274__1_2__uuid_f01e3e36-565e-4680-b7d8-1f30e6a64474.
2018-11-20 11:59:54,742 INFO  org.apache.flink.streaming.api.operators.AbstractStreamOperator  - Could not complete snapshot 12 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; ArtificalKeyedStateMapper_Kryo_and_Custom_Stateful (1/2).
java.io.IOException: Cannot register Closeable, registry is already closed. Closing argument.
	at org.apache.flink.util.AbstractCloseableRegistry.registerCloseable(AbstractCloseableRegistry.java:85)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable$AsyncSnapshotTask.&amp;lt;init&amp;gt;(AsyncSnapshotCallable.java:123)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable$AsyncSnapshotTask.&amp;lt;init&amp;gt;(AsyncSnapshotCallable.java:111)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable.toAsyncSnapshotFutureTask(AsyncSnapshotCallable.java:105)
	at org.apache.flink.contrib.streaming.state.snapshot.RocksIncrementalSnapshotStrategy.doSnapshot(RocksIncrementalSnapshotStrategy.java:164)
	at org.apache.flink.contrib.streaming.state.snapshot.RocksDBSnapshotStrategyBase.snapshot(RocksDBSnapshotStrategyBase.java:128)
	at org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend.snapshot(RocksDBKeyedStateBackend.java:496)
	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.snapshotState(AbstractStreamOperator.java:407)
	at org.apache.flink.streaming.runtime.tasks.StreamTask$CheckpointingOperation.checkpointStreamOperator(StreamTask.java:1113)
	at org.apache.flink.streaming.runtime.tasks.StreamTask$CheckpointingOperation.executeCheckpointing(StreamTask.java:1055)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.checkpointState(StreamTask.java:729)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.performCheckpoint(StreamTask.java:641)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.triggerCheckpointOnBarrier(StreamTask.java:586)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.notifyCheckpoint(BarrierBuffer.java:396)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.processBarrier(BarrierBuffer.java:292)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.getNextNonBlocked(BarrierBuffer.java:200)
	at org.apache.flink.streaming.runtime.io.StreamInputProcessor.processInput(StreamInputProcessor.java:209)
	at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.run(OneInputStreamTask.java:105)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:300)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:704)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2018-11-20 11:59:54,871 INFO  org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend  - Deleting existing instance base directory /tmp/flink-io-71851605-f8f2-4d4e-83e7-9b69e0a879ef/job_41e7002f55a128f646117fc14cf858a1_op_StreamMap_5271c210329e73bd743f3227edfb3b71__1_2__uuid_0f79c71c-ffe0-4fb6-a16e-a7a7f1c8490d.
2018-11-20 11:59:54,747 INFO  org.apache.flink.streaming.api.operators.AbstractStreamOperator  - Could not complete snapshot 12 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; ArtificalKeyedStateMapper_Kryo_and_Custom_Stateful (2/2).
java.io.IOException: Cannot register Closeable, registry is already closed. Closing argument.
	at org.apache.flink.util.AbstractCloseableRegistry.registerCloseable(AbstractCloseableRegistry.java:85)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable$AsyncSnapshotTask.&amp;lt;init&amp;gt;(AsyncSnapshotCallable.java:123)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable$AsyncSnapshotTask.&amp;lt;init&amp;gt;(AsyncSnapshotCallable.java:111)
	at org.apache.flink.runtime.state.AsyncSnapshotCallable.toAsyncSnapshotFutureTask(AsyncSnapshotCallable.java:105)
	at org.apache.flink.contrib.streaming.state.snapshot.RocksIncrementalSnapshotStrategy.doSnapshot(RocksIncrementalSnapshotStrategy.java:164)
	at org.apache.flink.contrib.streaming.state.snapshot.RocksDBSnapshotStrategyBase.snapshot(RocksDBSnapshotStrategyBase.java:128)
	at org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend.snapshot(RocksDBKeyedStateBackend.java:496)
	at org.apache.flink.streaming.api.operators.AbstractStreamOperator.snapshotState(AbstractStreamOperator.java:407)
	at org.apache.flink.streaming.runtime.tasks.StreamTask$CheckpointingOperation.checkpointStreamOperator(StreamTask.java:1113)
	at org.apache.flink.streaming.runtime.tasks.StreamTask$CheckpointingOperation.executeCheckpointing(StreamTask.java:1055)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.checkpointState(StreamTask.java:729)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.performCheckpoint(StreamTask.java:641)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.triggerCheckpointOnBarrier(StreamTask.java:586)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.notifyCheckpoint(BarrierBuffer.java:396)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.processBarrier(BarrierBuffer.java:292)
	at org.apache.flink.streaming.runtime.io.BarrierBuffer.getNextNonBlocked(BarrierBuffer.java:200)
	at org.apache.flink.streaming.runtime.io.StreamInputProcessor.processInput(StreamInputProcessor.java:209)
	at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.run(OneInputStreamTask.java:105)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:300)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:704)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2018-11-20 11:59:54,875 INFO  org.apache.flink.contrib.streaming.state.RocksDBKeyedStateBackend  - Deleting existing instance base directory /tmp/flink-io-71851605-f8f2-4d4e-83e7-9b69e0a879ef/job_41e7002f55a128f646117fc14cf858a1_op_StreamMap_5271c210329e73bd743f3227edfb3b71__2_2__uuid_f09e971f-8542-4f0b-9abe-644d702f235f.
2018-11-20 11:59:54,873 INFO  org.apache.flink.runtime.taskmanager.Task                     - ArtificalKeyedStateMapper_Avro -&amp;gt; ArtificalOperatorStateMapper (1/2) (3e5842c071706a82194c67143f6f4a60) switched from CANCELING to CANCELED.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13199572">FLINK-10946</key>
            <summary>Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="azagrebin">Andrey Zagrebin</assignee>
                                    <reporter username="azagrebin">Andrey Zagrebin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 20 Nov 2018 10:40:08 +0000</created>
                <updated>Tue, 4 Dec 2018 15:06:27 +0000</updated>
                            <resolved>Tue, 4 Dec 2018 15:06:27 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Test Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16693429" author="till.rohrmann" created="Tue, 20 Nov 2018 16:14:30 +0000"  >&lt;p&gt;Might be another instance but the exception is not visible from the printed logs because they are too long: &lt;a href=&quot;https://api.travis-ci.org/v3/job/457395823/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/457395823/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16694665" author="githubbot" created="Wed, 21 Nov 2018 12:44:58 +0000"  >&lt;p&gt;azagrebin opened a new pull request #7154: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not runnning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7154&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   When job is canceled, task closable registry is closed asynchronously and checkpoints cannot register with it any more from main thread. This leads to logging error message. The PR changes the behaviour and generates error only if job is still running, assuming that after cancelation checkpoint errors are not relevant any more.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw exception in AbstractStreamOperator.snapshotState only if job is still running.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   in loop (failure was flaky):&lt;br/&gt;
   cd flink-end-to-end-tests&lt;br/&gt;
   ./run-single-test.sh test-scripts/test_resume_externalized_checkpoints.sh 2 4 rocks true true&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16694666" author="githubbot" created="Wed, 21 Nov 2018 12:45:07 +0000"  >&lt;p&gt;azagrebin commented on issue #7154: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not runnning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7154#issuecomment-440650084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7154#issuecomment-440650084&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   cc @StefanRRichter &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16695166" author="githubbot" created="Wed, 21 Nov 2018 19:36:31 +0000"  >&lt;p&gt;azagrebin commented on issue #7154: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not runnning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7154#issuecomment-440785486&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7154#issuecomment-440785486&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   passed in my CI:&lt;br/&gt;
   &lt;a href=&quot;https://travis-ci.org/azagrebin/flink/builds/458023830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/azagrebin/flink/builds/458023830&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16695687" author="githubbot" created="Thu, 22 Nov 2018 09:05:32 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #7154: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not runnning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7154#discussion_r235645849&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7154#discussion_r235645849&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -416,8 +416,10 @@ public final OperatorSnapshotFutures snapshotState(long checkpointId, long times&lt;br/&gt;
 			String snapshotFailMessage = &quot;Could not complete snapshot &quot; + checkpointId + &quot; for operator &quot; +&lt;br/&gt;
 				getOperatorName() + &quot;.&quot;;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.info(snapshotFailMessage, snapshotException);&lt;/li&gt;
	&lt;li&gt;throw new Exception(snapshotFailMessage, snapshotException);&lt;br/&gt;
+			if (!getContainingTask().isCanceled()) {&lt;br/&gt;
+				LOG.info(snapshotFailMessage, snapshotException);&lt;br/&gt;
+				throw new Exception(snapshotFailMessage, snapshotException);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I think we should throw the exception in any case, so as to not return any value here. That also matches the previous behaviour, only the logging was added and needs to be guarded, the exception is already silenced.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16695856" author="githubbot" created="Thu, 22 Nov 2018 12:36:17 +0000"  >&lt;p&gt;azagrebin commented on issue #7154: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not runnning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7154#issuecomment-441017675&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7154#issuecomment-441017675&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks @StefanRRichter! I changed it, please have another look&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697339" author="githubbot" created="Fri, 23 Nov 2018 16:36:19 +0000"  >&lt;p&gt;StefanRRichter closed pull request #7154: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not runnning&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7154&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
index 04489b0ffd9..d9a195cb235 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
@@ -416,7 +416,9 @@ public final OperatorSnapshotFutures snapshotState(long checkpointId, long times&lt;br/&gt;
 			String snapshotFailMessage = &quot;Could not complete snapshot &quot; + checkpointId + &quot; for operator &quot; +&lt;br/&gt;
 				getOperatorName() + &quot;.&quot;;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.info(snapshotFailMessage, snapshotException);&lt;br/&gt;
+			if (!getContainingTask().isCanceled()) 
{
+				LOG.info(snapshotFailMessage, snapshotException);
+			}
&lt;p&gt; 			throw new Exception(snapshotFailMessage, snapshotException);&lt;br/&gt;
 		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;






&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697350" author="srichter" created="Fri, 23 Nov 2018 16:40:50 +0000"  >&lt;p&gt;Merged in:&lt;br/&gt;
master: 6e62ca2793&lt;br/&gt;
release-1.7: 8cf611e525&lt;/p&gt;</comment>
                            <comment id="16702186" author="till.rohrmann" created="Wed, 28 Nov 2018 17:44:23 +0000"  >&lt;p&gt;Would this fix also be relevant for &lt;tt&gt;release-1.6&lt;/tt&gt; and &lt;tt&gt;release-1.5&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16704709" author="githubbot" created="Fri, 30 Nov 2018 13:08:55 +0000"  >&lt;p&gt;azagrebin opened a new pull request #7204: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not running&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7204&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   release 1.6 back port of #7154&lt;br/&gt;
   cc @tillrohrmann &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704717" author="azagrebin" created="Fri, 30 Nov 2018 13:12:28 +0000"  >&lt;p&gt;The hotfix introduced this log message for 1.7/1.6, I do not see it in release-1.5.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/7204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt; is PR for 1.6&lt;/p&gt;</comment>
                            <comment id="16708829" author="githubbot" created="Tue, 4 Dec 2018 15:06:02 +0000"  >&lt;p&gt;tillrohrmann closed pull request #7204: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10946&quot; title=&quot;Resuming Externalized Checkpoint (rocks, incremental, scale up) end-to-end test failed on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10946&quot;&gt;&lt;del&gt;FLINK-10946&lt;/del&gt;&lt;/a&gt; Silent checkpoint async failures in task executor if job is not running&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7204&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
index f0ea6d41610..6f8918d41ae 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java&lt;br/&gt;
@@ -415,7 +415,9 @@ public final OperatorSnapshotFutures snapshotState(long checkpointId, long times&lt;br/&gt;
 			String snapshotFailMessage = &quot;Could not complete snapshot &quot; + checkpointId + &quot; for operator &quot; +&lt;br/&gt;
 				getOperatorName() + &quot;.&quot;;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.info(snapshotFailMessage, snapshotException);&lt;br/&gt;
+			if (!getContainingTask().isCanceled()) 
{
+				LOG.info(snapshotFailMessage, snapshotException);
+			}
&lt;p&gt; 			throw new Exception(snapshotFailMessage, snapshotException);&lt;br/&gt;
 		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;






&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16708830" author="till.rohrmann" created="Tue, 4 Dec 2018 15:06:27 +0000"  >&lt;p&gt;Fixed in 1.6.3: &lt;a href=&quot;https://github.com/apache/flink/commit/fe967acbba2143d7f9facd2d6ac884649a87782a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/fe967acbba2143d7f9facd2d6ac884649a87782a&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13199298">FLINK-10927</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00ozk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>