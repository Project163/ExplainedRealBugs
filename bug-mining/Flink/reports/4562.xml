<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:49:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19244] CSV format can&apos;t deserialize null ROW field</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19244</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;CREATE TABLE csv_table (&lt;br/&gt;
 f0 ROW&amp;lt;f0c0 VARCHAR, f0c1 VARCHAR&amp;gt;,&lt;br/&gt;
 f1 ROW&amp;lt;f1c0 INT, f1c1 VARCHAR&amp;gt;&lt;br/&gt;
 )&lt;/p&gt;

&lt;p&gt;If f0 is null and f1c0=123, f1c1=456, the serialized data will be: ,123;456&lt;br/&gt;
When deserialize the data, the jsonNode of f0 would be [], then throws cast exception: Row length mismatch. 2 fields expected but was 0.&lt;/p&gt;

&lt;p&gt;In the real scene, I set two streams:&lt;br/&gt;
 First, read json_table, sink to csv_table, which has the schema above.&lt;br/&gt;
 Then, read csv_table, do sth.&lt;/p&gt;

&lt;p&gt;if json is {&quot;f0&quot;: null, &quot;f1&quot;: {&quot;f1c0&quot;: 123, &quot;f1c1&quot;: 456}}, the second streams failed with the exception.&lt;/p&gt;

&lt;p&gt;If this is a bug, I want to help to fix this and unittests.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;here is the&#160; test code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;val subDataType0 = ROW(
  FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;f0c0&quot;&lt;/span&gt;, STRING()),
  FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;f0c1&quot;&lt;/span&gt;, STRING())
)
val subDataType1 = ROW(
  FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;f1c0&quot;&lt;/span&gt;, INT()),
  FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;f1c1&quot;&lt;/span&gt;, INT())
)
val datatype = ROW(
  FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;f0&quot;&lt;/span&gt;, subDataType0),
  FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;, subDataType1))
val rowType = datatype.getLogicalType.asInstanceOf[RowType]

val serSchema = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CsvRowDataSerializationSchema.Builder(rowType).build()
val deserSchema = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CsvRowDataDeserializationSchema.Builder(rowType, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RowDataTypeInfo(rowType)).build()
def foo(r: RowData): Unit = {
  val serData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(serSchema.serialize(r))
  print(s&lt;span class=&quot;code-quote&quot;&gt;&quot;${serData}&quot;&lt;/span&gt;)
  val deserRow = deserSchema.deserialize(serData.getBytes)
  println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;${deserRow}&quot;&lt;/span&gt;)
}

val normalRowData = GenericRowData.of(
  GenericRowData.of(BinaryStringData.fromString(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;), BinaryStringData.fromString(&lt;span class=&quot;code-quote&quot;&gt;&quot;world&quot;&lt;/span&gt;)),
  GenericRowData.of(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(123), &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(456))
)
&lt;span class=&quot;code-comment&quot;&gt;// correct.
&lt;/span&gt;foo(normalRowData)

val nullRowData = GenericRowData.of(
  &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
  GenericRowData.of(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(123), &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(456))
)
/*
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.io.IOException: Failed to deserialize CSV row &apos;,123;456
...
Caused by: java.lang.RuntimeException: Row length mismatch. 2 fields expected but was 0.
 */
foo(nullRowData)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13327678">FLINK-19244</key>
            <summary>CSV format can&apos;t deserialize null ROW field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yingz">Ying Z</assignee>
                                    <reporter username="yingz">Ying Z</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 15 Sep 2020 13:21:36 +0000</created>
                <updated>Fri, 19 Feb 2021 07:21:26 +0000</updated>
                            <resolved>Tue, 22 Sep 2020 03:48:24 +0000</resolved>
                                    <version>1.11.2</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17196630" author="jark" created="Wed, 16 Sep 2020 02:36:46 +0000"  >&lt;p&gt;You can try to set &lt;tt&gt;ignoreParseErrors&lt;/tt&gt; to &lt;tt&gt;true&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17196631" author="jark" created="Wed, 16 Sep 2020 02:37:16 +0000"  >&lt;p&gt;Btw, CSV is not a good format to handle nested types. &lt;/p&gt;</comment>
                            <comment id="17196636" author="yingz" created="Wed, 16 Sep 2020 02:59:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;ignoreParseErrors=true will skip this record&lt;/p&gt;

&lt;p&gt;x = serialize( y) means y = deserialize( x), so is deserialize(&apos;,123;456&apos;) = originalRowData maybe better?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I totally agree with &apos;CSV is not a good format to handle nested types&apos;. I apply this to compat with the legacy code, which uses csv format for less space and more visible.&lt;/p&gt;</comment>
                            <comment id="17196647" author="jark" created="Wed, 16 Sep 2020 03:19:47 +0000"  >&lt;p&gt;I think we can add a check in &lt;tt&gt;org.apache.flink.formats.csv.CsvRowDataDeserializationSchema#createRowConverter&lt;/tt&gt;, when the &lt;tt&gt;jsonNode.size()&lt;/tt&gt; is 0, we can return a null RowData directly. &lt;/p&gt;</comment>
                            <comment id="17196668" author="yingz" created="Wed, 16 Sep 2020 04:31:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks for your advice, this will lead the user to use format like json/arvo/protobuf for nested types too&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17198768" author="yingz" created="Sat, 19 Sep 2020 15:41:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;br/&gt;
I try to pull a request, and cloud you help to assign this ticket? Thanks.&lt;/p&gt;</comment>
                            <comment id="17199785" author="jark" created="Tue, 22 Sep 2020 03:48:24 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 83795aaeaa2519627a403715b904c4c0c1c90710&lt;/li&gt;
	&lt;li&gt;release-1.11: 1ba6c7e591d838beaf74e932e919575a78ef9302&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0imeg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>