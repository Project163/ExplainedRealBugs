<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:29:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7294] mesos.resourcemanager.framework.role not working</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7294</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I am using the above said setting in flink-conf.yaml&lt;br/&gt;
e.g.&lt;br/&gt;
mesos.resourcemanager.framework.role: mesos_role_tasks&lt;/p&gt;

&lt;p&gt;I see a flink-scheduler registered in mesos/frameworks tab with above said role.&lt;br/&gt;
But the scheduler fails to launch any tasks inspite of getting resource-offers from mesos-agents with correct role.&lt;/p&gt;

&lt;p&gt;The error seen is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2017-07-28 13:23:00,683 INFO  org.apache.flink.mesos.runtime.clusterframework.MesosFlinkResourceManager  - Mesos task taskmanager-03768 failed, with a TaskManager in launch or registration. State: TASK_ERROR Reason: REASON_TASK_INVALID (Task uses more resources cpus(\*):1; mem(\*):1024; ports(\*):[4006-4007] than available cpus(mesos_role_tasks):7.4; mem(mesos_role_tasks):45876; ports(mesos_role_tasks):[4002-4129, 4131-4380, 4382-4809, 4811-4957, 4959-4966, 4968-4979, 4981-5049, 31000-31196, 31198-31431, 31433-31607, 31609-32000]; ephemeral_storage(mesos_role_tasks):37662; efs_storage(mesos_role_tasks):8.79609e+12; disk(mesos_role_tasks):5115)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The request is made for resources with * role. We do not have mesos running anywhere with * role. Thus task manager never come up. &lt;/p&gt;

&lt;p&gt;Am I missing any configuration?&lt;/p&gt;

&lt;p&gt;I am using flink version 1.3.1&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13090776">FLINK-7294</key>
            <summary>mesos.resourcemanager.framework.role not working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eronwright">Eron Wright</assignee>
                                    <reporter username="bbayani">Bhumika Bayani</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jul 2017 13:26:03 +0000</created>
                <updated>Mon, 12 Mar 2018 15:29:05 +0000</updated>
                            <resolved>Mon, 12 Mar 2018 15:29:05 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Deployment / Mesos</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16106860" author="bbayani" created="Mon, 31 Jul 2017 06:29:08 +0000"  >&lt;p&gt;My Mesos version is 1.0.0&lt;br/&gt;
Also, i am using docker images to start flink cluster on mesos, and not installing the flink binaries on mesos-agents directly.&lt;/p&gt;

&lt;p&gt;Does that make any difference?&lt;/p&gt;

&lt;p&gt;Can someone please take a look and respond on this on priority?&lt;/p&gt;

</comment>
                            <comment id="16107013" author="aljoscha" created="Mon, 31 Jul 2017 09:17:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eronwright&quot; class=&quot;user-hover&quot; rel=&quot;eronwright&quot;&gt;eronwright&lt;/a&gt;, do you have any idea what could be going on here?&lt;/p&gt;</comment>
                            <comment id="16107719" author="eronwright" created="Mon, 31 Jul 2017 18:17:45 +0000"  >&lt;p&gt;It looks to be a code defect, that Flink is registering to be offered resources from a certain role, but doesn&apos;t properly accept them.&lt;/p&gt;

&lt;p&gt;The fix would likely involve adding role information to the resources that are added to the `TaskInfo`.  The `scalar` helper method should be amended to take a `role` argument, whose value would be drawn from the `mesosConfiguration`.  See:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/blob/release-1.3.1/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/LaunchableMesosWorker.java#L197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LaunchableMesosWorker&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16147030" author="githubbot" created="Wed, 30 Aug 2017 10:23:27 +0000"  >&lt;p&gt;GitHub user bbayani opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7294&quot; title=&quot;mesos.resourcemanager.framework.role not working&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7294&quot;&gt;&lt;del&gt;FLINK-7294&lt;/del&gt;&lt;/a&gt;:&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-mesos&amp;#93;&lt;/span&gt; mesos.resourcemanager.framework.role not working&lt;/p&gt;

&lt;p&gt;    Jira Issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7294&quot; title=&quot;mesos.resourcemanager.framework.role not working&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7294&quot;&gt;&lt;del&gt;FLINK-7294&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;br/&gt;
    This pull request uses role set in mesos.resourcemanager.framework.role and applies it for resources such as CPU, mem, ports.  Due to this framework considers resource offers coming from mesos-agents with specified role and is able to spawn up task-managers on mesos-agent running with specific role that role *. &lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Updated Utils.java to take in role information for constructing scalar / ranges resource values.&lt;/li&gt;
	&lt;li&gt;Updated LaunchableMesosWorker to use framework role set in config.&lt;/li&gt;
	&lt;li&gt;Updated tests in LaunchCoordinatorTest.scala to pass role argument.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;br/&gt;
    Part of change is already covered by existing tests, such as  LaunchCoordinatorTest.scala.&lt;br/&gt;
    Also, manually verified the change by running a flink-mesos cluster with 1 job-manager and 3 task-managers. The flink was deployed on a mesos-cluster where mesos-workers were running with specific role and not role &apos;*&apos;.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency):  no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`:  no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: yes, it affects deployment on Mesos.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? not documented&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @EronWright : PTAL. Thanks!&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bbayani/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bbayani/flink&lt;/a&gt; mesos_role_issue&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4622&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 883c3866302b8073b60403b65c3aac85759b891c&lt;br/&gt;
Author: bbayani &amp;lt;bbayani@cisco.com&amp;gt;&lt;br/&gt;
Date:   2017-08-30T09:54:54Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7294&quot; title=&quot;mesos.resourcemanager.framework.role not working&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7294&quot;&gt;&lt;del&gt;FLINK-7294&lt;/del&gt;&lt;/a&gt;:mesos.resourcemanager.framework.role not working&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16162571" author="githubbot" created="Tue, 12 Sep 2017 06:38:37 +0000"  >&lt;p&gt;Github user bbayani commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Can flink-mesos contributors/owners please take a look at this PR? &lt;/p&gt;</comment>
                            <comment id="16163147" author="githubbot" created="Tue, 12 Sep 2017 15:47:41 +0000"  >&lt;p&gt;Github user EronWright commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @bbayani thanks very much for this contribution.  Please confirm my understanding of the issue and verification.   It appears that the resources that are requested via `TaskInfo` must reference the framework role, otherwise the resources are actually drawn from the unreserved pool.   Your cluster is configured such that all resources are reserved for a certain role, and so Flink is unable to launch without this fix despite being configured to use the role.&lt;/p&gt;

&lt;p&gt;    Have you verified correct behavior in the case where Flink&apos;s role is not configured (and there is unreserved capacity)?  Is the `TaskInfo` role set to `*` and is that correct?&lt;/p&gt;</comment>
                            <comment id="16164522" author="githubbot" created="Wed, 13 Sep 2017 11:37:02 +0000"  >&lt;p&gt;Github user bbayani commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @EronWright Yes, I have verified the case when mesos.resourcemanager.framework.role is not configured in flink-conf.yaml (and thus defaults to *). In this case, it launched all the tasks only on worker running with role *.&lt;/p&gt;
</comment>
                            <comment id="16164915" author="githubbot" created="Wed, 13 Sep 2017 16:32:55 +0000"  >&lt;p&gt;Github user EronWright commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann please take a look and merge if you&apos;re OK with it.&lt;/p&gt;</comment>
                            <comment id="16165987" author="githubbot" created="Thu, 14 Sep 2017 09:18:18 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the contribution @bbayani and the review @EronWright. Changes look good to me. Will merge the fix and backport it to the `1.3` release branch.&lt;/p&gt;</comment>
                            <comment id="16166109" author="githubbot" created="Thu, 14 Sep 2017 11:32:27 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4622&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16166202" author="till.rohrmann" created="Thu, 14 Sep 2017 12:54:57 +0000"  >&lt;p&gt;1.4.0: 041b72c8085c6a173ed49aca677c620485800cf8&lt;br/&gt;
1.3.3: c9d617b58f9b0ba373df86ba66aadba07b278c21&lt;/p&gt;</comment>
                            <comment id="16272120" author="eronwright" created="Thu, 30 Nov 2017 03:39:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbayani&quot; class=&quot;user-hover&quot; rel=&quot;bbayani&quot;&gt;bbayani&lt;/a&gt; I believe the fix we came up with is not correct.   Looking at this bug again, it appears that you were using a reservation (static or dynamic, doesn&apos;t matter) and finding that Flink was unable to use _reserved _resources.  Unfortunately the fix has reversed the situation, and Flink is now unable to use _unreserved _resources.   We must find a solution that works for both situations.  Do you agree with my characterization?  Thanks.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8174&quot; title=&quot;Mesos RM unable to accept offers for unreserved resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8174&quot;&gt;&lt;del&gt;FLINK-8174&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16272190" author="bbayani" created="Thu, 30 Nov 2017 05:33:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eronwright&quot; class=&quot;user-hover&quot; rel=&quot;eronwright&quot;&gt;eronwright&lt;/a&gt;, &lt;br/&gt;
As per this link &lt;a href=&quot;http://mesos.apache.org/documentation/latest/roles/#default-role&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mesos.apache.org/documentation/latest/roles/#default-role&lt;/a&gt;, the unreserved resources are assigned to &quot;*&quot; role by default. So the fix should have worked even for unreserved resources as per me. I remember testing this with mesos 1.0.&lt;/p&gt;

&lt;p&gt;If that is not the case, i.e. unreserved resources are not assigned to * role by default, this fix wont work and we will need a fix that works for both conditions.&lt;/p&gt;</comment>
                            <comment id="16274705" author="eronwright" created="Fri, 1 Dec 2017 18:01:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbayani&quot; class=&quot;user-hover&quot; rel=&quot;bbayani&quot;&gt;bbayani&lt;/a&gt; I too thought it would be fine but upon further investigation found that `Resource::setRole` actually means, &apos;draw the resources from a reservation associated with role such-and-such&apos;.  In fact, `setRole` is deprecated in favor of a more elaborate reservations structure.&lt;/p&gt;

&lt;p&gt;We&apos;re now looking for a fix that will cover all scenarios.  Feel free to email me directly to discuss this further.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i4tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>