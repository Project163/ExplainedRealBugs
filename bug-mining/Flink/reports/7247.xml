<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-33000] SqlGatewayServiceITCase should utilize TestExecutorExtension instead of using a ThreadFactory</title>
                <link>https://issues.apache.org/jira/browse/FLINK-33000</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;SqlGatewayServiceITCase&lt;/tt&gt; uses a &lt;tt&gt;ExecutorThreadFactory&lt;/tt&gt; for its asynchronous operations. Instead, one should use &lt;tt&gt;TestExecutorExtension&lt;/tt&gt; to ensure proper cleanup of threads.&lt;/p&gt;

&lt;p&gt;We might also want to remove the &lt;tt&gt;AbstractTestBase&lt;/tt&gt; parent class because that uses JUnit4 whereas &lt;tt&gt;SqlGatewayServiceITCase&lt;/tt&gt; is already based on JUnit5&lt;/p&gt;</description>
                <environment></environment>
        <key id="13549158">FLINK-33000</key>
            <summary>SqlGatewayServiceITCase should utilize TestExecutorExtension instead of using a ThreadFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jiabao.sun">jiabao.sun</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>starter</label>
                    </labels>
                <created>Wed, 30 Aug 2023 13:34:55 +0000</created>
                <updated>Thu, 5 Oct 2023 04:49:22 +0000</updated>
                            <resolved>Thu, 5 Oct 2023 04:42:51 +0000</resolved>
                                    <version>1.16.2</version>
                    <version>1.18.0</version>
                    <version>1.17.1</version>
                    <version>1.19.0</version>
                                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                    <fixVersion>1.19.0</fixVersion>
                    <fixVersion>1.18.1</fixVersion>
                                    <component>Table SQL / Gateway</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17762468" author="JIRAUSER302049" created="Wed, 6 Sep 2023 17:39:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt;, I would like to work on this issue as a starter. I would appreciate that if a more detailed background or guidance could be offered&lt;/p&gt;</comment>
                            <comment id="17762707" author="mapohl" created="Thu, 7 Sep 2023 11:42:34 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ade_hddu&quot; class=&quot;user-hover&quot; rel=&quot;ade_hddu&quot;&gt;ade_hddu&lt;/a&gt;, thanks for offering your help. What are things that are still unclear to you?&lt;/p&gt;</comment>
                            <comment id="17762987" author="JIRAUSER302049" created="Fri, 8 Sep 2023 08:08:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt;, I have 2 questions on concrete implementation:&lt;/p&gt;

&lt;p&gt;1. It seems that only &lt;tt&gt;ScheduledThreadPool&lt;/tt&gt;&#160;or&#160;&lt;tt&gt;FixedThreadPool&lt;/tt&gt;&#160;can meet the requirements. Using&#160;&lt;tt&gt;CachedThreadPool&lt;/tt&gt; will result in out-of-order in cancel operation and close operation (because this thread pool is not FIFO by default). Although the test can pass at this time, it will leave a large number of exceptions. It seems that there will be at most 3-4 threads in the thread pool at the same time, so the default single thread pool is also not proper. Can the &lt;tt&gt;corePoolSize&lt;/tt&gt; be hardcoded as 4? like this:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;public static final TestExecutorExtension&amp;lt;ExecutorService&amp;gt; EXECUTOR_EXTENSION =&lt;br/&gt;
new TestExecutorExtension&amp;lt;&amp;gt;(() -&amp;gt; Executors.newScheduledThreadPool(4));&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m not really sure that if hardcoding is allowed here.&lt;/p&gt;

&lt;p&gt;2.&#160;The &lt;tt&gt;AbstractTestBase&lt;/tt&gt; class still seems to be inherited by many other Test classes, is there any risk to remove this class? The &lt;tt&gt;SQLGatewayServiceITCase&lt;/tt&gt; class does not inherit any other class, I&apos;m not quite sure which abstract class I should delete and the relation between the use of JUnit5 in this class and the removal of &lt;tt&gt;AbstractTestBase&lt;/tt&gt; .&lt;/p&gt;</comment>
                            <comment id="17762993" author="mapohl" created="Fri, 8 Sep 2023 08:25:50 +0000"  >&lt;p&gt;Thanks for looking into it more closely. I&apos;m not 100% whether I fully understand the requirements you&apos;re talking about: My understanding is that the test creates threads to trigger concurrent behavior (e.g. in line &lt;a href=&quot;https://github.com/apache/flink/blob/c9e87fe410c42f7e7c19c81456d4212a58564f5e/flink-table/flink-sql-gateway/src/test/java/org/apache/flink/table/gateway/service/SqlGatewayServiceITCase.java#L1073&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;line 1073&lt;/a&gt;) without cleaning those threads up. The intention of this Jira was to do an explicit shutdown to clean up any threads that still linger around. Where do we have the requirement in the test code for a fixed number of threads?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2. The AbstractTestBase class still seems to be inherited by many other Test classes, is there any risk to remove this class? The SQLGatewayServiceITCase class does not inherit any other class, I&apos;m not quite sure which abstract class I should delete and the relation between the use of JUnit5 in this class and the removal of AbstractTestBase .&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I might have been a bit vague on removing the &lt;tt&gt;AbstractTestBase&lt;/tt&gt;. I didn&apos;t mean to delete the class. You&apos;re totally correct that this class is used in other places. My concern was that &lt;tt&gt;AbstractTestBase&lt;/tt&gt; provides JUnit4 functionality but &lt;tt&gt;SqlGatewayServiceITCase&lt;/tt&gt; is a JUnit5-based test. My suggestion would have been to remove &lt;tt&gt;AbstractTestBase&lt;/tt&gt; from &lt;tt&gt;SqlGatewayServiceITCase&lt;/tt&gt; as a parent and use JUnit5 functionality instead (&lt;tt&gt;MiniClusterExtension&lt;/tt&gt; for instance). Does that make sense?&lt;/p&gt;

&lt;p&gt;and just as a FYI: I might not be responsive the next two weeks.&lt;/p&gt;</comment>
                            <comment id="17763013" author="JIRAUSER302049" created="Fri, 8 Sep 2023 10:29:54 +0000"  >&lt;p&gt;Thanks for the quick reply. In terms of the fixed number of threads, I have noticed that in &lt;a href=&quot;https://github.com/apache/flink/blob/c9e87fe410c42f7e7c19c81456d4212a58564f5e/flink-table/flink-sql-gateway/src/test/java/org/apache/flink/table/gateway/service/SqlGatewayServiceITCase.java#L833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;testSubmitOperationAndCloseOperationManagerInParallel2()&lt;/tt&gt;&lt;/a&gt; , 3 threads are opened and they wait the same &lt;tt&gt;CountDownLatch&lt;/tt&gt;.&#160; I&apos;m not sure if these 3 threads should all start to wait for &lt;tt&gt;OperationManager&lt;/tt&gt; to close, because &lt;tt&gt;startRunning&lt;/tt&gt; lock is only set at 1, which is a little confusing to me. If it is ok to keep only 1 thread alive, the default &lt;tt&gt;TestExcutorExtension&lt;/tt&gt; with single thread pool can be used.&lt;/p&gt;


&lt;p&gt;As for the &lt;tt&gt;AbstractTextBase&lt;/tt&gt;,&#160; I think &lt;tt&gt;SqlGatewayServiceITcase&lt;/tt&gt; is not a child of AbstractTestBase now.&#160; &lt;tt&gt;AbstractTestBase&lt;/tt&gt; doesn&apos;t occur in the code and it seems that JUnit5 functionality has been already used.&lt;/p&gt;</comment>
                            <comment id="17767488" author="jiabao.sun" created="Thu, 21 Sep 2023 09:58:17 +0000"  >&lt;p&gt;I think the OperationManagerTest, ResultFetcherTest should do the same change as well.&lt;/p&gt;</comment>
                            <comment id="17769470" author="fsk119" created="Wed, 27 Sep 2023 08:21:45 +0000"  >&lt;p&gt;Merged into master:&lt;/p&gt;

&lt;p&gt;de6c66ea805760f1550ae1fa348630edd9f17256&lt;br/&gt;
73717520cc63df8bd08fd008ac004659b210cfd1&lt;br/&gt;
de6c66ea805760f1550ae1fa348630edd9f17256&lt;/p&gt;

&lt;p&gt;TODO:&lt;/p&gt;

&lt;p&gt;Merged into release 1.18/1.17/1.16&lt;/p&gt;</comment>
                            <comment id="17771803" author="mapohl" created="Wed, 4 Oct 2023 10:23:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; are you taking care of the backports as well?&lt;/p&gt;</comment>
                            <comment id="17771922" author="jiabao.sun" created="Wed, 4 Oct 2023 16:56:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt;.&lt;br/&gt;
The PRs for release 1.18/1.17/1.16 is ready now.&lt;br/&gt;
Please help review it when you have time.&lt;/p&gt;</comment>
                            <comment id="17772073" author="mapohl" created="Thu, 5 Oct 2023 04:42:51 +0000"  >&lt;p&gt;Summary of merged changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;master
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/8e68b40d5cf9146a5bccadc67d9636f987003c0f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8e68b40d5cf9146a5bccadc67d9636f987003c0f&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/73717520cc63df8bd08fd008ac004659b210cfd1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;73717520cc63df8bd08fd008ac004659b210cfd1&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/de6c66ea805760f1550ae1fa348630edd9f17256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;de6c66ea805760f1550ae1fa348630edd9f17256&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;1.18
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/70ee020dc01224ee6e7acd63b60c43c2f5d8683f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;70ee020dc01224ee6e7acd63b60c43c2f5d8683f&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/4f11dfb2a70782ae1ae652126066e55a2fe7c945&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4f11dfb2a70782ae1ae652126066e55a2fe7c945&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/5fbf5d5aa192682ed14f22203f3114fe07b1f60f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5fbf5d5aa192682ed14f22203f3114fe07b1f60f&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;1.17
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/69142050e0f844421ccbe0e5173260eb12f26983&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;69142050e0f844421ccbe0e5173260eb12f26983&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/906216a4b541ae6ab413d8499c16f98aac84a592&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;906216a4b541ae6ab413d8499c16f98aac84a592&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/2ad7d97c758622bd095303c8bc5b793f20c7612e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2ad7d97c758622bd095303c8bc5b793f20c7612e&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;1.16
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/7f63abcbb14ec95ac4ea903bbe8519e0973a9bcf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;7f63abcbb14ec95ac4ea903bbe8519e0973a9bcf&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/commit/d9f8c419b89c2011320ef941fafd15526b5715aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;d9f8c419b89c2011320ef941fafd15526b5715aa&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1k3k8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>