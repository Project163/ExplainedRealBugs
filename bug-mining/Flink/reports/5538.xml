<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:58:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23096] HiveParser could not attach the sessionstate of hive</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23096</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;My sql code is as follows&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;CREATE CATALOG myhive WITH (
    &lt;span class=&quot;code-quote&quot;&gt;&apos;type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;hive&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-database&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;hive-conf-dir&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;/home/service/upload-job-file/1624269463008&apos;&lt;/span&gt;
);

use catalog hive;

set &lt;span class=&quot;code-quote&quot;&gt;&apos;table.sql-dialect&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;hive&apos;&lt;/span&gt;;

create view &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists view_test as
select
  &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(goods_id as string) as goods_id,
  &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(depot_id as string) as depot_id,
  &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(product_id as string) as product_id,
  &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(tenant_code as string) as tenant_code
from edw.dim_yezi_whse_goods_base_info&lt;span class=&quot;code-comment&quot;&gt;/*+ OPTIONS(&lt;span class=&quot;code-quote&quot;&gt;&apos;streaming-source.consume-start-offset&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;dayno=20210621&apos;&lt;/span&gt;) */&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the exception is as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;org.apache.flink.client.program.ProgramInvocationException: The main method caused an error: Conf non-local session path expected to be non-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:372)
        at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:222)
        at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:114)
        at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:812)
        at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:246)
        at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:1054)
        at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:1132)
        at org.apache.flink.client.cli.CliFrontend$$Lambda$68/330382173.call(Unknown Source)
        at org.apache.flink.runtime.security.contexts.HadoopSecurityContext$$Lambda$69/680712932.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:422)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1692)
        at org.apache.flink.runtime.security.contexts.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)
        at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1132)
Caused by: java.lang.NullPointerException: Conf non-local session path expected to be non-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:208)
        at org.apache.hadoop.hive.ql.session.SessionState.getHDFSSessionPath(SessionState.java:669)
        at org.apache.flink.table.planner.delegation.hive.HiveParser.clearSessionState(HiveParser.java:376)
        at org.apache.flink.table.planner.delegation.hive.HiveParser.parse(HiveParser.java:219)
        at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeSql(TableEnvironmentImpl.java:724)
        at com.shizhengchao.io.FlinkSqlStreamingPlatform.callFlinkSql(FlinkSqlStreamingPlatform.java:157)
        at com.shizhengchao.io.FlinkSqlStreamingPlatform.callCommand(FlinkSqlStreamingPlatform.java:129)
        at com.shizhengchao.io.FlinkSqlStreamingPlatform.run(FlinkSqlStreamingPlatform.java:91)
        at com.shizhengchao.io.FlinkSqlStreamingPlatform.main(FlinkSqlStreamingPlatform.java:66)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:497)
        at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:355)
        ... 13 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My guess is that sessionstate is not set to threadlocal&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// @see org.apache.hadoop.hive.ql.session.SessionState.setCurrentSessionState
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void setCurrentSessionState(SessionState startSs) {
  tss.get().attach(startSs);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13385171">FLINK-23096</key>
            <summary>HiveParser could not attach the sessionstate of hive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tinny">shizhengchao</assignee>
                                    <reporter username="tinny">shizhengchao</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 22 Jun 2021 13:08:19 +0000</created>
                <updated>Thu, 23 Sep 2021 17:28:29 +0000</updated>
                            <resolved>Thu, 24 Jun 2021 03:34:24 +0000</resolved>
                                    <version>1.13.1</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.2</fixVersion>
                                    <component>Connectors / Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17367327" author="tinny" created="Tue, 22 Jun 2021 13:19:01 +0000"  >&lt;p&gt;This&#160;is the location of the code exception I found:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// @see org.apache.flink.table.planner.delegation.hive.HiveParser
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void clearSessionState(HiveConf hiveConf) {
    SessionState sessionState = SessionState.get();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sessionState != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            sessionState.close();
            List&amp;lt;Path&amp;gt; toDelete = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
            toDelete.add(SessionState.getHDFSSessionPath(hiveConf));
            toDelete.add(SessionState.getLocalSessionPath(hiveConf));
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Path path : toDelete) {
                FileSystem fs = path.getFileSystem(hiveConf);
                fs.delete(path, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error closing SessionState&quot;&lt;/span&gt;, e);
        }
    }
}

&lt;span class=&quot;code-comment&quot;&gt;// @see org.apache.hadoop.hive.ql.session.SessionState
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Path getHDFSSessionPath(Configuration conf) {
  SessionState ss = SessionState.get();
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ss == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sessionPathString = conf.get(HDFS_SESSION_PATH_KEY);
    Preconditions.checkNotNull(sessionPathString,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Conf non-local session path expected to be non-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(sessionPathString);
  }
  Preconditions.checkNotNull(ss.hdfsSessionPath,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;Non-local session path expected to be non-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ss.hdfsSessionPath;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17367832" author="tinny" created="Wed, 23 Jun 2021 03:06:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void clearSessionState(HiveConf hiveConf) {
    SessionState sessionState = SessionState.get();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sessionState != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            sessionState.close();
            List&amp;lt;Path&amp;gt; toDelete = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
            toDelete.add(SessionState.getHDFSSessionPath(hiveConf));
            toDelete.add(SessionState.getLocalSessionPath(hiveConf));
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Path path : toDelete) {
                FileSystem fs = path.getFileSystem(hiveConf);
                fs.delete(path, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error closing SessionState&quot;&lt;/span&gt;, e);
        }
    }

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Path getHDFSSessionPath(Configuration conf) {
    SessionState ss = SessionState.get();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ss == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sessionPathString = conf.get(HDFS_SESSION_PATH_KEY);
      Preconditions.checkNotNull(sessionPathString,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;Conf non-local session path expected to be non-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(sessionPathString);
    }
    Preconditions.checkNotNull(ss.hdfsSessionPath,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Non-local session path expected to be non-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ss.hdfsSessionPath;
  }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;beacuse the session is closed&#65292;so SessionState.get() is null.&lt;/p&gt;</comment>
                            <comment id="17367969" author="tinny" created="Wed, 23 Jun 2021 08:43:01 +0000"  >&lt;p&gt;The&#160; &lt;b&gt;clearSessionState&lt;/b&gt; method catches IOException, which causes the root cause to be overwritten&#12290;When I caught the Exception, I got the root cause&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.hadoop.security.AccessControlException: Permission denied: user=service, access=WRITE, inode=&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp&quot;&lt;/span&gt;:hdfs:supergroup:drwxr-xr-x
        at org.apache.hadoop.hdfs.server.namenode.DefaultAuthorizationProvider.checkFsPermission(DefaultAuthorizationProvider.java:280)
       ...
        at org.apache.hadoop.hive.ql.exec.Utilities.createDirsWithPermission(Utilities.java:3678)
        at org.apache.hadoop.hive.ql.session.SessionState.createRootHDFSDir(SessionState.java:597)
        at org.apache.hadoop.hive.ql.session.SessionState.createSessionDirs(SessionState.java:554)
        at org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:508)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17368547" author="luoyuxia" created="Thu, 24 Jun 2021 01:46:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tinny&quot; class=&quot;user-hover&quot; rel=&quot;tinny&quot;&gt;tinny&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As the exception shows,&#160;&lt;br/&gt;
java.lang.NullPointerException: Conf non-local session path expected to be non-null&lt;br/&gt;
I think the reason is missing the configuration &apos;_hive.hdfs.session.path&apos;.&lt;/p&gt;

&lt;p&gt;And for the last exception you show,&#160;&lt;br/&gt;
Caused by: org.apache.hadoop.security.AccessControlException: Permission denied: user=service, access=WRITE, inode=&quot;/tmp&quot;:hdfs:supergroup:drwxr-xr-x&lt;br/&gt;
I think the reason is you have no right to access(delete) the file.&lt;/p&gt;</comment>
                            <comment id="17368589" author="lirui" created="Thu, 24 Jun 2021 03:34:24 +0000"  >&lt;p&gt;Fixed in master: 36a05834f0aa0e949138a52e1bb1aa7116767b1a&lt;br/&gt;
Fixed in release-1.13: ea3d085f6b19b6dfb36462650344229c9a3ca70b&lt;/p&gt;</comment>
                            <comment id="17368590" author="lirui" created="Thu, 24 Jun 2021 03:35:22 +0000"  >&lt;p&gt;This is actually a different issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16688&quot; title=&quot;Hive-connector should set SessionState for hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16688&quot;&gt;FLINK-16688&lt;/a&gt;, un-linking it.&lt;/p&gt;</comment>
                            <comment id="17391911" author="leexu" created="Tue, 3 Aug 2021 03:12:29 +0000"  >&lt;p&gt;LocalSessionPath is FileSystem local path;&lt;/p&gt;

&lt;p&gt;path.getFileSystem(hiveConf) is HdfsFileSystem,so delete error.&lt;/p&gt;

&lt;p&gt;I think , use LocalFileSystem to delete&#160;LocalSessionPath.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;org.apache.hadoop.hive.ql.session.SessionState

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void createPath(HiveConf conf, Path path, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; permission, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isLocal, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isCleanUp) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    FsPermission fsPermission = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FsPermission(permission);
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; fs;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isLocal) {
        fs = FileSystem.getLocal(conf);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        fs = path.getFileSystem(conf);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!((FileSystem)fs).exists(path)) {
        ((FileSystem)fs).mkdirs(path, fsPermission);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; dirType = isLocal ? &lt;span class=&quot;code-quote&quot;&gt;&quot;local&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;HDFS&quot;&lt;/span&gt;;
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Created &quot;&lt;/span&gt; + dirType + &lt;span class=&quot;code-quote&quot;&gt;&quot; directory: &quot;&lt;/span&gt; + path.toString());
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isCleanUp) {
        ((FileSystem)fs).deleteOnExit(path);
    }

}

org.apache.flink.table.planner.delegation.hive.HiveParser

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void clearSessionState(HiveConf hiveConf) {
    SessionState sessionState = SessionState.get();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sessionState != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            sessionState.close();
            List&amp;lt;Path&amp;gt; toDelete = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
            toDelete.add(SessionState.getHDFSSessionPath(hiveConf));
            toDelete.add(SessionState.getLocalSessionPath(hiveConf));
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Path path : toDelete) {
                FileSystem fs = path.getFileSystem(hiveConf);
                fs.delete(path, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error closing SessionState&quot;&lt;/span&gt;, e);
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17392631" author="luoyuxia" created="Wed, 4 Aug 2021 01:39:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leexu&quot; class=&quot;user-hover&quot; rel=&quot;leexu&quot;&gt;leexu&lt;/a&gt;&#160; Actual,&#160;path.getFileSystem with return&#160;HdfsFileSystem or&#160;LocalFileSystem according to what the path is. It&apos;ll get&#160;LocalFileSystem for&#160;LocalSessionPath, there should be error when delete the&#160;LocalSessionPath.&lt;/p&gt;</comment>
                            <comment id="17392733" author="leexu" created="Wed, 4 Aug 2021 05:49:41 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;java.lang.IllegalArgumentException: Pathname /C:/Users/merit/AppData/Local/Temp/merit/b6b954c0-78b8-458b-be35-191dcd94d535 from C:/Users/merit/AppData/Local/Temp/merit/b6b954c0-78b8-458b-be35-191dcd94d535 is not a valid DFS filename.java.lang.IllegalArgumentException: Pathname /C:/Users/merit/AppData/Local/Temp/merit/b6b954c0-78b8-458b-be35-191dcd94d535 from C:/Users/merit/AppData/Local/Temp/merit/b6b954c0-78b8-458b-be35-191dcd94d535 is not a valid DFS filename. at org.apache.hadoop.hdfs.DistributedFileSystem.getPathName(DistributedFileSystem.java:196) at org.apache.hadoop.hdfs.DistributedFileSystem.access$000(DistributedFileSystem.java:105) at org.apache.hadoop.hdfs.DistributedFileSystem$12.doCall(DistributedFileSystem.java:638) at org.apache.hadoop.hdfs.DistributedFileSystem$12.doCall(DistributedFileSystem.java:634) at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81) at org.apache.hadoop.hdfs.DistributedFileSystem.delete(DistributedFileSystem.java:634) at org.apache.flink.table.planner.delegation.hive.HiveParser.clearSessionState(HiveParser.java:229) at org.apache.flink.table.planner.delegation.hive.HiveParser.parse(HiveParser.java:108) at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeSql(TableEnvironmentImpl.java:724)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0s6kw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>