<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9211] Job submission via REST/dashboard does not work on Kubernetes</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9211</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When setting up a cluster on Kubernets according to the documentation it is possible to upload jar files but when trying to execute them you get an exception like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.RestHandlerException: org.apache.flink.runtime.client.JobSubmissionException: Failed to submit JobGraph.
    at org.apache.flink.runtime.webmonitor.handlers.JarRunHandler.lambda$handleRequest$2(JarRunHandler.java:113)
    at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)
    at java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:852)
    at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)
    at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)
    at org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RestClient.lambda$submitRequest$1(RestClient.java:196)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:680)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:603)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:563)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:424)
    at org.apache.flink.shaded.netty4.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe$1.run(AbstractNioChannel.java:214)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:120)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:357)
    at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:357)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:111)
    at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:137)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: java.util.concurrent.CompletionException: org.apache.flink.runtime.client.JobSubmissionException: Failed to submit JobGraph.
    at org.apache.flink.client.program.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RestClusterClient.lambda$submitJob$5(RestClusterClient.java:356)
    ... 17 more
Caused by: org.apache.flink.runtime.client.JobSubmissionException: Failed to submit JobGraph.
    ... 18 more
Caused by: java.util.concurrent.CompletionException: org.apache.flink.shaded.netty4.io.netty.channel.ConnectTimeoutException: connection timed out: flink-jobmanager/10.105.154.28:8081
    at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
    at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
    at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:943)
    at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:926)
    ... 15 more
Caused by: org.apache.flink.shaded.netty4.io.netty.channel.ConnectTimeoutException: connection timed out: flink-jobmanager/10.105.154.28:8081
    at org.apache.flink.shaded.netty4.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe$1.run(AbstractNioChannel.java:212)
    ... 7 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13153403">FLINK-9211</key>
            <summary>Job submission via REST/dashboard does not work on Kubernetes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Apr 2018 16:30:41 +0000</created>
                <updated>Thu, 28 Feb 2019 13:34:47 +0000</updated>
                            <resolved>Wed, 2 May 2018 13:20:31 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Command Line Client</component>
                    <component>Runtime / Coordination</component>
                    <component>Runtime / REST</component>
                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16446057" author="aljoscha" created="Fri, 20 Apr 2018 17:30:06 +0000"  >&lt;p&gt;The problem is that some Kubernetes deployments don&apos;t allow a pod to connect to itself using a service that points at the pod itself.&lt;/p&gt;

&lt;p&gt;In the Flink doc, we describe K8s deployments like this:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;deploy JM&lt;/li&gt;
	&lt;li&gt;deploy JM service with name &lt;tt&gt;flink-jobmanager&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;deploy TMs&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All components are configured to think that the hostname of the JM is &lt;tt&gt;flink-jobmanager&lt;/tt&gt; and the TMs can actually connect to that via the service. However, the JM cannot connect to itself via that service. This is a problem because &lt;tt&gt;WebSubmissionException&lt;/tt&gt;, &lt;tt&gt;JarRunHandler&lt;/tt&gt; to be specific, will instantiate a &lt;tt&gt;RestClusterClient&lt;/tt&gt; that tries to submit to &lt;tt&gt;&lt;a href=&quot;http://flink-jobmanager:8081/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink-jobmanager:8081&lt;/a&gt;&lt;/tt&gt;. This will fail.&lt;/p&gt;

&lt;p&gt;A simple fix is to change &lt;tt&gt;WebSubmissionExtension&lt;/tt&gt; to use this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// we always use localhost as the endpoint because we assume that the dispatcher
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// and web submission extension are running on the same machine. We&apos;re using
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// localhost because in some setups (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; example some Kubernetes setups) a machine
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// might not be able to refer back to itself via the externally announced hostname
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SettableLeaderRetrievalService settableLeaderRetrievalService =
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SettableLeaderRetrievalService(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8081&quot;&lt;/span&gt;, HighAvailabilityServices.DEFAULT_LEADER_ID);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, this doesn&apos;t work if the port is changed in the config or if we use &lt;tt&gt;https&lt;/tt&gt;. The code that constructs the proper url can be found here: &lt;a href=&quot;https://github.com/apache/flink/blob/4fa4e8cb364c35ea1807a051929b4604b9d31c2e/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java#L207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/4fa4e8cb364c35ea1807a051929b4604b9d31c2e/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java#L207&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16449539" author="githubbot" created="Tue, 24 Apr 2018 09:41:40 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9211&quot; title=&quot;Job submission via REST/dashboard does not work on Kubernetes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9211&quot;&gt;&lt;del&gt;FLINK-9211&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;REST&amp;#93;&lt;/span&gt; JarRunHandler submits job to Dispatcher via RPC&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR reworks the `JarRunHandler` to submit the job to the dispatcher via RPC, instead of setting up a `RestClusterClient` and going through the client&apos;s job-submission routine.&lt;/p&gt;

&lt;p&gt;    The reasoning is that the existing behavior was causing issues on kubernetes, and this change also removes a special-case as this was the only handler that actively sends out rest requests.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;`JarRunHandler` now has access to `DispatcherGateway`&lt;/li&gt;
	&lt;li&gt;`JarRunHandler` now uploads jar and submits job via RPC&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;run `JarRunHandlerTest`&lt;/li&gt;
	&lt;li&gt;submit job through webUI&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 9211&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5903&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e662220a50ed2f430cfc15082af11ab24f233bf9&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-04-23T10:35:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9211&quot; title=&quot;Job submission via REST/dashboard does not work on Kubernetes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9211&quot;&gt;&lt;del&gt;FLINK-9211&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;REST&amp;#93;&lt;/span&gt; JarRunHandler submits job to Dispatcher via RPC&lt;/p&gt;

&lt;p&gt;commit 51772685541adb185ffebcc5800d4eb6e60d35d3&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-04-24T09:34:11Z&lt;/p&gt;

&lt;p&gt;    add test&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16458388" author="githubbot" created="Mon, 30 Apr 2018 08:15:31 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903#discussion_r184930213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903#discussion_r184930213&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/handlers/JarRunHandler.java &amp;#8212;&lt;br/&gt;
    @@ -105,9 +110,32 @@ public JarRunHandler(&lt;br/&gt;
     			savepointRestoreSettings,&lt;br/&gt;
     			parallelism);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return jobGraphFuture.thenCompose(jobGraph -&amp;gt; restClusterClient&lt;/li&gt;
	&lt;li&gt;.submitJob(jobGraph)&lt;/li&gt;
	&lt;li&gt;.thenApply((jobSubmitResponseBody -&amp;gt; new JarRunResponseBody(jobGraph.getJobID()))))&lt;br/&gt;
    +		CompletableFuture&amp;lt;Integer&amp;gt; blobServerPortFuture = gateway.getBlobServerPort(timeout);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobGraph&amp;gt; jarUploadFuture = jobGraphFuture.thenCombine(blobServerPortFuture, (jobGraph, blobServerPort) -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			final InetSocketAddress address = new InetSocketAddress(getDispatcherHost(gateway), blobServerPort);    +			final List&amp;lt;PermanentBlobKey&amp;gt; keys;    +			try {
    +				keys = BlobClient.uploadJarFiles(address, configuration, jobGraph.getJobID(), jobGraph.getUserJars());
    +			} catch (IOException ioe) {
    +				throw new CompletionException(new FlinkException(&quot;Could not upload job jar files.&quot;, ioe));
    +			}    +    +			for (PermanentBlobKey key }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;Acknowledge&amp;gt; jobSubmissionFuture = jarUploadFuture.thenCompose(jobGraph -&amp;gt; {&lt;br/&gt;
    +			// we have to enable queued scheduling because slots will be allocated lazily&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Is this also what the thing sitting behind the REST endpoint does?&lt;/p&gt;</comment>
                            <comment id="16458404" author="githubbot" created="Mon, 30 Apr 2018 08:51:42 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903#discussion_r184936545&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903#discussion_r184936545&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/handlers/JarRunHandler.java &amp;#8212;&lt;br/&gt;
    @@ -105,9 +110,32 @@ public JarRunHandler(&lt;br/&gt;
     			savepointRestoreSettings,&lt;br/&gt;
     			parallelism);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return jobGraphFuture.thenCompose(jobGraph -&amp;gt; restClusterClient&lt;/li&gt;
	&lt;li&gt;.submitJob(jobGraph)&lt;/li&gt;
	&lt;li&gt;.thenApply((jobSubmitResponseBody -&amp;gt; new JarRunResponseBody(jobGraph.getJobID()))))&lt;br/&gt;
    +		CompletableFuture&amp;lt;Integer&amp;gt; blobServerPortFuture = gateway.getBlobServerPort(timeout);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobGraph&amp;gt; jarUploadFuture = jobGraphFuture.thenCombine(blobServerPortFuture, (jobGraph, blobServerPort) -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			final InetSocketAddress address = new InetSocketAddress(getDispatcherHost(gateway), blobServerPort);    +			final List&amp;lt;PermanentBlobKey&amp;gt; keys;    +			try {
    +				keys = BlobClient.uploadJarFiles(address, configuration, jobGraph.getJobID(), jobGraph.getUserJars());
    +			} catch (IOException ioe) {
    +				throw new CompletionException(new FlinkException(&quot;Could not upload job jar files.&quot;, ioe));
    +			}    +    +			for (PermanentBlobKey key }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;Acknowledge&amp;gt; jobSubmissionFuture = jarUploadFuture.thenCompose(jobGraph -&amp;gt; {&lt;br/&gt;
    +			// we have to enable queued scheduling because slots will be allocated lazily&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    what do you mean?&lt;/p&gt;</comment>
                            <comment id="16458447" author="githubbot" created="Mon, 30 Apr 2018 10:11:01 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903#discussion_r184950890&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903#discussion_r184950890&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/handlers/JarRunHandler.java &amp;#8212;&lt;br/&gt;
    @@ -105,9 +110,32 @@ public JarRunHandler(&lt;br/&gt;
     			savepointRestoreSettings,&lt;br/&gt;
     			parallelism);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return jobGraphFuture.thenCompose(jobGraph -&amp;gt; restClusterClient&lt;/li&gt;
	&lt;li&gt;.submitJob(jobGraph)&lt;/li&gt;
	&lt;li&gt;.thenApply((jobSubmitResponseBody -&amp;gt; new JarRunResponseBody(jobGraph.getJobID()))))&lt;br/&gt;
    +		CompletableFuture&amp;lt;Integer&amp;gt; blobServerPortFuture = gateway.getBlobServerPort(timeout);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobGraph&amp;gt; jarUploadFuture = jobGraphFuture.thenCombine(blobServerPortFuture, (jobGraph, blobServerPort) -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			final InetSocketAddress address = new InetSocketAddress(getDispatcherHost(gateway), blobServerPort);    +			final List&amp;lt;PermanentBlobKey&amp;gt; keys;    +			try {
    +				keys = BlobClient.uploadJarFiles(address, configuration, jobGraph.getJobID(), jobGraph.getUserJars());
    +			} catch (IOException ioe) {
    +				throw new CompletionException(new FlinkException(&quot;Could not upload job jar files.&quot;, ioe));
    +			}    +    +			for (PermanentBlobKey key }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;Acknowledge&amp;gt; jobSubmissionFuture = jarUploadFuture.thenCompose(jobGraph -&amp;gt; {&lt;br/&gt;
    +			// we have to enable queued scheduling because slots will be allocated lazily&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    enabling queued scheduling&lt;/p&gt;</comment>
                            <comment id="16458458" author="githubbot" created="Mon, 30 Apr 2018 10:29:07 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903#discussion_r184953698&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903#discussion_r184953698&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/handlers/JarRunHandler.java &amp;#8212;&lt;br/&gt;
    @@ -105,9 +110,32 @@ public JarRunHandler(&lt;br/&gt;
     			savepointRestoreSettings,&lt;br/&gt;
     			parallelism);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return jobGraphFuture.thenCompose(jobGraph -&amp;gt; restClusterClient&lt;/li&gt;
	&lt;li&gt;.submitJob(jobGraph)&lt;/li&gt;
	&lt;li&gt;.thenApply((jobSubmitResponseBody -&amp;gt; new JarRunResponseBody(jobGraph.getJobID()))))&lt;br/&gt;
    +		CompletableFuture&amp;lt;Integer&amp;gt; blobServerPortFuture = gateway.getBlobServerPort(timeout);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobGraph&amp;gt; jarUploadFuture = jobGraphFuture.thenCombine(blobServerPortFuture, (jobGraph, blobServerPort) -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			final InetSocketAddress address = new InetSocketAddress(getDispatcherHost(gateway), blobServerPort);    +			final List&amp;lt;PermanentBlobKey&amp;gt; keys;    +			try {
    +				keys = BlobClient.uploadJarFiles(address, configuration, jobGraph.getJobID(), jobGraph.getUserJars());
    +			} catch (IOException ioe) {
    +				throw new CompletionException(new FlinkException(&quot;Could not upload job jar files.&quot;, ioe));
    +			}    +    +			for (PermanentBlobKey key }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;Acknowledge&amp;gt; jobSubmissionFuture = jarUploadFuture.thenCompose(jobGraph -&amp;gt; {&lt;br/&gt;
    +			// we have to enable queued scheduling because slots will be allocated lazily&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    If by `the thing sitting behind the REST endpoint` you mean the `Dispatcher`, then no, it does not enable queued scheduling, but effectively relies on it being enabled. If you don&apos;t enable it beforehand in the client/handler the job submission will outright fail with an entirely unhelpful error message.&lt;/p&gt;

&lt;p&gt;    The `Dispatcher` should &lt;em&gt;probably&lt;/em&gt; enable it though, but that isn&apos;t really in the scope of this PR as it would also affect the `RestClusterClient` which does the same thing.&lt;br/&gt;
    Technically it may also be questionably as it would invalidate part of the `JobGraph` API.&lt;/p&gt;</comment>
                            <comment id="16458533" author="githubbot" created="Mon, 30 Apr 2018 12:37:53 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903#discussion_r184974645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903#discussion_r184974645&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/handlers/JarRunHandler.java &amp;#8212;&lt;br/&gt;
    @@ -105,9 +110,32 @@ public JarRunHandler(&lt;br/&gt;
     			savepointRestoreSettings,&lt;br/&gt;
     			parallelism);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return jobGraphFuture.thenCompose(jobGraph -&amp;gt; restClusterClient&lt;/li&gt;
	&lt;li&gt;.submitJob(jobGraph)&lt;/li&gt;
	&lt;li&gt;.thenApply((jobSubmitResponseBody -&amp;gt; new JarRunResponseBody(jobGraph.getJobID()))))&lt;br/&gt;
    +		CompletableFuture&amp;lt;Integer&amp;gt; blobServerPortFuture = gateway.getBlobServerPort(timeout);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;JobGraph&amp;gt; jarUploadFuture = jobGraphFuture.thenCombine(blobServerPortFuture, (jobGraph, blobServerPort) -&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			final InetSocketAddress address = new InetSocketAddress(getDispatcherHost(gateway), blobServerPort);    +			final List&amp;lt;PermanentBlobKey&amp;gt; keys;    +			try {
    +				keys = BlobClient.uploadJarFiles(address, configuration, jobGraph.getJobID(), jobGraph.getUserJars());
    +			} catch (IOException ioe) {
    +				throw new CompletionException(new FlinkException(&quot;Could not upload job jar files.&quot;, ioe));
    +			}    +    +			for (PermanentBlobKey key }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
    +&lt;br/&gt;
    +		CompletableFuture&amp;lt;Acknowledge&amp;gt; jobSubmissionFuture = jarUploadFuture.thenCompose(jobGraph -&amp;gt; {&lt;br/&gt;
    +			// we have to enable queued scheduling because slots will be allocated lazily&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    gotcha. I think that&apos;s way off topic, so this is still good to merge&lt;/p&gt;</comment>
                            <comment id="16460688" author="githubbot" created="Wed, 2 May 2018 08:15:39 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging.&lt;/p&gt;</comment>
                            <comment id="16461008" author="zentol" created="Wed, 2 May 2018 13:20:32 +0000"  >&lt;p&gt;master: e884a3a4f6ba738fac66846488f931cf85f2e2fc&lt;br/&gt;
1.5: f4bef6fc51c297b372b95c9fc461fbf6c495a1fd&lt;/p&gt;</comment>
                            <comment id="16461015" author="githubbot" created="Wed, 2 May 2018 13:20:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5903&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5903&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sprr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>