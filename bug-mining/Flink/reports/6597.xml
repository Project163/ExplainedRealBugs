<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:11:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-28986] UNNEST function with nested filter fails to generate plan</title>
                <link>https://issues.apache.org/jira/browse/FLINK-28986</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Howtoreproduce&quot;&gt;&lt;/a&gt;How to reproduce&lt;/h3&gt;

&lt;p&gt;add the following case to TableEnvironmentITCase&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; debug(): Unit = {
  tEnv.executeSql(
    s&quot;&quot;&quot;
       |CREATE TEMPORARY TABLE source_kafka_wip_his_all (
       |  GUID varchar,
       |  OPERATION varchar,
       |  PRODUCTID varchar,
       |  LOTNO varchar,
       |  SERIALNO varchar,
       |  QUERYSERIALNO varchar,
       |  SERIALNO1 varchar,
       |  SERIALNO2 varchar,
       |  WIPORDERNO varchar,
       |  WIPORDERTYPE varchar,
       |  VIRTUALLOT varchar,
       |  PREOPERATION varchar,
       |  NORMALPREOPERATION varchar,
       |  PROCESSID varchar,
       |  EQUIPMENT varchar,
       |  INBOUNDDATE varchar,
       |  OUTBOUNDDATE varchar,
       |  REWORK varchar,
       |  REWORKPROCESSID varchar,
       |  CONTAINER varchar,
       |  WIPCONTENTCLASSID varchar,
       |  STATUSCODE varchar,
       |  WIPSTATUS varchar,
       |  TESTPROCESSID varchar,
       |  TESTORDERTYPE varchar,
       |  TESTORDER varchar,
       |  TEST varchar,
       |  SORTINGPROCESSID varchar,
       |  SORTINGORDERTYPE varchar,
       |  SORTINGORDER varchar,
       |  SORTING varchar,
       |  MINO varchar,
       |  GROUPCODE varchar,
       |  HIGHLOWGROUP varchar,
       |  PRODUCTNO varchar,
       |  FACILITY varchar,
       |  WIPLINE varchar,
       |  CHILDEQUCODE varchar,
       |  STATION varchar,
       |  QTY varchar,
       |  PASS_FLAG varchar,
       |  DEFECTCODELIST varchar,
       |  ISFIRST varchar,
       |  PARALIST ARRAY&amp;lt;ROW(GUID string,WIP_HIS_GUID string,QUERYSERIALNO string,OPERATION string,REWORKPROCESSID string,CHARACTERISTIC string,CHARACTERISTICREVISION string,CHARACTERISTICTYPE string,CHARACTERISTICCLASS string,UPPERCONTROLLIMIT string,TARGETVALUE string,LOWERCONTROLLIMIT string,TESTVALUE string,TESTATTRIBUTE string,TESTINGSTARTDATE string,TESTFINISHDATE string,UOMCODE string,DEFECTCODE string,SPECPARAMID string,STATION string,GP_TIME string,REFERENCEID string,LASTUPDATEON string,LASTUPDATEDBY string,CREATEDON string,CREATEDBY string,ACTIVE string,LASTDELETEON string,LASTDELETEDBY string,LASTREACTIVATEON string,LASTREACTIVATEDBY string,ARCHIVEID string,LASTARCHIVEON string,LASTARCHIVEDBY string,LASTRESTOREON string,LASTRESTOREDBY string,ROWVERSIONSTAMP string)&amp;gt;,
       |  REFERENCEID varchar,
       |  LASTUPDATEON varchar,
       |  LASTUPDATEDBY varchar,
       |  CREATEDON varchar,
       |  CREATEDBY varchar,
       |  ACTIVE varchar,
       |  LASTDELETEON varchar,
       |  LASTDELETEDBY varchar,
       |  LASTREACTIVATEON varchar,
       |  LASTREACTIVATEDBY varchar,
       |  ARCHIVEID varchar,
       |  LASTARCHIVEON varchar,
       |  LASTARCHIVEDBY varchar,
       |  LASTRESTOREON varchar,
       |  LASTRESTOREDBY varchar,
       |  ROWVERSIONSTAMP varchar,
       |  proctime as PROCTIME()
       |  ) &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; (
       |  &apos;connector&apos; = &apos;datagen&apos;
       |)
       |&quot;&quot;&quot;.stripMargin)

  tEnv.executeSql(
    s&quot;&quot;&quot;
       |create TEMPORARY view transform_main_data as
       |select
       |      r.GUID as wip_his_guid,
       |      r.EQUIPMENT as equipment,
       |      r.WIPLINE as wipline,
       |      r.STATION as station,
       |      cast(r.PROCESSID as decimal) as processid,
       |      r.PRODUCTNO as productno,
       |      t.TESTFINISHDATE as testfinishdate,
       |      t.OPERATION as operation,
       |      t.CHARACTERISTIC as characteristic,
       |      t.LOWERCONTROLLIMIT as lowercontrollimit,
       |      t.UPPERCONTROLLIMIT as uppercontrollimit,
       |      t.TARGETVALUE as targetvalue,
       |      t.DEFECTCODE as defectcode,
       |      t.TESTVALUE as testvalue,
       |      t.CHARACTERISTICTYPE as characteristictype,
       |      proctime
       |  from
       |  (select
       |      GUID,
       |      EQUIPMENT,
       |      WIPLINE,
       |      STATION,
       |      PROCESSID,
       |      PRODUCTNO,
       |      PARALIST,
       |      proctime
       |  FROM source_kafka_wip_his_all) r
       |  cross join
       |  unnest(PARALIST) as t (GUID,WIP_HIS_GUID,QUERYSERIALNO,OPERATION,REWORKPROCESSID,CHARACTERISTIC,CHARACTERISTICREVISION,CHARACTERISTICTYPE,CHARACTERISTICCLASS,UPPERCONTROLLIMIT,TARGETVALUE,LOWERCONTROLLIMIT,TESTVALUE,TESTATTRIBUTE,TESTINGSTARTDATE,TESTFINISHDATE,UOMCODE,DEFECTCODE,SPECPARAMID,STATION,GP_TIME,REFERENCEID,LASTUPDATEON,LASTUPDATEDBY,CREATEDON,CREATEDBY,ACTIVE,LASTDELETEON,LASTDELETEDBY,LASTREACTIVATEON,LASTREACTIVATEDBY,ARCHIVEID,LASTARCHIVEON,LASTARCHIVEDBY,LASTRESTOREON,LASTRESTOREDBY,ROWVERSIONSTAMP)
       |  where t.CHARACTERISTICTYPE = &apos;2&apos;
       |&quot;&quot;&quot;.stripMargin)

  tEnv.executeSql(
    s&quot;&quot;&quot;
       |explain plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
       |select * from transform_main_data
       |where operation not in (&apos;G1208&apos;,&apos;G1209&apos;,&apos;G1211&apos;,&apos;G1213&apos;,&apos;G1206&apos;,&apos;G1207&apos;,&apos;G1214&apos;,&apos;G1215&apos;,&apos;G1282&apos;,&apos;G1292&apos;,&apos;G1216&apos;)
       |&quot;&quot;&quot;.stripMargin).print()
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Stacktrace&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.table.api.TableException: Cannot generate a valid execution plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given query:&#160;LogicalProject(inputs=[0..3], exprs=[[CAST($4):DECIMAL(10, 0), $5, $23, $11, $13, $19, $17, $18, $25, $20, $15, $7]])
+- LogicalCorrelate(correlation=[$cor1], joinType=[&lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt;], requiredColumns=[{6}])
&#160; &#160;:- LogicalProject(inputs=[0], exprs=[[$14, $36, $38, $13, $34, $43, PROCTIME()]])
&#160; &#160;: &#160;+- LogicalTableScan(table=[[default_catalog, default_database, source_kafka_wip_his_all]])
&#160; &#160;+- LogicalFilter(condition=[AND(SEARCH($7, Sarg[_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;:VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;]:VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;), SEARCH($3, Sarg[(-&#8734;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1206&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1206&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1207&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1207&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1208&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1208&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1209&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1209&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1211&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1211&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1213&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1213&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1214&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1214&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1215&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1215&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1216&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1216&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1282&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1282&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1292&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1292&apos;&lt;/span&gt;..+&#8734;)]:CHAR(5) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;))])
&#160; &#160; &#160; +- Uncollect
&#160; &#160; &#160; &#160; &#160;+- LogicalProject(exprs=[[$cor1.PARALIST]])
&#160; &#160; &#160; &#160; &#160; &#160; +- LogicalValues(type=[RecordType(INTEGER ZERO)], tuples=[[{ 0 }]])This exception indicates that the query uses an unsupported SQL feature.
Please check the documentation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the set of currently supported SQL features.
org.apache.flink.table.api.TableException: Cannot generate a valid execution plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given query: 

LogicalProject(inputs=[0..3], exprs=[[CAST($4):DECIMAL(10, 0), $5, $23, $11, $13, $19, $17, $18, $25, $20, $15, $7]])
+- LogicalCorrelate(correlation=[$cor1], joinType=[&lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt;], requiredColumns=[{6}])
   :- LogicalProject(inputs=[0], exprs=[[$14, $36, $38, $13, $34, $43, PROCTIME()]])
   :  +- LogicalTableScan(table=[[default_catalog, default_database, source_kafka_wip_his_all]])
   +- LogicalFilter(condition=[AND(SEARCH($7, Sarg[_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;:VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;]:VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;), SEARCH($3, Sarg[(-&#8734;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1206&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1206&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1207&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1207&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1208&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1208&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1209&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1209&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1211&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1211&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1213&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1213&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1214&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1214&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1215&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1215&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1216&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1216&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1282&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1282&apos;&lt;/span&gt;.._UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1292&apos;&lt;/span&gt;), (_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;G1292&apos;&lt;/span&gt;..+&#8734;)]:CHAR(5) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;))])
      +- Uncollect
         +- LogicalProject(exprs=[[$cor1.PARALIST]])
            +- LogicalValues(type=[RecordType(INTEGER ZERO)], tuples=[[{ 0 }]])

This exception indicates that the query uses an unsupported SQL feature.
Please check the documentation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the set of currently supported SQL features.

&#160; &#160; at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:70)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.$anonfun$optimize$1(FlinkChainedProgram.scala:59)
&#160; &#160; at scala.collection.TraversableOnce.$anonfun$foldLeft$1(TraversableOnce.scala:156)
&#160; &#160; at scala.collection.TraversableOnce.$anonfun$foldLeft$1$adapted(TraversableOnce.scala:156)
&#160; &#160; at scala.collection.Iterator.foreach(Iterator.scala:937)
&#160; &#160; at scala.collection.Iterator.foreach$(Iterator.scala:937)
&#160; &#160; at scala.collection.AbstractIterator.foreach(Iterator.scala:1425)
&#160; &#160; at scala.collection.IterableLike.foreach(IterableLike.scala:70)
&#160; &#160; at scala.collection.IterableLike.foreach$(IterableLike.scala:69)
&#160; &#160; at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
&#160; &#160; at scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:156)
&#160; &#160; at scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:154)
&#160; &#160; at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.optimize(FlinkChainedProgram.scala:55)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.optimizeTree(StreamCommonSubGraphBasedOptimizer.scala:176)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.doOptimize(StreamCommonSubGraphBasedOptimizer.scala:83)
&#160; &#160; at org.apache.flink.table.planner.plan.optimize.CommonSubGraphBasedOptimizer.optimize(CommonSubGraphBasedOptimizer.scala:87)
&#160; &#160; at org.apache.flink.table.planner.delegation.PlannerBase.optimize(PlannerBase.scala:315)
&#160; &#160; at org.apache.flink.table.planner.delegation.PlannerBase.getExplainGraphs(PlannerBase.scala:527)
&#160; &#160; at org.apache.flink.table.planner.delegation.StreamPlanner.explain(StreamPlanner.scala:96)
&#160; &#160; at org.apache.flink.table.planner.delegation.StreamPlanner.explain(StreamPlanner.scala:51)
&#160; &#160; at org.apache.flink.table.api.internal.TableEnvironmentImpl.explainInternal(TableEnvironmentImpl.java:695)
&#160; &#160; at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeInternal(TableEnvironmentImpl.java:1356)
&#160; &#160; at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeSql(TableEnvironmentImpl.java:733)
&#160; &#160; at org.apache.flink.table.api.TableEnvironmentITCase.debug(TableEnvironmentITCase.scala:695)
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
&#160; &#160; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&#160; &#160; at java.lang.reflect.Method.invoke(Method.java:498)
&#160; &#160; at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
&#160; &#160; at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
&#160; &#160; at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
&#160; &#160; at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
&#160; &#160; at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
&#160; &#160; at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
&#160; &#160; at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:54)
&#160; &#160; at org.apache.flink.util.TestNameProvider$1.evaluate(TestNameProvider.java:45)
&#160; &#160; at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)
&#160; &#160; at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
&#160; &#160; at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
&#160; &#160; at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
&#160; &#160; at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
&#160; &#160; at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
&#160; &#160; at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
&#160; &#160; at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
&#160; &#160; at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
&#160; &#160; at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
&#160; &#160; at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
&#160; &#160; at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
&#160; &#160; at org.junit.runners.Suite.runChild(Suite.java:128)
&#160; &#160; at org.junit.runners.Suite.runChild(Suite.java:27)
&#160; &#160; at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
&#160; &#160; at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
&#160; &#160; at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
&#160; &#160; at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
&#160; &#160; at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
&#160; &#160; at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:54)
&#160; &#160; at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:54)
&#160; &#160; at org.junit.rules.RunRules.evaluate(RunRules.java:20)
&#160; &#160; at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
&#160; &#160; at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
&#160; &#160; at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
&#160; &#160; at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
&#160; &#160; at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)
&#160; &#160; at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
&#160; &#160; at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
Caused by: org.apache.calcite.plan.RelOptPlanner$CannotPlanException: There are not enough rules to produce a node with desired properties: convention=LOGICAL, FlinkRelDistributionTraitDef=any, MiniBatchIntervalTraitDef=None: 0, ModifyKindSetTraitDef=[NONE], UpdateKindTraitDef=[NONE].
Missing conversion is Uncollect[convention: NONE -&amp;gt; LOGICAL]
There is 1 empty subset: rel#485:RelSubset#4.LOGICAL.any.None: 0.[NONE].[NONE], the relevant part of the original plan is as follows
460:Uncollect
&#160; 458:LogicalProject(subset=[rel#459:RelSubset#3.NONE.any.None: 0.[NONE].[NONE]], PARALIST=[$cor1.PARALIST])
&#160; &#160; 17:LogicalValues(subset=[rel#457:RelSubset#2.NONE.any.None: 0.[NONE].[NONE]], tuples=[[{ 0 }]])&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13476959">FLINK-28986</key>
            <summary>UNNEST function with nested filter fails to generate plan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="qingyue">Jane Chan</assignee>
                                    <reporter username="qingyue">Jane Chan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 16 Aug 2022 06:23:02 +0000</created>
                <updated>Thu, 18 Aug 2022 10:24:56 +0000</updated>
                            <resolved>Thu, 18 Aug 2022 10:24:56 +0000</resolved>
                                    <version>1.16.0</version>
                                    <fixVersion>1.16.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17580080" author="qingyue" created="Tue, 16 Aug 2022 06:36:41 +0000"  >&lt;p&gt;The reason is that during the decorrelation rewrite, the top filter rel node was pushed down to form a nested filter pattern. Since the filter merge rule is not defined in the default rewrite rule sets, the nested filter rel nodes rendered the LogicalUnnestRule unmatched. This can be fixed by adding&#160; CoreRules.FILTER_MERGE to FlinkStreamRuleSets. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrey&quot; class=&quot;user-hover&quot; rel=&quot;godfrey&quot;&gt;godfrey&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13048154/13048154_image-2022-08-16-14-36-07-061.png&quot; height=&quot;177&quot; width=&quot;1047&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17580082" author="godfreyhe" created="Tue, 16 Aug 2022 06:44:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt; Thanks for reporting this, assign to you &lt;/p&gt;</comment>
                            <comment id="17581274" author="godfreyhe" created="Thu, 18 Aug 2022 10:24:56 +0000"  >&lt;p&gt;Fixed in master: bdffb6bd4ae3ea32bdcd6ec6bce6c6e0e8b92a11&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13048154" name="image-2022-08-16-14-36-07-061.png" size="645375" author="qingyue" created="Tue, 16 Aug 2022 06:36:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17s54:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>