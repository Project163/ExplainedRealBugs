<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5520] Disable outer joins with non-equality predicates</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5520</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Outer joins with non-equality predicates (and at least one equality predicate) compute incorrect results. &lt;/p&gt;

&lt;p&gt;Since this is not a very common requirement, I propose to disable this feature for the 1.2.0 release and correctly implement it for a later version.&lt;/p&gt;

&lt;p&gt;The fix should add checks in the Table API validation phase (to get a good error message) and in the DataSetJoinRule to prevent translation of SQL queries with non-equality predicates on outer joins.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13035418">FLINK-5520</key>
            <summary>Disable outer joins with non-equality predicates</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="11">Done</resolution>
                                        <assignee username="lincoln.86xy">lincoln lee</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2017 07:56:01 +0000</created>
                <updated>Fri, 20 Jan 2017 07:55:19 +0000</updated>
                            <resolved>Fri, 20 Jan 2017 07:55:19 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15826379" author="githubbot" created="Tue, 17 Jan 2017 16:56:30 +0000"  >&lt;p&gt;GitHub user lincoln-lil opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5520&quot; title=&quot;Disable outer joins with non-equality predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5520&quot;&gt;&lt;del&gt;FLINK-5520&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Disable outer joins with non-equality predicates&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/lincoln-lil/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lincoln-lil/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5520&quot; title=&quot;Disable outer joins with non-equality predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5520&quot;&gt;&lt;del&gt;FLINK-5520&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3141&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit be877a3a9bb9d00f54fbb929e805f95af1ed1cd2&lt;br/&gt;
Author: lincoln-lil &amp;lt;lincoln.86xy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-01-17T14:42:39Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5520&quot; title=&quot;Disable outer joins with non-equality predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5520&quot;&gt;&lt;del&gt;FLINK-5520&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Disable outer joins with non-equality predicates&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15827375" author="githubbot" created="Wed, 18 Jan 2017 03:27:37 +0000"  >&lt;p&gt;Github user wuchong commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @lincoln-lil , thank your for the PR. I think the issue is only for 1.2.0, so please create a new pull request to commit into `release-1.2`.  For `master` we will directly fix the bug. &lt;/p&gt;

&lt;p&gt;    I have taken a quick look at it. I think a better approach is to disable outer joins with non-equality in &lt;span class=&quot;error&quot;&gt;&amp;#91;`DataSetJoinRule`&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/dataSet/DataSetJoinRule.scala#L43&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/dataSet/DataSetJoinRule.scala#L43&lt;/a&gt;),  not mix the code in SQL translation. such as &lt;/p&gt;

&lt;p&gt;    ```scala&lt;br/&gt;
    override def matches(call: RelOptRuleCall): Boolean = &lt;/p&gt;
{
        val join: LogicalJoin = call.rel(0).asInstanceOf[LogicalJoin]
    
        val joinInfo = join.analyzeCondition
    
        // joins require an equi-condition or a conjunctive predicate with at least one equi-condition
        // and outer joins with non-equality predicates is not supported currently
        !joinInfo.pairs().isEmpty &amp;amp;&amp;amp; (join.getJoinType == JoinRelType.INNER || joinInfo.isEqui)
      }
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;     And also please add checks in &lt;span class=&quot;error&quot;&gt;&amp;#91;`operators.scala`&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/blob/release-1.2/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/logical/operators.scala#L455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/release-1.2/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/logical/operators.scala#L455&lt;/a&gt;) to give a good exception for TableAPI outer joins. &lt;/p&gt;</comment>
                            <comment id="15827414" author="githubbot" created="Wed, 18 Jan 2017 04:37:42 +0000"  >&lt;p&gt;Github user lincoln-lil commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi, wuchong, thanks for your review. I&apos;ll switch the pr based on 1.2.0.&lt;br/&gt;
    I think it&apos;s not necessary doing validation repeatedly both in DataSetJoinRule.java and operators.scala, and there already being several validations in DataSetJoin.translateToPlan function, why don&apos;t we put the same validation together to reduce code?&lt;/p&gt;</comment>
                            <comment id="15827423" author="githubbot" created="Wed, 18 Jan 2017 04:54:23 +0000"  >&lt;p&gt;Github user shaoxuan-wang commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @wuchong @lincoln-lil , I do not think this is just for 1.2.0. The out join with non equality functionality is broken on master. We should deliver this fix to the master as well as release 1.2.0 until we have concrete plans to fix non equality functionality.&lt;/p&gt;</comment>
                            <comment id="15827579" author="githubbot" created="Wed, 18 Jan 2017 08:09:45 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree with @lincoln-lil and @shaoxuan-wang, this fix should go into the `1.1-release`, `1.2-release`, and `master` branches. We will later add support for non-equality predicate on left/right outer joins to master and include it for 1.3.0.&lt;/p&gt;

&lt;p&gt;    Regarding the check, I agree with @wuchong. We implement these checks in  `RelOptRule.matches()` to prevent that an invalid plan is constructed. Otherwise it may happen that we end up with an invalid plan although, there would be a valid (but more expensive) alternative. We have additional checks in the DataSet operators to be on the safe side but these should never be triggered. If this happens, something is wrong with the optimization phase. So its kind of a safety net. Although, I don&apos;t think there are rules to generate alternative plans to execute an outer join with non-equality predicate, I would like to keep the pattern for consistency reasons. &lt;br/&gt;
    Also the check in the validation phase of the Table API is useful, because the validation happens immediately when a function on a `Table` is called. In contrast, the check on `DataSetJoin` would happen when the translation is triggered, i.e., when the program is optimized and translated into a DataSet program. Throwing an exception early is helpful for users because they can much easier identify an invalid statement.&lt;/p&gt;</comment>
                            <comment id="15827762" author="githubbot" created="Wed, 18 Jan 2017 10:01:14 +0000"  >&lt;p&gt;Github user lincoln-lil commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske agree with you that the check in validation phase of the Table API is useful for failing fast( IMO, it seems no difference on user experience that when an exception be thrown either in validation or translation phase ?), but there may be other rules can match and generate alternative plans to execute an outer join. For instance, we internal implemented a HbaseTableSource extends TableSource that can be joined as a TableSourceTable. We created a new rule that is used to match inner and outer joins. Though such special tableSource probably may not be suitable to be merged into Flink&lt;br/&gt;
    master, in the future there could be other TableSourceTables which can support different join predicates depending on their different physical storage characteristics. &lt;/p&gt;</comment>
                            <comment id="15827772" author="githubbot" created="Wed, 18 Jan 2017 10:08:39 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The difference between failing during validation and translation is the code line that throws the exception. A check during validation causes an exception on the line that is responsible for the error. A check during translation throws an exception much later in the user program.&lt;/p&gt;

&lt;p&gt;    Regarding the check in the rule: IMO, each rule must ensure that is does not translate the query into an invalid plan. It make sense though, to have an additional safety check in the `DataSetJoin`. However, this check should be done in the constructor and not in the `translateToPlan()` method (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5547&quot; title=&quot;Move checks for DataSetRel validity into constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5547&quot;&gt;FLINK-5547&lt;/a&gt;) to fail fast if a rule tries to create an invalid plan.&lt;/p&gt;</comment>
                            <comment id="15827818" author="githubbot" created="Wed, 18 Jan 2017 10:46:24 +0000"  >&lt;p&gt;Github user lincoln-lil commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5547&quot; title=&quot;Move checks for DataSetRel validity into constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5547&quot;&gt;FLINK-5547&lt;/a&gt; make sense to me,  I&apos;ll update this pr today.&lt;/p&gt;</comment>
                            <comment id="15827831" author="githubbot" created="Wed, 18 Jan 2017 10:50:34 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Great thanks!&lt;/p&gt;</comment>
                            <comment id="15829896" author="githubbot" created="Thu, 19 Jan 2017 13:18:58 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141#discussion_r96856158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141#discussion_r96856158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/scala/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -83,6 +83,27 @@ class JoinITCase(&lt;br/&gt;
         val env = ExecutionEnvironment.getExecutionEnvironment&lt;br/&gt;
         val tEnv = TableEnvironment.getTableEnvironment(env, config)&lt;/p&gt;

&lt;p&gt;    +    val sqlQuery = &quot;SELECT c, g FROM Table3, Table5 WHERE b = e AND a &amp;lt; 6&quot;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think this test covers the same case as the one above (`testJoinWithFilter()`).&lt;/p&gt;</comment>
                            <comment id="15829897" author="githubbot" created="Thu, 19 Jan 2017 13:18:58 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141#discussion_r96841502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141#discussion_r96841502&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/logical/operators.scala &amp;#8212;&lt;br/&gt;
    @@ -454,30 +454,54 @@ case class Join(&lt;/p&gt;

&lt;p&gt;       private def testJoinCondition(expression: Expression): Unit = {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;def checkIfJoinCondition(exp : BinaryComparison) = exp.children match 
{
    -        case (x : JoinFieldReference) :: (y : JoinFieldReference) :: Nil
    -          if x.isFromLeftInput != y.isFromLeftInput =&amp;gt; Unit
    -        case x =&amp;gt; failValidation(
    -          s&quot;Invalid non-join predicate $exp. For non-join predicates use Table#where.&quot;)
    -      }
&lt;p&gt;    +    def checkIfJoinCondition(exp: BinaryComparison) = exp.children match {&lt;br/&gt;
    +      case (x: JoinFieldReference) :: (y: JoinFieldReference) :: Nil&lt;br/&gt;
    +        if x.isFromLeftInput != y.isFromLeftInput =&amp;gt; true&lt;br/&gt;
    +      case x =&amp;gt; false&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `case x` -&amp;gt; `case _`&lt;/p&gt;</comment>
                            <comment id="15829898" author="githubbot" created="Thu, 19 Jan 2017 13:18:58 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141#discussion_r96843888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141#discussion_r96843888&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/scala/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -375,4 +395,62 @@ class JoinITCase(&lt;/p&gt;

&lt;p&gt;         Assert.assertEquals(0, result)&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;TableException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testRightOuterJoinWithNonEquiJoinPredicate(): Unit = &lt;/p&gt;
{
    +
    +    val env = ExecutionEnvironment.getExecutionEnvironment
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)
    +    tEnv.getConfig.setNullCheck(true)
    +
    +    val sqlQuery = &quot;SELECT c, g FROM Table3 RIGHT OUTER JOIN Table5 ON b = e and a &amp;gt; d&quot;
    +
    +    val ds1 = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv).as(&apos;d, &apos;e, &apos;f, &apos;g, &apos;h)
    +    tEnv.registerTable(&quot;Table3&quot;, ds1)
    +    tEnv.registerTable(&quot;Table5&quot;, ds2)
    +
    +    tEnv.sql(sqlQuery).toDataSet[Row].collect()
    +
    +    val results = tEnv.sql(sqlQuery).toDataSet[Row].collect()
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;TableException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testLeftOuterJoinWithNonEquiJoinPredicate(): Unit = &lt;/p&gt;
{
    +
    +    val env = ExecutionEnvironment.getExecutionEnvironment
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)
    +    tEnv.getConfig.setNullCheck(true)
    +
    +    val sqlQuery = &quot;SELECT c, g FROM Table3 LEFT OUTER JOIN Table5 ON b = e and a &amp;gt; d&quot;
    +
    +    val ds1 = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv).as(&apos;d, &apos;e, &apos;f, &apos;g, &apos;h)
    +    tEnv.registerTable(&quot;Table3&quot;, ds1)
    +    tEnv.registerTable(&quot;Table5&quot;, ds2)
    +
    +    tEnv.sql(sqlQuery).toDataSet[Row].collect()
    +
    +    val results = tEnv.sql(sqlQuery).toDataSet[Row].collect()
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;TableException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testFullOuterJoinWithNonEquiJoinPredicate(): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +    val env = ExecutionEnvironment.getExecutionEnvironment&lt;br/&gt;
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)&lt;br/&gt;
    +    tEnv.getConfig.setNullCheck(true)&lt;br/&gt;
    +&lt;br/&gt;
    +    val sqlQuery = &quot;SELECT c, g FROM Table3 FULL OUTER JOIN Table5 ON b = e and a &amp;gt; d&quot;&lt;br/&gt;
    +&lt;br/&gt;
    +    val ds1 = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)&lt;br/&gt;
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv).as(&apos;d, &apos;e, &apos;f, &apos;g, &apos;h)&lt;br/&gt;
    +    tEnv.registerTable(&quot;Table3&quot;, ds1)&lt;br/&gt;
    +    tEnv.registerTable(&quot;Table5&quot;, ds2)&lt;br/&gt;
    +&lt;br/&gt;
    +    tEnv.sql(sqlQuery).toDataSet&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;.collect()&lt;br/&gt;
    +&lt;br/&gt;
    +    val results = tEnv.sql(sqlQuery).toDataSet&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;.collect()&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    remove&lt;/p&gt;</comment>
                            <comment id="15829899" author="githubbot" created="Thu, 19 Jan 2017 13:18:58 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141#discussion_r96843825&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141#discussion_r96843825&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/scala/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -375,4 +395,62 @@ class JoinITCase(&lt;/p&gt;

&lt;p&gt;         Assert.assertEquals(0, result)&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;TableException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testRightOuterJoinWithNonEquiJoinPredicate(): Unit = &lt;/p&gt;
{
    +
    +    val env = ExecutionEnvironment.getExecutionEnvironment
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)
    +    tEnv.getConfig.setNullCheck(true)
    +
    +    val sqlQuery = &quot;SELECT c, g FROM Table3 RIGHT OUTER JOIN Table5 ON b = e and a &amp;gt; d&quot;
    +
    +    val ds1 = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv).as(&apos;d, &apos;e, &apos;f, &apos;g, &apos;h)
    +    tEnv.registerTable(&quot;Table3&quot;, ds1)
    +    tEnv.registerTable(&quot;Table5&quot;, ds2)
    +
    +    tEnv.sql(sqlQuery).toDataSet[Row].collect()
    +
    +    val results = tEnv.sql(sqlQuery).toDataSet[Row].collect()
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;TableException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testLeftOuterJoinWithNonEquiJoinPredicate(): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +    val env = ExecutionEnvironment.getExecutionEnvironment&lt;br/&gt;
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)&lt;br/&gt;
    +    tEnv.getConfig.setNullCheck(true)&lt;br/&gt;
    +&lt;br/&gt;
    +    val sqlQuery = &quot;SELECT c, g FROM Table3 LEFT OUTER JOIN Table5 ON b = e and a &amp;gt; d&quot;&lt;br/&gt;
    +&lt;br/&gt;
    +    val ds1 = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)&lt;br/&gt;
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv).as(&apos;d, &apos;e, &apos;f, &apos;g, &apos;h)&lt;br/&gt;
    +    tEnv.registerTable(&quot;Table3&quot;, ds1)&lt;br/&gt;
    +    tEnv.registerTable(&quot;Table5&quot;, ds2)&lt;br/&gt;
    +&lt;br/&gt;
    +    tEnv.sql(sqlQuery).toDataSet&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;.collect()&lt;br/&gt;
    +&lt;br/&gt;
    +    val results = tEnv.sql(sqlQuery).toDataSet&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;.collect()&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    remove&lt;/p&gt;</comment>
                            <comment id="15829900" author="githubbot" created="Thu, 19 Jan 2017 13:18:58 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141#discussion_r96856944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141#discussion_r96856944&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/scala/batch/table/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -234,7 +249,38 @@ class JoinITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testLeftJoinWithNotOnlyEquiJoin(): Unit = 
{
    +    val env: ExecutionEnvironment = ExecutionEnvironment.getExecutionEnvironment
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)
    +    tEnv.getConfig.setNullCheck(true)
    +
    +    val ds1 = CollectionDataSets.get3TupleDataSet(env).toTable(tEnv, &apos;a, &apos;b, &apos;c)
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv, &apos;d, &apos;e, &apos;f, &apos;g, &apos;h)
    +
    +    val joinT = ds1.leftOuterJoin(ds2, &apos;a === &apos;d &amp;amp;&amp;amp; &apos;b &amp;lt; &apos;h).select(&apos;c, &apos;g)
    +
    +    val results = joinT.toDataSet[Row].collect()
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;ValidationException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testFullJoinWithNotOnlyEquiJoin(): Unit = &lt;/p&gt;
{
    +    val env: ExecutionEnvironment = ExecutionEnvironment.getExecutionEnvironment
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)
    +    tEnv.getConfig.setNullCheck(true)
    +
    +    val ds1 = CollectionDataSets.get3TupleDataSet(env).toTable(tEnv, &apos;a, &apos;b, &apos;c)
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv, &apos;d, &apos;e, &apos;f, &apos;g, &apos;h)
    +
    +    val joinT = ds1.fullOuterJoin(ds2, &apos;a === &apos;d &amp;amp;&amp;amp; &apos;b &amp;lt; &apos;h).select(&apos;c, &apos;g)
    +
    +    val results = joinT.toDataSet[Row].collect()
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Add tests to check that local predicates are not allowed in outer joins as well.&lt;/p&gt;</comment>
                            <comment id="15829901" author="githubbot" created="Thu, 19 Jan 2017 13:18:58 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141#discussion_r96843797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141#discussion_r96843797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/scala/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -375,4 +395,62 @@ class JoinITCase(&lt;/p&gt;

&lt;p&gt;         Assert.assertEquals(0, result)&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;TableException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +  def testRightOuterJoinWithNonEquiJoinPredicate(): Unit = {&lt;br/&gt;
    +&lt;br/&gt;
    +    val env = ExecutionEnvironment.getExecutionEnvironment&lt;br/&gt;
    +    val tEnv = TableEnvironment.getTableEnvironment(env, config)&lt;br/&gt;
    +    tEnv.getConfig.setNullCheck(true)&lt;br/&gt;
    +&lt;br/&gt;
    +    val sqlQuery = &quot;SELECT c, g FROM Table3 RIGHT OUTER JOIN Table5 ON b = e and a &amp;gt; d&quot;&lt;br/&gt;
    +&lt;br/&gt;
    +    val ds1 = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a, &apos;b, &apos;c)&lt;br/&gt;
    +    val ds2 = CollectionDataSets.get5TupleDataSet(env).toTable(tEnv).as(&apos;d, &apos;e, &apos;f, &apos;g, &apos;h)&lt;br/&gt;
    +    tEnv.registerTable(&quot;Table3&quot;, ds1)&lt;br/&gt;
    +    tEnv.registerTable(&quot;Table5&quot;, ds2)&lt;br/&gt;
    +&lt;br/&gt;
    +    tEnv.sql(sqlQuery).toDataSet&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;.collect()&lt;br/&gt;
    +&lt;br/&gt;
    +    val results = tEnv.sql(sqlQuery).toDataSet&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;.collect()&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This line can be removed&lt;/p&gt;</comment>
                            <comment id="15829989" author="githubbot" created="Thu, 19 Jan 2017 14:07:18 +0000"  >&lt;p&gt;Github user lincoln-lil commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske thanks for your review, I&apos;ll update this pr according to your comments.&lt;/p&gt;</comment>
                            <comment id="15830222" author="githubbot" created="Thu, 19 Jan 2017 16:39:24 +0000"  >&lt;p&gt;Github user lincoln-lil commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske when I add more test cases for &quot;outer joins&quot; with local predicates, I found different limitations between tableAPI and SQL, e.g., &quot;SELECT c, g FROM Table3 left outer join Table5 on a = d AND e &amp;lt; 3&quot; is valid, but dsFromTuple3.leftOuterJoin(dsFromTuple5, &apos;a === &apos;d &amp;amp;&amp;amp; &apos;e &amp;lt; 3) is invalid, because validation in Join node sees original join predicates and validates simply, while in DataSetJoinRule the join predicates could be pruned according to the equivalence in relational algebra. &lt;br/&gt;
    I have a question, should we keep the tableAPI consistent with SQL? If so, the validation in tableAPI will be much more complex, and it reminds me the previous discussion about validation either in one or two places.  Or just maintain the current implementation unchanged, because we will add support for both &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5498&quot; title=&quot;Add support for left/right outer joins with non-equality predicates (and 1+ equality predicates)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5498&quot;&gt;&lt;del&gt;FLINK-5498&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5511&quot; title=&quot;Add support for outer joins with local predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5511&quot;&gt;&lt;del&gt;FLINK-5511&lt;/del&gt;&lt;/a&gt; soon, then these differences will be eliminated.&lt;br/&gt;
    What do you think ?&lt;/p&gt;
</comment>
                            <comment id="15830259" author="githubbot" created="Thu, 19 Jan 2017 17:04:24 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think it is fine to keep this small difference for now. With &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5498&quot; title=&quot;Add support for left/right outer joins with non-equality predicates (and 1+ equality predicates)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5498&quot;&gt;&lt;del&gt;FLINK-5498&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5511&quot; title=&quot;Add support for outer joins with local predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5511&quot;&gt;&lt;del&gt;FLINK-5511&lt;/del&gt;&lt;/a&gt; these will be gone.&lt;/p&gt;</comment>
                            <comment id="15830262" author="githubbot" created="Thu, 19 Jan 2017 17:07:18 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the update @lincoln-lil!&lt;br/&gt;
    +1 to merge&lt;/p&gt;</comment>
                            <comment id="15830760" author="githubbot" created="Thu, 19 Jan 2017 22:53:53 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3141&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15831355" author="fhueske" created="Fri, 20 Jan 2017 07:55:19 +0000"  >&lt;p&gt;Fixed for 1.2.0 with 9073c53f902df7b3dbbdec2a30d86030e49fe27e&lt;br/&gt;
Fixed for 1.3.0 with d1301c82b85c00284d90e8f5bdac4fd86dc5b173&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38son:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>