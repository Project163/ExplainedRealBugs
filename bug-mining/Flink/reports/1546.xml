<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5824] Fix String/byte conversions without explicit encoding</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5824</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In a couple of places we convert Strings to bytes and bytes back to Strings without explicitly specifying an encoding. This can lead to problems when client and server default encodings differ.&lt;/p&gt;

&lt;p&gt;The task of this JIRA is to go over the whole project and look for conversions where we don&apos;t specify an encoding and fix it to specify UTF-8 explicitly.&lt;/p&gt;

&lt;p&gt;For starters, we can &lt;tt&gt;grep -R &apos;getBytes()&apos; .&lt;/tt&gt;, which already reveals many problematic places.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13043642">FLINK-5824</key>
            <summary>Fix String/byte conversions without explicit encoding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="uce">Ufuk Celebi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Feb 2017 13:34:19 +0000</created>
                <updated>Wed, 2 Oct 2019 17:42:37 +0000</updated>
                            <resolved>Thu, 9 Mar 2017 12:06:06 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                    <component>API / Python</component>
                    <component>Runtime / Queryable State</component>
                    <component>Runtime / State Backends</component>
                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15869989" author="stephanewen" created="Thu, 16 Feb 2017 14:12:50 +0000"  >&lt;p&gt;We should add a checkstyle rule that forbids &lt;tt&gt;String.toBytes()&lt;/tt&gt; and &lt;tt&gt;new String(byte[])&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15871428" author="dawidwys" created="Fri, 17 Feb 2017 08:36:10 +0000"  >&lt;p&gt;I would be glad to help with this issue, if it is ok with you.&lt;/p&gt;</comment>
                            <comment id="15871455" author="uce" created="Fri, 17 Feb 2017 08:52:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; I&apos;ve just assigned it to you.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefanrichter83%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;stefanrichter83@gmail.com&quot;&gt;stefanrichter83@gmail.com&lt;/a&gt; Stephan mentioned that this also affects savepoints. Do we want to do something special there or simply fix it (possibly breaking savepoints)?&lt;/p&gt;</comment>
                            <comment id="15871722" author="stephanewen" created="Fri, 17 Feb 2017 11:39:09 +0000"  >&lt;p&gt;I think some names in checkpoints are serialized in the default encoding. We have to check whether that would affect users.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; Would probably be good to pull out the default encoding we want to use (UTF 8) into some class (like ConfigConstants or so).&lt;/p&gt;</comment>
                            <comment id="15871737" author="dawidwys" created="Fri, 17 Feb 2017 11:49:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; Sure, will do it. We don&apos;t want it to be configurable from the configuration file at that moment, do we?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uce&quot; class=&quot;user-hover&quot; rel=&quot;uce&quot;&gt;uce&lt;/a&gt; Thanks for assigning!&lt;/p&gt;</comment>
                            <comment id="15874735" author="stephanewen" created="Mon, 20 Feb 2017 16:01:13 +0000"  >&lt;p&gt;I don&apos;t think we need it to be configurable at the moment. Since these are internal strings, we should rather be safe that we always use the same encoding.&lt;/p&gt;</comment>
                            <comment id="15875649" author="dawidwys" created="Tue, 21 Feb 2017 09:15:34 +0000"  >&lt;p&gt;Just two more questions.&lt;/p&gt;

&lt;p&gt;First I tried to investigate the possibilities to add such a check to checkstyle, but I didn&apos;t find a good way to that. Checkstyle does not come with it and a regex check is not enough in that case. It would be possible with FindBugs but don&apos;t know if we want to add it right know. Some ideas?&lt;/p&gt;

&lt;p&gt;Do we want to change also writing to files like e.g:&lt;br/&gt;
GlobalConfiguration::loadYAMLResource:144&lt;br/&gt;
OptimizerPlanEnvironment::getOptimizedPlan:74/76&lt;/p&gt;</comment>
                            <comment id="15875987" author="stephanewen" created="Tue, 21 Feb 2017 13:46:43 +0000"  >&lt;p&gt;Will a regex pattern for &lt;tt&gt;getBytes()&lt;/tt&gt; currently match methods on other classes than String as well?&lt;/p&gt;</comment>
                            <comment id="15876215" author="dawidwys" created="Tue, 21 Feb 2017 16:16:41 +0000"  >&lt;p&gt;Right now such a regex will match also for &lt;tt&gt;org.apache.flink.api.common.JobID&lt;/tt&gt; and &lt;tt&gt;org.apache.avro.util.Utf8&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15876695" author="dawidwys" created="Tue, 21 Feb 2017 20:54:56 +0000"  >&lt;p&gt;I&apos;ve fixed all direct String &amp;lt;&amp;gt; bytes conversions as listed by Findbugs.&lt;/p&gt;

&lt;p&gt;Still Findbugs shows&lt;br/&gt;
34 reliance on default encoding  in mainbase&lt;br/&gt;
144 in mainbase + tests&lt;/p&gt;

&lt;p&gt;Those reliances are while using different kinds of Output/InputStreams mainly with FileOutputStream&lt;/p&gt;

&lt;p&gt;Do we also want to use UTF_8 in those cases?&lt;/p&gt;

&lt;p&gt;Current version one can check at &lt;a href=&quot;https://github.com/dawidwys/flink/tree/encoding&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dawidwys/flink/tree/encoding&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15894244" author="githubbot" created="Fri, 3 Mar 2017 12:25:43 +0000"  >&lt;p&gt;GitHub user dawidwys opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5824&quot; title=&quot;Fix String/byte conversions without explicit encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5824&quot;&gt;&lt;del&gt;FLINK-5824&lt;/del&gt;&lt;/a&gt; Fix String/byte conversions without explicit encoding&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dawidwys/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dawidwys/flink&lt;/a&gt; flink5824&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3468&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0aaf7a843ffb4ef5667e9b2517fd537f3b0323b5&lt;br/&gt;
Author: Dawid Wysakowicz &amp;lt;dawid@getindata.com&amp;gt;&lt;br/&gt;
Date:   2017-03-03T12:24:49Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5824&quot; title=&quot;Fix String/byte conversions without explicit encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5824&quot;&gt;&lt;del&gt;FLINK-5824&lt;/del&gt;&lt;/a&gt; Fix String/byte conversions without explicit encoding&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15895624" author="githubbot" created="Sat, 4 Mar 2017 10:31:02 +0000"  >&lt;p&gt;Github user shijinkui commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good changes. `ConfigConstants.DEFAULT_CHARSET` change to `ConfigConstants.UTF_8 ` may be more clear.&lt;/p&gt;</comment>
                            <comment id="15897062" author="githubbot" created="Mon, 6 Mar 2017 10:32:52 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @shijinkui I think the idea of having this Constant in `ConfigConstant` is it could potentially be set to some other value. If I am mistaken I would instead of using `ConfigConstants.UTF_8` opt for java7&apos;s `StandardCharsets.UTF_8` directly.&lt;/p&gt;</comment>
                            <comment id="15897179" author="githubbot" created="Mon, 6 Mar 2017 12:07:35 +0000"  >&lt;p&gt;Github user shijinkui commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    As your current replacement with `ConfigConstants.DEFAULT_CHARSET`, it&apos;s better for setting other charsets. UTF_8 has clear semantics. If we&apos;ll never change the default charset utf_8 to other charset, I prefer `ConfigConstants.UTF_8`&lt;/p&gt;</comment>
                            <comment id="15897189" author="githubbot" created="Mon, 6 Mar 2017 12:18:54 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m in favor of using ```ConfigConstants.DEFAULT_CHARSET```. Using ```ConfigConstants.UTF_8``` does not imply in any way that this is the default that anyone should use; it would be equivalent to using ```StandardCharsets.UTF_8```.&lt;/p&gt;</comment>
                            <comment id="15899233" author="githubbot" created="Tue, 7 Mar 2017 10:58:30 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I would prefer to keep the value in `ConfigConstants`, just because it clearly defines in one place what we want to use as the default (rather than passing `StandardCharsets.UTF_8` everywhere).&lt;/p&gt;

&lt;p&gt;    As for the name, I think both suggestions are fine in the end. It is unlikely that we ever switch the charset, especially since checkpoints and high-availability storage encodes data in that charset.&lt;/p&gt;

&lt;p&gt;    What would be good to have is a test that checks that we never use a byte conversion without a charset. Maybe a checkstyle rule. If that does not work, we can try and do a `Reflections` test (see RpcCompletenessTest for an example of how to reflectively analyze code in tests).&lt;/p&gt;</comment>
                            <comment id="15899543" author="githubbot" created="Tue, 7 Mar 2017 14:44:25 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    So as I mentioned in JIRA I don&apos;t see a way to do it in checkstyle rule. &lt;/p&gt;

&lt;p&gt;    I managed to implement a test that performs the check using `Reflections` but I don&apos;t know where shall I place it. The problem is that only files from packages that are dependencies to the module with this test will be checked. First idea I had was to put it in the `filnk-tests` module, but it does not depend on e.g. any of `flink-connectors`&lt;/p&gt;</comment>
                            <comment id="15899839" author="githubbot" created="Tue, 7 Mar 2017 17:53:03 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think starting with `flink-tests` is good, we can then improve from there.&lt;/p&gt;</comment>
                            <comment id="15901388" author="githubbot" created="Wed, 8 Mar 2017 15:01:33 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good change, thanks!&lt;br/&gt;
    Merging this...&lt;/p&gt;</comment>
                            <comment id="15902941" author="githubbot" created="Thu, 9 Mar 2017 12:03:54 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3468&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15902950" author="stephanewen" created="Thu, 9 Mar 2017 12:06:06 +0000"  >&lt;p&gt;Fixed via 53fedbd2894c6c7b839d8fdcc0dbf1e6e21e631a&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a6gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>