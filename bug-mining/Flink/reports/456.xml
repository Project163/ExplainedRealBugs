<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:20:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2124] FromElementsFunction is not really Serializable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2124</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The function stores an Iterable of T. T is not necessarily Serializable and and Iterable is also not necessarily Serializable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834203">FLINK-2124</key>
            <summary>FromElementsFunction is not really Serializable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jreiffers">Johannes Reifferscheid</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Jun 2015 10:40:46 +0000</created>
                <updated>Thu, 28 Feb 2019 11:15:29 +0000</updated>
                            <resolved>Wed, 8 Jul 2015 18:37:59 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14589784" author="githubbot" created="Wed, 17 Jun 2015 13:56:48 +0000"  >&lt;p&gt;GitHub user jreiffers opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2124&quot; title=&quot;FromElementsFunction is not really Serializable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2124&quot;&gt;&lt;del&gt;FLINK-2124&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Fix behavior of FromElementsFunction when T &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;isn&apos;t Serializable&lt;/p&gt;

&lt;p&gt;    rewrite FromElementsFunction to work with arbitrary types. The elements are serialized to a byte array (using a TypeSerializer) when the FromElementsFunction is constructed and deserialized when run is called.&lt;/p&gt;

&lt;p&gt;    I also removed the (Collection&amp;lt;T&amp;gt;) constructor, because all Collections are Iterable.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jreiffers/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jreiffers/flink&lt;/a&gt; flink-2124&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #848&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 171bfd115572b3d11962c28b48db3f2ceefd8280&lt;br/&gt;
Author: Johannes Reifferscheid &amp;lt;j.reifferscheid@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-06-17T13:35:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2124&quot; title=&quot;FromElementsFunction is not really Serializable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2124&quot;&gt;&lt;del&gt;FLINK-2124&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Fix behavior of FromElementsFunction when T isn&apos;t Serializable&lt;/p&gt;

&lt;p&gt;    rewrite FromElementsFunction to work with arbitrary types. The elements&lt;br/&gt;
    are serialized to a byte array (using a TypeSerializer) when the FromElementsFunction is&lt;br/&gt;
    constructed and deserialized when run is called.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14591480" author="githubbot" created="Thu, 18 Jun 2015 08:37:47 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32708806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32708806&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,71 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.*;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public Iterator&amp;lt;T&amp;gt; iterator() {&lt;br/&gt;
    +				return new Iterator&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +					int index = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public boolean hasNext() &lt;/p&gt;
{
    +						return index &amp;lt; elements.length;
    +					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Collection&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public T next() 
{
    +						return elements[index++];
    +					}
&lt;p&gt;    +				};&lt;br/&gt;
    +			}&lt;br/&gt;
    +		});&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Iterable&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, Iterable&amp;lt;T&amp;gt; elements) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		ByteArrayOutputStream baos = new ByteArrayOutputStream();    +		OutputViewDataOutputStreamWrapper wrapper = new OutputViewDataOutputStreamWrapper(new DataOutputStream(baos));    +    +		try {
    +			for (T element : elements)
    +				serializer.serialize(element, wrapper);
    +		} catch (IOException e) {
    +			// ByteArrayOutputStream doesn&apos;t throw IOExceptions when written to
    +		}    +		// closing the DataOutputStream would just flush the ByteArrayOutputStream, which in turn doesn&amp;#39;t do anything.    +    +		this.serializer = serializer;    +		this.elements = baos.toByteArray();     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;br/&gt;
     	public void run(SourceContext&amp;lt;T&amp;gt; ctx) throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;T&amp;gt; it = iterable.iterator();&lt;br/&gt;
    +		T value = serializer.createInstance();&lt;br/&gt;
    +		ByteArrayInputStream bais = new ByteArrayInputStream(elements);&lt;br/&gt;
    +		DataInputView input = new InputViewDataInputStreamWrapper(new DataInputStream(bais));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;while (isRunning &amp;amp;&amp;amp; it.hasNext()) {&lt;/li&gt;
	&lt;li&gt;ctx.collect(it.next());&lt;br/&gt;
    +		while (isRunning &amp;amp;&amp;amp; bais.available() &amp;gt; 0) 
{
    +			value = serializer.deserialize(value, input);
    +			ctx.collect(value);
     		}
&lt;p&gt;    +		// closing the DataOutputStream would just close the ByteArrayInputStream, which doesn&apos;t do anything&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I guess you meant the `DataInputStream`.&lt;/p&gt;</comment>
                            <comment id="14591485" author="githubbot" created="Thu, 18 Jun 2015 08:40:48 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32709026&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32709026&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,71 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.*;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public Iterator&amp;lt;T&amp;gt; iterator() {&lt;br/&gt;
    +				return new Iterator&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +					int index = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public boolean hasNext() &lt;/p&gt;
{
    +						return index &amp;lt; elements.length;
    +					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Collection&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public T next() 
{
    +						return elements[index++];
    +					}
&lt;p&gt;    +				};&lt;br/&gt;
    +			}&lt;br/&gt;
    +		});&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Iterable&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, Iterable&amp;lt;T&amp;gt; elements) {&lt;br/&gt;
    +		ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
    +		OutputViewDataOutputStreamWrapper wrapper = new OutputViewDataOutputStreamWrapper(new DataOutputStream(baos));&lt;br/&gt;
    +&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			for (T element : elements)&lt;br/&gt;
    +				serializer.serialize(element, wrapper);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Implicit coding conventions are to put curly brackets also around one line `for` statements.&lt;/p&gt;</comment>
                            <comment id="14591488" author="githubbot" created="Thu, 18 Jun 2015 08:42:33 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32709133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32709133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,71 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.*;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The checkstyle plugin complains about the `.*` import here. You have to import the different streams explicitly.&lt;/p&gt;</comment>
                            <comment id="14591494" author="githubbot" created="Thu, 18 Jun 2015 08:47:11 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#issuecomment-113079060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#issuecomment-113079060&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for your contribution @jreiffers. The PR looks really good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; There is only a problem with the `.*` import.&lt;/p&gt;

&lt;p&gt;    I was thinking about adding a test case where we create a `FromElementsFunction` with non serializable data elements. What do you think?&lt;/p&gt;</comment>
                            <comment id="14591510" author="githubbot" created="Thu, 18 Jun 2015 08:57:26 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#issuecomment-113081149&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#issuecomment-113081149&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    LGTM. +1 for merging once Travis has given green light.&lt;/p&gt;</comment>
                            <comment id="14592987" author="githubbot" created="Fri, 19 Jun 2015 04:38:52 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32801136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32801136&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public Iterator&amp;lt;T&amp;gt; iterator() {&lt;br/&gt;
    +				return new Iterator&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +					int index = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public boolean hasNext() &lt;/p&gt;
{
    +						return index &amp;lt; elements.length;
    +					}
&lt;p&gt;    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public T next() &lt;/p&gt;
{
    +						return elements[index++];
    +					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Collection&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public void remove() 
{
    +						throw new UnsupportedOperationException();
    +					}
&lt;p&gt;    +				};&lt;br/&gt;
    +			}&lt;br/&gt;
    +		});&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Iterable&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, Iterable&amp;lt;T&amp;gt; elements) {&lt;br/&gt;
    +		ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
    +		OutputViewDataOutputStreamWrapper wrapper = new OutputViewDataOutputStreamWrapper(new DataOutputStream(baos));&lt;br/&gt;
    +&lt;br/&gt;
    +		try 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			for (T element }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (IOException e) {&lt;br/&gt;
    +			// ByteArrayOutputStream doesn&apos;t throw IOExceptions when written to&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think not forwarding the exception here is a bad idea.&lt;/p&gt;</comment>
                            <comment id="14593297" author="githubbot" created="Fri, 19 Jun 2015 10:26:09 +0000"  >&lt;p&gt;Github user mbalassi commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32817766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32817766&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public Iterator&amp;lt;T&amp;gt; iterator() {&lt;br/&gt;
    +				return new Iterator&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +					int index = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public boolean hasNext() &lt;/p&gt;
{
    +						return index &amp;lt; elements.length;
    +					}
&lt;p&gt;    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public T next() &lt;/p&gt;
{
    +						return elements[index++];
    +					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Collection&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public void remove() {&lt;br/&gt;
    +						throw new UnsupportedOperationException();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Please add some explanation message to the exception. On paper it is for intrnal use, but still. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14595528" author="githubbot" created="Mon, 22 Jun 2015 08:55:42 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32915439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32915439&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think you can make this much simpler by using `Arrays.asList(elements)`&lt;/p&gt;</comment>
                            <comment id="14595530" author="githubbot" created="Mon, 22 Jun 2015 08:57:00 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32915549&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32915549&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public Iterator&amp;lt;T&amp;gt; iterator() {&lt;br/&gt;
    +				return new Iterator&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +					int index = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public boolean hasNext() &lt;/p&gt;
{
    +						return index &amp;lt; elements.length;
    +					}
&lt;p&gt;    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public T next() &lt;/p&gt;
{
    +						return elements[index++];
    +					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Collection&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public void remove() 
{
    +						throw new UnsupportedOperationException();
    +					}
&lt;p&gt;    +				};&lt;br/&gt;
    +			}&lt;br/&gt;
    +		});&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Iterable&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, Iterable&amp;lt;T&amp;gt; elements) {&lt;br/&gt;
    +		ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
    +		OutputViewDataOutputStreamWrapper wrapper = new OutputViewDataOutputStreamWrapper(new DataOutputStream(baos));&lt;br/&gt;
    +&lt;br/&gt;
    +		try 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			for (T element }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
    +			// ByteArrayOutputStream doesn&apos;t throw IOExceptions when written to
    +		}
&lt;p&gt;    +		// closing the DataOutputStream would just flush the ByteArrayOutputStream, which in turn doesn&apos;t do anything.&lt;br/&gt;
    +&lt;br/&gt;
    +		this.serializer = serializer;&lt;br/&gt;
    +		this.elements = baos.toByteArray();&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;br/&gt;
     	public void run(SourceContext&amp;lt;T&amp;gt; ctx) throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Iterator&amp;lt;T&amp;gt; it = iterable.iterator();&lt;br/&gt;
    +		T value = serializer.createInstance();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Let&apos;s not use object reusing mode by default. It is not guaranteed to always work (some abstract types are not instantiable) and should only work on user-requested activation. Use `value = serializer.deserialize(input);` instead.&lt;/p&gt;</comment>
                            <comment id="14595534" author="githubbot" created="Mon, 22 Jun 2015 08:59:13 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#issuecomment-114044907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#issuecomment-114044907&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think a good addition would be to remember the number of elements in the set, and use that to validate that the deserialization worked properly. Serializers may be user-defined (when they want) and the user-defined serializers may be buggy. Counting the number of elements and verifying that everything is consumed after deserialization is a good way of figuring out whether things are sane, and giving an error if not.&lt;/p&gt;</comment>
                            <comment id="14595545" author="githubbot" created="Mon, 22 Jun 2015 09:06:49 +0000"  >&lt;p&gt;Github user jreiffers commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32916185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32916185&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Maybe. Arrays.asList also unnecessarily copies the array.&lt;/p&gt;</comment>
                            <comment id="14595548" author="githubbot" created="Mon, 22 Jun 2015 09:09:09 +0000"  >&lt;p&gt;Github user jreiffers commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32916320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32916320&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +			@Override&lt;br/&gt;
    +			public Iterator&amp;lt;T&amp;gt; iterator() {&lt;br/&gt;
    +				return new Iterator&amp;lt;T&amp;gt;() {&lt;br/&gt;
    +					int index = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public boolean hasNext() &lt;/p&gt;
{
    +						return index &amp;lt; elements.length;
    +					}
&lt;p&gt;    +&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public T next() &lt;/p&gt;
{
    +						return elements[index++];
    +					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Collection&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +					@Override&lt;br/&gt;
    +					public void remove() 
{
    +						throw new UnsupportedOperationException();
    +					}
&lt;p&gt;    +				};&lt;br/&gt;
    +			}&lt;br/&gt;
    +		});&lt;br/&gt;
     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(Iterable&amp;lt;T&amp;gt; elements) {&lt;/li&gt;
	&lt;li&gt;this.iterable = elements;&lt;br/&gt;
    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, Iterable&amp;lt;T&amp;gt; elements) {&lt;br/&gt;
    +		ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
    +		OutputViewDataOutputStreamWrapper wrapper = new OutputViewDataOutputStreamWrapper(new DataOutputStream(baos));&lt;br/&gt;
    +&lt;br/&gt;
    +		try 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			for (T element }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (IOException e) {&lt;br/&gt;
    +			// ByteArrayOutputStream doesn&apos;t throw IOExceptions when written to&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Right, I missed that.&lt;/p&gt;</comment>
                            <comment id="14595557" author="githubbot" created="Mon, 22 Jun 2015 09:13:46 +0000"  >&lt;p&gt;Github user jreiffers commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848#discussion_r32916595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848#discussion_r32916595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/functions/source/FromElementsFunction.java &amp;#8212;&lt;br/&gt;
    @@ -17,37 +17,81 @@&lt;/p&gt;

&lt;p&gt;     package org.apache.flink.streaming.api.functions.source;&lt;/p&gt;

&lt;p&gt;    -import java.util.Arrays;&lt;br/&gt;
    -import java.util.Collection;&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.TypeSerializer;&lt;br/&gt;
    +import org.apache.flink.core.memory.DataInputView;&lt;br/&gt;
    +import org.apache.flink.core.memory.InputViewDataInputStreamWrapper;&lt;br/&gt;
    +import org.apache.flink.core.memory.OutputViewDataOutputStreamWrapper;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.ByteArrayInputStream;&lt;br/&gt;
    +import java.io.ByteArrayOutputStream;&lt;br/&gt;
    +import java.io.DataInputStream;&lt;br/&gt;
    +import java.io.DataOutputStream;&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
     import java.util.Iterator;&lt;/p&gt;

&lt;p&gt;     public class FromElementsFunction&amp;lt;T&amp;gt; implements SourceFunction&amp;lt;T&amp;gt; {&lt;/p&gt;

&lt;p&gt;     	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Iterable&amp;lt;T&amp;gt; iterable;&lt;br/&gt;
    +	private final TypeSerializer&amp;lt;T&amp;gt; serializer;&lt;br/&gt;
    +	private final byte[] elements;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private volatile boolean isRunning = true;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FromElementsFunction(T... elements) 
{
    -		this.iterable = Arrays.asList(elements);
    -	}
&lt;p&gt;    +	public FromElementsFunction(TypeSerializer&amp;lt;T&amp;gt; serializer, final T... elements) {&lt;br/&gt;
    +		this(serializer, new Iterable&amp;lt;T&amp;gt;() {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    As it turns out, it actually doesn&apos;t... the more you know!&lt;/p&gt;</comment>
                            <comment id="14619115" author="githubbot" created="Wed, 8 Jul 2015 18:31:32 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/848&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14619132" author="stephanewen" created="Wed, 8 Jul 2015 18:37:59 +0000"  >&lt;p&gt;Fixed via e4a030c307597ff7ebf7aa7cc4435947820db3a0 and 28713a2962d97bf8809ad23d96d395d998a98be8&lt;/p&gt;</comment>
                            <comment id="14990012" author="ndimiduk" created="Wed, 4 Nov 2015 17:42:36 +0000"  >&lt;p&gt;I&apos;m running into this bug. Do I have it correct that v0.10 has not been released yet? Is there a suggested work-around? Thanks.&lt;/p&gt;</comment>
                            <comment id="14990451" author="ndimiduk" created="Wed, 4 Nov 2015 21:22:35 +0000"  >&lt;p&gt;I pulled down the snapshot (20151021) to try again. I noticed the error message is wrong, pointing me to &lt;tt&gt;StreamExecutionEnvironment#fromElements(Collection, TypeInformation)&lt;/tt&gt;. That method does not exist. I think &lt;tt&gt;fromCollection&lt;/tt&gt; was intended.&lt;/p&gt;</comment>
                            <comment id="14991504" author="mxm" created="Thu, 5 Nov 2015 10:49:53 +0000"  >&lt;p&gt;Could you post the error message here?&lt;/p&gt;</comment>
                            <comment id="14992044" author="ndimiduk" created="Thu, 5 Nov 2015 17:23:12 +0000"  >&lt;p&gt;Sure. The code looks like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DataStream&amp;lt;Foo&amp;gt; source = ENV.fromElements(
        READER.deserialize(EVENT_1.getBytes()),
        READER.deserialize(EVENT_2.getBytes()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the runtime error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.flink.api.common.InvalidProgramException: Object org.apache.flink.streaming.api.functions.source.FromElementsFunction@548a102f not serializable
	at org.apache.flink.api.java.ClosureCleaner.ensureSerializable(ClosureCleaner.java:97)
	at org.apache.flink.api.java.ClosureCleaner.clean(ClosureCleaner.java:59)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.clean(StreamExecutionEnvironment.java:1191)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.addSource(StreamExecutionEnvironment.java:991)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.fromElements(StreamExecutionEnvironment.java:491)
...
Caused by: java.io.NotSerializableException: Foo
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)
	at java.io.ObjectOutputStream.writeArray(ObjectOutputStream.java:1378)
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174)
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)
	at org.apache.flink.util.InstantiationUtil.serializeObject(InstantiationUtil.java:316)
	at org.apache.flink.api.java.ClosureCleaner.ensureSerializable(ClosureCleaner.java:95)
	... 37 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Foo is a conformant POJO, which is a fully specified extension of a generic superclass.&lt;/p&gt;</comment>
                            <comment id="14992066" author="ndimiduk" created="Thu, 5 Nov 2015 17:37:33 +0000"  >&lt;p&gt;Debugging, it looks like the source exception is being swallowed someplace. It looks like the underlying issue is that TypeExtractor cannot resolve the types of some of the generic arguments. From &lt;tt&gt;TypeInformation&amp;lt;OUT&amp;gt; analyzePojo(Class&amp;lt;OUT&amp;gt; clazz, ArrayList&amp;lt;Type&amp;gt; typeHierarchy, ParameterizedType parameterizedType, TypeInformation&amp;lt;IN1&amp;gt; in1Type, TypeInformation&amp;lt;IN2&amp;gt; in2Type&lt;/tt&gt;, the &lt;tt&gt;catch (InvalidTypesException e)&lt;/tt&gt; stanza from 1343 to 1349, &lt;tt&gt;e&lt;/tt&gt; is &quot;Type of TypeVariable &apos;FROM&apos; in &apos;class Foo&apos; could not be determined. This is most likely a type erasure problem. The type extraction currently supports types with generic variables only in cases where all variables in the return type can be deduced from the input type(s).&quot;&lt;/p&gt;</comment>
                            <comment id="14992103" author="mxm" created="Thu, 5 Nov 2015 17:52:33 +0000"  >&lt;p&gt;Just looked into this. The problem is not exactly the FromElements InputFormat but the ClosureCleaner which tries to serialize the objects using Java serialization. Since the pull request, the fromElements actually supports the serialization framework of Flink but the ClojureCleaner prevents that from working.&lt;/p&gt;

&lt;p&gt;I&apos;m afraid the only workaround until this is fixed is to make your class implement Serializable.&lt;/p&gt;</comment>
                            <comment id="14992106" author="mxm" created="Thu, 5 Nov 2015 17:55:00 +0000"  >&lt;p&gt;Sorry, just had a second look. This is actually not correct. The Flink serialization is fine. The objects have already been serialized when the ClojureCleaner comes into place.&lt;/p&gt;</comment>
                            <comment id="14992128" author="ndimiduk" created="Thu, 5 Nov 2015 18:02:38 +0000"  >&lt;p&gt;I&apos;m also confused. Further debugging, and I tried out &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;&apos;s advice of replacing fromElements with an anonymous instance of ParallelSourceFunction. I&apos;m still getting the same stack out of &lt;tt&gt;ClosureCleaner&lt;/tt&gt; saying my object is not serializable. Indeed, I do not implement &lt;tt&gt;Serializable&lt;/tt&gt; for this object. My understanding was that Flink handled conformant POJOs automatically. Is this not the case with 0.9.1?&lt;/p&gt;</comment>
                            <comment id="14992150" author="mxm" created="Thu, 5 Nov 2015 18:14:06 +0000"  >&lt;p&gt;Flink 0.9.1 has a custom serialization system that works independently of Java serialization but, due to a bug, it is not correctly handled in the fromElements method. So you tried this on the 0.10-SNAPSHOT, right?&lt;/p&gt;

&lt;p&gt;The basic idea of the fix that we have in place is that we use Flink&apos;s type serialization system to serialize all data before we pass the FromElements InputFromat to the ClojureCleaner. The ClojureCleaner should then be fine with the serialized data.&lt;/p&gt;

&lt;p&gt;Could you provide a minimal code example which I could debug? &lt;/p&gt;</comment>
                            <comment id="14992176" author="mxm" created="Thu, 5 Nov 2015 18:22:35 +0000"  >&lt;p&gt;I just tried the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FromElements {

	&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PoJo {
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] test = {&lt;span class=&quot;code-quote&quot;&gt;&quot;Just&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;testing&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;&quot;&lt;/span&gt;};

		@Override
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString() {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Arrays.toString(test);
		}
	}

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

		StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

		DataStreamSource&amp;lt;PoJo&amp;gt; source = env.&amp;lt;PoJo&amp;gt;fromElements(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoJo(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoJo(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PoJo());
		
		source.print();

		env.execute();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It worked fine and the PoJo class is not serializable. Does that example also fail in your setup?&lt;/p&gt;</comment>
                            <comment id="14992544" author="ndimiduk" created="Thu, 5 Nov 2015 21:45:31 +0000"  >&lt;p&gt;Adding &lt;tt&gt;implements Serializable&lt;/tt&gt; to my POJO appears to be mandatory with 0.9.1. Let me see about deconstructing this into a minimal example.&lt;/p&gt;</comment>
                            <comment id="14993417" author="mxm" created="Fri, 6 Nov 2015 09:25:50 +0000"  >&lt;p&gt;Eactly. With 0.9.1 your classes have to implement &lt;tt&gt;Serializable&lt;/tt&gt;. With 0.10-SNAPSHOT and the upcoming 0.10 that&apos;s not required anymore.&lt;/p&gt;

&lt;p&gt;Does that solve your problem?&lt;/p&gt;</comment>
                            <comment id="14994075" author="ndimiduk" created="Fri, 6 Nov 2015 17:51:23 +0000"  >&lt;p&gt;It appears to, yes. Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fg8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>