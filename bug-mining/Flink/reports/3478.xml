<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8949] Rest API failure with long URL</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8949</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When you have jobs with high parallelism, the URL for a REST request can get very long. When the URL is longer than 4096 bytes, the&#160; REST API will return error&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Failure: 404 Not Found&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;This can easily be seen in the Web UI, when Flink queries for the watermark using the REST API:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;GET /jobs/:jobId/vertices/:vertexId/metrics?get=0.currentLowWatermark,1.currentLowWatermark,2.currentLo...&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The request will fail with more than 170 subtasks and the watermark will not be displayed in the Web UI.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13145315">FLINK-8949</key>
            <summary>Rest API failure with long URL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="kien_truong">Truong Duc Kien</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 15 Mar 2018 09:46:50 +0000</created>
                <updated>Wed, 19 Aug 2020 08:53:12 +0000</updated>
                            <resolved>Sat, 7 Dec 2019 21:40:53 +0000</resolved>
                                    <version>1.4.2</version>
                    <version>1.5.0</version>
                    <version>1.6.4</version>
                    <version>1.7.2</version>
                    <version>1.8.2</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Runtime / REST</component>
                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>12</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16400326" author="zentol" created="Thu, 15 Mar 2018 12:41:19 +0000"  >&lt;p&gt;huh, well that&apos;s a problem.&lt;/p&gt;

&lt;p&gt;Unfortunately the UI actually requires the watermark for each subtask, otherwise we could&apos;ve just queried the aggregated minimum instead.&lt;/p&gt;

&lt;p&gt;The metric querying was always a bit verbose&#160;but I don&apos;t see us reworking that anytime soon; although with the aggregating handlers we conceptually know how to do it,&lt;/p&gt;

&lt;p&gt;I guess we&apos;ll just have to batch the requests in multiples of 50&amp;#40;?) or something.&lt;/p&gt;</comment>
                            <comment id="16472156" author="st96d045" created="Fri, 11 May 2018 15:52:57 +0000"  >&lt;p&gt;Running into a similar problem with the REST API to submit a job. The program args that are needed to run the job&#160;make the URL go over the 4096 limit, so a TooLongFrameException is thrown from Netty.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;DefaultFullHttpRequest(decodeResult: failure(io.netty.handler.codec.TooLongFrameException: An HTTP line is larger than 4096 bytes.), version: HTTP/1.0, content: EmptyByteBufBE)&lt;br/&gt;
 GET /bad-request HTTP/1.0&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The issue with this is that the `GET /bad-request` redirect is not mapped to any static resource, and the lookup for such a resource in the classpath comes back empty, and thus the&#160;&lt;cite&gt;Failure: 404 Not Found&lt;/cite&gt; response which is misleading.&lt;/p&gt;

&lt;p&gt;&#160;The sample below is&#160;part of&#160;a job request that fails. As you can see, escaping special chars&#160;in the URL is part of the reason why the size can get really long...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;POST /jars/35ad124e-c3b8-466d-a9ae-4c4bc999ea46_k4m-flink-all-0.0.106.jar/run?program-args=--kpiStreamConfig+%22%7B%2522name%2522%3A%2522TestKPIStream%2522%2C%2522inputs%2522%3A%5B%7B%2522type%2522%3A%2522kafka%2522%2C%2522attributes%2522%3A%7B%2522group.id%2522%3A%2522ngx%2522%2C%2522bootstrap.servers%2522%3A%2522192.168.99.100%3A9092%2522%2C%2522topic%2522%3A%2522input%2522%7D%2C%2522formatter%2522%3A%7B%2522type%2522%3A%2522simpleInput%2522%7D%7D%5D%2C%2522outputs%2522%3A%5B%7B%2522type%2522%3A%2522kafka%2522%2C%2522attributes%2522%3A%7B%2522bootstrap.servers%2522%3A%2522192.168.99.100%3A9092%2522%2C%2522topic%2522%3A%2522output%2522%7D%2C%2522formatter%2522%3A%7B%2522type%2522%3A%2522simpleOutput%2522%7D%7D%5D%2C%2522kpis%2522%3A%5B%7B%2522using%2522%3Anull%2C%2522name%2522%3A%2522affirmed-flow-kpis%2522%2C%2522namespace%2522%3Anull%2C%2522uri%2522%3Anull%2C%2522group%2522%3Anull%7D%5D%2C%2522parallelism%2522%3A1%2C%2522interval%2522%3A0%2C%2522type%2522%3A%2522kpi%2522%2C%2522restartAttempts%2522%3A3%2C%....&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Can the same POST for a submit job request be accomplished without the use of URL params or is this the only option?&#160;&lt;/p&gt;</comment>
                            <comment id="16976595" author="mxm" created="Mon, 18 Nov 2019 14:23:41 +0000"  >&lt;p&gt;Also just debugged this. Running into a problem with long URLs. I think we should increase the maximum line length / header length for requests, or at least allow it to be configured.&lt;/p&gt;</comment>
                            <comment id="16977895" author="thw" created="Tue, 19 Nov 2019 22:45:52 +0000"  >&lt;p&gt;Increasing the limit may give some more mileage, but does not fix the underlying issue with how the metrics are queried: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14470&quot; title=&quot;Watermark display not working with high parallelism job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14470&quot;&gt;&lt;del&gt;FLINK-14470&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16978280" author="zentol" created="Wed, 20 Nov 2019 10:02:07 +0000"  >&lt;p&gt;Yes, increasing the header length is just a band-aid, and I kinda doubt that many users will even find it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vthinkxie&quot; class=&quot;user-hover&quot; rel=&quot;vthinkxie&quot;&gt;vthinkxie&lt;/a&gt; Would it be that difficult to change the UI to only request metrics in batches?&lt;/p&gt;</comment>
                            <comment id="16978345" author="vthinkxie" created="Wed, 20 Nov 2019 11:50:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In my opinion, moving the watermark data into `/jobs/:jobid` is a better solution.&lt;/p&gt;

&lt;p&gt;I have created another issue in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-14147&lt;/a&gt;&#160;for FLIP-75, request metrics in batches would make &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14147&quot; title=&quot; Reduce REST API Request/Response redundancy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14147&quot;&gt;FLINK-14147&lt;/a&gt; problem&#160;worse since there may double or tribble the request to the backend.&lt;/p&gt;</comment>
                            <comment id="16978388" author="mxm" created="Wed, 20 Nov 2019 12:45:02 +0000"  >&lt;p&gt;Just saw the discussion here. We also discussed in the PR (&lt;a href=&quot;https://github.com/apache/flink/pull/10238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/10238&lt;/a&gt;) about adding a &lt;tt&gt;/jobs/:jobid/vertices/:vertexid/watermarks&lt;/tt&gt; endpoint which returns all watermarks for a given vertex. I think this would be the best solution.&lt;/p&gt;</comment>
                            <comment id="16978401" author="vthinkxie" created="Wed, 20 Nov 2019 12:54:38 +0000"  >&lt;p&gt;Adding `/jobs/:jobid/vertices/:vertexid/watermarks` is also&#160;reasonable to me, both&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14147&quot; title=&quot; Reduce REST API Request/Response redundancy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14147&quot;&gt;FLINK-14147&lt;/a&gt;&#160;and&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8949&quot; title=&quot;Rest API failure with long URL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8949&quot;&gt;&lt;del&gt;FLINK-8949&lt;/del&gt;&lt;/a&gt; could be resolved by this rest API.&lt;/p&gt;</comment>
                            <comment id="16978634" author="mxm" created="Wed, 20 Nov 2019 17:59:08 +0000"  >&lt;p&gt;I&apos;ve updated the PR to add the new Rest endpoint, i.e. &lt;tt&gt;/jobs/:jobid/vertices/:vertexid/watermarks&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16984205" author="lining" created="Thu, 28 Nov 2019 07:37:22 +0000"  >&lt;p&gt;Is  /jobs/:jobid/vertices/:vertexId/metrics?get=&lt;span class=&quot;error&quot;&gt;&amp;#91;key&amp;#93;&lt;/span&gt;&amp;amp;subtaskStart=[]&amp;amp;subtaskEnd=[] will better. Now the watermarks just for watermark. If a user want see other metrics, it still not work. &lt;/p&gt;</comment>
                            <comment id="16984227" author="zentol" created="Thu, 28 Nov 2019 08:25:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lining&quot; class=&quot;user-hover&quot; rel=&quot;lining&quot;&gt;lining&lt;/a&gt; I don&apos;t understand what you&apos;re trying to say.&lt;/p&gt;</comment>
                            <comment id="16984281" author="lining" created="Thu, 28 Nov 2019 09:53:55 +0000"  >&lt;p&gt;This solution could solve the problem of watermarks. However, if users want to get the other metrics for the subtasks under the vertex, they will encounter the same problem.&lt;/p&gt;

&lt;p&gt;Maybe we need a more generic solution for this situation, such as querying metrics based on the subtask id range(start subtask id and end subtask id) other than the specific subtask id.&lt;/p&gt;

&lt;p&gt;For example, the user wants to get the current LowWatermark of vertices which parallelism is 100, URL is /jobs/:jobid/vertices/:vertexId/metrics?get=currentLowWatermark &amp;amp; subtaskStart = 0 &amp;amp; subtaskEnd = 99. Other metrics, they just change the value of get.&lt;/p&gt;</comment>
                            <comment id="16984529" author="zentol" created="Thu, 28 Nov 2019 16:40:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lining&quot; class=&quot;user-hover&quot; rel=&quot;lining&quot;&gt;lining&lt;/a&gt; yes, I pointed out that the existing metrics API has severe limitations and needs a rewrite in my first comment to this ticket.&lt;/p&gt;</comment>
                            <comment id="17019542" author="gjy" created="Mon, 20 Jan 2020 15:01:08 +0000"  >&lt;p&gt;I removed &lt;em&gt;&quot;Watermarks for tasks with a high parallelism (&amp;gt;160) can now be queried and displayed correctly in the web frontend.&quot;&lt;/em&gt; from the release notes. Normally, the release notes contain important changes relevant for upgrading from a previous version, such as breaking changes. We do not include all bug fixes in the release notes, and I do not see how this one differs other from other bug fixes. If you think otherwise, feel free to add the release note back.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13173995">FLINK-9931</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13263445">FLINK-14470</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13323502">FLINK-18998</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13263445">FLINK-14470</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rc27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>