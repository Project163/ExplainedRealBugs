<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20944] Launching in application mode requesting a ClusterIP rest service type results in an Exception</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20944</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Run a Flink job in Kubernetes in application mode, specifying kubernetes.rest-service.exposed.type=ClusterIP, results in the job being started, however the call to ./bin/flink throws an UnknownHostException Exception on the client.&lt;/p&gt;

&lt;p&gt;Command line:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;./bin/flink run-application --target kubernetes-application -Dkubernetes.cluster-id=myjob-qa -Dkubernetes.container.image=&lt;em&gt;SOME_REDACTED_PATH/somrepo/someimage&lt;/em&gt; -Dkubernetes.service-account=flink-service-account -Dkubernetes.namespace=myjob-qa -Dkubernetes.rest-service.exposed.type=ClusterIP local:///opt/flink&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;/usrlib/my-job.jar&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;p&gt;2021-01-12 20:29:19,047 INFO org.apache.flink.kubernetes.utils.KubernetesUtils [] - Kubernetes deployment requires a fixed port. Configuration blob.server.port will be set to 6124&lt;br/&gt;
2021-01-12 20:29:19,048 INFO org.apache.flink.kubernetes.utils.KubernetesUtils [] - Kubernetes deployment requires a fixed port. Configuration taskmanager.rpc.port will be set to 6122&lt;br/&gt;
2021-01-12 20:29:20,369 ERROR org.apache.flink.kubernetes.kubeclient.Fabric8FlinkKubeClient [] - A Kubernetes exception occurred.&lt;br/&gt;
java.net.UnknownHostException: myjob-qa-rest.myjob-qa: Name or service not known&lt;br/&gt;
 at java.net.Inet4AddressImpl.lookupAllHostAddr(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:929) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.net.InetAddress.getAllByName0(InetAddress.java:1277) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.net.InetAddress.getAllByName(InetAddress.java:1193) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.net.InetAddress.getAllByName(InetAddress.java:1127) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.net.InetAddress.getByName(InetAddress.java:1077) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_275&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.runtime.highavailability.HighAvailabilityServicesUtils.getWebMonitorAddress(HighAvailabilityServicesUtils.java:193) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.kubernetes.KubernetesClusterDescriptor.lambda$createClusterClientProvider$0(KubernetesClusterDescriptor.java:114) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.kubernetes.KubernetesClusterDescriptor.deployApplicationCluster(KubernetesClusterDescriptor.java:185) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.client.deployment.application.cli.ApplicationClusterDeployer.run(ApplicationClusterDeployer.java:64) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.runApplication(CliFrontend.java:207) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:974) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:1047) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:30) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1047) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.12-1.12.0.jar:1.12.0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------&lt;br/&gt;
 The program finished with the following exception:&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: org.apache.flink.client.deployment.ClusterRetrieveException: Could not create the RestClusterClient.&lt;br/&gt;
 at org.apache.flink.kubernetes.KubernetesClusterDescriptor.lambda$createClusterClientProvider$0(KubernetesClusterDescriptor.java:118)&lt;br/&gt;
 at org.apache.flink.kubernetes.KubernetesClusterDescriptor.deployApplicationCluster(KubernetesClusterDescriptor.java:185)&lt;br/&gt;
 at org.apache.flink.client.deployment.application.cli.ApplicationClusterDeployer.run(ApplicationClusterDeployer.java:64)&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.runApplication(CliFrontend.java:207)&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:974)&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:1047)&lt;br/&gt;
 at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:30)&lt;br/&gt;
 at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1047)&lt;br/&gt;
Caused by: org.apache.flink.client.deployment.ClusterRetrieveException: Could not create the RestClusterClient.&lt;br/&gt;
 ... 8 more&lt;br/&gt;
Caused by: java.net.UnknownHostException: myjob-qa-rest.myjob-qa: Name or service not known&lt;br/&gt;
 at java.net.Inet4AddressImpl.lookupAllHostAddr(Native Method)&lt;br/&gt;
 at java.net.InetAddress$2.lookupAllHostAddr(InetAddress.java:929)&lt;br/&gt;
 at java.net.InetAddress.getAddressesFromNameService(InetAddress.java:1324)&lt;br/&gt;
 at java.net.InetAddress.getAllByName0(InetAddress.java:1277)&lt;br/&gt;
 at java.net.InetAddress.getAllByName(InetAddress.java:1193)&lt;br/&gt;
 at java.net.InetAddress.getAllByName(InetAddress.java:1127)&lt;br/&gt;
 at java.net.InetAddress.getByName(InetAddress.java:1077)&lt;br/&gt;
 at org.apache.flink.runtime.highavailability.HighAvailabilityServicesUtils.getWebMonitorAddress(HighAvailabilityServicesUtils.java:193)&lt;br/&gt;
 at org.apache.flink.kubernetes.KubernetesClusterDescriptor.lambda$createClusterClientProvider$0(KubernetesClusterDescriptor.java:114)&lt;br/&gt;
 ... 7 more&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Kubernetes 1.17&lt;/p&gt;

&lt;p&gt;Flink 1.12&lt;/p&gt;

&lt;p&gt;Running ./bin/flink from an Ubuntu 18.04 host&lt;/p&gt;</environment>
        <key id="13351868">FLINK-20944</key>
            <summary>Launching in application mode requesting a ClusterIP rest service type results in an Exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wangyang0918">Yang Wang</assignee>
                                    <reporter username="jasonbrome">Jason Brome</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 12 Jan 2021 21:33:34 +0000</created>
                <updated>Mon, 23 Aug 2021 13:54:04 +0000</updated>
                            <resolved>Thu, 21 Jan 2021 09:33:50 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Deployment / Kubernetes</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17263855" author="fly_in_gis" created="Wed, 13 Jan 2021 03:08:15 +0000"  >&lt;p&gt;If the &lt;tt&gt;kubernetes.rest-service.exposed.type&lt;/tt&gt; is &lt;tt&gt;ClusterIP&lt;/tt&gt;, then the namespaced service will be used to access the rest endpoint. However, &lt;tt&gt;myjob-qa-rest.myjob-qa&lt;/tt&gt; could only be resolved in the K8s cluster. That is the reason why you have an UnknownHostException.&lt;/p&gt;

&lt;p&gt;If you set the exposed type to &lt;tt&gt;NodePort&lt;/tt&gt;, I think it could work now. Another work around is that you could run the submission command in the K8s cluster(e.g. start a pod and tunnel in).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Moreover, maybe we could improve the behavior since in the application mode we do not need to actually retrieve the rest endpoint.&lt;/p&gt;</comment>
                            <comment id="17264004" author="till.rohrmann" created="Wed, 13 Jan 2021 09:25:55 +0000"  >&lt;p&gt;Yes, maybe we shouldn&apos;t fail if &lt;tt&gt;HighAvailabilityServicesUtils.getWebMonitorAddress&lt;/tt&gt; cannot retrieve the address. If it fails to resolve the address, then we could simply return the unresolved address, for example.&lt;/p&gt;</comment>
                            <comment id="17264019" author="fly_in_gis" created="Wed, 13 Jan 2021 09:49:53 +0000"  >&lt;p&gt;If the &lt;tt&gt;kubernetes.rest-service.exposed.type&lt;/tt&gt; is &lt;tt&gt;ClusterIP&lt;/tt&gt;, then we do not need to resolve the service name. Passing the &lt;tt&gt;NO_ADDRESS_RESOLUTION&lt;/tt&gt;&#160;for &lt;tt&gt;HighAvailabilityServicesUtils.getWebMonitorAddress&lt;/tt&gt; in such situation makes sense.&lt;/p&gt;</comment>
                            <comment id="17265831" author="rmetzger" created="Fri, 15 Jan 2021 08:53:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; are you taking care of this issue?&lt;/p&gt;</comment>
                            <comment id="17265859" author="fly_in_gis" created="Fri, 15 Jan 2021 09:41:52 +0000"  >&lt;p&gt;Yeah. I will attach a PR soon.&lt;/p&gt;</comment>
                            <comment id="17267718" author="fly_in_gis" created="Tue, 19 Jan 2021 07:29:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;&#160;I have attached a PR for this issue. Could you please assign this ticket to me?&lt;/p&gt;</comment>
                            <comment id="17269175" author="till.rohrmann" created="Thu, 21 Jan 2021 09:33:50 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.13.0: 65da60ba4b5038aedbe0edb10d6459a5265cf055&lt;br/&gt;
1.12.2: 8bfddc606e39e656d144ad3d60c70627a0010fc7&lt;/p&gt;</comment>
                            <comment id="17403076" author="alexsell" created="Mon, 23 Aug 2021 09:32:14 +0000"  >&lt;p&gt;Hello, &lt;/p&gt;

&lt;p&gt;as I saw in these commits this resolves the issue in the case of a native kubernetes cluster (correct me if I am wrong), I am just now facing the issue for a standalone kubernetes cluster which uses this &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-clients/src/main/java/org/apache/flink/client/deployment/StandaloneClusterDescriptor.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Descriptor&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;My question would be, can I somehow use the Kubernetes descriptor for a standalone cluster in kubernetes? Or wouldn&apos;t make sense to apply the same solution to the standalone Descriptor?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="17403195" author="till.rohrmann" created="Mon, 23 Aug 2021 13:54:04 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexsell&quot; class=&quot;user-hover&quot; rel=&quot;alexsell&quot;&gt;alexsell&lt;/a&gt;, the property of the standalone cluster is that it does not know about where it runs. Hence, it is difficult for Flink to retrieve any specific information about its runtime when deployed that way. So I fear that this change does not make a lot of sense for the &lt;tt&gt;StandaloneClusterDescriptor&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mir4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>