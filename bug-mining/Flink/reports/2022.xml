<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7902] TwoPhaseCommitSinkFunctions should use custom TypeSerializer</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7902</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, the &lt;tt&gt;FlinkKafkaProducer011&lt;/tt&gt; uses &lt;tt&gt;TypeInformation.of(new TypeHint&amp;lt;State&amp;lt;KafkaTransactionState, KafkaTransactionContext&amp;gt;&amp;gt;() {})&lt;/tt&gt; to create a &lt;tt&gt;TypeInformation&lt;/tt&gt; which in turn is used to create a &lt;tt&gt;StateDescriptor&lt;/tt&gt; for the state that the Kafka sink stores.&lt;/p&gt;

&lt;p&gt;Behind the scenes, this would be roughly analysed as a &lt;tt&gt;PojoType(GenericType&amp;lt;KafkaTransactionState&amp;gt;, GenericType&amp;lt;KafkaTransactionContext&amp;gt;)&lt;/tt&gt; which means we don&apos;t have explicit control over the serialisation format and we also use Kryo (which is the default for &lt;tt&gt;GenericTypeInfo&lt;/tt&gt;). This can be problematic if we want to evolve the state schema in the future or if we want to change Kryo versions.&lt;/p&gt;

&lt;p&gt;We should change &lt;tt&gt;TwoPhaseCommitSinkFunction&lt;/tt&gt; to only have this constructor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TwoPhaseCommitSinkFunction(TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; stateSerializer) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and we should then change the &lt;tt&gt;FlinkKafkaProducer011&lt;/tt&gt; to hand in a custom-made &lt;tt&gt;TypeSerializer&lt;/tt&gt; for the state.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13111416">FLINK-7902</key>
            <summary>TwoPhaseCommitSinkFunctions should use custom TypeSerializer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Oct 2017 13:47:31 +0000</created>
                <updated>Wed, 1 Nov 2017 09:21:37 +0000</updated>
                            <resolved>Wed, 1 Nov 2017 09:20:56 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16224521" author="githubbot" created="Mon, 30 Oct 2017 08:53:37 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7902&quot; title=&quot;TwoPhaseCommitSinkFunctions should use custom TypeSerializer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7902&quot;&gt;&lt;del&gt;FLINK-7902&lt;/del&gt;&lt;/a&gt; Use TypeSerializer in TwoPhaseCommitSinkFunctions &lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Contribution Checklist&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the pull request corresponds to a &lt;span class=&quot;error&quot;&gt;&amp;#91;JIRA issue&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/projects/FLINK/issues&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/FLINK/issues&lt;/a&gt;). Exceptions are made for typos in JavaDoc or documentation files, which need no JIRA issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Name the pull request in the form &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXXX&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;component&amp;#93;&lt;/span&gt; Title of the pull request&quot;, where &lt;b&gt;FLINK-XXXX&lt;/b&gt; should be replaced by the actual issue number. Skip &lt;b&gt;component&lt;/b&gt; if you are unsure about which is the best component.&lt;br/&gt;
      Typo fixes that have no associated JIRA issue should be named following this pattern: `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Fix typo in event time introduction` or `&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;javadocs&amp;#93;&lt;/span&gt; Expand JavaDoc for PuncuatedWatermarkGenerator`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fill out the template below to describe the changes contributed by the pull request. That will give reviewers the context they need to do the review.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Make sure that the change passes the automated tests, i.e., `mvn clean verify` passes. You can set up Travis CI to do that following &lt;span class=&quot;error&quot;&gt;&amp;#91;this guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/contribute-code.html#best-practices&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/contribute-code.html#best-practices&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each pull request should address only one issue, not mix up code from multiple issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each commit in the pull request has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Once all items of the checklist are addressed, remove the above text and this checklist, leaving only the filled out template below.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;    *&lt;b&gt;(The sections below can be removed for hotfixes of typos)&lt;/b&gt;*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(For example: This pull request makes task deployment go through the blob server, rather than through RPC. That way we avoid re-transferring them on each deployment (during recovery).)&lt;/b&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(for example&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;The TaskInfo is stored in the blob store on job creation time as a persistent artifact&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Deployments RPC transmits only the blob storage reference&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;TaskManagers retrieve the TaskInfo from the blob cache&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;(Please pick either of the following options)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;(or)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    This change is already covered by existing tests, such as &lt;b&gt;(please describe tests)&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;(or)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;(example&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/b&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Added integration tests for end-to-end deployment with large payloads (100MB)&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Extended integration test for recovery after master (JobManager) failure&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Added test that validates that TaskInfo is transferred only once across recoveries&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Manually verified the change by running a 4 node cluser with 2 JobManagers and 4 TaskManagers, a stateful streaming program, and killing one JobManager and two TaskManagers during the execution, verifying that recovery happens correctly.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / no)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / no / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; jira-7902-twophase-proper-serializer&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4919&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4a6a3515f5742fa51e3d57b84a503a5163faee35&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-26T12:24:34Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Make internal KafkaProducer11 details package private&lt;/p&gt;

&lt;p&gt;commit 124825a7a9754c650eceb54887f94b0b83a1635e&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-26T12:39:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7902&quot; title=&quot;TwoPhaseCommitSinkFunctions should use custom TypeSerializer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7902&quot;&gt;&lt;del&gt;FLINK-7902&lt;/del&gt;&lt;/a&gt; Use TypeSerializer in TwoPhaseCommitSinkFunctions&lt;/p&gt;

&lt;p&gt;    We use custom serializers to ensure that we have control over the&lt;br/&gt;
    serialization format, which allows us easier evolution of the format in&lt;br/&gt;
    the future.&lt;/p&gt;

&lt;p&gt;    This also implements custom serializers for KafkaProducer11, the only&lt;br/&gt;
    TwoPhaseCommitSinkFunction we currently have.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16224534" author="githubbot" created="Mon, 30 Oct 2017 09:13:43 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    R: @kl0u &lt;/p&gt;</comment>
                            <comment id="16224835" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147678946&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147678946&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -362,4 +374,213 @@ public void setContext(Optional&amp;lt;CONTEXT&amp;gt; context) &lt;/p&gt;
{
     			this.context = context;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Custom &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for the sink state.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	static final class StateSerializer&amp;lt;TXN, CONTEXT&amp;gt; extends TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; {&lt;br/&gt;
    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Define a `serialVersionUID`.&lt;/p&gt;</comment>
                            <comment id="16224836" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147672995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147672995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -958,29 +960,34 @@ public int compare(PartitionInfo o1, PartitionInfo o2) {&lt;br/&gt;
     	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;State for handling transactions.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionState {&lt;br/&gt;
    +	static class KafkaTransactionState {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		private final transient FlinkKafkaProducer&amp;lt;byte[], byte[]&amp;gt; producer;&lt;/p&gt;

&lt;p&gt;     		@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public final String transactionalId;&lt;br/&gt;
    +		final String transactionalId;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public final long producerId;&lt;br/&gt;
    +		final long producerId;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public final short epoch;&lt;br/&gt;
    +		final short epoch;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionState(String transactionalId, FlinkKafkaProducer&amp;lt;byte[], byte[]&amp;gt; producer) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The `public` is not needed as the whole class is not public.&lt;/p&gt;</comment>
                            <comment id="16224837" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147676539&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147676539&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return true;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(KafkaTransactionState from) &lt;/p&gt;
{
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(&lt;br/&gt;
    +			KafkaTransactionState from,&lt;br/&gt;
    +			KafkaTransactionState reuse) {    +			return from;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionState record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			if (record.transactionalId == null) &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				target.writeUTF(record.transactionalId);
    +			}
&lt;p&gt;    +			target.writeLong(record.producerId);&lt;br/&gt;
    +			target.writeShort(record.epoch);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			String transactionalId = null;&lt;br/&gt;
    +			if (source.readBoolean()) &lt;/p&gt;
{
    +				transactionalId = source.readUTF();
    +			}
&lt;p&gt;    +			long producerId = source.readLong();&lt;br/&gt;
    +			short epoch = source.readShort();&lt;br/&gt;
    +			return new KafkaTransactionState(transactionalId, producerId, epoch, null);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(&lt;br/&gt;
    +				KafkaTransactionState reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException &lt;/p&gt;
{
    +			boolean hasTransactionalId = source.readBoolean();
    +			target.writeBoolean(hasTransactionalId);
    +			target.writeUTF(source.readUTF());
    +			target.writeLong(source.readLong());
    +			target.writeShort(source.readShort());
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean canEqual(Object obj) &lt;/p&gt;
{
    +			return obj instanceof TransactionStateSerializer;
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	static class ContextStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionContext&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Define a `serialVersionUID`.&lt;/p&gt;</comment>
                            <comment id="16224838" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147678569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147678569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -79,19 +92,18 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;TwoPhaseCommitSinkFunction(TypeInformation.of(new TypeHint&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt;() {}));&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;&amp;lt;/pre&amp;gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param stateTypeInformation 
{@link TypeInformation}
&lt;p&gt; for POJO holding state of opened transactions.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;public TwoPhaseCommitSinkFunction(TypeInformation&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; stateTypeInformation) 
{
    -		this(new ListStateDescriptor&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt;(&quot;state&quot;, stateTypeInformation));
    -	}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;/**&lt;/li&gt;
	&lt;li&gt;* Instantiate 
{@link TwoPhaseCommitSinkFunction}
&lt;p&gt; with custom state descriptors.&lt;br/&gt;
     	 *&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;* @param stateDescriptor descriptor for transactions POJO.&lt;br/&gt;
    +	 * @param transactionSerializer 
{@link TypeSerializer} for the transaction type of this sink&lt;br/&gt;
    +	 * @param contextSerializer {@link TypeSerializer}
&lt;p&gt; for the context type of this sink&lt;br/&gt;
     	 */&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;public TwoPhaseCommitSinkFunction(ListStateDescriptor&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; stateDescriptor) {&lt;/li&gt;
	&lt;li&gt;this.stateDescriptor = requireNonNull(stateDescriptor, &quot;stateDescriptor is null&quot;);&lt;br/&gt;
    +	public TwoPhaseCommitSinkFunction(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I know this is not part of this PR, but lines 81, 82, 84 should be `transient`.&lt;/p&gt;</comment>
                            <comment id="16224839" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147676219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147676219&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return true;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState createInstance() {
    +			return null;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(KafkaTransactionState from) {
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(&lt;br/&gt;
    +			KafkaTransactionState from,&lt;br/&gt;
    +			KafkaTransactionState reuse) {    +			return from;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() {
    +			return -1;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionState record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			if (record.transactionalId == null) {
    +				target.writeBoolean(false);
    +			} else {
    +				target.writeBoolean(true);
    +				target.writeUTF(record.transactionalId);
    +			}&lt;br/&gt;
    +			target.writeLong(record.producerId);&lt;br/&gt;
    +			target.writeShort(record.epoch);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			String transactionalId = null;&lt;br/&gt;
    +			if (source.readBoolean()) {
    +				transactionalId = source.readUTF();
    +			}&lt;br/&gt;
    +			long producerId = source.readLong();&lt;br/&gt;
    +			short epoch = source.readShort();&lt;br/&gt;
    +			return new KafkaTransactionState(transactionalId, producerId, epoch, null);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(&lt;br/&gt;
    +				KafkaTransactionState reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException {
    +			return deserialize(source);
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException {
    +			boolean hasTransactionalId = source.readBoolean();
    +			target.writeBoolean(hasTransactionalId);
    +			target.writeUTF(source.readUTF());
    +			target.writeLong(source.readLong());
    +			target.writeShort(source.readShort());
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean canEqual(Object obj) {
    +			return obj instanceof TransactionStateSerializer;
    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	static class ContextStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionContext&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() {    +			return true;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionContext createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionContext copy(KafkaTransactionContext from) &lt;/p&gt;
{
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionContext copy(&lt;br/&gt;
    +				KafkaTransactionContext from,&lt;br/&gt;
    +				KafkaTransactionContext reuse) {    +			return from;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionContext record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			int numIds = record.transactionalIds.size();&lt;br/&gt;
    +			target.writeInt(numIds);&lt;br/&gt;
    +			for (String id : record.transactionalIds) &lt;/p&gt;
{
    +				target.writeUTF(id);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionContext deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			int numIds = source.readInt();&lt;br/&gt;
    +			Set&amp;lt;String&amp;gt; ids = new HashSet&amp;lt;&amp;gt;(numIds);&lt;br/&gt;
    +			for (int i = 0; i &amp;lt; numIds; i++) &lt;/p&gt;
{
    +				ids.add(source.readUTF());
    +			}
&lt;p&gt;    +			return new KafkaTransactionContext(ids);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionContext deserialize(&lt;br/&gt;
    +				KafkaTransactionContext reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			int numIds = source.readInt();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You do not write the size of the list to the copy. Just add `target.writeInt(numIds);`.&lt;/p&gt;</comment>
                            <comment id="16224840" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147688912&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147688912&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -362,4 +374,213 @@ public void setContext(Optional&amp;lt;CONTEXT&amp;gt; context) &lt;/p&gt;
{
     			this.context = context;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Custom &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for the sink state.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	static final class StateSerializer&amp;lt;TXN, CONTEXT&amp;gt; extends TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; {&lt;br/&gt;
    +&lt;br/&gt;
    +		private final TypeSerializer&amp;lt;TXN&amp;gt; transactionSerializer;&lt;br/&gt;
    +		private final TypeSerializer&amp;lt;CONTEXT&amp;gt; contextSerializer;&lt;br/&gt;
    +&lt;br/&gt;
    +		public StateSerializer(&lt;br/&gt;
    +				TypeSerializer&amp;lt;TXN&amp;gt; transactionSerializer,&lt;br/&gt;
    +				TypeSerializer&amp;lt;CONTEXT&amp;gt; contextSerializer) &lt;/p&gt;
{
    +			this.transactionSerializer = checkNotNull(transactionSerializer);
    +			this.contextSerializer = checkNotNull(contextSerializer);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return transactionSerializer.isImmutableType() &amp;amp;&amp;amp; contextSerializer.isImmutableType();
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; duplicate() &lt;/p&gt;
{
    +			return new StateSerializer&amp;lt;&amp;gt;(
    +					transactionSerializer.duplicate(), contextSerializer.duplicate());
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; copy(State&amp;lt;TXN, CONTEXT&amp;gt; from) {&lt;br/&gt;
    +			TXN copiedPendingTransaction = transactionSerializer.copy(from.getPendingTransaction());&lt;br/&gt;
    +			List&amp;lt;TXN&amp;gt; copiedPendingCommitTransactions = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
    +			for (TXN txn : from.getPendingCommitTransactions()) &lt;/p&gt;
{
    +				copiedPendingCommitTransactions.add(transactionSerializer.copy(txn));
    +			}
&lt;p&gt;    +			Optional&amp;lt;CONTEXT&amp;gt; copiedContext = from.getContext().map(contextSerializer::copy);&lt;br/&gt;
    +			return new State&amp;lt;&amp;gt;(copiedPendingTransaction, copiedPendingCommitTransactions, copiedContext);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; copy(&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; from,&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; reuse) &lt;/p&gt;
{
    +			return copy(from);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			transactionSerializer.serialize(record.getPendingTransaction(), target);&lt;br/&gt;
    +			List&amp;lt;TXN&amp;gt; pendingCommitTransactions = record.getPendingCommitTransactions();&lt;br/&gt;
    +			target.writeInt(pendingCommitTransactions.size());&lt;br/&gt;
    +			for (TXN pendingTxn : pendingCommitTransactions) &lt;/p&gt;
{
    +				transactionSerializer.serialize(pendingTxn, target);
    +			}
&lt;p&gt;    +			Optional&amp;lt;CONTEXT&amp;gt; context = record.getContext();&lt;br/&gt;
    +			if (context.isPresent()) &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				contextSerializer.serialize(context.get(), target);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			TXN pendingTxn = transactionSerializer.deserialize(source);&lt;br/&gt;
    +			int numPendingCommitTxns = source.readInt();&lt;br/&gt;
    +			List&amp;lt;TXN&amp;gt; pendingCommitTxns = new ArrayList&amp;lt;&amp;gt;(numPendingCommitTxns);&lt;br/&gt;
    +			for (int i = 0; i &amp;lt; numPendingCommitTxns; i++) &lt;/p&gt;
{
    +				pendingCommitTxns.add(transactionSerializer.deserialize(source));
    +			}
&lt;p&gt;    +			Optional&amp;lt;CONTEXT&amp;gt; context = Optional.empty();&lt;br/&gt;
    +			boolean hasContext = source.readBoolean();&lt;br/&gt;
    +			if (hasContext) &lt;/p&gt;
{
    +				context = Optional.of(contextSerializer.deserialize(source));
    +			}
&lt;p&gt;    +			return new State&amp;lt;&amp;gt;(pendingTxn, pendingCommitTxns, context);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; deserialize(&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException {&lt;br/&gt;
    +			TXN pendingTxn = transactionSerializer.deserialize(source);&lt;br/&gt;
    +			transactionSerializer.serialize(pendingTxn, target);&lt;br/&gt;
    +			int numPendingCommitTxns = source.readInt();&lt;br/&gt;
    +			target.writeInt(numPendingCommitTxns);&lt;br/&gt;
    +			for (int i = 0; i &amp;lt; numPendingCommitTxns; i++) &lt;/p&gt;
{
    +				TXN pendingCommitTxn = transactionSerializer.deserialize(source);
    +				transactionSerializer.serialize(pendingCommitTxn, target);
    +			}
&lt;p&gt;    +			boolean hasContext = source.readBoolean();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Here you should also write the `hasContext` to the `target`.&lt;/p&gt;</comment>
                            <comment id="16224841" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147674429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147674429&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return true;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(KafkaTransactionState from) &lt;/p&gt;
{
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(&lt;br/&gt;
    +			KafkaTransactionState from,&lt;br/&gt;
    +			KafkaTransactionState reuse) {    +			return from;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionState record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			if (record.transactionalId == null) &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				target.writeUTF(record.transactionalId);
    +			}
&lt;p&gt;    +			target.writeLong(record.producerId);&lt;br/&gt;
    +			target.writeShort(record.epoch);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			String transactionalId = null;&lt;br/&gt;
    +			if (source.readBoolean()) &lt;/p&gt;
{
    +				transactionalId = source.readUTF();
    +			}
&lt;p&gt;    +			long producerId = source.readLong();&lt;br/&gt;
    +			short epoch = source.readShort();&lt;br/&gt;
    +			return new KafkaTransactionState(transactionalId, producerId, epoch, null);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(&lt;br/&gt;
    +				KafkaTransactionState reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException {&lt;br/&gt;
    +			boolean hasTransactionalId = source.readBoolean();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    For uniformity, this can become: `target.writeBoolean(source.readBoolean())`.&lt;/p&gt;</comment>
                            <comment id="16224842" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147673504&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147673504&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Define a `serialVersionUID`.&lt;/p&gt;</comment>
                            <comment id="16224843" author="githubbot" created="Mon, 30 Oct 2017 12:39:00 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147675623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147675623&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {&lt;br/&gt;
    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Here we should check for `null` for the `transactionalIds`. If this is null, it will also break the `ContextStateSerializer.serialize()` method.&lt;/p&gt;</comment>
                            <comment id="16224848" author="githubbot" created="Mon, 30 Oct 2017 12:43:02 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147691059&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147691059&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -958,29 +960,34 @@ public int compare(PartitionInfo o1, PartitionInfo o2) {&lt;br/&gt;
     	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;State for handling transactions.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionState {&lt;br/&gt;
    +	static class KafkaTransactionState {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		private final transient FlinkKafkaProducer&amp;lt;byte[], byte[]&amp;gt; producer;&lt;/p&gt;

&lt;p&gt;     		@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public final String transactionalId;&lt;br/&gt;
    +		final String transactionalId;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public final long producerId;&lt;br/&gt;
    +		final long producerId;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public final short epoch;&lt;br/&gt;
    +		final short epoch;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionState(String transactionalId, FlinkKafkaProducer&amp;lt;byte[], byte[]&amp;gt; producer) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16224849" author="githubbot" created="Mon, 30 Oct 2017 12:43:34 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147691153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147691153&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {&lt;br/&gt;
    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16224850" author="githubbot" created="Mon, 30 Oct 2017 12:44:03 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147691305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147691305&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16224854" author="githubbot" created="Mon, 30 Oct 2017 12:45:27 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147691545&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147691545&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return true;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(KafkaTransactionState from) &lt;/p&gt;
{
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(&lt;br/&gt;
    +			KafkaTransactionState from,&lt;br/&gt;
    +			KafkaTransactionState reuse) {    +			return from;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionState record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			if (record.transactionalId == null) &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				target.writeUTF(record.transactionalId);
    +			}
&lt;p&gt;    +			target.writeLong(record.producerId);&lt;br/&gt;
    +			target.writeShort(record.epoch);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			String transactionalId = null;&lt;br/&gt;
    +			if (source.readBoolean()) &lt;/p&gt;
{
    +				transactionalId = source.readUTF();
    +			}
&lt;p&gt;    +			long producerId = source.readLong();&lt;br/&gt;
    +			short epoch = source.readShort();&lt;br/&gt;
    +			return new KafkaTransactionState(transactionalId, producerId, epoch, null);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(&lt;br/&gt;
    +				KafkaTransactionState reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException {&lt;br/&gt;
    +			boolean hasTransactionalId = source.readBoolean();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    No, I actually have to do this:&lt;br/&gt;
    ```&lt;br/&gt;
    			if (hasTransactionalId) &lt;/p&gt;
{
    				target.writeUTF(source.readUTF());
    			}
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    But thanks for noticing. :sweat:&lt;/p&gt;</comment>
                            <comment id="16224856" author="githubbot" created="Mon, 30 Oct 2017 12:45:34 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147691567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147691567&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return true;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(KafkaTransactionState from) &lt;/p&gt;
{
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(&lt;br/&gt;
    +			KafkaTransactionState from,&lt;br/&gt;
    +			KafkaTransactionState reuse) {    +			return from;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionState record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			if (record.transactionalId == null) &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				target.writeUTF(record.transactionalId);
    +			}
&lt;p&gt;    +			target.writeLong(record.producerId);&lt;br/&gt;
    +			target.writeShort(record.epoch);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			String transactionalId = null;&lt;br/&gt;
    +			if (source.readBoolean()) &lt;/p&gt;
{
    +				transactionalId = source.readUTF();
    +			}
&lt;p&gt;    +			long producerId = source.readLong();&lt;br/&gt;
    +			short epoch = source.readShort();&lt;br/&gt;
    +			return new KafkaTransactionState(transactionalId, producerId, epoch, null);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(&lt;br/&gt;
    +				KafkaTransactionState reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException &lt;/p&gt;
{
    +			boolean hasTransactionalId = source.readBoolean();
    +			target.writeBoolean(hasTransactionalId);
    +			target.writeUTF(source.readUTF());
    +			target.writeLong(source.readLong());
    +			target.writeShort(source.readShort());
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean canEqual(Object obj) &lt;/p&gt;
{
    +			return obj instanceof TransactionStateSerializer;
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	static class ContextStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionContext&amp;gt; {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16224861" author="githubbot" created="Mon, 30 Oct 2017 12:47:53 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147692002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147692002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -362,4 +374,213 @@ public void setContext(Optional&amp;lt;CONTEXT&amp;gt; context) &lt;/p&gt;
{
     			this.context = context;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Custom &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for the sink state.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	static final class StateSerializer&amp;lt;TXN, CONTEXT&amp;gt; extends TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; {&lt;br/&gt;
    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16224863" author="githubbot" created="Mon, 30 Oct 2017 12:48:29 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147692117&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147692117&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -362,4 +374,213 @@ public void setContext(Optional&amp;lt;CONTEXT&amp;gt; context) &lt;/p&gt;
{
     			this.context = context;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Custom &lt;/p&gt;
{@link TypeSerializer}
&lt;p&gt; for the sink state.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	static final class StateSerializer&amp;lt;TXN, CONTEXT&amp;gt; extends TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; {&lt;br/&gt;
    +&lt;br/&gt;
    +		private final TypeSerializer&amp;lt;TXN&amp;gt; transactionSerializer;&lt;br/&gt;
    +		private final TypeSerializer&amp;lt;CONTEXT&amp;gt; contextSerializer;&lt;br/&gt;
    +&lt;br/&gt;
    +		public StateSerializer(&lt;br/&gt;
    +				TypeSerializer&amp;lt;TXN&amp;gt; transactionSerializer,&lt;br/&gt;
    +				TypeSerializer&amp;lt;CONTEXT&amp;gt; contextSerializer) &lt;/p&gt;
{
    +			this.transactionSerializer = checkNotNull(transactionSerializer);
    +			this.contextSerializer = checkNotNull(contextSerializer);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return transactionSerializer.isImmutableType() &amp;amp;&amp;amp; contextSerializer.isImmutableType();
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public TypeSerializer&amp;lt;State&amp;lt;TXN, CONTEXT&amp;gt;&amp;gt; duplicate() &lt;/p&gt;
{
    +			return new StateSerializer&amp;lt;&amp;gt;(
    +					transactionSerializer.duplicate(), contextSerializer.duplicate());
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; copy(State&amp;lt;TXN, CONTEXT&amp;gt; from) {&lt;br/&gt;
    +			TXN copiedPendingTransaction = transactionSerializer.copy(from.getPendingTransaction());&lt;br/&gt;
    +			List&amp;lt;TXN&amp;gt; copiedPendingCommitTransactions = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
    +			for (TXN txn : from.getPendingCommitTransactions()) &lt;/p&gt;
{
    +				copiedPendingCommitTransactions.add(transactionSerializer.copy(txn));
    +			}
&lt;p&gt;    +			Optional&amp;lt;CONTEXT&amp;gt; copiedContext = from.getContext().map(contextSerializer::copy);&lt;br/&gt;
    +			return new State&amp;lt;&amp;gt;(copiedPendingTransaction, copiedPendingCommitTransactions, copiedContext);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; copy(&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; from,&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; reuse) &lt;/p&gt;
{
    +			return copy(from);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			transactionSerializer.serialize(record.getPendingTransaction(), target);&lt;br/&gt;
    +			List&amp;lt;TXN&amp;gt; pendingCommitTransactions = record.getPendingCommitTransactions();&lt;br/&gt;
    +			target.writeInt(pendingCommitTransactions.size());&lt;br/&gt;
    +			for (TXN pendingTxn : pendingCommitTransactions) &lt;/p&gt;
{
    +				transactionSerializer.serialize(pendingTxn, target);
    +			}
&lt;p&gt;    +			Optional&amp;lt;CONTEXT&amp;gt; context = record.getContext();&lt;br/&gt;
    +			if (context.isPresent()) &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				contextSerializer.serialize(context.get(), target);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			TXN pendingTxn = transactionSerializer.deserialize(source);&lt;br/&gt;
    +			int numPendingCommitTxns = source.readInt();&lt;br/&gt;
    +			List&amp;lt;TXN&amp;gt; pendingCommitTxns = new ArrayList&amp;lt;&amp;gt;(numPendingCommitTxns);&lt;br/&gt;
    +			for (int i = 0; i &amp;lt; numPendingCommitTxns; i++) &lt;/p&gt;
{
    +				pendingCommitTxns.add(transactionSerializer.deserialize(source));
    +			}
&lt;p&gt;    +			Optional&amp;lt;CONTEXT&amp;gt; context = Optional.empty();&lt;br/&gt;
    +			boolean hasContext = source.readBoolean();&lt;br/&gt;
    +			if (hasContext) &lt;/p&gt;
{
    +				context = Optional.of(contextSerializer.deserialize(source));
    +			}
&lt;p&gt;    +			return new State&amp;lt;&amp;gt;(pendingTxn, pendingCommitTxns, context);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public State&amp;lt;TXN, CONTEXT&amp;gt; deserialize(&lt;br/&gt;
    +				State&amp;lt;TXN, CONTEXT&amp;gt; reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException {&lt;br/&gt;
    +			TXN pendingTxn = transactionSerializer.deserialize(source);&lt;br/&gt;
    +			transactionSerializer.serialize(pendingTxn, target);&lt;br/&gt;
    +			int numPendingCommitTxns = source.readInt();&lt;br/&gt;
    +			target.writeInt(numPendingCommitTxns);&lt;br/&gt;
    +			for (int i = 0; i &amp;lt; numPendingCommitTxns; i++) &lt;/p&gt;
{
    +				TXN pendingCommitTxn = transactionSerializer.deserialize(source);
    +				transactionSerializer.serialize(pendingCommitTxn, target);
    +			}
&lt;p&gt;    +			boolean hasContext = source.readBoolean();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16224865" author="githubbot" created="Mon, 30 Oct 2017 12:48:55 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147692203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147692203&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -993,14 +1000,162 @@ public String toString() {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Context associated to this instance of the 
{@link FlinkKafkaProducer011}
&lt;p&gt;. User for keeping track of the&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transactionalIds.&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static class KafkaTransactionContext {&lt;/li&gt;
	&lt;li&gt;public final Set&amp;lt;String&amp;gt; transactionalIds;&lt;br/&gt;
    +	static class KafkaTransactionContext {&lt;br/&gt;
    +		final Set&amp;lt;String&amp;gt; transactionalIds;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		KafkaTransactionContext(Set&amp;lt;String&amp;gt; transactionalIds) {
     			this.transactionalIds = transactionalIds;
     		}     	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	static class TransactionStateSerializer extends TypeSerializerSingleton&amp;lt;KafkaTransactionState&amp;gt; {&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean isImmutableType() &lt;/p&gt;
{
    +			return true;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState createInstance() &lt;/p&gt;
{
    +			return null;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(KafkaTransactionState from) &lt;/p&gt;
{
    +			return from;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState copy(&lt;br/&gt;
    +			KafkaTransactionState from,&lt;br/&gt;
    +			KafkaTransactionState reuse) {    +			return from;    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public int getLength() &lt;/p&gt;
{
    +			return -1;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void serialize(&lt;br/&gt;
    +				KafkaTransactionState record,&lt;br/&gt;
    +				DataOutputView target) throws IOException {&lt;br/&gt;
    +			if (record.transactionalId == null) &lt;/p&gt;
{
    +				target.writeBoolean(false);
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				target.writeBoolean(true);
    +				target.writeUTF(record.transactionalId);
    +			}
&lt;p&gt;    +			target.writeLong(record.producerId);&lt;br/&gt;
    +			target.writeShort(record.epoch);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(DataInputView source) throws IOException {&lt;br/&gt;
    +			String transactionalId = null;&lt;br/&gt;
    +			if (source.readBoolean()) &lt;/p&gt;
{
    +				transactionalId = source.readUTF();
    +			}
&lt;p&gt;    +			long producerId = source.readLong();&lt;br/&gt;
    +			short epoch = source.readShort();&lt;br/&gt;
    +			return new KafkaTransactionState(transactionalId, producerId, epoch, null);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public KafkaTransactionState deserialize(&lt;br/&gt;
    +				KafkaTransactionState reuse,&lt;br/&gt;
    +				DataInputView source) throws IOException &lt;/p&gt;
{
    +			return deserialize(source);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public void copy(&lt;br/&gt;
    +				DataInputView source, DataOutputView target) throws IOException {&lt;br/&gt;
    +			boolean hasTransactionalId = source.readBoolean();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes, you are right.&lt;/p&gt;</comment>
                            <comment id="16224907" author="githubbot" created="Mon, 30 Oct 2017 13:18:14 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I addressed your comments and also added a new test for the state serialiser.&lt;/p&gt;</comment>
                            <comment id="16224984" author="githubbot" created="Mon, 30 Oct 2017 13:48:32 +0000"  >&lt;p&gt;Github user kl0u commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147704985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147704985&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -361,5 +376,247 @@ public void setPendingCommitTransactions(List&amp;lt;TXN&amp;gt; pendingCommitTransactions) {&lt;br/&gt;
     		public void setContext(Optional&amp;lt;CONTEXT&amp;gt; context) &lt;/p&gt;
{
     			this.context = context;
     		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean equals(Object o) {&lt;br/&gt;
    +			if (this == o) &lt;/p&gt;
{
    +				return true;
    +			}
&lt;p&gt;    +			if (o == null || getClass() != o.getClass()) &lt;/p&gt;
{
    +				return false;
    +			}
&lt;p&gt;    +&lt;br/&gt;
    +			State&amp;lt;?, ?&amp;gt; state = (State&amp;lt;?, ?&amp;gt;) o;&lt;br/&gt;
    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Not a deal breaker but these if&apos;s are a bit too complicated.&lt;br/&gt;
    Using `Objects.equals()` on each of the components and `&amp;amp;&amp;amp;` would simplify them.&lt;/p&gt;</comment>
                            <comment id="16225008" author="githubbot" created="Mon, 30 Oct 2017 14:07:29 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919#discussion_r147711564&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919#discussion_r147711564&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java &amp;#8212;&lt;br/&gt;
    @@ -361,5 +376,247 @@ public void setPendingCommitTransactions(List&amp;lt;TXN&amp;gt; pendingCommitTransactions) {&lt;br/&gt;
     		public void setContext(Optional&amp;lt;CONTEXT&amp;gt; context) &lt;/p&gt;
{
     			this.context = context;
     		}
&lt;p&gt;    +&lt;br/&gt;
    +		@Override&lt;br/&gt;
    +		public boolean equals(Object o) {&lt;br/&gt;
    +			if (this == o) &lt;/p&gt;
{
    +				return true;
    +			}
&lt;p&gt;    +			if (o == null || getClass() != o.getClass()) &lt;/p&gt;
{
    +				return false;
    +			}
&lt;p&gt;    +&lt;br/&gt;
    +			State&amp;lt;?, ?&amp;gt; state = (State&amp;lt;?, ?&amp;gt;) o;&lt;br/&gt;
    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I used IntelliJ to generate those. :sweat_smile:&lt;/p&gt;</comment>
                            <comment id="16233824" author="githubbot" created="Wed, 1 Nov 2017 09:20:33 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16233825" author="aljoscha" created="Wed, 1 Nov 2017 09:20:56 +0000"  >&lt;p&gt;Fixed in 0ba528c71e35858a043bd513ead37800262f7e0c&lt;/p&gt;</comment>
                            <comment id="16233826" author="githubbot" created="Wed, 1 Nov 2017 09:21:37 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4919&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for reviewing, @kl0u! &#128515; &lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3llbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>