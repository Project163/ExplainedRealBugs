<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4283] ExecutionGraphRestartTest fails</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4283</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I encounter reliable failures for the following tests:&lt;/p&gt;

&lt;p&gt;testRestartAutomatically(org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest)  Time elapsed: 120.089 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError: expected:&amp;lt;RUNNING&amp;gt; but was:&amp;lt;RESTARTING&amp;gt;&lt;br/&gt;
	at org.junit.Assert.fail(Assert.java:88)&lt;br/&gt;
	at org.junit.Assert.failNotEquals(Assert.java:743)&lt;br/&gt;
	at org.junit.Assert.assertEquals(Assert.java:118)&lt;br/&gt;
	at org.junit.Assert.assertEquals(Assert.java:144)&lt;br/&gt;
	at org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest.restartAfterFailure(ExecutionGraphRestartTest.java:680)&lt;br/&gt;
	at org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest.testRestartAutomatically(ExecutionGraphRestartTest.java:155)&lt;/p&gt;

&lt;p&gt;taskShouldNotFailWhenFailureRateLimitWasNotExceeded(org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest)  Time elapsed: 2.055 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError: expected:&amp;lt;RUNNING&amp;gt; but was:&amp;lt;RESTARTING&amp;gt;&lt;br/&gt;
	at org.junit.Assert.fail(Assert.java:88)&lt;br/&gt;
	at org.junit.Assert.failNotEquals(Assert.java:743)&lt;br/&gt;
	at org.junit.Assert.assertEquals(Assert.java:118)&lt;br/&gt;
	at org.junit.Assert.assertEquals(Assert.java:144)&lt;br/&gt;
	at org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest.restartAfterFailure(ExecutionGraphRestartTest.java:680)&lt;br/&gt;
	at org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest.taskShouldNotFailWhenFailureRateLimitWasNotExceeded(ExecutionGraphRestartTest.java:180)&lt;/p&gt;

&lt;p&gt;testFailingExecutionAfterRestart(org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest)  Time elapsed: 120.079 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError: expected:&amp;lt;RUNNING&amp;gt; but was:&amp;lt;RESTARTING&amp;gt;&lt;br/&gt;
	at org.junit.Assert.fail(Assert.java:88)&lt;br/&gt;
	at org.junit.Assert.failNotEquals(Assert.java:743)&lt;br/&gt;
	at org.junit.Assert.assertEquals(Assert.java:118)&lt;br/&gt;
	at org.junit.Assert.assertEquals(Assert.java:144)&lt;br/&gt;
	at org.apache.flink.runtime.executiongraph.ExecutionGraphRestartTest.testFailingExecutionAfterRestart(ExecutionGraphRestartTest.java:397)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04&lt;br/&gt;
W10&lt;/p&gt;</environment>
        <key id="12993512">FLINK-4283</key>
            <summary>ExecutionGraphRestartTest fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="AlexanderShoshin">Alexander Shoshin</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 29 Jul 2016 11:28:03 +0000</created>
                <updated>Wed, 2 Oct 2019 17:47:46 +0000</updated>
                            <resolved>Wed, 26 Oct 2016 22:47:37 +0000</resolved>
                                    <version>1.1.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15399484" author="stephanewen" created="Fri, 29 Jul 2016 15:17:43 +0000"  >&lt;p&gt;To the attention of the distributed coordination shepherd (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="15402332" author="till.rohrmann" created="Mon, 1 Aug 2016 16:17:18 +0000"  >&lt;p&gt;I tried to reproduce this issue locally but I was not successful. Could you maybe attach the logs for these test cases with log level DEBUG to the issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;. Maybe this helps to figure out the problem you&apos;re encountering.&lt;/p&gt;</comment>
                            <comment id="15568819" author="stephanewen" created="Wed, 12 Oct 2016 14:04:59 +0000"  >&lt;p&gt;Is this issue still relevant, or has this instability been resolved?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AlexanderShoshin&quot; class=&quot;user-hover&quot; rel=&quot;AlexanderShoshin&quot;&gt;AlexanderShoshin&lt;/a&gt; what is your approach to fix this?&lt;/p&gt;</comment>
                            <comment id="15568940" author="alexandershoshin" created="Wed, 12 Oct 2016 14:49:54 +0000"  >&lt;p&gt;It is still relevant. I have just strated researching it.&lt;br/&gt;
These tests finishs successfully when run separately but fails when run together with other tests from the same class.&lt;br/&gt;
I will write when I find a cause.&lt;/p&gt;</comment>
                            <comment id="15581727" author="alexandershoshin" created="Mon, 17 Oct 2016 09:42:26 +0000"  >&lt;p&gt;I found out that these tests will fail if you run them on less than 3 core CPU machine.&lt;br/&gt;
ExecutionContext.global which is used to restart execution graph in ExecutionGraphRestartTest.java sets the pool threads number to the amount of available processors by default.&lt;br/&gt;
There are 3 tests in the class that will lock thread from the pool by calling &apos;sleep(Long.MAX_VALUE)&apos; while asynchronous graph restart.&lt;br/&gt;
So no one else can use ExecutionContext to restart execution graph while all available threads are sleeping. Thats why some tests fails.&lt;/p&gt;

&lt;p&gt;My approach is to set small restart delays that will be enough to finish tests successfully:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/compare/master...AlexanderShoshin:FLINK-4283%231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/compare/master...AlexanderShoshin:FLINK-4283%231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But if these &apos;infinite&apos; delays have some reason to be in code (though i don&apos;t see any) we can use VM attributes to increase the default pool threads number:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/compare/master...AlexanderShoshin:FLINK-4283%232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/compare/master...AlexanderShoshin:FLINK-4283%232&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15581770" author="till.rohrmann" created="Mon, 17 Oct 2016 09:58:42 +0000"  >&lt;p&gt;Maybe we could also replace the &lt;tt&gt;ExecutionContext.global&lt;/tt&gt; by a dedicated &lt;tt&gt;ExecutionContext&lt;/tt&gt;. Then we could control how many threads there are available. &lt;/p&gt;

&lt;p&gt;Maybe we could also add a testing &lt;tt&gt;RestartStrategy&lt;/tt&gt; which will simply not call the &lt;tt&gt;ExecutionGraph.restart&lt;/tt&gt; method. Then we wouldn&apos;t block the threads.&lt;/p&gt;</comment>
                            <comment id="15582023" author="stephanewen" created="Mon, 17 Oct 2016 11:57:03 +0000"  >&lt;p&gt;There seems to be something wrong if this blocks threads such that a minimum number of threads is needed to complete the test.&lt;br/&gt;
Shouldn&apos;t we address rather that?&lt;/p&gt;</comment>
                            <comment id="15582116" author="till.rohrmann" created="Mon, 17 Oct 2016 12:33:51 +0000"  >&lt;p&gt;I think we can do this by not using the &lt;tt&gt;FixedDelayRestartStrategy&lt;/tt&gt; with a delay of &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15582125" author="alexandershoshin" created="Mon, 17 Oct 2016 12:36:43 +0000"  >&lt;p&gt;I agree that these tests shouldn&apos;t depends on available threads number.&lt;br/&gt;
Adding a testing &lt;em&gt;RestartStrategy&lt;/em&gt; to test casses that will emulate infinite restart delay by doing nothing when &lt;em&gt;restart(...)&lt;/em&gt; method called sounds good.&lt;br/&gt;
Should I do this way?&lt;/p&gt;</comment>
                            <comment id="15585134" author="alexandershoshin" created="Tue, 18 Oct 2016 10:36:55 +0000"  >&lt;p&gt;It will look like this:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/compare/master...AlexanderShoshin:FLINK-4283_infinite_restart_strategy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/compare/master...AlexanderShoshin:FLINK-4283_infinite_restart_strategy&lt;/a&gt;&lt;br/&gt;
I replaced all &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; delay strategies with new InfiniteDelayRestartStrategy. They will not use new threads at all.&lt;/p&gt;</comment>
                            <comment id="15588998" author="githubbot" created="Wed, 19 Oct 2016 15:03:09 +0000"  >&lt;p&gt;GitHub user AlexanderShoshin opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2661&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4283&quot; title=&quot;ExecutionGraphRestartTest fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4283&quot;&gt;&lt;del&gt;FLINK-4283&lt;/del&gt;&lt;/a&gt; ExecutionGraphRestartTest fails&lt;/p&gt;

&lt;p&gt;    Tests were falling by timeout on less than 3 core CPU machines. There were several graph &lt;b&gt;RestartStrategies&lt;/b&gt; that blocked threads from the &lt;b&gt;ExecutionContext&lt;/b&gt; thread pool by calling &apos;&lt;b&gt;sleep(Long.MAX_VALUE)&lt;/b&gt;&apos; while asynchronous graph restarting. This was a cause for some tests to wait for free threads and to terminate by timeout.&lt;/p&gt;

&lt;p&gt;    I replaced these &lt;b&gt;RestartStrategies&lt;/b&gt; by a new testing class (&lt;b&gt;InfiniteDelayRestartStrategy&lt;/b&gt;) that has the same functionality - it promises to restart execution graph after a very long delay. But it doesn&apos;t use new threads from the thread pool. So it can&apos;t block other tests execution.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/AlexanderShoshin/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/AlexanderShoshin/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4283&quot; title=&quot;ExecutionGraphRestartTest fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4283&quot;&gt;&lt;del&gt;FLINK-4283&lt;/del&gt;&lt;/a&gt;_infinite_restart_strategy&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2661.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2661.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2661&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 92fcba525cec6330ddd14643edb675e27afcbdcc&lt;br/&gt;
Author: Alexander Shoshin &amp;lt;alexander_shoshin@epam.com&amp;gt;&lt;br/&gt;
Date:   2016-10-18T10:21:51Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4283&quot; title=&quot;ExecutionGraphRestartTest fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4283&quot;&gt;&lt;del&gt;FLINK-4283&lt;/del&gt;&lt;/a&gt; Use new InfiniteDelayRestartStrategy instead of FixedDelayRestartStrategy to avoid blocking threads&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15608632" author="githubbot" created="Wed, 26 Oct 2016 14:34:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2661&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Changes look good to me &#128077;  Thanks for your contribution @AlexanderShoshin &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    The failing tests are unrelated. Will merge this PR with the next batch.&lt;/p&gt;</comment>
                            <comment id="15609924" author="till.rohrmann" created="Wed, 26 Oct 2016 22:47:37 +0000"  >&lt;p&gt;Fixed via b5938b052dfd1b4e9450c430446062852bca8850&lt;/p&gt;</comment>
                            <comment id="15609926" author="githubbot" created="Wed, 26 Oct 2016 22:47:53 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2661&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31o67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>