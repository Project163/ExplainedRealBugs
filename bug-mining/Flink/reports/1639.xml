<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6293] Flakey JobManagerITCase</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6293</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Quite seldomly, &lt;tt&gt;JobManagerITCase&lt;/tt&gt; seems to hang, e.g. see &lt;a href=&quot;https://api.travis-ci.org/jobs/220888193/log.txt?deansi=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/jobs/220888193/log.txt?deansi=true&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;The maven watchdog kills the build due to not output being produced within 300s and &lt;tt&gt;JobManagerITCase&lt;/tt&gt; seems to hang in line 772, i.e.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;JobManagerITCase lines 770-772&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// Trigger savepoint &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; non-existing job
&lt;/span&gt;jobManager.tell(TriggerSavepoint(jobId, Option.apply(&lt;span class=&quot;code-quote&quot;&gt;&quot;any&quot;&lt;/span&gt;)), testActor)
val response = expectMsgType[TriggerSavepointFailure](deadline.timeLeft)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although the (downloaded) logs do not quite allow a precise mapping to this test case, it looks as if the following block may be related:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;09:34:47,684 INFO  org.apache.flink.runtime.minicluster.FlinkMiniCluster         - Akka ask timeout set to 100s
09:34:47,777 INFO  org.apache.flink.runtime.minicluster.FlinkMiniCluster         - Disabled queryable state server
09:34:47,777 INFO  org.apache.flink.runtime.minicluster.FlinkMiniCluster         - Starting FlinkMiniCluster.
09:34:47,809 INFO  akka.event.slf4j.Slf4jLogger                                  - Slf4jLogger started
09:34:47,837 INFO  org.apache.flink.runtime.blob.BlobServer                      - Created BLOB server storage directory /tmp/blobStore-eab23d04-ea18-4dc5-b1df-fcf9fc295062
09:34:47,838 WARN  org.apache.flink.runtime.net.SSLUtils                         - Not a SSL socket, will skip setting tls version and cipher suites.
09:34:47,839 INFO  org.apache.flink.runtime.blob.BlobServer                      - Started BLOB server at 0.0.0.0:36745 - max concurrent requests: 50 - max backlog: 1000
09:34:47,840 INFO  org.apache.flink.runtime.metrics.MetricRegistry               - No metrics reporter configured, no metrics will be exposed/reported.
09:34:47,850 INFO  org.apache.flink.runtime.testingUtils.TestingMemoryArchivist  - Started memory archivist akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/archive_1
&lt;/span&gt;09:34:47,860 INFO  org.apache.flink.runtime.testutils.TestingResourceManager     - Trying to associate with JobManager leader akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/jobmanager_1
&lt;/span&gt;09:34:47,861 INFO  org.apache.flink.runtime.testingUtils.TestingJobManager       - Starting JobManager at akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/jobmanager_1.
&lt;/span&gt;09:34:47,862 WARN  org.apache.flink.runtime.testingUtils.TestingJobManager       - Discard message LeaderSessionMessage(00000000-0000-0000-0000-000000000000,TriggerSavepoint(6e813070338a23b0ff571646bca56521,Some(any))) because there is currently no valid leader id known.
09:34:47,862 INFO  org.apache.flink.runtime.testingUtils.TestingJobManager       - JobManager akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/jobmanager_1 was granted leadership with leader session ID Some(00000000-0000-0000-0000-000000000000).
&lt;/span&gt;09:34:47,867 INFO  org.apache.flink.runtime.testutils.TestingResourceManager     - Resource Manager associating with leading JobManager Actor[akka:&lt;span class=&quot;code-comment&quot;&gt;//flink/user/jobmanager_1#-652927556] - leader session 00000000-0000-0000-0000-000000000000&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If so, then this may be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6287&quot; title=&quot;Flakey JobManagerRegistrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6287&quot;&gt;&lt;del&gt;FLINK-6287&lt;/del&gt;&lt;/a&gt; and may possibly even be a duplicate.&lt;/p&gt;

&lt;p&gt;What is strange though is that the timeout for the expected message to arrive is no more than 2m and thus the test should properly fail within 300s.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13063155">FLINK-6293</key>
            <summary>Flakey JobManagerITCase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 11 Apr 2017 10:17:05 +0000</created>
                <updated>Thu, 28 Feb 2019 14:01:09 +0000</updated>
                            <resolved>Fri, 28 Apr 2017 13:27:04 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15964138" author="nicok" created="Tue, 11 Apr 2017 10:20:08 +0000"  >&lt;p&gt;Same here (with only the &lt;tt&gt;transfer.sh&lt;/tt&gt; upload changed compared to master)&lt;br/&gt;
&lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/220888197/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/220888197/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15976323" author="stephanewen" created="Thu, 20 Apr 2017 08:50:21 +0000"  >&lt;p&gt;Another failed instance: &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/223677152/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/223677152/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15985432" author="stephanewen" created="Wed, 26 Apr 2017 19:33:12 +0000"  >&lt;p&gt;Hitting this frequently on local builds as well:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Tests run: 21, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 1,220.166 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.runtime.jobmanager.JobManagerITCase
The JobManager actor must handle trigger savepoint response &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; non-existing job(org.apache.flink.runtime.jobmanager.JobManagerITCase)  Time elapsed: 1,199.316 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: assertion failed: timeout (1199213200030 nanoseconds) during expectMsgClass waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.flink.runtime.messages.JobManagerMessages$TriggerSavepointFailure
	at scala.Predef$.&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(Predef.scala:179)
	at akka.testkit.TestKitBase$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;expectMsgClass_internal(TestKit.scala:423)
	at akka.testkit.TestKitBase$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;expectMsgType(TestKit.scala:405)
	at akka.testkit.TestKit.expectMsgType(TestKit.scala:718)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase$$anonfun$1$$anonfun$apply$mcV$sp$34$$anonfun$apply$mcV$sp$35.apply$mcV$sp(JobManagerITCase.scala:772)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase$$anonfun$1$$anonfun$apply$mcV$sp$34$$anonfun$apply$mcV$sp$35.apply(JobManagerITCase.scala:764)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase$$anonfun$1$$anonfun$apply$mcV$sp$34$$anonfun$apply$mcV$sp$35.apply(JobManagerITCase.scala:764)
	at akka.testkit.TestKitBase$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;within(TestKit.scala:296)
	at akka.testkit.TestKit.within(TestKit.scala:718)
	at akka.testkit.TestKitBase$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;within(TestKit.scala:310)
	at akka.testkit.TestKit.within(TestKit.scala:718)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase$$anonfun$1$$anonfun$apply$mcV$sp$34.apply$mcV$sp(JobManagerITCase.scala:764)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase$$anonfun$1$$anonfun$apply$mcV$sp$34.apply(JobManagerITCase.scala:758)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase$$anonfun$1$$anonfun$apply$mcV$sp$34.apply(JobManagerITCase.scala:758)
	at org.scalatest.Transformer$$anonfun$apply$1.apply$mcV$sp(Transformer.scala:22)
	at org.scalatest.OutcomeOf$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;outcomeOf(OutcomeOf.scala:85)
	at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
	at org.scalatest.Transformer.apply(Transformer.scala:22)
	at org.scalatest.Transformer.apply(Transformer.scala:20)
	at org.scalatest.WordSpecLike$$anon$1.apply(WordSpecLike.scala:953)
	at org.scalatest.Suite$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;withFixture(Suite.scala:1122)
	at org.apache.flink.runtime.jobmanager.JobManagerITCase.withFixture(JobManagerITCase.scala:50)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15988390" author="till.rohrmann" created="Fri, 28 Apr 2017 08:02:38 +0000"  >&lt;p&gt;I think the problem is that in the &quot;handle trigger savepoint response for non-existing job&quot; test, we retrieve the leader gateway but do not wait until the JobManager has gained leadership. This is possible when using the standalone leader retrieval service. As a consequence, we can end up sending the &lt;tt&gt;TriggerSavepoint&lt;/tt&gt; savepoint message too early (before the JobManager has gained leadership and, thus, dropping the &lt;tt&gt;TriggerSavepoint&lt;/tt&gt; message).&lt;/p&gt;</comment>
                            <comment id="15988394" author="githubbot" created="Fri, 28 Apr 2017 08:07:34 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3796&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6293&quot; title=&quot;Flakey JobManagerITCase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6293&quot;&gt;&lt;del&gt;FLINK-6293&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden JobManagerITCase&lt;/p&gt;

&lt;p&gt;    One of the unit tests in JobManagerITCase starts a MiniCluster and sends a&lt;br/&gt;
    LeaderSessionMessage to the JobManager without waiting until the JobManager&lt;br/&gt;
    has gained leadership. This can lead to a dropped TriggerSavepoint message&lt;br/&gt;
    which will cause the test to deadlock.&lt;/p&gt;

&lt;p&gt;    This PR fixes the problem by explicitly waiting for the JobManager to become&lt;br/&gt;
    the leader.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixJobManagerITCase&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3796.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3796.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3796&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5abf141c489154f1fc5650a27b0eb19dbaa29e75&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-04-28T08:04:57Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6293&quot; title=&quot;Flakey JobManagerITCase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6293&quot;&gt;&lt;del&gt;FLINK-6293&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden JobManagerITCase&lt;/p&gt;

&lt;p&gt;    One of the unit tests in JobManagerITCase starts a MiniCluster and sends a&lt;br/&gt;
    LeaderSessionMessage to the JobManager without waiting until the JobManager&lt;br/&gt;
    has gained leadership. This can lead to a dropped TriggerSavepoint message&lt;br/&gt;
    which will cause the test to deadlock.&lt;/p&gt;

&lt;p&gt;    This PR fixes the problem by explicitly waiting for the JobManager to become&lt;br/&gt;
    the leader.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15988656" author="githubbot" created="Fri, 28 Apr 2017 11:09:24 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3796&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good fix. +1 to merge.&lt;/p&gt;</comment>
                            <comment id="15988790" author="githubbot" created="Fri, 28 Apr 2017 13:25:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3796&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @uce. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="15988796" author="till.rohrmann" created="Fri, 28 Apr 2017 13:27:04 +0000"  >&lt;p&gt;Fixed via f3da8f69e99be49068ab4ea3abc5e1c4eba7bf32&lt;/p&gt;</comment>
                            <comment id="15988798" author="githubbot" created="Fri, 28 Apr 2017 13:27:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3796&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dha7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>