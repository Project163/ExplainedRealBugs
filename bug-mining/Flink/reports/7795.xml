<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-37222] Table planner exception when sql client submit job</title>
                <link>https://issues.apache.org/jira/browse/FLINK-37222</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When testing &lt;a href=&quot;https://github.com/nexmark/nexmark&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Nexmark&lt;/a&gt; on release-2.0 branch, a table planner related exception thrown by the sql client:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Omit some stacktraces before ....
&lt;/span&gt;
Caused by: org.apache.flink.table.gateway.service.utils.SqlExecutionException: Failed to execute the operation d3516bc9-44c1-428e-ac10-2fb0ddd0c825.
	at org.apache.flink.table.gateway.service.operation.OperationManager$Operation.processThrowable(OperationManager.java:415)
	at org.apache.flink.table.gateway.service.operation.OperationManager$Operation.lambda$run$0(OperationManager.java:268)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	... 1 more
Caused by: java.lang.AssertionError: Sql optimization: Assertion error: Relational expression rel#714:LogicalProject.NONE.any.None: 0.[NONE].[NONE](input=LogicalAggregate#712,exprs=[$2, $1]) belongs to a different planner than is currently being used.
	at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:79)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.$anonfun$optimize$1(FlinkChainedProgram.scala:59)
	at scala.collection.TraversableOnce$folder$1.apply(TraversableOnce.scala:196)
	at scala.collection.TraversableOnce$folder$1.apply(TraversableOnce.scala:194)
	at scala.collection.Iterator.foreach(Iterator.scala:943)
	at scala.collection.Iterator.foreach$(Iterator.scala:943)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
	at scala.collection.IterableLike.foreach(IterableLike.scala:74)
	at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
	at scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:199)
	at scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:192)
	at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:108)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.optimize(FlinkChainedProgram.scala:55)
	at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.optimizeTree(StreamCommonSubGraphBasedOptimizer.scala:196)
	at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.optimizeSinkBlocks(StreamCommonSubGraphBasedOptimizer.scala:83)
	at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.doOptimize(StreamCommonSubGraphBasedOptimizer.scala:118)
	at org.apache.flink.table.planner.plan.optimize.CommonSubGraphBasedOptimizer.optimize(CommonSubGraphBasedOptimizer.scala:87)
	at org.apache.flink.table.planner.delegation.PlannerBase.optimize(PlannerBase.scala:390)
	at org.apache.flink.table.planner.delegation.PlannerBase.translate(PlannerBase.scala:183)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.translate(TableEnvironmentImpl.java:1352)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeInternal(TableEnvironmentImpl.java:930)
	at org.apache.flink.table.gateway.service.operation.OperationExecutor.callModifyOperations(OperationExecutor.java:662)
	at org.apache.flink.table.gateway.service.operation.OperationExecutor.executeOperation(OperationExecutor.java:500)
	at org.apache.flink.table.gateway.service.operation.OperationExecutor.executeStatement(OperationExecutor.java:262)
	at org.apache.flink.table.gateway.service.operation.OperationExecutor.executeStatement(OperationExecutor.java:217)
	at org.apache.flink.table.gateway.service.SqlGatewayServiceImpl.lambda$executeStatement$1(SqlGatewayServiceImpl.java:221)
	at org.apache.flink.table.gateway.service.operation.OperationManager.lambda$submitOperation$1(OperationManager.java:120)
	at org.apache.flink.table.gateway.service.operation.OperationManager$Operation.lambda$run$0(OperationManager.java:259)
	... 7 more
Caused by: java.lang.AssertionError: Relational expression rel#714:LogicalProject.NONE.any.None: 0.[NONE].[NONE](input=LogicalAggregate#712,exprs=[$2, $1]) belongs to a different planner than is currently being used.
	at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1248)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:598)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:613)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:95)
	at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:273)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1271)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:598)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:613)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:95)
	at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:273)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1271)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:598)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:613)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:95)
	at org.apache.calcite.rel.AbstractRelNode.onRegister(AbstractRelNode.java:273)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.registerImpl(VolcanoPlanner.java:1271)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.register(VolcanoPlanner.java:598)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.ensureRegistered(VolcanoPlanner.java:613)
	at org.apache.calcite.plan.volcano.VolcanoPlanner.changeTraits(VolcanoPlanner.java:498)
	at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:314)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:62)
	... 35 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve tested on many commits and identified the commit &lt;a href=&quot;https://github.com/apache/flink/pull/25952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/25952&lt;/a&gt; may cause this. By reverting this commit on release-2.0, the problem solved.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13606188">FLINK-37222</key>
            <summary>Table planner exception when sql client submit job</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="zakelly">Zakelly Lan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 24 Jan 2025 17:02:29 +0000</created>
                <updated>Tue, 5 Aug 2025 07:33:09 +0000</updated>
                            <resolved>Mon, 24 Mar 2025 01:23:22 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.20.1</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17916796" author="zakelly" created="Fri, 24 Jan 2025 17:06:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; Would you please take a look?&lt;/p&gt;</comment>
                            <comment id="17921349" author="dawidwys" created="Mon, 27 Jan 2025 11:51:52 +0000"  >&lt;p&gt;Would you be able to provide a reproducer runnable in Flink repo? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17921352" author="dawidwys" created="Mon, 27 Jan 2025 12:12:01 +0000"  >&lt;p&gt;It looks like the SQL gateway session manager recreates TableEnvironment(s) and planners for the same session.&lt;/p&gt;</comment>
                            <comment id="17922438" author="zakelly" created="Thu, 30 Jan 2025 16:42:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; I wrote a simple test reproducing this issue, please check &lt;a href=&quot;https://github.com/apache/flink/pull/26093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/26093&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17924034" author="zakelly" created="Wed, 5 Feb 2025 11:41:43 +0000"  >&lt;p&gt;Master:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ac4f5952d5dd47e09644681b8f0fbf2b46a76509&lt;/li&gt;
	&lt;li&gt;b88a6cac675a6acf6e2e8a62d225f5db2057f709&lt;br/&gt;
2.0:&lt;/li&gt;
	&lt;li&gt;12493ead11f59697cda1baf0507b0ca8190f851a&lt;/li&gt;
	&lt;li&gt;0714e670e638e4e3f71086944550b6f4fc51b04e&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17936353" author="fsk119" created="Tue, 18 Mar 2025 03:20:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I still have concern about this fix. In the real world, no one can promise the creator of the view use the same table enviroment as the user of the view.&lt;/p&gt;

&lt;p&gt;Currenlty this fix only works for sql-client or sql-gateway, how about external system, e.g. Kyuubi or Zeppline to process this failures?&lt;/p&gt;</comment>
                            <comment id="17936361" author="fsk119" created="Tue, 18 Mar 2025 04:05:59 +0000"  >&lt;p&gt;I modify the test&#160;SqlClientTest#testExecuteNexmark and use the temporary view in the test, we still get the same error.&lt;/p&gt;</comment>
                            <comment id="17936410" author="fsk119" created="Tue, 18 Mar 2025 08:22:56 +0000"  >&lt;p&gt;Based on my analysis of related issues, the core problem appears to be that the &lt;tt&gt;CatalogView&lt;/tt&gt; instance returned by the Catalog loses its temporal attributes when accessed through &lt;tt&gt;getUnresolvedSchema()&lt;/tt&gt;, necessitating redundant SQL re-parsing by CatalogManager to obtain accurate type information for subsequent operations.&lt;/p&gt;

&lt;p&gt;To address this, our investigation suggests that converting CatalogView to QueryOperationCatalogView may be unnecessary and potentially problematic when operations span different TableEnvironment instances. Through code analysis, we propose implementing a ResolvedCatalogView during the SqlNode-to-Operation conversion phase. This approach would prevent CatalogManager from attempting view object conversion to QueryOperationCatalogView, thereby maintaining temporal attribute integrity throughout the process.&lt;/p&gt;</comment>
                            <comment id="17936411" author="dawidwys" created="Tue, 18 Mar 2025 08:30:41 +0000"  >&lt;p&gt;Table attributes are just the most common problem with not resolving the view. According to SQL standard views are resolved at query time and that is what the work is about. Resolving the view at query time. Apart from time attributes, e.g. function return types might change and need to be taken into account.&lt;/p&gt;

&lt;p&gt;Reusing views accross TableEnvironments is not a contract that TableEnvironment provides and might be problematic as we see here. My suggestion would be to either fix that contract in SQL client or prepare yet another workaround there for temporary views (if it is really a problem, I have not analysed it yet).&lt;/p&gt;</comment>
                            <comment id="17936435" author="weijie guo" created="Tue, 18 Mar 2025 09:52:55 +0000"  >&lt;p&gt;Moved to 2.1.0 as 2.0.0 is in finalizing stage.&lt;/p&gt;</comment>
                            <comment id="17936482" author="fsk119" created="Tue, 18 Mar 2025 12:55:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; I agree that we should resolve the view&apos;s query when creating or getting the view. Do you mind to take a look at my fix to check whether it can solve the problems?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;BTW, I think we should revert &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-37098&quot; title=&quot;Can not select time attribute from a view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-37098&quot;&gt;&lt;del&gt;FLINK-37098&lt;/del&gt;&lt;/a&gt;, because it changes a lot of plan. WDYT?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;https://github.com/apache/flink/pull/26314&lt;/p&gt;</comment>
                            <comment id="17936483" author="fsk119" created="Tue, 18 Mar 2025 13:00:45 +0000"  >&lt;p&gt;&amp;gt; Reusing views accross TableEnvironments is not a contract that TableEnvironment provides and might be problematic as we see here.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It&apos;s very hard to say. Could you tell us what is the contract about usage of the TableEnvironment? Aa far as I know, the only limitation is table environment is not thread-safe. Flink is used by many external systems, I think it&apos;s better we don&apos;t add more restriction about this.&#160;&lt;/p&gt;</comment>
                            <comment id="17936990" author="fsk119" created="Thu, 20 Mar 2025 02:47:06 +0000"  >&lt;p&gt;Merged into release-1.20 at:&lt;/p&gt;

&lt;p&gt;7c9fed55cc15576d87178c9e88687ed0f7ae7885&lt;/p&gt;

&lt;p&gt;87bb279ef110bc9e03e83d1c3e26918c92d98cfb&lt;/p&gt;

&lt;p&gt;5735484f5ef7fa0dcb792c381543ee79433b7f27&lt;/p&gt;

&lt;p&gt;Merged into release-2.0 at:&lt;/p&gt;

&lt;p&gt;ec58ec32ecb4b37a508d63282781b9c0c2573750&lt;/p&gt;

&lt;p&gt;Merged into master at:&lt;/p&gt;

&lt;p&gt;df058589affe786f5dcbf253cd3769502c28b207&lt;/p&gt;</comment>
                            <comment id="18010858" author="JIRAUSER280892" created="Wed, 30 Jul 2025 08:56:03 +0000"  >&lt;p&gt;&amp;gt;&#160;Merged into release-1.20 at:&lt;br/&gt;
&amp;gt; 7c9fed55cc15576d87178c9e88687ed0f7ae7885&lt;br/&gt;
&amp;gt; 87bb279ef110bc9e03e83d1c3e26918c92d98cfb&lt;br/&gt;
&amp;gt; 5735484f5ef7fa0dcb792c381543ee79433b7f27&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; I don&apos;t see these commits in the release-1.20 branch. Was it pushed then removed? &lt;br/&gt;
For the sake of 1.20.x users, could it be fixed in a 1.20.x release?&lt;/p&gt;</comment>
                            <comment id="18012031" author="fsk119" created="Tue, 5 Aug 2025 05:43:22 +0000"  >&lt;p&gt;I think I record the wrong commit id.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Merged into release-1.20 at:&#160;&lt;/p&gt;

&lt;p&gt;73c556c756897ae7825dd76b6adfaba759e16a7f&lt;/p&gt;

&lt;p&gt;e0794b42c2de89119262f43c2e89cb45981c8136&lt;/p&gt;

&lt;p&gt;5206789109f9226f384b214b12540e85475508db&lt;/p&gt;</comment>
                            <comment id="18012052" author="JIRAUSER280892" created="Tue, 5 Aug 2025 07:33:09 +0000"  >&lt;p&gt;Ok, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13604516">FLINK-37098</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13074239" name="flink-root-sql-client-master-1-1.c-76646bdbb8bdab89.log" size="94373" author="zakelly" created="Fri, 24 Jan 2025 17:04:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ttkw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>