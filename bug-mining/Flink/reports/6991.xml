<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31139] not upload empty state changelog file</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31139</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h1&gt;

&lt;p&gt;&lt;b&gt;&lt;em&gt;BatchingStateChangeUploadScheduler&lt;/em&gt;&lt;/b&gt; will upload many empty changelog files (file size == 1&#160; and only contains compressed flag).&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13055633/13055633_image-2023-02-20-19-51-34-397.png&quot; height=&quot;188&quot; width=&quot;1062&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;These files are not referenced by any checkpoints, are not cleaned up, and become more numerous as the job runs. Taking our big job as an example, 2292 such files were generated within 7 hours. It only takes about 4 months and the number of files in the changelog directory will exceed a million.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Problemcauses&quot;&gt;&lt;/a&gt;Problem causes&lt;/h1&gt;

&lt;p&gt;This problem is caused by &lt;b&gt;&lt;em&gt;BatchingStateChangeUploadScheduler#drainAndSave&lt;/em&gt;&lt;/b&gt; not checking whether the task collection is empty. The data in the scheduled queue may have been uploaded when the &lt;em&gt;&lt;b&gt;BatchingStateChangeUploadScheduler#drainAndSave&lt;/b&gt;&lt;/em&gt; method is executed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So we should check whether the task collection is empty in &lt;b&gt;&lt;em&gt;BatchingStateChangeUploadScheduler#drainAndSave&lt;/em&gt;&lt;/b&gt; . WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13525430">FLINK-31139</key>
            <summary>not upload empty state changelog file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Feifan Wang">Feifan Wang</assignee>
                                    <reporter username="Feifan Wang">Feifan Wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>stale-assigned</label>
                    </labels>
                <created>Mon, 20 Feb 2023 12:18:33 +0000</created>
                <updated>Tue, 15 Aug 2023 07:53:06 +0000</updated>
                            <resolved>Tue, 15 Aug 2023 07:53:06 +0000</resolved>
                                    <version>1.15.3</version>
                    <version>1.16.1</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17703348" author="roman_khachatryan" created="Tue, 21 Mar 2023 19:45:42 +0000"  >&lt;p&gt;Merged into master as fb37e6a87d92912897c6a8c4b182048e13686dee.&lt;/p&gt;</comment>
                            <comment id="17703441" author="feifan wang" created="Wed, 22 Mar 2023 02:07:54 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , thanks for your reply, and should we merge this fix to release-1.16 &amp;amp; release-1.17 ?&lt;/p&gt;</comment>
                            <comment id="17703787" author="roman_khachatryan" created="Wed, 22 Mar 2023 20:33:59 +0000"  >&lt;p&gt;Yes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt; , I think so.&lt;/p&gt;

&lt;p&gt;I&apos;ve pushed to backport-branches to make sure the change doesn&apos;t break anything:&lt;/p&gt;

&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/khachatryanroman/flink/_build/results?buildId=1681&amp;amp;view=results&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/khachatryanroman/flink/_build/results?buildId=1681&amp;amp;view=results&lt;/a&gt; (PASS)&lt;/p&gt;

&lt;p&gt;1.17: &lt;a href=&quot;https://dev.azure.com/khachatryanroman/flink/_build/results?buildId=1680&amp;amp;view=results&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/khachatryanroman/flink/_build/results?buildId=1680&amp;amp;view=results&lt;/a&gt; (FAIL)&lt;/p&gt;

&lt;p&gt;I&apos;m going to re-run failed stages for 1.17 and merge if it passes.&lt;/p&gt;</comment>
                            <comment id="17717003" author="feifan wang" created="Thu, 27 Apr 2023 06:24:38 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , remember to re-run failed stages for 1.17.&lt;/p&gt;</comment>
                            <comment id="17753682" author="flink-jira-bot" created="Sun, 13 Aug 2023 10:35:00 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issue is assigned but has not received an update in 30 days, so it has been labeled &quot;stale-assigned&quot;.&lt;br/&gt;
If you are still working on the issue, please remove the label and add a comment updating the community on your progress.  If this issue is waiting on feedback, please consider this a reminder to the committer/reviewer. Flink is a very active project, and so we appreciate your patience.&lt;br/&gt;
If you are no longer working on the issue, please unassign yourself so someone else may work on it.&lt;/p&gt;</comment>
                            <comment id="17753725" author="feifan wang" created="Sun, 13 Aug 2023 11:37:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , is there any method to re-run &#160;failed stages for 1.17 ?&lt;/p&gt;</comment>
                            <comment id="17754128" author="roman_khachatryan" created="Mon, 14 Aug 2023 14:48:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt; thanks for the reminder, I have rebased the and force-pushed the changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/rkhachatryan/flink/tree/f31139-1.16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rkhachatryan/flink/tree/f31139-1.16&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/rkhachatryan/flink/tree/f31139-1.17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rkhachatryan/flink/tree/f31139-1.17&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(please feel free to open backport PRs if necessary).&lt;/p&gt;</comment>
                            <comment id="17754474" author="roman_khachatryan" created="Tue, 15 Aug 2023 07:52:38 +0000"  >&lt;p&gt;Merged into release-1.16 as 5157ac5921d406f577c83a4fe57b373d8ae0bf79, into release-1.17 as 8798fde04e4a28af8bee7f2641b4aa89f2e0995f.&lt;br/&gt;
Merged into master as fb37e6a87d92912897c6a8c4b182048e13686dee earlier&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13055633" name="image-2023-02-20-19-51-34-397.png" size="267919" author="Feifan Wang" created="Mon, 20 Feb 2023 11:51:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1g20o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>