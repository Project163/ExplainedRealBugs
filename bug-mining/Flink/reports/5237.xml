<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:55:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21980] ZooKeeperRunningJobsRegistry creates an empty znode</title>
                <link>https://issues.apache.org/jira/browse/FLINK-21980</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;ZooKeeperRunningJobsRegistry#writeEnumToZooKeeper calls&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.client.newNamespaceAwareEnsurePath(zkPath).ensure(client.getZookeeperClient());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This creates an empty znode in zookeeper.&#160; If the job manager is interrupted at this point the job manager cannot recover.&#160; When trying to restore jobs on a restarted job manager,&#160;ZooKeeperRunningJobsRegistry#getJobSchedulingStatus will throw an exception due to the empty znode.&#160;&lt;/p&gt;

&lt;p&gt;Behavior was verified in a test environment where the job manager was interrupted at that point in execution leaving ZK in the following state:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
zk: localhost:2181(CONNECTED) 2] ls /flink/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
[checkpoint-counter, checkpoints, jobgraphs, leader, leaderlatch, running_job_registry]
[zk: localhost:2181(CONNECTED) 3] ls /flink/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/running_job_registry 
[c982053dd0b9100967e6a9d89202f2a5]
[zk: localhost:2181(CONNECTED) 4] get /flink/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/running_job_registry/c982053dd0b9100967e6a9d89202f2a5 

[zk: localhost:2181(CONNECTED) 5] 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13367714">FLINK-21980</key>
            <summary>ZooKeeperRunningJobsRegistry creates an empty znode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rburnett">Ricky Burnett</assignee>
                                    <reporter username="rburnett">Ricky Burnett</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 25 Mar 2021 21:28:04 +0000</created>
                <updated>Fri, 28 May 2021 09:00:09 +0000</updated>
                            <resolved>Wed, 7 Apr 2021 17:00:58 +0000</resolved>
                                    <version>1.9.3</version>
                    <version>1.10.3</version>
                    <version>1.11.3</version>
                    <version>1.12.2</version>
                                    <fixVersion>1.11.4</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                    <fixVersion>1.12.3</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17309292" author="mxm" created="Fri, 26 Mar 2021 09:16:05 +0000"  >&lt;p&gt;Thanks for filing this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rburnett&quot; class=&quot;user-hover&quot; rel=&quot;rburnett&quot;&gt;rburnett&lt;/a&gt;! If raised the priority to Critical because this looks like a pretty serious bug in the HA code.&lt;/p&gt;</comment>
                            <comment id="17309512" author="rburnett" created="Fri, 26 Mar 2021 15:48:00 +0000"  >&lt;p&gt;I think the best solution would be to check if the node exists before setting.&#160; If it doesn&apos;t then &lt;del&gt;only ensure that&#160;runningJobPath&#160;exists and create the node with data.&lt;/del&gt; create with data using&#160;creatingParentContainersIfNeeded.&lt;/p&gt;

&lt;p&gt;Given the lifecycle of the node, it alternatively seems reasonable to treat an empty node as PENDING instead of an exception.&lt;/p&gt;</comment>
                            <comment id="17309604" author="till.rohrmann" created="Fri, 26 Mar 2021 17:42:14 +0000"  >&lt;p&gt;Sounds like a good idea &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rburnett&quot; class=&quot;user-hover&quot; rel=&quot;rburnett&quot;&gt;rburnett&lt;/a&gt;. We could also use &lt;tt&gt;client.createContainers&lt;/tt&gt;. Do you wanna take a stab at it?&lt;/p&gt;</comment>
                            <comment id="17309616" author="rburnett" created="Fri, 26 Mar 2021 18:03:56 +0000"  >&lt;p&gt;Sure, I&apos;ll put together a PR.&lt;/p&gt;</comment>
                            <comment id="17316495" author="till.rohrmann" created="Wed, 7 Apr 2021 17:00:58 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;master: c580c9b335c16003dd1ab39f7d334c2cc5b7edcd&lt;br/&gt;
1.12.3: a68101fa0d306bbc6a4d4887f3379ae27633e142&lt;br/&gt;
1.11.4: 2a89f8de2af25ff375a5b1e63a11f446af653d96&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13366926">FLINK-21928</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13219310">FLINK-11813</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p7q8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>