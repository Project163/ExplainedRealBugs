<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:56:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22535] Resource leak would happen if exception thrown during AbstractInvokable#restore of task life</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22535</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17012&quot; title=&quot;Expose stage of task initialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17012&quot;&gt;&lt;del&gt;FLINK-17012&lt;/del&gt;&lt;/a&gt; introduced new initialization phase such as &lt;tt&gt;AbstractInvokable.restore&lt;/tt&gt;, however, if &lt;a href=&quot;https://github.com/apache/flink/blob/79a521e08df550d96f97bb6915191d8496bb29ea/flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java#L754-L759&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;invokable.restore()&lt;/a&gt; throws exception out, no more &lt;tt&gt;StreamTask#cleanUpInvoke&lt;/tt&gt; would be called, leading to resource leak.&lt;/p&gt;

&lt;p&gt;We internally leveraged another way to use managed memory by registering specific operator identifier in memory manager, forgetting to call the stream task cleanup would let stream operator not be disposed and we have to face critical resource leak.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13375859">FLINK-22535</key>
            <summary>Resource leak would happen if exception thrown during AbstractInvokable#restore of task life</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="akalashnikov">Anton Kalashnikov</assignee>
                                    <reporter username="yunta">Yun Tang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 29 Apr 2021 14:49:32 +0000</created>
                <updated>Fri, 28 May 2021 11:08:02 +0000</updated>
                            <resolved>Mon, 3 May 2021 13:22:57 +0000</resolved>
                                    <version>1.13.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.1</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="17335645" author="gaoyunhaii" created="Thu, 29 Apr 2021 16:21:00 +0000"  >&lt;p&gt;Also another related possible issue is that if StreamTask#invoke throws exception, the &lt;em&gt;cleanUpInvoke&lt;/em&gt; might be called twice, but we do not has a flag to skip the second execution. Maybe we could also move cleanUpInvoke to finally.&lt;/p&gt;</comment>
                            <comment id="17335685" author="akalashnikov" created="Thu, 29 Apr 2021 17:08:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;thanks for the observation. But how is it possible to call cleanUpInvoke twice? As I see if the exception happens, only one cleanUpInvoke will be invoked which is in catch block and then the exception will be rethrown which allows avoiding the second invocation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;According to the original problem, it looks like we indeed should finish&#160;StreamTask#restore with&#160;&lt;em&gt;cleanUpInvoke.&lt;/em&gt; My fault. I will fix it.&lt;/p&gt;</comment>
                            <comment id="17335692" author="gaoyunhaii" created="Thu, 29 Apr 2021 17:18:21 +0000"  >&lt;p&gt;Hi&#160;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akalashnikov&quot; class=&quot;user-hover&quot; rel=&quot;akalashnikov&quot;&gt;akalashnikov&lt;/a&gt;, sorry I mixed the order of braces, you are right that the exception would be thrown at the last of the catch block. Sorry for the wrong information.&lt;/p&gt;</comment>
                            <comment id="17337088" author="gaoyunhaii" created="Fri, 30 Apr 2021 05:35:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akalashnikov&quot; class=&quot;user-hover&quot; rel=&quot;akalashnikov&quot;&gt;akalashnikov&lt;/a&gt;&#160;sorry I think if there is always the re-thrown, there should be still problems since that if the invoke() throws exception and enter the catch block, then the try block throws the second exception (like in the cancelTask() method), then cleanupInvoke() seems would not be called before re-thrown the exception.&lt;/p&gt;</comment>
                            <comment id="17338367" author="pnowojski" created="Mon, 3 May 2021 13:22:57 +0000"  >&lt;p&gt;Merged to master 5926c4ac22b^..5926c4ac22b&lt;br/&gt;
Merged to release-1.13 as ae37cde62b3^..ae37cde62b3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13296708">FLINK-17012</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ql8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>