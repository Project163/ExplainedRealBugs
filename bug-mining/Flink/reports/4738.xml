<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19909] Flink application in attach mode could not terminate when the only job is canceled</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19909</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, the Yarn and Kubernetes application in attach mode could not terminate the Flink cluster after the only job is canceled. Because we are throwing &lt;tt&gt;ApplicationExecutionException&lt;/tt&gt; in&#160;&lt;tt&gt;ApplicationDispatcherBootstrap#runApplicationEntryPoint&lt;/tt&gt;. However, we are only checking &lt;tt&gt;ApplicationFailureException&lt;/tt&gt; in &lt;tt&gt;runApplicationAndShutdownClusterAsync&lt;/tt&gt;. Then we will go to fatal error handler which make the jobmanager directly exits. And it&#160;has no chance to deregister itself to the cluster manager(Yarn/Kubernetes). That means the jobmanager will be relaunched by cluster manager again and again until it exhausts the retry attempts.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;, I am not sure is this an expected change? I think it could work in 1.11.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13338278">FLINK-19909</key>
            <summary>Flink application in attach mode could not terminate when the only job is canceled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkl0u">Kostas Kloudas</assignee>
                                    <reporter username="wangyang0918">Yang Wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 1 Nov 2020 07:45:22 +0000</created>
                <updated>Fri, 6 Nov 2020 09:25:48 +0000</updated>
                            <resolved>Fri, 6 Nov 2020 08:55:59 +0000</resolved>
                                    <version>1.11.3</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Deployment / Kubernetes</component>
                    <component>Deployment / YARN</component>
                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17224241" author="kkl0u" created="Sun, 1 Nov 2020 09:54:51 +0000"  >&lt;p&gt;Thanks for opening this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt;! I changed this after a comment on my PR (&lt;a href=&quot;https://github.com/apache/flink/pull/13699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/13699&lt;/a&gt;) after a comment during review. Before, in this case the error handler I was using was completing the shutdown future of the &lt;tt&gt;Dispatcher&lt;/tt&gt; exceptionally (see &lt;a href=&quot;https://github.com/apache/flink/pull/13699#discussion_r508494946&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/13699#discussion_r508494946&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;BTW if the job gets cancelled, shouldn&apos;t we go throw &lt;a href=&quot;https://github.com/kl0u/flink/blob/master/flink-clients/src/main/java/org/apache/flink/client/deployment/application/ApplicationDispatcherBootstrap.java#L280&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, which is expected to put the correct exception?&lt;/p&gt;</comment>
                            <comment id="17224244" author="fly_in_gis" created="Sun, 1 Nov 2020 10:17:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt; Thanks for your response. Hmm. Actually, I find this issue when I am testing K8s native HA. I have two questions here.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Why we are throwing&#160;&lt;tt&gt;ApplicationExecutionException&lt;/tt&gt;&#160;in&#160;&lt;tt&gt;ApplicationDispatcherBootstrap#runApplicationEntryPoint&lt;/tt&gt;, not &lt;tt&gt;ApplicationFailureException&lt;/tt&gt;? If we submit the Flink application with &lt;tt&gt;execution.attached: true&lt;/tt&gt;, and we cancel the job, then we still go into the fatal error handler. Because we only try to find the &lt;tt&gt;ApplicationFailureException&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Using the &lt;tt&gt;ClusterEntrypoint#onFatalError&lt;/tt&gt; is not reasonable, it will make us have no chance to deregister the Flink application.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17224253" author="kkl0u" created="Sun, 1 Nov 2020 12:57:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; We want different behaviour when we cancel a job (delete HA data) and when a job fails (restart). So even if we throw &lt;tt&gt;ApplicationFailureException&lt;/tt&gt; in the &lt;tt&gt;runApplicationEntryPoint&lt;/tt&gt;, in the case of cancellation it has to contain the &lt;tt&gt;Status&lt;/tt&gt; of the job as &lt;tt&gt;Cancelled&lt;/tt&gt; when the job gets cancelled. &lt;/p&gt;

&lt;p&gt;In your case, you see a &lt;tt&gt;JobCancellationException&lt;/tt&gt; being thrown in the &lt;tt&gt;runApplicationEntryPoint()&lt;/tt&gt; ?&lt;/p&gt;</comment>
                            <comment id="17224430" author="fly_in_gis" created="Mon, 2 Nov 2020 05:55:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;&#160;I know we need to have different behaviors for canceled job or failed. My point here is for &quot;detached&quot; and &quot;attached&quot; mode, we have different exception. I have uploaded a jobmanager log, which could show that even the job is canceled, we still go into the fatal error handle.&lt;/p&gt;

&lt;p&gt;In detached mode, it works quite well.&lt;/p&gt;</comment>
                            <comment id="17224486" author="kkl0u" created="Mon, 2 Nov 2020 08:21:47 +0000"  >&lt;p&gt;Thanks for the logs &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt;, I am having a look now.&lt;/p&gt;</comment>
                            <comment id="17224511" author="till.rohrmann" created="Mon, 2 Nov 2020 08:54:43 +0000"  >&lt;p&gt;I think the behaviour should not be different if the job is canceled or has failed terminally. In both cases, the HA data should be cleaned up and the cluster should shut down. Only if the system encounters a framework exception we should call the fatal error handler.&lt;/p&gt;</comment>
                            <comment id="17224523" author="kkl0u" created="Mon, 2 Nov 2020 09:14:54 +0000"  >&lt;p&gt;Yes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; I phrased it wrongly before. With the &quot;restart&quot; in parenthesis I meant transient failures like framework failures from which the application is expected to restart. I am working on a fix and ping you or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; for a review.&lt;/p&gt;</comment>
                            <comment id="17225108" author="xintongsong" created="Tue, 3 Nov 2020 03:16:19 +0000"  >&lt;p&gt;Hi folks, thanks for reporting this issue and the discuss.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;, any estimation when this could be fixed?&lt;/p&gt;</comment>
                            <comment id="17225613" author="kkl0u" created="Tue, 3 Nov 2020 18:52:26 +0000"  >&lt;p&gt;There is an open PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;. It would be great if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; who reported it could have a look and verify that this fixes it.&lt;/p&gt;</comment>
                            <comment id="17225777" author="xintongsong" created="Wed, 4 Nov 2020 02:00:56 +0000"  >&lt;p&gt;Sounds great, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17226790" author="rmetzger" created="Thu, 5 Nov 2020 15:59:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; What&apos;s the status here?&lt;br/&gt;
Is this blocker expected to be merged before the feature freeze on Sunday?&lt;/p&gt;</comment>
                            <comment id="17226815" author="till.rohrmann" created="Thu, 5 Nov 2020 16:40:43 +0000"  >&lt;p&gt;I&apos;ve reviewed the PR and I guess that it will be merged before the feature freeze &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17227142" author="fly_in_gis" created="Fri, 6 Nov 2020 03:06:16 +0000"  >&lt;p&gt;Sorry for the late response. I have gone through the PR and verified in a K8s cluster with application attach/detach mode. It works well.&lt;/p&gt;</comment>
                            <comment id="17227245" author="kkl0u" created="Fri, 6 Nov 2020 08:55:59 +0000"  >&lt;p&gt;master: 2422fb5fc9da3aac95bbd52a6cac7d11479c1ae1&lt;br/&gt;
1.11: eb5914419a33a7358384bfc20d6dda0259baff0f&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13326280">FLINK-19154</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13014534" name="log.jm" size="137635" author="wangyang0918" created="Mon, 2 Nov 2020 05:54:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k6so:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>