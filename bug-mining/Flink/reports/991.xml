<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3939] Prevent distinct aggregates and grouping sets from being translated</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3939</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Flink&apos;s SQL interface is currently not capable of executing distinct aggregates and grouping sets.&lt;/p&gt;

&lt;p&gt;We need to prevent that queries with these operations are translated by adapting the DataSetAggregateRule.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12971328">FLINK-3939</key>
            <summary>Prevent distinct aggregates and grouping sets from being translated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fhueske">Fabian Hueske</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 May 2016 22:52:21 +0000</created>
                <updated>Mon, 23 May 2016 14:31:44 +0000</updated>
                            <resolved>Mon, 23 May 2016 14:31:44 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15293029" author="githubbot" created="Fri, 20 May 2016 08:59:18 +0000"  >&lt;p&gt;GitHub user fhueske opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2014&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3939&quot; title=&quot;Prevent distinct aggregates and grouping sets from being translated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3939&quot;&gt;&lt;del&gt;FLINK-3939&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tableAPI&amp;#93;&lt;/span&gt; Prevent translation of unsupported distinct aggregates and grouping sets.&lt;/p&gt;

&lt;p&gt;    PR fixes `DataSetAggregateRule` to not translate `LogicalAggregate` operators that include distinct aggregates or grouping sets. Such aggregations are currently not supported by `DataSetAggregate`.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Documentation&lt;/li&gt;
	&lt;li&gt;Bug fix does not require docs&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/fhueske/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fhueske/flink&lt;/a&gt; tableDistAggs&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2014.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2014.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2014&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ed9d68dece81346978564bf4185e97f7a2cf6e74&lt;br/&gt;
Author: Fabian Hueske &amp;lt;fhueske@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-05-19T22:14:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3939&quot; title=&quot;Prevent distinct aggregates and grouping sets from being translated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3939&quot;&gt;&lt;del&gt;FLINK-3939&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tableAPI&amp;#93;&lt;/span&gt; Prevent translation of unsupported distinct aggregates and grouping sets.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15295814" author="githubbot" created="Mon, 23 May 2016 01:13:48 +0000"  >&lt;p&gt;Github user yjshen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2014#discussion_r64160758&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2014#discussion_r64160758&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/plan/rules/dataSet/DataSetAggregateRule.scala &amp;#8212;&lt;br/&gt;
    @@ -33,20 +33,32 @@ class DataSetAggregateRule&lt;br/&gt;
           &quot;DataSetAggregateRule&quot;)&lt;br/&gt;
       {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;def convert(rel: RelNode): RelNode = 
{
    -      val agg: LogicalAggregate = rel.asInstanceOf[LogicalAggregate]
    -      val traitSet: RelTraitSet = rel.getTraitSet.replace(DataSetConvention.INSTANCE)
    -      val convInput: RelNode = RelOptRule.convert(agg.getInput, DataSetConvention.INSTANCE)
    -
    -      new DataSetAggregate(
    -        rel.getCluster,
    -        traitSet,
    -        convInput,
    -        agg.getNamedAggCalls,
    -        rel.getRowType,
    -        agg.getInput.getRowType,
    -        agg.getGroupSet.toArray)
    -      }
&lt;p&gt;    +  override def matches(call: RelOptRuleCall): Boolean = {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Is that possible we add an `UnsupportedOperatorRule` to match unsupported plan and throws an `TableException` on `convert` method?&lt;/p&gt;</comment>
                            <comment id="15296251" author="githubbot" created="Mon, 23 May 2016 11:32:53 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2014#discussion_r64207510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2014#discussion_r64207510&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/api/table/plan/rules/dataSet/DataSetAggregateRule.scala &amp;#8212;&lt;br/&gt;
    @@ -33,20 +33,32 @@ class DataSetAggregateRule&lt;br/&gt;
           &quot;DataSetAggregateRule&quot;)&lt;br/&gt;
       {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;def convert(rel: RelNode): RelNode = 
{
    -      val agg: LogicalAggregate = rel.asInstanceOf[LogicalAggregate]
    -      val traitSet: RelTraitSet = rel.getTraitSet.replace(DataSetConvention.INSTANCE)
    -      val convInput: RelNode = RelOptRule.convert(agg.getInput, DataSetConvention.INSTANCE)
    -
    -      new DataSetAggregate(
    -        rel.getCluster,
    -        traitSet,
    -        convInput,
    -        agg.getNamedAggCalls,
    -        rel.getRowType,
    -        agg.getInput.getRowType,
    -        agg.getGroupSet.toArray)
    -      }
&lt;p&gt;    +  override def matches(call: RelOptRuleCall): Boolean = {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    That&apos;s a good idea. I won&apos;t work for all unsupported operators (inner equi-joins are initially Cartesian products + filters before translation rules merge join and filter), but some operations such as distinct aggregates are not rewritten be rules such that we can throw an exception when they are observed.&lt;/p&gt;</comment>
                            <comment id="15296253" author="githubbot" created="Mon, 23 May 2016 11:34:52 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2014#issuecomment-220956186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2014#issuecomment-220956186&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @yjshen!&lt;br/&gt;
    Will address the comment and merge this PR.&lt;/p&gt;</comment>
                            <comment id="15296430" author="githubbot" created="Mon, 23 May 2016 14:30:56 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2014&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15296433" author="fhueske" created="Mon, 23 May 2016 14:31:44 +0000"  >&lt;p&gt;Fixed with 173d24dfdd79c497dc31c6f04dcda47a83ede494&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y8rb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>