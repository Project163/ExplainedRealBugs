<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30812] YARN with S3 resource storage fails for Hadoop 3.3.2</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30812</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17139&quot; title=&quot;Re-enable optimized copyFromLocal implementation in S3AFileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17139&quot;&gt;&lt;del&gt;HADOOP-17139&lt;/del&gt;&lt;/a&gt; S3AFileSystem#copyFromLocalFile was refactored and expects the local source Hadoop Path object to have a scheme specified which the YarnClusterDescriptor uploading the local files won&apos;t have.&lt;/p&gt;

&lt;p&gt;When uploading files to S3 CopyFromLocalOperation#getFinalPath compares the passed source Hadoop Path with the file it found(which will have &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; scheme) using URI.relativize but it will fail because of the scheme difference and throw&#160;PathIOException as can be seen in this exception:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.client.deployment.ClusterDeploymentException: Couldn&apos;t deploy Yarn Application Cluster
	at org.apache.flink.yarn.YarnClusterDescriptor.deployApplicationCluster(YarnClusterDescriptor.java:478) ~[flink-yarn-1.16.0.jar!/:1.16.0]&#160; &#160; &#160; &#160; ......
Caused by: org.apache.hadoop.fs.PathIOException: `Cannot get relative path &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; URI:file:&lt;span class=&quot;code-comment&quot;&gt;///tmp/application_1674531932229_0030-flink-conf.yaml587547081521530798.tmp&apos;: Input/output error
&lt;/span&gt;	at org.apache.hadoop.fs.s3a.impl.CopyFromLocalOperation.getFinalPath(CopyFromLocalOperation.java:360) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.hadoop.fs.s3a.impl.CopyFromLocalOperation.uploadSourceFromFS(CopyFromLocalOperation.java:222) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.hadoop.fs.s3a.impl.CopyFromLocalOperation.execute(CopyFromLocalOperation.java:169) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.hadoop.fs.s3a.S3AFileSystem.lambda$copyFromLocalFile$25(S3AFileSystem.java:3920) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.lambda$trackDurationOfOperation$5(IOStatisticsBinding.java:499) ~[hadoop-common-3.3.3.jar!/:?]
	at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.trackDuration(IOStatisticsBinding.java:444) ~[hadoop-common-3.3.3.jar!/:?]
	at org.apache.hadoop.fs.s3a.S3AFileSystem.trackDurationAndSpan(S3AFileSystem.java:2337) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.hadoop.fs.s3a.S3AFileSystem.trackDurationAndSpan(S3AFileSystem.java:2356) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.hadoop.fs.s3a.S3AFileSystem.copyFromLocalFile(S3AFileSystem.java:3913) ~[flink-s3-fs-hadoop-1.16.0.jar!/:1.16.0]
	at org.apache.flink.yarn.YarnApplicationFileUploader.copyToRemoteApplicationDir(YarnApplicationFileUploader.java:397) ~[flink-yarn-1.16.0.jar!/:1.16.0]
	at org.apache.flink.yarn.YarnApplicationFileUploader.uploadLocalFileToRemote(YarnApplicationFileUploader.java:202) ~[flink-yarn-1.16.0.jar!/:1.16.0]
	at org.apache.flink.yarn.YarnApplicationFileUploader.registerSingleLocalResource(YarnApplicationFileUploader.java:181) ~[flink-yarn-1.16.0.jar!/:1.16.0]
	at org.apache.flink.yarn.YarnClusterDescriptor.startAppMaster(YarnClusterDescriptor.java:1047) ~[flink-yarn-1.16.0.jar!/:1.16.0]
	at org.apache.flink.yarn.YarnClusterDescriptor.deployInternal(YarnClusterDescriptor.java:623) ~[flink-yarn-1.16.0.jar!/:1.16.0]
	at org.apache.flink.yarn.YarnClusterDescriptor.deployApplicationCluster(YarnClusterDescriptor.java:471) ~[flink-yarn-1.16.0.jar!/:1.16.0]
	... 35 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The possibly easiest solution would be to somehow add the &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; scheme in YarnApplicationFileUploader#copyToRemoteApplicationDir&lt;/p&gt;

&lt;p&gt;The other solution would be to change all calls uploading local files to use &quot;new Path(file.toURI())&quot; instead of &quot;new Path(file.getAbsolutePath())&quot; but it might not be as future-proof as the other solution&lt;/p&gt;

&lt;p&gt;Email thread: &lt;a href=&quot;https://lists.apache.org/thread/oo5rlyo3jr7kds2y6wwnfo1yhnk0fx4c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/oo5rlyo3jr7kds2y6wwnfo1yhnk0fx4c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If a committer can assign this ticket to me I can start working on this&lt;/p&gt;</description>
                <environment></environment>
        <key id="13521849">FLINK-30812</key>
            <summary>YARN with S3 resource storage fails for Hadoop 3.3.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mateczagany">Mate Czagany</assignee>
                                    <reporter username="mateczagany">Mate Czagany</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>stale-assigned</label>
                    </labels>
                <created>Sat, 28 Jan 2023 09:48:13 +0000</created>
                <updated>Sat, 2 Sep 2023 07:04:41 +0000</updated>
                            <resolved>Sat, 2 Sep 2023 07:04:35 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.17.0</version>
                    <version>1.18.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17681948" author="martijnvisser" created="Mon, 30 Jan 2023 08:31:21 +0000"  >&lt;p&gt;Is this is a trivial update for 1.16, given that in 1.17 we&apos;ll have &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-29710&quot; title=&quot;Upgrade the minimal supported hadoop version to 2.10.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-29710&quot;&gt;&lt;del&gt;FLINK-29710&lt;/del&gt;&lt;/a&gt; which updated the minimum Hadoop versions to 2.10.2 and 3.2.3? &lt;/p&gt;</comment>
                            <comment id="17681980" author="JIRAUSER298834" created="Mon, 30 Jan 2023 09:25:14 +0000"  >&lt;p&gt;I have found an easy fix by making sure the passed &apos;localSrcPath&apos; contains the &apos;file://&apos; scheme in &apos;YarnApplicationFileUploader#copyToRemoteApplicationDir&apos; if it doesn&apos;t contain any scheme already.&lt;/p&gt;

&lt;p&gt;I manually tested this fix on a local single-node 3.3.4 Hadoop cluster with &apos;fs.defaultFS&apos; pointing to a local Minio S3 storage and it worked well.&lt;/p&gt;

&lt;p&gt;I&apos;m trying to come up with a unit test for this change and I&apos;ll create a PR then.&lt;/p&gt;

&lt;p&gt;Also, it affects all Hadoop versions starting from 3.3.2&lt;/p&gt;</comment>
                            <comment id="17761101" author="flink-jira-bot" created="Thu, 31 Aug 2023 22:35:10 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issue is assigned but has not received an update in 30 days, so it has been labeled &quot;stale-assigned&quot;.&lt;br/&gt;
If you are still working on the issue, please remove the label and add a comment updating the community on your progress.  If this issue is waiting on feedback, please consider this a reminder to the committer/reviewer. Flink is a very active project, and so we appreciate your patience.&lt;br/&gt;
If you are no longer working on the issue, please unassign yourself so someone else may work on it.&lt;/p&gt;</comment>
                            <comment id="17761443" author="gaborgsomogyi" created="Sat, 2 Sep 2023 07:04:35 +0000"  >&lt;p&gt;9507dd6 on master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fg0g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>