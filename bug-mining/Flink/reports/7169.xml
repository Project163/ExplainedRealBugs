<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-29913] Shared state would be discarded by mistake when maxConcurrentCheckpoint&gt;1</title>
                <link>https://issues.apache.org/jira/browse/FLINK-29913</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When maxConcurrentCheckpoint&amp;gt;1, the shared state of Incremental rocksdb state backend would be discarded by registering the same name handle. See &lt;a href=&quot;https://github.com/apache/flink/pull/21050#discussion_r1011061072&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/21050#discussion_r1011061072&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13498033">FLINK-29913</key>
            <summary>Shared state would be discarded by mistake when maxConcurrentCheckpoint&gt;1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Feifan Wang">Feifan Wang</assignee>
                                    <reporter username="Yanfei Lei">Yanfei Lei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 7 Nov 2022 06:07:16 +0000</created>
                <updated>Sat, 5 Aug 2023 17:56:36 +0000</updated>
                            <resolved>Sat, 5 Aug 2023 17:56:36 +0000</resolved>
                                    <version>1.15.0</version>
                    <version>1.16.0</version>
                    <version>1.17.0</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17629630" author="yanfei lei" created="Mon, 7 Nov 2022 07:45:36 +0000"  >&lt;p&gt;I added &lt;a href=&quot;https://github.com/apache/flink/commit/db27669d8bbfa995d961fae32f46bc4df676afb7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ConcurrentCheckpointITCase&lt;/a&gt; to reproduce this problem at &lt;a href=&quot;https://github.com/fredia/flink/tree/test_concurrent_chk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fredia/flink/tree/test_concurrent_chk&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17629759" author="klion26" created="Mon, 7 Nov 2022 11:30:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt;&#160; thanks for creating this ticket and the IT Case,&#160; would you like to contribute a fix for this problem?&lt;/p&gt;

&lt;p&gt;For the priority, As this may lead to &lt;tt&gt;FileNotFoundExecption if set {{maxConcurrencthCheckpoint&lt;/tt&gt;}} &amp;gt; 1, I think it at least needs to be Critical, what do you think about this?&lt;/p&gt;</comment>
                            <comment id="17629771" author="yanfei lei" created="Mon, 7 Nov 2022 11:52:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt; Since maxConcurrentCheckpoint&amp;gt;1 &amp;amp;&amp;amp;MAX_RETAINED_CHECKPOINTS&amp;gt;1&#160; are less frequently used, I set the priority to Minor.&lt;br/&gt;
Under the current checkpoint registration and deletion mechanism, I think this bug will take a while to fix, I&apos;d like to fix this problem after discussion.&lt;/p&gt;</comment>
                            <comment id="17631234" author="roman_khachatryan" created="Wed, 9 Nov 2022 19:04:59 +0000"  >&lt;p&gt;Thanks a lot for noticing and reporting this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I think there is a (conceptually) simple solution: always generate unique state handle IDs.&lt;br/&gt;
(It was already discussed offline before in the context of similar problems while detecting duplicates in SharedStateRegistry).&lt;/p&gt;

&lt;p&gt;The ID doesn&apos;t have to have any semantic meaning. &lt;br/&gt;
RocksDB happens to &lt;a href=&quot;https://github.com/apache/flink/blob/421f057a7488fd64854a82424755f76b89561a0b/flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/snapshot/RocksIncrementalSnapshotStrategy.java#L397&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;store the local path in ID&lt;/a&gt; and then uses it &lt;a href=&quot;https://github.com/apache/flink/blob/421f057a7488fd64854a82424755f76b89561a0b/flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBStateDownloader.java#L105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on recovery&lt;/a&gt;; but it can be a separate field in the handle as well.&lt;/p&gt;

&lt;p&gt;I don&apos;t see any issues with this approach, including recovery, rescaling, and JM failover cases.&lt;/p&gt;

&lt;p&gt;What do you think? Maybe there are some alternatives?&lt;/p&gt;</comment>
                            <comment id="17633506" author="klion26" created="Mon, 14 Nov 2022 05:41:13 +0000"  >&lt;p&gt;sorry for the late reply.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt;&#160; for the priority, IMHO, if the user set {{ maxConcurrenctCheckpoint &amp;gt; 1 &amp;amp;&amp;amp; MAX_RETAINED_CHECKPOINTS &amp;gt; 1 }} , then the checkpoints may be broken, and can&apos;t restore from the checkpoint because of the &lt;tt&gt;FileNotFoundException&lt;/tt&gt;, so I think it deserves to escalate the priority.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; your proposal seems valid from my perspective, maybe changing the logic for &lt;tt&gt;generating the registry key(perhaps using the filename in the remote filesystem)is enough to solve the problem here?&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;please let me what do you think about this, thanks.&lt;/p&gt;</comment>
                            <comment id="17633657" author="yanfei lei" created="Mon, 14 Nov 2022 10:19:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; Great proposal!&#160; I think that maintaining the mapping of &amp;lt;state handle ID, file name&amp;gt; is necessary, because RocksDB needs the file name(xxx.sst) to rebuild its instance.&lt;/p&gt;

&lt;p&gt;And I have a question about &quot;always generate unique state handle IDs&quot;:&lt;/p&gt;

&lt;p&gt;if the confirmation notification was missing, TM re-upload some state handles, how do we delete those duplicate state handles?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17633672" author="roman_khachatryan" created="Mon, 14 Nov 2022 10:39:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt; , we could use remote filename as well, but we still have to store the mapping from remote to local to initialize RocksDB on recovery.&lt;/p&gt;

&lt;p&gt;UUID are slightly better IMO because they are usually shorter and therefore consume less space in the final _metadata file and as keys in SharedStateRegistry.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt; , good question. In case of re-upload, the old state should be discarded eventually when the checkpoint it was created for is subsumed.&lt;/p&gt;</comment>
                            <comment id="17725286" author="feifan wang" created="Tue, 23 May 2023 08:32:32 +0000"  >&lt;p&gt;Sorry I didn&apos;t notice this ticket earlier so I submitted a duplicate one.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Yanfei+Lei&quot; class=&quot;user-hover&quot; rel=&quot;Yanfei Lei&quot;&gt;Yanfei Lei&lt;/a&gt;&#160; for the priority, I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt; , since it may break the checkpoint in valid use case, the priority at least be &lt;b&gt;Major&lt;/b&gt; .&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; I think your proposal is valid, but I still want to provide an alternative :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Make SharedStateRegistry allow register multi state object to same key. The generation strategy for SharedStateRegistryKey is still determined by CompositeStateHandle , as it is now. Different state objects may be registered under the same key in force-full-checkpoint (active re-upload).&lt;/li&gt;
	&lt;li&gt;SharedStateRegistry maintains an linked entry list sorted by registration time for each key. PlaceHolderStreamStateHandle will be replace by the last one in the entry list.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In this approach, SharedStateRegistry don&apos;t discard any state object in registration process. SharedStateRegistry only deleted state object when its lastUsedCheckpoint is subsumed.&lt;/p&gt;</comment>
                            <comment id="17725336" author="roman_khachatryan" created="Tue, 23 May 2023 10:01:16 +0000"  >&lt;p&gt;Thanks for the proposal &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt;. I think it&apos;s easier to implement, compared to always unique state IDs. OTH, it complicates already complex part of the system; and has some runtime overhead. So I&apos;d rather go with unique state IDs.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As for the priority, I&apos;d change it to Major if there are no objections.&lt;/p&gt;</comment>
                            <comment id="17725387" author="feifan wang" created="Tue, 23 May 2023 12:21:10 +0000"  >&lt;p&gt;One overhead I can see is that it will use more memory for storing the next pointer. On a 64-bit system, about 7.63MB more memory will be used for every one million entries, I think it is acceptable. Is there any other runtime overhead I missed ?&lt;/p&gt;

&lt;p&gt;As for the complexity, this approach will indeed increase the operation of the linked list in the&#160;&lt;em&gt;registerReference()&lt;/em&gt; method and &lt;em&gt;unregisterUnusedState()&lt;/em&gt; method. But given that this is easy to implement, and the implementation is cohesive, I think the complexity is acceptable.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Just to clarify, I think using a unique ID is also a valid approach, but I want learn how you do the selection. Further, regarding the approach of using unique registry key, I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt; , we can just choose a stable register key generation method based on remote file name (such as use md5 digest of remote file name) , which can replace of IncrementalRemoteKeyedStateHandle#createSharedStateRegistryKeyFromFileName() . The mapping of local sst file name to StreamStateHandle never changed , so the part of RocksDB recovery does not need to be changed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Whichever approach will be chosen, I am happy to implement it. Can you assign this ticket to me &#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; ? looking forward to hearing from you.&lt;/p&gt;</comment>
                            <comment id="17725418" author="roman_khachatryan" created="Tue, 23 May 2023 13:47:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;On a 64-bit system, about 7.63MB more memory will be used for every one million entries&lt;br/&gt;
Is there any other runtime overhead I missed ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was more concerned about the additional time required to traverse the (mostly single-element) lists. When a checkpoint is subsumed, &lt;b&gt;all&lt;/b&gt; entries need to be scanned. Adding pointer dereference(s) might break any optimizations that JVM and CPU would otherwise employ.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;As for the complexity, this approach will indeed increase the operation of the linked list in the registerReference() method and unregisterUnusedState() method.&lt;br/&gt;
But given that this is easy to implement, and the implementation is cohesive, I think the complexity is acceptable.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In my view, simplicity in this is part is worth the efforts. The problem that SharedStateRegistry solves is already tricky, and we shouldn&apos;t complicate it further (higher complexity potentially leads to more bugs and more maintanance efforts).&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Further, regarding the approach of using unique registry key, I agree with Congxian Qiu , we can just choose a stable register key generation method based on remote file name (such as use md5 digest of remote file name) , which can replace of IncrementalRemoteKeyedStateHandle#createSharedStateRegistryKeyFromFileName() .&lt;br/&gt;
The mapping of local sst file name to StreamStateHandle never changed , so the part of RocksDB recovery does not need to be changed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t fully understand what does &quot;never changed&quot; means here.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/blob/fbf7b91424ec626ae56dd2477347a7759db6d5fe/flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBStateDownloader.java#L105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&lt;/a&gt;, the ID is used to create local path. If we change ID to remote path, local will change too. Per my understanding, we can not change the local path without updating metadata files.&lt;br/&gt;
Or am I missing something?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Whichever approach will be chosen, I am happy to implement it. Can you assign this ticket to me Roman Khachatryan ? looking forward to hearing from you.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure, thanks for volounteering!&lt;/p&gt;</comment>
                            <comment id="17725470" author="feifan wang" created="Tue, 23 May 2023 15:37:04 +0000"  >&lt;p&gt;Thanks for the clarification &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; !&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Further, regarding the approach of using unique registry key, I agree with Congxian Qiu , we can just choose a stable register key generation method based on remote file name (such as use md5 digest of remote file name) , which can replace of IncrementalRemoteKeyedStateHandle#createSharedStateRegistryKeyFromFileName() .&lt;br/&gt;
The mapping of local sst file name to StreamStateHandle never changed , so the part of RocksDB recovery does not need to be changed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I mean we still use local file name as key of sharedState map in&#160; &lt;em&gt;&lt;b&gt;IncrementalRemoteKeyedStateHandle&lt;/b&gt;&lt;/em&gt; and use remote file path when generating SharedStateRegisterKey. Changes in &lt;em&gt;&lt;b&gt;IncrementalRemoteKeyedStateHandle&lt;/b&gt;&lt;/em&gt; like this :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;StateHandleID, StreamStateHandle&amp;gt; sharedState;  &lt;span class=&quot;code-comment&quot;&gt;// still use local file name as key of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; map, corresponding to the &#8220;never change&#8221; I mentioned above
&lt;/span&gt;
...


&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void registerSharedStates(SharedStateRegistry stateRegistry, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; checkpointID) {
...
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;StateHandleID, StreamStateHandle&amp;gt; sharedStateHandle :
            sharedState.entrySet()) {

        SharedStateRegistryKey registryKey = generateRegisterKey(sharedStateHandle.getValue);  &lt;span class=&quot;code-comment&quot;&gt;// changed line
&lt;/span&gt;

        StreamStateHandle reference =
                stateRegistry.registerReference(
                        registryKey, sharedStateHandle.getValue(), checkpointID);

        sharedStateHandle.setValue(reference);
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; SharedStateRegistryKey generateRegisterKey(StreamStateHandle stateHandle) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; keyString = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stateHandle &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; FileStateHandle) {
        keyString = ((FileStateHandle) stateHandle).getFilePath().toString();
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stateHandle &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ByteStreamStateHandle) {
        keyString = ((ByteStreamStateHandle) stateHandle).getHandleName();
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        keyString = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.identityHashCode(stateHandle));
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SharedStateRegistryKey(md5sum(keyString)); &lt;span class=&quot;code-comment&quot;&gt;// may be other digest algorithm
&lt;/span&gt;}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And we can only use normal handles (not PlaceholderStreamStateHandle) in IncrementalRemoteKeyedStateHandle to make sure IncrementalRemoteKeyedStateHandle#generateRegisterKey() method never get a PlaceholderStreamStateHandle.&lt;/p&gt;</comment>
                            <comment id="17725569" author="roman_khachatryan" created="Tue, 23 May 2023 20:27:30 +0000"  >&lt;p&gt;Got it, thanks for clarifying.&#160;&lt;/p&gt;

&lt;p&gt;However, I think that using &quot;Integer.toString(System.identityHashCode(stateHandle))&quot; can easily lead to collisions, thereby causing checkpoint corruption.&lt;/p&gt;

&lt;p&gt;But this seems to me an (important) implementation detail, that can be discussed in the PR. WDYT?&lt;/p&gt;</comment>
                            <comment id="17725624" author="feifan wang" created="Wed, 24 May 2023 03:49:14 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , I will prepare a pr.&lt;/p&gt;</comment>
                            <comment id="17725693" author="roman_khachatryan" created="Wed, 24 May 2023 08:21:35 +0000"  >&lt;p&gt;Great! Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17726084" author="klion26" created="Thu, 25 May 2023 07:37:14 +0000"  >&lt;p&gt;thanks for the discuss above and contribution!&lt;/p&gt;

&lt;p&gt;Using the UUID/filename as the key solves the problem here, and it also makes sense because the key and the remote file are one-to-one. In addition, it can also solve some other potential problems, for example, if the Flink job management platform uses the SharedRegistry here to maintain the checkpoints lifecycle, if a task has two ssts with the same name, it will now cause the file to be deleted by mistake (this situation occurs as follows: job A generates a checkpoint chk1, then stops, job B job B resumes from chk1, completes chk2, then stops, then job C resumes from chk1, completes chk3, after we register chk2 and chk3 in one SharedRegistry, we&apos;ll delete some remote files by mistake, because there will be some sst files in chk2 and chk3 with the same name)&lt;/p&gt;</comment>
                            <comment id="17726933" author="feifan wang" created="Sun, 28 May 2023 12:02:30 +0000"  >&lt;p&gt;Thanks for your information &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt; , I would like to add a case that I recently thought of a possible problem: Since 1.17, user can trigger checkpoint with assigned checkpoint type (CONFIGURED,FULL,INCREMENTAL). If user trigger a FULL checkpoint by rest api, this forces re-upload of snapshot files that have already been uploaded. Using remote file path based register key is still valid in this case.&lt;/p&gt;

&lt;p&gt;I have submitted a PR, please help to review it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; ,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klion26&quot; class=&quot;user-hover&quot; rel=&quot;klion26&quot;&gt;klion26&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="17750636" author="roman_khachatryan" created="Thu, 3 Aug 2023 08:45:53 +0000"  >&lt;p&gt;Merged into master as 6dcb10abf319b9e5494a82bee71f1ae1a4e4b211 ... 85f32d6bcb31708c9c2c845ea03ef117726b7c1a.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt; do you mind creating backport PRs for branches 1.17 and 1.16?&lt;/p&gt;</comment>
                            <comment id="17750647" author="feifan wang" created="Thu, 3 Aug 2023 09:04:45 +0000"  >&lt;p&gt;&#160;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; &#160;for helping to review the PR, I learned a lot from it.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;do you mind creating backport PRs for branches 1.17 and 1.16?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am glad to.&lt;/p&gt;</comment>
                            <comment id="17751111" author="feifan wang" created="Fri, 4 Aug 2023 12:46:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; ,&#160; I submitted two PRs for &lt;a href=&quot;https://github.com/apache/flink/pull/23137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.16&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/flink/pull/23139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.17&lt;/a&gt;, please take a look.&lt;/p&gt;</comment>
                            <comment id="17751304" author="feifan wang" created="Sat, 5 Aug 2023 11:24:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; , In addition backport pr of &lt;a href=&quot;https://github.com/apache/flink/pull/23137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.16&lt;/a&gt;&#160;and&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/23139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.17&lt;/a&gt;, I also submitted &lt;a href=&quot;https://github.com/apache/flink/pull/23147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a PR to fix outdated java doc in SharedStateRegistry&lt;/a&gt;, PTAL.&lt;/p&gt;</comment>
                            <comment id="17751308" author="roman_khachatryan" created="Sat, 5 Aug 2023 12:35:18 +0000"  >&lt;p&gt;Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Feifan+Wang&quot; class=&quot;user-hover&quot; rel=&quot;Feifan Wang&quot;&gt;Feifan Wang&lt;/a&gt;, happy to hear that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve merged backports to 1.16 as aad658910fd6967199bce69f33872d245315bca1..c6c54412bf70af4432071dfdf131b62ff8236fe7&lt;br/&gt;
and to 1.17 as 65e7004dd32633f9dfc87b0808ffcb587daf525c..f3d212956660a77d58ab99f4de6611760e5f0b9a.&lt;/p&gt;

&lt;p&gt;I&apos;ve taken a look at javadoc update, thanks for noticing this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17751329" author="roman_khachatryan" created="Sat, 5 Aug 2023 17:56:04 +0000"  >&lt;p&gt;javadoc updated in &lt;br/&gt;
c7d3e36053091b7d7b10e89c5f9dba3df46ec0bd (master)&lt;br/&gt;
f2d3ca0bf4d49621450c7e71c1bd7c9de2deb89b (1.16)&lt;br/&gt;
e213267ebf691f1e959be6f5154a790c2ec6a2e9 (1.17)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13536801">FLINK-32130</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1bdjc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>