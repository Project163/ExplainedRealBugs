<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8419] Kafka consumer&apos;s offset metrics are not registered for dynamically discovered partitions</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8419</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, the per-partition offset metrics are registered via the &lt;tt&gt;AbstractFetcher#addOffsetStateGauge&lt;/tt&gt; method. That method is only ever called for the initial startup partitions, and not for dynamically discovered partitions.&lt;/p&gt;

&lt;p&gt;We should consider adding some unit tests to make sure that metrics are properly registered for all partitions. That would also safeguard us from accidentally removing metrics.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13130390">FLINK-8419</key>
            <summary>Kafka consumer&apos;s offset metrics are not registered for dynamically discovered partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tzulitai">Tzu-Li (Gordon) Tai</assignee>
                                    <reporter username="tzulitai">Tzu-Li (Gordon) Tai</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Jan 2018 01:45:31 +0000</created>
                <updated>Wed, 7 Feb 2018 10:36:20 +0000</updated>
                            <resolved>Tue, 6 Feb 2018 19:08:35 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.5.0</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                    <component>Runtime / Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16334385" author="githubbot" created="Mon, 22 Jan 2018 15:14:56 +0000"  >&lt;p&gt;GitHub user tzulitai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5335&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5335&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    (master) &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Register metrics for dynamically discovered Kafka partitions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR fixes that offset metrics (i.e. current offset, committed offsets) were not registered for partitions that were dynamically discovered in the `FlinkKafkaConsumerBase`.&lt;/p&gt;

&lt;p&gt;    This version is targeted for merge to `master`.&lt;br/&gt;
    Another version targeted for `release-1.4`, which does not include the new offset metrics added in #5214, will be separately opened.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;54f3cfd: Preliminary cleanup of the registration of the `KafkaConsumer` user scope metric group. This commit refactors that for better separation of concerns and lessen code duplication.&lt;/li&gt;
	&lt;li&gt;bf1e4ce: Register offset metrics for new partitions in `addDiscoveredPartitions`&lt;/li&gt;
	&lt;li&gt;7e90a75: Minor hotfix to inappropriate access modifiers in the `AbstractFetcher`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    No new tests were added.&lt;br/&gt;
    By manually running a Flink job using the Kafka consumer and repartitioning the Kafka topic, you should be able to see metrics for the newly added partitions.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tzulitai/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tzulitai/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5335.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5335.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5335&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 54f3cfd3eb9f925266de37219ab56703a26795d6&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@...&amp;gt;&lt;br/&gt;
Date:   2018-01-22T12:36:20Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Move consumer metric group registration to FlinkKafkaConsumerBase&lt;/p&gt;

&lt;p&gt;    This commit is a refactor to move the registration of the consumer&lt;br/&gt;
    metric group (user scope &quot;KafkaConsumer&quot;) to FlinkKafkaConsumerBase.&lt;br/&gt;
    Previously, the registration was scattered around in Kafka&lt;br/&gt;
    version-specific subclasses.&lt;/p&gt;

&lt;p&gt;commit bf1e4ce73279a90d625cda66ee84c194d5ce3e34&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@...&amp;gt;&lt;br/&gt;
Date:   2018-01-22T13:14:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Register metrics for dynamically discovered Kafka partitions&lt;/p&gt;

&lt;p&gt;commit 7e90a753441b7a4af1dd400942d88fba7d0178df&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@...&amp;gt;&lt;br/&gt;
Date:   2018-01-22T13:17:54Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Fix inapproriate access modifiers in AbstractFetcher&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16334420" author="githubbot" created="Mon, 22 Jan 2018 15:40:16 +0000"  >&lt;p&gt;GitHub user tzulitai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    (release-1.4) &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Register metrics for dynamically discovered Kafka partitions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Different version of #5335, which is targeted for `release-1.4`.&lt;br/&gt;
    This version does not include the new offset metrics added in #5214 for the new partitions (those new metrics are only added in `master`).&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;db39ec2: Preliminary cleanup of the registration of the `KafkaConsumer` user scope metric group. This commit refactors that for better separation of concerns and lessen code duplication.&lt;/li&gt;
	&lt;li&gt;1acfc15: Register offset metrics for new partitions in `addDiscoveredPartitions`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    No new tests were added.&lt;br/&gt;
    By manually running a Flink job using the Kafka consumer and repartitioning the Kafka topic, you should be able to see metrics for the newly added partitions.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tzulitai/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tzulitai/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt;-1.4&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5336&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit db39ec2ed6f6b9cf46bc851125b859501d9a9df0&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@...&amp;gt;&lt;br/&gt;
Date:   2018-01-22T12:36:20Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Move consumer metric group registration to FlinkKafkaConsumerBase&lt;/p&gt;

&lt;p&gt;    This commit is a refactor to move the registration of the consumer&lt;br/&gt;
    metric group (user scope &quot;KafkaConsumer&quot;) to FlinkKafkaConsumerBase.&lt;br/&gt;
    Previously, the registration was scattered around in Kafka&lt;br/&gt;
    version-specific subclasses.&lt;/p&gt;

&lt;p&gt;commit 1acfc1526e56abd5e5cb4f5a32641afbf2282905&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@...&amp;gt;&lt;br/&gt;
Date:   2018-01-22T13:14:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8419&quot; title=&quot;Kafka consumer&amp;#39;s offset metrics are not registered for dynamically discovered partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8419&quot;&gt;&lt;del&gt;FLINK-8419&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Register metrics for dynamically discovered Kafka partitions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16346623" author="githubbot" created="Wed, 31 Jan 2018 11:11:53 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336#discussion_r165021339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336#discussion_r165021339&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-base/src/main/java/org/apache/flink/streaming/connectors/kafka/internals/AbstractFetcher.java &amp;#8212;&lt;br/&gt;
    @@ -560,16 +585,11 @@ private void updateMinPunctuatedWatermark(Watermark nextWatermark) {&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Add current and committed offsets to metric group.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @param metricGroup The metric group to use&lt;br/&gt;
     	 */&lt;/li&gt;
	&lt;li&gt;protected void addOffsetStateGauge(MetricGroup metricGroup) {&lt;/li&gt;
	&lt;li&gt;// add current offsets to gage&lt;/li&gt;
	&lt;li&gt;MetricGroup currentOffsets = metricGroup.addGroup(&quot;current-offsets&quot;);&lt;/li&gt;
	&lt;li&gt;MetricGroup committedOffsets = metricGroup.addGroup(&quot;committed-offsets&quot;);&lt;/li&gt;
	&lt;li&gt;for (KafkaTopicPartitionState&amp;lt;KPH&amp;gt; ktp : subscribedPartitionStates) {&lt;/li&gt;
	&lt;li&gt;currentOffsets.gauge(ktp.getTopic() + &quot;-&quot; + ktp.getPartition(), new OffsetGauge(ktp, OffsetGaugeType.CURRENT_OFFSET));&lt;/li&gt;
	&lt;li&gt;committedOffsets.gauge(ktp.getTopic() + &quot;-&quot; + ktp.getPartition(), new OffsetGauge(ktp, OffsetGaugeType.COMMITTED_OFFSET));&lt;br/&gt;
    +	protected void registerOffsetMetrics(List&amp;lt;KafkaTopicPartitionState&amp;lt;KPH&amp;gt;&amp;gt; partitionOffsetStates) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    make private?&lt;/p&gt;</comment>
                            <comment id="16346624" author="githubbot" created="Wed, 31 Jan 2018 11:12:35 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336#discussion_r165021513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336#discussion_r165021513&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -92,21 +93,19 @@ public Kafka09Fetcher(&lt;br/&gt;
     				watermarksPunctuated,&lt;br/&gt;
     				processingTimeProvider,&lt;br/&gt;
     				autoWatermarkInterval,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userCodeClassLoader,&lt;br/&gt;
    +				userCodeClassLoader.getParent(),&lt;br/&gt;
    +				consumerMetricGroup,&lt;br/&gt;
     				useMetrics);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.deserializer = deserializer;&lt;br/&gt;
     		this.handover = new Handover();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final MetricGroup kafkaMetricGroup = metricGroup.addGroup(&quot;KafkaConsumer&quot;);&lt;/li&gt;
	&lt;li&gt;addOffsetStateGauge(kafkaMetricGroup);&lt;br/&gt;
    -&lt;br/&gt;
     		this.consumerThread = new KafkaConsumerThread(&lt;br/&gt;
     				LOG,&lt;br/&gt;
     				handover,&lt;br/&gt;
     				kafkaProperties,&lt;br/&gt;
     				unassignedPartitionsQueue,&lt;/li&gt;
	&lt;li&gt;kafkaMetricGroup,&lt;br/&gt;
    +				subtaskMetricGroup, // TODO: the thread should expose Kafka-shipped metrics through the consumer metric group, not subtask metric group
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    so why aren&apos;t we passing the consumerMetricGroup here?&lt;/p&gt;</comment>
                            <comment id="16346633" author="githubbot" created="Wed, 31 Jan 2018 11:18:22 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336#discussion_r165022738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336#discussion_r165022738&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -92,21 +93,19 @@ public Kafka09Fetcher(&lt;br/&gt;
     				watermarksPunctuated,&lt;br/&gt;
     				processingTimeProvider,&lt;br/&gt;
     				autoWatermarkInterval,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userCodeClassLoader,&lt;br/&gt;
    +				userCodeClassLoader.getParent(),&lt;br/&gt;
    +				consumerMetricGroup,&lt;br/&gt;
     				useMetrics);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.deserializer = deserializer;&lt;br/&gt;
     		this.handover = new Handover();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final MetricGroup kafkaMetricGroup = metricGroup.addGroup(&quot;KafkaConsumer&quot;);&lt;/li&gt;
	&lt;li&gt;addOffsetStateGauge(kafkaMetricGroup);&lt;br/&gt;
    -&lt;br/&gt;
     		this.consumerThread = new KafkaConsumerThread(&lt;br/&gt;
     				LOG,&lt;br/&gt;
     				handover,&lt;br/&gt;
     				kafkaProperties,&lt;br/&gt;
     				unassignedPartitionsQueue,&lt;/li&gt;
	&lt;li&gt;kafkaMetricGroup,&lt;br/&gt;
    +				subtaskMetricGroup, // TODO: the thread should expose Kafka-shipped metrics through the consumer metric group, not subtask metric group
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Because that would break compatibility of previous metrics.&lt;/p&gt;

&lt;p&gt;    On the other hand, it might make sense that we also additionally register the Kafka-shipped metrics under `consumerMetricGroup` now, if we want to be able to eventually resolve this TODO in the future. What do you think?&lt;/p&gt;</comment>
                            <comment id="16346634" author="githubbot" created="Wed, 31 Jan 2018 11:18:30 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5335#discussion_r165022709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5335#discussion_r165022709&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -95,21 +95,19 @@ public Kafka09Fetcher(&lt;br/&gt;
     				watermarksPunctuated,&lt;br/&gt;
     				processingTimeProvider,&lt;br/&gt;
     				autoWatermarkInterval,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userCodeClassLoader,&lt;br/&gt;
    +				userCodeClassLoader.getParent(),&lt;br/&gt;
    +				consumerMetricGroup,&lt;br/&gt;
     				useMetrics);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.deserializer = deserializer;&lt;br/&gt;
     		this.handover = new Handover();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final MetricGroup kafkaMetricGroup = metricGroup.addGroup(KAFKA_CONSUMER_METRICS_GROUP);&lt;/li&gt;
	&lt;li&gt;addOffsetStateGauge(kafkaMetricGroup);&lt;br/&gt;
    -&lt;br/&gt;
     		this.consumerThread = new KafkaConsumerThread(&lt;br/&gt;
     				LOG,&lt;br/&gt;
     				handover,&lt;br/&gt;
     				kafkaProperties,&lt;br/&gt;
     				unassignedPartitionsQueue,&lt;/li&gt;
	&lt;li&gt;kafkaMetricGroup,&lt;br/&gt;
    +				subtaskMetricGroup, // TODO: the thread should expose Kafka-shipped metrics through the consumer metric group, not subtask metric group
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    so why aren&apos;t we passing the consumerMetricGroup here?&lt;/p&gt;</comment>
                            <comment id="16346636" author="githubbot" created="Wed, 31 Jan 2018 11:20:11 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336#discussion_r165023129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336#discussion_r165023129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -92,21 +93,19 @@ public Kafka09Fetcher(&lt;br/&gt;
     				watermarksPunctuated,&lt;br/&gt;
     				processingTimeProvider,&lt;br/&gt;
     				autoWatermarkInterval,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userCodeClassLoader,&lt;br/&gt;
    +				userCodeClassLoader.getParent(),&lt;br/&gt;
    +				consumerMetricGroup,&lt;br/&gt;
     				useMetrics);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.deserializer = deserializer;&lt;br/&gt;
     		this.handover = new Handover();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final MetricGroup kafkaMetricGroup = metricGroup.addGroup(&quot;KafkaConsumer&quot;);&lt;/li&gt;
	&lt;li&gt;addOffsetStateGauge(kafkaMetricGroup);&lt;br/&gt;
    -&lt;br/&gt;
     		this.consumerThread = new KafkaConsumerThread(&lt;br/&gt;
     				LOG,&lt;br/&gt;
     				handover,&lt;br/&gt;
     				kafkaProperties,&lt;br/&gt;
     				unassignedPartitionsQueue,&lt;/li&gt;
	&lt;li&gt;kafkaMetricGroup,&lt;br/&gt;
    +				subtaskMetricGroup, // TODO: the thread should expose Kafka-shipped metrics through the consumer metric group, not subtask metric group
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    for 1.4 I would just remove the TODO since we won&apos;t fix it, but for 1.5 I would as you suggested register them twice.&lt;/p&gt;</comment>
                            <comment id="16346639" author="githubbot" created="Wed, 31 Jan 2018 11:22:41 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336#discussion_r165023649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336#discussion_r165023649&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -92,21 +93,19 @@ public Kafka09Fetcher(&lt;br/&gt;
     				watermarksPunctuated,&lt;br/&gt;
     				processingTimeProvider,&lt;br/&gt;
     				autoWatermarkInterval,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userCodeClassLoader,&lt;br/&gt;
    +				userCodeClassLoader.getParent(),&lt;br/&gt;
    +				consumerMetricGroup,&lt;br/&gt;
     				useMetrics);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.deserializer = deserializer;&lt;br/&gt;
     		this.handover = new Handover();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final MetricGroup kafkaMetricGroup = metricGroup.addGroup(&quot;KafkaConsumer&quot;);&lt;/li&gt;
	&lt;li&gt;addOffsetStateGauge(kafkaMetricGroup);&lt;br/&gt;
    -&lt;br/&gt;
     		this.consumerThread = new KafkaConsumerThread(&lt;br/&gt;
     				LOG,&lt;br/&gt;
     				handover,&lt;br/&gt;
     				kafkaProperties,&lt;br/&gt;
     				unassignedPartitionsQueue,&lt;/li&gt;
	&lt;li&gt;kafkaMetricGroup,&lt;br/&gt;
    +				subtaskMetricGroup, // TODO: the thread should expose Kafka-shipped metrics through the consumer metric group, not subtask metric group
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &#128076; makes sense, I&apos;ll do that and merge this.&lt;br/&gt;
    Thanks for the review!&lt;/p&gt;</comment>
                            <comment id="16346783" author="githubbot" created="Wed, 31 Jan 2018 13:07:10 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5335#discussion_r165045598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5335#discussion_r165045598&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -95,21 +95,19 @@ public Kafka09Fetcher(&lt;br/&gt;
     				watermarksPunctuated,&lt;br/&gt;
     				processingTimeProvider,&lt;br/&gt;
     				autoWatermarkInterval,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userCodeClassLoader,&lt;br/&gt;
    +				userCodeClassLoader.getParent(),&lt;br/&gt;
    +				consumerMetricGroup,&lt;br/&gt;
     				useMetrics);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.deserializer = deserializer;&lt;br/&gt;
     		this.handover = new Handover();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final MetricGroup kafkaMetricGroup = metricGroup.addGroup(KAFKA_CONSUMER_METRICS_GROUP);&lt;/li&gt;
	&lt;li&gt;addOffsetStateGauge(kafkaMetricGroup);&lt;br/&gt;
    -&lt;br/&gt;
     		this.consumerThread = new KafkaConsumerThread(&lt;br/&gt;
     				LOG,&lt;br/&gt;
     				handover,&lt;br/&gt;
     				kafkaProperties,&lt;br/&gt;
     				unassignedPartitionsQueue,&lt;/li&gt;
	&lt;li&gt;kafkaMetricGroup,&lt;br/&gt;
    +				subtaskMetricGroup, // TODO: the thread should expose Kafka-shipped metrics through the consumer metric group, not subtask metric group
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Will address this as discussed in #5336, and then merge this.&lt;/p&gt;</comment>
                            <comment id="16354358" author="githubbot" created="Tue, 6 Feb 2018 19:04:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5335&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5335&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16354377" author="tzulitai" created="Tue, 6 Feb 2018 19:08:27 +0000"  >&lt;p&gt;Merged.&lt;/p&gt;

&lt;p&gt;1.5 -&#160;40f26c80476b884a6b7f3431562a78018fa014c5&lt;br/&gt;
1.4 -&#160;432273aa963f46dc032c5007389a1a681b5188e6&lt;/p&gt;</comment>
                            <comment id="16355288" author="githubbot" created="Wed, 7 Feb 2018 10:36:20 +0000"  >&lt;p&gt;Github user tzulitai closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5336&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3otx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>