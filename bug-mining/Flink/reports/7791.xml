<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30687] FILTER not effect in count(*)</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30687</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When i try to using Flink SQL like this, i found &apos;FILTER(WHERE class_id = 1)&apos; is not effect.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE student
(
    id INT NOT NULL,
    name STRING,
    class_id INT NOT NULL
)
WITH (
    &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;url&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc:mysql:&lt;span class=&quot;code-comment&quot;&gt;//localhost:3306/test&apos;&lt;/span&gt;,
&lt;/span&gt;    &lt;span class=&quot;code-quote&quot;&gt;&apos;table-name&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;student&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;username&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;root&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;password&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;12345678&apos;&lt;/span&gt;
);

SELECT COUNT(*) FILTER (WHERE class_id = 1) FROM student;

or

SELECT COUNT(1) FILTER (WHERE class_id = 1) FROM student;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But when i tried Flink SQL like this, it worked.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT COUNT(*) FROM student WHERE class_id = 1;

or 

SELECT COUNT(class_id) FILTER (WHERE class_id = 1) FROM student;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;By the way, mysql connector has a bug and fixed in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-29558&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-29558&lt;/a&gt;. Maybe you try this demo should cherry-pick this PR first.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13518899">FLINK-30687</key>
            <summary>FILTER not effect in count(*)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lincoln.86xy">lincoln lee</assignee>
                                    <reporter username="tanjialiang">tanjialiang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 14 Jan 2023 06:06:28 +0000</created>
                <updated>Tue, 6 May 2025 06:27:03 +0000</updated>
                            <resolved>Mon, 17 Mar 2025 06:47:59 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.19.2</version>
                    <version>1.20.1</version>
                                    <fixVersion>1.20.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17677122" author="JIRAUSER279823" created="Mon, 16 Jan 2023 02:57:41 +0000"  >&lt;p&gt;I try to found out how to fix this, i found in org.apache.flink.table.planner.codegen.agg.AggsHandlerCodeGenerator#createFilterExpression the filterArg must be &amp;gt;0, but &#8216;SELECT COUNT( * )&#160;FILTER (WHERE cluster_id = 1) FROM ${table}&#8217; &apos;s filterArg is 0. I fixed the condition in &apos;filterArg &amp;gt;= 0&apos;, and it work.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13054606/13054606_image-2023-01-16-10-54-04-673.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So i want to ask why we can not filterArg=0? Did it some scenes we can not use? Because &apos;inputFieldTypes&apos; is a&#160;&apos;scala.collection.Seq&apos; which index is start from 0.&lt;/p&gt;</comment>
                            <comment id="17677694" author="martijnvisser" created="Tue, 17 Jan 2023 09:35:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=TsReaper&quot; class=&quot;user-hover&quot; rel=&quot;TsReaper&quot;&gt;TsReaper&lt;/a&gt; I believe you know most about the codegen, could you have a look?&lt;/p&gt;</comment>
                            <comment id="17935481" author="lincoln.86xy" created="Fri, 14 Mar 2025 10:52:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanjialiang&quot; class=&quot;user-hover&quot; rel=&quot;tanjialiang&quot;&gt;tanjialiang&lt;/a&gt; you&apos;re right! This should be fixed, I&apos;ve submitted a pr for this.&lt;/p&gt;</comment>
                            <comment id="17936099" author="lincoln.86xy" created="Mon, 17 Mar 2025 06:47:59 +0000"  >&lt;p&gt;Fixed in master: 3891fe8c13dd905033ea6ac08f2b4806302628aa&lt;/p&gt;

&lt;p&gt;release-1.20: d8baa7a78d043a92c79a2e9f174f794b6c5d772c&lt;/p&gt;

&lt;p&gt;release-2.0: c3e0acab15dd6610404de93775671fc108915224&lt;/p&gt;</comment>
                            <comment id="17936103" author="qinjunjerry" created="Mon, 17 Mar 2025 07:48:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13054606" name="image-2023-01-16-10-54-04-673.png" size="26302" author="tanjialiang" created="Mon, 16 Jan 2023 02:54:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1exwo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>