<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:32:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8711] Flink with YARN uses wrong SlotsPerTaskManager</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8711</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I see wrong behavior for Flink in YARN.&lt;/p&gt;

&lt;p&gt;I tried to setup SlotsPerTaskManager using &quot;-ys 2&#160;&quot;, but it used only 1 slot.&lt;/p&gt;

&lt;p&gt;I found the code &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L387&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L387&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For example, when I have&#160;:&quot;-yn 7 -ys 2&#160; -p 2&quot; in log I see:&lt;br/&gt;
 &quot;The YARN cluster has 14 slots available, but the user requested a parallelism of 2 on YARN. Each of the 7 TaskManagers will get 1 slots.&quot;&lt;/p&gt;

&lt;p&gt;Why can&apos;t we use -ys with -p?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13139586">FLINK-8711</key>
            <summary>Flink with YARN uses wrong SlotsPerTaskManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="Filichkin">Aleksandr Filichkin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Feb 2018 07:38:15 +0000</created>
                <updated>Thu, 22 Feb 2018 08:59:53 +0000</updated>
                            <resolved>Thu, 22 Feb 2018 08:59:53 +0000</resolved>
                                    <version>1.3.2</version>
                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16369829" author="aljoscha" created="Tue, 20 Feb 2018 09:09:46 +0000"  >&lt;p&gt;I think the original reasoning behind this is that it would lead to unused resources if Flink allowed specifying a number of slots where &lt;tt&gt;num task managers * num slots&lt;/tt&gt; is different from &lt;tt&gt;parallelism&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; What&apos;s the behaviour of the new FLIP-6 code regarding this?&lt;/p&gt;</comment>
                            <comment id="16369830" author="aljoscha" created="Tue, 20 Feb 2018 09:10:29 +0000"  >&lt;p&gt;Closing for now since it&apos;s working as intended.&lt;/p&gt;</comment>
                            <comment id="16369839" author="filichkin" created="Tue, 20 Feb 2018 09:21:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; I don&apos;t catch it. why do we have such restriction? What&#160;&#160;unused resources do you mean?&lt;/p&gt;

&lt;p&gt;For example I have light Sink function to save messages to&#160;DynamoDB(it&apos;s not CPU intensive) and I want have two parallelism for this sink. In this case I should run it on different task manager. it&apos;s weird.&#160;&lt;/p&gt;</comment>
                            <comment id="16369861" author="till.rohrmann" created="Tue, 20 Feb 2018 09:45:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Filichkin&quot; class=&quot;user-hover&quot; rel=&quot;Filichkin&quot;&gt;Filichkin&lt;/a&gt; you can use &lt;tt&gt;-ys&lt;/tt&gt;&#160;and &lt;tt&gt;-yn&lt;/tt&gt;&#160;together with &lt;tt&gt;-p&lt;/tt&gt;. The problem here is that you&apos;ve specified a cluster with 14 slots whereas you only have a parallelism of 2. Therefore, Flink assumes that you will waste resources for 12 slots and tries to decrease the number of slots on each TM to 1. The code was written with good intent but I think it&apos;s actually a good example for paternalism causing unpredictable behavior and confusion.&lt;/p&gt;

&lt;p&gt;With Flip-6 we won&apos;t need to specify the number of containers and slots anymore. Flink will automatically start as many containers as are needed to run a job with a given parallelism. The code, however, is still in the code base to not break the behavior of the pre Flip-6 code base.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16369873" author="till.rohrmann" created="Tue, 20 Feb 2018 10:03:55 +0000"  >&lt;p&gt;There is actually a problem: Due to this &quot;optimization&quot;, we basically don&apos;t allow the execution of jobs where we have multiple slot sharing groups. The number of maximum slots per TM will be determined by simply considering the user specified parallelism which is not necessarily the number of required slots. Thus, it is impossible for a user to execute these kind of jobs on a Yarn cluster. The same actually applies to the &lt;tt&gt;LocalExecutor&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16369874" author="till.rohrmann" created="Tue, 20 Feb 2018 10:05:04 +0000"  >&lt;p&gt;My proposal would be to simply remove the code which amends the number of slots per TM.&lt;/p&gt;</comment>
                            <comment id="16369900" author="githubbot" created="Tue, 20 Feb 2018 10:27:05 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8711&quot; title=&quot;Flink with YARN uses wrong SlotsPerTaskManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8711&quot;&gt;&lt;del&gt;FLINK-8711&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; Remove code which auto-magically changes slots per TM&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The FlinkYarnSessionCli auto-magically amends the number of slots with which the&lt;br/&gt;
    TMs are started. This was thought as a convenience function. However, it breaks the&lt;br/&gt;
    execution of jobs where we have multiple slot sharing groups. Therefore, this commit&lt;br/&gt;
    removes this code.&lt;/p&gt;

&lt;p&gt;    As a consequence, the user has to make sure that he specifies enough slots and&lt;br/&gt;
    containers for the pre Flip-6 code such that the number of total slots is greater&lt;br/&gt;
    or equal than the parallelism of the job.&lt;/p&gt;

&lt;p&gt;    *&lt;b&gt;Important:&lt;/b&gt;* This PR changes Flink&apos;s behaviour wrt starting Flink Yarn session clusters. It can become necessary that the user specifies the correct number of slots with which he wants to launch his TMs.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is already covered by existing tests, such as the Yarn test cases.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes it changes Flink&apos;s behaviour)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixYarnSlotAmending&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5532&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a8bdf32b24d3f41bb8056382743b7868f597b150&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-02-20T10:20:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8711&quot; title=&quot;Flink with YARN uses wrong SlotsPerTaskManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8711&quot;&gt;&lt;del&gt;FLINK-8711&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; Remove code which auto-magically changes slots per TM&lt;/p&gt;

&lt;p&gt;    The FlinkYarnSessionCli auto-magically amends the number of slots with which the&lt;br/&gt;
    TMs are started. This was thought as a convenience function. However, it breaks the&lt;br/&gt;
    execution of jobs where we have multiple slot sharing groups. Therefore, this commit&lt;br/&gt;
    removes this code.&lt;/p&gt;

&lt;p&gt;    As a consequence, the user has to make sure that he specifies enough slots and&lt;br/&gt;
    containers for the pre Flip-6 code such that the number of total slots is greater&lt;br/&gt;
    or equal than the parallelism of the job.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16369942" author="githubbot" created="Tue, 20 Feb 2018 11:08:35 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Could we instead also account for SlotSharingGroups? The existing behavior has been there for quite a while hasn&apos;t it :/&lt;/p&gt;</comment>
                            <comment id="16369957" author="filichkin" created="Tue, 20 Feb 2018 11:28:33 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16370018" author="githubbot" created="Tue, 20 Feb 2018 12:49:00 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This is not possible. The problem arises when you start a session cluster where you don&apos;t know the Flink job to submit. &lt;/p&gt;

&lt;p&gt;    Personally, I&apos;m not a huge fan of too much auto magic which leads to unexpected behaviour. Instead I would prefer that things fail if not properly started (e.g. not enough slots) instead of trying to figure out the right number of slots (which apparently breaks things). &lt;/p&gt;</comment>
                            <comment id="16371156" author="githubbot" created="Wed, 21 Feb 2018 09:46:49 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In FLIP-6 mode, the right thing is to not have the number of TaskManagers preconfigured, but to start them when needed. Does that work already?&lt;/p&gt;

&lt;p&gt;    The Yarn session would then&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Start Dispatcher + ResourceManager (= Yarn App Master)&lt;/li&gt;
	&lt;li&gt;Start JM when job i ssubmitted&lt;/li&gt;
	&lt;li&gt;Allocate TMs when JobManager requests slots&lt;/li&gt;
	&lt;li&gt;TMs are held by the ResourceManager after the JM releases them, and kept in the session for a certain time before they are returned to YARN.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I am +1 to remove this &quot;auto change slots&quot; code, it really breaks abstraction, and go for the above model&lt;/p&gt;</comment>
                            <comment id="16371608" author="githubbot" created="Wed, 21 Feb 2018 16:18:11 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @zentol and @StephanEwen. Travis passed. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="16372158" author="githubbot" created="Wed, 21 Feb 2018 22:58:08 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16372554" author="till.rohrmann" created="Thu, 22 Feb 2018 08:59:53 +0000"  >&lt;p&gt;Fixed via&#160;ac131d503a60ba0394ebd8afc8f3d5eef8ef9715&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13139623">FLINK-8712</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qd7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>