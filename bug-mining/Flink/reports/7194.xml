<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-32296] Flink SQL handle array of row incorrectly</title>
                <link>https://issues.apache.org/jira/browse/FLINK-32296</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;FlinkSQL produce incorrect result when involving data with type of ARRAY&amp;lt;ROW&amp;gt;, here&apos;s a reproduction:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TEMPORARY VIEW bug_data as (
SELECT CAST(ARRAY[
(10, &lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-10&apos;&lt;/span&gt;), (101, &lt;span class=&quot;code-quote&quot;&gt;&apos;244ddf&apos;&lt;/span&gt;), (1011, &lt;span class=&quot;code-quote&quot;&gt;&apos;2asdfaf&apos;&lt;/span&gt;), (1110, &lt;span class=&quot;code-quote&quot;&gt;&apos;200&apos;&lt;/span&gt;), (2210, &lt;span class=&quot;code-quote&quot;&gt;&apos;20-01-10&apos;&lt;/span&gt;), (4410, &lt;span class=&quot;code-quote&quot;&gt;&apos;21111&apos;&lt;/span&gt;)
] AS ARRAY&amp;lt;ROW&amp;lt;A INT, B STRING&amp;gt;&amp;gt;)
UNION
SELECT CAST(ARRAY[
(10, &lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-10&apos;&lt;/span&gt;), (121, &lt;span class=&quot;code-quote&quot;&gt;&apos;244ddf&apos;&lt;/span&gt;), (2222, &lt;span class=&quot;code-quote&quot;&gt;&apos;2asdfaf&apos;&lt;/span&gt;), (32243, &lt;span class=&quot;code-quote&quot;&gt;&apos;200&apos;&lt;/span&gt;), (2210, &lt;span class=&quot;code-quote&quot;&gt;&apos;33333-01-10&apos;&lt;/span&gt;), (4410, &lt;span class=&quot;code-quote&quot;&gt;&apos;23243243&apos;&lt;/span&gt;)
] AS ARRAY&amp;lt;ROW&amp;lt;A INT, B STRING&amp;gt;&amp;gt;)
UNION SELECT CAST(ARRAY[
(10, &lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-10&apos;&lt;/span&gt;), (222, &lt;span class=&quot;code-quote&quot;&gt;&apos;244ddf&apos;&lt;/span&gt;), (1011, &lt;span class=&quot;code-quote&quot;&gt;&apos;2asdfaf&apos;&lt;/span&gt;), (1110, &lt;span class=&quot;code-quote&quot;&gt;&apos;200&apos;&lt;/span&gt;), (24367, &lt;span class=&quot;code-quote&quot;&gt;&apos;20-01-10&apos;&lt;/span&gt;), (4410, &lt;span class=&quot;code-quote&quot;&gt;&apos;21111&apos;&lt;/span&gt;)
] AS ARRAY&amp;lt;ROW&amp;lt;A INT, B STRING&amp;gt;&amp;gt;)
UNION SELECT CAST(ARRAY[
(10, &lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-10&apos;&lt;/span&gt;), (5666, &lt;span class=&quot;code-quote&quot;&gt;&apos;244ddf&apos;&lt;/span&gt;), (435243, &lt;span class=&quot;code-quote&quot;&gt;&apos;2asdfaf&apos;&lt;/span&gt;), (56567, &lt;span class=&quot;code-quote&quot;&gt;&apos;200&apos;&lt;/span&gt;), (2210, &lt;span class=&quot;code-quote&quot;&gt;&apos;20-01-10&apos;&lt;/span&gt;), (4410, &lt;span class=&quot;code-quote&quot;&gt;&apos;21111&apos;&lt;/span&gt;)
] AS ARRAY&amp;lt;ROW&amp;lt;A INT, B STRING&amp;gt;&amp;gt;)
UNION SELECT CAST(ARRAY[
(10, &lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-10&apos;&lt;/span&gt;), (43543, &lt;span class=&quot;code-quote&quot;&gt;&apos;244ddf&apos;&lt;/span&gt;), (1011, &lt;span class=&quot;code-quote&quot;&gt;&apos;2asdfaf&apos;&lt;/span&gt;), (1110, &lt;span class=&quot;code-quote&quot;&gt;&apos;200&apos;&lt;/span&gt;), (8967564, &lt;span class=&quot;code-quote&quot;&gt;&apos;20-01-10&apos;&lt;/span&gt;), (4410, &lt;span class=&quot;code-quote&quot;&gt;&apos;21111&apos;&lt;/span&gt;)
] AS ARRAY&amp;lt;ROW&amp;lt;A INT, B STRING&amp;gt;&amp;gt;)
);

CREATE TABLE sink (
r ARRAY&amp;lt;ROW&amp;lt;A INT, B STRING&amp;gt;&amp;gt;
) WITH (&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;print&apos;&lt;/span&gt;); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In all 1.15. 1.16 and 1.17 version I&apos;ve tested, it produces the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[+I[4410, 21111], +I[4410, 21111], +I[4410, 21111], +I[4410, 21111], +I[4410, 21111], +I[4410, 21111]]

[+I[4410, 23243243], +I[4410, 23243243], +I[4410, 23243243], +I[4410, 23243243], +I[4410, 23243243], +I[4410, 23243243]]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think this is unexpected/wrong because:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The query should produce 5 rows, not 2&lt;/li&gt;
	&lt;li&gt;The data is also wrong, noticed it just make every row in the array the same, but the input are not the same.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13539395">FLINK-32296</key>
            <summary>Flink SQL handle array of row incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Sergey Nuyanzin">Sergey Nuyanzin</assignee>
                                    <reporter username="qingwei91">Lim Qing Wei</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 9 Jun 2023 09:01:03 +0000</created>
                <updated>Wed, 25 Oct 2023 10:01:26 +0000</updated>
                            <resolved>Wed, 23 Aug 2023 19:26:30 +0000</resolved>
                                    <version>1.15.3</version>
                    <version>1.16.2</version>
                    <version>1.17.1</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                    <fixVersion>1.19.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="17731149" author="libenchao" created="Sat, 10 Jun 2023 02:30:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingwei91&quot; class=&quot;user-hover&quot; rel=&quot;qingwei91&quot;&gt;qingwei91&lt;/a&gt; Thanks for reporting the issue, have you tried on current master branch?&lt;/p&gt;</comment>
                            <comment id="17739252" author="sergey nuyanzin" created="Sat, 1 Jul 2023 00:13:07 +0000"  >&lt;p&gt;The root cause is &lt;tt&gt;RowToRowCastRule&lt;/tt&gt;. Since it was introduced in 1.15.0 at &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-25052&quot; title=&quot;Port row to row cast logic to CastRule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-25052&quot;&gt;&lt;del&gt;FLINK-25052&lt;/del&gt;&lt;/a&gt; it could work for 1.14.x.&lt;/p&gt;

&lt;p&gt;During code gen it generates something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i$13 = 0; i$13 &amp;lt; array$7.size(); i$13++) {
...
   writer$17.reset();
...
   result$15 = row$16;
...
   objArray$12[i$13] = result$15;
...
}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where &lt;tt&gt;result$15&lt;/tt&gt; - item of array and in case of row it is passed by reference, and then overridden by other values in next iterations.&lt;br/&gt;
Finally every element of array references to the latest source array element.&lt;br/&gt;
Thus if we look at example and especially at last element of every array from &lt;tt&gt;bug_data&lt;/tt&gt; in description there are only two different elements. That explains why it gives currently 2 elements instead of 5.&lt;/p&gt;

&lt;p&gt;Same problem is for maps with size more than 1 where key or value is row&lt;/p&gt;

&lt;p&gt;so the idea of fix just use &lt;tt&gt;copy&lt;/tt&gt; method of &lt;tt&gt;RowBinaryData&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17739253" author="sergey nuyanzin" created="Sat, 1 Jul 2023 00:22:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingwei91&quot; class=&quot;user-hover&quot; rel=&quot;qingwei91&quot;&gt;qingwei91&lt;/a&gt; could you please double check that this fix fixes the problem?&lt;/p&gt;</comment>
                            <comment id="17741252" author="JIRAUSER289353" created="Sat, 8 Jul 2023 07:55:33 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt; , I am not able to build your branch locally. Is there any alternative to test it?&lt;/p&gt;

&lt;p&gt;I am getting this error when trying to build&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; Failed to execute goal org.apache.rat:apache-rat-plugin:0.13:check (default) on project flink-parent: Too many files with unapproved license: 1 See RAT report&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17741256" author="sergey nuyanzin" created="Sat, 8 Jul 2023 08:47:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingwei91&quot; class=&quot;user-hover&quot; rel=&quot;qingwei91&quot;&gt;qingwei91&lt;/a&gt; this error means that you have some other files without license in header.&lt;br/&gt;
Are you sure you don&apos;t have other changes which are not part of this PR? &lt;br/&gt;
by the way you can use this command&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./mvnw -DskipTests -Dfast -Pskip-webui-build install
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it will skip such checks&lt;/p&gt;</comment>
                            <comment id="17743720" author="JIRAUSER289353" created="Mon, 17 Jul 2023 10:22:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt; , sorry for the long response time.&lt;/p&gt;

&lt;p&gt;I finally got around to test it, and I can confirm it fixes the issue in my test case.&lt;/p&gt;

&lt;p&gt;Thanks a lot for the fix!&lt;/p&gt;

&lt;p&gt;I suppose we will need someone to review and merge the change? Looks fairly small but I dont have enough knowledge to understand it.&lt;/p&gt;</comment>
                            <comment id="17752067" author="JIRAUSER290961" created="Tue, 8 Aug 2023 14:27:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingwei91&quot; class=&quot;user-hover&quot; rel=&quot;qingwei91&quot;&gt;qingwei91&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt;, we also seem to hit this issue using flink 1.17.1. I was able to reproduce it and also fix it with the pr changes proposed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt;. &lt;br/&gt;
Is there a chance that this fix will be added to 1.17.2?&lt;/p&gt;</comment>
                            <comment id="17758194" author="sergey nuyanzin" created="Wed, 23 Aug 2023 18:52:00 +0000"  >&lt;p&gt;Merged to master as &lt;a href=&quot;https://github.com/apache/flink/commit/6d62f9918ea2cbb8a10c705a25a4ff6deab60711&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6d62f9918ea2cbb8a10c705a25a4ff6deab60711&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1.16: &lt;a href=&quot;https://github.com/apache/flink/commit/4d593cdb3fb0e989065437ab3ed6430a7ea2075e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4d593cdb3fb0e989065437ab3ed6430a7ea2075e&lt;/a&gt;&lt;br/&gt;
1.17: &lt;a href=&quot;https://github.com/apache/flink/commit/ac77023c09002728c15da564a88039e638dd412d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ac77023c09002728c15da564a88039e638dd412d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758306" author="renqs" created="Thu, 24 Aug 2023 01:53:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt; I think we also need to cherry-pick the patch to the release-1.18 branch&lt;/p&gt;</comment>
                            <comment id="17758390" author="sergey nuyanzin" created="Thu, 24 Aug 2023 06:42:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renqs&quot; class=&quot;user-hover&quot; rel=&quot;renqs&quot;&gt;renqs&lt;/a&gt; agree and also think so&lt;br/&gt;
in fact the back port PR &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; was already present for 1.18 branch however yesterday it was still in ci processing&lt;br/&gt;
will merge it today&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/flink/pull/23273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/23273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758396" author="sergey nuyanzin" created="Thu, 24 Aug 2023 06:53:32 +0000"  >&lt;p&gt;1.18: &lt;a href=&quot;https://github.com/apache/flink/commit/8715f0a1e8c3bb6595d26c69ef4ef246486d187d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8715f0a1e8c3bb6595d26c69ef4ef246486d187d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17779441" author="qingyue" created="Wed, 25 Oct 2023 10:01:26 +0000"  >&lt;p&gt;Encountered the same problem, and the fix worked! Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13532339">FLINK-31778</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13548003">FLINK-32897</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1iftc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>