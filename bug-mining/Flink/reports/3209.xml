<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13127] &quot;--yarnship&quot; doesn&apos;t support resource classloading</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13127</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently yarnship works as follows:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;user specifies directory to ship with the job&lt;/li&gt;
	&lt;li&gt;yarn ships it with the container&lt;/li&gt;
	&lt;li&gt;org.apache.flink.yarn.AbstractYarnClusterDescriptor#uploadAndRegisterFiles traverses directory recursively and adds each file to the classpath&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This works well for shipping jars, but doesn&apos;t work correctly with shipping resources that we want to load using java.lang.ClassLoader#getResource method.&lt;/p&gt;

&lt;p&gt;In order to make resource classloading work, we need to register it&apos;s directory instead of the file itself (java classpath expects directories or archives).&lt;/p&gt;

&lt;p&gt;CLASSPATH=&quot;shipped/custom.conf:${CLASSPATH}&quot; needs to become CLASSPATH=&quot;shipped:${CLASSPATH}&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13243427">FLINK-13127</key>
            <summary>&quot;--yarnship&quot; doesn&apos;t support resource classloading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dmvk">David Mor&#225;vek</assignee>
                                    <reporter username="dmvk">David Mor&#225;vek</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 5 Jul 2019 18:12:06 +0000</created>
                <updated>Tue, 3 Dec 2019 00:53:19 +0000</updated>
                            <resolved>Thu, 15 Aug 2019 17:59:05 +0000</resolved>
                                    <version>1.8.1</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16880157" author="fly_in_gis" created="Mon, 8 Jul 2019 09:48:25 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dmvk&quot; class=&quot;user-hover&quot; rel=&quot;dmvk&quot;&gt;dmvk&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;You are correct. The shipped files and jars are included in CLASSPATH of job manager and task manager. However, the container workDir is not in CLASSPATH. So you could not use&#160;java.lang.ClassLoader#getResource to&#160;read/write&#160;your file. This feature should be supported in the future and maybe you could open your file by the following codes now.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; env = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getenv(); 
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; workingDirectory = env.get(ApplicationConstants.Environment.PWD.key());
File myFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(workingDirectory, &lt;span class=&quot;code-quote&quot;&gt;&quot;myFileName&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16880494" author="davidmoravek" created="Mon, 8 Jul 2019 16:00:08 +0000"  >&lt;p&gt;Hello Yang, yes you can definitely do this. Problem is when you&apos;re using existing libraries that rely on classloading. Also yarnship behavior is now inconsistent, because classloading works for archives, but not for resources (&lt;b&gt;which are added to classpath too, but in incorrect format&lt;/b&gt;).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think proper behavior would be:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We traverse ship directory recursively
	&lt;ul&gt;
		&lt;li&gt;If we find an archive, we add it to a archives list&lt;/li&gt;
		&lt;li&gt;If we find a resource, we resolve its parent directory and add it to resourceDirectories set&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;We construct classpath for shipped files as follows: sorted(resourceDirectories) + sorted(archives)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ll provide a patch for this today.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16881808" author="fly_in_gis" created="Wed, 10 Jul 2019 07:52:50 +0000"  >&lt;p&gt;Hi David,&lt;/p&gt;

&lt;p&gt;Sounds great. It is exactly what we want. Just make &quot;&#8211;yarnship&quot; support jars, files and archives.&lt;/p&gt;</comment>
                            <comment id="16908360" author="till.rohrmann" created="Thu, 15 Aug 2019 17:59:05 +0000"  >&lt;p&gt;Fixed via 17e2747e575cc4d9847be76b5ce9a75a7b6707f7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13080810">FLINK-6949</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04eyw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This change orders the shipped files wrt to resources and jar files as well as alphabetically in these groups.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>