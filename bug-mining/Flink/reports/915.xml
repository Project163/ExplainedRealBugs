<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3681] CEP library does not support Java 8 lambdas as select function</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3681</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, the CEP library does not support Java 8 lambdas to be used as &lt;tt&gt;select&lt;/tt&gt; or &lt;tt&gt;flatSelect&lt;/tt&gt; function. The problem is that the &lt;tt&gt;TypeExtractor&lt;/tt&gt; has different semantics when calling &lt;tt&gt;TypeExtractor.getUnaryOperatorReturnType&lt;/tt&gt; either with a Java 8 lambda or  an instance of an UDF function.&lt;/p&gt;

&lt;p&gt;To illustrate the problem assume we have the following UDF function &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyFunction[T, O] {
    O foobar(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, T&amp;gt; inputElements);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When calling the &lt;tt&gt;TypeExtractor&lt;/tt&gt; with an anonymous class which implements this interface, the first type parameter is considered being the input type of the function, namely &lt;tt&gt;T&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;In contrast, when providing a Java 8 lambda for this interface, the &lt;tt&gt;TypeExtractor&lt;/tt&gt; will see an input type of &lt;tt&gt;Map&amp;lt;String, T&amp;gt;&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;This problem also occurs with a &lt;tt&gt;FlatMapFunction&lt;/tt&gt; whose first type argument is &lt;tt&gt;T&lt;/tt&gt; but whose first parameter of a Java 8 lambda is &lt;tt&gt;Iterable&amp;lt;T&amp;gt;&lt;/tt&gt;. In order to solve the problem here, the &lt;tt&gt;TypeExtractor.getUnaryOperatorReturnType&lt;/tt&gt; method has the parameters &lt;tt&gt;hasIterable&lt;/tt&gt; and &lt;tt&gt;hasCollector&lt;/tt&gt;. If these values are &lt;tt&gt;true&lt;/tt&gt;, then a special code path is taken (in case of a Java 8 lambda), where the input type is compared to the first type argument of the first input parameter of the lambda (here an &lt;tt&gt;Iterable&amp;lt;T&amp;gt;&lt;/tt&gt;). This hand-knitted solution does not generalize well, as it will fail for all parameterized types which have the input type at a different position (e.g. &lt;tt&gt;Map&amp;lt;String, T&amp;gt;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt; In order to solve the problem, I propose to generalize the &lt;tt&gt;getUnaryOperatorReturnType&lt;/tt&gt; a little bit so that one can specify at which position the input type is specified by a parameterized type.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12954618">FLINK-3681</key>
            <summary>CEP library does not support Java 8 lambdas as select function</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Mar 2016 13:07:11 +0000</created>
                <updated>Thu, 31 Mar 2016 08:33:26 +0000</updated>
                            <resolved>Thu, 31 Mar 2016 08:33:26 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>Library / CEP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15217943" author="githubbot" created="Wed, 30 Mar 2016 13:11:27 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3681&quot; title=&quot;CEP library does not support Java 8 lambdas as select function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3681&quot;&gt;&lt;del&gt;FLINK-3681&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cep, typeextractor&amp;#93;&lt;/span&gt; Generalize TypeExtractor to support more lambdas&lt;/p&gt;

&lt;p&gt;    The TypeExtractor.getUnaryOperatorReturnType and TypeExtractor.getBinaryOperatorReturnType&lt;br/&gt;
    methods have been extended to support positional arguments for the input types. This allows&lt;br/&gt;
    to support parameterized types as Java 8 lambda arguments where the input type is not specified&lt;br/&gt;
    by the first type argument (e.g. Map&amp;lt;String, T&amp;gt;). This also solves the problem that the CEP&lt;br/&gt;
    library did not support Java 8 lambdas as select functions.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixCEPJava8&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1840&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4e626b79e290acb7a5fd546a985310aef17db8c2&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-03-30T12:55:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3681&quot; title=&quot;CEP library does not support Java 8 lambdas as select function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3681&quot;&gt;&lt;del&gt;FLINK-3681&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cep, typeextractor&amp;#93;&lt;/span&gt; Generalize TypeExtractor to support more lambdas&lt;/p&gt;

&lt;p&gt;    The TypeExtractor.getUnaryOperatorReturnType and TypeExtractor.getBinaryOperatorReturnType&lt;br/&gt;
    methods have been extended to support positional arguments for the input types. This allows&lt;br/&gt;
    to support parameterized types as Java 8 lambda arguments where the input type is not specified&lt;br/&gt;
    by the first type argument (e.g. Map&amp;lt;String, T&amp;gt;). This also solves the problem that the CEP&lt;br/&gt;
    library did not support Java 8 lambdas as select functions.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15218041" author="githubbot" created="Wed, 30 Mar 2016 14:35:18 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840#discussion_r57898915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840#discussion_r57898915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -291,12 +347,15 @@ protected TypeExtractor() {&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;br/&gt;
     				final int paramLen = m.getGenericParameterTypes().length - 1;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final Type input = (hasCollector)? m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen - 1&amp;#93;&lt;/span&gt; : m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;;&lt;/li&gt;
	&lt;li&gt;validateInputType((hasIterable)?removeGenericWrapper(input) : input, inType);&lt;br/&gt;
    +				final Type input = (outputTypeArgumentIndex &amp;gt;= 0) ? m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen - 1&amp;#93;&lt;/span&gt; : m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    +				validateInputType((inputTypeArgumentIndex &amp;gt;= 0) ? extractTypeArgument(input, inputTypeArgumentIndex) : input, inType);&lt;br/&gt;
     				if(function instanceof ResultTypeQueryable) 
{
     					return ((ResultTypeQueryable&amp;lt;OUT&amp;gt;) function).getProducedType();
     				}&lt;/li&gt;
	&lt;li&gt;return new TypeExtractor().privateCreateTypeInfo((hasCollector)? removeGenericWrapper(m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;) : m.getGenericReturnType(), inType, null);&lt;br/&gt;
    +				return new TypeExtractor().privateCreateTypeInfo((&lt;br/&gt;
    +					outputTypeArgumentIndex &amp;gt;= 0)? extractTypeArgument(m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;, outputTypeArgumentIndex) : m.getGenericReturnType(),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Trivial:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;line break after second `(` on purpose?&lt;/li&gt;
	&lt;li&gt;White space before `?` missing&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15218057" author="githubbot" created="Wed, 30 Mar 2016 14:41:42 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840#discussion_r57900102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840#discussion_r57900102&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/java/typeutils/TypeExtractor.java &amp;#8212;&lt;br/&gt;
    @@ -291,12 +347,15 @@ protected TypeExtractor() {&lt;/p&gt;

&lt;p&gt;     				// parameters must be accessed from behind, since JVM can add additional parameters e.g. when using local variables inside lambda function&lt;br/&gt;
     				final int paramLen = m.getGenericParameterTypes().length - 1;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final Type input = (hasCollector)? m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen - 1&amp;#93;&lt;/span&gt; : m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;;&lt;/li&gt;
	&lt;li&gt;validateInputType((hasIterable)?removeGenericWrapper(input) : input, inType);&lt;br/&gt;
    +				final Type input = (outputTypeArgumentIndex &amp;gt;= 0) ? m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen - 1&amp;#93;&lt;/span&gt; : m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;;&lt;br/&gt;
    +				validateInputType((inputTypeArgumentIndex &amp;gt;= 0) ? extractTypeArgument(input, inputTypeArgumentIndex) : input, inType);&lt;br/&gt;
     				if(function instanceof ResultTypeQueryable) 
{
     					return ((ResultTypeQueryable&amp;lt;OUT&amp;gt;) function).getProducedType();
     				}&lt;/li&gt;
	&lt;li&gt;return new TypeExtractor().privateCreateTypeInfo((hasCollector)? removeGenericWrapper(m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;) : m.getGenericReturnType(), inType, null);&lt;br/&gt;
    +				return new TypeExtractor().privateCreateTypeInfo((&lt;br/&gt;
    +					outputTypeArgumentIndex &amp;gt;= 0)? extractTypeArgument(m.getGenericParameterTypes()&lt;span class=&quot;error&quot;&gt;&amp;#91;paramLen&amp;#93;&lt;/span&gt;, outputTypeArgumentIndex) : m.getGenericReturnType(),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good catch. Will fix it.&lt;/p&gt;</comment>
                            <comment id="15218060" author="githubbot" created="Wed, 30 Mar 2016 14:42:41 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840#issuecomment-203465710&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840#issuecomment-203465710&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks like a nice generalization of the iterable and collector cases. Good that you did not introduce a `hasMap` &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    +1 to merge to `master` and `release-1.0` after tests pass.&lt;/p&gt;</comment>
                            <comment id="15218063" author="githubbot" created="Wed, 30 Mar 2016 14:43:33 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840#issuecomment-203466325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840#issuecomment-203466325&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @uce &lt;/p&gt;</comment>
                            <comment id="15218066" author="githubbot" created="Wed, 30 Mar 2016 14:44:08 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840#issuecomment-203466649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840#issuecomment-203466649&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Once Travis gives green light I&apos;ll merge it.&lt;/p&gt;</comment>
                            <comment id="15218175" author="githubbot" created="Wed, 30 Mar 2016 15:40:23 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840#issuecomment-203494813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840#issuecomment-203494813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Till&apos;s local Travis passed (&lt;a href=&quot;https://travis-ci.org/tillrohrmann/flink/builds/119523927&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/tillrohrmann/flink/builds/119523927&lt;/a&gt;). I&apos;m going to merge this.&lt;/p&gt;</comment>
                            <comment id="15218357" author="githubbot" created="Wed, 30 Mar 2016 17:20:55 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1840&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1840&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15219584" author="till.rohrmann" created="Thu, 31 Mar 2016 08:33:26 +0000"  >&lt;p&gt;Fixed via 833339f3a0faafbab9af90433488393421ae7171&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2veef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>